var Core=new Object();Core.Debug=false;Core.PrefixUrl="api/v1/";Core.Origin=Core.Debug?"https://devusers.balanz.com":"";Core.loadPage=function(c,a){var b=new Core.Controls.Overlay(document.body,{});$.ajax({url:"/Pages/"+c+"?v="+(new Date()).toString(),success:function(f){if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:0,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(g){}}Core.Functions.Timers.clear();for(var d=0;d<Core.Objects.Context.Dialogs.length;d++){if(Core.Objects.Context.Dialogs[d]&&Core.Objects.Context.Dialogs[d].destroy){Core.Objects.Context.Dialogs[d].destroy()}}Core.Objects.Context.Dialogs=[];Core.Functions.grid.Cotizaciones.details=[];var e=$(f);$(".body-container").html(e);$(".footer").show();a();if(Core.Objects.Context.Configuration&&Core.Objects.Context.Configuration.idAplicacion==14){$(".footer").load("/Pages/footer-trading.html")}else{$(".footer").load("/Pages/footer.html")}$("html, body").animate({scrollTop:0},1000)},complete:function(){b.destroy()}})};Core.Ajax=new Object();Core.Ajax.ServerRequest=function(b){var a=this;a.overlayElement=document.body;a.onSuccess=function(c){};a.onError=function(d){if(d.status==403&&d.responseJSON&&d.responseJSON.CodigoError==-1001){Core.Business.Logout.logout()}else{if(d.status==403&&d.responseJSON&&d.responseJSON.CodigoError==-605){var f=new Core.Controls.Dialog("Link vencido","<p>"+d.responseJSON.Descripcion+"</p>",{displayButtons:{close:true,accept:false}});f.show()}else{var g=(d.responseJSON&&d.responseJSON.Descripcion)?"Mensaje":"Error de conexión";var c=(d.responseJSON&&d.responseJSON.Descripcion)?d.responseJSON.Descripcion:"Algunos componentes de la página no se cargaron correctamente. Por favor intente mas tarde...";var f=new Core.Controls.Dialog(g,"<p>"+c+"</p>",{displayButtons:{close:true,accept:false}});f.show()}}};a.onComplete=function(){};a.headers={Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"};a.requestUrl="";a.requestType="POST";a.contentType="application/json";a.requestData=null;a.showOverlay=true;a.secureRequest=true;a.allowCache=false;$.extend(true,a,b);a.getCacheKey=function(){return a.requestType+a.requestUrl+JSON.stringify(a.requestData)};a.getDataFromStorage=function(){if(Core.Functions.Validations.isBlockedStorage()||!Core.Functions.Persistence.getStorage()){return null}var c=Core.Functions.Persistence.getStorage().getItem(a.getCacheKey());return c?JSON.parse(LZString.decompressFromUTF16(c)):null};a.saveDataToStorage=function(c){if(Core.Functions.Validations.isBlockedStorage()||!Core.Functions.Persistence.getStorage()){return}Core.Functions.Persistence.getStorage().setItem(a.getCacheKey(),LZString.compressToUTF16(JSON.stringify(c)))};a.request=function(){if(a.secureRequest){a.headers={Accept:"application/json","Content-Type":a.contentType,Authorization:Core.Objects.Context.Token}}else{a.headers={Accept:"application/json","Content-Type":a.contentType}}if(a.allowCache){var d=a.getDataFromStorage();if(d){a.onSuccess(d);a.onComplete();return}}var c=null;if(a.showOverlay){c=new Core.Controls.Overlay(a.overlayElement,{})}$.ajax({headers:a.headers,url:Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+a.requestUrl,type:a.requestType,data:a.requestData!=null?a.requestType=="POST"||a.requestType=="PUT"?JSON.stringify(a.requestData):a.requestData:null,success:function(e){if(a.allowCache){a.saveDataToStorage(e)}a.onSuccess(e)},error:a.onError,complete:function(){if(a.showOverlay){c.destroy()}a.onComplete()}})}};Core.Ajax.SR=Core.Ajax.ServerRequest;Core.Business=new Object();Core.Business.Acciones=new function(){var a=this;a.id="cot_acciones";a.idDefaultAccount=null;a.idDefaultProfile=null;a.optionsCotizaciones=null;a.btnMerval=null;a.btnMercadoArgentino=null;a.btnGeneral=null;a.treeMapDataTable=null;a.treeMapMerval=null;a.divContainerTreeMapMerval=null;a.divTreeMapMerval=null;a.btnTreeMapMerval=null;a.divCotizacionMerval=null;a.divMerval=null;a.txtFilterMerval=null;a.timeoutMerval=null;a.divPlazoMerval=null;a.ddlPlazoMerval=null;a.divCotizacionMercadoArgentino=null;a.divMercadoArgentino=null;a.txtFilterMercadoArgentino=null;a.timeoutMercadoArgentino=null;a.divPlazoMercadoArgentino=null;a.ddlPlazoMercadoArgentino=null;a.treeMapGeneral=null;a.divContainerTreeMapGeneral=null;a.divTreeMapGeneral=null;a.btnTreeMapGeneral=null;a.divCotizacionGeneral=null;a.divGeneral=null;a.txtFilterGeneral=null;a.timeoutGeneral=null;a.divPlazoGeneral=null;a.ddlPlazoGeneral=null;a.maxToken=0;a.lastData=null;a.maxTokenIndice=0;a.lastDataIndice=null;a.timerId=null;a.timerIdForceRefresh=null;a.loaded=false;a.refresh=false;a.forceRefresh=false;a.window=$(window);a.init=function(b,c){Core.loadPage("acciones.html",function(){document.title="Acciones";a.loaded=false;a.refresh=false;a.forceRefresh=false;a.idDefaultAccount=b;a.idDefaultProfile=c;a.optionsCotizaciones=Core.Functions.Context.Profiles.getPageOptionsByMenu("cotizaciones",Core.Objects.Context.Profiles[c]);a.maxToken=0;a.lastData=null;a.maxTokenIndice=0;a.lastDataIndice=null;a.setTabs();var d=Core.Objects.Context.Profiles[c].opciones.maxWatchlists;Core.Functions.grid.Cotizaciones.initGrid(a.divMerval,true,true,false,d,null,null,a.optionsCotizaciones.cot_profundidad,Core.Enums.ePanel.Acciones,b,c);Core.Functions.grid.Cotizaciones.initFilter(a.divMerval,a.txtFilterMerval,a.timeoutMerval,a.window);Core.Functions.grid.Cotizaciones.initGrid(a.divMercadoArgentino,true,true,false,d,null,null,a.optionsCotizaciones.cot_profundidad,Core.Enums.ePanel.Acciones,b,c);Core.Functions.grid.Cotizaciones.initFilter(a.divMercadoArgentino,a.txtFilterMercadoArgentino,a.timeoutMercadoArgentino,a.window);Core.Functions.grid.Cotizaciones.initGrid(a.divGeneral,true,true,false,d,null,null,a.optionsCotizaciones.cot_profundidad,Core.Enums.ePanel.Acciones,b,c);Core.Functions.grid.Cotizaciones.initFilter(a.divGeneral,a.txtFilterGeneral,a.timeoutGeneral,a.window);a.ddlInstrumentSearch=$(".dropdown-instrument-search");Core.Functions.grid.Cotizaciones.initInstrumentSearch(a.ddlInstrumentSearch,b,c);google.charts.load("current",{packages:["treemap"]});google.charts.setOnLoadCallback(function(){a.createTreeMaps();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){Core.Functions.grid.Cotizaciones.loadInstrumentSearch(b,a.ddlInstrumentSearch,function(){a.loadTab(a.divMerval,a.divCotizacionMerval,"acciones/1",a.divContainerTreeMapMerval,a.treeMapMerval,a.divPlazoMerval,a.ddlPlazoMerval,Core.Enums.ePanel.AccionesMerval)})},"Core.Business.Acciones")})})};a.setTabs=function(){a.divCotizacionMerval=$(".div-cotizacion-merval");a.divMerval=$(".div-merval");a.txtFilterMerval=$(".textbox-merval-filter");a.divCotizacionMercadoArgentino=$(".div-cotizacion-mercado-argentino");a.divMercadoArgentino=$(".div-mercado-argentino");a.txtFilterMercadoArgentino=$(".textbox-mercado-argentino-filter");a.divCotizacionGeneral=$(".div-cotizacion-general");a.divGeneral=$(".div-general");a.txtFilterGeneral=$(".textbox-general-filter");a.btnMerval=$(".btn-merval");a.btnMercadoArgentino=$(".btn-mercado-argentino");a.btnGeneral=$(".btn-general");a.divPlazoMerval=$(".div-plazo-merval");a.divPlazoMerval.hide();a.ddlPlazoMerval=$(".dropdown-plazo-merval");a.ddlPlazoMerval.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",events:{select:function(b){a.loadTab(a.divMerval,a.divCotizacionMerval,"acciones/1",a.divContainerTreeMapMerval,a.treeMapMerval,a.divPlazoMerval,a.ddlPlazoMerval,Core.Enums.ePanel.AccionesMerval)}},width:150});a.divPlazoMercadoArgentino=$(".div-plazo-mercado-argentino");a.divPlazoMercadoArgentino.hide();a.ddlPlazoMercadoArgentino=$(".dropdown-plazo-mercado-argentino");a.ddlPlazoMercadoArgentino.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",events:{select:function(b){a.loadTab(a.divMercadoArgentino,a.divCotizacionMercadoArgentino,"acciones/3",a.divContainerTreeMapMercadoArgentino,a.treeMapMercadoArgentino,a.divPlazoMercadoArgentino,a.ddlPlazoMercadoArgentino,Core.Enums.ePanel.AccionesMercadoArgentino)}},width:150});a.divPlazoGeneral=$(".div-plazo-general");a.divPlazoGeneral.hide();a.ddlPlazoGeneral=$(".dropdown-plazo-general");a.ddlPlazoGeneral.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",events:{select:function(b){a.loadTab(a.divGeneral,a.divCotizacionGeneral,"acciones/4",a.divContainerTreeMapGeneral,a.treeMapGeneral,a.divPlazoGeneral,a.ddlPlazoGeneral,Core.Enums.ePanel.Acciones)}},width:150});a.divTreeMapMerval=$(".div-treemap-merval");a.divContainerTreeMapMerval=$(".div-container-treemap-merval");a.btnTreeMapMerval=$(".btn-treemap-merval");a.btnTreeMapMerval.click(function(){a.btnTreeMapClick(a.btnTreeMapMerval,a.divContainerTreeMapMerval,a.treeMapMerval,a.ddlPlazoMerval)});a.divTreeMapMercadoArgentino=$(".div-treemap-mercado-argentino");a.divContainerTreeMapMercadoArgentino=$(".div-container-treemap-mercado-argentino");a.btnTreeMapMercadoArgentino=$(".btn-treemap-mercado-argentino");a.btnTreeMapMercadoArgentino.click(function(){a.btnTreeMapClick(a.btnTreeMapMercadoArgentino,a.divContainerTreeMapMercadoArgentino,a.treeMapMercadoArgentino,a.ddlPlazoMercadoArgentino)});a.divTreeMapGeneral=$(".div-treemap-general");a.divContainerTreeMapGeneral=$(".div-container-treemap-general");a.btnTreeMapGeneral=$(".btn-treemap-general");a.btnTreeMapGeneral.click(function(){a.btnTreeMapClick(a.btnTreeMapGeneral,a.divContainerTreeMapGeneral,a.treeMapGeneral,a.ddlPlazoGeneral)});a.btnMerval.on("shown.bs.tab",function(){a.loaded=false;a.refresh=false;a.forceRefresh=false;a.divPlazoMerval.hide();a.loadTab(a.divMerval,a.divCotizacionMerval,"acciones/1",a.divContainerTreeMapMerval,a.treeMapMerval,a.divPlazoMerval,a.ddlPlazoMerval,Core.Enums.ePanel.AccionesMerval)});a.btnMercadoArgentino.on("shown.bs.tab",function(){a.loaded=false;a.refresh=false;a.forceRefresh=false;a.divPlazoMercadoArgentino.hide();a.loadTab(a.divMercadoArgentino,a.divCotizacionMercadoArgentino,"acciones/3",a.divContainerTreeMapMercadoArgentino,a.treeMapMercadoArgentino,a.divPlazoMercadoArgentino,a.ddlPlazoMercadoArgentino,Core.Enums.ePanel.AccionesMercadoArgentino)});a.btnGeneral.on("shown.bs.tab",function(){a.loaded=false;a.refresh=false;a.forceRefresh=false;a.divPlazoGeneral.hide();a.loadTab(a.divGeneral,a.divCotizacionGeneral,"acciones/4",a.divContainerTreeMapGeneral,a.treeMapGeneral,a.divPlazoGeneral,a.ddlPlazoGeneral,Core.Enums.ePanel.Acciones)})};a.loadTab=function(b,c,i,d,h,f,e,g){Core.Functions.grid.Cotizaciones.details=[];a.maxToken=0;a.lastData=null;a.maxTokenIndice=0;a.lastDataIndice=null;if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:0,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(j){}}window.clearInterval(a.timerId);Core.Objects.Context.Timers.remove(a.timerId);window.clearInterval(a.timerIdForceRefresh);Core.Objects.Context.Timers.remove(a.timerIdForceRefresh);Core.Functions.grid.Cotizaciones.loadGrid(b,c,i,a.lastData,a.maxToken,a.lastDataIndice,a.maxTokenIndice,function(k,j){return(!a.loaded||k.plazo==e.swidget().selectedItem().value)},function(m,o,n,p){a.lastData=m;a.maxToken=o;a.lastDataIndice=n;a.maxTokenIndice=p;if(!a.loaded){var q=[];a.lastData.forEach(function(s,r){if(q.indexOf(s.plazo)==-1){q.push(s.plazo)}});var j=[];q.forEach(function(s,r){j.push({value:s,text:s})});var k=e.swidget().initialOptions;k.dataSource.data=j;e.swidget().refresh(k);e.swidget().selected(q.length-1,true);if(q.length>1){f.show()}a.loaded=true;a.refresh=true}var l=b.swidget().initialOptions;l.dataSource.data=$.grep(a.lastData,function(s,r){return s.plazo==e.swidget().selectedItem().value});b.swidget().refresh(l);a.loadTreeMap(d,h,e)},a.optionsCotizaciones.cot_profundidad);a.timerId=window.setInterval(function(){if(a.loaded&&(a.refresh||a.forceRefresh)){Core.Functions.grid.Cotizaciones.loadGrid(b,c,i,a.lastData,a.maxToken,a.lastDataIndice,a.maxTokenIndice,function(k,j){return k.plazo==e.swidget().selectedItem().value},function(j,l,k,m){a.lastData=j;a.maxToken=l;a.lastDataIndice=k;a.maxTokenIndice=m;a.loadTreeMap(d,h,e)},a.optionsCotizaciones.cot_profundidad);a.forceRefresh=false}a.refresh=true},Core.Functions.grid.Cotizaciones.REFRESH_TIME);Core.Objects.Context.Timers.push(a.timerId);a.timerIdForceRefresh=window.setInterval(function(){a.forceRefresh=true},600000);Core.Objects.Context.Timers.push(a.timerIdForceRefresh);if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:g,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(k){if(a.loaded){var j={cotizaciones:[],indice:[]};var l=JSON.parse(k.data);if(l.Product==7){j.indice.push(l)}else{j.cotizaciones.push(l)}Core.Functions.grid.Cotizaciones.refreshGrid(j,b,c,a.lastData,a.maxToken,a.lastDataIndice,a.maxTokenIndice,function(n,m){return n.plazo==e.swidget().selectedItem().value},function(m,o,n,p){a.lastData=m;a.maxToken=o;a.lastDataIndice=n;a.loadTreeMap(d,h,e);a.refresh=false},a.optionsCotizaciones.cot_profundidad)}}}};a.btnTreeMapClick=function(b,c,e,d){b.removeClass("glyphicon-menu-down");b.removeClass("glyphicon-menu-up");if(c.is(":visible")){b.addClass("glyphicon-menu-down");c.hide()}else{c.show();a.loadTreeMap(c,e,d);if(c.is(":visible")){b.addClass("glyphicon-menu-up")}else{b.addClass("glyphicon-menu-down")}}};a.createTreeMaps=function(){a.treeMapMerval=a.createTreeMap(a.divContainerTreeMapMerval,a.divTreeMapMerval);a.treeMapMercadoArgentino=a.createTreeMap(a.divContainerTreeMapMercadoArgentino,a.divTreeMapMercadoArgentino,a.treeMapMercadoArgentino);a.treeMapGeneral=a.createTreeMap(a.divContainerTreeMapGeneral,a.divTreeMapGeneral,a.treeMapGeneral)};a.createTreeMap=function(b,c){b.hide();var d=new google.visualization.TreeMap(c[0]);google.visualization.events.addListener(d,"select",function(){var f=d.getSelection();if(f[0].row!=null){if(f[0].row!=0){var e={};e.defaultTipoOperacion=Core.Enums.eEspeciesTipoOperacion.Compra;e.defaultEspecie=a.treeMapDataTable.getValue(f[0].row,0);e.defaultPlazo=Core.Functions.Plazo.getIDByDescription(a.treeMapDataTable.getValue(f[0].row,6));Core.Business.Operar.Acciones.init(a.idDefaultAccount,a.idDefaultProfile,e)}}});return d};a.loadTreeMap=function(b,f,c){if(a.loaded){var e=[];var d=$.grep(a.lastData,function(h,g){return(h.plazo==c.swidget().selectedItem().value&&h.v>0&&h.f.indexOf(":")>-1)});if(d.length>0){d.forEach(function(j,i){var g={};g.Ticker=j.ticker;g.Descripcion=j.descripcion;g.MontoOperado=j.v;g.Precio=j.u;if(!j.ant||j.ant==0||j.ant==-1||!j.u||j.u==0||j.u==-1){g.Variacion=0}else{var h=j.u-j.ant;g.Variacion=(h/j.ant*100).toFixed(2)}g.Plazo=j.plazo;e.push(g)});if(f!=null){a.updateChart(f,e)}}else{b.hide()}}};a.updateChart=function(e,d){a.treeMapDataTable=new google.visualization.DataTable();a.treeMapDataTable.addColumn("string","Ticker");a.treeMapDataTable.addColumn("string","Parent");a.treeMapDataTable.addColumn("number","MontoOperado");a.treeMapDataTable.addColumn("number","Variacion");a.treeMapDataTable.addColumn("string","Descripcion");a.treeMapDataTable.addColumn("number","Precio");a.treeMapDataTable.addColumn("string","Plazo");a.treeMapDataTable.addRows(d.length+1);a.treeMapDataTable.setCell(0,0,"Global");a.treeMapDataTable.setCell(0,1,null);a.treeMapDataTable.setCell(0,2,0);a.treeMapDataTable.setCell(0,3,0);a.treeMapDataTable.setCell(0,4,"");a.treeMapDataTable.setCell(0,5,0);a.treeMapDataTable.setCell(0,6,"");for(var b=0;b<d.length;b++){a.treeMapDataTable.setCell(b+1,0,d[b].Ticker);a.treeMapDataTable.setCell(b+1,1,"Global");a.treeMapDataTable.setCell(b+1,2,d[b].MontoOperado);a.treeMapDataTable.setCell(b+1,3,d[b].Variacion);a.treeMapDataTable.setCell(b+1,4,d[b].Descripcion);a.treeMapDataTable.setCell(b+1,5,d[b].Precio);a.treeMapDataTable.setCell(b+1,6,d[b].Plazo)}e.draw(a.treeMapDataTable,{minColor:"#f00",midColor:"#ddd",maxColor:"#0d0",minColorValue:-3,maxColorValue:3,headerHeight:0,highlightOnMouseOver:false,textStyle:{color:"black",fontName:"verdana",fontSize:15,bold:true,italic:false},fontColor:"black",showScale:false,generateTooltip:c,maxDepth:1});function c(f,g,h){return'<div style="background:#fd9; padding:10px; border-style:solid"><span style="font-family:Courier"><b>'+a.treeMapDataTable.getValue(f,0)+"</b> | "+a.treeMapDataTable.getValue(f,4)+"</span><br>"+a.treeMapDataTable.getColumnLabel(2)+": $"+a.treeMapDataTable.getValue(f,2)+"<br>"+a.treeMapDataTable.getColumnLabel(3)+": "+a.treeMapDataTable.getValue(f,3)+"%<br>"+a.treeMapDataTable.getColumnLabel(5)+": $"+a.treeMapDataTable.getValue(f,5)+"<br>"+a.treeMapDataTable.getColumnLabel(6)+": "+a.treeMapDataTable.getValue(f,6)+"<br></div>"}}};Core.Business.AccountSettings=new function(){var a=this;a.idDefaultAccount=null;a.idDefaultProfile=null;a.id="account-settings";a.divCuentas=null;a.divGridCuentas=null;a.divCuentasBancariasVinculadas=null;a.divGridCuentasBancariasVinculadas=null;a.btnNewCuentaBancariaVinculada=null;a.divEquiposVinculados=null;a.divGridEquiposVinculados=null;a.lblUserName=null;a.lblUserDocument=null;a.lblUserFiscalIdentifier=null;a.lblUserId=null;a.lblUserEmail=null;a.lblUserPhone=null;a.btnChangePhone=null;a.divTycAprobados=null;a.btnTycAprobados=null;a.divServiciosAprobados=null;a.divDatosAsesorProductor=null;a.lblDatosAsesorProductor=null;a.lblLinkAperturaFisicaArgentina=null;a.btnLinkAperturaFisicaArgentina=null;a.lblLinkAperturaJuridicaArgentina=null;a.btnLinkAperturaJuridicaArgentina=null;a.lblLinkAperturaFisicaArgentinaInternacional=null;a.btnLinkAperturaFisicaArgentinaInternacional=null;a.lblLinkAperturaJuridicaArgentinaInternacional=null;a.btnLinkAperturaJuridicaArgentinaInternacional=null;a.divLinkBalanzConnect=null;a.lblLinkBalanzConnect=null;a.btnLinkBalanzConnect=null;a.documentTypes={"1":"DNI","2":"CI","3":"LE","4":"LC","5":"PAS"};a.init=function(b,c){Core.loadPage("account-settings.html",function(){document.title="Configuración de Cuenta";a.idDefaultAccount=b;a.idDefaultProfile=c;a.divCuentas=$(".div-detalle-cuentas");a.divGridCuentas=$(".div-cuentas");a.divCuentasBancariasVinculadas=$(".div-cuentas-bancarias-vinculadas");a.divGridCuentasBancariasVinculadas=$(".div-grid-cuentas-bancarias-vinculadas");a.btnNewCuentaBancariaVinculada=$(".btn-nueva-cuenta-bancaria");a.divEquiposVinculados=$(".div-equipos-vinculados");a.divGridEquiposVinculados=$(".div-grid-equipos-vinculados");a.lblUserName=$(".usuario-name");a.lblUserDocument=$(".usuario-documento");a.lblUserFiscalIdentifier=$(".usuario-fiscal-identifier");a.lblUserId=$(".usuario-id");a.lblUserEmail=$(".usuario-email");a.lblUserPhone=$(".usuario-phone");a.btnChangePhone=$(".btn-cambio-phone");a.divTycAprobados=$(".div-tyc-aprobados");a.divTycAprobados.hide();a.btnTycAprobados=$(".btn-tyc-aprobados");a.divServiciosAprobados=$(".div-servicios-aprobados");a.divServiciosAprobados.hide();a.divDatosAsesorProductor=$(".div-datos-asesor-productor");a.lblDatosAsesorProductor=$(".lbl-datos-asesor-productor");a.divLinksAperturasArgentina=$(".div-links-aperturas-argentina");a.divLinkAperturaFisicaArgentina=$(".div-link-apertura-fisica-argentina");a.lblLinkAperturaFisicaArgentina=$(".lbl-link-apertura-fisica-argentina");a.btnLinkAperturaFisicaArgentina=$(".btn-link-apertura-fisica-argentina");a.btnQRAperturaFisicaArgentina=$(".btn-qr-apertura-fisica-argentina");a.divLinkAperturaJuridicaArgentina=$(".div-link-apertura-juridica-argentina");a.lblLinkAperturaJuridicaArgentina=$(".lbl-link-apertura-juridica-argentina");a.btnLinkAperturaJuridicaArgentina=$(".btn-link-apertura-juridica-argentina");a.btnQRAperturaJuridicaArgentina=$(".btn-qr-apertura-juridica-argentina");a.divLinksAperturasInternacional=$(".div-links-aperturas-internacional");a.divLinkAperturaFisicaInternacional=$(".div-link-apertura-fisica-internacional");a.lblLinkAperturaFisicaInternacional=$(".lbl-link-apertura-fisica-internacional");a.btnLinkAperturaFisicaInternacional=$(".btn-link-apertura-fisica-internacional");a.btnQRAperturaFisicaInternacional=$(".btn-qr-apertura-fisica-internacional");a.divLinkAperturaJuridicaInternacional=$(".div-link-apertura-juridica-internacional");a.lblLinkAperturaJuridicaInternacional=$(".lbl-link-apertura-juridica-internacional");a.btnLinkAperturaJuridicaInternacional=$(".btn-link-apertura-juridica-internacional");a.btnQRAperturaJuridicaInternacional=$(".btn-qr-apertura-juridica-internacional");a.divLinkBalanzConnect=$(".div-link-balanz-connect");a.lblLinkBalanzConnect=$(".lbl-link-balanz-connect");a.btnLinkBalanzConnect=$(".btn-link-balanz-connect");a.setLabels();a.setEvents();if(Core.Objects.Context.Configuration.idAplicacion==1){a.initGridCuentas()}else{a.divCuentas.hide()}a.initGridEquiposVinculados();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(Core.Objects.Context.Configuration.idAplicacion==1,a.idDefaultAccount,a.idDefaultProfile,function(){if(Core.Objects.Context.Configuration.idAplicacion==1){a.loadGridCuentas()}Core.Functions.grid.Cbus.initGridCuentasBancariasVinculadas(a.divCuentasBancariasVinculadas,null,Core.Objects.Context.IdPersona,Core.Objects.Context.FiscalIdentifier,function(d){if(d.tyc&&d.tyc[0]){a.btnTycAprobados.text("Términos y condiciones vigentes (Aceptados "+d.tyc[0].Fecha+")");a.btnTycAprobados.attr("href",d.tyc[0].URL);a.divTycAprobados.show()}if(d.servicios&&d.servicios.length){d.servicios.forEach(function(g,f){var e=$('<div class="pad0 col-md-12 col-sm-12" style="margin-top:10px;"></div>').appendTo(a.divServiciosAprobados);$('<i class="glyphicon glyphicon-file"></i><a target="_blank" href="'+g.URL+'">'+g.Descripcion+" (Aceptados "+g.Fecha+")</a>").appendTo(e)});a.divServiciosAprobados.show()}a.refreshGridEquiposVinculados(((d&&d.dispositivos)?d.dispositivos:[]));a.setLinks(d)})},"Core.Business.AccountSettings")})};a.setLabels=function(){a.lblUserName.text(Core.Objects.Context.Nombre);a.lblUserEmail.text(Core.Objects.Context.Email);a.lblUserPhone.text(Core.Objects.Context.Mobile);a.lblUserId.text(Core.Objects.Context.User);var b=Core.Objects.Context.FiscalIdentifier;if(b.length==11){b=b.substr(0,2)+"-"+b.substr(2,8)+"-"+b.substr(10,1)}a.lblUserFiscalIdentifier.text(b);a.lblUserDocument.text(Core.Objects.Context.DocumentNumber)};a.setEvents=function(){$(".btn-cambio-clave").click(function(){var b=new Core.Business.AccountSettings.ChangePassword().show()});a.btnChangePhone.click(function(){var b=new Core.Business.AccountSettings.ChangePhone({actualPhone:Core.Objects.Context.Mobile,onChanged:function(c){a.lblUserPhone.text(c)}}).show()});$(".btn-cambio-usuario").click(function(){var b=new Core.Business.AccountSettings.ChangeUser({onChanged:function(c){a.lblUserId.text(c)}}).show()});$(".btn-cambio-email").click(function(){if(Core.Objects.Context.Mobile){var b=new Core.Business.AccountSettings.ChangeEmail({actualEmail:Core.Objects.Context.Email}).show()}else{var c="Debe ingresar su teléfono celular para poder "+((Core.Objects.Context.Email)?"cambiar ":"ingresar ")+"su email. Para ingresarlo haga <a onclick=\"$('.close-btn').click(); $('.btn-cambio-phone').click();\">Click Aquí.</a></p>";new Core.Controls.Dialog("Aviso",c,{displayButtons:{close:true,accept:false}}).show()}});if(Core.Objects.Context.TieneC4D==1){$(".btn-codigo-operacion").html("CODIGO DE OPERACION")}else{$(".btn-codigo-operacion").html("GENERAR CODIGO DE OPERACION")}$(".btn-codigo-operacion").click(function(){if(Core.Objects.Context.Mobile){var b=new Core.Business.AccountSettings.GenerateOperationCode({onChanged:function(){$(".btn-codigo-operacion").html("CODIGO DE OPERACION")}}).show()}else{var c="Debe ingresar su teléfono celular para poder "+((Core.Objects.Context.TieneC4D==1)?"cambiar ":"generar ")+"su codigo de operación. Para ingresarlo haga <a onclick=\"$('.close-btn').click(); $('.btn-cambio-phone').click();\">Click Aquí.</a></p>";new Core.Controls.Dialog("Aviso",c,{displayButtons:{close:true,accept:false}}).show()}});a.btnLinkAperturaFisicaArgentina.on("click",function(){Core.Functions.Clipboard.copy(a.lblLinkAperturaFisicaArgentina.text());new Core.Controls.Dialog("Aviso","Se copió el link a apertura Argentina de cuenta de persona física.",{displayButtons:{close:true,accept:false}}).show()});a.btnQRAperturaFisicaArgentina.on("click",function(){new Core.Business.ReporteListadoAsesores.Link({title:"Link Apertura Argentina Física",link:a.lblLinkAperturaFisicaArgentina.text()}).show()});a.btnLinkAperturaJuridicaArgentina.on("click",function(){Core.Functions.Clipboard.copy(a.lblLinkAperturaJuridicaArgentina.text());new Core.Controls.Dialog("Aviso","Se copió el link a apertura Argentina de cuenta de persona jurídica.",{displayButtons:{close:true,accept:false}}).show()});a.btnQRAperturaJuridicaArgentina.on("click",function(){new Core.Business.ReporteListadoAsesores.Link({title:"Link Apertura Argentina Jurídica",link:a.lblLinkAperturaJuridicaArgentina.text()}).show()});a.btnLinkAperturaFisicaInternacional.on("click",function(){Core.Functions.Clipboard.copy(a.lblLinkAperturaFisicaInternacional.text());new Core.Controls.Dialog("Aviso","Se copió el link a apertura internacional de cuenta de persona física.",{displayButtons:{close:true,accept:false}}).show()});a.btnQRAperturaFisicaInternacional.on("click",function(){new Core.Business.ReporteListadoAsesores.Link({title:"Link Apertura Internacional Física",link:a.lblLinkAperturaFisicaInternacional.text()}).show()});a.btnLinkAperturaJuridicaInternacional.on("click",function(){Core.Functions.Clipboard.copy(a.lblLinkAperturaJuridicaInternacional.text());new Core.Controls.Dialog("Aviso","Se copió el link a apertura internacional de cuenta de persona jurídica.",{displayButtons:{close:true,accept:false}}).show()});a.btnQRAperturaJuridicaInternacional.on("click",function(){new Core.Business.ReporteListadoAsesores.Link({title:"Link Apertura Internacional Jurídica",link:a.lblLinkAperturaJuridicaInternacional.text()}).show()});a.btnLinkBalanzConnect.on("click",function(){Core.Functions.Clipboard.copy(a.lblLinkBalanzConnect.text());new Core.Controls.Dialog("Aviso","Se copió el link a Balanz Connect.",{displayButtons:{close:true,accept:false}}).show()})};a.initGridCuentas=function(){a.divGridCuentas.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},columns:[{width:"50%",field:"Descripcion",title:"Cuenta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"15%",field:"NumComitente",title:"Comitente",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"15%",field:"NumCuotapartista",title:"Cuotapartista",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"12%",field:"tipo",title:"Relación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:135,title:" ",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(d,e,g){var b=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(d);b.on("click",function(){Core.Functions.grid.AccountDetails.showDetailsByIdAccount(e,false,false)});if(e.Juridica){var b=$('<button type="button" title="Cuentas vinculadas" class="btn-sm balanz-button"><img src="/images/ico-bank-white.png" width="22"></button>').appendTo(d);b.on("click",function(){var i=$(".div-cbus");i.find(".modal-title").html("Cuentas vinculadas para la cuenta "+e.idCuenta);Core.Functions.grid.Cbus.initGridCuentasBancariasVinculadas(i,e.idCuenta,null,null);i.modal({show:true})})}if(Core.Objects.Context.TestInversor){var h=$.grep(Core.Objects.Context.TestInversor.juridicas,function(j,i){return j.idCuenta==e.idCuenta})[0];if(h){var f=['<button type="button" title="Test Inversor" class="btn-sm balanz-button" style="padding: 5px 0; background-color: red; border-color: red;"><img src="/images/ico-perfil-white.png" width="22"></button>','<button type="button" title="Test Inversor" class="btn-sm balanz-button" style="padding: 5px 0;"><img src="/images/ico-conservador-white.png" width="22"></button>','<button type="button" title="Test Inversor" class="btn-sm balanz-button" style="padding: 5px 0;"><img src="/images/ico-moderado-white.png" width="22"></button>','<button type="button" title="Test Inversor" class="btn-sm balanz-button" style="padding: 5px 0;"><img src="/images/ico-agresivo-white.png" width="22"></button>','<button type="button" title="Test Inversor" class="btn-sm balanz-button" style="padding: 5px 0; background-color: red; border-color: red;"><img src="/images/ico-perfil-white.png" width="22"></button>','<button type="button" title="Test Inversor" class="btn-sm balanz-button" style="padding: 5px 0;"><img src="/images/ico-muyagresivo-white.png" width="22"></button>','<button type="button" title="Test Inversor" class="btn-sm balanz-button" style="padding: 5px 0;"><img src="/images/ico-calificado-white.png" width="22"></button>'];var c=$(f[h.idPerfil]).appendTo(d);c.on("click",function(){if(!h.EsCalificada){if(h.idPerfil&&h.idPerfil!=Core.Enums.eTestInversorPerfil.Error){Core.Business.TestInversorResultado.init(a.idDefaultAccount,a.idDefaultProfile,{idCuenta:h.idCuenta})}else{Core.Business.TestInversorCuestionario.init(a.idDefaultAccount,a.idDefaultProfile,{idCuenta:h.idCuenta})}}})}}}}]})};a.initGridEquiposVinculados=function(){var b=[];b.push({field:"Nombre",title:"Nombre",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"SistemaOperativo",title:"Sistema Operativo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"FechaAlta",title:"Fecha de Alta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,e,f){var c=$('<button type="button" title="Eliminar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-log-out"></span></button>').appendTo(d);c.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Estás seguro que querés salir de tu sesión en este dispositivo ("+e.Nombre+")? Tené en cuenta que dejarás de recibir notificaciones.",{onAccepted:function(){var g=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"datos/eliminar",requestType:"POST",requestData:{valor:e.idDispositivo,campo:"dispositivo"}});g.onSuccess=function(h){new Core.Controls.Dialog("Mensaje","Su dispositivo ha sido desvinculado exitosamente.",{displayButtons:{close:true,accept:false}}).show();a.loadGridEquiposVinculados()};g.request()}}).show()})}});a.divGridEquiposVinculados.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},columns:b,noRecordsText:"No se encontraron equipos vinculados."})};a.loadGridCuentas=function(){var b=a.divGridCuentas.swidget().initialOptions;b.dataSource.data=Core.Objects.Accounts?Core.Objects.Accounts:[];a.divGridCuentas.swidget().refresh(b)};a.loadGridEquiposVinculados=function(){var b=new Core.Ajax.ServerRequest({showOverlay:true,requestUrl:("usuario/"+encodeURIComponent(Core.Objects.Context.IdPersona)+"/detalle"),requestType:"GET"});b.onSuccess=function(c){a.refreshGridEquiposVinculados(((c&&c.dispositivos)?c.dispositivos:[]))};b.request()};a.refreshGridEquiposVinculados=function(b){var c=a.divGridEquiposVinculados.swidget().initialOptions;c.dataSource.data=b;a.divGridEquiposVinculados.swidget().refresh(c)};a.setLinks=function(b){a.divLinkBalanzConnect.hide();if(Core.Objects.Context.Configuration.idAplicacion==8){a.divLinkBalanzConnect.show()}a.divDatosAsesorProductor.hide();if(b&&b.datosasesor&&b.datosasesor[0]&&(Core.Objects.Context.Configuration.idAplicacion==0||Core.Objects.Context.Configuration.idAplicacion==8)){a.lblDatosAsesorProductor.text(Core.Objects.Context.Configuration.idAplicacion==0?"Datos del Asesor":"Datos del Productor");a.divLinksAperturasArgentina.hide();a.setLink(a.divLinkAperturaFisicaArgentina,a.lblLinkAperturaFisicaArgentina,b.datosasesor[0].LinkAperturaFisica);a.setLink(a.divLinkAperturaJuridicaArgentina,a.lblLinkAperturaJuridicaArgentina,b.datosasesor[0].LinkAperturaJuridica);if(b.datosasesor[0].LinkAperturaFisica||b.datosasesor[0].LinkAperturaJuridica){a.divLinksAperturasArgentina.show()}a.divLinksAperturasInternacional.hide();a.setLink(a.divLinkAperturaFisicaInternacional,a.lblLinkAperturaFisicaInternacional,b.datosasesor[0].LinkAperturaBCIFisica);a.setLink(a.divLinkAperturaJuridicaInternacional,a.lblLinkAperturaJuridicaInternacional,b.datosasesor[0].LinkAperturaBCIJuridica);if(b.datosasesor[0].LinkAperturaBCIFisica||b.datosasesor[0].LinkAperturaBCIJuridica){a.divLinksAperturasInternacional.show()}a.divDatosAsesorProductor.show()}};a.setLink=function(b,c,d){b.hide();c.text("");if(d){c.text(d);b.show()}}};Core.Business.AccountSettings.ChangePassword=function(){var a=this;a.divModalCambioDatos=$(".cambio-datos");a.txtActualPass=null;a.capslockWarningActualPass=null;a.txtNewPass1=null;a.capslockWarningNewPass1=null;a.txtNewPass2=null;a.capslockWarningNewPass2=null;a.divAlert=null;a.show=function(){a.divModalCambioDatos.find(".div-title").html("CAMBIO DE CLAVE");a.divModalCambioDatos.find(".div-cambio-email").hide();a.divModalCambioDatos.find(".div-cambio-phone").hide();a.divModalCambioDatos.find(".div-cambio-usuario").hide();a.divModalCambioDatos.find(".div-cambio-tipo-envio-codigo").hide();a.divModalCambioDatos.find(".div-cambio-clave").show();a.divModalCambioDatos.find(".div-new-operation-code").hide();a.txtActualPass=a.divModalCambioDatos.find(".txt-pass");a.capslockWarningActualPass=new Core.Controls.CapslockWarning(a.txtActualPass);a.txtNewPass1=a.divModalCambioDatos.find(".txt-new-pass1");a.txtNewPass2=a.divModalCambioDatos.find(".txt-new-pass2");a.capslockWarningNewPass2=new Core.Controls.CapslockWarning(a.txtNewPass2);a.divAlert=a.divModalCambioDatos.find(".login-alert");a.txtActualPass.val("");a.txtNewPass1.val("");a.txtNewPass1.closest(".input-group, .form-group").removeClass("has-success has-error");a.txtNewPass2.val("");a.txtNewPass2.closest(".input-group, .form-group").removeClass("has-success has-error");a.divModalCambioDatos.find(".password_strength").remove();a.txtNewPass1.password_strength();Core.Functions.Validations.toggleValidation(a.txtNewPass1,false);Core.Functions.Validations.toggleValidation(a.txtNewPass2,false);a.divAlert.slideUp();Core.Functions.changePassword.setPasswordsControl(a.txtNewPass1,a.txtNewPass2);a.divModalCambioDatos.find(".btn-cambio-datos-confirmar").unbind("click");a.divModalCambioDatos.find(".btn-cambio-datos-confirmar").click(function(){Core.Functions.Validations.toggleValidation(a.txtNewPass1,false);Core.Functions.Validations.toggleValidation(a.txtNewPass2,false);a.divAlert.slideUp();if(!Core.Functions.changePassword.isValidPasswords(a.txtNewPass1,a.txtNewPass2,a.divAlert)){return}var b=new Core.Ajax.ServerRequest({overlatElement:a.divModalCambioDatos.find(".btn-cambio-datos-confirmar"),secureRequest:true,requestUrl:"datos/usuario",requestType:"POST",requestData:{campo:"clave",valor:a.txtNewPass1.val(),passActual:a.txtActualPass.val(),user:Core.Objects.Context.User}});b.onSuccess=function(c){a.divModalCambioDatos.modal("hide");new Core.Controls.Dialog("Aviso","Clave modificada correctamente.",{displayButtons:{close:true,accept:false}}).show()};b.request()});a.divModalCambioDatos.unbind("shown.bs.modal");a.divModalCambioDatos.on("shown.bs.modal",function(){a.txtActualPass.focus()});a.divModalCambioDatos.unbind("hidden.bs.modal");a.divModalCambioDatos.on("hidden.bs.modal",function(){a.capslockWarningActualPass.destroy();a.capslockWarningNewPass2.destroy()});a.divModalCambioDatos.modal({show:true})}};Core.Business.AccountSettings.ChangePhone=function(b){var a=this;a.actualPhone=null;a.divModalCambioDatos=$(".cambio-datos");a.txtNewPhone=null;a.txtNewPhonePrefix=null;a.ddlCountryCode=null;a.txtNewPhoneCountry=null;a.lblPrefixsArg=null;a.txtPass=null;a.divAlert=null;a.onChanged=function(c){};a.btnEnvioLlamada=null;a.btnEnvioMensaje=null;a.llamadaVoz=0;$.extend(true,a,b);a.show=function(){a.divModalCambioDatos.find(".div-title").html("CAMBIO DE TELEFONO");a.divModalCambioDatos.find(".div-cambio-email").hide();a.divModalCambioDatos.find(".div-cambio-phone").show();a.divModalCambioDatos.find(".div-cambio-usuario").hide();a.divModalCambioDatos.find(".div-cambio-clave").hide();a.divModalCambioDatos.find(".div-new-operation-code").hide();a.divModalCambioDatos.find(".div-cambio-tipo-envio-codigo").show();a.divModalCambioDatos.find(".lbl-cambio-tipo-envio-codigo").html("Seleccioná la manera en que querés recibir el código númerico de 6 dígitos para validar esta operación:<br/><br/>");a.txtNewPhone=a.divModalCambioDatos.find(".txt-new-phone");a.txtNewPhonePrefix=a.divModalCambioDatos.find(".txt-new-phone-prefix");a.ddlCountryCode=a.divModalCambioDatos.find(".dropdown-country-code");a.txtNewPhoneCountry=a.divModalCambioDatos.find(".txt-new-phone-country");a.txtPass=a.divModalCambioDatos.find(".txt-pass");a.lblPrefixsArg=a.divModalCambioDatos.find(".lbl-prefixs-arg");a.txtNewPhonePrefix.val("");a.txtNewPhone.val("");a.txtPass.val("");a.divAlert=a.divModalCambioDatos.find(".login-alert");Core.Functions.Validations.toggleValidation(a.txtNewPhone,false);Core.Functions.Validations.toggleValidation(a.txtNewPhonePrefix,false);Core.Functions.Validations.toggleValidation(a.ddlCountryCode,false);Core.Functions.Validations.toggleValidation(a.txtPass,false);Core.Functions.Validations.toggleValidation(a.txtNewPhoneCountry,false);a.divAlert.slideUp();var c=$.grep(Core.Objects.Contry,function(f,e){return f.iso_code=="AR"})[0].phone_code;var d="Otro";a.ddlCountryCode.append($("<option/>",{value:d,text:d}));Core.Objects.Contry.forEach(function(e){a.ddlCountryCode.append($("<option/>",{value:e.phone_code,text:"(+"+e.phone_code+") "+e.name}))});a.ddlCountryCode.unbind("change");a.ddlCountryCode.change(function(){a.txtNewPhoneCountry.hide();if(a.ddlCountryCode.val()!=c){a.txtNewPhonePrefix.hide();a.lblPrefixsArg.hide();if(a.ddlCountryCode.val()==d){a.txtNewPhone.css({width:"50%"});a.txtNewPhoneCountry.show()}else{a.txtNewPhone.css({width:"75%"})}}else{a.txtNewPhonePrefix.show();a.lblPrefixsArg.show();a.txtNewPhone.css({width:"49%"})}});a.ddlCountryCode.val(c);a.ddlCountryCode.change();a.btnEnvioLlamada=a.divModalCambioDatos.find(".btn-envio-llamada");a.btnEnvioLlamada.unbind("click");a.btnEnvioLlamada.click(function(){a.btnEnvioMensaje.removeClass("active");a.llamadaVoz=1});a.btnEnvioMensaje=a.divModalCambioDatos.find(".btn-envio-mensaje");a.btnEnvioMensaje.unbind("click");a.btnEnvioMensaje.click(function(){a.btnEnvioLlamada.removeClass("active");a.llamadaVoz=0});a.btnEnvioMensaje.addClass("active");a.btnEnvioLlamada.removeClass("active");a.divModalCambioDatos.find(".btn-cambio-datos-confirmar").unbind("click");a.divModalCambioDatos.find(".btn-cambio-datos-confirmar").click(function(){if(a.validData()){var e="+"+((a.ddlCountryCode.val()!=d)?a.ddlCountryCode.val().toString():a.txtNewPhoneCountry.val())+((a.ddlCountryCode.val()==c)?a.txtNewPhonePrefix.val():"")+a.txtNewPhone.val();var f=new Core.Ajax.ServerRequest({overlayElement:a.divModalCambioDatos.find(".btn-cambio-datos-confirmar"),secureRequest:true,requestUrl:"datos/usuario",requestType:"POST",requestData:{campo:"sms",valor:e,passActual:a.txtPass.val(),user:Core.Objects.Context.User,LlamadaVoz:a.llamadaVoz}});f.onSuccess=function(g){new Core.Controls.Prompt("Confirmación del Cambio de Teléfono","Ingrese el código recibido",{onAccepted:function(h){var i=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"datos/confirmar",requestType:"POST",requestData:{codigo:h}});i.onSuccess=function(j){Core.Objects.Context.Mobile=e;if(!Core.Functions.Validations.isBlockedStorage()&&Core.Functions.Persistence.getStorage()){Core.Functions.Persistence.getStorage().setItem("CoreContext",LZString.compressToUTF16(JSON.stringify(Core.Objects.Context)))}a.divModalCambioDatos.modal("hide");new Core.Controls.Dialog("Aviso","Teléfono modificado correctamente.",{displayButtons:{close:true,accept:false}}).show();a.onChanged(e)};i.request()}}).show()};f.request()}});a.divModalCambioDatos.unbind("shown.bs.modal");a.divModalCambioDatos.on("shown.bs.modal",function(){a.ddlCountryCode.focus()});a.divModalCambioDatos.unbind("hidden.bs.modal");a.divModalCambioDatos.on("hidden.bs.modal",function(){a.ddlCountryCode.empty()});a.divModalCambioDatos.modal({show:true})};a.validData=function(){var e=$.grep(Core.Objects.Contry,function(i,h){return i.iso_code=="AR"})[0].phone_code;var f="Otro";Core.Functions.Validations.toggleValidation(a.ddlCountryCode,false);Core.Functions.Validations.toggleValidation(a.txtNewPhone,false);Core.Functions.Validations.toggleValidation(a.txtNewPhonePrefix,false);Core.Functions.Validations.toggleValidation(a.txtPass,false);Core.Functions.Validations.toggleValidation(a.txtNewPhoneCountry,false);a.divAlert.slideUp();var g=/^[0-9]+$/;if(!a.ddlCountryCode.val()){Core.Functions.Validations.toggleValidation(a.ddlCountryCode,true);return false}if(a.ddlCountryCode.val()==e){if(!a.txtNewPhonePrefix.val()||!g.test(a.txtNewPhonePrefix.val())||a.txtNewPhonePrefix.val().length>4||a.txtNewPhonePrefix.val().length<2){a.divAlert.text("El prefijo ingresado debe contener entre 2 y 4 caracteres numéricos.");a.divAlert.slideDown();Core.Functions.Validations.toggleValidation(a.txtNewPhonePrefix,true);return false}}if(a.ddlCountryCode.val()==e){if(!a.txtNewPhonePrefix.val()||!g.test(a.txtNewPhonePrefix.val())||a.txtNewPhonePrefix.val().length>4||a.txtNewPhonePrefix.val().length<2){a.divAlert.text("El prefijo ingresado debe contener entre 2 y 4 caracteres numéricos.");a.divAlert.slideDown();Core.Functions.Validations.toggleValidation(a.txtNewPhonePrefix,true);return false}}if(a.ddlCountryCode.val()==f){if(!a.txtNewPhoneCountry.val()||!g.test(a.txtNewPhoneCountry.val())){a.divAlert.text("Debe ingresar el código del país.");a.divAlert.slideDown();Core.Functions.Validations.toggleValidation(a.txtNewPhoneCountry,true);return false}}if(!a.txtNewPhone.val()||!g.test(a.txtNewPhone.val())||(a.ddlCountryCode.val()==e&&(a.txtNewPhone.val().length>8||a.txtNewPhone.val().length<6))){var c="El teléfono ingresado debe contener solo caracteres numéricos.";c=c+((a.ddlCountryCode.val()==e)?" (Entre 6 y 8 caracteres)":"");a.divAlert.text(c);a.divAlert.slideDown();Core.Functions.Validations.toggleValidation(a.txtNewPhone,true);return false}if(a.ddlCountryCode.val()==e&&(a.txtNewPhonePrefix.val().length+a.txtNewPhone.val().length)!=10){a.divAlert.text("El teléfono ingresado debe tener un total de 10 caracteres numéricos");a.divAlert.slideDown();Core.Functions.Validations.toggleValidation(a.txtNewPhone,true);Core.Functions.Validations.toggleValidation(a.txtNewPhonePrefix,true);return false}var d="+"+((a.ddlCountryCode.val()!=f)?a.ddlCountryCode.val().toString():a.txtNewPhoneCountry.val())+((a.ddlCountryCode.val()==e)?a.txtNewPhonePrefix.val():"")+a.txtNewPhone.val();if(a.ddlCountryCode.val()!=e&&!libphonenumber.isValidNumber(d)){a.divAlert.text("El teléfono ingresado no es válido.");a.divAlert.slideDown();Core.Functions.Validations.toggleValidation(a.ddlCountryCode,true);Core.Functions.Validations.toggleValidation(a.txtNewPhone,true);Core.Functions.Validations.toggleValidation(a.txtNewPhonePrefix,true);return false}if(!a.txtPass.val()){Core.Functions.Validations.toggleValidation(a.txtPass,true);return false}return true}};Core.Business.AccountSettings.ChangeEmail=function(b){var a=this;a.divModalCambioDatos=$(".cambio-datos");a.actualEmail=null;a.txtNewEmail=null;a.txtPass=null;a.divAlert=null;a.onChanged=function(c){};a.btnEnvioLlamada=null;a.btnEnvioMensaje=null;a.llamadaVoz=0;$.extend(true,a,b);a.show=function(){a.divModalCambioDatos.find(".div-title").html("CAMBIO DE EMAIL");a.divModalCambioDatos.find(".div-cambio-email").show();a.divModalCambioDatos.find(".div-cambio-phone").hide();a.divModalCambioDatos.find(".div-cambio-usuario").hide();a.divModalCambioDatos.find(".div-cambio-clave").hide();a.divModalCambioDatos.find(".div-new-operation-code").hide();a.txtNewEmail=a.divModalCambioDatos.find(".txt-new-email");a.txtPass=a.divModalCambioDatos.find(".txt-pass");a.txtNewEmail.val(a.actualEmail);a.txtPass.val("");a.divAlert=a.divModalCambioDatos.find(".login-alert");Core.Functions.Validations.toggleValidation(a.txtNewEmail,false);Core.Functions.Validations.toggleValidation(a.txtPass,false);a.divModalCambioDatos.find(".lbl-cambio-tipo-envio-codigo").html("Enviaremos al celular registrado una clave de verificación de 6 dígitos para validar esta operación.<br/>Seleccione la manera en que desea recibirla:<br/><br/>");a.btnEnvioLlamada=a.divModalCambioDatos.find(".btn-envio-llamada");a.btnEnvioLlamada.unbind("click");a.btnEnvioLlamada.click(function(){a.btnEnvioMensaje.removeClass("active");a.llamadaVoz=1});a.btnEnvioMensaje=a.divModalCambioDatos.find(".btn-envio-mensaje");a.btnEnvioMensaje.unbind("click");a.btnEnvioMensaje.click(function(){a.btnEnvioLlamada.removeClass("active");a.llamadaVoz=0});a.btnEnvioMensaje.addClass("active");a.btnEnvioLlamada.removeClass("active");a.divAlert.slideUp();a.divModalCambioDatos.find(".btn-cambio-datos-confirmar").unbind("click");a.divModalCambioDatos.find(".btn-cambio-datos-confirmar").click(function(){if(a.validData()&&a.txtNewEmail.val()!=a.actualEmail){var c=new Core.Ajax.ServerRequest({overlayElement:a.divModalCambioDatos.find(".btn-cambio-datos-confirmar"),secureRequest:true,requestUrl:"datos/usuario",requestType:"POST",requestData:{campo:"email",valor:a.txtNewEmail.val(),passActual:a.txtPass.val(),user:Core.Objects.Context.User,LlamadaVoz:a.llamadaVoz}});c.onSuccess=function(d){new Core.Controls.Prompt("Confirmación del Cambio de Email","Ingrese el código recibido",{onAccepted:function(e){var f=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"datos/confirmar",requestType:"POST",requestData:{codigo:e}});f.onSuccess=function(g){a.divModalCambioDatos.modal("hide");new Core.Controls.Dialog("Aviso",((g&&g.Descripcion)?g.Descripcion:"Se ha enviado un mail a la casilla, debe ingresar para confirmar el cambio."),{displayButtons:{close:true,accept:false}}).show();a.onChanged(a.txtNewEmail.val());window.setInterval(function(){Core.Business.Logout.logout()},60000)};f.request()}}).show()};c.request()}});a.divModalCambioDatos.unbind("shown.bs.modal");a.divModalCambioDatos.on("shown.bs.modal",function(){a.txtNewEmail.focus()});a.divModalCambioDatos.modal({show:true})};a.validData=function(){Core.Functions.Validations.toggleValidation(a.txtNewEmail,false);Core.Functions.Validations.toggleValidation(a.txtPass,false);a.divAlert.slideUp();if(!a.txtNewEmail.val()||!Core.Functions.Validations.isEmail(a.txtNewEmail.val())){Core.Functions.Validations.toggleValidation(a.txtNewEmail,true);return false}if(!a.txtPass.val()){Core.Functions.Validations.toggleValidation(a.txtPass,true);return false}return true}};Core.Business.AccountSettings.ChangeUser=function(b){var a=this;a.divModalCambioDatos=$(".cambio-datos");a.txtNewUser=null;a.txtPass=null;a.divAlert=null;a.onChanged=function(c){};$.extend(true,a,b);a.show=function(){a.divModalCambioDatos.find(".div-title").html("CAMBIO DE USUARIO");a.divModalCambioDatos.find(".div-cambio-email").hide();a.divModalCambioDatos.find(".div-cambio-phone").hide();a.divModalCambioDatos.find(".div-cambio-usuario").show();a.divModalCambioDatos.find(".div-cambio-clave").hide();a.divModalCambioDatos.find(".div-new-operation-code").hide();a.divModalCambioDatos.find(".div-cambio-tipo-envio-codigo").hide();a.txtNewUser=a.divModalCambioDatos.find(".txt-new-user");a.txtNewUser.unbind("focusout");a.txtNewUser.on("focusout",function(){a.validUser(null)});a.txtPass=a.divModalCambioDatos.find(".txt-pass");a.txtNewUser.val("");a.txtPass.val("");a.divAlert=a.divModalCambioDatos.find(".login-alert");Core.Functions.Validations.toggleValidation(a.txtNewUser,false);a.txtNewUser.closest(".input-group, .form-group").removeClass("has-success");Core.Functions.Validations.toggleValidation(a.txtPass,false);a.divAlert.slideUp();a.divModalCambioDatos.find(".btn-cambio-datos-confirmar").unbind("click");a.divModalCambioDatos.find(".btn-cambio-datos-confirmar").click(function(){Core.Functions.Validations.toggleValidation(a.txtNewUser,false);a.txtNewUser.closest(".input-group, .form-group").removeClass("has-success");Core.Functions.Validations.toggleValidation(a.txtPass,false);a.divAlert.slideUp();if(!a.txtPass.val()){Core.Functions.Validations.toggleValidation(a.txtPass,true)}else{a.validUser(function(){var c=new Core.Ajax.ServerRequest({overlayElement:a.divModalCambioDatos.find(".btn-cambio-datos-confirmar"),secureRequest:true,requestUrl:"datos/usuario",requestType:"POST",requestData:{campo:"usuario",valor:a.txtNewUser.val(),passActual:a.txtPass.val(),user:Core.Objects.Context.User}});c.onSuccess=function(d){a.divModalCambioDatos.modal("hide");Core.Objects.Context.User=a.txtNewUser.val();if(!Core.Functions.Validations.isBlockedStorage()&&Core.Functions.Persistence.getStorage()){Core.Functions.Persistence.getStorage().setItem("CoreContext",LZString.compressToUTF16(JSON.stringify(Core.Objects.Context)))}new Core.Controls.Dialog("Aviso","Usuario modificado correctamente.",{displayButtons:{close:true,accept:false}}).show();a.onChanged(a.txtNewUser.val())};c.request()})}});a.divModalCambioDatos.unbind("shown.bs.modal");a.divModalCambioDatos.on("shown.bs.modal",function(){a.txtNewUser.focus()});a.divModalCambioDatos.modal({show:true})};a.validUser=function(c){var f=a.txtNewUser.val();var d=/^[0-9a-zA-Z.]+$/;if(f.length<6||f.length>20||!d.test(f)){Core.Functions.Validations.toggleValidation(a.txtNewUser,true);a.divAlert.text("El usuario debe contener entre 6 y 20 caracteres alfanuméricos.");a.divAlert.slideDown();return}var e=new Core.Ajax.ServerRequest({overlayElement:a.divModalCambioDatos.find(".btn-cambio-datos-confirmar"),secureRequest:true,requestUrl:"datos/validacionusuario",requestType:"POST",requestData:{user:a.txtNewUser.val()}});e.onSuccess=function(g){if(g.error){Core.Functions.Validations.toggleValidation(a.txtNewUser,true);a.divAlert.text(g.descripcion);a.divAlert.slideDown()}else{Core.Functions.Validations.toggleValidation(a.txtNewUser,false);a.divAlert.slideUp();a.txtNewUser.closest(".input-group, .form-group").addClass("has-success");if(c){c()}}};e.request()}};Core.Business.AccountSettings.ManagerCuentaBancaria=function(b){var a=this;a.divManagerCuentaBancaria=$(".div-manager-cuenta-bancaria");a.lblWarning=null;a.divTipoCuenta=null;a.chkTipoCuentaArgentina=null;a.chkTipoCuentaExterior=null;a.divTipoIdentificacion=null;a.chkTipoIdentificacionCBU=null;a.chkTipoIdentificacionAlias=null;a.divCBU=null;a.txtCBU=null;a.divAlias=null;a.txtAlias=null;a.txtDescripcion=null;a.ddlMoneda=null;a.divBanco=null;a.ddlBanco=null;a.divDefaultDolar=null;a.chkDefaultDolar=null;a.eTipoCuentaExterior={Bancaria:1,Broker:2};a.divTipoCuentaExterior=null;a.ddlTipoCuentaExterior=null;a.divTipoIdentificacionExterior=null;a.chkTipoIdentificacionExteriorSwift=null;a.chkTipoIdentificacionExteriorIBAN=null;a.divSwift=null;a.txtSwift=null;a.divABA=null;a.txtABA=null;a.divAccountNumber=null;a.txtAccountNumber=null;a.divIBAN=null;a.txtIBAN=null;a.divBeneficiary=null;a.txtBeneficiary=null;a.divFFC=null;a.txtFFC=null;a.btnEnvioLlamada=null;a.btnEnvioMensaje=null;a.llamadaVoz=0;a.divAlert=null;a.cuentaBancaria=null;a.onSave=null;a.idCuenta=null;a.idPersona=null;a.fiscalIdentifier=null;$.extend(true,a,b);a.show=function(){var c=new Core.Ajax.ServerRequest({allowCache:true,showOverlay:true,requestUrl:"bancos",requestType:"GET"});c.onSuccess=function(d){var e=new Core.Ajax.ServerRequest({allowCache:true,showOverlay:true,requestUrl:"cuentasbrokers",requestType:"GET"});e.onSuccess=function(g){a.lblWarning=a.divManagerCuentaBancaria.find(".lbl-warning");if(a.fiscalIdentifier){a.fiscalIdentifier=a.fiscalIdentifier+"";if(a.fiscalIdentifier.length==11){a.fiscalIdentifier=a.fiscalIdentifier.substr(0,2)+"-"+a.fiscalIdentifier.substr(2,8)+"-"+a.fiscalIdentifier.substr(10,1)}}a.divTipoCuenta=a.divManagerCuentaBancaria.find(".div-tipo-cuenta");a.divTipoCuenta.show();if(a.cuentaBancaria||(Core.Objects.Context.Configuration.idAplicacion==1&&!Core.Objects.Context.Profiles[0].opciones.habilitarCBExt)){a.divTipoCuenta.hide()}a.chkTipoCuentaArgentina=a.divManagerCuentaBancaria.find(".chk-tipo-cuenta-argentina");if(!a.chkTipoCuentaArgentina.swidget()){a.chkTipoCuentaArgentina.shieldRadioButton({label:"Argentina"})}var f=a.chkTipoCuentaArgentina.swidget().initialOptions;f.events={click:function(h){a.setControls()}};a.chkTipoCuentaArgentina.swidget().refresh(f);a.chkTipoCuentaArgentina.swidget().checked(false);Core.Functions.Validations.toggleValidation(a.chkTipoCuentaArgentina,false);a.chkTipoCuentaExterior=a.divManagerCuentaBancaria.find(".chk-tipo-cuenta-exterior");if(!a.chkTipoCuentaExterior.swidget()){a.chkTipoCuentaExterior.shieldRadioButton({label:"Otro País"})}var f=a.chkTipoCuentaExterior.swidget().initialOptions;f.events={click:function(h){a.setControls()}};a.chkTipoCuentaExterior.swidget().refresh(f);a.chkTipoCuentaExterior.swidget().checked(false);Core.Functions.Validations.toggleValidation(a.chkTipoCuentaExterior,false);if(!a.cuentaBancaria||a.cuentaBancaria.TipoCuentaBancaria==Core.Enums.eTipoCuentaBancaria.Argentina){a.chkTipoCuentaArgentina.swidget().checked(true)}else{a.chkTipoCuentaExterior.swidget().checked(true)}a.divTipoIdentificacion=a.divManagerCuentaBancaria.find(".div-tipo-identificacion");a.chkTipoIdentificacionCBU=a.divManagerCuentaBancaria.find(".chk-tipo-identificacion-cbu");if(!a.chkTipoIdentificacionCBU.swidget()){a.chkTipoIdentificacionCBU.shieldRadioButton({label:"CBU/CVU"})}var f=a.chkTipoIdentificacionCBU.swidget().initialOptions;f.events={click:function(h){a.setControls()}};a.chkTipoIdentificacionCBU.swidget().refresh(f);a.chkTipoIdentificacionCBU.swidget().checked(false);Core.Functions.Validations.toggleValidation(a.chkTipoIdentificacionCBU,false);a.chkTipoIdentificacionAlias=a.divManagerCuentaBancaria.find(".chk-tipo-identificacion-alias");if(!a.chkTipoIdentificacionAlias.swidget()){a.chkTipoIdentificacionAlias.shieldRadioButton({label:"Alias"})}var f=a.chkTipoIdentificacionAlias.swidget().initialOptions;f.events={click:function(h){a.setControls()}};a.chkTipoIdentificacionAlias.swidget().refresh(f);a.chkTipoIdentificacionAlias.swidget().checked(false);if(!a.cuentaBancaria||a.cuentaBancaria.CBU){a.chkTipoIdentificacionCBU.swidget().checked(true)}else{a.chkTipoIdentificacionAlias.swidget().checked(true)}Core.Functions.Validations.toggleValidation(a.chkTipoIdentificacionAlias,false);a.divCBU=a.divManagerCuentaBancaria.find(".div-cbu");a.txtCBU=a.divManagerCuentaBancaria.find(".textbox-cbu");a.txtCBU.shieldTextBox({enabled:(a.cuentaBancaria==null),value:(a.cuentaBancaria!=null)?a.cuentaBancaria.CBU:""});Core.Functions.Validations.toggleValidation(a.txtCBU,false);a.divAlias=a.divManagerCuentaBancaria.find(".div-alias");a.txtAlias=a.divManagerCuentaBancaria.find(".textbox-alias");a.txtAlias.shieldTextBox({enabled:(a.cuentaBancaria==null),value:(a.cuentaBancaria!=null)?a.cuentaBancaria.AliasCBU:"",events:{change:function(h){a.txtAlias.swidget().value(a.txtAlias.swidget().value().toUpperCase())}}});Core.Functions.Validations.toggleValidation(a.txtAlias,false);a.ddlMoneda=a.divManagerCuentaBancaria.find(".dropdown-cbu-moneda");a.ddlMoneda.shieldDropDown({dataSource:{data:[Core.Enums.Currency.Pesos,Core.Enums.Currency.Dolares,Core.Enums.Currency.DolaresCable]},textTemplate:"{Descripcion}",valueTemplate:"{idMoneda}",value:(a.cuentaBancaria)?a.cuentaBancaria.idMoneda.toString():Core.Enums.Currency.Pesos.idMoneda.toString(),enabled:(a.cuentaBancaria==null),events:{select:function(h){a.setControls()}}});a.divBanco=a.divManagerCuentaBancaria.find(".div-banco");a.ddlBanco=a.divManagerCuentaBancaria.find(".dropdown-cbu-banco");a.ddlBanco.shieldComboBox({dataSource:{data:d.bancos},textTemplate:"{Descripcion}",valueTemplate:"{idBanco}",value:(a.cuentaBancaria)?a.cuentaBancaria.idBanco.toString():"",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""}]}},enabled:(a.cuentaBancaria==null)});Core.Functions.Validations.toggleValidation(a.ddlBanco,false);a.divDefaultDolar=a.divManagerCuentaBancaria.find(".div-checkbox-default-dolar");a.chkDefaultDolar=a.divManagerCuentaBancaria.find(".checkbox-default-dolar");a.chkDefaultDolar.shieldCheckBox({label:"Quiero que los dólares BCRA se transfieran automáticamente a esta cuenta bancaria (Com. BCRA A6815)"});if(a.cuentaBancaria&&a.cuentaBancaria.EsDefaultDolar){a.chkDefaultDolar.swidget().checked(true);a.chkDefaultDolar.swidget().enabled(false)}else{a.chkDefaultDolar.swidget().checked(false);a.chkDefaultDolar.swidget().enabled(true)}a.divTipoCuentaExterior=a.divManagerCuentaBancaria.find(".div-tipo-cuenta-exterior");a.ddlTipoCuentaExterior=a.divManagerCuentaBancaria.find(".dropdown-tipo-cuenta-exterior");a.ddlTipoCuentaExterior.shieldDropDown({dataSource:{data:[{value:a.eTipoCuentaExterior.Bancaria,text:"Es una cuenta de mi propiedad, en un banco del exterior"},{value:a.eTipoCuentaExterior.Broker,text:"Es una cuenta comitente de mi propiedad en un broker del exterior"}]},textTemplate:"{text}",valueTemplate:"{value}",value:(!a.cuentaBancaria||!a.cuentaBancaria.FFC)?a.eTipoCuentaExterior.Bancaria.toString():a.eTipoCuentaExterior.Broker.toString(),enabled:(a.cuentaBancaria==null),events:{select:function(h){a.clearAutocompleteFields();a.setControls()}}});Core.Functions.Validations.toggleValidation(a.ddlTipoCuentaExterior,false);a.divBroker=a.divManagerCuentaBancaria.find(".div-broker");a.ddlBroker=a.divManagerCuentaBancaria.find(".dropdown-broker");g.bancos.push({idCuentaBancariaBroker:0,Beneficiary:"Otro"});a.ddlBroker.shieldDropDown({dataSource:{data:g.bancos},textTemplate:"{Beneficiary}",valueTemplate:"{idCuentaBancariaBroker}",value:"",enabled:(a.cuentaBancaria==null),events:{select:function(h){a.clearAutocompleteFields();a.setControls()}}});Core.Functions.Validations.toggleValidation(a.ddlBroker,false);a.divTipoIdentificacionExterior=a.divManagerCuentaBancaria.find(".div-tipo-identificacion-exterior");a.chkTipoIdentificacionExteriorSwift=a.divManagerCuentaBancaria.find(".chk-tipo-identificacion-exterior-swift");if(!a.chkTipoIdentificacionExteriorSwift.swidget()){a.chkTipoIdentificacionExteriorSwift.shieldRadioButton({label:"SWIFT/ABA"})}var f=a.chkTipoIdentificacionExteriorSwift.swidget().initialOptions;f.events={click:function(h){a.clearAutocompleteFields();a.setControls()}};a.chkTipoIdentificacionExteriorSwift.swidget().refresh(f);a.chkTipoIdentificacionExteriorSwift.swidget().checked(false);Core.Functions.Validations.toggleValidation(a.chkTipoIdentificacionExteriorSwift,false);a.chkTipoIdentificacionExteriorIBAN=a.divManagerCuentaBancaria.find(".chk-tipo-identificacion-exterior-iban");if(!a.chkTipoIdentificacionExteriorIBAN.swidget()){a.chkTipoIdentificacionExteriorIBAN.shieldRadioButton({label:"IBAN"})}var f=a.chkTipoIdentificacionExteriorIBAN.swidget().initialOptions;f.events={click:function(h){a.clearAutocompleteFields();a.setControls()}};a.chkTipoIdentificacionExteriorIBAN.swidget().refresh(f);a.chkTipoIdentificacionExteriorIBAN.swidget().checked(false);Core.Functions.Validations.toggleValidation(a.chkTipoIdentificacionExteriorIBAN,false);if(!a.cuentaBancaria||a.cuentaBancaria.SWIFT||a.cuentaBancaria.ABA){a.chkTipoIdentificacionExteriorSwift.swidget().checked(true)}else{a.chkTipoIdentificacionExteriorIBAN.swidget().checked(true)}a.divSwift=a.divManagerCuentaBancaria.find(".div-swift");a.txtSwift=a.divManagerCuentaBancaria.find(".textbox-swift");a.txtSwift.shieldTextBox({enabled:(a.cuentaBancaria==null),value:(a.cuentaBancaria!=null)?a.cuentaBancaria.SWIFT:""});Core.Functions.Validations.toggleValidation(a.txtSwift,false);a.divABA=a.divManagerCuentaBancaria.find(".div-aba");a.txtABA=a.divManagerCuentaBancaria.find(".textbox-aba");a.txtABA.shieldTextBox({enabled:(a.cuentaBancaria==null),value:(a.cuentaBancaria!=null)?a.cuentaBancaria.ABA:""});Core.Functions.Validations.toggleValidation(a.txtABA,false);a.divAccountNumber=a.divManagerCuentaBancaria.find(".div-account-number");a.txtAccountNumber=a.divManagerCuentaBancaria.find(".textbox-account-number");a.txtAccountNumber.shieldTextBox({enabled:(a.cuentaBancaria==null),value:(a.cuentaBancaria!=null)?a.cuentaBancaria.AccountNumber:""});Core.Functions.Validations.toggleValidation(a.txtAccountNumber,false);a.divIBAN=a.divManagerCuentaBancaria.find(".div-iban");a.txtIBAN=a.divManagerCuentaBancaria.find(".textbox-iban");a.txtIBAN.shieldTextBox({enabled:(a.cuentaBancaria==null),value:(a.cuentaBancaria!=null)?a.cuentaBancaria.IBAN:""});Core.Functions.Validations.toggleValidation(a.txtIBAN,false);a.divBeneficiary=a.divManagerCuentaBancaria.find(".div-beneficiary");a.txtBeneficiary=a.divManagerCuentaBancaria.find(".textbox-beneficiary");a.txtBeneficiary.shieldTextBox({enabled:(a.cuentaBancaria==null),value:(a.cuentaBancaria!=null)?a.cuentaBancaria.Beneficiary:""});Core.Functions.Validations.toggleValidation(a.txtBeneficiary,false);a.divFFC=a.divManagerCuentaBancaria.find(".div-ffc");a.txtFFC=a.divManagerCuentaBancaria.find(".textbox-ffc");a.txtFFC.shieldTextBox({enabled:(a.cuentaBancaria==null),value:(a.cuentaBancaria!=null)?a.cuentaBancaria.FFC:""});Core.Functions.Validations.toggleValidation(a.txtFFC,false);a.txtDescripcion=a.divManagerCuentaBancaria.find(".textbox-descripcion");a.txtDescripcion.shieldTextBox({value:(a.cuentaBancaria!=null)?a.cuentaBancaria.Alias:""});Core.Functions.Validations.toggleValidation(a.txtDescripcion,false);a.divManagerCuentaBancaria.find(".div-cambio-tipo-envio-codigo").hide();if(!a.cuentaBancaria&&Core.Objects.Context.Configuration.idAplicacion==1){a.divManagerCuentaBancaria.find(".div-cambio-tipo-envio-codigo").show()}a.divManagerCuentaBancaria.find(".lbl-cambio-tipo-envio-codigo").html("Enviaremos al celular registrado una clave de verificación de 6 dígitos para validar esta operación.<br/>Seleccione la manera en que desea recibirla:<br/><br/>");a.btnEnvioLlamada=a.divManagerCuentaBancaria.find(".btn-envio-llamada");a.btnEnvioLlamada.unbind("click");a.btnEnvioLlamada.click(function(){a.btnEnvioMensaje.removeClass("active");a.llamadaVoz=1});a.btnEnvioMensaje=a.divManagerCuentaBancaria.find(".btn-envio-mensaje");a.btnEnvioMensaje.unbind("click");a.btnEnvioMensaje.click(function(){a.btnEnvioLlamada.removeClass("active");a.llamadaVoz=0});a.btnEnvioMensaje.addClass("active");a.btnEnvioLlamada.removeClass("active");a.setControls();a.divAlert=a.divManagerCuentaBancaria.find(".login-alert");a.divAlert.slideUp();a.divManagerCuentaBancaria.find(".btn-cbu-confirmar").unbind("click");a.divManagerCuentaBancaria.find(".btn-cbu-confirmar").click(function(){Core.Functions.Validations.toggleValidation(a.txtCBU,false);Core.Functions.Validations.toggleValidation(a.txtAlias,false);Core.Functions.Validations.toggleValidation(a.txtDescripcion,false);Core.Functions.Validations.toggleValidation(a.ddlBanco,false);Core.Functions.Validations.toggleValidation(a.ddlMoneda,false);Core.Functions.Validations.toggleValidation(a.ddlTipoCuentaExterior,false);Core.Functions.Validations.toggleValidation(a.ddlBroker,false);Core.Functions.Validations.toggleValidation(a.txtSwift,false);Core.Functions.Validations.toggleValidation(a.txtABA,false);Core.Functions.Validations.toggleValidation(a.txtAccountNumber,false);Core.Functions.Validations.toggleValidation(a.txtIBAN,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiary,false);Core.Functions.Validations.toggleValidation(a.txtFFC,false);a.divAlert.slideUp();var k={value:true};var h={};h.TipoCuentaBancaria=(a.chkTipoCuentaArgentina.swidget().checked()?Core.Enums.eTipoCuentaBancaria.Argentina:Core.Enums.eTipoCuentaBancaria.Exterior);h.idMoneda=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMoneda,k);if(a.chkTipoCuentaArgentina.swidget().checked()){h.idBanco=Core.Functions.Validations.getValidatedDropDownValue(a.ddlBanco,k);h.idMoneda=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMoneda,k);h.EsDefaultDolar=((a.ddlMoneda.swidget().selectedItem().idMoneda==Core.Enums.Currency.Dolares.idMoneda)?(a.chkDefaultDolar.swidget().checked()?1:0):0);if(a.chkTipoIdentificacionCBU.swidget().checked()){h.CBU=Core.Functions.Validations.getValidatedSwidgetValue(a.txtCBU,k)}else{h.AliasCBU=Core.Functions.Validations.getValidatedSwidgetValue(a.txtAlias,k)}if(k.value&&!a.cuentaBancaria){if(h.CBU&&!Core.Functions.Validations.isValidCBU(h.CBU,a.ddlBanco.swidget().selectedItem().Codigo)){k.value=false;a.divAlert.text("El CBU ingresado no es correcto.");a.divAlert.slideDown()}if(h.AliasCBU&&!Core.Functions.Validations.isValidAlias(h.AliasCBU)){k.value=false;a.divAlert.text("El Alias ingresado no es correcto.");a.divAlert.slideDown()}}}else{if(a.ddlTipoCuentaExterior.swidget().value()==a.eTipoCuentaExterior.Broker){h.FFC=Core.Functions.Validations.getValidatedSwidgetValue(a.txtFFC,k)}if(a.chkTipoIdentificacionExteriorSwift.swidget().checked()){h.SWIFT=a.txtSwift.swidget().value();h.ABA=a.txtABA.swidget().value();h.AccountNumber=Core.Functions.Validations.getValidatedSwidgetValue(a.txtAccountNumber,k);if(!h.SWIFT&&!h.ABA){k.value=false;Core.Functions.Validations.toggleValidation(a.txtSwift,true);Core.Functions.Validations.toggleValidation(a.txtABA,true);a.divAlert.text("Debe completar el SWIFT o el ABA.");a.divAlert.slideDown()}}else{h.IBAN=Core.Functions.Validations.getValidatedSwidgetValue(a.txtIBAN,k)}h.Beneficiary=Core.Functions.Validations.getValidatedSwidgetValue(a.txtBeneficiary,k)}h.Alias=a.txtDescripcion.swidget().value();if(a.idCuenta){h.idCuenta=a.idCuenta}if(a.idPersona){h.idPersona=a.idPersona}if(!a.cuentaBancaria&&Core.Objects.Context.Configuration.idAplicacion==1){h.LlamadaVoz=a.llamadaVoz}if(!k.value){return}var i="cbu/"+((a.cuentaBancaria!=null)?encodeURIComponent(a.cuentaBancaria.idCuentaBancaria):"agregar");var j=new Core.Ajax.ServerRequest({overlayElement:a.divManagerCuentaBancaria.find(".btn-cbu-confirmar"),showOverlay:true,requestUrl:i,requestType:(a.cuentaBancaria!=null)?"PUT":"POST",requestData:h});j.onSuccess=function(m){if(!a.cuentaBancaria&&Core.Objects.Context.Configuration.idAplicacion==1){new Core.Controls.Prompt("Confirmación de Cuenta Bancaria","Ingrese el código recibido",{onAccepted:function(n){var o=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"datos/confirmar",requestType:"POST",requestData:{codigo:n}});o.onSuccess=function(p){l()};o.request()}}).show()}else{l()}function l(){a.divManagerCuentaBancaria.modal("hide");var n="Cuenta bancaria vinculada "+((a.cuentaBancaria!=null)?"modificada":"creada")+" con éxito.";var o=new Core.Controls.Dialog("Aviso",n,{displayButtons:{close:true,accept:false}});o.show();if(a.onSave){a.onSave()}}};j.onError=function(m){var l=(m.responseJSON&&m.responseJSON.Descripcion)?m.responseJSON.Descripcion:"Algunos componentes de la página no se cargaron correctamente. Por favor intente mas tarde...";a.divAlert.text(l);a.divAlert.slideDown()};j.request()});a.divManagerCuentaBancaria.unbind("hidden.bs.modal");a.divManagerCuentaBancaria.on("hidden.bs.modal",function(){a.txtCBU.swidget().destroy();a.txtAlias.swidget().destroy();a.txtDescripcion.swidget().destroy();a.ddlMoneda.swidget().destroy();a.ddlBanco.swidget().destroy();a.chkDefaultDolar.swidget().destroy();a.ddlTipoCuentaExterior.swidget().destroy();a.ddlBroker.swidget().destroy();a.txtSwift.swidget().destroy();a.txtABA.swidget().destroy();a.txtAccountNumber.swidget().destroy();a.txtIBAN.swidget().destroy();a.txtBeneficiary.swidget().destroy();a.txtFFC.swidget().destroy()});a.divManagerCuentaBancaria.modal({show:true})};e.request()};c.request()};a.clearAutocompleteFields=function(){a.txtABA.swidget().value("");a.txtAccountNumber.swidget().value("");a.txtSwift.swidget().value("");a.txtIBAN.swidget().value("");a.txtBeneficiary.swidget().value("")};a.setControls=function(){a.divBanco.hide();a.divTipoIdentificacion.hide();a.divCBU.hide();a.divAlias.hide();a.divTipoCuentaExterior.hide();a.divBroker.hide();a.divTipoIdentificacionExterior.hide();a.divSwift.hide();a.divABA.hide();a.divAccountNumber.hide();a.divIBAN.hide();a.divBeneficiary.hide();a.divFFC.hide();a.divDefaultDolar.hide();if(a.chkTipoCuentaArgentina.swidget().checked()){a.divBanco.show();if(!a.cuentaBancaria){a.divTipoIdentificacion.show()}if(a.chkTipoIdentificacionCBU.swidget().checked()){a.divCBU.show()}else{a.divAlias.show()}var c=a.ddlMoneda.swidget().initialOptions;c.dataSource.data=[Core.Enums.Currency.Pesos,Core.Enums.Currency.Dolares];c.value=a.ddlMoneda.swidget().value();a.ddlMoneda.swidget().refresh(c);if(a.ddlMoneda.swidget().selectedItem().idMoneda==Core.Enums.Currency.Dolares.idMoneda){a.divDefaultDolar.show()}if(a.fiscalIdentifier){a.lblWarning.text("NOTA: Recuerde que el CUIL: "+a.fiscalIdentifier+" debe ser titular o co-titular de la cuenta bancaria. De lo contrario los rescates o transferencias serán rechazados por el banco destino.")}else{a.lblWarning.text("Recuerde que el CUIT de la persona jurídica debe ser titular de la cuenta bancaria. De lo contrario los rescates o transferencias serán rechazados por el banco destino.")}}else{if(!a.cuentaBancaria){a.divTipoCuentaExterior.show();a.txtABA.swidget().enabled(!(a.ddlTipoCuentaExterior.swidget().value()==a.eTipoCuentaExterior.Broker)||!a.ddlBroker.swidget().selectedItem()||!a.ddlBroker.swidget().selectedItem().idCuentaBancariaBroker);a.txtAccountNumber.swidget().enabled(!(a.ddlTipoCuentaExterior.swidget().value()==a.eTipoCuentaExterior.Broker)||!a.ddlBroker.swidget().selectedItem()||!a.ddlBroker.swidget().selectedItem().idCuentaBancariaBroker);a.txtSwift.swidget().enabled(!(a.ddlTipoCuentaExterior.swidget().value()==a.eTipoCuentaExterior.Broker)||!a.ddlBroker.swidget().selectedItem()||!a.ddlBroker.swidget().selectedItem().idCuentaBancariaBroker);a.txtIBAN.swidget().enabled(!(a.ddlTipoCuentaExterior.swidget().value()==a.eTipoCuentaExterior.Broker)||!a.ddlBroker.swidget().selectedItem()||!a.ddlBroker.swidget().selectedItem().idCuentaBancariaBroker);a.txtBeneficiary.swidget().enabled(!(a.ddlTipoCuentaExterior.swidget().value()==a.eTipoCuentaExterior.Broker)||!a.ddlBroker.swidget().selectedItem()||!a.ddlBroker.swidget().selectedItem().idCuentaBancariaBroker);if(a.ddlTipoCuentaExterior.swidget().value()==a.eTipoCuentaExterior.Broker){a.divBroker.show();if(a.ddlBroker.swidget().selectedItem()&&a.ddlBroker.swidget().selectedItem().idCuentaBancariaBroker){a.txtABA.swidget().value(((a.ddlBroker.swidget().selectedItem().ABA)?a.ddlBroker.swidget().selectedItem().ABA:""));a.txtAccountNumber.swidget().value(((a.ddlBroker.swidget().selectedItem().AccountNumber)?a.ddlBroker.swidget().selectedItem().AccountNumber:""));a.txtSwift.swidget().value(((a.ddlBroker.swidget().selectedItem().SWIFT)?a.ddlBroker.swidget().selectedItem().SWIFT:""));a.txtIBAN.swidget().value(((a.ddlBroker.swidget().selectedItem().IBAN)?a.ddlBroker.swidget().selectedItem().IBAN:""));a.txtBeneficiary.swidget().value(((a.ddlBroker.swidget().selectedItem().Beneficiary)?a.ddlBroker.swidget().selectedItem().Beneficiary:""));a.chkTipoIdentificacionExteriorSwift.swidget().checked(false);a.chkTipoIdentificacionExteriorIBAN.swidget().checked(false);if(a.ddlBroker.swidget().selectedItem().SWIFT||a.ddlBroker.swidget().selectedItem().ABA){a.chkTipoIdentificacionExteriorSwift.swidget().checked(true)}else{a.chkTipoIdentificacionExteriorIBAN.swidget().checked(true)}}else{a.divTipoIdentificacionExterior.show()}}else{a.divTipoIdentificacionExterior.show()}}a.divBeneficiary.show();if(a.ddlTipoCuentaExterior.swidget().value()==a.eTipoCuentaExterior.Broker){a.divFFC.show();a.txtBeneficiary.attr("placeholder","Nombre del Broker destino")}else{a.txtBeneficiary.attr("placeholder","Nombre del Titular de la Cuenta")}if(a.chkTipoIdentificacionExteriorSwift.swidget().checked()){a.divSwift.show();a.divABA.show();a.divAccountNumber.show()}else{a.divIBAN.show()}var c=a.ddlMoneda.swidget().initialOptions;c.dataSource.data=[Core.Enums.Currency.DolaresCable];c.value=Core.Enums.Currency.DolaresCable.idMoneda.toString();a.ddlMoneda.swidget().refresh(c);a.lblWarning.text("Recuerde que debe ser titular o co-titular de la cuenta bancaria. De lo contrario los rescates o transferencias serán rechazados por el banco destino.")}}};Core.Business.AccountSettings.GenerateOperationCode=function(b){var a=this;a.divModalCambioDatos=$(".cambio-datos");a.txtOperationCode1=null;a.txtOperationCode2=null;a.txtPass=null;a.divAlert=null;a.btnEnvioLlamada=null;a.btnEnvioMensaje=null;a.llamadaVoz=0;a.onChanged=function(){};$.extend(true,a,b);a.show=function(){a.divModalCambioDatos.find(".div-title").html("GENERAR NUEVO CODIGO DE OPERACION");a.divModalCambioDatos.find(".div-cambio-email").hide();a.divModalCambioDatos.find(".div-cambio-phone").hide();a.divModalCambioDatos.find(".div-cambio-usuario").hide();a.divModalCambioDatos.find(".div-cambio-clave").hide();a.divModalCambioDatos.find(".div-new-operation-code").show();a.divModalCambioDatos.find(".div-cambio-tipo-envio-codigo").show();a.divModalCambioDatos.find(".div-cambio-tipo-envio-codigo-button").show();a.divModalCambioDatos.find(".lbl-cambio-tipo-envio-codigo").html("Enviaremos al celular registrado una clave de verificación de 6 dígitos para validar esta operación.<br/>Seleccione la manera en que desea recibirla:<br/><br/>");a.txtOperationCode1=a.divModalCambioDatos.find(".txt-new-operation-code-1");a.txtOperationCode2=a.divModalCambioDatos.find(".txt-new-operation-code-2");a.txtPass=a.divModalCambioDatos.find(".txt-pass");a.divAlert=a.divModalCambioDatos.find(".login-alert");a.txtOperationCode1.val("");a.txtOperationCode2.val("");a.txtPass.val("");Core.Functions.Validations.toggleValidation(a.txtOperationCode1,false);Core.Functions.Validations.toggleValidation(a.txtOperationCode2,false);Core.Functions.Validations.toggleValidation(a.txtPass,false);a.divAlert.slideUp();a.btnEnvioLlamada=a.divModalCambioDatos.find(".btn-envio-llamada");a.btnEnvioLlamada.unbind("click");a.btnEnvioLlamada.click(function(){a.btnEnvioMensaje.removeClass("active");a.llamadaVoz=1});a.btnEnvioMensaje=a.divModalCambioDatos.find(".btn-envio-mensaje");a.btnEnvioMensaje.unbind("click");a.btnEnvioMensaje.click(function(){a.btnEnvioLlamada.removeClass("active");a.llamadaVoz=0});a.btnEnvioMensaje.addClass("active");a.btnEnvioLlamada.removeClass("active");a.divModalCambioDatos.find(".btn-cambio-datos-confirmar").unbind("click");a.divModalCambioDatos.find(".btn-cambio-datos-confirmar").click(function(){Core.Functions.Validations.toggleValidation(a.txtOperationCode1,false);Core.Functions.Validations.toggleValidation(a.txtOperationCode2,false);Core.Functions.Validations.toggleValidation(a.txtPass,false);a.divAlert.slideUp();if(a.validData()){var c=new Core.Ajax.ServerRequest({overlayElement:a.divModalCambioDatos.find(".btn-cambio-datos-confirmar"),secureRequest:true,requestUrl:"datos/usuario",requestType:"POST",requestData:{campo:"codigoOpe",valor:a.txtOperationCode1.val(),passActual:a.txtPass.val(),user:Core.Objects.Context.User,LlamadaVoz:a.llamadaVoz}});c.onSuccess=function(d){new Core.Controls.Prompt("Confirmación del Código de Operación","Ingrese el código recibido",{onAccepted:function(e){var f=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"datos/confirmar",requestType:"POST",requestData:{codigo:e}});f.onSuccess=function(g){a.divModalCambioDatos.modal("hide");Core.Objects.Context.TieneC4D=1;if(!Core.Functions.Validations.isBlockedStorage()&&Core.Functions.Persistence.getStorage()){Core.Functions.Persistence.getStorage().setItem("CoreContext",LZString.compressToUTF16(JSON.stringify(Core.Objects.Context)))}new Core.Controls.Dialog("Aviso","Código de operacion modificado correctamente.",{displayButtons:{close:true,accept:false}}).show();a.onChanged()};f.request()}}).show()};c.request()}});a.divModalCambioDatos.unbind("shown.bs.modal");a.divModalCambioDatos.on("shown.bs.modal",function(){a.txtOperationCode1.focus()});a.divModalCambioDatos.modal({show:true})};a.validData=function(){var c=/^[0-9]+$/;if(!a.txtOperationCode1.val()||a.txtOperationCode1.val().length!=4||!c.test(a.txtOperationCode1.val())){Core.Functions.Validations.toggleValidation(a.txtOperationCode1,true);a.divAlert.text("El código de operación ingresado debe contener 4 caracteres numéricos.");a.divAlert.slideDown();return false}if(a.txtOperationCode1.val()!=a.txtOperationCode2.val()){Core.Functions.Validations.toggleValidation(a.txtOperationCode1,true);Core.Functions.Validations.toggleValidation(a.txtOperationCode2,true);a.divAlert.text("Los códigos de operación ingresados no coinciden.");a.divAlert.slideDown();return false}if(!a.txtPass.val()){Core.Functions.Validations.toggleValidation(a.txtPass,true);return false}return true}};Core.Business.Acreditaciones=new function(){var a=this;a.id="homeAcreditaciones";a.divAcreditaciones=null;a.lblTitle=null;a.txtDateFrom=null;a.txtDateTo=null;a.btnRefresh=null;a.txtFilter=null;a.pageOptions=null;a.timeout=null;a.init=function(b,c){Core.loadPage("acreditaciones.html",function(){document.title="Acreditaciones";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divAcreditaciones=$(".div-acreditaciones");a.lblTitle=$(".label-title");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.txtFilter=$(".textbox-filter");a.btnRefresh=$(".btn-refresh");a.btnRefresh.on("click",function(){a.loadGrid()});a.initDatePickers();a.initGrid();a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var d=a.divAcreditaciones.swidget().dataSource;if(value){d.filter={or:[{path:"Comitente",filter:"contains",value:value},{path:"Cuenta",filter:"contains",value:value}]}}else{d.filter=null}d.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.Acreditaciones.txtFilter");a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.Acreditaciones")})};a.initDatePickers=function(){var b=new Date();b.setDate(b.getDate()-1);a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:b,max:new Date(),events:{change:function(c){a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loadGrid()}}})};a.initGrid=function(){var b=[];b.push({field:"FechaCarga",title:"Fecha Carga",width:"8%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"HoraCarga",title:"Hora Carga",width:"6%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Comitente",title:"Comitente",width:"6%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Cuenta",title:"Cuenta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"30%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"FechaAcreditacion",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),title:"Fecha Acreditación",width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"7%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Importe",title:"Importe",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNuleablePrice});b.push({field:"NumeroRecibo",title:"Recibo",width:"5%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Asesor",title:"Asesor",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"UsuarioAlta",title:"Usuario Alta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});a.divAcreditaciones.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],paging:{pageSize:100,pageLinksCount:10},exportOptions:{excel:{fileName:"Acreditaciones",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["FechaCarga","HoraCarga","Comitente","Cuenta","FechaAcreditacion","Moneda","Importe","NumeroRecibo","Asesor","UsuarioAlta","Equipo","UnidadDeNegocio"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Acreditaciones"}}},selection:false,rowHover:false,sorting:{multiple:true},columns:b})};a.loadGrid=function(){a.lblTitle.text("Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var b;b="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));b+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));var c=new Core.Ajax.ServerRequest({overlayElement:a.divAcreditaciones.parent(),secureRequest:true,requestUrl:"acreditaciones/"+encodeURIComponent(Core.Objects.Context.IdPersona),requestType:"GET",requestData:b});c.onSuccess=function(d){var e=a.divAcreditaciones.swidget().initialOptions;e.dataSource.data=d;e.dataSource.schema={data:"acreditaciones"};e.exportOptions.excel.dataSource.data=d;e.exportOptions.excel.dataSource.schema={data:"acreditaciones"};e.exportOptions.excel.readDataSource=true;a.divAcreditaciones.swidget().refresh(e);a.txtFilter.keydown()};c.request()}};Core.Business.eActivacionusuarioSite={Fondos:1,Bolsa:2};Core.Business.ActivacionUsuario=new function(){var a=this;a.divMain=null;a.idSite=null;a.ddlDocumentType=null;a.txtDocumentNumber=null;a.txtEmail=null;a.btnContinue=null;a.divForm=null;a.divMessageSuccess=null;a.divMessage=null;a.message=null;a.init=function(b){if(Core.Functions.Validations.isBlockedStorage()||!Core.Functions.Persistence.getStorage()){var c=new Core.Controls.Dialog("Aviso","La aplicación no puede ejecutarse correctamente en modo Privado.",{displayButtons:{close:true,accept:false}});c.show();return}Core.loadPage("activacion-usuario.html",function(){document.title="Primer Ingreso";a.message=b;a.divMain=$(".panel-body");a.ddlDocumentType=$(".dropdown-document-type");a.txtDocumentNumber=$(".textbox-document");a.txtEmail=$(".textbox-email");a.btnContinue=$(".button-continue");a.divForm=$(".div-form-primer-ingreso");a.divMessageSuccess=$(".div-primer-ingreso-success");a.divMessage=$(".div-primer-ingreso-message");a.initControls()})};a.initControls=function(){a.divMessageSuccess.hide();a.divMessage.hide();if(a.message){a.divMessage.html(a.message);a.divMessage.show()}a.divForm.show();var b=new Core.Ajax.ServerRequest({overlayElement:a.divMain,secureRequest:false,requestUrl:"sitio",requestType:"GET"});b.onSuccess=function(c){a.idSite=c.Sitio;a.btnContinue.click(function(){Core.Functions.Validations.toggleValidation(a.txtDocumentNumber,false);Core.Functions.Validations.toggleValidation(a.txtEmail,false);var d=a.txtDocumentNumber.val();var e=a.txtEmail.val();var f=/^[0-9]+$/;if(!d||!d.length||!f.test(d)){Core.Functions.Validations.toggleValidation(a.txtDocumentNumber,true);return}if(!Core.Functions.Validations.isEmail(e)){Core.Functions.Validations.toggleValidation(a.txtEmail,true);return}var g={idTipoDocumento:a.ddlDocumentType.val(),Documento:d,Email:e};var h=new Core.Ajax.ServerRequest({overlayElement:a.divMain,secureRequest:true,requestUrl:"usuario/solicitud",requestType:"POST",requestData:g});h.onSuccess=function(i){a.divForm.hide();a.divMessageSuccess.show();a.divMessageSuccess.html(i.Descripcion);dataLayer.push({event:"primer_ingreso",method:"email"})};h.request()})};b.request()}};Core.Business.AlertasPrecios=new function(){var a=this;a.id="alertasPrecios";a.lblAvisoCantidadAlertas=null;a.divAlertasPrecios=null;a.pageOptions=null;a.init=function(b,c){Core.loadPage("alertas-precios.html",function(){document.title="Alertas de Precios";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divAlertasPrecios=$(".div-alertas-precios");a.lblAvisoCantidadAlertas=$(".lbl-aviso-cantidad-alertas");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.AlertasPrecios")})};a.initControls=function(){a.lblAvisoCantidadAlertas.text("");var b=[];b.push({width:"18%",field:"_Descripcion",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"8%",field:"_Ticker",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"8%",field:"_Plazo",title:"Plazo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"32%",field:"_Variable",title:"Variable",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"18%",field:"_Condicion",title:"Condición",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"8%",field:"_Valor",title:"Valor",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithDecimals});b.push({width:"8%",field:"_Activa",title:"Estado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,d,e){var f=$("<strong>"+a.formatAlertState(d._Activa)+"</strong>").appendTo(c);f.css("color",d.color_hexa?d.color_hexa:"")}});b.push({width:90,field:"",title:" ",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(e,f,g){var d=$('<button type="button" title="Editar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(e);d.on("click",function(){new Core.Controls.ManagerAlertaPrecio({overlayElement:d,alerta:f,onSuccess:function(){a.loadGrid()}}).show()});var c=$('<button type="button" title="Eliminar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(e);c.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar la alerta de precio con descripción: "+f._Descripcion+"?",{onAccepted:function(){var h=new Core.Ajax.ServerRequest({overlayElement:c,secureRequest:true,requestUrl:("pricealerts/deletealert?idpersona="+encodeURIComponent(Core.Objects.Context.IdPersona)+"&id="+f.id),requestType:"DELETE"});h.onSuccess=function(){a.loadGrid()};h.request()}}).show()})}});a.divAlertasPrecios.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:b,noRecordsText:"No se encontraron alertas de precios."})};a.loadGrid=function(){var b=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"pricealerts/alertsbyuser?idpersona="+encodeURIComponent(Core.Objects.Context.IdPersona),requestType:"GET"});b.onSuccess=function(c){var d=(c&&c.elements)?c.elements:[];d.forEach(function(g,f){g._Descripcion=g.description;g._Ticker=g.instrument?g.instrument.name:"";g._TickerDescripcion=g.instrument?g.instrument.description:"";g._Variable=g.parameter?g.parameter.description:"";g._Condicion=g.condition?g.condition.description:"";g._Valor=g.amount;g._Activa=g.state=="ACTIVE";g._Plazo=Core.Functions.Plazo.getDescriptionByID(g.term)});var e=a.divAlertasPrecios.swidget().initialOptions;e.dataSource.data=d;a.divAlertasPrecios.swidget().refresh(e);a.lblAvisoCantidadAlertas.text(((c&&c.extra_data)?(" Podés tener configuradas hasta un máximo de "+c.extra_data.max_alerts+" alertas al mismo tiempo."):""))};b.request()};a.formatAlertState=function(b){if(b){return"Activa"}else{return"Inactiva"}}};Core.Business.HomeAltaCuenta=new function(){var a=this;a.id="homeAltaCuenta";a.idDefaultAccount=null;a.idDefaultProfile=null;a.initialParameters=null;a.containerAltaCuenta=null;a.init=function(b,c,d){Core.loadPage("alta-cuenta.html",function(){a.containerAltaCuenta=$(".div-container-alta-cuenta");document.title="Alta Cuenta";a.idDefaultAccount=b;a.idDefaultProfile=c;a.initialParameters=d?d:{};a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.initialParameters.idDefaultProfile=a.idDefaultProfile;a.initialParameters.idDefaultAccount=a.idDefaultAccount;a.initialParameters.container=a.containerAltaCuenta;a.initialParameters.onClose=function(){Core.Business.AperturasCuentas.init(a.idDefaultAccount,a.idDefaultProfile)};var e=new Core.Controls.ManagerAltaCuenta(a.initialParameters).show()})},"Core.Business.HomeAltaCuenta")}};Core.Business.HomeAltaCuentaBCI=new function(){var a=this;a.id="homeAltaCuentaBCI";a.idDefaultAccount=null;a.idDefaultProfile=null;a.initialParameters=null;a.containerAltaCuenta=null;a.init=function(b,c,d){Core.loadPage("alta-cuenta-bci.html",function(){a.containerAltaCuenta=$(".div-container-alta-cuenta");document.title="Alta Cuenta BCI";a.idDefaultAccount=b;a.idDefaultProfile=c;a.initialParameters=d?d:{};a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.initialParameters.idDefaultProfile=a.idDefaultProfile;a.initialParameters.idDefaultAccount=a.idDefaultAccount;a.initialParameters.container=a.containerAltaCuenta;a.initialParameters.idNegocioDefault=Core.Enums.eNegocio.BCI;a.initialParameters.onClose=function(){Core.Business.AperturasCuentas.init(a.idDefaultAccount,a.idDefaultProfile)};var e=new Core.Controls.ManagerAltaCuenta(a.initialParameters).show()})},"Core.Business.HomeAltaCuentaBCI")}};Core.Business.AperturasCuentas=new function(){var a=this;a.idDefaultAccount=null;a.idDefaultProfile=null;a.id="homeAperturasCuentas";a.divCuentas=null;a.divNegocios=null;a.divEstados=null;a.pageOptions=null;a.txtFilter=null;a.timeout=null;a.originalData=[];a.containerAperturasCuentas=null;a.containerAltaCuenta=null;a.estadosActivos={};a.negociosActivos={};a.init=function(b,c,d){Core.loadPage("aperturas-cuentas.html",function(){document.title="Aperturas";a.idDefaultAccount=b;a.idDefaultProfile=c;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.containerAperturasCuentas=$(".div-container-aperturas-cuentas");a.containerAperturasCuentas.show();a.containerAltaCuenta=$(".div-container-alta-cuenta");a.containerAltaCuenta.hide();a.divCuentas=$(".div-aperturas-cuentas");a.divNegocios=$(".div-negocios");a.divEstados=$(".div-estados");a.txtFilter=$(".textbox-filter");if(d&&d.search){a.txtFilter.val(d.search)}a.initGrid();a.initFilter();a.estadosActivos={};a.negociosActivos={};a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadGrid()},"Core.Business.AperturasCuentas")})};a.initFilter=function(){a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var b=a.divCuentas.swidget().dataSource;if(value){b.filter={or:[{path:"idAperturaCuenta",filter:"contains",value:value},{path:"VersionActual",filter:"contains",value:value},{path:"Estado",filter:"contains",value:value},{path:"Asesor",filter:"contains",value:value},{path:"Cuenta",filter:"contains",value:value},{path:"email",filter:"contains",value:value},{path:"usuarioAsignado",filter:"contains",value:value}]}}else{b.filter=null}b.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.AperturasCuentas.txtFilter")};a.initGrid=function(){var b=[];var e=Core.Functions.grid.getHeaderAttribute(1);b.push({width:30,field:"",title:" ",headerAttributes:e,columnTemplate:function(f,g,h){if(g.idNegocio==Core.Enums.eNegocio.BCI){$('<img src="/images/icono-internacional.svg" style="margin-left:10px; width:20px; height:20px;" />').appendTo(f)}}});b.push({width:"8%",field:"idAperturaCuenta",title:"Apertura",headerAttributes:e});b.push({width:"8%",field:"VersionActual",title:"Versión Actual",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({width:"19%",field:"Cuenta",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});if(Core.Objects.Context.Configuration.idAplicacion!=3){b.push({width:"19%",field:"email",title:"email",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)})}b.push({width:"13%",field:"Estado",title:"Estado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({width:"13%",field:"Asesor",title:"Asesor",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({width:"10%",field:"FechaConfirmacion",title:"Fecha Confirmación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({width:"10%",field:"TiempoConfirmacion",title:"Tiempo Confirmación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({width:"10%",field:"TiempoSector",title:"Tiempo Total en Sector",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({width:"10%",field:"FechaUltimoCambioEstado",title:"Fecha Ultimo Cambio de Estado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({width:"10%",field:"usuarioAsignado",title:"Usuario Asignado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});var d=Core.Functions.grid.getHeaderAttribute(b.length);b.push({width:45,field:"",title:" ",headerAttributes:d,columnTemplate:function(f,g,i){if(!g.EsJuridica&&g.tienePruebaDeVida){var h=$('<button disabled style="border:3px solid; background-color:#fff;" type="button" title="Prueba de Vida" class="btn-sm balanz-button"><img src="/images/prueba-de-vida.png" style="width:20px; height:20px;" /></button>').appendTo(f);h.css("border-color",g.tienePruebaDeVida)}}});var c=Core.Functions.grid.getHeaderAttribute(b.length);b.push({width:45,field:"",title:" ",headerAttributes:d,columnTemplate:function(f,g,i){if(!g.EsJuridica&&g.tieneMatchCara){var h=$('<button disabled type="button" title="Match de Cara" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/match-cara.png" style="width:20px; height:20px;" /></button>').appendTo(f);h.css("border-color",g.tieneMatchCara)}}});b.push({width:45,field:"",title:" ",headerAttributes:d,columnTemplate:function(f,g,i){if(!g.EsJuridica&&g.tieneDatosPrecargados){var h=$('<button disabled type="button" title="Datos Precargados" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/datos-precargados.png" style="width:20px; height:20px;" /></button>').appendTo(f);h.css("border-color",g.tieneDatosPrecargados)}}});b.push({width:45,field:"",title:" ",headerAttributes:d,columnTemplate:function(f,g,i){if(!g.EsJuridica&&g.tieneReuters){var h=$('<button disabled style="border:3px solid; background-color:#fff;" type="button" title="Reuters" class="btn-sm balanz-button"><img src="/images/reuters-logo.png" style="width:20px; height:20px;" /></button>').appendTo(f);h.css("border-color",g.tieneReuters)}}});b.push({width:45,field:"",title:" ",headerAttributes:d,columnTemplate:function(f,g,i){if(g.tieneNOSIS){var h=$('<button disabled style="border:3px solid; background-color:#fff;" type="button" title="Nosis" class="btn-sm balanz-button"><img src="/images/nosis-logo.png" style="width:20px; height:20px;" /></button>').appendTo(f);h.css("border-color",g.tieneNOSIS)}}});b.push({width:45,field:"",title:" ",headerAttributes:d,columnTemplate:function(f,g,i){if(!g.EsJuridica&&g.tieneRenaper){var h=$('<button disabled style="border:3px solid; background-color:#fff;" type="button" title="Renaper" class="btn-sm balanz-button"><img src="/images/renaper-logo.png" style="width:20px; height:20px;" /></button>').appendTo(f);h.css("border-color",g.tieneRenaper)}}});b.push({width:45,field:"",title:" ",headerAttributes:d,columnTemplate:function(f,g,i){if(g.tieneUIF){var h=$('<button disabled style="border:3px solid; background-color:#fff;" type="button" title="UIF" class="btn-sm balanz-button"><img src="/images/uif-logo.png" style="width:20px; height:20px;" /></button>').appendTo(f);h.css("border-color",g.tieneUIF)}}});b.push({width:45,field:"",title:" ",headerAttributes:d,columnTemplate:function(f,g,i){if(g.tieneDocusign){var h=$('<button disabled style="border:3px solid; background-color:#fff;" type="button" title="DocuSign" class="btn-sm balanz-button"><img src="'+(g.tieneDocusign=="disabled"?"/images/docusign-logo-inactivo.png":"/images/docusign-logo.png")+'" style="width:20px; height:20px;" /></button>').appendTo(f);h.css("border-color",(g.tieneDocusign=="disabled"?"lightgray":g.tieneDocusign))}}});b.push({width:45,field:"",title:" ",headerAttributes:d,columnTemplate:function(f,g,j){if(g.motorDecision){var h=$('<button style="border:3px solid; background-color:transparent; border-color:transparent;" type="button" title="Motor decisión" class="btn-sm balanz-button"></button>').appendTo(f);var i=$('<img src="/images/circ-trans.png" style="width:20px; height:20px;" />').appendTo(h);i.css("background-color",g.motorDecision);h.on("click",function(){Core.Functions.ExternalServices.MotorDecision.showReport(h,g.idAperturaCuenta)})}}});b.push({width:45,field:"",title:" ",headerAttributes:c,columnTemplate:function(g,h,i){var f=$('<button type="button" title="Acceder" class="btn-sm balanz-button"><span class="glyphicon glyphicon-resize-full"></span></button>').appendTo(g);f.on("click",function(){a.containerAperturasCuentas.hide();a.containerAltaCuenta.show();var j=new Core.Controls.ManagerAltaCuenta({idAperturaCuenta:h.idAperturaCuenta,versionActual:h.VersionActual,optionsApertura:a.pageOptions,aperturaCuenta:h,onClose:function(){$("html, body").animate({scrollTop:$(".cuenta").offset().top},1000);a.containerAperturasCuentas.show();a.containerAltaCuenta.hide()},onSave:function(k,l){$("html, body").animate({scrollTop:$(".cuenta").offset().top},1000);a.loadGrid()},container:a.containerAltaCuenta,idDefaultAccount:a.idDefaultAccount,idDefaultProfile:a.idDefaultProfile}).show()})}});b.push({width:45,field:"",title:" ",headerAttributes:c,columnTemplate:function(g,h,i){var f=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(g);f.on("click",function(){new Core.Controls.DetalleAperturaCuenta({idAperturaCuenta:h.idAperturaCuenta,overlayElement:f}).show()})}});if(a.pageOptions.reasignarAperturas){b.push({width:45,field:"",title:" ",headerAttributes:c,columnTemplate:function(g,h,i){var f=$('<button type="button" title="Reasignar Cuenta" class="btn-sm balanz-button"><span class="glyphicon glyphicon-share"></span></button>').appendTo(g);f.on("click",function(){var j=new Core.Ajax.ServerRequest({allowCache:true,secureRequest:true,requestUrl:"apertura/cuenta/parametrosusuario",requestType:"GET"});j.onSuccess=function(l){var k=new Core.Business.AperturasCuentas.ReasignarCuenta({onSave:function(){a.loadGrid()},unidadesDeNegocio:l.unidadesDeNegocio,idAperturaCuenta:h.idAperturaCuenta,overlayElement:f}).show()};j.request()})}})}a.divCuentas.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},exportOptions:{excel:{fileName:"Aperturas",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["idAperturaCuenta","VersionActual","Cuenta","email","Estado","Asesor","FechaConfirmacion","TiempoConfirmacion","TiempoSector","FechaUltimoCambioEstado","usuarioAsignado","Equipo","Productor"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Aperturas"}}},columns:b})};a.loadGrid=function(){var b=new Core.Ajax.ServerRequest({overlayElement:a.divCuentas.parent(),secureRequest:true,requestUrl:"apertura/cuenta/casos",requestType:"GET"});b.onSuccess=function(c){a.originalData=c;a.refresh()};b.request()};a.renderFilterNegocios=function(b){var c=[];$.each(b,function(d,e){if(c.indexOf(e.Negocio)<0){c.push(e.Negocio)}});a.divNegocios.empty();c.forEach(function(g,e){var d=$.grep(b,function(j,h){return j.Negocio==g}).length;var f=$("<label style='background-color: "+((a.negociosActivos[g]==false)?"transparent; ":"lightblue; ")+"margin: 8px 6px 8px 0; padding: 4px 5px; border: 1px solid #ccc;  font-weight: normal;' activo='"+((a.negociosActivos[g]==false)?"false":"true")+"' valor='"+g+"'>"+g+": <strong style='color: #333;'>"+d+"</strong></label>").appendTo(a.divNegocios);if(a.negociosActivos[g]==null){a.negociosActivos[g]=true}f.on("click",function(){Core.Functions.DynamicFilter.setFilter(f,"lightblue","transparent",a.negociosActivos);a.refresh()})})};a.renderFilterEstados=function(b){var c=[];$.each(b,function(d,e){if(c.indexOf(e.Estado)<0){c.push(e.Estado)}});a.divEstados.empty();c.forEach(function(g,e){var d=$.grep(b,function(j,h){return j.Estado==g}).length;var f=$("<label style='background-color: "+((a.estadosActivos[g]==false)?"transparent; ":"lightblue; ")+"margin: 8px 6px 8px 0; padding: 4px 5px; border: 1px solid #ccc;  font-weight: normal;' activo='"+((a.estadosActivos[g]==false)?"false":"true")+"' valor='"+g+"'>"+g+": <strong style='color: #333;'>"+d+"</strong></label>").appendTo(a.divEstados);if(a.estadosActivos[g]==null){a.estadosActivos[g]=true}f.on("click",function(){Core.Functions.DynamicFilter.setFilter(f,"lightblue","transparent",a.estadosActivos);a.refresh()})})};a.refresh=function(){a.renderFilterNegocios(a.originalData.casos);var e=Core.Functions.DynamicFilter.getActiveFilters(a.negociosActivos);var b=$.grep(a.originalData.casos,function(g,f){return e.indexOf(g.Negocio)>=0});a.renderFilterEstados(b);var c=Core.Functions.DynamicFilter.getActiveFilters(a.estadosActivos);b=$.grep(b,function(g,f){return c.indexOf(g.Estado)>=0});var d=a.divCuentas.swidget().initialOptions;d.dataSource.data=b;d.exportOptions.excel.dataSource.data=b;d.exportOptions.excel.readDataSource=true;a.divCuentas.swidget().refresh(d);a.txtFilter.keydown()}};Core.Business.AperturasCuentas.ReasignarCuenta=function(b){var a=this;a.divModal=$(".div-modal-reasignar-cuenta");a.title=null;a.ddlUnidadDeNegocio=null;a.txtMotivoReferenciaDeReasignacion=null;a.btnConfirmar=null;a.onSave=null;a.unidadesDeNegocio=null;a.idAperturaCuenta=null;a.overlayElement=null;$.extend(true,a,b);a.show=function(){a.title=a.divModal.find(".title");a.title.text("Reasignar Cuenta: "+a.idAperturaCuenta);a.ddlUnidadDeNegocio=a.divModal.find(".dropdown-unidad-de-negocio");Core.Functions.Validations.toggleValidation(a.ddlUnidadDeNegocio,false);a.ddlUnidadDeNegocio.shieldComboBox({dataSource:{data:a.unidadesDeNegocio},valueTemplate:"{idUnidadDeNegocio}",textTemplate:"{Descripcion}",enabled:(a.file==null),autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""}]}},value:""});a.txtMotivoReferenciaDeReasignacion=a.divModal.find(".textbox-motivo-referencia-de-reasignacion");Core.Functions.Validations.toggleValidation(a.txtMotivoReferenciaDeReasignacion,false);a.txtMotivoReferenciaDeReasignacion.shieldTextBox({value:""});a.btnConfirmar=a.divModal.find(".btn-confirmar");a.btnConfirmar.unbind("click");a.btnConfirmar.click(function(){Core.Functions.Validations.toggleValidation(a.ddlUnidadDeNegocio,false);if(!a.ddlUnidadDeNegocio.swidget().selectedItem()){Core.Functions.Validations.toggleValidation(a.ddlUnidadDeNegocio,true);return}if(a.txtMotivoReferenciaDeReasignacion.swidget().value()){new Core.Ajax.ServerRequest({showOverlay:false,secureRequest:true,requestUrl:"apertura/cuenta/observacion/"+a.idAperturaCuenta,requestType:"POST",requestData:{observacion:a.txtMotivoReferenciaDeReasignacion.swidget().value()}}).request()}var c=new Core.Ajax.ServerRequest({secureRequest:true,showOverlay:true,overlayElement:a.overlayElement,requestUrl:"apertura/cuenta/reasignar",requestType:"POST",requestData:{idAperturaCuenta:a.idAperturaCuenta,idUnidadDeNegocio:a.ddlUnidadDeNegocio.swidget().selectedItem().idUnidadDeNegocio}});c.onSuccess=function(d){if(a.onSave){a.onSave()}};c.request();a.divModal.modal("hide")});a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.divModal.modal({show:true})};a.destroy=function(){a.ddlUnidadDeNegocio.swidget().destroy();a.txtMotivoReferenciaDeReasignacion.swidget().destroy()}};Core.Business.AsignacionCuentas=new function(){var a=this;a.id="homeAsignacionCuentas";a.divMain=null;a.divCuentas=null;a.txtFilter=null;a.btnRefresh=null;a.btnActualizarVisualBolsa=null;a.btnInterfazVisualFondos=null;a.timeout=null;a.window=$(window);a.init=function(b,c){Core.loadPage("backoffice-asignacion-cuentas.html",function(){document.title="Asignación Cuentas";a.divMain=$(".div-main");a.divCuentas=$(".div-cuentas");a.txtFilter=$(".textbox-filter");a.btnRefresh=$(".btn-refresh");a.btnActualizarVisualBolsa=$(".btn-actualizar-visual-bolsa");a.btnInterfazVisualFondos=$(".btn-interfaz-visual-fondos");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadGrid()},"Core.Business.AsignacionCuentas")})};a.initControls=function(){a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var c=a.divCuentas.swidget().dataSource;if(value){c.filter={or:[{path:"idCuenta",filter:"contains",value:value},{path:"Descripcion",filter:"contains",value:value},{path:"Comitente",filter:"contains",value:value},{path:"Cuotapartista",filter:"contains",value:value},{path:"Estado",filter:"contains",value:value},{path:"Rol",filter:"contains",value:value},{path:"ValorPlataforma",filter:"contains",value:value},{path:"ValorBolsa",filter:"contains",value:value},{path:"ValorFondos",filter:"contains",value:value}]}}else{c.filter=null}c.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.AsignacionCuentas.txtFilter");a.btnRefresh.on("click",function(){a.loadGrid()});a.btnActualizarVisualBolsa.on("click",function(){var c=new Core.Ajax.ServerRequest({overlayElement:a.btnActualizarVisualBolsa,secureRequest:true,requestUrl:"asignacionCuentas/actualizarOficialesVBolsa",requestType:"POST"});c.onSuccess=function(d){new Core.Controls.ProcessProgress({idProcess:((d&&d.idProceso)?d.idProceso:0),overlayElement:a.divMain,onFinish:function(){a.loadGrid()}}).show()};c.request()});a.btnInterfazVisualFondos.on("click",function(){Core.Functions.File.download(a.btnInterfazVisualFondos,Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"asignacionCuentas/obtenerInterfazVFondos",function(){})});var b=[];b.push({field:"idCuenta",title:"ID Cuenta",width:"8%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Descripcion",title:"Descripción",width:"15%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Comitente",title:"Comitente",width:"8%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Cuotapartista",title:"Cuotapartista",width:"8%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Estado",title:"Estado",width:"8%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Rol",title:"Rol",width:"8%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"ValorPlataforma",title:"Plataforma",width:"15%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"ValorBolsa",width:"15%",title:"Bolsa",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),columnTemplate:function(c,d,e){if(d.ColorBolsa){c.css("background-color","rgba("+Core.Functions.grid.hexToRgb(d.ColorBolsa)+((e%2==0)?", 0.6":", 1 ")+")")}c.text(Core.Functions.grid.formatUndefinedString(d.ValorBolsa))}});b.push({field:"ValorFondos",width:"15%",title:"Fondos",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),columnTemplate:function(c,d,e){if(d.ColorFondos){c.css("background-color","rgba("+Core.Functions.grid.hexToRgb(d.ColorFondos)+((e%2==0)?", 0.6":", 1 ")+")")}c.text(Core.Functions.grid.formatUndefinedString(d.ValorFondos))}});a.divCuentas.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Asignación Cuentas",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["idCuenta","Descripcion","Comitente","Cuotapartista","Estado","Rol","ValorPlataforma","ValorBolsa","ValorFondos"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Acreditaciones"}}},paging:{pageSize:50,pageLinksCount:10},selection:false,rowHover:false,columns:b})};a.loadGrid=function(){var b=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divMain,secureRequest:true,requestUrl:"asignacionCuentas/obtenerDiferencias",requestType:"GET"});b.onSuccess=function(c){var d=a.divCuentas.swidget().initialOptions;d.dataSource.data=c.Cuentas;d.exportOptions.excel.dataSource.data=c.Cuentas;d.exportOptions.excel.readDataSource=true;a.divCuentas.swidget().refresh(d);a.txtFilter.keydown()};b.request()}};Core.Business.AsignacionMasivaFondos=new function(){var a=this;a.id="asignacionMasivaFondos";a.idDefaultAccount=null;a.idDefaultProfile=null;a.divOrigen=null;a.ddlOrigen=null;a.divAsesorOrigen=null;a.ddlAsesorOrigen=null;a.divListadoCuentas=null;a.ddlListadoCuentas=null;a.ddlAsesorDestino=null;a.btnRefresh=null;a.chkSoloErroresAdvertencias=null;a.btnDescargarArchivoFondos=null;a.divCuentas=null;a.eOrigen={Asesor:1,ListadoCuentas:2};a.init=function(b,c){Core.loadPage("backoffice-asignacion-masiva-fondos.html",function(){document.title="Asignación Masiva de Fondos";a.idDefaultAccount=b;a.idDefaultProfile=c;a.ddlOrigen=$(".div-origen");a.ddlOrigen=$(".dropdown-origen");a.divAsesorOrigen=$(".div-asesor-origen");a.ddlAsesorOrigen=$(".dropdown-asesor-origen");a.divListadoCuentas=$(".div-listado-cuentas");a.txtListadoCuentas=$(".text-listado-cuentas");a.ddlAsesorDestino=$(".dropdown-asesor-destino");a.btnRefresh=$(".btn-refresh");a.chkSoloErroresAdvertencias=$(".checkbox-solo-errores-advertencias");a.chkSoloErroresAdvertencias[0].checked=false;a.btnDescargarArchivoFondos=$(".btn-descargar-archivo-fondos");a.divCuentas=$(".div-cuentas");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadControls()},"Core.Business.AsignacionMasivaFondos")})};a.initControls=function(){a.divListadoCuentas.hide();a.ddlOrigen.shieldDropDown({dataSource:{data:[{value:a.eOrigen.Asesor,text:"Asesor"},{value:a.eOrigen.ListadoCuentas,text:"Listado de Cuotapartistas"}]},valueTemplate:"{value}",textTemplate:"{text}",value:a.eOrigen.Asesor.toString(),events:{select:function(b){a.divAsesorOrigen.hide();a.divListadoCuentas.hide();if(a.ddlOrigen.swidget().value()==a.eOrigen.Asesor){a.divAsesorOrigen.show()}else{a.divListadoCuentas.show()}}}});a.ddlAsesorOrigen.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idPersona}",textTemplate:"{NombreMostrar}",autoComplete:{enabled:true,filter:{or:[{path:"NombreMostrar",filter:"contains",value:""}]}},events:{select:function(b){a.loadCuentas()}}});a.txtListadoCuentas.shieldTextBox({value:"",events:{change:function(){a.loadCuentas()}}});a.ddlAsesorDestino.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idPersona}",textTemplate:"{NombreMostrar}",autoComplete:{enabled:true,filter:{or:[{path:"NombreMostrar",filter:"contains",value:""}]}}});a.btnRefresh.click(function(){a.loadCuentas()});a.chkSoloErroresAdvertencias.on("change",function(){a.setCuentas()});a.btnDescargarArchivoFondos.click(function(){a.descargarArchivoFondos()});a.divCuentas.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:50,pageLinksCount:10},noRecordsText:"No se encontraron cuentas",toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Asignación Masiva Fondos",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["Nombre","Cuotapartista","Comitente","Asesor","Equipo","FechaIngreso","Estado","Errores","Advertencias"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Asignación Masiva Fondos"}}},columns:[{field:"Nombre",title:"Nombre",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{field:"Cuotapartista",title:"Cuotapartista",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{field:"Comitente",title:"Comitente",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{field:"Asesor",title:"Asesor",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{field:"Equipo",title:"Equipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{field:"FechaIngreso",title:"Fecha Ingreso",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{field:"Estado",title:"Estado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{title:"Errores",field:"Errores",width:80,filterable:false,headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(b,d,c){if(d.Errores&&d.Errores!=""){var e=(d.Errores.length>140)?(d.Errores.substr(0,140)+"..."):(d.Errores);btnErrores=$('<button type="button" title="'+e+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-exclamation-sign"></span></button>').appendTo(b);btnErrores.addClass("link-cell");btnErrores.on("click",function(){var f=new Core.Controls.Dialog("Errores",(d.Errores)?d.Errores.replaceAll("\\|","<br />"):"",{displayButtons:{close:true,accept:false}});f.show()})}}},{title:"Advertencias",field:"Advertencias",width:80,filterable:false,headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(b,d,c){b.parent().css("background-color","rgba("+a.hexToRgb(d.Color)+((c%2==0)?", 0.6":", 1 ")+")");if(d.Advertencias&&d.Advertencias!=""){var e=(d.Advertencias.length>140)?(d.Advertencias.substr(0,140)+"..."):(d.Advertencias);btnAdvertencias=$('<button type="button" title="'+e+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-exclamation-sign"></span></button>').appendTo(b);btnAdvertencias.addClass("link-cell");btnAdvertencias.on("click",function(){var f=new Core.Controls.Dialog("Advertencias",(d.Advertencias)?d.Advertencias.replaceAll("\\|","<br />"):"",{displayButtons:{close:true,accept:false}});f.show()})}}}]})};a.loadControls=function(){var b=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"asignacionMasivaFondos/obtenerAsesores",requestType:"GET"});b.onSuccess=function(c){var e=a.ddlAsesorOrigen.swidget().initialOptions;e.dataSource.data=c.Asesores;a.ddlAsesorOrigen.swidget().refresh(e);var d=a.ddlAsesorDestino.swidget().initialOptions;d.dataSource.data=c.Asesores;a.ddlAsesorDestino.swidget().refresh(d)};b.request()};a.loadCuentas=function(){if((a.ddlOrigen.swidget().value()==a.eOrigen.Asesor&&a.ddlAsesorOrigen.swidget().selectedItem()&&a.ddlAsesorOrigen.swidget().value())||(a.ddlOrigen.swidget().value()==a.eOrigen.ListadoCuentas&&a.txtListadoCuentas.swidget().value())){var b=("idPersona="+((a.ddlOrigen.swidget().value()==a.eOrigen.Asesor)?encodeURIComponent(a.ddlAsesorOrigen.swidget().value()):"0"));if(a.ddlOrigen.swidget().value()==a.eOrigen.ListadoCuentas){b+="&Cuotapartistas="+a.txtListadoCuentas.swidget().value().replaceAll("\n","|")}var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"asignacionMasivaFondos/obtenerCuentas",requestType:"GET",requestData:b});c.onSuccess=function(d){a.cuentas=d.Cuentas;a.setCuentas()};c.request()}else{a.cuentas=[];a.setCuentas()}};a.setCuentas=function(){var b=a.cuentas;if(a.chkSoloErroresAdvertencias[0].checked){b=$.grep(b,function(e,d){return e.Errores||e.Advertencias})}var c=a.divCuentas.swidget().initialOptions;c.dataSource.data=b;c.exportOptions.excel.dataSource.data=b;c.exportOptions.excel.readDataSource=true;a.divCuentas.swidget().refresh(c)};a.descargarArchivoFondos=function(){if(a.ddlOrigen.swidget().value()==a.eOrigen.Asesor&&(!a.ddlAsesorOrigen.swidget().selectedItem()||!a.ddlAsesorOrigen.swidget().value())){new Core.Controls.Dialog("Mensaje","Debe seleccionar un Asesor de Origen.",{displayButtons:{close:true,accept:false}}).show();return}if(a.ddlOrigen.swidget().value()==a.eOrigen.ListadoCuentas&&!a.txtListadoCuentas.swidget().value()){new Core.Controls.Dialog("Mensaje","Debe ingresar un Listado de Cuentas.",{displayButtons:{close:true,accept:false}}).show();return}if(!a.ddlAsesorDestino.swidget().selectedItem()||!a.ddlAsesorDestino.swidget().value()){new Core.Controls.Dialog("Mensaje","Debe seleccionar un Asesor de Destino.",{displayButtons:{close:true,accept:false}}).show();return}if(a.ddlAsesorDestino.swidget().selectedItem()&&!a.ddlAsesorDestino.swidget().selectedItem().CodInterfaz){new Core.Controls.Dialog("Mensaje","El Asesor Destino seleccionado no tiene configurado un Código de Interfaz. Complete los datos y reinicie el proceso.",{displayButtons:{close:true,accept:false}}).show();return}function d(l){var k=new Blob([l.response],{type:l.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(k);return}var e=window.URL.createObjectURL(k);var j=document.createElement("a");j.href=e;var g=l.getResponseHeader("Content-Disposition").split("; ");var f="filename=file.DAT";for(var h=0;h<g.length;h++){if(g[h].indexOf("filename")>=0){f=g[h]}}j.download=f.split("=")[1];j.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(e)}var c=("idPersonaOrigen="+((a.ddlOrigen.swidget().value()==a.eOrigen.Asesor)?encodeURIComponent(a.ddlAsesorOrigen.swidget().value()):"0"));c+="&idPersonaDestino="+encodeURIComponent(a.ddlAsesorDestino.swidget().value());if(a.ddlOrigen.swidget().value()==a.eOrigen.ListadoCuentas){c+="&Cuotapartistas="+a.txtListadoCuentas.swidget().value().replaceAll("\n","|")}var b=new XMLHttpRequest();b.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"asignacionMasivaFondos/obtenerInterfazFondos?"+c,true);b.responseType="blob";b.setRequestHeader("Authorization",Core.Objects.Context.Token);b.onload=function(e){if(b.status==200){d(b)}else{var f=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga del comprobante.</p>",{displayButtons:{close:true,accept:false}});f.show()}};b.send()};a.hexToRgb=function(d){d=d.replace("#","");var f=parseInt(d.substring(0,2),16);var e=parseInt(d.substring(2,4),16);var c=parseInt(d.substring(4,6),16);var h=f+","+e+","+c;return h}};Core.Business.BCRAarchivoEECC=new function(){var a=this;a.id="homeBCRAarchivoEECC";a.idDefaultAccount=null;a.idDefaultProfile=null;a.btnConfirmarArchivos=null;a.inputFiles=null;a.pageOptions=null;a.window=$(window);a.init=function(b,c){Core.loadPage("backoffice-bcra-archivo-eecc.html",function(){document.title="Generar Archivo BCRA EECC";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.idDefaultAccount=b;a.idDefaultProfile=c;a.txtValidarDesde=$(".txt-validar-desde");a.txtValidarHasta=$(".txt-validar-hasta");a.btnConfirmarArchivos=$(".btn-confirmar-archivos");a.inputFiles=$(".input-upload-file");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){},"Core.Business.BCRAarchivoEECC")})};a.initControls=function(){var b=new Date();var c=new Date(b.getFullYear(),b.getMonth()-5,1);var d=new Date(b.getFullYear(),b.getMonth()+1,0);a.txtValidarDesde.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:c});a.txtValidarHasta.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:d});a.btnConfirmarArchivos.on("click",function(){if(!a.txtValidarDesde.swidget().value()||!a.txtValidarHasta.swidget().value()){new Core.Controls.Dialog("Aviso","<p>Debe seleccionar un rango de fechas.</p>",{displayButtons:{close:true,accept:false}}).show();return}if(a.inputFiles[0].files.length!=1){new Core.Controls.Dialog("Aviso","<p>Debe seleccionar un único archivo.</p>",{displayButtons:{close:true,accept:false}}).show();return}for(var l=0,h;h=a.inputFiles[0].files[l];l++){var j=h.name.split(".");var g=j[j.length-1];if(g!="xls"&&g!="xlsx"){new Core.Controls.Dialog("Aviso","<p>El archivo seleccionado deben ser: xls o xlsx.</p>",{displayButtons:{close:true,accept:false}}).show();return}}var k={Authorization:Core.Objects.Context.Token,Accept:"application/json"};var e=new FormData();for(var l=0,h;h=a.inputFiles[0].files[l];l++){e.append("file-"+l,h)}var m=new Core.Controls.Overlay(a.btnConfirmarArchivos,{});$.ajax({type:"POST",url:Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"upload/csv/generarTxtBCRA/"+Core.Functions.Date.getDisplayDateWithSeparator(a.txtValidarDesde.swidget().value(),"-")+"/"+Core.Functions.Date.getDisplayDateWithSeparator(a.txtValidarHasta.swidget().value(),"-"),data:e,cache:false,contentType:false,processData:false,method:"POST",headers:k,success:function(f){if(f.nombreArchivo){Core.Functions.File.download(a.btnConfirmarArchivos,Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"download/descargarTxtBCRA/"+f.nombreArchivo,function(){})}a.inputFiles.val("");m.destroy()},error:function(i){var o=JSON.parse(i.responseText);var p=(o&&o.descripcion)?"Mensaje":"Error de conexión";var f=(o&&o.descripcion)?o.descripcion:"Algunos componentes de la página no se cargaron correctamente. Por favor intente mas tarde...";var n=new Core.Controls.Dialog(p,'<p style="word-wrap: break-word;">'+f+"</p>",{displayButtons:{close:true,accept:false}});n.show();m.destroy()}})})}};Core.Business.CierrePrecios=new function(){var a=this;a.id="homeCierrePrecios";a.idDefaultAccount=null;a.idDefaultProfile=null;a.divButtons=null;a.btnBloomberg=null;a.btnCierres=null;a.btnCierresFondosBCV=null;a.btnCierresFondosBCI=null;a.liBloomberg=null;a.liCierres=null;a.liCierresFondosBCV=null;a.liCierresFondosBCI=null;a.divContainerArchivosBloomberg=null;a.btnConfirmarArchivosBloomberg=null;a.inputFilesBloomberg=null;a.txtDateBloomberg=null;a.lblTitleBloomberg=null;a.divBloomberg=null;a.txtFilterBloomberg=null;a.btnDescargarExcelBloomberg=null;a.timeoutBloomberg=null;a.monedasBloomberg=[];a.txtDateCierres=null;a.lblTitleCierres=null;a.divCierres=null;a.txtFilterCierres=null;a.timeoutCierres=null;a.btnCierresExportarPreciosIsin=null;a.btnCierresExportarPreciosBolsa=null;a.btnCierresExportarFTFPreciosBolsa=null;a.btnCierresExportarPreciosPanama=null;a.txtDateCierresFondosBCV=null;a.lblTitleCierresFondosBCV=null;a.divCierresFondosBCV=null;a.btnDescargarExcelCierresFondosBCV=null;a.timeoutCierresFondosBCV=null;a.monedasCierresFondosBCV=[];a.txtDateCierresFondosBCI=null;a.lblTitleCierresFondosBCI=null;a.divCierresFondosBCI=null;a.btnDescargarExcelCierresFondosBCI=null;a.timeoutCierresFondosBCI=null;a.monedasCierresFondosBCI=[];a.pageOptions=null;a.window=$(window);a.init=function(b,c){Core.loadPage("backoffice-cierre-precios.html",function(){document.title="Cierre Precios";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.idDefaultAccount=b;a.idDefaultProfile=c;a.divButtons=$(".div-buttons");a.liBloomberg=$(".li-bloomberg");a.btnBloomberg=$(".btn-bloomberg");a.btnBloomberg.on("click",function(){a.loadGridBloomberg()});a.liCierres=$(".li-cierres");a.btnCierres=$(".btn-cierres");a.btnCierres.on("click",function(){a.loadGridCierres()});a.liCierresFondosBCV=$(".li-cierres-fondos-bcv");a.btnCierresFondosBCV=$(".btn-cierres-fondos-bcv");a.btnCierresFondosBCV.on("click",function(){a.loadGridCierresFondosBCV()});a.liCierresFondosBCI=$(".li-cierres-fondos-bci");a.btnCierresFondosBCI=$(".btn-cierres-fondos-bci");a.btnCierresFondosBCI.on("click",function(){a.loadGridCierresFondosBCI()});a.liBloomberg.hide();a.liCierres.hide();a.liCierresFondosBCV.hide();a.liCierresFondosBCI.hide();if(a.pageOptions.cierrePreciosAdmin){a.liBloomberg.show();a.liCierres.show()}if(a.pageOptions.cierrePrecios){a.liCierres.show()}if(a.pageOptions.cierrePreciosFondos){a.liCierresFondosBCV.show();a.liCierresFondosBCI.show()}a.divButtons.show();if(!a.pageOptions.cierrePreciosAdmin&&(!a.pageOptions.cierrePrecios||!a.pageOptions.cierrePreciosFondos)){a.divButtons.hide()}a.divContainerArchivosBloomberg=$(".div-bloomberg-container-archivos");a.btnConfirmarArchivosBloomberg=$(".btn-bloomberg-confirmar-archivos");a.inputFilesBloomberg=$(".input-bloomberg-upload-file");a.txtDateBloomberg=$(".date-picker-bloomberg");a.lblTitleBloomberg=$(".label-title-bloomberg");a.divBloomberg=$(".div-bloomberg");a.txtFilterBloomberg=$(".textbox-filter-bloomberg");a.btnDescargarExcelBloomberg=$(".btn-bloomberg-descargar-excel");a.initControlsBloomberg();a.txtDateCierres=$(".date-picker-cierres");a.lblTitleCierres=$(".label-title-cierres");a.divCierres=$(".div-cierres");a.txtFilterCierres=$(".textbox-filter-cierres");a.btnCierresExportarPreciosIsin=$(".btn-cierres-exportar-precios-isin");a.btnCierresExportarPreciosIsin.hide();a.btnCierresExportarPreciosBolsa=$(".btn-cierres-exportar-precios-bolsa");a.btnCierresExportarPreciosBolsa.hide();a.btnCierresExportarFTFPreciosBolsa=$(".btn-cierres-exportar-ftf-precios-bolsa");a.btnCierresExportarFTFPreciosBolsa.hide();a.btnCierresExportarPreciosPanama=$(".btn-cierres-exportar-precios-panama");a.btnCierresExportarPreciosPanama.hide();a.initControlsCierres();a.txtDateCierresFondosBCV=$(".date-picker-cierres-fondos-bcv");a.lblTitleCierresFondosBCV=$(".label-title-cierres-fondos-bcv");a.divCierresFondosBCV=$(".div-cierres-fondos-bcv");a.btnDescargarExcelCierresFondosBCV=$(".btn-cierres-fondos-bcv-descargar-excel");a.initControlsCierresFondosBCV();a.txtDateCierresFondosBCI=$(".date-picker-cierres-fondos-bci");a.lblTitleCierresFondosBCI=$(".label-title-cierres-fondos-bci");a.divCierresFondosBCI=$(".div-cierres-fondos-bci");a.btnDescargarExcelCierresFondosBCI=$(".btn-cierres-fondos-bci-descargar-excel");a.initControlsCierresFondosBCI();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){if(a.pageOptions.cierrePreciosAdmin){a.btnBloomberg.click()}else{if(a.pageOptions.cierrePrecios){a.btnCierres.click()}else{if(a.pageOptions.cierrePreciosFondos){a.btnCierresFondosBCV.click()}}}},"Core.Business.CierrePrecios")})};a.initControlsBloomberg=function(){a.txtDateBloomberg.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loadGridBloomberg()}}});a.btnConfirmarArchivosBloomberg.on("click",function(){if(!a.txtDateBloomberg.swidget().value()){new Core.Controls.Dialog("Aviso","<p>Debe seleccionar una fecha.</p>",{displayButtons:{close:true,accept:false}}).show();return}if(!a.inputFilesBloomberg[0].files.length){new Core.Controls.Dialog("Aviso","<p>Debe seleccionar al menos un archivo.</p>",{displayButtons:{close:true,accept:false}}).show();return}for(var j=0,e;e=a.inputFilesBloomberg[0].files[j];j++){var g=e.name.split(".");var d=g[g.length-1];if(d!="xlsx"&&d!="csv"){new Core.Controls.Dialog("Aviso","<p>Los archivos seleccionados deben ser: xlsx o csv.</p>",{displayButtons:{close:true,accept:false}}).show();return}}var h={Authorization:Core.Objects.Context.Token,Accept:"application/json"};var c=new FormData();for(var j=0,e;e=a.inputFilesBloomberg[0].files[j];j++){c.append("file-"+j,e)}var k=new Core.Controls.Overlay(a.divContainerArchivosBloomberg,{});$.ajax({type:"POST",url:Core.Origin+"/backoffice/api/v1/upload/csv/cafci/"+a.getFormatDate(a.txtDateBloomberg.swidget().value()),data:c,cache:false,contentType:false,processData:false,method:"POST",headers:h,success:function(f){a.inputFilesBloomberg.val("");a.loadGridBloomberg();k.destroy()},error:function(i){var m=JSON.parse(i.responseText);var n=(m&&m.descripcion)?"Mensaje":"Error de conexión";var f=(m&&m.descripcion)?m.descripcion:"Algunos componentes de la página no se cargaron correctamente. Por favor intente mas tarde...";var l=new Core.Controls.Dialog(n,"<p>"+f+"</p>",{displayButtons:{close:true,accept:false}});l.show();k.destroy()}})});var b=[];b.push({field:"ticker",title:"Ticker",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"isin",title:"Isin",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"fecha",title:"Fecha",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"precio",title:"Precio",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatPrice});b.push({field:"moneda",title:"Moneda",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"plazo",title:"Plazo",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatIntegerNumber});b.push({field:"tipo_precio",title:"Tipo Precio",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"nominales",title:"Nominales",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatNuleableIntegerNumber});b.push({field:"apertura",title:"Apertura",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatPrice});b.push({field:"maximo",title:"Máximo",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatPrice});b.push({field:"minimo",title:"Mínimo",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatPrice});a.divBloomberg.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:b,paging:{pageSize:100,pageLinksCount:10}});a.txtFilterBloomberg.on("keydown",function(){clearTimeout(a.timeoutBloomberg);a.timeoutBloomberg=setTimeout(function(){value=a.txtFilterBloomberg.val();var c=a.divBloomberg.swidget().dataSource;if(value){c.filter={or:[{path:"ticker",filter:"contains",value:value},{path:"isin",filter:"contains",value:value}]}}else{c.filter=null}c.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilterBloomberg,"Core.Business.Acreditaciones.txtFilterBloomberg");a.btnDescargarExcelBloomberg.on("click",function(){Core.Functions.File.download(a.btnDescargarExcelBloomberg,Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"download/bloom",function(){})})};a.loadGridBloomberg=function(){var b=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"cierrePrecios/cotizacionBloomberg/"+a.getFormatDate(a.txtDateBloomberg.swidget().value()),requestType:"GET"});b.onSuccess=function(c){a.lblTitleBloomberg.text("Al "+Core.Functions.Date.getDisplayDate(a.txtDateBloomberg.swidget().value()));var d=a.divBloomberg.swidget().initialOptions;d.dataSource.data=c.coti_bloom;a.divBloomberg.swidget().refresh(d);a.txtFilterBloomberg.keydown();a.monedasBloomberg=c.moneda_bloom};b.request()};a.initControlsCierres=function(){var c=new Date();if(c.getHours()<17){c.setDate(c.getDate()-1)}a.txtDateCierres.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:c,max:new Date(),events:{change:function(d){a.loadGridCierres()}}});var b=[];b.push({field:"isin",title:"Isin",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"moneda",title:"Moneda",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatIntegerNumber});b.push({field:"plazo",title:"Plazo",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatIntegerNumber});b.push({field:"precio",title:"Precio",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatPrice});b.push({field:"precio_maximo",title:"Precio Máximo",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatPrice});b.push({field:"precio_minimo",title:"Precio Mínimo",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatPrice});b.push({field:"total_nominal",title:"Total Nominal",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatNuleableIntegerNumber});b.push({field:"fecha",title:"Fecha",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"fecha_cierre",title:"Fecha Cierre",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"teorico",title:"Teórico",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatBoolean});b.push({field:"fuente",title:"Fuente",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"ticker",title:"Ticker",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"tipo_precio",title:"Tipo Precio",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"variacion",title:"Variación",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"precio_dolar",title:"Precio Dólar",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatPrice});b.push({field:"precio_pesos",title:"Precio Pesos",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatPrice});b.push({field:"lamina",title:"Lámina",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatPrice});a.divCierres.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar Precios"}]}],columns:b,paging:{pageSize:100,pageLinksCount:10},exportOptions:{excel:{fileName:"Cierres",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["isin","moneda","plazo","precio","precio_maximo","precio_minimo","total_nominal","fecha","fecha_cierre","teorico","fuente","ticker","tipo_precio","variacion","precio_dolar","precio_pesos","lamina"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Cierres"}}}});a.txtFilterCierres.on("keydown",function(){clearTimeout(a.timeoutCierres);a.timeoutCierres=setTimeout(function(){value=a.txtFilterCierres.val();var d=a.divCierres.swidget().dataSource;if(value){d.filter={or:[{path:"ticker",filter:"contains",value:value},{path:"isin",filter:"contains",value:value}]}}else{d.filter=null}d.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilterCierres,"Core.Business.Acreditaciones.txtFilterCierres");a.btnCierresExportarPreciosIsin.on("click",function(){Core.Functions.File.download(a.btnCierresExportarPreciosIsin,Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+("download/cotizacionesBolsaIS?fecha="+a.getFormatDate(a.txtDateCierres.swidget().value())),function(){})});a.btnCierresExportarPreciosBolsa.on("click",function(){Core.Functions.File.download(a.btnCierresExportarPreciosBolsa,Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+("download/cotizacionesBolsa?fecha="+a.getFormatDate(a.txtDateCierres.swidget().value())),function(){})});a.btnCierresExportarFTFPreciosBolsa.on("click",function(){Core.Functions.File.download(a.btnCierresExportarFTFPreciosBolsa,Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+("cierrePrecios/cotizacionesbolsaFTF/"+a.getFormatDate(a.txtDateCierres.swidget().value())),function(){})});a.btnCierresExportarPreciosPanama.on("click",function(){Core.Functions.File.download(a.btnCierresExportarPreciosPanama,Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+("download/cotizacionesBolsaPan?fecha="+a.getFormatDate(a.txtDateCierres.swidget().value())),function(){})})};a.loadGridCierres=function(){a.lblTitleCierres.text("Al "+Core.Functions.Date.getDisplayDate(a.txtDateCierres.swidget().value()));var b=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"cierrePrecios/"+a.getFormatDate(a.txtDateCierres.swidget().value()),requestType:"GET"});b.onSuccess=function(c){a.refreshGridCierres(c.cotizaciones_cierres?c.cotizaciones_cierres:[])};b.onError=function(d){a.refreshGridCierres([]);var g=(d.responseJSON&&d.responseJSON.Descripcion)?"Mensaje":"Error de conexión";var c=(d.responseJSON&&d.responseJSON.Descripcion)?d.responseJSON.Descripcion:"Algunos componentes de la página no se cargaron correctamente. Por favor intente mas tarde...";var f=new Core.Controls.Dialog(g,"<p>"+c+"</p>",{displayButtons:{close:true,accept:false}});f.show()};b.request()};a.refreshGridCierres=function(b){var c=a.divCierres.swidget().initialOptions;c.dataSource.data=b;c.exportOptions.excel.dataSource.data=b;c.exportOptions.excel.readDataSource=true;a.divCierres.swidget().refresh(c);a.btnCierresExportarPreciosIsin.hide();a.btnCierresExportarPreciosBolsa.hide();a.btnCierresExportarFTFPreciosBolsa.hide();a.btnCierresExportarPreciosPanama.hide();if(b.length>0){if(a.pageOptions.cierrePreciosBtnPreciosBolsaPan){a.btnCierresExportarPreciosPanama.show()}if(a.pageOptions.cierrePreciosBtnPreciosBolsa){a.btnCierresExportarPreciosBolsa.show();a.btnCierresExportarFTFPreciosBolsa.show()}if(a.pageOptions.cierrePreciosBtnPreciosBolsaISIN){a.btnCierresExportarPreciosIsin.show()}}a.txtFilterCierres.keydown()};a.initControlsCierresFondosBCV=function(){a.txtDateCierresFondosBCV.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loadGridCierresFondosBCV()}}});var b=[];b.push({field:"CodCAFCI",title:"Cod CAFCI",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"ValorCP",title:"Valor CP",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});a.divCierresFondosBCV.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:b,paging:{pageSize:100,pageLinksCount:10}});a.btnDescargarExcelCierresFondosBCV.on("click",function(){Core.Functions.File.download(a.btnDescargarExcelCierresFondosBCV,Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"download/valuacionCuotaparteCafci/Bloom/"+a.getFormatDate(a.txtDateCierresFondosBCV.swidget().value())+"?idNegocio="+Core.Enums.eNegocio.BCV,function(){})})};a.loadGridCierresFondosBCV=function(){var b=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"cuotapartescafci/valores/bloomberg/"+a.getFormatDate(a.txtDateCierresFondosBCV.swidget().value()),requestType:"GET",requestData:{idNegocio:Core.Enums.eNegocio.BCV}});b.onSuccess=function(c){a.lblTitleCierresFondosBCV.text("Al "+Core.Functions.Date.getDisplayDate(a.txtDateCierresFondosBCV.swidget().value()));var d=a.divCierresFondosBCV.swidget().initialOptions;d.dataSource.data=c.Valores;a.divCierresFondosBCV.swidget().refresh(d)};b.request()};a.initControlsCierresFondosBCI=function(){a.txtDateCierresFondosBCI.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loadGridCierresFondosBCI()}}});var b=[];b.push({field:"CodCAFCI",title:"Cod CAFCI",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"ValorCP",title:"Valor CP",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});a.divCierresFondosBCI.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:b,paging:{pageSize:100,pageLinksCount:10}});a.btnDescargarExcelCierresFondosBCI.on("click",function(){Core.Functions.File.download(a.btnDescargarExcelCierresFondosBCI,Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"download/valuacionCuotaparteCafci/Bloom/"+a.getFormatDate(a.txtDateCierresFondosBCI.swidget().value())+"?idNegocio="+Core.Enums.eNegocio.BCI,function(){})})};a.loadGridCierresFondosBCI=function(){var b=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"cuotapartescafci/valores/bloomberg/"+a.getFormatDate(a.txtDateCierresFondosBCI.swidget().value()),requestType:"GET",requestData:{idNegocio:Core.Enums.eNegocio.BCI}});b.onSuccess=function(c){a.lblTitleCierresFondosBCI.text("Al "+Core.Functions.Date.getDisplayDate(a.txtDateCierresFondosBCI.swidget().value()));var d=a.divCierresFondosBCI.swidget().initialOptions;d.dataSource.data=c.Valores;a.divCierresFondosBCI.swidget().refresh(d)};b.request()};a.getFormatDate=function(b){if(!b){return""}return b.getFullYear().toString()+"-"+Core.Functions.Date.getTwoCharsNumber(b.getMonth()+1)+"-"+Core.Functions.Date.getTwoCharsNumber(b.getDate())}};Core.Business.CierrePrecios.EditarBloomberg=function(b){var a=this;a.divModal=$(".div-editar-bloomberg");a.lblTitle=null;a.lblTicker=null;a.lblIsin=null;a.lblFecha=null;a.txtPrecio=null;a.ddlMoneda=null;a.txtPlazo=null;a.ddlTipoPrecio=null;a.ddlNominales=null;a.txtApertura=null;a.txtMaximo=null;a.txtMinimo=null;a.operacion=null;a.onSave=function(){};a.monedas=null;$.extend(true,a,b);a.show=function(){a.lblTitle=a.divModal.find(".title");a.lblTitle.text("Editar Operación");a.lblTicker=a.divModal.find(".label-operacion-ticker");a.lblIsin=a.divModal.find(".label-operacion-isin");a.lblFecha=a.divModal.find(".label-operacion-fecha");a.txtPrecio=a.divModal.find(".textbox-operacion-precio");a.ddlMoneda=a.divModal.find(".dropdown-operacion-moneda");a.txtPlazo=a.divModal.find(".textbox-operacion-plazo");a.ddlTipoPrecio=a.divModal.find(".dropdown-operacion-tipo-precio");a.ddlNominales=a.divModal.find(".dropdown-operacion-nominales");a.txtApertura=a.divModal.find(".textbox-operacion-apertura");a.txtMaximo=a.divModal.find(".textbox-operacion-maximo");a.txtMinimo=a.divModal.find(".textbox-operacion-minimo");a.lblTicker.text((a.operacion)?a.operacion.ticker:"");a.lblIsin.text((a.operacion)?a.operacion.isin:"");a.lblFecha.text((a.operacion)?a.operacion.fecha:"");a.ddlNominales.shieldDropDown({dataSource:{data:[{value:1,text:"1"},{value:100,text:"100"}]},textTemplate:"{value}",valueTemplate:"{text}",value:(a.operacion)?a.operacion.nominales.toString():""});a.ddlMoneda.shieldDropDown({dataSource:{data:a.monedas},textTemplate:"{descripcion}",valueTemplate:"{descripcion}",value:(a.operacion)?a.operacion.moneda:""});a.ddlTipoPrecio.shieldDropDown({dataSource:{data:[{value:"CLEAN",text:"CLEAN"},{value:"DIRTY",text:"DIRTY"}]},textTemplate:"{value}",valueTemplate:"{text}",value:(a.operacion)?a.operacion.tipo_precio:""});new Core.Controls.DecimalPicker(a.txtPrecio,{maxDecimalDigitCount:2,showThousandsSeparator:"",defaultValue:(a.operacion)?a.operacion.precio:""});new Core.Controls.DecimalPicker(a.txtPlazo,{maxDecimalDigitCount:0,showThousandsSeparator:"",defaultValue:""});if(a.operacion){a.txtPlazo.val(a.operacion.plazo)}new Core.Controls.DecimalPicker(a.txtApertura,{maxDecimalDigitCount:2,showThousandsSeparator:"",defaultValue:(a.operacion)?a.operacion.apertura:""});new Core.Controls.DecimalPicker(a.txtMaximo,{maxDecimalDigitCount:2,showThousandsSeparator:"",defaultValue:(a.operacion)?a.operacion.maximo:""});new Core.Controls.DecimalPicker(a.txtMinimo,{maxDecimalDigitCount:2,showThousandsSeparator:"",defaultValue:(a.operacion)?a.operacion.minimo:""});a.btnConfirmar=a.divModal.find(".btn-confirmar");a.btnConfirmar.unbind("click");a.btnConfirmar.click(function(){var c={coti_bloom:[{isin:a.operacion.isin,fecha:a.operacion.fecha,precio:a.txtPrecio.val(),moneda:a.ddlMoneda.swidget().selectedItem()?a.ddlMoneda.swidget().value():"",plazo:a.txtPlazo.val(),tipo_precio:a.ddlTipoPrecio.swidget()?a.ddlTipoPrecio.swidget().value():"",nominales:a.ddlNominales.swidget()?a.ddlNominales.swidget().value():"",apertura:a.txtApertura.val(),maximo:a.txtMaximo.val(),minimo:a.txtMinimo.val()}]};var d=new Core.Ajax.ServerRequest({overlayElement:a.btnConfirmar,secureRequest:true,requestUrl:"cierrePrecios/cotizacionBloomberg/modificar",requestType:"POST",requestData:c});d.onSuccess=function(){a.divModal.modal("hide");a.onSave()};d.request()});a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.divModal.modal({show:true})};a.destroy=function(){a.ddlMoneda.swidget().destroy();a.ddlNominales.swidget().destroy();a.ddlTipoPrecio.swidget().destroy()}};Core.Business.CierrePrecios.EditarCierre=function(b){var a=this;a.divModal=$(".div-editar-cierre");a.lblTitle=null;a.lblIsin=null;a.txtPrecio=null;a.ddlMoneda=null;a.txtPlazo=null;a.operacion=null;a.onSave=function(){};$.extend(true,a,b);a.show=function(){a.lblTitle=a.divModal.find(".title");a.lblTitle.text("Editar Operación");a.lblIsin=a.divModal.find(".label-operacion-isin");a.txtPrecio=a.divModal.find(".textbox-operacion-precio");a.ddlMoneda=a.divModal.find(".dropdown-operacion-moneda");a.txtPlazo=a.divModal.find(".textbox-operacion-plazo");a.lblIsin.text((a.operacion)?a.operacion.isin:"");a.ddlMoneda.shieldDropDown({dataSource:{data:[Core.Enums.Currency.Pesos,Core.Enums.Currency.Dolares]},textTemplate:"{Descripcion}",valueTemplate:"{idMoneda}",value:(a.operacion)?a.operacion.moneda.toString():""});new Core.Controls.DecimalPicker(a.txtPrecio,{maxDecimalDigitCount:2,showThousandsSeparator:"",defaultValue:(a.operacion)?a.operacion.precio:""});new Core.Controls.DecimalPicker(a.txtPlazo,{maxDecimalDigitCount:0,showThousandsSeparator:"",defaultValue:""});if(a.operacion){a.txtPlazo.val(a.operacion.plazo)}a.btnConfirmar=a.divModal.find(".btn-confirmar");a.btnConfirmar.unbind("click");a.btnConfirmar.click(function(){var c={cotizaciones_cierres:[{isin:a.operacion.isin,fecha:a.operacion.fecha,precio:a.txtPrecio.val(),moneda:a.ddlMoneda.swidget().selectedItem()?a.ddlMoneda.swidget().value():"",plazo:a.txtPlazo.val()}]};var d=new Core.Ajax.ServerRequest({overlayElement:a.btnConfirmar,secureRequest:true,requestUrl:"cierrePrecios/modificar",requestType:"POST",requestData:c});d.onSuccess=function(){a.divModal.modal("hide");a.onSave()};d.request()});a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.divModal.modal({show:true})};a.destroy=function(){a.ddlMoneda.swidget().destroy()}};Core.Business.ComisionesFondosACDI=new function(){var a=this;a.id="homeComisionesFondosACDI";a.init=function(b,c){Core.loadPage("backoffice-comisiones-fondos-acdi.html",function(){document.title="Comisiones Fondos ACDI";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divMain=$(".div-main");a.divContainerArchivos=$(".div-container-archivos");a.divContainerArchivos.show();a.divContainerDetalleArchivo=$(".div-container-detalle-archivo");a.divContainerDetalleArchivo.hide();a.divArchivos=$(".div-archivos");a.inputFiles=$(".input-upload-file");a.btnConfirmarArchivo=$(".btn-confirmar-archivo");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.ComisionesFondosACDI")})};a.initControls=function(){var b=[];b.push({width:"50%",field:"nombre_archivo",title:"Nombre Archivo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"25%",field:"fecha_carga",title:"Fecha Carga",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatStringDateWithTime});b.push({width:"25%",field:"cantidad",title:"Cantidad Fondos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({width:45,title:" ",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,e,f){var c=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(d);c.on("click",function(){new Core.Business.ComisionesFondosACDI.Detalle({idArchivo:e.idarchivo,overlayElement:c,onLoad:function(){a.divContainerArchivos.hide()},onClosed:function(){a.loadGrid();a.divContainerArchivos.show()}}).show()})}});a.divArchivos.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:b});a.btnConfirmarArchivo.on("click",function(){if(a.inputFiles[0].files.length!=1){new Core.Controls.Dialog("Aviso","<p>Debe seleccionar un único archivo.</p>",{displayButtons:{close:true,accept:false}}).show();return}for(var g=0,d;d=a.inputFiles[0].files[g];g++){var e=d.name.split(".");var c=e[e.length-1];if(c!="xls"&&c!="xlsx"){new Core.Controls.Dialog("Aviso","<p>El archivo seleccionado deben ser: xls o xlsx.</p>",{displayButtons:{close:true,accept:false}}).show();return}}new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea cargar el archivo: "+a.inputFiles[0].files[0].name+"?",{onAccepted:function(){var k={Authorization:Core.Objects.Context.Token,Accept:"application/json"};var h=new FormData();for(var l=0,j;j=a.inputFiles[0].files[l];l++){h.append("file-"+l,j)}var m=new Core.Controls.Overlay(a.btnConfirmarArchivo,{});$.ajax({type:"POST",url:Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"upload/csv/ComisionesFondosACDI/CargarArchivos",data:h,cache:false,contentType:false,processData:false,method:"POST",headers:k,success:function(f){a.loadGrid();a.inputFiles.val("");m.destroy()},error:function(i){var o=JSON.parse(i.responseText);var p=(o&&o.Descripcion)?"Mensaje":"Error de conexión";var f=(o&&o.Descripcion)?o.Descripcion:"Algunos componentes de la página no se cargaron correctamente. Por favor intente mas tarde...";var n=new Core.Controls.Dialog(p,'<p style="word-wrap: break-word;">'+f+"</p>",{displayButtons:{close:true,accept:false}});n.show();m.destroy()}})}}).show()})};a.loadGrid=function(){var b=new Core.Ajax.ServerRequest({overlayElement:a.divMain,secureRequest:true,requestUrl:"ComisionesFondosACDI/ListarArchivos",requestType:"GET"});b.onSuccess=function(c){var d=a.divArchivos.swidget().initialOptions;d.dataSource.data=(c.Archivos?c.Archivos:[]);a.divArchivos.swidget().refresh(d)};b.request()}};Core.Business.ComisionesFondosACDI.Detalle=function(b){var a=this;a.container=$(".div-container-detalle-archivo");a.onLoad=function(){};a.onClosed=function(){};a.idArchivo=null;a.overlayElement=null;$.extend(true,a,b);a.show=function(){a.initControls();a.loadGrids()};a.initControls=function(){a.lblTitle=a.container.find(".lbl-title");a.lblTitle.text("Detalle Archivo: "+a.idArchivo);var c=[];c.push({width:"35%",field:"fondo",title:"Fondo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"10%",field:"ctte_num",title:"CTTE Número",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"35%",field:"ctte_desc",title:"CTTE Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"10%",field:"importe",title:"Importe",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatDecimal});c.push({width:"10%",field:"moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});a.divComisiones=a.container.find(".div-comisiones");a.divComisiones.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],paging:{pageSize:50,pageLinksCount:10},exportOptions:{excel:{fileName:"Comisiones",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["fondo","ctte_num","ctte_desc","importe","moneda"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Comisiones"}}},selection:false,rowHover:false,columns:c});var d=[];d.push({width:"20%",field:"fondo",title:"Fondo",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedString});d.push({width:"20%",field:"fechadesde",title:"Fecha Desde",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedString});d.push({width:"20%",field:"fechahasta",title:"Fecha Hasta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedString});d.push({width:"20%",field:"importe",title:"Importe",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatDecimal});d.push({width:"20%",field:"moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedString});a.divDetalles=a.container.find(".div-detalles");a.divDetalles.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],paging:{pageSize:50,pageLinksCount:10},exportOptions:{excel:{fileName:"Detalles",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["fondo","fechadesde","fechahasta","importe","moneda"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Detalles"}}},selection:false,rowHover:false,columns:d});a.btnEliminarArchivo=a.container.find(".btn-eliminar-archivo");a.btnEliminarArchivo.unbind("click");a.btnEliminarArchivo.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar el archivo?",{onAccepted:function(){var e=new Core.Ajax.ServerRequest({overlayElement:a.btnEliminarArchivo,requestUrl:"ComisionesFondosACDI/EliminarArchivo/"+a.idArchivo,requestType:"DELETE"});e.onSuccess=function(){a.destroy()};e.request()}}).show()});a.btnVolver=a.container.find(".btn-volver");a.btnVolver.unbind("click");a.btnVolver.on("click",function(){a.destroy()})};a.loadGrids=function(c){var d=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.overlayElement,requestUrl:"ComisionesFondosACDI/ObtenerArchivo/"+a.idArchivo,requestType:"GET"});d.onSuccess=function(f){var e=(f.Comisiones?f.Comisiones:[]);var h=a.divComisiones.swidget().initialOptions;h.dataSource.data=e;h.exportOptions.excel.dataSource.data=e;h.exportOptions.excel.readDataSource=true;a.divComisiones.swidget().refresh(h);var g=(f.Archivo?f.Archivo:[]);var h=a.divDetalles.swidget().initialOptions;h.dataSource.data=g;h.exportOptions.excel.dataSource.data=g;h.exportOptions.excel.readDataSource=true;a.divDetalles.swidget().refresh(h);a.onLoad();a.container.show()};d.request()};a.destroy=function(){a.divComisiones.swidget().destroy();a.divDetalles.swidget().destroy();a.container.hide();a.onClosed()}};Core.Business.CompararMovBCRA=new function(){var a=this;a.id="homeCompararMovBCRA";a.idDefaultAccount=null;a.idDefaultProfile=null;a.btnConfirmarArchivos=null;a.inputFiles=null;a.divDescripcion=null;a.pageOptions=null;a.window=$(window);a.init=function(b,c){Core.loadPage("backoffice-comparar-movimientos-bcra.html",function(){document.title="Operaciones de Cambio";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.idDefaultAccount=b;a.idDefaultProfile=c;a.btnConfirmarArchivos=$(".btn-confirmar-archivos");a.inputFiles=$(".input-upload-file");a.divDescripcion=$(".div-descripcion");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){},"Core.Business.CompararMovBCRA")})};a.initControls=function(){a.btnConfirmarArchivos.on("click",function(){for(var j=0,e;e=a.inputFiles[0].files[j];j++){var g=e.name.split(".");var d=g[g.length-1];if(d!="txt"){new Core.Controls.Dialog("Aviso","<p>Los archivos seleccionados deben ser: txt.</p>",{displayButtons:{close:true,accept:false}}).show();return}}var h={Authorization:Core.Objects.Context.Token,Accept:"application/json"};var c=new FormData();for(var j=0,e;e=a.inputFiles[0].files[j];j++){c.append("file-"+j,e)}var k=new Core.Controls.Overlay(a.divContainerArchivos,{});$.ajax({type:"POST",url:Core.Origin+"/backoffice/api/v1/upload/csv/procesarArchivosBCRA",data:c,cache:false,contentType:false,processData:false,method:"POST",headers:h,success:function(f){var i=a.divDescripcion.swidget().initialOptions;i.dataSource.data=f.descripcion?f.descripcion:[];a.divDescripcion.swidget().refresh(i)},error:function(i){var n=JSON.parse(i.responseText);var l=a.divDescripcion.swidget().initialOptions;l.dataSource.data=n.descripcion?n.descripcion:[];a.divDescripcion.swidget().refresh(l);var o=(n&&n.mensaje)?"Mensaje":"Error de conexión";var f=(n&&n.mensaje)?n.mensaje:"Algunos componentes de la página no se cargaron correctamente. Por favor intente mas tarde...";var m=new Core.Controls.Dialog(o,"<p>"+f+"</p>",{displayButtons:{close:true,accept:false}});m.show()},complete:function(){a.inputFiles.val("");k.destroy()}})});function b(c){if(!c){return""}return c.substr(6,2)+"/"+c.substr(4,2)+"/"+c.substr(0,4)}a.divDescripcion.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:[{field:"fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:b},{field:"cuit",title:"Cuenta",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{field:"monto",title:"Monto",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNumberWithDecimals},{field:"operaciones",title:"Operaciones GCEX09402",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatIntegerNumber},{field:"operacionesOPCAM",title:"Operaciones OPCAM",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatIntegerNumber}]})}};Core.Business.EnviarBoletos=new function(){var a=this;a.id="homeEnviarBoletos";a.divMain=null;a.lblMessage=null;a.divBoletos=null;a.boletos=[];a.divDescriptions=null;a.lblTitle=null;a.btnSearch=null;a.btnInvertSelection=null;a.btnSend=null;a.txtFilter=null;a.timeout=null;a.pageOptions=null;a.filterOptions=null;a.coloresActivos={};a.init=function(b,c){Core.loadPage("backoffice-enviar-boletos.html",function(){document.title="Enviar Boletos";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.filterOptions=null;a.divMain=$(".div-main");a.lblMessage=$(".lbl-message");a.divDescriptions=$(".div-descripciones");a.divBoletos=$(".div-boletos");a.boletos=[];a.lblTitle=$(".label-title");a.btnSearch=$(".btn-search");a.btnInvertSelection=$(".btn-invert-selection");a.btnSend=$(".btn-enviar-boletos");a.txtFilter=$(".textbox-filter");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.btnSearch.click()},"Core.Business.EnviarBoletos")})};a.initControls=function(){a.btnSearch.on("click",function(){new Core.Business.EnviarBoletos.Buscar({onComplete:function(c){a.filterOptions=c;a.loadGrid()}}).show()});a.btnInvertSelection.on("click",function(){var c=a.divBoletos.swidget().dataSource.filter?a.divBoletos.swidget().dataSource.filter.or:null;a.divBoletos.swidget().dataSource.data.forEach(function(e,d){var f=false;if(c){c.forEach(function(g,h){if(e[g.path].toString().toLowerCase().indexOf(g.value.toString().toLowerCase())>=0){f=true}})}else{f=true}if(f&&e.chk){e.chk[0].checked=!e.chk[0].checked}})});var b=[];b.push({width:"6%",field:"FechaEnvioBoleto",title:"Envío Boleto",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"6%",field:"FechaConcertacion",title:"Concertación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"6%",field:"FechaLiquidacion",title:"Liquidación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"6%",field:"NumBoleto",title:"Número Boleto",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({width:"6%",field:"TipoOperacion",title:"Tipo Operación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"6%",field:"ComitenteNumero",title:"Comitente",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({width:"14%",field:"ComitenteDenominacion",title:"Comitente Denominación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"6%",field:"InstrumentoCodigo",title:"Instrumento Código",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"14%",field:"InstrumentoDescripcion",title:"Instrumento Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"6%",field:"Cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({width:"6%",field:"MonedaDesc",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"6%",field:"Bruto",title:"Bruto",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithDecimals});b.push({width:"6%",field:"Neto",title:"Neto",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithDecimals});b.push({title:" ",field:"",width:40,filterable:false,headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,e,d){if(e.Color){c.parent().css("background-color","rgba("+Core.Functions.grid.hexToRgb(e.Color)+((d%2==0)?", 0.6":", 1 ")+")")}if(e.chk){$(e.chk).appendTo(c)}}});a.divBoletos.shieldGrid({dataSource:{data:[]},sorting:{multiple:true},paging:{pageSize:50,pageLinksCount:10},selection:false,rowHover:false,columns:b});a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var c=a.divBoletos.swidget().dataSource;if(value){c.filter={or:[{path:"ComitenteNumero",filter:"contains",value:value},{path:"ComitenteDenominacion",filter:"contains",value:value},{path:"InstrumentoCodigo",filter:"contains",value:value}]}}else{c.filter=null}c.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.EnviarBoletos.txtFilter");a.btnSend.on("click",function(){var d={boletosEnviar:[]};var c=false;a.boletos.forEach(function(f,e){if(f.chk&&f.chk[0].checked){d.boletosEnviar.push({id:f.id});if(f.FechaEnvioBoleto){c=true}}});if(d.boletosEnviar.length==0){new Core.Controls.Dialog("Aviso","Debe seleccionar al menos un boleto a enviar.",{displayButtons:{close:true,accept:false}}).show();return}new Core.Controls.Confirmation("Confirmación",("Se enviarán por mail "+d.boletosEnviar.length+" boletos."+(c?" Esta selección incluye boletos ya enviados.":"")),{onAccepted:function(){var e=new Core.Ajax.ServerRequest({overlayElement:a.btnSend,secureRequest:true,requestUrl:"enviarBoletos/enviarMail",requestType:"POST",requestData:d});e.onSuccess=function(f){new Core.Controls.ProcessProgress({idProcess:((f&&f.idProceso)?f.idProceso:0),overlayElement:a.divMain,onFinish:function(){a.loadGrid()}}).show()};e.request()}}).show()})};a.loadGrid=function(){if(a.filterOptions){var b={};if(a.filterOptions&&a.filterOptions.plazo){b.plazo=a.filterOptions.plazo}if(a.filterOptions&&a.filterOptions.horaD){b.horaD=a.filterOptions.horaD}if(a.filterOptions&&a.filterOptions.horaH){b.horaH=a.filterOptions.horaH}var d="";a.filterOptions.tipos.forEach(function(f,e){d+=((d==""?"":"_")+f.tipo)});var c=new Core.Ajax.ServerRequest({overlayElement:a.divMain,secureRequest:true,requestUrl:"enviarBoletos/obtenerBoletos/"+Core.Functions.Date.getDisplayDateWithSeparator(a.filterOptions.fecha,"-")+"/"+d,requestType:"GET",requestData:b});c.onSuccess=function(e){var f=[];a.boletos=e.boletos?e.boletos:[];a.boletos.forEach(function(h,g){if(h.Enviar){h.chk=$('<input type="checkbox" />')}if(h.Descripcion&&$.grep(f,function(j,k){return j.Descripcion==h.Descripcion}).length==0){f.push({Descripcion:h.Descripcion,Color:h.Color?h.Color:""})}});a.lblTitle.text("Al "+Core.Functions.Date.getDisplayDate(a.filterOptions.fecha));a.divDescriptions.empty();f.forEach(function(h,j){var g=$.grep(a.boletos,function(l,i){return l.Color==h.Color});var k=$('<label class="lblColorContador" color="'+h.Color+'" activo="'+((a.coloresActivos[h.Color]==false)?"false":"true")+'" style="color: #2d2d2d !important; border-radius:4px; margin-right:3px; border: 4px solid '+(h.Color?h.Color:"transparent")+"; background-color:"+((a.coloresActivos[h.Color]==false)?"#c4c4c4":h.Color)+';">'+h.Descripcion+" ("+g.length+")</label>").appendTo(a.divDescriptions);if(a.coloresActivos[h.Color]==null){a.coloresActivos[h.Color]=true}k.on("click",function(){a.setColor(k)})});a.refreshGrid()};c.request()}};a.setColor=function(b){if(b.attr("activo")=="true"){b.css("background-color","#c4c4c4");b.attr("activo","false");a.coloresActivos[b.attr("color")]=false}else{b.css("background-color",b.attr("color"));b.attr("activo","true");a.coloresActivos[b.attr("color")]=true}a.refreshGrid()};a.refreshGrid=function(){var b=$.grep(a.boletos,function(h,g){return true});var c=$(".lblColorContador");for(var d=0;d<c.length;d++){var f=$(c[d]);if(f.attr("activo")=="false"){b=$.grep(b,function(h,g){return h.Color!=f.attr("color")})}}var e=a.divBoletos.swidget().initialOptions;e.dataSource.data=b;a.divBoletos.swidget().refresh(e);a.txtFilter.keydown()}};Core.Business.EnviarBoletos.Buscar=function(b){var a=this;a.divModal=$(".div-enviar-boletos-filtrar");a.divAlert=null;a.divMain=null;a.txtDate=null;a.ddlPlazo=null;a.btnInvertirSeleccion=null;a.txtHoraDesde=null;a.txtHoraHasta=null;a.tipos=[];a.onComplete=function(c){};$.extend(true,a,b);a.show=function(){a.divMain=a.divModal.find(".div-main-modal");a.divAlert=a.divModal.find(".div-alert");a.txtDate=a.divModal.find(".date-picker-date");a.txtDate.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(d){a.loadControls()}}});Core.Functions.Validations.toggleValidation(a.txtDate,false);a.divTipos=a.divModal.find(".div-tipos");var c=[];c.push({field:"Descripcion",title:"Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({title:" ",field:"",width:40,filterable:false,headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),columnTemplate:function(d,f,e){if(f.chk){$(f.chk).appendTo(d)}}});a.divTipos.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:c});a.btnInvertirSeleccion=a.divModal.find(".btn-invertir-seleccion");a.btnInvertirSeleccion.unbind("click");a.btnInvertirSeleccion.click(function(){a.divTipos.swidget().dataSource.data.forEach(function(e,d){if(e.chk){e.chk[0].checked=!e.chk[0].checked}})});a.ddlPlazo=a.divModal.find(".dropdown-plazo");a.ddlPlazo.shieldDropDown({dataSource:{data:[{value:"TODOS"},{value:"0"},{value:"1"},{value:"2"},{value:"OTROS"}]},textTemplate:"{value}",valueTemplate:"{value}",value:""});Core.Functions.Validations.toggleValidation(a.ddlPlazo,false);a.txtHoraDesde=a.divModal.find(".textbox-hora-desde");a.txtHoraDesde.shieldTimePicker({min:new Date(1900,0,1,8,0,0),max:new Date(1900,0,1,20,30,0)});Core.Functions.Validations.toggleValidation(a.txtHoraDesde,false);a.txtHoraHasta=a.divModal.find(".textbox-hora-hasta");a.txtHoraHasta.shieldTimePicker({min:new Date(1900,0,1,8,0,0),max:new Date(1900,0,1,20,30,0)});Core.Functions.Validations.toggleValidation(a.txtHoraHasta,false);a.divAlert.slideUp();a.divModal.find(".btn-confirmar").unbind("click");a.divModal.find(".btn-confirmar").click(function(){Core.Functions.Validations.toggleValidation(a.txtDate,false);Core.Functions.Validations.toggleValidation(a.ddlPlazo,false);Core.Functions.Validations.toggleValidation(a.txtHoraDesde,false);Core.Functions.Validations.toggleValidation(a.txtHoraHasta,false);a.divAlert.slideUp();var d={};var e=true;if(a.txtDate.swidget().value()){d.fecha=a.txtDate.swidget().value()}else{Core.Functions.Validations.toggleValidation(a.txtDate,true);var e=false}d.tipos=[];a.tipos.forEach(function(g,f){if(g.chk&&g.chk[0].checked){d.tipos.push(g)}});if(!d.tipos.length){a.divAlert.text("Debe seleccionar al menos un tipo.");a.divAlert.slideDown();var e=false}if(a.ddlPlazo.swidget().value()){d.plazo=a.ddlPlazo.swidget().value()}if(a.txtHoraDesde.swidget().value()&&a.txtHoraHasta.swidget().value()){d.horaD=$.format.date(a.txtHoraDesde.swidget().value(),"HHmm");d.horaH=$.format.date(a.txtHoraHasta.swidget().value(),"HHmm")}if(e){a.divModal.modal("hide");a.onComplete(d)}});a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.loadControls(function(){a.divModal.modal({show:true})})};a.loadControls=function(c){if(a.txtDate.swidget().value()){var d=new Core.Ajax.ServerRequest({overlayElement:a.divMain,secureRequest:true,requestUrl:"enviarBoletos/obtenerTipos/"+Core.Functions.Date.getDisplayDateWithSeparator(a.txtDate.swidget().value(),"-"),requestType:"GET"});d.onSuccess=function(e){a.tipos=e.tipos?e.tipos:[];a.tipos.forEach(function(h,g){h.chk=$('<input type="checkbox" />');h.chk[0].checked=true});var f=a.divTipos.swidget().initialOptions;f.dataSource.data=a.tipos;a.divTipos.swidget().refresh(f);if(c){c()}};d.request()}};a.destroy=function(){a.txtDate.swidget().destroy();a.divTipos.swidget().destroy();a.ddlPlazo.swidget().destroy();a.txtHoraDesde.swidget().destroy();a.txtHoraHasta.swidget().destroy()}};Core.Business.ExcepcionesOperar=new function(){var a=this;a.id="ABMExcepcionOperar";a.btnNewExcepcion=null;a.divGridExcepciones=null;a.txtFilterExcepciones=null;a.timeout=null;a.window=$(window);a.init=function(b,c){Core.loadPage("backoffice-excepciones-operar.html",function(){document.title="Excepciones permitidas para Operar Cuentas";a.btnNewExcepcion=$(".btn-crear-excepcion");a.divGridExcepciones=$(".div-excepciones");a.txtFilterExcepciones=$(".textbox-filter");a.initGrid();a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadGrid()},"Core.Business.ExcepcionesOperar")})};a.initControls=function(){a.btnNewExcepcion.click(function(){var b=new Core.Business.ExcepcionesOperar.ManagerExcepcion({onSave:function(){a.loadGrid()}}).show()});a.txtFilterExcepciones.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilterExcepciones.val();var b=a.divGridExcepciones.swidget().dataSource;if(value){b.filter={or:[{path:"idCuenta",filter:"contains",value:value},{path:"idPersona",filter:"contains",value:value},{path:"Descripcion",filter:"contains",value:value},{path:"NumComitente",filter:"contains",value:value},{path:"NumCuotapartista",filter:"contains",value:value},{path:"Documento",filter:"contains",value:value},{path:"PersonaOperar",filter:"contains",value:value},{path:"FechaAlta",filter:"contains",value:value},{path:"AutorizadoPor",filter:"contains",value:value}]}}else{b.filter=null}b.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilterExcepciones,"Core.Business.ExcepcionesOperar.txtFilterExcepciones")};a.initGrid=function(){var b=[];b.push({field:"idCuenta",title:"ID Cuenta",width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Descripcion",title:"Descripción",width:"25%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"NumComitente",title:"Comitente",width:"5%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"NumCuotapartista",title:"Cuotapartista",width:"5%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"idPersona",title:"ID Persona",width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Documento",title:"Documento",width:"8%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"PersonaOperar",title:"Persona",width:"25%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"FechaAlta",title:"Fecha de Alta",width:"8%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatStringDate});b.push({field:"AutorizadoPor",title:"Autorizado Por",width:"8%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"4%",field:"Options",title:" ",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,e,f){var c=$('<button type="button" title="Eliminar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(d);c.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar la excepcion con ID Cuenta: "+e.idCuenta+" y ID Persona: "+e.idPersona+"?",{onAccepted:function(){var g=new Core.Ajax.ServerRequest({overlayElemet:c,requestUrl:"excepciones/eliminarexcepciones?idCuentaExcepcion="+e.idCuenta+"&idPersonaExcepcion="+e.idPersona,requestType:"DELETE"});g.onSuccess=function(i){var h=new Core.Controls.Dialog("Mensaje","La excepcion ha sido eliminada correctamente.",{displayButtons:{close:true,accept:false}});h.show();a.loadGrid()};g.request()}}).show()})}});a.divGridExcepciones.shieldGrid({dataSource:{data:[]},paging:{pageSize:50,pageLinksCount:10},selection:false,rowHover:false,sorting:{multiple:true},columns:b})};a.loadGrid=function(){var b=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divGridExcepciones.parent(),secureRequest:true,requestUrl:"excepciones/obtenerexcepciones",requestType:"GET"});b.onSuccess=function(c){var e=a.window.scrollTop();var d=a.divGridExcepciones.swidget().initialOptions;d.dataSource.data=c;d.dataSource.schema={data:"excepciones"};d.dataSource.sort=a.divGridExcepciones.swidget().dataSource.sort;a.divGridExcepciones.swidget().refresh(d);a.txtFilterExcepciones.keydown();a.window.scrollTop(e)};b.request()}};Core.Business.ExcepcionesOperar.ManagerExcepcion=function(b){var a=this;a.divModal=$(".div-manager-excepcion");a.txtComitente=null;a.txtCuotapartista=null;a.txtDocumento=null;a.btnBuscarCuenta=null;a.btnBuscarPersona=null;a.lblCuenta=null;a.lblPersona=null;a.divDescripcionCuenta=null;a.divDescripcionPersona=null;a.btnConfirmarExcepcion=null;a.divAlert=null;a.persona=null;a.cuenta=null;a.onSave=null;$.extend(true,a,b);a.show=function(){a.persona=null;a.cuenta=null;a.txtComitente=a.divModal.find(".textbox-excepcion-comitente");a.txtComitente.val("");a.txtCuotapartista=a.divModal.find(".textbox-excepcion-cuotapartista");a.txtCuotapartista.val("");a.divDescripcionCuenta=a.divModal.find(".div-descripcion-cuenta");a.divDescripcionCuenta.hide();a.lblCuenta=a.divModal.find(".lbl-excepcion-cuenta");a.lblCuenta.text("");a.divDescripcionPersona=a.divModal.find(".div-descripcion-persona");a.divDescripcionPersona.hide();a.txtDocumento=a.divModal.find(".textbox-excepcion-documento");a.txtDocumento.val("");a.lblPersona=a.divModal.find(".lbl-excepcion-persona");a.lblPersona.text("");a.btnBuscarCuenta=a.divModal.find(".btn-excepcion-buscar-cuenta");a.btnBuscarCuenta.unbind("click");a.btnBuscarCuenta.click(function(){a.lblCuenta.text("");a.divDescripcionCuenta.hide();a.divAlert.slideUp();if((a.txtComitente.val()==null||a.txtComitente.val()=="")&&(a.txtCuotapartista.val()==null||a.txtCuotapartista.val()=="")){a.divAlert.text("Debe ingresar un comitente y cuotapartista.");a.divAlert.slideDown()}else{var c={};c.NumComitente=a.txtComitente.val();c.NumCuotapartista=a.txtCuotapartista.val();var d=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divModal.parent(),secureRequest:true,requestUrl:"excepciones/cuentaexcepcion",requestType:"GET",requestData:c});d.onSuccess=function(e){if(e.cuenta.length==1){a.cuenta=e.cuenta[0];a.lblCuenta.text("Cuenta: "+a.cuenta.Descripcion);a.divDescripcionCuenta.show()}else{a.divAlert.text("No se encontraron cuentas para comitente y cuotapartista ingresado.");a.divAlert.slideDown()}};d.request()}});a.btnBuscarPersona=a.divModal.find(".btn-excepcion-buscar-persona");a.btnBuscarPersona.unbind("click");a.btnBuscarPersona.click(function(){a.lblPersona.text("");a.divDescripcionPersona.hide();a.divAlert.slideUp();if(a.txtDocumento.val()==null||a.txtDocumento.val()==""){a.divAlert.text("Debe ingresar un documento.");a.divAlert.slideDown()}else{var c={};c.Documento=a.txtDocumento.val();var d=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divModal.parent(),secureRequest:true,requestUrl:"excepciones/personaexcepcion",requestType:"GET",requestData:c});d.onSuccess=function(e){if(e.persona.length==1){a.persona=e.persona[0];a.lblPersona.text("Persona: "+a.persona.Nombre+" "+a.persona.Apellido);a.divDescripcionPersona.show()}else{a.divAlert.text("No se encontraron personas para el documento ingresado.");a.divAlert.slideDown()}};d.request()}});a.btnConfirmarExcepcion=a.divModal.find(".btn-confirmar-excepcion");a.btnConfirmarExcepcion.unbind("click");a.btnConfirmarExcepcion.click(function(){a.divAlert.slideUp();if(a.cuenta==null){a.divAlert.text("Debe buscar una cuenta.");a.divAlert.slideDown()}if(a.persona==null){a.divAlert.text("Debe buscar una persona.");a.divAlert.slideDown()}if(a.cuenta!=null&&a.persona!=null){var c={};c.idCuentaExcepcion=a.cuenta.idCuenta;c.idPersonaExcepcion=a.persona.idPersona;var d=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divModal.parent(),secureRequest:true,requestUrl:"excepciones/insertarexcepcion",requestType:"POST",requestData:c});d.onSuccess=function(e){a.divModal.modal("hide");modal=new Core.Controls.Dialog("Aviso","Excepción creada correctamente.",{displayButtons:{close:true,accept:false}});modal.show();if(a.onSave){a.onSave()}};d.request()}});a.divAlert=a.divModal.find(".div-excepcion-alert");a.divAlert.slideUp();a.divModal.modal({show:true})};a.destroy=function(){}};Core.Business.ImportadorESCO=new function(){var a=this;a.id="homeImportadorESCO";a.gridCuentas=null;a.gridPersonas=null;a.btnRefresh=null;a.btnImportar=null;a.lblSoloImportarPersonas=null;a.chkSoloImportarPersonas=null;a.pageOptions=null;a.window=$(window);a.init=function(b,c){Core.loadPage("backoffice-importador-esco.html",function(){a.idDefaultAccount=b;a.idDefaultProfile=c;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);document.title="Importador ESCO";a.btnRefresh=$(".btn-refresh");a.btnImportar=$(".btn-importar");a.gridCuentas=$(".div-importador-esco-cuentas");a.gridPersonas=$(".div-importador-esco-personas");a.lblSoloImportarPersonas=$(".lbl-solo-importar-personas");a.chkSoloImportarPersonas=$(".checkbox-solo-importar-personas");a.chkSoloImportarPersonas[0].checked=true;a.lblSoloImportarPersonas.hide();a.chkSoloImportarPersonas.hide();if(a.pageOptions&&a.pageOptions.homeImportadorESCOSoloPersonas){a.lblSoloImportarPersonas.show();a.chkSoloImportarPersonas.show()}a.initGrids();a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadGrids()},"Core.Business.ImportadorESCO")})};a.initControls=function(){a.btnRefresh.click(function(){a.loaded=false;a.loadGrids()});a.btnImportar.click(function(){new Core.Controls.Confirmation("Confirmación","Seguro que desea realizar la Importación?",{onAccepted:function(){var b={};b.ImportarSoloPersonas=((a.chkSoloImportarPersonas[0].checked)?1:0);var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"importadoresco/importar/1",requestType:"POST",requestData:b});c.onSuccess=function(d){a.loadGrids()};c.request()}}).show()})};a.initGrids=function(){var c=[];c.push({width:"4%",field:"Tipo",title:"Tipo",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),columnTemplate:function(d,f,e){d.html(f.Tipo);d.css("text-align","left");d.css("padding-right","5px");if(f.ColorPersona){d.css("background-color","rgba("+a.hexToRgb(f.ColorPersona)+((e%2==0)?", 0.6":", 1 ")+")")}}});c.push({width:"25%",field:"Descripcion",title:"Descripcion",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),columnTemplate:function(d,f,e){d.html(f.Descripcion);d.css("text-align","left");d.css("padding-right","5px");if(f.ColorDescripcion){d.css("background-color","rgba("+a.hexToRgb(f.ColorDescripcion)+((e%2==0)?", 0.6":", 1 ")+")")}}});c.push({width:"8%",field:"TipoDocumento",title:"Tipo Doc",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),columnTemplate:function(d,f,e){d.html(f.TipoDocumento);d.css("text-align","left");d.css("padding-right","5px");if(f.ColorTipoDocumento){d.css("background-color","rgba("+a.hexToRgb(f.ColorTipoDocumento)+((e%2==0)?", 0.6":", 1 ")+")")}}});c.push({width:"7%",field:"Documento",title:"Documento",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),columnTemplate:function(d,f,e){d.html(f.Documento);d.css("text-align","right");d.css("padding-right","5px");if(f.ColorDocumento){d.css("background-color","rgba("+a.hexToRgb(f.ColorDocumento)+((e%2==0)?", 0.6":", 1 ")+")")}}});c.push({width:"8%",field:"CUIT_CUIL",title:"CUIT / CUIL",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),columnTemplate:function(d,f,e){d.html(f.CUIT_CUIL);d.css("text-align","right");d.css("padding-right","5px");if(f.ColorCUIT_CUIL){d.css("background-color","rgba("+a.hexToRgb(f.ColorCUIT_CUIL)+((e%2==0)?", 0.6":", 1 ")+")")}}});c.push({width:"15%",field:"email",title:"Email",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),columnTemplate:function(d,f,e){d.html(f.email);d.css("text-align","left");d.css("padding-right","5px");if(f.Coloremail){d.css("background-color","rgba("+a.hexToRgb(f.Coloremail)+((e%2==0)?", 0.6":", 1 ")+")")}}});c.push({width:"8%",field:"FechaNacimiento",title:"Fecha Nac",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),columnTemplate:function(d,f,e){d.html(f.FechaNacimiento);d.css("text-align","center");d.css("padding-right","5px");if(f.ColorFechaNacimiento){d.css("background-color","rgba("+a.hexToRgb(f.ColorFechaNacimiento)+((e%2==0)?", 0.6":", 1 ")+")")}}});c.push({width:"4%",field:"Sexo",title:"Sexo",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),columnTemplate:function(d,f,e){d.html(f.Sexo);d.css("text-align","center");d.css("padding-right","5px");if(f.ColorSexo){d.css("background-color","rgba("+a.hexToRgb(f.ColorSexo)+((e%2==0)?", 0.6":", 1 ")+")")}}});c.push({width:"10%",field:"Comitente",title:"Comitente",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),columnTemplate:function(d,f,e){d.html(f.Comitente);d.css("text-align","center");d.css("padding-right","5px")}});c.push({width:"10%",field:"Cuotapartista",title:"Cuotapartista",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),columnTemplate:function(d,f,e){d.html(f.Cuotapartista);d.css("text-align","center");d.css("padding-right","5px")}});c.push({width:"5%",field:"TextoBolsa",title:"Bolsa",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),columnTemplate:function(d,f,e){d.html(f.TextoBolsa);d.css("text-align","center");d.css("padding-right","5px");if(f.ColorBolsa){d.css("background-color","rgba("+a.hexToRgb(f.ColorBolsa)+((e%2==0)?", 0.6":", 1 ")+")")}}});c.push({width:"5%",field:"TextoFondos",title:"Fondos",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),columnTemplate:function(d,f,e){d.html(f.TextoFondos);d.css("text-align","center");d.css("padding-right","5px");if(f.ColorFondos){d.css("background-color","rgba("+a.hexToRgb(f.ColorFondos)+((e%2==0)?", 0.6":", 1 ")+")")}}});a.gridPersonas.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,noRecordsText:"No hay información de Personas",columns:c});var b=[];b.push({width:"5%",field:"TipoCuenta",title:"Tipo",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,f,e){d.html(f.TipoCuenta);d.css("text-align","left");d.css("padding-right","5px");if(f.ColorCuenta){d.css("background-color","rgba("+a.hexToRgb(f.ColorCuenta)+((e%2==0)?", 0.6":", 1 ")+")")}}});b.push({width:"10%",field:"idCuenta",title:"Cuenta",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,f,e){d.html(f.idCuenta);d.css("text-align","right");d.css("padding-right","5px")}});b.push({width:"40%",field:"Descripcion",title:"Descripción",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,f,e){d.html(f.Descripcion);d.css("text-align","left");d.css("padding-right","5px");if(f.ColorDescripcion){d.css("background-color","rgba("+a.hexToRgb(f.ColorDescripcion)+((e%2==0)?", 0.6":", 1 ")+")")}}});b.push({width:"15%",field:"CUIT",title:"CUIT",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,f,e){d.html(f.CUIT);d.css("text-align","right");d.css("padding-right","5px");if(f.ColorCUIT){d.css("background-color","rgba("+a.hexToRgb(f.ColorCUIT)+((e%2==0)?", 0.6":", 1 ")+")")}}});b.push({width:"15%",field:"Comitente",title:"Comitente",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,f,e){d.html(f.Comitente);d.css("text-align","center");d.css("padding-right","5px");if(f.ColorComitente){d.css("background-color","rgba("+a.hexToRgb(f.ColorComitente)+((e%2==0)?", 0.6":", 1 ")+")")}}});b.push({width:"15%",field:"Cuotapartista",title:"Cuotapartista",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,f,e){d.html(f.Cuotapartista);d.css("text-align","center");d.css("padding-right","5px");if(f.ColorCuotapartista){d.css("background-color","rgba("+a.hexToRgb(f.ColorCuotapartista)+((e%2==0)?", 0.6":", 1 ")+")")}}});b.push({title:"Obs.",width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,e,f){if(e.Observaciones){var g=(e.length>140)?(e.Observaciones.substr(0,140)+"..."):(e.Observaciones);d.html('<button type="button" title="'+g+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-warning-sign"></span></button>');d.addClass("link-cell");d.on("click",function(){var h=new Core.Controls.Dialog("Observaciones",(e.Observaciones)?e.Observaciones:"",{displayButtons:{close:true,accept:false}});h.show()})}}});a.gridCuentas.shieldGrid({dataSource:{data:[]},events:{detailCreated:a.detailCreated},selection:false,rowHover:false,noRecordsText:"No hay información de Cuentas",columns:b})};a.loadGrids=function(){var b=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"importadoresco/reporte/1",requestType:"GET"});b.onSuccess=function(e){var d=a.gridPersonas.swidget().initialOptions;d.dataSource.data=e.Personas;a.gridPersonas.swidget().refresh(d);var c=a.gridCuentas.swidget().initialOptions;c.dataSource.data=e.Cuentas;c.events.detailCreated=a.detailCreated;a.gridCuentas.swidget().refresh(c)};b.request()};a.detailCreated=function(c){var b=[];b.push({width:"10%",field:"TipoPersona",title:"Tipo",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,f,e){d.html(f.TipoPersona);d.css("text-align","left");d.css("padding-right","5px");if(f.ColorPersona){d.css("background-color","rgba("+a.hexToRgb(f.ColorPersona)+((e%2==0)?", 0.6":", 1 ")+")")}}});b.push({width:"40%",field:"Descripcion",title:"Descripción",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,f,e){d.html(f.Descripcion);d.css("text-align","left");d.css("padding-right","5px")}});b.push({width:"10%",field:"TipoDocumento",title:"Tipo de documento",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,f,e){d.html(f.TipoDocumento);d.css("text-align","left");d.css("padding-right","5px")}});b.push({width:"10%",field:"Documento",title:"Documento",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,f,e){d.html(f.Documento);d.css("text-align","right");d.css("padding-right","5px")}});b.push({width:"10%",field:"CUIT_CUIL",title:"CUIT / CUIL",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,f,e){d.html(f.CUIT_CUIL);d.css("text-align","right");d.css("padding-right","5px")}});b.push({width:"10%",field:"PerfilCuenta",title:"Perfil Cuenta",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,f,e){d.html(f.PerfilCuenta);d.css("text-align","left");d.css("padding-right","5px");if(f.ColorPerfilCuenta){d.css("background-color","rgba("+a.hexToRgb(f.ColorPerfilCuenta)+((e%2==0)?", 0.6":", 1 ")+")")}}});b.push({title:"Obs.",width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,e,f){if(e.Acciones){var g=(e.length>140)?(e.Acciones.substr(0,140)+"..."):(e.Acciones);d.html('<button type="button" title="'+g+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');d.addClass("link-cell");d.on("click",function(){var h=new Core.Controls.Dialog("Observaciones",(e.Acciones)?e.Acciones:"",{displayButtons:{close:true,accept:false}});h.show()})}}});$("<div class='grid-details'/>").appendTo(c.detailCell).shieldGrid({dataSource:{data:c.item.Personas},selection:false,rowHover:false,columns:b})};a.hexToRgb=function(d){d=d.replace("#","");var f=parseInt(d.substring(0,2),16);var e=parseInt(d.substring(2,4),16);var c=parseInt(d.substring(4,6),16);var h=f+","+e+","+c;return h}};Core.Business.IntellisoaPEP=new function(){var a=this;a.id="homeIntellisoaPEP";a.idDefaultAccount=null;a.idDefaultProfile=null;a.btnConsultarIntellisoa=null;a.txtConsultarIntellisoaNombre=null;a.txtConsultarIntellisoaApellido=null;a.btnConsultarIntellisoaPersona=null;a.btnConsultarIntellisoaRespuesta=null;a.divContainerConsultarIntellisoa=null;a.divConsultarIntellisoa=null;a.btnConsultarCambiosPep=null;a.txtConsultarCambiosPepDesde=null;a.txtConsultarCambiosPepHasta=null;a.btnConsultarCambiosPepRango=null;a.divContainerConsultarCambiosPep=null;a.divConsultarCambiosPep=null;a.btnConsultarHistorico=null;a.txtConsultarHistoricoNombre=null;a.txtConsultarHistoricoApellido=null;a.btnConsultarHistoricoPersona=null;a.divContainerConsultarHistorico=null;a.divConsultarHistorico=null;a.btnDescargarBasePepHistorico=null;a.btnConsultasIntellisoa=null;a.txtConsultasIntellisoaCuit=null;a.btnConsultasIntellisoaObtenerEstado=null;a.btnConsultasIntellisoaDescalificadoBCRA=null;a.btnConsultasIntellisoaEmpleadoGobierno=null;a.divContainerConsultasIntellisoa=null;a.divConsultasIntellisoa=null;a.btnConsultasIntellisoaRespuesta=null;a.pageOptions=null;a.window=$(window);a.init=function(b,c){Core.loadPage("backoffice-intellisoa-pep.html",function(){document.title="Intellisoa PEP";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.idDefaultAccount=b;a.idDefaultProfile=c;a.btnConsultarIntellisoa=$(".btn-consultar-intellisoa");a.txtConsultarIntellisoaNombre=$(".textbox-consultar-intellisoa-nombre");a.txtConsultarIntellisoaApellido=$(".textbox-consultar-intellisoa-apellido");a.btnConsultarIntellisoaPersona=$(".btn-consultar-intellisoa-persona");a.btnConsultarIntellisoaPersona.on("click",function(){a.loadGridConsultarIntellisoa()});a.btnConsultarIntellisoaRespuesta=$(".btn-consultar-intellisoa-respuesta");a.divContainerConsultarIntellisoa=$(".div-container-consultar-intellisoa");a.divContainerConsultarIntellisoa.hide();a.divConsultarIntellisoa=$(".div-consultar-intellisoa");a.initControlsConsultarIntellisoa();a.btnConsultarCambiosPep=$(".btn-consultar-cambios-pep");a.txtConsultarCambiosPepDesde=$(".date-consultar-cambios-pep-desde");a.txtConsultarCambiosPepHasta=$(".date-consultar-cambios-pep-hasta");a.btnConsultarCambiosPepRango=$(".btn-consultar-cambios-pep-rango");a.btnConsultarCambiosPepRango.on("click",function(){a.loadGridConsultarCambiosPep()});a.divContainerConsultarCambiosPep=$(".div-container-consultar-cambios-pep");a.divContainerConsultarCambiosPep.hide();a.divConsultarCambiosPep=$(".div-consultar-cambios-pep");a.initControlsConsultarCambiosPep();a.btnConsultarHistorico=$(".btn-consultar-historico");a.txtConsultarHistoricoNombre=$(".textbox-consultar-historico-nombre");a.txtConsultarHistoricoApellido=$(".textbox-consultar-historico-apellido");a.btnConsultarHistoricoPersona=$(".btn-consultar-historico-persona");a.btnConsultarHistoricoPersona.on("click",function(){a.loadGridConsultarHistorico()});a.divContainerConsultarHistorico=$(".div-container-consultar-historico");a.divContainerConsultarHistorico.hide();a.divConsultarHistorico=$(".div-consultar-historico");a.btnDescargarBasePepHistorico=$(".btn-descargar-base-pep-historico");a.initControlsConsultarHistorico();a.btnConsultasIntellisoa=$(".btn-consultas-intellisoa");a.txtConsultasIntellisoaCuit=$(".textbox-consultas-intellisoa-cuit");a.btnConsultasIntellisoaObtenerEstado=$(".btn-consultas-intellisoa-obtener-estado");a.btnConsultasIntellisoaDescalificadoBCRA=$(".btn-consultas-intellisoa-descalificado-bcra");a.btnConsultasIntellisoaEmpleadoGobierno=$(".btn-consultas-intellisoa-empleado-gobierno");a.btnConsultasIntellisoaRespuesta=$(".btn-consultas-intellisoa-respuesta");a.divContainerConsultasIntellisoa=$(".div-container-consultas-intellisoa");a.divContainerConsultasIntellisoa.hide();a.divConsultasIntellisoa=$(".div-consultas-intellisoa");a.initControlsConsultasIntellisoa();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.btnConsultarIntellisoa.click()},"Core.Business.IntellisoaPEP")})};a.initControlsConsultarIntellisoa=function(){a.txtConsultarIntellisoaNombre.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtConsultarIntellisoaNombre,false);a.txtConsultarIntellisoaApellido.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtConsultarIntellisoaApellido,false);a.btnConsultarIntellisoaRespuesta.on("click",function(){var c=new Core.Controls.Dialog("Respuesta JSON.",JSON.stringify(a.dataConsultarIntellisoa),{displayButtons:{close:true,accept:false}});c.show()});a.btnConsultarIntellisoaRespuesta.hide();var b=[];b.push({field:"status",title:"Estado",width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"name",title:"Nombre",width:"20%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"record",title:"Respuesta",width:"50%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"list",title:"PEP Descripción",width:"20%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});a.divConsultarIntellisoa.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Consultar Intellisoa",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["fecha","status","name","record","list","fuente"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Consultar Intellisoa"}}},selection:false,rowHover:false,columns:b,paging:{pageSize:100,pageLinksCount:10},noRecordsText:"No se encontraron resultados."})};a.loadGridConsultarIntellisoa=function(){var d={value:true};Core.Functions.Validations.toggleValidation(a.txtConsultarIntellisoaNombre,false);Core.Functions.Validations.toggleValidation(a.txtConsultarIntellisoaApellido,false);var b={personasBuscar:[{}]};b.personasBuscar[0].Nombre=Core.Functions.Validations.getValidatedSwidgetValue(a.txtConsultarIntellisoaNombre,d);b.personasBuscar[0].Apellido=Core.Functions.Validations.getValidatedSwidgetValue(a.txtConsultarIntellisoaApellido,d);if(d.value){var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"Intellisoa/consultarPep",requestType:"POST",requestData:b});c.onSuccess=function(e){a.dataConsultarIntellisoa=e;var g=[];if(e.findTerroristsResponse&&e.findTerroristsResponse.terroristsInfo){if(e.findTerroristsResponse.terroristsInfo.terrorist&&e.findTerroristsResponse.terroristsInfo.terrorist.length){g=e.findTerroristsResponse.terroristsInfo.terrorist}else{if(e.findTerroristsResponse.terroristsInfo.terrorist){g=[e.findTerroristsResponse.terroristsInfo.terrorist]}else{if(e.findTerroristsResponse.terroristsInfo.search_status=="N"){g=[{name:(a.txtConsultarIntellisoaNombre.swidget().value()+" "+a.txtConsultarIntellisoaApellido.swidget().value()),record:"",list:""}]}}}g.forEach(function(i,h){i.fecha=$.format.date(new Date(),"dd/MM/yyyy HH:mm");i.status=e.findTerroristsResponse.terroristsInfo.search_status;i.fuente="Intellisoa"})}var f=a.divConsultarIntellisoa.swidget().initialOptions;f.dataSource.data=g;f.exportOptions.excel.dataSource.data=g;f.exportOptions.excel.readDataSource=true;a.divConsultarIntellisoa.swidget().refresh(f);a.divContainerConsultarIntellisoa.show();a.btnConsultarIntellisoaRespuesta.show()};c.request()}else{a.divContainerConsultarIntellisoa.hide();a.btnConsultarIntellisoaRespuesta.hide()}};a.initControlsConsultarCambiosPep=function(){var c=new Date();c.setDate(c.getDate()-7);a.txtConsultarCambiosPepDesde.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:c,max:new Date()});Core.Functions.Validations.toggleValidation(a.txtConsultarCambiosPepDesde,false);a.txtConsultarCambiosPepHasta.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date()});Core.Functions.Validations.toggleValidation(a.txtConsultarCambiosPepHasta,false);var b=[];b.push({field:"Nombre",title:"Nombre",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Apellido",title:"Apellido",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"TipoDocumento",title:"Tipo Documento",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Documento",title:"Documento",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"FechaNacimiento",title:"Fecha Nacimiento",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatStringDate});b.push({field:"FechaCambioEstado",title:"Fecha Cambio Estado",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatStringDate});b.push({field:"pepActual",title:"PEP Actual",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"PepAnterior",title:"PEP Anterior",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});a.divConsultarCambiosPep.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Consultar Cambios PEP",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["Nombre","Apellido","TipoDocumento","Documento","FechaNacimiento","FechaCambioEstado","pepActual","PepAnterior"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Consultar Cambios PEP"}}},selection:false,rowHover:false,columns:b,paging:{pageSize:100,pageLinksCount:10},noRecordsText:"No se encontraron resultados."})};a.loadGridConsultarCambiosPep=function(){function b(f){if(!f){return""}return f.getFullYear().toString()+"-"+Core.Functions.Date.getTwoCharsNumber(f.getMonth()+1)+"-"+Core.Functions.Date.getTwoCharsNumber(f.getDate())}var e={value:true};Core.Functions.Validations.toggleValidation(a.txtConsultarCambiosPepDesde,false);Core.Functions.Validations.toggleValidation(a.txtConsultarCambiosPepHasta,false);var c="FechaDesde="+encodeURIComponent(b(Core.Functions.Validations.getValidatedSwidgetValue(a.txtConsultarCambiosPepDesde,e)));c+="&FechaHasta="+encodeURIComponent(b(Core.Functions.Validations.getValidatedSwidgetValue(a.txtConsultarCambiosPepHasta,e)));if(e.value){var d=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"Intellisoa/obtenerPep",requestType:"GET",requestData:c});d.onSuccess=function(f){var g=a.divConsultarCambiosPep.swidget().initialOptions;g.dataSource.data=f.PersonasPEP?f.PersonasPEP:[];g.exportOptions.excel.dataSource.data=f.PersonasPEP?f.PersonasPEP:[];g.exportOptions.excel.readDataSource=true;a.divConsultarCambiosPep.swidget().refresh(g);a.divContainerConsultarCambiosPep.show()};d.request()}else{a.divContainerConsultarCambiosPep.hide()}};a.initControlsConsultarHistorico=function(){a.txtConsultarHistoricoNombre.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtConsultarHistoricoNombre,false);a.txtConsultarHistoricoApellido.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtConsultarHistoricoApellido,false);var b=[];b.push({field:"Nombre",title:"Nombre",width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Apellido",title:"Apellido",width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"TipoDocumento",title:"Tipo Documento",width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Documento",title:"Documento",width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"FechaNacimiento",title:"Fecha Nacimiento",width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatStringDate});b.push({field:"fechaConsulta",title:"Fecha Consulta",width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatStringDate});b.push({field:"PepDescripcion",title:"PEP Descripción",width:"40%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});a.divConsultarHistorico.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Consultar Histórico",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["Nombre","Apellido","TipoDocumento","Documento","FechaNacimiento","fechaConsulta","PepDescripcion"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Consultar Histórico"}}},selection:false,rowHover:false,columns:b,paging:{pageSize:100,pageLinksCount:10},noRecordsText:"No se encontraron resultados."});a.btnDescargarBasePepHistorico.on("click",function(){function d(l){var k=new Blob([l.response],{type:l.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(k);return}var e=window.URL.createObjectURL(k);var j=document.createElement("a");j.href=e;var g=l.getResponseHeader("Content-Disposition").split("; ");var f="filename=file.DAT";for(var h=0;h<g.length;h++){if(g[h].indexOf("filename")>=0){f=g[h]}}j.download=f.split("=")[1];j.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(e)}var c=new XMLHttpRequest();c.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"download/PEPbase",true);c.responseType="blob";c.setRequestHeader("Authorization",Core.Objects.Context.Token);c.onload=function(e){if(c.status==200){d(c)}else{var f=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga.</p>",{displayButtons:{close:true,accept:false}});f.show()}};c.send()})};a.loadGridConsultarHistorico=function(){var d={value:true};Core.Functions.Validations.toggleValidation(a.txtConsultarHistoricoNombre,false);Core.Functions.Validations.toggleValidation(a.txtConsultarHistoricoApellido,false);var b={personasBuscar:[{}]};b.personasBuscar[0].Nombre=Core.Functions.Validations.getValidatedSwidgetValue(a.txtConsultarHistoricoNombre,d);b.personasBuscar[0].Apellido=Core.Functions.Validations.getValidatedSwidgetValue(a.txtConsultarHistoricoApellido,d);if(d.value){var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"Intellisoa/consultarHistorico",requestType:"POST",requestData:b});c.onSuccess=function(e){var f=a.divConsultarHistorico.swidget().initialOptions;f.dataSource.data=e.historico?e.historico:[];f.exportOptions.excel.dataSource.data=e.historico?e.historico:[];f.exportOptions.excel.readDataSource=true;a.divConsultarHistorico.swidget().refresh(f);a.divContainerConsultarHistorico.show()};c.request()}else{a.divContainerConsultarHistorico.hide()}};a.initControlsConsultasIntellisoa=function(){a.txtConsultasIntellisoaCuit.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtConsultasIntellisoaCuit,false);a.divConsultasIntellisoa.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Consultas Intellisoa",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:[],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Consultas Intellisoa"}}},selection:false,rowHover:false,paging:{pageSize:100,pageLinksCount:10},noRecordsText:"No se encontraron resultados."});a.btnConsultasIntellisoaObtenerEstado.on("click",function(){var d={value:true};Core.Functions.Validations.toggleValidation(a.txtConsultasIntellisoaCuit,false);var b={personasBuscar:[{}]};b.personasBuscar[0].Cuit=Core.Functions.Validations.getValidatedSwidgetValue(a.txtConsultasIntellisoaCuit,d);if(d.value){var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"Intellisoa/beingStatus",requestType:"POST",requestData:b});c.onSuccess=function(f){a.dataConsultasIntellisoa=f;var g=[];if(f.beingStatusWithAddressResponse&&f.beingStatusWithAddressResponse.beingStatusList){if(f.beingStatusWithAddressResponse.beingStatusList.beingStatus&&f.beingStatusWithAddressResponse.beingStatusList.beingStatus.length){g=f.beingStatusWithAddressResponse.beingStatusList.beingStatus}else{if(f.beingStatusWithAddressResponse.beingStatusList.beingStatus){g=[f.beingStatusWithAddressResponse.beingStatusList.beingStatus]}}}g.forEach(function(j,i){j["BCRA-inhibited"]=Core.Functions.grid.formatBoolean(j["BCRA-inhibited"]);j["BCRA-disqualified"]=Core.Functions.grid.formatBoolean(j["BCRA-disqualified"]);j.taxInfo=(j.taxInfo?JSON.stringify(j.taxInfo):"null");j.cuits=(j.cuits?JSON.stringify(j.cuits):"null");j["BCRA-data"]=(j["BCRA-data"]?JSON.stringify(j["BCRA-data"]):"null")});var h=a.divConsultasIntellisoa.swidget().initialOptions;var e=[];e.push({field:"name",title:"Nombre",headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});e.push({field:"taxInfo",title:"Tax Info",headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),columnTemplate:function(i,j,k){i.css("word-wrap","break-word");i.html(Core.Functions.grid.formatUndefinedString(j.taxInfo))}});e.push({field:"cuits",title:"Cuits",headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),columnTemplate:function(i,j,k){i.css("word-wrap","break-word");i.html(Core.Functions.grid.formatUndefinedString(j.cuits))}});e.push({field:"govermentEmployeeStatus",title:"Estado",headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});e.push({field:"BCRA-inhibited",title:"BCRA Inhabilitado",headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});e.push({field:"BCRA-disqualified",title:"BCRA Descalificado",headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});e.push({field:"BCRA-data",title:"BCRA Data",headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),columnTemplate:function(i,j,k){i.css("word-wrap","break-word");i.html(Core.Functions.grid.formatUndefinedString(j["BCRA-data"]))}});h.columns=e;h.dataSource.data=g;h.exportOptions.excel.dataSource.data=g;h.exportOptions.excel.columnFields=["name","taxInfo","cuits","govermentEmployeeStatus","BCRA-inhibited","BCRA-disqualified","BCRA-data"];h.exportOptions.excel.readDataSource=true;a.divConsultasIntellisoa.swidget().refresh(h);a.divContainerConsultasIntellisoa.show();a.btnConsultasIntellisoaRespuesta.show()};c.request()}else{a.btnConsultasIntellisoaRespuesta.hide();a.divContainerConsultasIntellisoa.hide()}});a.btnConsultasIntellisoaDescalificadoBCRA.on("click",function(){var d={value:true};Core.Functions.Validations.toggleValidation(a.txtConsultasIntellisoaCuit,false);var b={personasBuscar:[{}]};b.personasBuscar[0].Cuit=Core.Functions.Validations.getValidatedSwidgetValue(a.txtConsultasIntellisoaCuit,d);if(d.value){var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"Intellisoa/bcraDisqualified",requestType:"POST",requestData:b});c.onSuccess=function(f){a.dataConsultasIntellisoa=f;var g=[];if(f.isBcraDisqualifiedResponse&&f.isBcraDisqualifiedResponse.bcraStatusList){if(f.isBcraDisqualifiedResponse.bcraStatusList.bcraStatus&&f.isBcraDisqualifiedResponse.bcraStatusList.bcraStatus.length){g=f.isBcraDisqualifiedResponse.bcraStatusList.bcraStatus}else{if(f.isBcraDisqualifiedResponse.bcraStatusList.bcraStatus){g=[f.isBcraDisqualifiedResponse.bcraStatusList.bcraStatus]}}}g.forEach(function(j,i){j["bcra-inhibited"]=Core.Functions.grid.formatBoolean(j["bcra-inhibited"])});var h=a.divConsultasIntellisoa.swidget().initialOptions;var e=[];e.push({field:"name",title:"Nombre",width:"75%",headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});e.push({field:"bcra-inhibited",title:"BCRA Inhabilitado",width:"25%",headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});h.columns=e;h.dataSource.data=g;h.exportOptions.excel.dataSource.data=g;h.exportOptions.excel.columnFields=["name","bcra-inhibited"];h.exportOptions.excel.readDataSource=true;a.divConsultasIntellisoa.swidget().refresh(h);a.divContainerConsultasIntellisoa.show();a.btnConsultasIntellisoaRespuesta.show()};c.request()}else{a.btnConsultasIntellisoaRespuesta.hide();a.divContainerConsultasIntellisoa.hide()}});a.btnConsultasIntellisoaEmpleadoGobierno.on("click",function(){var d={value:true};Core.Functions.Validations.toggleValidation(a.txtConsultasIntellisoaCuit,false);var b={personasBuscar:[{}]};b.personasBuscar[0].Cuit=Core.Functions.Validations.getValidatedSwidgetValue(a.txtConsultasIntellisoaCuit,d);if(d.value){var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"Intellisoa/govEmployee",requestType:"POST",requestData:b});c.onSuccess=function(f){a.dataConsultasIntellisoa=f;var g=[];if(f.govEmployeeStatusResponse&&f.govEmployeeStatusResponse.govermentEmployeeList){if(f.govEmployeeStatusResponse.govermentEmployeeList.govermentEmployee&&f.govEmployeeStatusResponse.govermentEmployeeList.govermentEmployee.length){g=f.govEmployeeStatusResponse.govermentEmployeeList.govermentEmployee}else{if(f.govEmployeeStatusResponse.govermentEmployeeList.govermentEmployee){g=[f.govEmployeeStatusResponse.govermentEmployeeList.govermentEmployee]}}}var h=a.divConsultasIntellisoa.swidget().initialOptions;var e=[];e.push({field:"name",title:"Nombre",width:"50%",headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});e.push({field:"govermentEmployeeStatus",title:"Estado",width:"50%",headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});h.columns=e;h.dataSource.data=g;h.exportOptions.excel.dataSource.data=g;h.exportOptions.excel.columnFields=["name","govermentEmployeeStatus"];h.exportOptions.excel.readDataSource=true;a.divConsultasIntellisoa.swidget().refresh(h);a.divContainerConsultasIntellisoa.show();a.btnConsultasIntellisoaRespuesta.show()};c.request()}else{a.btnConsultasIntellisoaRespuesta.hide();a.divContainerConsultasIntellisoa.hide()}});a.btnConsultasIntellisoaRespuesta.on("click",function(){var b=new Core.Controls.Dialog("Respuesta JSON.",JSON.stringify(a.dataConsultasIntellisoa),{displayButtons:{close:true,accept:false}});b.show()});a.btnConsultasIntellisoaRespuesta.hide()}};Core.Business.MMKT_LIQUI=new function(){var a=this;a.id="LiquidacionesDiarias";a.divCortes=null;a.lblTitle=null;a.txtDate=null;a.btnGenerarNuevoCorte=null;a.pageOptions=null;a.init=function(b,c){Core.loadPage("backoffice-mmkt-liquidaciones-diarias.html",function(){document.title="Liquidaciones Diarias";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divCortes=$(".div-cortes");a.lblTitle=$(".label-title");a.txtDate=$(".textbox-date");a.btnGenerarNuevoCorte=$(".btn-generar-nuevo-corte");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.MMKT_LIQUI")})};a.initControls=function(){a.txtDate.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loadGrid()}}});a.btnGenerarNuevoCorte.on("click",function(){var c=new Core.Ajax.ServerRequest({overlayElement:a.btnGenerarNuevoCorte,secureRequest:true,requestUrl:"fondos/MMKT/liq/corte/1/"+Core.Functions.Date.getDisplayDateWithSeparator(a.txtDate.swidget().value(),"-"),requestType:"GET"});c.onSuccess=function(d){if(d.cantSusc>0||d.cantResc>0){new Core.Controls.Confirmation("Confirmación","Se generará un corte con "+d.cantSusc+" suscripciones y "+d.cantResc+" Rescates. Esta seguro que desea continuar?",{onAccepted:function(){var e=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"fondos/MMKT/liq/corte/1/"+Core.Functions.Date.getDisplayDateWithSeparator(a.txtDate.swidget().value(),"-"),requestType:"POST"});e.onSuccess=function(f){a.loadGrid()};e.request()}}).show()}else{new Core.Controls.Dialog("Aviso","No se puede generar un nuevo corte ya que no existen suscripciones o rescates.",{displayButtons:{close:true,accept:false}}).show()}};c.request()});var b=[];b.push({field:"NumCorte",title:"N° Corte",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatIntegerNumber});b.push({field:"Fecha_Hora",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"NombreCorto",title:"Fondo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Usuario",title:"Usuario",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"CanSuscripciones",title:"Cant. Susc",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatIntegerNumber});b.push({field:"CantRescates",title:"Cant. Resc",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatIntegerNumber});b.push({width:100,title:" ",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(e,f,g){var c=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(e);c.on("click",function(){var h=new Core.Ajax.ServerRequest({overlayElement:c,secureRequest:true,requestUrl:"fondos/MMKT/liquidacion/1/"+Core.Functions.Date.getDisplayDateWithSeparator(a.txtDate.swidget().value(),"-")+"/"+f.NumCorte,requestType:"GET"});h.onSuccess=function(j){var m="<table class='table table-striped'>";m+="<thead><tr><th>Tipo Movimiento</th><th>N° Solicitud</th><th>N° Cuotapartista</th><th>Cuotapartista</th><th>Cuotapartes</th><th>Importe</th><th>Forma de Pago</th><th>Rescate Total</th></tr></thead>";m+="<tbody>";for(var l=0;l<j.CortesDetalles.length;l++){m+="<tr"+(j.CortesDetalles[l].Anulado?" style='background-color:lightcoral;' ":"")+">";m+="<td>"+j.CortesDetalles[l].TipoMovimiento+"</td>";m+="<td>"+j.CortesDetalles[l].NumSolicitud+"</td>";m+="<td>"+j.CortesDetalles[l].NumCuotapartista+"</td>";m+="<td>"+j.CortesDetalles[l].DescCuotapartista+"</td>";m+="<td>"+j.CortesDetalles[l].Cuotapartes+"</td>";m+="<td>"+j.CortesDetalles[l].Importe+"</td>";m+="<td>"+j.CortesDetalles[l].FormaDePago+"</td>";m+="<td>"+j.CortesDetalles[l].RescTotal+"</td>";m+="</tr>"}m+="</tbody>";m+="</table>";var k=new Core.Controls.Dialog("Detalles del Corte: "+f.NumCorte,m,{displayButtons:{close:true,accept:false}});k.show()};h.request()});var d=$('<button type="button" title="Descargar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>').appendTo(e);d.on("click",function(){function i(p){var o=new Blob([p.response],{type:p.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(o);return}var j=window.URL.createObjectURL(o);var n=document.createElement("a");n.href=j;var l=p.getResponseHeader("Content-Disposition").split("; ");var k="filename=file.pdf";for(var m=0;m<l.length;m++){if(l[m].indexOf("filename")>=0){k=l[m]}}n.download=k.split("=")[1];n.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(j)}var h=new XMLHttpRequest();h.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"download/MMKT/1/"+Core.Functions.Date.getDisplayDateWithSeparator(a.txtDate.swidget().value(),"-")+"/"+f.NumCorte,true);h.responseType="blob";h.setRequestHeader("Authorization",Core.Objects.Context.Token);h.onload=function(j){if(h.status==200){i(h)}else{var k=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga.</p>",{displayButtons:{close:true,accept:false}});k.show()}};h.send()})}});a.divCortes.shieldGrid({dataSource:{data:[]},paging:{pageSize:100,pageLinksCount:10},selection:false,rowHover:false,sorting:{multiple:true},columns:b})};a.loadGrid=function(){a.lblTitle.text("Al "+Core.Functions.Date.getDisplayDate(a.txtDate.swidget().value()));var b=new Core.Ajax.ServerRequest({overlayElement:a.divCortes.parent(),secureRequest:true,requestUrl:"fondos/MMKT/liquidacion/1/"+Core.Functions.Date.getDisplayDateWithSeparator(a.txtDate.swidget().value(),"-"),requestType:"GET"});b.onSuccess=function(c){var d=a.divCortes.swidget().initialOptions;d.dataSource.data=c.Cortes;a.divCortes.swidget().refresh(d)};b.request()}};Core.Business.MovimientosManuales=new function(){var a=this;a.id="homeMovimientosManuales";a.divMain=null;a.divContainerArchivosCargados=null;a.divContainerCargarMovimientos=null;a.divArchivosCargados=null;a.btnCargarNuevosMovimientos=null;a.pageOptions=null;a.init=function(b,c){Core.loadPage("backoffice-movimientos-manuales.html",function(){document.title="Movimientos Manuales";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divMain=$(".div-main");a.divContainerArchivosCargados=$(".div-container-archivos-cargados");a.divContainerArchivosCargados.show();a.divContainerCargarMovimientos=$(".div-container-cargar-movimientos");a.divContainerCargarMovimientos.hide();a.divArchivosCargados=$(".div-archivos-cargados");a.btnCargarNuevosMovimientos=$(".btn-cargar-nuevos-movimientos");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.MovimientosManuales")})};a.initControls=function(){var b=[];b.push({width:"55%",field:"NombreArchivo",title:"Nombre Archivo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"15%",field:"FechaCarga",title:"Fecha Carga",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatStringDateWithTime});b.push({width:"15%",field:"CantidadMovimientos",title:"Cantidad Movimientos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({width:"15%",field:"CantidadInsertada",title:"Cantidad Insertada",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({width:45,title:" ",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,e,f){var c=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(d);c.on("click",function(){new Core.Business.MovimientosManuales.CargarMovimientos({idMovimientoArchivo:e.idMovimientoArchivo,overlayElement:c,onLoad:function(){a.divContainerArchivosCargados.hide()},onClosed:function(){a.divContainerArchivosCargados.show();a.loadGrid()}}).show()})}});a.divArchivosCargados.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:b});a.btnCargarNuevosMovimientos.on("click",function(){new Core.Business.MovimientosManuales.CargarMovimientos({onLoad:function(){a.divContainerArchivosCargados.hide()},onClosed:function(){a.divContainerArchivosCargados.show();a.loadGrid()}}).show()})};a.loadGrid=function(){var b=new Core.Ajax.ServerRequest({overlayElement:a.divMain,secureRequest:true,requestUrl:"MovimientosVBolsa/obtenerArchivos",requestType:"GET"});b.onSuccess=function(c){var d=a.divArchivosCargados.swidget().initialOptions;d.dataSource.data=(c.ArchivosCargados?c.ArchivosCargados:[]);a.divArchivosCargados.swidget().refresh(d)};b.request()}};Core.Business.MovimientosManuales.CargarMovimientos=function(b){var a=this;a.container=$(".div-container-cargar-movimientos");a.onLoad=function(){};a.onClosed=function(){};a.movimientos=[];a.detalles=[];a.idMovimientoArchivo=null;a.overlayElement=null;a.coloresActivos={};$.extend(true,a,b);a.show=function(){a.initControls();if(a.idMovimientoArchivo){a.loadGrid(a.overlayElement,function(){a.onLoad();a.container.show()})}else{a.onLoad();a.container.show()}};a.initControls=function(){a.divFile=a.container.find(".div-file");a.divFile.show();if(a.idMovimientoArchivo){a.divFile.hide()}a.inputFiles=a.container.find(".input-upload-file");a.inputFiles.val("");a.btnConfirmarArchivos=a.container.find(".btn-confirmar-archivo");a.btnConfirmarArchivos.unbind("click");a.btnConfirmarArchivos.on("click",function(){if(a.inputFiles[0].files.length!=1){new Core.Controls.Dialog("Aviso","<p>Debe seleccionar un archivo.</p>",{displayButtons:{close:true,accept:false}}).show();return}for(var k=0,g;g=a.inputFiles[0].files[k];k++){var h=g.name.split(".");var e=h[h.length-1];if(e!="xlsx"){new Core.Controls.Dialog("Aviso","<p>Los archivos seleccionados deben ser: pdf.</p>",{displayButtons:{close:true,accept:false}}).show();return}}var j={Authorization:Core.Objects.Context.Token,Accept:"application/json"};var d=new FormData();for(var k=0,g;g=a.inputFiles[0].files[k];k++){d.append("file-"+k,g)}var l=new Core.Controls.Overlay(a.btnConfirmarArchivos,{});$.ajax({type:"POST",url:Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"upload/csv/movimientosManuales/cargarArchivo",data:d,cache:false,contentType:false,processData:false,method:"POST",headers:j,success:function(f){a.idMovimientoArchivo=((f&&f.idMovimientoArchivo)?f.idMovimientoArchivo:null);a.loadGrid();a.btnRefresh.show();a.inputFiles.val("");l.destroy()},error:function(i){var n=JSON.parse(i.responseText);var o=(n&&n.descripcion)?"Mensaje":"Error de conexión";var f=(n&&n.descripcion)?n.descripcion:"Algunos componentes de la página no se cargaron correctamente. Por favor intente mas tarde...";var m=new Core.Controls.Dialog(o,"<p>"+f+"</p>",{displayButtons:{close:true,accept:false}});m.show();l.destroy()}})});var c=[];c.push({width:"10%",field:"CTTENro",title:"CTTE Número",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});c.push({width:"20%",field:"CTTEDenominacion",title:"CTTE Denominación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"10%",field:"Empresa",title:"Empresa",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"10%",field:"FechaConcertacion",title:"Fecha Concertación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"10%",field:"FechaLiquidacion",title:"Fecha Liquidación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"20%",field:"DescripcionMovimiento",title:"Descripción Movimiento",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"20%",field:"CantMov",title:"Cantidad Movimientos",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:90,title:" ",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),columnTemplate:function(f,g,h){if(g.Color){f.parent().css("background-color","rgba("+Core.Functions.grid.hexToRgb(g.Color)+((h%2==0)?", 0.6":", 1 ")+")")}var d=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(f);d.on("click",function(){var j="";j+="<table class='table table-striped'>";j+="<thead><tr><th>Nombre</th><th>Valor</th></tr></thead>";j+="<tbody>";$.each(g,function(k,l){if($.grep(a.detalles,function(m,n){return m.Descripcion==k})[0]){j+="<tr>";j+="<td>"+k.replaceAll("_"," ")+"</td>";j+="<td>"+l+"</td>";j+="</tr>"}});j+="</tbody>";j+="</table>";var i=new Core.Controls.Dialog("Detalles",j,{displayButtons:{close:true,accept:false}});i.show()});if(g.MensajeError){var e=$('<button type="button" title="Error" class="btn-sm balanz-button"><span class="glyphicon glyphicon-warning-sign"></span></button>').appendTo(f);e.on("click",function(){var i=new Core.Controls.Dialog("Error",g.MensajeError,{displayButtons:{close:true,accept:false}});i.show()})}}});c.push({title:" ",field:"",width:40,headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),columnTemplate:function(d,f,e){if(f.chk){$(f.chk).appendTo(d)}}});a.divMovimientosEstados=a.container.find(".div-movimientos-estados");a.divMovimientosEstados.empty();a.divMovimientos=a.container.find(".div-movimientos");a.divMovimientos.shieldGrid({dataSource:{data:[]},paging:{pageSize:50,pageLinksCount:10},selection:false,rowHover:false,columns:c});a.btnInvertSelection=a.container.find(".btn-invertir-seleccion");a.btnInvertSelection.unbind("click");a.btnInvertSelection.on("click",function(){a.divMovimientos.swidget().dataSource.data.forEach(function(e,d){if(e.chk){e.chk[0].checked=!e.chk[0].checked}})});a.btnConfirmarCarga=a.container.find(".btn-confirmar-carga");a.btnConfirmarCarga.unbind("click");a.btnConfirmarCarga.on("click",function(){var d=[];a.movimientos.forEach(function(f,e){if(f.chk&&f.chk[0].checked){d.push(f)}});if(d.length==0){new Core.Controls.Dialog("Aviso","Debe seleccionar al menos un movimiento a cargar.",{displayButtons:{close:true,accept:false}}).show();return}new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea cargar "+((d.length>1)?("los "+d.length+" movimientos seleccionados"):("el movimiento seleccionado"))+"?",{onAccepted:function(){var e={Movimientos:[]};d.forEach(function(h,g){e.Movimientos.push({idMovimientoVBolsaDetalle:h.idMovimientoVBolsaDetalle})});var f=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.btnConfirmarCarga,requestUrl:"MovimientosVBolsa/registrarMovimiento",requestType:"POST",requestData:e});f.onSuccess=function(g){new Core.Controls.ProcessProgress({idProcess:((g&&g.idProceso)?g.idProceso:0),overlayElement:a.container,onFinish:function(){a.loadGrid()}}).show()};f.request()}}).show()});a.btnRefresh=a.container.find(".btn-refresh");a.btnRefresh.unbind("click");a.btnRefresh.on("click",function(){a.loadGrid()});a.btnRefresh.hide();if(a.idMovimientoArchivo){a.btnRefresh.show()}a.btnVolver=a.container.find(".btn-volver");a.btnVolver.unbind("click");a.btnVolver.on("click",function(){a.destroy()})};a.loadGrid=function(d,c){var e=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:(d?d:a.container),requestUrl:"MovimientosVBolsa/obtenerDetalleArchivo/"+a.idMovimientoArchivo,requestType:"GET"});e.onSuccess=function(f){a.movimientos=((f&&f.Movimientos)?f.Movimientos:[]);a.detalles=((f&&f.Detalles)?f.Detalles:[]);var g=[];a.movimientos.forEach(function(i,h){if(i.reintentar){i.chk=$('<input type="checkbox" />')}if(i.Estado&&$.grep(g,function(j,k){return j.Estado==i.Estado}).length==0){g.push({Estado:i.Estado,Color:i.Color?i.Color:""})}});a.divMovimientosEstados.empty();g.forEach(function(h,j){var k=$('<label class="lblColorContador" color="'+h.Color+'" activo="'+((a.coloresActivos[h.Color]==false)?"false":"true")+'" style="color: #2d2d2d !important; border-radius:4px; margin-right:3px; border: 4px solid '+(h.Color?h.Color:"transparent")+"; background-color:"+((a.coloresActivos[h.Color]==false)?"#c4c4c4":h.Color)+';">'+h.Estado+"</label>").appendTo(a.divMovimientosEstados);if(a.coloresActivos[h.Color]==null){a.coloresActivos[h.Color]=true}k.on("click",function(){a.setColor(k)})});a.refreshGrid();if(c){c()}};e.request()};a.setColor=function(c){if(c.attr("activo")=="true"){c.css("background-color","#c4c4c4");c.attr("activo","false");a.coloresActivos[c.attr("color")]=false}else{c.css("background-color",c.attr("color"));c.attr("activo","true");a.coloresActivos[c.attr("color")]=true}a.refreshGrid()};a.refreshGrid=function(){var g=$.grep(a.movimientos,function(j,h){return true});var c=$(".lblColorContador");for(var d=0;d<c.length;d++){var f=$(c[d]);if(f.attr("activo")=="false"){g=$.grep(g,function(j,h){return j.Color!=f.attr("color")})}}var e=a.divMovimientos.swidget().initialOptions;e.dataSource.data=g;a.divMovimientos.swidget().refresh(e)};a.destroy=function(){a.divMovimientos.swidget().destroy();a.container.hide();a.onClosed()}};Core.Business.ObtenerOrdenesTesoreriaDepositos=new function(){var a=this;var b=600000;a.id="obtenerOrdenesTesoreriaDepositos";a.divOrdenes=null;a.idDefaultAccount=null;a.idDefaultProfile=null;a.pageOptions=null;a.loaded=false;a.timerId=null;a.btnRefresh=null;a.btnFinalizarOrdenes=null;a.window=$(window);a.init=function(c,d){Core.loadPage("backoffice-ordenes-tesoreria-depositos.html",function(){document.title="Ordenes Tesorería Depósitos";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[d]);a.idDefaultAccount=c;a.idDefaultProfile=d;a.divMain=$(".div-main");a.divOrdenes=$(".div-ordenes");a.btnRefresh=$(".btn-refresh");a.btnFinalizarOrdenes=$(".btn-finalizar-ordenes");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,c,d,function(){a.loaded=false;a.loadGrid()},"Core.Business.ObtenerOrdenesTesoreriaDepositos");a.timerId=window.setInterval(function(){a.loadGrid()},b);Core.Objects.Context.Timers.push(a.timerId)})};a.initControls=function(){a.btnRefresh.on("click",function(){a.loaded=false;a.loadGrid()});a.btnFinalizarOrdenes.on("click",function(){var e=new Core.Ajax.ServerRequest({overlayElement:a.btnFinalizarOrdenes,showOverlay:true,secureRequest:true,requestUrl:"ordenes/backoffice/finalizar",requestType:"POST",requestData:{data:{idtipooperacion:7}}});e.onSuccess=function(f){new Core.Controls.ProcessProgress({idProcess:((f&&f.idProceso)?f.idProceso:0),overlayElement:a.divMain,onFinish:function(){a.loaded=false;a.loadGrid()}}).show()};e.request()});var c=[];c.push({field:"idOrden",title:"ID",width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),columnTemplate:function(e,g,f){e.html(g.idOrden);e.css("text-align","center");e.css("padding-right","5px");if(g.Color){e.parent().css("background-color","rgba("+a.hexToRgb(g.Color)+((f%2==0)?", 0.6":", 1 ")+")")}}});c.push({field:"Estado",title:"Estado",width:"10%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({field:"FechaEmision",title:"Fecha",width:"10%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatStringDate});c.push({field:"FechaEmision",title:"Hora",width:"10%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatStringDateTime});c.push({field:"FechaLiquidacion",title:"Liquidación",width:"10%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatStringDate});c.push({field:"NumComitente",title:"Comitente",width:"10%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatIntegerNumber});c.push({field:"Moneda",title:"Moneda",width:"10%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({field:"Monto",title:"Monto",width:"10%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatNuleablePrice});c.push({field:"UsuarioIngreso",title:"Ingreso",width:"10%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({field:"idExterno",title:"ID Externo",width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});if(a.pageOptions.actualizarOrdenTesoreria){var d=Core.Functions.grid.getHeaderAttribute(c.length);c.push({width:40,field:"",title:" ",headerAttributes:d,columnTemplate:function(f,g,h){if(g.verBotonDetalle){var e=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(f);e.on("click",function(){new Core.Controls.DetalleOrdenTesoreria({orden:g,overlayElement:e,showBanco:false,showCBU:false,showCuit:false,showTitular:false,showObservacion:false}).show()})}}});c.push({width:40,field:"",title:" ",headerAttributes:d,columnTemplate:function(f,g,h){if(g.verBotonActualizarIdExterno){var e=$('<button type="button" title="Actualizar Id Externo" class="btn-sm balanz-button"><span class="glyphicon glyphicon-check"></span></button>').appendTo(f);e.on("click",function(){var i=new Core.Controls.ActualizarIdExternoOrdenTesoreria({orden:g,onSuccess:function(){a.loaded=false;a.loadGrid()}}).show()})}}});c.push({width:40,field:"",title:" ",headerAttributes:d,columnTemplate:function(f,g,h){if(g.verBotonRechazar){var e=$('<button type="button" title="Rechazar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(f);e.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea rechazar la orden: "+g.idOrden+"?",{onAccepted:function(){var i=new Core.Ajax.ServerRequest({overlayElement:e,showOverlay:true,secureRequest:true,requestUrl:"ordenes/backoffice/orden",requestType:"PUT",requestData:{id:g.idOrden,idCuenta:g.idCuenta,idEstadoOrden:g.idEstadoRechazar}});i.onSuccess=function(j){a.loaded=false;a.loadGrid();var k=new Core.Controls.Dialog("Aviso","La orden ha sido rechazada correctamente",{displayButtons:{close:true,accept:false}});k.show()};i.request()}}).show()})}}})}a.divOrdenes.shieldGrid({dataSource:{data:[]},sorting:{multiple:true},selection:false,paging:{pageSize:50,pageLinksCount:10},rowHover:false,columns:c,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Depósitos",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["idOrden","Estado","FechaEmision","FechaLiquidacion","NumComitente","Moneda","Monto","UsuarioIngreso","idExterno"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Depósitos"}}}})};a.loadGrid=function(){var c=new Core.Ajax.ServerRequest({overlayElement:a.divOrdenes.parent(),showOverlay:!a.loaded,secureRequest:true,requestUrl:"ordenes/backoffice/tesoreria/7",requestType:"GET"});c.onSuccess=function(d){var f=a.window.scrollTop();var e=a.divOrdenes.swidget().initialOptions;e.dataSource.data=d;e.dataSource.schema={data:"ordenes"};e.exportOptions.excel.dataSource.data=d;e.exportOptions.excel.dataSource.schema={data:"ordenes"};e.exportOptions.excel.readDataSource=true;a.divOrdenes.swidget().refresh(e);a.loaded=true;a.window.scrollTop(f)};c.request()};a.hexToRgb=function(d){d=d.replace("#","");var f=parseInt(d.substring(0,2),16);var e=parseInt(d.substring(2,4),16);var c=parseInt(d.substring(4,6),16);var h=f+","+e+","+c;return h}};Core.Business.ObtenerOrdenesTesoreriaTransferencias=new function(){var a=this;a.init=function(b,c){Core.Business.BaseObtenerOrdenesTesoreriaTransferencias.init(b,c,{id:"obtenerOrdenesTesoreriaTransferencias",namespace:"Core.Business.ObtenerOrdenesTesoreriaTransferencias"})}};Core.Business.ObtenerOrdenesTesoreriaBCITransferencias=new function(){var a=this;a.init=function(b,c){Core.Business.BaseObtenerOrdenesTesoreriaTransferencias.init(b,c,{id:"obtenerOrdenesTesoreriaBCITransferencias",namespace:"Core.Business.ObtenerOrdenesTesoreriaBCITransferencias"})}};Core.Business.ObtenerOrdenesTesoreriaTransferenciasCambio=new function(){var a=this;a.init=function(b,c){Core.Business.BaseObtenerOrdenesTesoreriaTransferencias.init(b,c,{id:"obtenerOrdenesTesoreriaTransferenciasCambio",namespace:"Core.Business.ObtenerOrdenesTesoreriaTransferenciasCambio"})}};Core.Business.BaseObtenerOrdenesTesoreriaTransferencias=new function(){var a=this;var b=600000;a.id="";a.namespace="";a.divOrdenes=null;a.divTipoBancoDestino=null;a.ddlTipoBancoDestino=null;a.ddlBanco=null;a.idDefaultAccount=null;a.idDefaultProfile=null;a.pageOptions=null;a.loaded=false;a.timerId=null;a.btnRefresh=null;a.btnFinalizarOrdenes=null;a.btnArchivoPagos=null;a.btnInterfazCiti=null;a.btnInterfazValores=null;a.btnInterfazRio=null;a.btnInterfazInterbanking=null;a.btnAltasCuentasInterbanking=null;a.txtFilter=null;a.timeout=null;a.divContadoresOrdenes=null;a.divEstadosOrdenes=null;a.estadosActivos={};a.coloresActivos={};a.window=$(window);a.init=function(c,d,e){Core.loadPage("backoffice-ordenes-tesoreria-transferencias.html",function(){document.title="Ordenes Tesorería Transferencias";a.id=e.id;a.namespace=e.namespace;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[d]);a.idNegocio=((a.pageOptions&&a.pageOptions.idNegocio!=null)?a.pageOptions.idNegocio:Core.Enums.eNegocio.BCV);a.idDefaultAccount=c;a.idDefaultProfile=d;a.divMain=$(".div-main");a.divOrdenes=$(".div-ordenes");a.btnRefresh=$(".btn-refresh");a.divTipoBancoDestino=$(".div-tipo-banco-destino");a.ddlTipoBancoDestino=$(".dropdown-tipo-banco-destino");a.ddlBanco=$(".dropdown-banco");a.btnFinalizarOrdenes=$(".btn-finalizar-ordenes");a.btnArchivoPagos=$(".btn-archivo-pagos");a.btnInterfazCiti=$(".btn-interfaz-citi");a.btnInterfazValores=$(".btn-interfaz-valores");a.btnInterfazRio=$(".btn-interfaz-rio");a.btnInterfazInterbanking=$(".btn-interfaz-interbanking");a.btnAltasCuentasInterbanking=$(".btn-altas-cuentas-interbanking");a.txtFilter=$(".textbox-filter");a.divContadoresOrdenes=$(".div-ordenes-contadores");a.divEstadosOrdenes=$(".div-ordenes-estados");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,c,d,function(){a.loaded=false;a.loadControls()},a.namespace);a.timerId=window.setInterval(function(){a.loadGrid()},b);Core.Objects.Context.Timers.push(a.timerId)})};a.initControls=function(){a.btnRefresh.on("click",function(){a.loaded=false;a.loadGrid()});a.btnFinalizarOrdenes.on("click",function(){var e={data:{idtipooperacion:6,idNegocio:a.idNegocio}};if(a.ddlTipoBancoDestino.swidget().value()){e.data.idTipoBancoDestino=a.ddlTipoBancoDestino.swidget().value()}var f=new Core.Ajax.ServerRequest({overlayElement:a.btnFinalizarOrdenes,showOverlay:true,secureRequest:true,requestUrl:"ordenes/backoffice/finalizar",requestType:"POST",requestData:e});f.onSuccess=function(g){new Core.Controls.ProcessProgress({idProcess:((g&&g.idProceso)?g.idProceso:0),overlayElement:a.divMain,onFinish:function(){a.loaded=false;a.loadGrid()}}).show()};f.request()});a.btnArchivoPagos.click(function(){Core.Functions.File.download(a.btnArchivoPagos,Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"ordenes/backoffice/archivopagotransferencias?idNegocio="+a.idNegocio+(a.ddlTipoBancoDestino.swidget().value()?"&idTipoBancoDestino="+a.ddlTipoBancoDestino.swidget().value():""),function(){a.loaded=false;a.loadGrid()})});a.btnAltasCuentasInterbanking.click(function(){Core.Functions.File.download(a.btnAltasCuentasInterbanking,Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"ordenes/backoffice/archivocuentasinterbanking?idNegocio="+a.idNegocio+(a.ddlTipoBancoDestino.swidget().value()?"&idTipoBancoDestino="+a.ddlTipoBancoDestino.swidget().value():""),function(){})});a.btnInterfazRio.click(function(){Core.Functions.File.download(a.btnInterfazRio,Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"ordenes/backoffice/archivointerfazrio?idNegocio="+a.idNegocio+(a.ddlTipoBancoDestino.swidget().value()?"&idTipoBancoDestino="+a.ddlTipoBancoDestino.swidget().value():""),function(){a.loaded=false;a.loadGrid()})});a.btnInterfazCiti.click(function(){Core.Functions.File.download(a.btnInterfazCiti,Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"ordenes/backoffice/archivointerfazciti?idNegocio="+a.idNegocio+(a.ddlTipoBancoDestino.swidget().value()?"&idTipoBancoDestino="+a.ddlTipoBancoDestino.swidget().value():""),function(){a.loaded=false;a.loadGrid()})});a.btnInterfazValores.click(function(){Core.Functions.File.download(a.btnInterfazValores,Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"ordenes/backoffice/archivointerfazvalores?idNegocio="+a.idNegocio+(a.ddlTipoBancoDestino.swidget().value()?"&idTipoBancoDestino="+a.ddlTipoBancoDestino.swidget().value():""),function(){a.loaded=false;a.loadGrid()})});a.btnInterfazInterbanking.on("click",function(){var e={idNegocio:a.idNegocio};if(a.ddlTipoBancoDestino.swidget().value()){e.idTipoBancoDestino=a.ddlTipoBancoDestino.swidget().value()}var f=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"ordenes/backoffice/interfazinterbanking",requestType:"PUT",requestData:e});f.onSuccess=function(g){a.loaded=false;a.loadGrid()};f.request()});a.ddlTipoBancoDestino.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{idTipoBancoDestino}",events:{select:function(e){a.loaded=false;a.loadControls()}}});a.ddlBanco.shieldDropDown({dataSource:{data:[]},textTemplate:"{BancoTransferencia}",valueTemplate:"{idBanco}",value:"2"});a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var e=a.divOrdenes.swidget().dataSource;if(value){e.filter={or:[{path:"idOrden",filter:"contains",value:value},{path:"Estado",filter:"contains",value:value},{path:"NumCuenta",filter:"contains",value:value},{path:"CBU",filter:"contains",value:value},{path:"CUIT",filter:"contains",value:value},{path:"Titular",filter:"contains",value:value},{path:"UsuarioIngreso",filter:"contains",value:value}]}}else{e.filter=null}e.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,(a.namespace+".txtFilter"));var c=[];c.push({field:"idOrden",title:"ID",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),columnTemplate:function(e,g,f){e.html(g.idOrden);e.css("text-align","center");e.css("padding-right","5px");if(g.Color){e.parent().css("background-color","rgba("+Core.Functions.grid.hexToRgb(g.Color)+((f%2==0)?", 0.6":", 1 ")+")")}}});c.push({field:"Estado",title:"Estado",width:"5%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({field:"FechaEmision",title:"Fecha",width:"6%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatStringDate});c.push({field:"FechaEmision",title:"Hora",width:"4%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatStringDateTime});c.push({field:"FechaLiquidacion",title:"Liquidación",width:"6%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatStringDate});c.push({field:"NumCuenta",title:(a.idNegocio==Core.Enums.eNegocio.BalanzCambio?"Cuenta Cambio":"Comitente"),width:"5%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatIntegerNumber});c.push({field:"Moneda",title:"Moneda",width:"4%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({field:"Monto",title:"Monto",width:"6%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatNuleablePrice});c.push({field:"CBU",title:(a.idNegocio==Core.Enums.eNegocio.BalanzCambio?"CBU":"CBU / Account"),width:"12%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({field:"CUIT",title:"CUIT / CUIL",width:"8%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({field:"Titular",title:"Titular",width:"10%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({field:"Banco",title:"Banco",width:"10%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({field:"UsuarioIngreso",title:"Ingreso",width:"5%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({field:"idExterno",title:"ID Externo",width:"7%",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"bancoTransferencia",title:"Banco Transferencia",width:"7%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({field:"idLote",title:"ID Lote",width:"7%",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),columnTemplate:function(e,f,g){if(f.idLote){e.html("<a>"+f.idLote+"</a>");e.addClass("link-cell");e.on("click",function(){var h=new Core.Controls.Dialog("Observaciones Interfaz",(f.ObservacionesInterfaz)?f.ObservacionesInterfaz:"",{displayButtons:{close:true,accept:false}});h.show()})}}});if(a.pageOptions&&a.pageOptions.actualizarOrdenTesoreriaTransf){var d=Core.Functions.grid.getHeaderAttribute(c.length);c.push({width:40,field:"",title:" ",headerAttributes:d,columnTemplate:function(g,h,i){if(h.verBotonExportarEscoBolsa){var f=(a.idNegocio==Core.Enums.eNegocio.BalanzCambio?"Realizar Pago":"Exportar ESCO Bolsa");var e=$('<button type="button" title="'+f+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-chevron-right"></span></button>').appendTo(g);e.on("click",function(){if(a.ddlBanco.swidget().selectedItem()){e.hide();var k=new Core.Ajax.ServerRequest({overlayElement:e,showOverlay:true,secureRequest:true,requestUrl:"ordenes/backoffice/transferenciaimportarvbolsa",requestType:"PUT",requestData:{data:{idCuenta:h.idCuenta,idOrden:h.idOrden,idBanco:a.ddlBanco.swidget().selectedItem().idBanco}}});k.onSuccess=function(l){};k.onError=function(m){var o=(m.responseJSON&&m.responseJSON.Descripcion)?"Mensaje":"Error de conexión";var l=(m.responseJSON&&m.responseJSON.Descripcion)?m.responseJSON.Descripcion:"Algunos componentes de la página no se cargaron correctamente. Por favor intente mas tarde...";var n=new Core.Controls.Dialog(o,"<p>"+l+"</p>",{displayButtons:{close:true,accept:false}});n.show()};k.request()}else{var j=new Core.Controls.Dialog("Aviso","Debe seleccionar un banco.",{displayButtons:{close:true,accept:false}});j.show()}})}}});if(a.idNegocio==Core.Enums.eNegocio.BalanzCambio){c.push({width:40,field:"",title:" ",headerAttributes:d,columnTemplate:function(f,g,h){if(g.verBotonCP){var e=$('<button type="button" title="Generar CP" class="btn-sm balanz-button"><span class="glyphicon glyphicon-log-out"></span></button>').appendTo(f);e.on("click",function(){if(a.ddlBanco.swidget().selectedItem()){new Core.Controls.Confirmation("Confirmación","Seguro que desea generar el Comprabante de Pago para la Orden "+g.idOrden+" con el Banco "+a.ddlBanco.swidget().selectedItem().BancoTransferencia+"?",{onAccepted:function(){var j=new Core.Ajax.ServerRequest({overlayElement:e,showOverlay:true,secureRequest:true,requestUrl:"ordenes/backoffice/realizartransferenciamanualbalanzcambio",requestType:"PUT",requestData:{data:{idCuenta:g.idCuenta,idOrden:g.idOrden,idBanco:a.ddlBanco.swidget().selectedItem().idBanco}}});j.onSuccess=function(k){a.loaded=false;a.loadGrid();new Core.Controls.DetalleOrdenTesoreria({orden:g}).show()};j.request()}}).show()}else{var i=new Core.Controls.Dialog("Aviso","Debe seleccionar un banco.",{displayButtons:{close:true,accept:false}});i.show()}})}}})}c.push({width:40,field:"",title:" ",headerAttributes:d,columnTemplate:function(f,g,h){if(g.verBotonDetalle){var e=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(f);e.on("click",function(){new Core.Controls.DetalleOrdenTesoreria({orden:g,overlayElement:e}).show()})}}});if(a.idNegocio!=Core.Enums.eNegocio.BalanzCambio){c.push({width:40,field:"",title:" ",headerAttributes:d,columnTemplate:function(f,g,h){if(g.verBotonActualizarIdExterno){var e=$('<button type="button" title="Actualizar Id Externo" class="btn-sm balanz-button"><span class="glyphicon glyphicon-check"></span></button>').appendTo(f);e.on("click",function(){var i=new Core.Controls.ActualizarIdExternoOrdenTesoreria({orden:g,onSuccess:function(){a.loaded=false;a.loadGrid()}}).show()})}}})}c.push({width:40,field:"",title:" ",headerAttributes:d,columnTemplate:function(f,g,h){if(g.verBotonRechazar){var e=$('<button type="button" title="Rechazar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(f);e.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea rechazar la orden: "+g.idOrden+"?",{onAccepted:function(){var i=new Core.Ajax.ServerRequest({overlayElement:e,showOverlay:true,secureRequest:true,requestUrl:"ordenes/backoffice/orden",requestType:"PUT",requestData:{id:g.idOrden,idCuenta:g.idCuenta,idEstadoOrden:g.idEstadoRechazar}});i.onSuccess=function(j){a.loaded=false;a.loadGrid();var k=new Core.Controls.Dialog("Aviso","La orden ha sido rechazada correctamente",{displayButtons:{close:true,accept:false}});k.show()};i.request()}}).show()})}}})}a.divOrdenes.shieldGrid({dataSource:{data:[]},sorting:{multiple:true},selection:false,paging:{pageSize:50,pageLinksCount:10},rowHover:false,columns:c,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Transferencias",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["idOrden","Estado","FechaEmision","FechaLiquidacion","NumCuenta","Moneda","Monto","CBU","CUIT","Titular","Banco","UsuarioIngreso","idExterno","bancoTransferencia"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Transferencias"}}}})};a.loadControls=function(){var c={idNegocio:a.idNegocio};if(a.ddlTipoBancoDestino.swidget().value()){c.idTipoBancoDestino=a.ddlTipoBancoDestino.swidget().value()}var d=new Core.Ajax.ServerRequest({overlayElement:a.divOrdenes.parent(),showOverlay:!a.loaded,secureRequest:true,requestUrl:"ordenes/backoffice/bancostransferencias",requestType:"GET",requestData:c});d.onSuccess=function(g){var f=g.bancostransferencias?g.bancostransferencias:[];var e=$.grep(f,function(j,i){return j.esDefault})[0];var h=a.ddlBanco.swidget().initialOptions;h.dataSource.data=f;h.value=e?e.idBanco.toString():"";a.ddlBanco.swidget().refresh(h);a.setButtons(f);a.loadGrid()};d.request()};a.setButtons=function(c){a.btnFinalizarOrdenes.hide();a.btnArchivoPagos.hide();a.btnAltasCuentasInterbanking.hide();a.btnInterfazRio.hide();a.btnInterfazCiti.hide();a.btnInterfazValores.hide();a.btnInterfazInterbanking.hide();if(a.idNegocio!=Core.Enums.eNegocio.BalanzCambio){a.btnFinalizarOrdenes.show();a.btnArchivoPagos.show();if($.grep(c,function(e,d){return e.idBanco==1})[0]){a.btnInterfazRio.show()}if($.grep(c,function(e,d){return e.idBanco==2})[0]){a.btnInterfazValores.show()}if($.grep(c,function(e,d){return e.idBanco==10})[0]){a.btnInterfazCiti.show()}if($.grep(c,function(e,d){return e.idBanco==1||e.idBanco==2||e.idBanco==50})[0]){a.btnInterfazInterbanking.show();a.btnAltasCuentasInterbanking.show()}}};a.loadGrid=function(){var c={idNegocio:a.idNegocio};if(a.ddlTipoBancoDestino.swidget().value()){c.idTipoBancoDestino=a.ddlTipoBancoDestino.swidget().value()}var d=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"ordenes/backoffice/tesoreria/6",requestType:"GET",requestData:c});d.onSuccess=function(f){a.divTipoBancoDestino.hide();var j=((f&&f.TiposBancosDestino)?f.TiposBancosDestino:[]);var i=$.grep(j,function(l,k){return l.Seleccionado})[0];var h=a.ddlTipoBancoDestino.swidget().initialOptions;h.dataSource.data=j;h.value=i?i.idTipoBancoDestino.toString():"";a.ddlTipoBancoDestino.swidget().refresh(h);if(j.length>1&&a.idNegocio!=Core.Enums.eNegocio.BCI){a.divTipoBancoDestino.show()}a.data=f;var g=[];$.each(a.data.ordenes,function(k,l){if(g.indexOf(l.Estado)<0){g.push(l.Estado)}});g.sort(function(k,l){if(k>l){return 1}else{return -1}});a.divEstadosOrdenes.empty();$.each(g,function(k,o){var p=$.grep(a.data.ordenes,function(r,q){return r.Estado==o});var n=0;var m=0;$.each(p,function(q,r){if(r.Moneda=="Pesos"){n+=r.Monto}else{m+=r.Monto}});var l=$("<label class='lblEstadoContador' style='background-color: "+((a.estadosActivos[o]==false)?"transparent; ":"lightblue; ")+"margin: 8px 6px 8px 0; padding: 4px 5px; border: 1px solid #ccc;  font-weight: normal;' activo='"+((a.estadosActivos[o]==false)?"false":"true")+"' estado='"+o+"'>"+o+": <strong style='color: #333;'>"+p.length+"</strong><br/>$: <strong style='color: #333;'>"+Core.Functions.grid.formatIntegerNumber(n)+"</strong><br/>USD: <strong style='color: #333;'>"+Core.Functions.grid.formatIntegerNumber(m)+"</strong></label>").appendTo(a.divEstadosOrdenes);if(a.estadosActivos[o]==null){a.estadosActivos[o]=true}l.on("click",function(){a.setEstado(l)})});var e=[];a.data.ordenes.forEach(function(l,k){if(e.indexOf(l.Color)==-1){e.push(l.Color)}});e.sort(function(k,l){if(k>l){return 1}else{return -1}});a.divContadoresOrdenes.empty();$('<label style="width:75px;" class="text-center">Total: '+a.data.ordenes.length+"</label>").appendTo(a.divContadoresOrdenes);e.forEach(function(m,l){var k=$.grep(a.data.ordenes,function(q,p){return q.Color==m});var n=$('<label class="text-center lblColorContador" color="'+m+'" activo="'+((a.coloresActivos[m]==false)?"false":"true")+'" style="color: #2d2d2d !important; border-radius:4px; margin-right:3px; width:75px; border: 4px solid '+(m?m:"transparent")+"; background-color:"+((a.coloresActivos[m]==false)?"#c4c4c4":m)+';">'+k.length+"</label>").appendTo(a.divContadoresOrdenes);if(a.coloresActivos[m]==null){a.coloresActivos[m]=true}n.on("click",function(){a.setColor(n)})});a.refreshGrid()};d.request()};a.setEstado=function(c){if(c.attr("activo")=="true"){c.css("background-color","transparent");c.attr("activo","false");a.estadosActivos[c.attr("estado")]=false}else{c.css("background-color","lightblue");c.attr("activo","true");a.estadosActivos[c.attr("estado")]=true}a.refreshGrid()};a.setColor=function(c){if(c.attr("activo")=="true"){c.css("background-color","#c4c4c4");c.attr("activo","false");a.coloresActivos[c.attr("color")]=false}else{c.css("background-color",c.attr("color"));c.attr("activo","true");a.coloresActivos[c.attr("color")]=true}a.refreshGrid()};a.refreshGrid=function(){var j=a.window.scrollTop();var d=$.grep(a.data.ordenes,function(l,k){return true});var h=$(".lblEstadoContador");for(var e=0;e<h.length;e++){var g=$(h[e]);if(g.attr("activo")=="false"){d=$.grep(d,function(l,k){return l.Estado!=g.attr("estado")})}}var c=$(".lblColorContador");for(var e=0;e<c.length;e++){var g=$(c[e]);if(g.attr("activo")=="false"){d=$.grep(d,function(l,k){return l.Color!=g.attr("color")})}}var f=a.divOrdenes.swidget().initialOptions;f.dataSource.data=d;f.exportOptions.excel.dataSource.data=a.data;f.exportOptions.excel.dataSource.schema={data:"ordenes"};f.exportOptions.excel.readDataSource=true;a.divOrdenes.swidget().refresh(f);a.txtFilter.keydown();a.loaded=true;a.window.scrollTop(j)}};Core.Business.PagoProveedores=new function(){var a=this;a.id="homePagoProveedores";a.divFacturas=null;a.facturas=[];a.divDescripcionEstados=null;a.lblTitle=null;a.txtDateFrom=null;a.txtDateTo=null;a.btnRefresh=null;a.txtFilter=null;a.btnPagarFacturas=null;a.pageOptions=null;a.timeout=null;a.init=function(b,c){Core.loadPage("backoffice-pago-proveedores.html",function(){document.title="Pago Proveedores";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divFacturas=$(".div-facturas");a.divDescripcionEstados=$(".div-descripcion-estados");a.facturas=[];a.lblTitle=$(".label-title");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.btnRefresh=$(".btn-refresh");a.txtFilter=$(".textbox-filter");a.btnPagarFacturas=$(".btn-pagar-facturas");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.PagoProveedores")})};a.initControls=function(){a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loadGrid()}}});var b=[];b.push({width:"6%",field:"Fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"9%",field:"NumEgreso",title:"Número Egreso",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({width:"15%",field:"Proveedor",title:"Proveedor",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"9%",field:"Neto",title:"Neto",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithDecimals});b.push({width:"9%",field:"retenciones",title:"Retenciones",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithDecimals});b.push({width:"9%",field:"retencionManual",title:"Retención Manual",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithDecimals});b.push({width:"9%",field:"ImporteGanancias",title:"Importe Ganancias",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithDecimals});b.push({width:"9%",field:"Total",title:"Total",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithDecimals});b.push({width:"25%",field:"numFacturas",title:"Número Facturas",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({title:" ",field:"",width:40,filterable:false,headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,e,d){if(e.color){c.parent().css("background-color","rgba("+Core.Functions.grid.hexToRgb(e.color)+((d%2==0)?", 0.6":", 1 ")+")")}if(e.chk){$(e.chk).appendTo(c)}}});a.divFacturas.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:b});a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var c=a.divFacturas.swidget().dataSource;if(value){c.filter={or:[{path:"Proveedor",filter:"contains",value:value},{path:"NumEgreso",filter:"contains",value:value}]}}else{c.filter=null}c.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.PagoProveedores.txtFilter");a.btnRefresh.on("click",function(){a.loadGrid()});a.btnPagarFacturas.on("click",function(){var d=[];a.facturas.forEach(function(g,f){if(g.chk&&g.chk[0].checked){d.push(g)}});if(d.length==0){new Core.Controls.Dialog("Aviso","Debe seleccionar al menos una factura a pagar.",{displayButtons:{close:true,accept:false}}).show();return}var e={facturas:[]};var c="";d.forEach(function(g,f){c+=((c==""?"":", ")+Core.Functions.grid.formatUndefinedString(g.Proveedor)+" "+Core.Functions.grid.formatNumberWithDecimals(g.Total));e.facturas.push(g.CodTesoreriaMov)});new Core.Controls.Confirmation("Confirmación","Se van a pagar las siguentes facturas: "+c,{onAccepted:function(){var f=new Core.Ajax.ServerRequest({overlayElement:a.btnPagarFacturas,secureRequest:true,requestUrl:"pagoProveedores/pagarFacturas",requestType:"POST",requestData:e});f.onSuccess=function(){a.loadGrid()};f.onError=function(h){var g=(h.responseJSON&&h.responseJSON.Descripcion)?h.responseJSON.Descripcion:"Fallo al realizar precarga";if(h.responseJSON&&h.responseJSON.RespuestaError){g+="<table class='table table-striped'>";g+="<thead><tr><th>N°  Egreso</th><th>Mensaje</th><th>Campo</th></tr></thead>";g+="<tbody>";h.responseJSON.RespuestaError.forEach(function(j,i){g+="<tr>";g+="<td>"+j.NumEgreso+"</td>";g+="<td>"+j.Mensaje+"</td>";g+="<td>"+j.Campo+"</td>";g+="</tr>"});g+="</tbody>";g+="</table>"}new Core.Controls.Dialog("Aviso",g,{displayButtons:{close:true,accept:false}}).show()};f.request()}}).show()})};a.loadGrid=function(){var b=new Core.Ajax.ServerRequest({overlayElement:a.divFacturas.parent(),secureRequest:true,requestUrl:"pagoProveedores/listarFacturas/"+Core.Functions.Date.getDisplayDateWithSeparator(a.txtDateFrom.swidget().value(),"-")+"/"+Core.Functions.Date.getDisplayDateWithSeparator(a.txtDateTo.swidget().value(),"-"),requestType:"GET"});b.onSuccess=function(c){a.facturas=c.facturas?c.facturas:[];var d=[];a.facturas.forEach(function(g,f){if(g.estado=="A pagar"){g.chk=$('<input type="checkbox" />')}if(g.color&&g.estado&&$.grep(d,function(h,j){return h.estado==g.estado&&h.color==g.color}).length==0){d.push({estado:g.estado,color:g.color})}});a.divDescripcionEstados.empty();d.forEach(function(f,g){$('<label style="margin-right:10px; padding:5px;'+(f.color?("background:rgb("+Core.Functions.grid.hexToRgb(f.color)+");"):"")+'">'+f.estado+"</label>").appendTo(a.divDescripcionEstados)});a.lblTitle.text("Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var e=a.divFacturas.swidget().initialOptions;e.dataSource.data=a.facturas;a.divFacturas.swidget().refresh(e);a.txtFilter.keydown()};b.request()}};Core.Business.ProcesarArchivos=new function(){var a=this;a.id="homeProcesarArchivos";a.idDefaultAccount=null;a.idDefaultProfile=null;a.btnBolsa=null;a.btnFondos=null;a.btnConfirmarArchivos=null;a.inputFiles=null;a.requestUrl=null;a.pageOptions=null;a.window=$(window);a.init=function(b,c){Core.loadPage("backoffice-procesar-archivos.html",function(){document.title="Procesar Archivos";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.idDefaultAccount=b;a.idDefaultProfile=c;a.btnBolsa=$(".btn-bolsa");a.btnFondos=$(".btn-fondos");a.btnConfirmarArchivos=$(".btn-confirmar-archivos");a.inputFiles=$(".input-upload-file");a.initControls();a.btnBolsa.click();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){},"Core.Business.ProcesarArchivos")})};a.initControls=function(){a.btnBolsa.on("click",function(){a.requestUrl="/backoffice/api/v1/upload/csv/procesarArchivoSiter";a.inputFiles.val("")});a.btnFondos.on("click",function(){a.requestUrl="/backoffice/api/v1/upload/csv/procesarArchivoSiterFondos";a.inputFiles.val("")});a.btnConfirmarArchivos.on("click",function(){if(a.inputFiles[0].files.length!=1){new Core.Controls.Dialog("Aviso","<p>Debe seleccionar un único archivo.</p>",{displayButtons:{close:true,accept:false}}).show();return}for(var h=0,d;d=a.inputFiles[0].files[h];h++){var e=d.name.split(".");var c=e[e.length-1];if(c!="txt"){new Core.Controls.Dialog("Aviso","<p>El archivo seleccionado deben ser: txt.</p>",{displayButtons:{close:true,accept:false}}).show();return}}var g={Authorization:Core.Objects.Context.Token,Accept:"application/json"};var b=new FormData();for(var h=0,d;d=a.inputFiles[0].files[h];h++){b.append("file-"+h,d)}var j=new Core.Controls.Overlay(a.btnConfirmarArchivos,{});$.ajax({type:"POST",url:Core.Origin+a.requestUrl,data:b,cache:false,contentType:false,processData:false,method:"POST",headers:g,success:function(f){function k(r){var q=new Blob([r.response],{type:r.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(q);return}var l=window.URL.createObjectURL(q);var p=document.createElement("a");p.href=l;var n=r.getResponseHeader("Content-Disposition").split("; ");var m="filename=file.txt";for(var o=0;o<n.length;o++){if(n[o].indexOf("filename")>=0){m=n[o]}}p.download=m.split("=")[1];p.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(l)}if(f.nombreArchivo){var i=new XMLHttpRequest();i.open("GET",Core.Origin+"/backoffice/api/v1/download/procesarArchivoSiter/descargar/"+f.nombreArchivo,true);i.responseType="blob";i.setRequestHeader("Authorization",Core.Objects.Context.Token);i.onload=function(l){if(i.status==200){k(i)}else{var m=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga del comprobante.</p>",{displayButtons:{close:true,accept:false}});m.show()}a.inputFiles.val("");j.destroy()};i.send()}else{a.inputFiles.val("");j.destroy()}},error:function(i){var l=JSON.parse(i.responseText);var m=(l&&l.descripcion)?"Mensaje":"Error de conexión";var f=(l&&l.descripcion)?l.descripcion:"Algunos componentes de la página no se cargaron correctamente. Por favor intente mas tarde...";var k=new Core.Controls.Dialog(m,"<p>"+f+"</p>",{displayButtons:{close:true,accept:false}});k.show();j.destroy()}})})}};Core.Business.ReporteEmta=new function(){var a=this;a.id="reporteEmta";a.idDefaultAccount=null;a.idDefaultProfile=null;a.txtDateFrom=null;a.txtDateTo=null;a.txtListadoIsin=null;a.liEmtaTotales=null;a.btnEmtaTotales=null;a.lblTitleEmtaTotales=null;a.divEmtaTotales=null;a.liEmtaDetalles=null;a.btnEmtaDetalles=null;a.lblTitleEmtaDetalles=null;a.divEmtaDetalles=null;a.pageOptions=null;a.window=$(window);a.init=function(b,c){Core.loadPage("backoffice-reporte-emta.html",function(){document.title="Reporte EMTA";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.idDefaultAccount=b;a.idDefaultProfile=c;a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.txtListadoIsin=$(".text-listado-isin");a.initControls();a.liEmtaTotales=$(".li-emta-totales");a.btnEmtaTotales=$(".btn-emta-totales");a.btnEmtaTotales.on("click",function(){a.loadGridEmtaTotales()});a.lblTitleEmtaTotales=$(".label-title-emta-totales");a.divEmtaTotales=$(".div-emta-totales");a.initControlsEmtaTotales();a.liEmtaDetalles=$(".li-emta-detalles");a.btnEmtaDetalles=$(".btn-emta-detalles");a.btnEmtaDetalles.on("click",function(){a.loadGridEmtaDetalles()});a.lblTitleEmtaDetalles=$(".label-title-emta-detalles");a.divEmtaDetalles=$(".div-emta-detalles");a.initControlsEmtaDetalles();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.btnEmtaTotales.click()},"Core.Business.ReporteEmta")})};a.initControls=function(){a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(b){if(a.liEmtaTotales.hasClass("active")){a.btnEmtaTotales.click()}else{a.btnEmtaDetalles.click()}}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(b){if(a.liEmtaTotales.hasClass("active")){a.btnEmtaTotales.click()}else{a.btnEmtaDetalles.click()}}}});a.txtListadoIsin.shieldTextBox({value:"",events:{change:function(){if(a.liEmtaTotales.hasClass("active")){a.btnEmtaTotales.click()}else{a.btnEmtaDetalles.click()}}}})};a.initControlsEmtaTotales=function(){var b=[];b.push({field:"Isin",title:"Isin",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Ticker",title:"Ticker",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"TipoBoleto",title:"TipoBoleto",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"TotalUSD",title:"Total USD",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatPrice});a.divEmtaTotales.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar Excel"}]}],columns:b,paging:{pageSize:100,pageLinksCount:10},exportOptions:{excel:{fileName:"EMTA Totales",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["Isin","Ticker","TipoBoleto","TotalUSD"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"EMTA Totales"}}}})};a.loadGridEmtaTotales=function(){if(a.txtListadoIsin.swidget().value().indexOf(".")>=0||a.txtListadoIsin.swidget().value().indexOf(";")>=0||a.txtListadoIsin.swidget().value().indexOf(",")>=0){new Core.Controls.Dialog("Aviso","El Listado de Isin posee caracteres inválidos. ('.', ',' y ';')",{displayButtons:{close:true,accept:false}}).show();return}a.lblTitleEmtaTotales.text("Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var b;b="fechaIni="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));b+="&fechaFin="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));b+="&listIsin="+a.txtListadoIsin.swidget().value().replaceAll("\n","|");var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"reporte/emta",requestType:"GET",requestData:b});c.onSuccess=function(d){var e=a.divEmtaTotales.swidget().initialOptions;e.dataSource.data=d.datos;e.exportOptions.excel.dataSource.data=d.datos;e.exportOptions.excel.readDataSource=true;a.divEmtaTotales.swidget().refresh(e)};c.request()};a.initControlsEmtaDetalles=function(){var b=[];b.push({field:"Isin",title:"Isin",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Ticker",title:"Ticker",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"TipoBoleto",title:"Tipo Boleto",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"FechaConcertacion",title:"Fecha Concertación",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatStringDate});b.push({field:"NumBoleto",title:"Número Boleto",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({field:"MonedaOperada",title:"Moneda Operada",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"ImporteBrutoVB",title:"Importe Bruto VB",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatPrice});b.push({field:"ImporteBrutoUSD",title:"Importe Bruto USD",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatPrice});a.divEmtaDetalles.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar Excel"}]}],columns:b,paging:{pageSize:100,pageLinksCount:10},exportOptions:{excel:{fileName:"EMTA Detalles",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["Isin","Ticker","TipoBoleto","FechaConcertacion","NumBoleto","MonedaOperada","ImporteBrutoVB","ImporteBrutoUSD"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"EMTA Detalles"}}}})};a.loadGridEmtaDetalles=function(){if(a.txtListadoIsin.swidget().value().indexOf(".")>=0||a.txtListadoIsin.swidget().value().indexOf(";")>=0||a.txtListadoIsin.swidget().value().indexOf(",")>=0){new Core.Controls.Dialog("Aviso","El Listado de Isin posee caracteres inválidos. ('.', ',' y ';')",{displayButtons:{close:true,accept:false}}).show();return}a.lblTitleEmtaDetalles.text("Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var b;b="fechaIni="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));b+="&fechaFin="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));b+="&listIsin="+a.txtListadoIsin.swidget().value().replaceAll("\n","|");var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"reporte/emta/detalle",requestType:"GET",requestData:b});c.onSuccess=function(d){var e=a.divEmtaDetalles.swidget().initialOptions;e.dataSource.data=d.datos;e.exportOptions.excel.dataSource.data=d.datos;e.exportOptions.excel.readDataSource=true;a.divEmtaDetalles.swidget().refresh(e)};c.request()}};Core.Business.ReporteInconsistenciasCuentasESCO=new function(){var a=this;a.id="reporteInconsistenciasCuentasESCO";a.gridCuentas=null;a.txtFilter=null;a.chkDistinguirMayusculasMinusculas=null;a.chkIncluirCondominiosSinMail=null;a.chkOcultarDifereciasMails=null;a.btnRefresh=null;a.timeout=null;a.window=$(window);a.init=function(b,c){Core.loadPage("backoffice-reporte-inconsistencias-cuentas-esco.html",function(){a.idDefaultAccount=b;a.idDefaultProfile=c;document.title="Reporte Inconsistencias Cuentas ESCO";a.btnRefresh=$(".btn-refresh");a.txtFilter=$(".textbox-filter");a.gridCuentas=$(".div-cuentas");a.chkDistinguirMayusculasMinusculas=$(".checkbox-distinguir-mayusculas-minusculas");a.chkIncluirCondominiosSinMail=$(".checkbox-incluir-condominios-sin-mail");a.chkOcultarDifereciasMails=$(".checkbox-ocultar-direfencias-mails");a.initGrid();a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadGrid()},"Core.Business.ReporteInconsistenciasCuentasESCO")})};a.initControls=function(){a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var b=a.gridCuentas.swidget().dataSource;if(value){b.filter={or:[{path:"idCuenta",filter:"contains",value:value},{path:"Descripcion",filter:"contains",value:value},{path:"CUITPlataforma",filter:"contains",value:value},{path:"NumComitente",filter:"contains",value:value},{path:"CodInterfazBolsa",filter:"contains",value:value},{path:"CUITBolsa",filter:"contains",value:value},{path:"NumCuotapartista",filter:"contains",value:value},{path:"CodInterfazFondos",filter:"contains",value:value},{path:"CUITFondos",filter:"contains",value:value}]}}else{b.filter=null}b.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.ReporteInconsistenciasCuentasESCO.txtFilter");a.btnRefresh.click(function(){a.loadGrid()});a.chkDistinguirMayusculasMinusculas.on("change",function(){a.loadGrid()});a.chkDistinguirMayusculasMinusculas[0].checked=false;a.chkIncluirCondominiosSinMail.on("change",function(){a.loadGrid()});a.chkIncluirCondominiosSinMail[0].checked=false;a.chkOcultarDifereciasMails.on("change",function(){a.loadGrid()});a.chkOcultarDifereciasMails[0].checked=false};a.initGrid=function(){var b=[];b.push({width:"6%",field:"idCuenta",title:"Id Cuenta",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,e,d){c.html(e.idCuenta);c.css("text-align","right");c.css("padding-right","5px")}});b.push({width:"20%",field:"Descripcion",title:"Descripción",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,e,d){c.html(e.Descripcion);c.css("text-align","left");c.css("padding-right","5px")}});b.push({width:"10%",field:"CUITPlataforma",title:"CUIT P",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,e,d){c.html(e.CUITPlataforma);c.css("text-align","center");c.css("padding-right","5px");if(e.ColorCUITPlataforma){c.css("background-color","rgba("+a.hexToRgb(e.ColorCUITPlataforma)+((d%2==0)?", 0.6":", 1 ")+")")}}});b.push({width:"8%",field:"NumComitente",title:"Comitente",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,e,d){c.html(e.NumComitente);c.css("text-align","right");c.css("padding-right","5px")}});b.push({width:"10%",field:"CodInterfazBolsa",title:"Cód Interfaz B",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,e,d){c.html(e.CodInterfazBolsa);c.css("text-align","right");c.css("padding-right","5px");if(e.ColorCodInterfazBolsa){c.css("background-color","rgba("+a.hexToRgb(e.ColorCodInterfazBolsa)+((d%2==0)?", 0.6":", 1 ")+")")}}});b.push({width:"10%",field:"CUITBolsa",title:"CUIT B",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,e,d){c.html(e.CUITBolsa);c.css("text-align","center");c.css("padding-right","5px");if(e.ColorCUITBolsa){c.css("background-color","rgba("+a.hexToRgb(e.ColorCUITBolsa)+((d%2==0)?", 0.6":", 1 ")+")")}}});b.push({width:"5%",title:"Errores Mails B",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,e,f){if(e.ErrorMailsBolsa){var c=$('<button type="button" title="Errores Mails Bolsa" class="btn-sm balanz-button"><span class="glyphicon glyphicon-resize-full"></span></button>').appendTo(d);c.on("click",function(){var g=new Core.Ajax.ServerRequest({secureRequest:true,showOverlay:true,overlayElement:c,requestUrl:"reporte/mailscuentas",requestType:"GET",requestData:{idCuenta:e.idCuenta,idNegocio:1}});g.onSuccess=function(l){var h="No hay detalles para informar.";if(l.Condominios.length>0){h="<table class='table table-striped'>";h+="<thead><tr><th>Orden</th><th>Descripción</th><th>Tipo</th><th>EMail</th></tr></thead>";h+="<tbody>";for(var k=0;k<l.Condominios.length;k++){h+="<tr>";h+="<td>"+l.Condominios[k].Orden+"</td>";h+="<td>"+l.Condominios[k].Descripcion+"</td>";h+="<td>"+l.Condominios[k].Tipo+"</td>";h+="<td>"+l.Condominios[k].EMail+"</td>";h+="</tr>"}h+="</tbody>";h+="</table>"}h+=("<label>Mails Actual: "+l.Mails[0].EMailsCuenta+"</label><br/>");h+=("<label>Mails Condominios: "+l.Mails[0].EMailsCondominios+"</label>");var j=new Core.Controls.Dialog(l.Mails[0].Cuenta,h,{displayButtons:{close:true,accept:false}});j.show()};g.request()})}}});b.push({width:"8%",field:"NumCuotapartista",title:"Cuotapartista",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,e,d){c.html(e.NumCuotapartista);c.css("text-align","right");c.css("padding-right","5px")}});b.push({width:"10%",field:"CodInterfazFondos",title:"Cód Interfaz F",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,e,d){c.html(e.CodInterfazFondos);c.css("text-align","right");c.css("padding-right","5px");if(e.ColorCodInterfazFondos){c.css("background-color","rgba("+a.hexToRgb(e.ColorCodInterfazFondos)+((d%2==0)?", 0.6":", 1 ")+")")}}});b.push({width:"10%",field:"CUITFondos",title:"CUIT F",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,e,d){c.html(e.CUITFondos);c.css("text-align","center");c.css("padding-right","5px");if(e.ColorCUITFondos){c.css("background-color","rgba("+a.hexToRgb(e.ColorCUITFondos)+((d%2==0)?", 0.6":", 1 ")+")")}}});b.push({width:"5%",title:"Errores Mails F",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,e,f){if(e.ErrorMailsFondos){var c=$('<button type="button" title="Errores Mails Fondos" class="btn-sm balanz-button"><span class="glyphicon glyphicon-resize-full"></span></button>').appendTo(d);c.on("click",function(){var g=new Core.Ajax.ServerRequest({secureRequest:true,showOverlay:true,overlayElement:c,requestUrl:"reporte/mailscuentas",requestType:"GET",requestData:{idCuenta:e.idCuenta,idNegocio:2}});g.onSuccess=function(l){var h="No hay detalles para informar.";if(l.Condominios.length>0){h="<table class='table table-striped'>";h+="<thead><tr><th>Orden</th><th>Descripción</th><th>Tipo</th><th>EMail</th></tr></thead>";h+="<tbody>";for(var k=0;k<l.Condominios.length;k++){h+="<tr>";h+="<td>"+l.Condominios[k].Orden+"</td>";h+="<td>"+l.Condominios[k].Descripcion+"</td>";h+="<td>"+l.Condominios[k].Tipo+"</td>";h+="<td>"+l.Condominios[k].EMail+"</td>";h+="</tr>"}h+="</tbody>";h+="</table>"}h+=("<label>Mails Actual: "+l.Mails[0].EMailsCuenta+"</label><br/>");h+=("<label>Mails Condominios: "+l.Mails[0].EMailsCondominios+"</label>");var j=new Core.Controls.Dialog(l.Mails[0].Cuenta,h,{displayButtons:{close:true,accept:false}});j.show()};g.request()})}}});a.gridCuentas.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Inconsistencias Cuentas ESCO",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["idCuenta","Descripcion","CUITPlataforma","NumComitente","CodInterfazBolsa","CUITBolsa","NumCuotapartista","CodInterfazFondos","CUITFondos"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Inconsistencias Cuentas ESCO"}}},paging:{pageSize:100,pageLinksCount:10},noRecordsText:"No hay información de Cuentas",columns:b})};a.loadGrid=function(){var b="";b+="DistinguirCase="+((a.chkDistinguirMayusculasMinusculas[0].checked)?"1":"0");b+="&IncluirCondominiosSinMail="+((a.chkIncluirCondominiosSinMail[0].checked)?"1":"0");b+="&OcultarDiferenciasMails="+((a.chkOcultarDifereciasMails[0].checked)?"1":"0");var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"reporte/inconsistenciascuentasesco",requestType:"GET",requestData:b});c.onSuccess=function(e){var d=a.gridCuentas.swidget().initialOptions;d.dataSource.data=e.Cuentas;d.dataSource.sort=a.gridCuentas.swidget().dataSource.sort;d.dataSource.group=a.gridCuentas.swidget().dataSource.group;d.exportOptions.excel.dataSource.data=e.Cuentas;d.exportOptions.excel.readDataSource=true;a.gridCuentas.swidget().refresh(d);a.txtFilter.keydown()};c.request()};a.hexToRgb=function(d){d=d.replace("#","");var f=parseInt(d.substring(0,2),16);var e=parseInt(d.substring(2,4),16);var c=parseInt(d.substring(4,6),16);var h=f+","+e+","+c;return h}};Core.Business.ReporteLicitaciones=new function(){var a=this;var b=60000;a.id="reporteLicitaciones";a.ddlLicitacion=null;a.pageOptions=null;a.txtFilterDetalles=null;a.timeoutDetalles=null;a.divGrillaBackofficeReporteLicitacionesTotalPesos=null;a.divGrillaBackofficeReporteLicitacionesTotalDolares=null;a.divGrillaBackofficeReporteLicitacionesDetalles=null;a.divGrillaBackofficeReporteLicitacionesVencimientos=null;a.divContainerGrillaBackofficeReporteLicitacionesTotalPesos=null;a.divContainerGrillaBackofficeReporteLicitacionesTotalDolares=null;a.divContainerGrillaBackofficeReporteLicitacionesDetalles=null;a.divEstadosDetalles=null;a.divColocacionesDetalles=null;a.dataDetalles=null;a.divContainerGrillaBackofficeReporteLicitacionesVencimientos=null;a.btnRefresh=null;a.loaded=false;a.window=$(window);a.init=function(c,d){Core.loadPage("backoffice-reporte-licitaciones.html",function(){a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[d]);document.title="Backoffice Reporte Licitaciones";a.btnRefresh=$(".btn-refresh");a.ddlLicitacion=$(".dropdown-licitacion");a.txtFilterDetalles=$(".textbox-filter-detalles");a.divContainerGrillaBackofficeReporteLicitacionesTotalPesos=$(".div-container-backoffice-reporte-licitaciones-total-pesos");a.divContainerGrillaBackofficeReporteLicitacionesTotalDolares=$(".div-container-backoffice-reporte-licitaciones-total-dolares");a.divContainerGrillaBackofficeReporteLicitacionesVencimientos=$(".div-container-backoffice-reporte-licitaciones-vencimientos");a.divContainerGrillaBackofficeReporteLicitacionesDetalles=$(".div-container-backoffice-reporte-licitaciones-detalles");a.divGrillaBackofficeReporteLicitacionesTotalPesos=$(".div-backoffice-reporte-licitaciones-total-pesos");a.divGrillaBackofficeReporteLicitacionesTotalDolares=$(".div-backoffice-reporte-licitaciones-total-dolares");a.divGrillaBackofficeReporteLicitacionesDetalles=$(".div-backoffice-reporte-licitaciones-detalles");a.divEstadosDetalles=$(".div-estados-detalles");a.divColocacionesDetalles=$(".div-colocaciones-detalles");a.divGrillaBackofficeReporteLicitacionesVencimientos=$(".div-backoffice-reporte-licitaciones-vencimientos");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,c,d,function(){a.loaded=false;a.loadControls()},"Core.Business.ReporteLicitaciones")})};a.initControls=function(){a.ddlLicitacion.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{idLicitacion}",events:{select:function(f){a.loadGrids()}}});a.btnRefresh.click(function(){a.loadGrids()});var d=[];d.push({footerTemplate:"<div style='text-align: left;'>Total</div>",field:"Colocacion",width:"10%",title:"Colocación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});d.push({footerTemplate:"<div style='text-align: left;'></div>",field:"Descripcion",width:"30%",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});d.push({footerTemplate:"<div style='text-align: left;'></div>",field:"Moneda",width:"10%",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});d.push({footerTemplate:"<div style='text-align: right;'>Total: $ {sum:n2}</div>",field:"MontoALicitar",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"15%",title:"Monto a Licitar",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatNumber});d.push({footerTemplate:"<div style='text-align: right;'>Total: $ {sum:n2}</div>",field:"Renovacion",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"15%",title:"Renovación",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatNumber});d.push({footerTemplate:"<div style='text-align: right;'>Total: $ {sum:n2}</div>",field:"MontoAgregado",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"15%",title:"Monto Agregado",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatNumber});d.push({footerTemplate:"<div style='text-align: left;'></div>",width:"5%",title:" ",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),columnTemplate:function(f,g,h){if(a.ddlLicitacion.swidget().selectedItem()!=null&&g.Colocacion!=null){f.html('<button type="button" title="Descargar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');f.addClass("link-cell");f.on("click",function(){function j(q){var p=new Blob([q.response],{type:q.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(p);return}var k=window.URL.createObjectURL(p);var o=document.createElement("a");o.href=k;var m=q.getResponseHeader("Content-Disposition").split("; ");var l="filename=file.txt";for(var n=0;n<m.length;n++){if(m[n].indexOf("filename")>=0){l=m[n]}}o.download=l.split("=")[1];o.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(k)}var i=new XMLHttpRequest();i.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"licitacion/archivo/"+a.ddlLicitacion.swidget().selectedItem().idLicitacion+"/"+g.Colocacion,true);i.responseType="blob";i.setRequestHeader("Authorization",Core.Objects.Context.Token);i.onload=function(k){if(i.status==200){j(i)}else{var l=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga del archivo.</p>",{displayButtons:{close:true,accept:false}});l.show()}};i.send()})}}});a.divGrillaBackofficeReporteLicitacionesTotalPesos.shieldGrid({dataSource:{data:[],aggregate:[{field:"MontoALicitar",aggregate:"sum"},{field:"Renovacion",aggregate:"sum"},{field:"MontoAgregado",aggregate:"sum"}]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Licitaciones Totales Pesos",columnFields:["Colocacion","Descripcion","Moneda","MontoALicitar","Renovacion","MontoAgregado"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Licitaciones Totales Pesos"}}},selection:false,rowHover:false,sorting:{multiple:true},columns:d});a.divGrillaBackofficeReporteLicitacionesTotalDolares.shieldGrid({dataSource:{data:[],aggregate:[{field:"MontoALicitar",aggregate:"sum"},{field:"Renovacion",aggregate:"sum"},{field:"MontoAgregado",aggregate:"sum"}]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Licitaciones Totales Dólares",columnFields:["Colocacion","Descripcion","Moneda","MontoALicitar","Renovacion","MontoAgregado"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Licitaciones Totales Dólares"}}},selection:false,rowHover:false,sorting:{multiple:true},columns:d});var c=[];c.push({field:"idOrden",width:"8%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),title:"idOrden",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"Descripcion",width:"36%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),title:"Descripcion",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"Comitente",width:"8%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),title:"Comitente",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"Colocacion",width:"8%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),title:"Colocación",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"Ticker",width:"8%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),title:"Ticker",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"Monto",width:"8%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),title:"Monto",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatNuleableNumber});c.push({field:"MontoRenovacion",width:"8%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),title:"Monto Renovación",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatNuleableNumber});c.push({field:"Moneda",width:"8%",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"TipoNegociacion",width:"8%",title:"Tipo Negociación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"Precio",width:"8%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),title:"Precio",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatPrice});c.push({field:"Tasa",width:"8%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),title:"Tasa",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"Nominales",width:"8%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),title:"Nominales",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatNuleableIntegerNumber});c.push({title:"Obs.",width:40,headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),columnTemplate:function(f,g,h){if(g.Observaciones){var i=(g.length>140)?(g.Observaciones.substr(0,140)+"..."):(g.Observaciones);f.html('<button type="button" title="'+i+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');f.addClass("link-cell");f.on("click",function(){var j=new Core.Controls.Dialog("Observaciones",(g.Observaciones)?g.Observaciones:"",{displayButtons:{close:true,accept:false}});j.show()})}}});c.push({field:"Asesor",width:"8%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),title:"Asesor",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({field:"Estado",width:"8%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),title:"Estado",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({title:" ",width:40,headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),columnTemplate:function(g,h,i){if(h.Cancelable){var f=$('<button type="button" title="Cancelar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(g);f.on("click",function(){new Core.Business.ReporteLicitaciones.CancelarOrden({orden:h,onSave:function(){a.loadGrids()}}).show()})}}});a.divGrillaBackofficeReporteLicitacionesDetalles.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:c,paging:{pageSize:100,pageLinksCount:10},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Licitaciones Detalles",columnFields:["idOrden","Descripcion","Comitente","Colocacion","Ticker","Monto","MontoRenovacion","Moneda","TipoNegociacion","Precio","Tasa","Nominales","Asesor","Estado","Equipo","UnidadDeNegocio","Solicitante","CUIT_CUIL"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Licitaciones Detalles"}}}});var e=[];e.push({footerTemplate:"<div style='text-align: left;'>Total</div>",field:"Ticker",width:"22%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),title:"Ticker",headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length)});e.push({footerTemplate:"<div style='text-align: left;'></div>",field:"Descripcion",width:"34%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),title:"Descripcion",headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length)});e.push({footerTemplate:"<div style='text-align: right;'>Total: {sum:n2}</div>",field:"Cantidad",width:"22%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),title:"Cantidad",headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatNuleableIntegerNumber});e.push({footerTemplate:"<div style='text-align: right;'>Total: $ {sum:n2}</div>",field:"Monto",width:"22%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),title:"Monto",headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatNuleableNumber});a.divGrillaBackofficeReporteLicitacionesVencimientos.shieldGrid({dataSource:{data:[],aggregate:[{field:"Cantidad",aggregate:"sum"},{field:"Monto",aggregate:"sum"}]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Licitaciones Vencimientos",columnFields:["Ticker","Descripcion","Cantidad","Monto"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Licitaciones Vencimientos"}}},selection:false,rowHover:false,sorting:{multiple:true},columns:e});a.txtFilterDetalles.on("keydown",function(){clearTimeout(a.timeoutDetalles);a.timeoutDetalles=setTimeout(function(){value=a.txtFilterDetalles.val();var f=a.divGrillaBackofficeReporteLicitacionesDetalles.swidget().dataSource;if(value){f.filter={or:[{path:"idOrden",filter:"contains",value:value},{path:"Descripcion",filter:"contains",value:value},{path:"Comitente",filter:"contains",value:value},{path:"Ticker",filter:"contains",value:value},{path:"Asesor",filter:"contains",value:value}]}}else{f.filter=null}f.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilterDetalles,"Core.Business.ReporteLicitaciones.txtFilterDetalles")};a.loadControls=function(){var c=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"licitacion/listado",requestType:"GET"});c.onSuccess=function(d){var e=a.ddlLicitacion.swidget().initialOptions;e.dataSource.data=d.licitaciones;a.ddlLicitacion.swidget().refresh(e);a.loadGrids();a.loaded=true};c.request()};a.loadGrids=function(){if(a.ddlLicitacion.swidget().selectedItem()!=null){var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"licitacion/reporte/"+a.ddlLicitacion.swidget().selectedItem().idLicitacion,requestType:"GET"});c.onSuccess=function(e){a.divContainerGrillaBackofficeReporteLicitacionesDetalles.show();a.dataDetalles=e.detalles;var h=["Pendiente","En Ejecución","Cancelada"];a.divEstadosDetalles.html("");$("<label>Estados: </label>").appendTo(a.divEstadosDetalles);var d=[];a.divColocacionesDetalles.html("");$("<label>Colocaciones: </label>").appendTo(a.divColocacionesDetalles);$.each(a.dataDetalles,function(m,n){if(h.indexOf(n.Estado)<0){h.push(n.Estado)}if(d.indexOf(n.Colocacion)<0){d.push(n.Colocacion)}});$.each(h,function(n,p){var m=$.grep(a.dataDetalles,function(r,q){return r.Estado==p}).length;var o=$("<label class='lblEstadoContador' style='background-color: lightblue; margin: 8px 6px 8px 0; padding: 4px 5px; border: 1px solid #ccc;  font-weight: normal;' activo='true' estado='"+p+"'>"+p+": <strong style='color: #333;'>"+m+"</strong></label>").appendTo(a.divEstadosDetalles);o.on("click",function(){a.setFilter(o)})});$.each(d,function(n,p){var m=$.grep(a.dataDetalles,function(r,q){return r.Colocacion==p}).length;var o=$("<label class='lblColocacionContador' style='background-color: lightblue; margin: 8px 6px 8px 0; padding: 4px 5px; border: 1px solid #ccc;  font-weight: normal;' activo='true' colocacion='"+p+"'>"+p+": <strong style='color: #333;'>"+m+"</strong></label>").appendTo(a.divColocacionesDetalles);o.on("click",function(){a.setFilter(o)})});a.refreshGridDetalles();var l=a.window.scrollTop();var g=$.grep(e.totales,function(n,m){return n.Moneda=="Pesos"});if(g.length>0){a.divContainerGrillaBackofficeReporteLicitacionesTotalPesos.show();var j=a.divGrillaBackofficeReporteLicitacionesTotalPesos.swidget().initialOptions;j.exportOptions.excel.dataSource.data=g;j.exportOptions.excel.readDataSource=true;j.dataSource.data=g;a.divGrillaBackofficeReporteLicitacionesTotalPesos.swidget().refresh(j)}else{a.divContainerGrillaBackofficeReporteLicitacionesTotalPesos.hide()}var f=$.grep(e.totales,function(n,m){return n.Moneda=="Dólares"});if(f.length>0){a.divContainerGrillaBackofficeReporteLicitacionesTotalDolares.show();var i=a.divGrillaBackofficeReporteLicitacionesTotalDolares.swidget().initialOptions;i.exportOptions.excel.dataSource.data=f;i.exportOptions.excel.readDataSource=true;i.dataSource.data=f;a.divGrillaBackofficeReporteLicitacionesTotalDolares.swidget().refresh(i)}else{a.divContainerGrillaBackofficeReporteLicitacionesTotalDolares.hide()}if(e.vencimientos!=null&&e.vencimientos.length>0){a.divContainerGrillaBackofficeReporteLicitacionesVencimientos.show();var k=a.divGrillaBackofficeReporteLicitacionesVencimientos.swidget().initialOptions;k.dataSource.data=e.vencimientos;k.exportOptions.excel.dataSource.data=e.vencimientos;k.exportOptions.excel.readDataSource=true;a.divGrillaBackofficeReporteLicitacionesVencimientos.swidget().refresh(k)}else{a.divContainerGrillaBackofficeReporteLicitacionesVencimientos.hide()}a.window.scrollTop(l)};c.request()}else{a.divContainerGrillaBackofficeReporteLicitacionesDetalles.hide();a.divContainerGrillaBackofficeReporteLicitacionesTotalPesos.hide();a.divContainerGrillaBackofficeReporteLicitacionesTotalDolares.hide();a.divContainerGrillaBackofficeReporteLicitacionesVencimientos.hide()}};a.setFilter=function(c){if(c.attr("activo")=="true"){c.css("background-color","transparent");c.attr("activo","false")}else{c.css("background-color","lightblue");c.attr("activo","true")}a.refreshGridDetalles()};a.refreshGridDetalles=function(){var c=$.grep(a.dataDetalles,function(l,k){return true});var h=$(".lblEstadoContador");for(var d=0;d<h.length;d++){var f=$(h[d]);if(f.attr("activo")=="false"){c=$.grep(c,function(l,k){return l.Estado!=f.attr("estado")})}}var j=$(".lblColocacionContador");for(var d=0;d<j.length;d++){var g=$(j[d]);if(g.attr("activo")=="false"){c=$.grep(c,function(l,k){return l.Colocacion!=g.attr("colocacion")})}}var e=a.divGrillaBackofficeReporteLicitacionesDetalles.swidget().initialOptions;e.dataSource.data=c;e.exportOptions.excel.dataSource.data=c;e.exportOptions.excel.readDataSource=true;a.divGrillaBackofficeReporteLicitacionesDetalles.swidget().refresh(e);a.txtFilterDetalles.keydown()}};Core.Business.ReporteLicitaciones.CancelarOrden=function(b){var a=this;a.divModal=$(".div-cancelar-orden");a.orden=null;a.onSave=function(){};$.extend(true,a,b);a.show=function(){a.initControls();a.divModal.modal({show:true})};a.initControls=function(){a.lblOrden=a.divModal.find(".lbl-orden");a.lblOrden.text("¿Confirma la solicitud de cancelación de la Orden de ID: "+a.orden.idOrden+"?");a.txtCodigo4D=a.divModal.find(".textbox-codigo4d");a.txtCodigo4D.val("");a.btnConfirmar=a.divModal.find(".btn-confirmar");a.btnConfirmar.unbind("click");a.btnConfirmar.on("click",function(){var e={value:true};var c={};c.idCuenta=a.orden.idCuenta;c.idOrden=a.orden.idOrden;c.Codigo4D=Core.Functions.Validations.getValidatedInputValue(a.txtCodigo4D,e);if(!e.value){return}var d=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.btnConfirmar,secureRequest:true,requestUrl:"operar/cancelar",requestType:"POST",requestData:c});d.onSuccess=function(f){a.onSave();a.divModal.modal("hide")};d.request()})}};Core.Business.ReporteMAELiquidacion=new function(){var a=this;a.id="eeporteMAELiquidacion";a.txtDate=null;a.gridBonos=null;a.gridMonedas=null;a.btnRefresh=null;a.timeoutBonos=null;a.window=$(window);a.init=function(b,c){Core.loadPage("backoffice-reporte-liquidacion-mae.html",function(){a.idDefaultAccount=b;a.idDefaultProfile=c;document.title="Liquidación MAE";a.btnRefresh=$(".btn-refresh");a.txtDate=$(".date-picker");a.gridBonos=$(".div-bonos");a.gridMonedas=$(".div-monedas");a.txtFilterBonos=$(".textbox-filter-bonos");a.lblTitleBonos=$(".label-title-bonos");a.lblTitleMonedas=$(".label-title-monedas");a.initGrids();a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadGrids()},"Core.Business.ReporteMAELiquidacion")})};a.initControls=function(){a.txtDate.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),events:{change:function(b){a.loadGrids()}}});a.btnRefresh.click(function(){a.loadGrids()});a.txtFilterBonos.on("keydown",function(){clearTimeout(a.timeoutBonos);a.timeoutBonos=setTimeout(function(){value=a.txtFilterBonos.val();var b=a.gridBonos.swidget().dataSource;if(value){b.filter={or:[{path:"CodigoEspecie",filter:"contains",value:value},{path:"Especie",filter:"contains",value:value}]}}else{b.filter=null}b.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilterBonos,"Core.Business.ReporteMAELiquidacion.txtFilterBonos")};a.initGrids=function(){var c=[];c.push({field:"Moneda",title:"Moneda",width:"10%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"MAEClearBilateral",title:"MAE Clear Bilateral",width:"30%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatPriceWithColor});c.push({field:"MAEClearGarantizado",title:"MAE Clear Garantizado",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"30%",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatPriceWithColor});c.push({field:"Total",attributes:Core.Functions.grid.getRightAlignedColumnClass(),title:"Total",width:"30%",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatPriceWithColor});a.gridMonedas.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,noRecordsText:"No hay información de Monedas",columns:c,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Liquidación MAE - Monedas",columnFields:["Moneda","MAEClearBilateral","MAEClearGarantizado","Total"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Liquidación MAE - Monedas"}}}});var b=[];b.push({field:"CodigoEspecie",title:"Código Especie",width:"10%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatIntegerNumberWithColor});b.push({field:"Especie",title:"Especie",width:"15%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"MAEClearBilateral",title:"MAE Clear Bilateral",width:"25%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatIntegerNumberWithColor});b.push({field:"MAEClearGarantizado",title:"MAE Clear Garantizado",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"25%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatIntegerNumberWithColor});b.push({field:"Total",attributes:Core.Functions.grid.getRightAlignedColumnClass(),title:"Total",width:"25%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatIntegerNumberWithColor});a.gridBonos.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,noRecordsText:"No hay información de Bonos",columns:b,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Liquidación MAE - Bonos",columnFields:["CodigoEspecie","Especie","MAEClearBilateral","MAEClearGarantizado","Total"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Liquidación MAE - Bonos"}}}})};a.loadGrids=function(){a.lblTitleBonos.text("Bonos al "+Core.Functions.Date.getDisplayDate(a.txtDate.swidget().value()));a.lblTitleMonedas.text("Monedas al "+Core.Functions.Date.getDisplayDate(a.txtDate.swidget().value()));var b;b="Fecha="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDate.swidget().value()));var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"reporte/mae/liquidacion",requestType:"GET",requestData:b});c.onSuccess=function(f){var d=a.gridBonos.swidget().initialOptions;d.dataSource.data=f.bonos;d.exportOptions.excel.dataSource.data=f.bonos;d.exportOptions.excel.readDataSource=true;a.gridBonos.swidget().refresh(d);var e=a.gridMonedas.swidget().initialOptions;e.dataSource.data=f.monedas;e.exportOptions.excel.dataSource.data=f.monedas;e.exportOptions.excel.readDataSource=true;a.gridMonedas.swidget().refresh(e);a.txtFilterBonos.keydown()};c.request()}};Core.Business.ReporteMailsModificadosPlataforma=new function(){var a=this;a.id="reporteMailsModificadosPlataforma";a.gridPersonas=null;a.txtFilter=null;a.chkDistinguirMayusculasMinusculas=null;a.chkSoloModificacionesPlataforma=null;a.chkSoloUsuarios=null;a.chkDiferentesBolsaFondos=null;a.chkDiferenciasDatos=null;a.btnRefresh=null;a.timeout=null;a.window=$(window);a.init=function(b,c){Core.loadPage("backoffice-reporte-mails-modificados-plataforma.html",function(){a.idDefaultAccount=b;a.idDefaultProfile=c;document.title="Reporte Mails Modificados";a.btnRefresh=$(".btn-refresh");a.txtFilter=$(".textbox-filter");a.gridPersonas=$(".div-reporte-mails-modificados");a.chkDistinguirMayusculasMinusculas=$(".checkbox-distinguir-mayusculas-minusculas");a.chkSoloModificacionesPlataforma=$(".checkbox-solo-modificaciones-plataforma");a.chkSoloUsuarios=$(".checkbox-solo-usuarios");a.chkDiferentesBolsaFondos=$(".checkbox-diferentes-bolsa-fondos");a.chkDiferenciasDatos=$(".checkbox-diferencias-datos");a.initGrid();a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadGrid()},"Core.Business.ReporteMailsModificadosPlataforma")})};a.initControls=function(){a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var b=a.gridPersonas.swidget().dataSource;if(value){b.filter={or:[{path:"idPersona",filter:"contains",value:value},{path:"Descripcion",filter:"contains",value:value},{path:"Usuario",filter:"contains",value:value},{path:"UltimoCambioMail",filter:"contains",value:value},{path:"username",filter:"contains",value:value},{path:"Aplicacion",filter:"contains",value:value},{path:"emailP",filter:"contains",value:value},{path:"FechaNacP",filter:"contains",value:value},{path:"SexoP",filter:"contains",value:value},{path:"Comitente",filter:"contains",value:value},{path:"emailB",filter:"contains",value:value},{path:"FechaNacB",filter:"contains",value:value},{path:"SexoB",filter:"contains",value:value},{path:"emailF",filter:"contains",value:value},{path:"FechaNacF",filter:"contains",value:value},{path:"SexoF",filter:"contains",value:value},{path:"CodInterfaz",filter:"contains",value:value}]}}else{b.filter=null}b.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.ReporteMailsModificadosPlataforma.txtFilter");a.btnRefresh.click(function(){a.loadGrid()});a.chkDistinguirMayusculasMinusculas.on("change",function(){a.loadGrid()});a.chkDistinguirMayusculasMinusculas[0].checked=false;a.chkSoloModificacionesPlataforma.on("change",function(){a.loadGrid()});a.chkSoloModificacionesPlataforma[0].checked=true;a.chkSoloUsuarios.on("change",function(){a.loadGrid()});a.chkSoloUsuarios[0].checked=true;a.chkDiferentesBolsaFondos.on("change",function(){a.loadGrid()});a.chkDiferentesBolsaFondos[0].checked=false;a.chkDiferenciasDatos.on("change",function(){a.loadGrid()});a.chkDiferenciasDatos[0].checked=false};a.initGrid=function(){var b=[];b.push({width:"3%",field:"idPersona",title:"ID",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,e,d){c.html(e.idPersona);c.css("text-align","right");c.css("padding-right","5px")}});b.push({width:"10%",field:"Descripcion",title:"Descripción",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,e,d){c.html(e.Descripcion);c.css("text-align","left");c.css("padding-right","5px")}});b.push({width:"3%",field:"Usuario",title:"Usr",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,e,d){c.html(e.Usuario);c.css("text-align","center");c.css("padding-right","5px")}});b.push({width:"8%",field:"UltimoCambioMail",title:"Fecha Cambio",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,e,d){c.html(e.UltimoCambioMail);c.css("text-align","center");c.css("padding-right","5px")}});b.push({width:"4%",field:"username",title:"Usuario",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,e,d){c.html(e.username);c.css("text-align","left");c.css("padding-right","5px")}});b.push({width:"5%",field:"Aplicacion",title:"Aplicación",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,e,d){c.html(e.Aplicacion);c.css("text-align","center");c.css("padding-right","5px")}});b.push({width:"12%",field:"emailP",title:"Email P",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,e,d){c.html(e.emailP);c.css("text-align","left");c.css("padding-right","5px");if(e.ColoremailP){c.css("background-color","rgba("+a.hexToRgb(e.ColoremailP)+((d%2==0)?", 0.6":", 1 ")+")")}}});b.push({width:"5%",field:"FechaNacP",title:"Fecha Nac P",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,e,d){c.html(e.FechaNacP);c.css("text-align","center");c.css("padding-right","5px");if(e.ColorFechaNacP){c.css("background-color","rgba("+a.hexToRgb(e.ColorFechaNacP)+((d%2==0)?", 0.6":", 1 ")+")")}}});b.push({width:"3%",field:"SexoP",title:"Sexo P",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,e,d){c.html(e.SexoP);c.css("text-align","center");c.css("padding-right","5px");if(e.ColorSexoP){c.css("background-color","rgba("+a.hexToRgb(e.ColorSexoP)+((d%2==0)?", 0.6":", 1 ")+")")}}});b.push({width:"4%",field:"Comitente",title:"Cmt",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,e,d){c.html(e.Comitente);c.css("text-align","center");c.css("padding-right","5px");if(e.ColorComitente){c.css("background-color","rgba("+a.hexToRgb(e.ColorComitente)+((d%2==0)?", 0.6":", 1 ")+")")}}});b.push({width:"12%",field:"emailB",title:"Email B",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,e,d){c.html(e.emailB);c.css("text-align","left");c.css("padding-right","5px");if(e.ColoremailB){c.css("background-color","rgba("+a.hexToRgb(e.ColoremailB)+((d%2==0)?", 0.6":", 1 ")+")")}}});b.push({width:"5%",field:"FechaNacB",title:"Fecha Nac B",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,e,d){c.html(e.FechaNacB);c.css("text-align","center");c.css("padding-right","5px");if(e.ColorFechaNacB){c.css("background-color","rgba("+a.hexToRgb(e.ColorFechaNacB)+((d%2==0)?", 0.6":", 1 ")+")")}}});b.push({width:"3%",field:"SexoB",title:"Sexo B",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,e,d){c.html(e.SexoB);c.css("text-align","center");c.css("padding-right","5px");if(e.ColorSexoB){c.css("background-color","rgba("+a.hexToRgb(e.ColorSexoB)+((d%2==0)?", 0.6":", 1 ")+")")}}});b.push({width:"12%",field:"emailF",title:"Email F",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,e,d){c.html(e.emailF);c.css("text-align","left");c.css("padding-right","5px");if(e.ColoremailF){c.css("background-color","rgba("+a.hexToRgb(e.ColoremailF)+((d%2==0)?", 0.6":", 1 ")+")")}}});b.push({width:"5%",field:"FechaNacF",title:"Fecha Nac F",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,e,d){c.html(e.FechaNacF);c.css("text-align","center");c.css("padding-right","5px");if(e.ColorFechaNacF){c.css("background-color","rgba("+a.hexToRgb(e.ColorFechaNacF)+((d%2==0)?", 0.6":", 1 ")+")")}}});b.push({width:"3%",field:"SexoF",title:"Sexo F",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,e,d){c.html(e.SexoF);c.css("text-align","center");c.css("padding-right","5px");if(e.ColorSexoF){c.css("background-color","rgba("+a.hexToRgb(e.ColorSexoF)+((d%2==0)?", 0.6":", 1 ")+")")}}});b.push({width:"3%",field:"CodInterfaz",title:"C Int",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,e,d){c.html(e.CodInterfaz);c.css("text-align","center");c.css("padding-right","5px");if(e.ColorCodInterfaz){c.css("background-color","rgba("+a.hexToRgb(e.ColorCodInterfaz)+((d%2==0)?", 0.6":", 1 ")+")")}}});a.gridPersonas.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Mails Modificados",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["idPersona","Descripcion","Usuario","UltimoCambioMail","username","Aplicacion","emailP","FechaNacP","SexoP","Comitente","emailB","FechaNacB","SexoB","emailF","FechaNacF","SexoF","CodInterfaz"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Mails Modificados"}}},paging:{pageSize:100,pageLinksCount:10},noRecordsText:"No hay información de Personas",columns:b})};a.loadGrid=function(){var b="";b+="DistinguirCase="+((a.chkDistinguirMayusculasMinusculas[0].checked)?"1":"0");b+="&SoloCambiosPlataforma="+((a.chkSoloModificacionesPlataforma[0].checked)?"1":"0");b+="&SoloConUsuarios="+((a.chkSoloUsuarios[0].checked)?"1":"0");b+="&IncluirDiferenciasESCO="+((a.chkDiferentesBolsaFondos[0].checked)?"1":"0");b+="&IncluirDiferenciasOtros="+((a.chkDiferenciasDatos[0].checked)?"1":"0");var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"reporte/mailsmodificadosplataforma",requestType:"GET",requestData:b});c.onSuccess=function(e){var d=a.gridPersonas.swidget().initialOptions;d.dataSource.data=e.Personas;d.dataSource.sort=a.gridPersonas.swidget().dataSource.sort;d.dataSource.group=a.gridPersonas.swidget().dataSource.group;d.exportOptions.excel.dataSource.data=e.Personas;d.exportOptions.excel.readDataSource=true;a.gridPersonas.swidget().refresh(d);a.txtFilter.keydown()};c.request()};a.hexToRgb=function(d){d=d.replace("#","");var f=parseInt(d.substring(0,2),16);var e=parseInt(d.substring(2,4),16);var c=parseInt(d.substring(4,6),16);var h=f+","+e+","+c;return h}};Core.Business.ReporteMandatos=new function(){var a=this;a.id="reporteMandatos";a.divReporteMandatos=null;a.txtFilter=null;a.divTipos=null;a.timeout=null;a.originalData=[];a.init=function(b,c){Core.loadPage("backoffice-reporte-mandatos.html",function(){document.title="Mandatos";a.divTipos=$(".div-botonera-tipos");a.divReporteMandatos=$(".div-reporte-mandatos");a.txtFilter=$(".textbox-filter");a.initGrid();a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var d=a.divReporteMandatos.swidget().dataSource;if(value){d.filter={or:[{path:"Cuotapartista",filter:"contains",value:value},{path:"idCuenta",filter:"contains",value:value},{path:"Nombre",filter:"contains",value:value},{path:"Documento",filter:"contains",value:value}]}}else{d.filter=null}d.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.ReporteMandatos.txtFilter");a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.ReporteMandatos")})};a.initGrid=function(){a.divReporteMandatos.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:50,pageLinksCount:10},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Mandatos",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["Cuotapartista","idCuenta","Version","Tipo","Nombre","Documento","Fecha"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Mandatos"}}},columns:[{width:"10%",field:"Cuotapartista",title:"Cuotapartista",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"10%",field:"idCuenta",title:"ID Cuenta",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"10%",field:"Version",title:"Versión",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"10%",field:"Tipo",title:"Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"40%",field:"Nombre",title:"Nombre",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"10%",field:"Documento",title:"Documento",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"10%",field:"Fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatStringDate},{width:100,title:" ",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(d,e,f){if(e.Detalle){var c=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(d);c.on("click",function(){var g=new Core.Ajax.ServerRequest({overlayElement:c,secureRequest:true,requestUrl:"mandatos/"+e.idMandatoElectronico,requestType:"GET"});g.onSuccess=function(h){if(h.mandatos[0]){var j="";j+="<table class='table table-striped'>";j+="<thead><tr><th>Nombre</th><th>Valor</th></tr></thead>";j+="<tbody>";$.each(h.mandatos[0],function(k,l){j+="<tr>";j+="<td>"+k+"</td>";j+="<td>"+l+"</td>";j+="</tr>"});j+="</tbody>";j+="</table>";var i=new Core.Controls.Dialog("Detalles",j,{displayButtons:{close:true,accept:false}});i.show()}};g.request()})}if(e.Descargar){var b=$('<button type="button" title="Descargar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>').appendTo(d);b.on("click",function(){function h(p){var o=new Blob([p.response],{type:p.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(o);return}var j=window.URL.createObjectURL(o);var n=document.createElement("a");n.href=j;var l=p.getResponseHeader("Content-Disposition").split("; ");var k="filename=file.pdf";for(var m=0;m<l.length;m++){if(l[m].indexOf("filename")>=0){k=l[m]}}n.download=k.split("=")[1];n.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(j)}var g=new XMLHttpRequest();g.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"descargar/15/"+e.idMandatoElectronico,true);g.responseType="blob";g.setRequestHeader("Authorization",Core.Objects.Context.Token);g.onload=function(i){if(g.status==200){h(g)}else{var j=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga del comprobante.</p>",{displayButtons:{close:true,accept:false}});j.show()}};g.send()})}}}]})};a.loadGrid=function(){var b=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"mandatos",requestType:"GET"});b.onSuccess=function(c){a.originalData=c;var d=[];$.each(a.originalData.mandatos,function(e,f){if(d.indexOf(f.Tipo)<0){d.push(f.Tipo)}});a.divTipos.empty();$.each(d,function(e,g){var f=$("<label class='lblEstadoContador' style='background-color: lightblue; margin: 8px 6px 8px 0; padding: 4px 5px; border: 1px solid #ccc;  font-weight: normal;' activo='true' tipo='"+g+"'>"+g+"</label>").appendTo(a.divTipos);f.on("click",function(){a.setTipo(f)})});a.refreshGrid()};b.request()};a.setTipo=function(b){if(b.attr("activo")=="true"){b.css("background-color","transparent");b.attr("activo","false")}else{b.css("background-color","lightblue");b.attr("activo","true")}a.refreshGrid()};a.refreshGrid=function(){var b=$.grep(a.originalData.mandatos,function(h,g){return true});var f=$(".lblEstadoContador");for(var c=0;c<f.length;c++){var e=$(f[c]);if(e.attr("activo")=="false"){b=$.grep(b,function(h,g){return h.Tipo!=e.attr("tipo")})}}var d=a.divReporteMandatos.swidget().initialOptions;d.dataSource.data=b;d.exportOptions.excel.dataSource.data=b;d.exportOptions.excel.readDataSource=true;a.divReporteMandatos.swidget().refresh(d);a.txtFilter.keydown()}};Core.Business.AcdiItxSusRescDetalle=new function(){var a=this;var b=60000;a.id="acdiItxSusRescDetalle";a.lblTitle=null;a.divOrdenes=null;a.btnDescargarInterfaz=null;a.txtDate=null;a.timerId=null;a.loaded=false;a.window=$(window);a.init=function(c,d){Core.loadPage("backoffice-reporte-suscripciones-rescates-acdi.html",function(){document.title="Suscripciones y Rescates ACDI";a.lblTitle=$(".label-title");a.divOrdenes=$(".div-suscripciones-rescates-acdi");a.btnDescargarInterfaz=$(".btn-descargar-interfaz");a.txtDate=$(".date-picker");a.initGrids();a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,c,d,function(){a.loaded=false;a.loadGrid()},"Core.Business.AcdiItxSusRescDetalle");a.timerId=window.setInterval(function(){a.loadGrid()},b);Core.Objects.Context.Timers.push(a.timerId)})};a.initControls=function(){a.txtDate.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loaded=false;a.loadGrid()}}});a.btnDescargarInterfaz.click(function(){function d(l){var k=new Blob([l.response],{type:l.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(k);return}var e=window.URL.createObjectURL(k);var j=document.createElement("a");j.href=e;var g=l.getResponseHeader("Content-Disposition").split("; ");var f="filename=reporte.xlsx";for(var h=0;h<g.length;h++){if(g[h].indexOf("filename")>=0){f=g[h]}}j.download=f.split("=")[1];j.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(e)}var c=new XMLHttpRequest();c.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"/descargar/10/"+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDate.swidget().value())),true);c.responseType="blob";c.setRequestHeader("Authorization",Core.Objects.Context.Token);c.onload=function(e){if(c.status==200){d(c)}else{var f=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga del reporte.</p>",{displayButtons:{close:true,accept:false}});f.show()}};c.send()})};a.initGrids=function(){var c=[];c.push({field:"concertacion",width:"8%",title:"Concertación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"acreditacion",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"8%",title:"Acreditación",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"comitente",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"8%",title:"Comitente",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"operacion",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"8%",title:"Operación",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"fondo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"28%",title:"Fondo",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"cuotapartes",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"8%",title:"Cuotapartes",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedNumber});c.push({field:"importe",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"8%",title:"Importe",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedNumber});c.push({field:"moneda",width:"8%",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"esacdi",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"8%",title:"Es ACDI",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"codInterfaz",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"8%",title:"Interfaz",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});a.divOrdenes.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:c})};a.loadGrid=function(){a.lblTitle.text("Al "+Core.Functions.Date.getDisplayDate(a.txtDate.swidget().value()));var c;c="Fecha="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDate.swidget().value()));var d=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,overlayElement:a.divOrdenes.parent(),secureRequest:true,requestUrl:"acdi/obtenersuscrescdetalle",requestType:"GET",requestData:c});d.onSuccess=function(e){var g=a.window.scrollTop();var f=a.divOrdenes.swidget().initialOptions;f.dataSource.data=e.ordenes;f.dataSource.sort=a.divOrdenes.swidget().dataSource.sort;f.dataSource.group=a.divOrdenes.swidget().dataSource.group;a.divOrdenes.swidget().refresh(f);a.window.scrollTop(g);a.loaded=true};d.request()}};Core.Business.ReporteUIF=new function(){var a=this;a.idDefaultAccount=null;a.idDefaultProfile=null;a.id="reporteUIF";a.txtAño=null;a.ddlMes=null;a.btnDescargarArchivos=$(".btn-descargar-archivos");a.btnDescargarUltimasCorrecciones=$(".btn-descargar-ultimas-correcciones");a.pageOptions=null;a.init=function(b,c){Core.loadPage("backoffice-reporte-uif.html",function(){document.title="Reporte UIF";a.idDefaultAccount=b;a.idDefaultProfile=c;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.txtAño=$(".textbox-anio");a.ddlMes=$(".dropdown-mes");a.btnDescargarArchivos=$(".btn-descargar-archivos");a.btnDescargarUltimasCorrecciones=$(".btn-descargar-ultimas-correcciones");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){},"Core.Business.ReporteUIF")})};a.initControls=function(){var b=new Date();a.txtAño.shieldNumericTextBox({min:1900,max:b.getFullYear(),step:1,value:b.getFullYear().toString()});a.ddlMes.shieldDropDown({dataSource:{data:[{text:"Enero",value:1},{text:"Febrero",value:2},{text:"Marzo",value:3},{text:"Abril",value:4},{text:"Mayo",value:5},{text:"Junio",value:6},{text:"Julio",value:7},{text:"Agosto",value:8},{text:"Septiembre",value:9},{text:"Octubre",value:10},{text:"Noviembre",value:11},{text:"Diciembre",value:12}]},textTemplate:"{text}",valueTemplate:"{value}",value:(b.getMonth()).toString()});a.btnDescargarArchivos.on("click",function(){if(a.validInputs()){Core.Functions.File.download(a.btnDescargarArchivos,Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"download/reporteUIF/"+a.ddlMes.swidget().value()+"/"+a.txtAño.swidget().value()+"/1",function(){})}});a.btnDescargarUltimasCorrecciones.on("click",function(){if(a.validInputs()){Core.Functions.File.download(a.btnDescargarUltimasCorrecciones,Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"download/reporteUIF/"+a.ddlMes.swidget().value()+"/"+a.txtAño.swidget().value()+"/0",function(){})}})};a.validInputs=function(){var e={value:true};Core.Functions.Validations.toggleValidation(a.txtAño,false);Core.Functions.Validations.toggleValidation(a.ddlMes,false);var d=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMes,e);var c=Core.Functions.Validations.getValidatedNumericSwidgetValue(a.txtAño,e);var b=new Date();if(e.value&&c==b.getFullYear()&&d>(b.getMonth()+1)){Core.Functions.Validations.toggleValidation(a.txtAño,true);Core.Functions.Validations.toggleValidation(a.ddlMes,true);e.value=false}return e.value}};Core.Business.ScriptFondos=new function(){var a=this;a.id="homeScriptFondos";a.idDefaultAccount=null;a.idDefaultProfile=null;a.btnConfirmarArchivos=null;a.inputFiles=null;a.txtFecha=null;a.pageOptions=null;a.window=$(window);a.init=function(b,c){Core.loadPage("backoffice-script-fondos.html",function(){document.title="Script Fondos";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.idDefaultAccount=b;a.idDefaultProfile=c;a.txtFecha=$(".date-picker-fecha");a.btnConfirmarArchivos=$(".btn-confirmar-archivos");a.inputFiles=$(".input-upload-file");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){},"Core.Business.ScriptFondos")})};a.initControls=function(){a.txtFecha.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date()});a.btnConfirmarArchivos.on("click",function(){if(a.inputFiles[0].files.length!=1){new Core.Controls.Dialog("Aviso","<p>Debe seleccionar un único archivo.</p>",{displayButtons:{close:true,accept:false}}).show();return}for(var h=0,d;d=a.inputFiles[0].files[h];h++){var e=d.name.split(".");var c=e[e.length-1];if(c!="xlsx"){new Core.Controls.Dialog("Aviso","<p>El archivo seleccionado deben ser: xlsx.</p>",{displayButtons:{close:true,accept:false}}).show();return}}if(!a.txtFecha.swidget().value()){new Core.Controls.Dialog("Aviso","<p>Debe seleccionar la fecha.</p>",{displayButtons:{close:true,accept:false}}).show();return}var g={Authorization:Core.Objects.Context.Token,Accept:"application/json"};var b=new FormData();for(var h=0,d;d=a.inputFiles[0].files[h];h++){b.append("file-"+h,d)}var j=new Core.Controls.Overlay(a.btnConfirmarArchivos,{});$.ajax({type:"POST",url:Core.Origin+"/backoffice/api/v1/upload/csv/scriptFondos/cargarArchivo/"+a.getDateFormated(a.txtFecha.swidget().value()),data:b,cache:false,contentType:false,processData:false,method:"POST",headers:g,success:function(f){function k(r){var q=new Blob([r.response],{type:r.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(q);return}var l=window.URL.createObjectURL(q);var p=document.createElement("a");p.href=l;var n=r.getResponseHeader("Content-Disposition").split("; ");var m="filename=file.txt";for(var o=0;o<n.length;o++){if(n[o].indexOf("filename")>=0){m=n[o]}}p.download=m.split("=")[1];p.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(l)}if(f.nombreArchivo){var i=new XMLHttpRequest();i.open("GET",Core.Origin+"/backoffice/api/v1/download/scriptFondos/descargar/"+f.nombreArchivo,true);i.responseType="blob";i.setRequestHeader("Authorization",Core.Objects.Context.Token);i.onload=function(l){if(i.status==200){k(i)}else{var m=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga del comprobante.</p>",{displayButtons:{close:true,accept:false}});m.show()}a.inputFiles.val("");j.destroy()};i.send()}else{a.inputFiles.val("");j.destroy()}},error:function(i){var l=JSON.parse(i.responseText);var m=(l&&l.descripcion)?"Mensaje":"Error de conexión";var f=(l&&l.descripcion)?l.descripcion:"Algunos componentes de la página no se cargaron correctamente. Por favor intente mas tarde...";var k=new Core.Controls.Dialog(m,"<p>"+f+"</p>",{displayButtons:{close:true,accept:false}});k.show();j.destroy()}})})};a.getDateFormated=function(b){if(!b){return""}return b.getFullYear().toString()+"-"+Core.Functions.Date.getTwoCharsNumber(b.getMonth()+1)+"-"+Core.Functions.Date.getTwoCharsNumber(b.getDate())}};Core.Business.SincronizarMails=new function(){var a=this;a.id="homeSincronizarMails";a.divMails=null;a.lblTitle=null;a.btnRefresh=null;a.txtFilter=null;a.pageOptions=null;a.timeout=null;a.init=function(b,c){Core.loadPage("backoffice-sincronizar-mails.html",function(){document.title="Sincronizar Mails";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divMails=$(".div-mails");a.txtFilter=$(".textbox-filter");a.btnRefresh=$(".btn-refresh");a.chkMailUsuario=$(".checkbox-mail-usuario");a.chkMailVBolsa=$(".checkbox-mail-vbolsa");a.chkMailVFondos=$(".checkbox-mail-vfondos");a.chkMailCaja=$(".checkbox-mail-caja");a.chkMailRofex=$(".checkbox-mail-rofex");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.SincronizarMails")})};a.initControls=function(){a.btnRefresh.on("click",function(){a.loadGrid()});a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var b=a.divMails.swidget().dataSource;if(value){b.filter={or:[{path:"Comitente",filter:"contains",value:value},{path:"Cuenta",filter:"contains",value:value}]}}else{b.filter=null}b.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.SincronizarMails.txtFilter");a.chkMailUsuario.on("change",function(){a.loadGrid()});a.chkMailUsuario[0].checked=false;a.chkMailVBolsa.on("change",function(){a.loadGrid()});a.chkMailVBolsa[0].checked=false;a.chkMailVFondos.on("change",function(){a.loadGrid()});a.chkMailVFondos[0].checked=false;a.chkMailCaja.on("change",function(){a.loadGrid()});a.chkMailCaja[0].checked=false;a.chkMailRofex.on("change",function(){a.loadGrid()});a.chkMailRofex[0].checked=false;a.divMails.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Sincronizar Mails",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:[],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Sincronizar Mails"}}},paging:{pageSize:100,pageLinksCount:10},selection:false,rowHover:false,sorting:{multiple:true},columns:[]})};a.loadGrid=function(){var b="";b+=("mailUsuario="+((a.chkMailUsuario[0].checked)?"1":"0"));b+=("&mailVBolsa="+((a.chkMailVBolsa[0].checked)?"1":"0"));b+=("&mailVFondos="+((a.chkMailVFondos[0].checked)?"1":"0"));b+=("&mailCaja="+((a.chkMailCaja[0].checked)?"1":"0"));b+=("&mailRofex="+((a.chkMailRofex[0].checked)?"1":"0"));var c=new Core.Ajax.ServerRequest({overlayElement:a.divMails.parent(),secureRequest:true,requestUrl:"SyncMails/GetResults?"+b,requestType:"GET"});c.onSuccess=function(f){var d=[];var e=[];d.push({field:"idTipoDocumento",title:"Tipo Documento",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),columnTemplate:function(h,i,j){if(i.ColorFila){h.parent().css("background-color","rgb("+Core.Functions.grid.hexToRgb(i.ColorFila)+")")}h.text(i.MailPlataformaOn?i.idTipoDocumento:"")}});e.push("idTipoDocumento");d.push({field:"Documento",title:"Documento",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),columnTemplate:function(h,i,j){h.text(i.MailPlataformaOn?i.Documento:"")}});e.push("Documento");d.push({field:"idPersonaPlataforma",title:"Persona Plataforma",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),columnTemplate:function(h,i,j){h.text(i.MailPlataformaOn?i.idPersonaPlataforma:"")}});e.push("idPersonaPlataforma");d.push({field:"MailPlataforma",title:"Mail Plataforma",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),columnTemplate:function(h,i,j){h.text(i.MailPlataformaOn?i.MailPlataforma:"")}});e.push("MailPlataforma");if(a.chkMailUsuario[0].checked){d.push({field:"MailUsuario",title:"Mail Usuario",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),columnTemplate:function(h,i,j){h.text(i.MailUsuarioOn?i.MailUsuario:"")}});e.push("MailUsuario")}if(a.chkMailVBolsa[0].checked){d.push({field:"MailVBolsa",title:"Mail VBolsa",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),columnTemplate:function(h,i,j){h.text(i.MailVBolsaOn?i.MailVBolsa:"")}});e.push("MailVBolsa")}if(a.chkMailVFondos[0].checked){d.push({field:"MailVFondos",title:"Mail VFondos",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),columnTemplate:function(h,i,j){h.text(i.MailVFondosOn?i.MailVFondos:"")}});e.push("MailVFondos")}if(a.chkMailCaja[0].checked){d.push({field:"ComitenteCV",title:"Comitente CV",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),columnTemplate:function(h,i,j){h.text(i.MailCajaOn?i.ComitenteCV:"")}});e.push("ComitenteCV");d.push({field:"SubcuentaCV",title:"Subcuenta CV",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),columnTemplate:function(h,i,j){h.text(i.MailCajaOn?i.SubcuentaCV:"")}});e.push("SubcuentaCV");d.push({field:"MailCaja",title:"Mail Caja",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),columnTemplate:function(h,i,j){h.text(i.MailCajaOn?i.MailCaja:"")}});e.push("MailCaja")}if(a.chkMailRofex[0].checked){d.push({field:"CuentaRofex",title:"Cuenta Rofex",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),columnTemplate:function(h,i,j){h.text(i.MailRofexOn?i.CuentaRofex:"")}});e.push("CuentaRofex");d.push({field:"MailRofex",title:"Mail Rofex",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),columnTemplate:function(h,i,j){h.text(i.MailRofexOn?i.MailRofex:"")}});e.push("MailRofex")}f=((f&&f.Mails)?f.Mails:[]);var g=a.divMails.swidget().initialOptions;g.columns=d;g.dataSource.data=f;g.exportOptions.excel.dataSource.data=f;g.exportOptions.excel.columnFields=e;g.exportOptions.excel.readDataSource=true;a.divMails.swidget().refresh(g);a.txtFilter.keydown()};c.request()}};Core.Business.SolicitudesFondos=new function(){var a=this;a.id="homeSolicitudesFondos";a.divSolicitudesFondos=null;a.lblTitle=null;a.txtDate=null;a.txtFilter=null;a.timeout=null;a.pageOptions=null;a.init=function(b,c){Core.loadPage("backoffice-solicitudes-fondos.html",function(){document.title="Solicitudes Fondos";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divSolicitudesFondos=$(".div-solicitudes-fondos");a.lblTitle=$(".label-title");a.txtDate=$(".textbox-date");a.txtFilter=$(".textbox-filter");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.SolicitudesFondos")})};a.initControls=function(){a.txtDate.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loadGrid()}}});var b=[];b.push({width:"8%",field:"FondoNombre",title:"Fondo Nombre",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"8%",field:"SolicitudTipo",title:"Solicitud Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"8%",field:"CuotapartistaNumero",title:"Cuot. Número",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"20%",field:"CuotapartistaNombre",title:"Cuot. Nombre",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"12%",field:"CantidadCuotapartes",title:"Cant. Cuot.",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithDecimals});b.push({width:"8%",field:"MonedaSimbolo",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"8%",field:"Importe",title:"Importe",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithDecimals});b.push({width:"12%",field:"CuotapartistaCUIT_CUIL_CDI",title:"Cuot. CUIT/CUIL",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"16%",field:"FormaDePago",title:"Forma de Pago",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});a.divSolicitudesFondos.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Solicitudes Fondos",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["FondoNombre","SolicitudTipo","CuotapartistaNumero","CuotapartistaNombre","TipoValorCuotaparteAbreviatura","SolicituNumero","FechaConcertacion","FechaAcreditacion","CantidadCuotapartes","MonedaSimbolo","Importe","CodigoInterfaz","Liquidacion","CuotapartistaCUIT_CUIL_CDI","CondicionIE","FormaDePago","CBU","BANCO"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Solicitudes Fondos"}}},paging:{pageSize:50,pageLinksCount:10},selection:false,rowHover:false,sorting:{multiple:true},columns:b});a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var c=a.divSolicitudesFondos.swidget().dataSource;if(value){c.filter={or:[{path:"Importe",filter:"contains",value:value},{path:"CuotapartistaCUIT_CUIL_CDI",filter:"contains",value:value},{path:"CuotapartistaNombre",filter:"contains",value:value},{path:"CuotapartistaNumero",filter:"contains",value:value}]}}else{c.filter=null}c.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.SolicitudesFondos.txtFilter")};a.loadGrid=function(){a.lblTitle.text("Al "+Core.Functions.Date.getDisplayDate(a.txtDate.swidget().value()));var b=new Core.Ajax.ServerRequest({overlayElement:a.divSolicitudesFondos.parent(),secureRequest:true,requestUrl:"fondos/solicitudes/"+Core.Functions.Date.getDisplayDateWithSeparator(a.txtDate.swidget().value(),"-"),requestType:"GET"});b.onSuccess=function(c){var d=a.divSolicitudesFondos.swidget().initialOptions;d.dataSource.data=c.solicitudes;d.exportOptions.excel.dataSource.data=c.solicitudes;d.exportOptions.excel.readDataSource=true;a.divSolicitudesFondos.swidget().refresh(d);a.txtFilter.keydown()};b.request()}};Core.Business.Terroristas=new function(){var a=this;a.id="homeTerroristas";a.idDefaultAccount=null;a.idDefaultProfile=null;a.btnValidarTerroristas=null;a.btnValidar=null;a.divContainerValidarTerroristas=null;a.divValidarTerroristas=null;a.btnBasePersonasTerroristas=null;a.divBasePersonasTerroristas=null;a.txtFilterBasePersonasTerroristas=null;a.timeoutBasePersonasTerroristas=null;a.btnBaseEntidadesTerroristas=null;a.divBaseEntidadesTerroristas=null;a.txtFilterBaseEntidadesTerroristas=null;a.timeoutBaseEntidadesTerroristas=null;a.btnHistorialEjecucion=null;a.divHistorialEjecucion=null;a.txtFilterHistorialEjecucion=null;a.timeoutHistorialEjecucion=null;a.pageOptions=null;a.window=$(window);a.init=function(b,c){Core.loadPage("backoffice-terroristas.html",function(){document.title="Terroristas";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.idDefaultAccount=b;a.idDefaultProfile=c;a.btnValidarTerroristas=$(".btn-validar-terroristas");a.btnValidar=$(".btn-validar");a.btnValidar.on("click",function(){a.loadGridValidarTerroristas()});a.divContainerValidarTerroristas=$(".div-container-validar-terroristas");a.divContainerValidarTerroristas.hide();a.divValidarTerroristas=$(".div-validar-terroristas");a.initControlsValidarTerroristas();a.btnBasePersonasTerroristas=$(".btn-base-personas-terroristas");a.btnBasePersonasTerroristas.on("click",function(){a.loadGridBasePersonasTerroristas()});a.divBasePersonasTerroristas=$(".div-base-personas-terroristas");a.txtFilterBasePersonasTerroristas=$(".textbox-filter-base-personas-terroristas");a.initControlsBasePersonasTerroristas();a.btnBaseEntidadesTerroristas=$(".btn-base-entidades-terroristas");a.btnBaseEntidadesTerroristas.on("click",function(){a.loadGridBaseEntidadesTerroristas()});a.divBaseEntidadesTerroristas=$(".div-base-entidades-terroristas");a.txtFilterBaseEntidadesTerroristas=$(".textbox-filter-base-entidades-terroristas");a.initControlsBaseEntidadesTerroristas();a.btnHistorialEjecucion=$(".btn-historial-ejecucion");a.btnHistorialEjecucion.on("click",function(){a.loadGridHistorialEjecucion()});a.divHistorialEjecucion=$(".div-historial-ejecucion");a.txtFilterHistorialEjecucion=$(".textbox-filter-historial-ejecucion");a.initControlsHistorialEjecucion();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.btnValidarTerroristas.click()},"Core.Business.Terroristas")})};a.initControlsValidarTerroristas=function(){var b=[];b.push({field:"Tipo",title:"Tipo",width:"25%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Descripción",title:"Isin",width:"75%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});a.divValidarTerroristas.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Validar Terroristas",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["Tipo","Descripción"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Validar Terroristas"}}},selection:false,rowHover:false,columns:b,paging:{pageSize:100,pageLinksCount:10},noRecordsText:"No se encontraron coincidencias."})};a.loadGridValidarTerroristas=function(){var b=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"Terroristas/match",requestType:"GET"});b.onSuccess=function(c){var d=a.divValidarTerroristas.swidget().initialOptions;d.dataSource.data=c.Terroristas;d.exportOptions.excel.dataSource.data=c.Terroristas;d.exportOptions.excel.readDataSource=true;a.divValidarTerroristas.swidget().refresh(d);a.divContainerValidarTerroristas.show();if(c.Terroristas.length==0){var e=new Core.Controls.Dialog("Aviso","No se encontraron coincidencias.",{displayButtons:{close:true,accept:false}});e.show()}};b.request()};a.initControlsBasePersonasTerroristas=function(){var b=[];b.push({field:"Nombre",title:"Nombre",width:"50%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Nacionalidad",title:"Nacionalidad",width:"50%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});a.divBasePersonasTerroristas.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Base de Personas Terroristas",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["Nombre","Nacionalidad"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Base de Personas Terroristas"}}},selection:false,rowHover:false,columns:b,paging:{pageSize:100,pageLinksCount:10}});a.txtFilterBasePersonasTerroristas.on("keydown",function(){clearTimeout(a.timeoutBasePersonasTerroristas);a.timeoutBasePersonasTerroristas=setTimeout(function(){value=a.txtFilterBasePersonasTerroristas.val();var c=a.divBasePersonasTerroristas.swidget().dataSource;if(value){c.filter={or:[{path:"Nombre",filter:"contains",value:value},{path:"Nacionalidad",filter:"contains",value:value}]}}else{c.filter=null}c.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilterBasePersonasTerroristas,"Core.Business.Acreditaciones.txtFilterBasePersonasTerroristas")};a.loadGridBasePersonasTerroristas=function(){var b=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"Terroristas/personas",requestType:"GET"});b.onSuccess=function(c){var d=a.divBasePersonasTerroristas.swidget().initialOptions;d.dataSource.data=c.Terroristas;d.exportOptions.excel.dataSource.data=c.Terroristas;d.exportOptions.excel.readDataSource=true;a.divBasePersonasTerroristas.swidget().refresh(d);a.txtFilterBasePersonasTerroristas.keydown()};b.request()};a.initControlsBaseEntidadesTerroristas=function(){var b=[];b.push({field:"DENOMINACION",title:"Denominación",width:"50%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"PAIS",title:"País",width:"25%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"CIUDAD",title:"Ciudad",width:"25%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});a.divBaseEntidadesTerroristas.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Base de Entidades Terroristas",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["DENOMINACION","PAIS","CIUDAD"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Base de Entidades Terroristas"}}},selection:false,rowHover:false,columns:b,paging:{pageSize:100,pageLinksCount:10}});a.txtFilterBaseEntidadesTerroristas.on("keydown",function(){clearTimeout(a.timeoutBaseEntidadesTerroristas);a.timeoutBaseEntidadesTerroristas=setTimeout(function(){value=a.txtFilterBaseEntidadesTerroristas.val();var c=a.divBaseEntidadesTerroristas.swidget().dataSource;if(value){c.filter={or:[{path:"DENOMINACION",filter:"contains",value:value},{path:"PAIS",filter:"contains",value:value},{path:"CIUDAD",filter:"contains",value:value}]}}else{c.filter=null}c.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilterBaseEntidadesTerroristas,"Core.Business.Acreditaciones.txtFilterBaseEntidadesTerroristas")};a.loadGridBaseEntidadesTerroristas=function(){var b=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"Terroristas/entidades",requestType:"GET"});b.onSuccess=function(c){var d=a.divBaseEntidadesTerroristas.swidget().initialOptions;d.dataSource.data=c.Terroristas;d.exportOptions.excel.dataSource.data=c.Terroristas;d.exportOptions.excel.readDataSource=true;a.divBaseEntidadesTerroristas.swidget().refresh(d);a.txtFilterBaseEntidadesTerroristas.keydown()};b.request()};a.initControlsHistorialEjecucion=function(){function c(d){return d.substr(0,16)}var b=[];b.push({field:"USUARIO",title:"Usuario",width:"25%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({field:"CANTIDAD_MATCH_PERSONAS",title:"Cantidad Match Personas",width:"25%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatInteger});b.push({field:"CANTIDAD_MATCH_ENTIDADES",title:"Cantidad Match Entidades",width:"25%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatInteger});b.push({field:"FECHA_EJECUCION",title:"Fecha Ejecución",width:"25%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:c});a.divHistorialEjecucion.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Historial de Ejecución",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["USUARIO","CANTIDAD_MATCH_PERSONAS","CANTIDAD_MATCH_ENTIDADES","FECHA_EJECUCION"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Historial de Ejecución"}}},selection:false,rowHover:false,columns:b,paging:{pageSize:100,pageLinksCount:10}});a.txtFilterHistorialEjecucion.on("keydown",function(){clearTimeout(a.timeoutHistorialEjecucion);a.timeoutHistorialEjecucion=setTimeout(function(){value=a.txtFilterHistorialEjecucion.val();var d=a.divHistorialEjecucion.swidget().dataSource;if(value){d.filter={or:[{path:"USUARIO",filter:"contains",value:value},{path:"CANTIDAD_MATCH_PERSONAS",filter:"contains",value:value},{path:"CANTIDAD_MATCH_ENTIDADES",filter:"contains",value:value},{path:"FECHA_EJECUCION",filter:"contains",value:value}]}}else{d.filter=null}d.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilterHistorialEjecucion,"Core.Business.Acreditaciones.txtFilterHistorialEjecucion")};a.loadGridHistorialEjecucion=function(){var b=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"Terroristas/ejecuciones",requestType:"GET"});b.onSuccess=function(c){var d=a.divHistorialEjecucion.swidget().initialOptions;d.dataSource.data=c.Ejecuciones;d.exportOptions.excel.dataSource.data=c.Ejecuciones;d.exportOptions.excel.readDataSource=true;a.divHistorialEjecucion.swidget().refresh(d);a.txtFilterHistorialEjecucion.keydown()};b.request()}};Core.Business.OrdenesCanjes=new function(){var a=this;var b=900000;a.id="BackOfficeTitulosCanjes";a.init=function(c,d){Core.loadPage("backoffice-titulos-canjes.html",function(){document.title="Títulos Canjes";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[d]);a.idNegocio=((a.pageOptions&&a.pageOptions.BackofficeTitulosCanjesidNegocio!=null)?a.pageOptions.BackofficeTitulosCanjesidNegocio:1);a.idDefaultAccount=c;a.idDefaultProfile=d;a.divMain=$(".div-main");a.divOrdenes=$(".div-ordenes");a.btnRefresh=$(".btn-refresh");a.btnDescargaMasiva=$(".btn-descarga-masiva");a.btnImportacionMasiva=$(".btn-importacion-masiva");a.btnInvertirSeleccion=$(".btn-invertir-seleccion");a.txtFilter=$(".textbox-filter");a.divContadoresOrdenes=$(".div-ordenes-contadores");a.coloresActivos={};a.divEstadosOrdenes=$(".div-ordenes-estados");a.estadosActivos={};a.ordenes=[];a.timeout=null;a.window=$(window);a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,c,d,function(){a.loaded=false;a.loadGrid()},"Core.Business.OrdenesCanjes");a.timerId=window.setInterval(function(){a.loadGrid()},b);Core.Objects.Context.Timers.push(a.timerId)})};a.initControls=function(){a.btnRefresh.on("click",function(){a.loaded=false;a.loadGrid()});a.btnDescargaMasiva.on("click",function(){var e={ordenes:[]};a.divOrdenes.swidget().dataSource.data.forEach(function(g,f){if(g.chk&&g.chk[0].checked){e.ordenes.push({idOrden:g.idOrden,idCuenta:g.idCuenta})}});if(e.ordenes.length==0){new Core.Controls.Dialog("Aviso","Debe seleccionar al menos una orden.",{displayButtons:{close:true,accept:false}}).show();return}a.downloadFile(a.btnDescargaMasiva,"download/ordenes/backoffice/canjedescargarformulariosmasivo",e)});a.btnImportacionMasiva.click(function(){var e={ordenes:[]};a.divOrdenes.swidget().dataSource.data.forEach(function(g,f){if(g.chk&&g.chk[0].checked){e.ordenes.push({idOrden:g.idOrden,idCuenta:g.idCuenta})}});if(e.ordenes.length==0){new Core.Controls.Dialog("Aviso","Debe seleccionar al menos una orden.",{displayButtons:{close:true,accept:false}}).show();return}new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea importar "+((e.ordenes.length>1)?("las "+e.ordenes.length+" ordenes seleccionados"):("la orden seleccionada"))+"?",{onAccepted:function(){var f=new Core.Ajax.ServerRequest({overlayElement:a.btnImportacionMasiva,showOverlay:true,secureRequest:true,requestUrl:"ordenes/backoffice/canjeimportarmasivo",requestType:"POST",requestData:e});f.onSuccess=function(g){new Core.Controls.ProcessProgress({idProcess:((g&&g.idProceso)?g.idProceso:0),overlayElement:a.divMain,onFinish:function(){a.loaded=false;a.loadGrid()}}).show()};f.request()}}).show()});a.btnInvertirSeleccion.on("click",function(){a.divOrdenes.swidget().dataSource.data.forEach(function(f,e){if(f.chk){f.chk[0].checked=!f.chk[0].checked}})});a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var e=a.divOrdenes.swidget().dataSource;if(value){e.filter={or:[{path:"idOrden",filter:"contains",value:value},{path:"Estado",filter:"contains",value:value},{path:"NumCuenta",filter:"contains",value:value},{path:"TickerEntregado",filter:"contains",value:value},{path:"TickerRecibido",filter:"contains",value:value},{path:"UsuarioIngreso",filter:"contains",value:value}]}}else{e.filter=null}e.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.OrdenesCanjes.txtFilter");var c=[];c.push({field:"idOrden",title:"ID",width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),columnTemplate:function(e,g,f){e.html(g.idOrden);e.css("text-align","center");e.css("padding-right","5px");if(g.Color){e.parent().css("background-color","rgba("+Core.Functions.grid.hexToRgb(g.Color)+((f%2==0)?", 0.6":", 1 ")+")")}}});c.push({field:"Estado",title:"Estado",width:"10%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({field:"FechaEmision",title:"Fecha",width:"10%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatStringDate});c.push({field:"FechaEmision",title:"Hora",width:"10%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatStringDateTime});c.push({field:"FechaLiquidacion",title:"Liquidación",width:"10%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatStringDate});c.push({field:"NumCuenta",title:"Comitente",width:"10%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatIntegerNumber});c.push({field:"TickerEntregado",title:"Ticker Entregado",width:"15%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({field:"CantidadEntregada",title:"Cantidad Entregada",width:"10%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatNuleablePrice});c.push({field:"TickerRecibido",title:"Ticker Recibido",width:"15%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({field:"CantidadRecibida",title:"CantidadRecibida",width:"10%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatNuleablePrice});c.push({field:"UsuarioIngreso",title:"Ingreso",width:"15%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({title:"Obs.",width:40,headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),columnTemplate:function(e,f,g){if(f.ObservacionesInterfaz){var h=(f.length>140)?(f.ObservacionesInterfaz.substr(0,140)+"..."):(f.ObservacionesInterfaz);e.html('<button type="button" title="'+h+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-warning-sign"></span></button>');e.addClass("link-cell");e.on("click",function(){var i=new Core.Controls.Dialog("Observaciones",(f.ObservacionesInterfaz)?f.ObservacionesInterfaz:"",{displayButtons:{close:true,accept:false}});i.show()})}}});var d=Core.Functions.grid.getHeaderAttribute(c.length);c.push({width:40,field:"",title:" ",headerAttributes:d,columnTemplate:function(f,g,h){if(g.verBotonExportarEscoBolsa){var e=$('<button type="button" class="btn-sm balanz-button"><span class="glyphicon glyphicon-chevron-right"></span></button>').appendTo(f);e.on("click",function(){var i=new Core.Ajax.ServerRequest({overlayElement:e,showOverlay:true,secureRequest:true,requestUrl:"ordenes/backoffice/canjeimportarvbolsa",requestType:"PUT",requestData:{data:{idCuenta:g.idCuenta,idOrden:g.idOrden}}});i.onSuccess=function(j){a.loaded=false;a.loadGrid()};i.request()})}}});c.push({width:40,field:"",title:" ",headerAttributes:d,columnTemplate:function(f,g,h){if(g.verBotonDescargaFormulario){var e=$('<button type="button" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>').appendTo(f);e.on("click",function(){a.downloadFile(e,"download/ordenes/backoffice/canjedescargarformulariocomafi",{idCuenta:g.idCuenta,idOrden:g.idOrden})})}}});c.push({width:40,field:"",title:" ",headerAttributes:d,columnTemplate:function(f,g,h){if(g.verBotonDetalle){var e=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(f);e.on("click",function(){Core.Functions.grid.OrdenDetails.showDetails(g.idCuenta,g.idOrden,a.pageOptions)})}}});c.push({width:40,field:"",title:" ",headerAttributes:d,columnTemplate:function(f,g,h){if(g.verBotonActualizarIdExterno){var e=$('<button type="button" title="Actualizar Id Externo" class="btn-sm balanz-button"><span class="glyphicon glyphicon-check"></span></button>').appendTo(f);e.on("click",function(){var i=new Core.Controls.ActualizarIdExternoOrdenTesoreria({orden:g,onSuccess:function(){a.loaded=false;a.loadGrid()}}).show()})}}});c.push({width:40,field:"",title:" ",headerAttributes:d,columnTemplate:function(f,g,h){if(g.verBotonRechazar){var e=$('<button type="button" title="Rechazar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(f);e.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea rechazar la orden: "+g.idOrden+"?",{onAccepted:function(){var i=new Core.Ajax.ServerRequest({overlayElement:e,showOverlay:true,secureRequest:true,requestUrl:"ordenes/backoffice/orden",requestType:"PUT",requestData:{id:g.idOrden,idCuenta:g.idCuenta,idEstadoOrden:g.idEstadoRechazar}});i.onSuccess=function(j){a.loaded=false;a.loadGrid();var k=new Core.Controls.Dialog("Aviso","La orden ha sido rechazada correctamente",{displayButtons:{close:true,accept:false}});k.show()};i.request()}}).show()})}}});c.push({title:" ",field:"",width:40,headerAttributes:d,columnTemplate:function(e,g,f){if(g.chk){$(g.chk).appendTo(e)}}});a.divOrdenes.shieldGrid({dataSource:{data:[]},sorting:{multiple:true},selection:false,paging:{pageSize:50,pageLinksCount:10},rowHover:false,columns:c,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Títulos Canjes",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["idOrden","Estado","FechaEmision","FechaLiquidacion","NumCuenta","TickerEntregado","CantidadEntregada","TickerRecibido","CantidadRecibida","UsuarioIngreso","ObservacionesInterfaz"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Títulos Canjes"}}}})};a.loadGrid=function(){var c=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"ordenes/backoffice/canjes",requestType:"GET",requestData:{idNegocio:a.idNegocio}});c.onSuccess=function(e){a.ordenes=((e&&e.ordenes)?e.ordenes:[]);var f=[];$.each(a.ordenes,function(g,h){if(h.verCheckBox){h.chk=$('<input type="checkbox" />')}if(f.indexOf(h.Estado)<0){f.push(h.Estado)}});f.sort(function(g,h){if(g>h){return 1}else{return -1}});a.divEstadosOrdenes.empty();$.each(f,function(g,i){var j=$.grep(a.ordenes,function(l,k){return l.Estado==i});var h=$("<label style='background-color: "+((a.estadosActivos[i]==false)?"transparent; ":"lightblue; ")+"margin: 8px 6px 8px 0; padding: 4px 5px; border: 1px solid #ccc;  font-weight: normal;' activo='"+((a.estadosActivos[i]==false)?"false":"true")+"' valor='"+i+"'>"+i+": <strong style='color: #333;'>"+j.length+"</strong></label>").appendTo(a.divEstadosOrdenes);if(a.estadosActivos[i]==null){a.estadosActivos[i]=true}h.on("click",function(){Core.Functions.DynamicFilter.setFilter(h,"lightblue","transparent",a.estadosActivos);a.refreshGrid()})});var d=[];a.ordenes.forEach(function(h,g){if(d.indexOf(h.Color)==-1){d.push(h.Color)}});d.sort(function(g,h){if(g>h){return 1}else{return -1}});a.divContadoresOrdenes.empty();$('<label style="width:75px;" class="text-center">Total: '+a.ordenes.length+"</label>").appendTo(a.divContadoresOrdenes);d.forEach(function(i,h){var g=$.grep(a.ordenes,function(l,k){return l.Color==i});var j=$('<label class="text-center" valor="'+i+'" activo="'+((a.coloresActivos[i]==false)?"false":"true")+'" style="color: #2d2d2d !important; border-radius:4px; margin: 8px 6px 8px 0; width:75px; border: 4px solid '+(i?i:"transparent")+"; background-color:"+((a.coloresActivos[i]==false)?"#c4c4c4":i)+';">'+g.length+"</label>").appendTo(a.divContadoresOrdenes);if(a.coloresActivos[i]==null){a.coloresActivos[i]=true}j.on("click",function(){Core.Functions.DynamicFilter.setFilter(j,i,"#c4c4c4",a.coloresActivos);a.refreshGrid()})});a.refreshGrid()};c.request()};a.refreshGrid=function(){var e=Core.Functions.DynamicFilter.getActiveFilters(a.estadosActivos);var c=Core.Functions.DynamicFilter.getActiveFilters(a.coloresActivos);var d=$.grep(a.ordenes,function(j,h){return e.indexOf(j.Estado)>=0&&c.indexOf(j.Color)>=0});var g=a.window.scrollTop();var f=a.divOrdenes.swidget().initialOptions;f.dataSource.data=d;f.exportOptions.excel.dataSource.data=a.ordenes;f.exportOptions.excel.readDataSource=true;a.divOrdenes.swidget().refresh(f);a.txtFilter.keydown();a.loaded=true;a.window.scrollTop(g)};a.downloadFile=function(d,g,f){function h(p){var o=new Blob([p.response],{type:p.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(o);return}var j=window.URL.createObjectURL(o);var n=document.createElement("a");n.href=j;var l=p.getResponseHeader("Content-Disposition").split("; ");var k="filename=file.DAT";for(var m=0;m<l.length;m++){if(l[m].indexOf("filename")>=0){k=l[m]}}n.download=k.split("=")[1];n.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(j)}var c=new Core.Controls.Overlay(d,{});var e=new XMLHttpRequest();e.open("POST",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+g,true);e.responseType="blob";e.setRequestHeader("Authorization",Core.Objects.Context.Token);e.setRequestHeader("Accept","application/json");e.setRequestHeader("Content-Type","application/json");e.onload=function(i){if(e.status==200){h(e)}else{var j=new FileReader();j.onloadend=function(l){var k=((l&&l.srcElement&&l.srcElement.result)?JSON.parse(l.srcElement.result):{});var m=new Core.Controls.Dialog("Mensaje",((k&&k.Descripcion)?k.Descripcion:"No se ha podido realizar la descarga del archivo."),{displayButtons:{close:true,accept:false}});m.show()};j.readAsText(e.response)}c.destroy()};e.send(JSON.stringify(f))}};Core.Business.TransfTitulos=new function(){var a=this;var b=1800000;a.id="BackofficeTitulosTransferencias";a.divMain=null;a.divTransferenciasTitulos=null;a.timeout=null;a.pageOptions=null;a.btnDescargarTSA=null;a.btnRefresh=null;a.txtFilter=null;a.divEstados=null;a.estadosActivos={};a.timeout=null;a.data=[];a.timerId=null;a.window=$(window);a.loaded=false;a.init=function(c,d){Core.loadPage("backoffice-transferencias-titulos.html",function(){document.title="Transferencias Títulos";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[d]);a.divMain=$(".div-main");a.divTransferenciasTitulos=$(".div-transferencias-titulos");a.txtFilter=$(".textbox-filter");a.btnDescargarTSA=$(".btn-descargar-tsa");a.btnRefresh=$(".btn-refresh");a.divEstados=$(".div-estados");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,c,d,function(){a.loaded=false;a.loadGrid()},"Core.Business.TransfTitulos");a.timerId=window.setInterval(function(){a.loadGrid()},(a.pageOptions&&a.pageOptions.RefreshTimer?a.pageOptions.RefreshTimer:b));Core.Objects.Context.Timers.push(a.timerId)})};a.initControls=function(){function d(f){return(!f||f=="-1")?"":Core.Functions.grid.formatIntegerNumber(f)}var c=[];c.push({width:"6%",field:"idOrden",title:"ID",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});c.push({width:"8%",field:"FechaEmision",title:"Fecha Emisión",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatStringDateWithTime});c.push({width:"12%",field:"Operacion",title:"Tipo Operación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"8%",field:"Comitente",title:"Comitente",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});c.push({width:"20%",field:"Cuenta",title:"Cuenta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"8%",field:"ComitenteReceptor",title:"Comitente Receptor",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});c.push({width:"20%",field:"CuentaReceptora",title:"Cuenta Receptora",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"6%",field:"Ticker",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"6%",field:"Cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});c.push({width:"6%",field:"Estado",title:"Estado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"6%",field:"idExterno",title:"ID Externo",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:d});var e=Core.Functions.grid.getHeaderAttribute(c.length);c.push({width:90,field:"",title:" ",headerAttributes:e,columnTemplate:function(h,i,j){if(i.Color){h.parent().css("background-color","rgba("+Core.Functions.grid.hexToRgb(i.Color)+((j%2==0)?", 0.6":", 1 ")+")")}if(i.verBotonActualizarIdExterno){var f=$('<button type="button" title="Actualizar Id Externo" class="btn-sm balanz-button"><span class="glyphicon glyphicon-check"></span></button>').appendTo(h);f.on("click",function(){new Core.Controls.ActualizarIdExternoOrdenTesoreria({orden:i,onSuccess:function(){a.loaded=false;a.loadGrid()}}).show()})}if(i.verBotonRechazar){var g=$('<button type="button" title="Eliminar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(h);g.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Estás seguro que desea rechazar la orden de ID: "+i.idOrden+" ?",{onAccepted:function(){var k=new Core.Ajax.ServerRequest({overlayElement:g,showOverlay:true,secureRequest:true,requestUrl:"ordenes/backoffice/orden",requestType:"PUT",requestData:{id:i.idOrden,idCuenta:i.idCuenta,idEstadoOrden:i.idEstadoRechazar}});k.onSuccess=function(l){a.loaded=false;a.loadGrid()};k.request()}}).show()})}}});a.divTransferenciasTitulos.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:c,paging:{pageSize:100,pageLinksCount:10}});a.btnRefresh.on("click",function(){a.loaded=false;a.loadGrid()});a.btnDescargarTSA.hide();if(a.pageOptions&&a.pageOptions.VerBotonTSA){a.btnDescargarTSA.show();a.btnDescargarTSA.on("click",function(){Core.Functions.File.download(a.btnDescargarTSA,Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"ordenesbackoffice/transferenciastitulos/archivotranstitulostsa",function(){})})}a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var f=a.divTransferenciasTitulos.swidget().dataSource;if(value){f.filter={or:[{path:"Comitente",filter:"contains",value:value},{path:"ComitenteReceptor",filter:"contains",value:value},{path:"Cuenta",filter:"contains",value:value},{path:"CuentaReceptora",filter:"contains",value:value},{path:"Ticker",filter:"contains",value:value}]}}else{f.filter=null}f.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.TransfTitulos.txtFilter")};a.loadGrid=function(){var c=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,overlayElement:a.divMain,secureRequest:true,requestUrl:"ordenesbackoffice/transferenciastitulos",requestType:"GET"});c.onSuccess=function(d){a.data=d;var e=[];$.each(a.data.ordenes,function(f,g){if(e.indexOf(g.Estado)<0){e.push(g.Estado)}});e.sort(function(f,g){if(f>g){return 1}else{return -1}});a.divEstados.empty();$.each(e,function(f,h){var i=$.grep(a.data.ordenes,function(k,j){return k.Estado==h});var g=$("<label class='lblEstadoContador' style='background-color: "+((a.estadosActivos[h]==false)?"transparent; ":"lightblue; ")+"margin: 8px 6px 8px 0; padding: 4px 5px; border: 1px solid #ccc;  font-weight: normal;' activo='"+((a.estadosActivos[h]==false)?"false":"true")+"' estado='"+h+"'>"+h+": <strong style='color: #333;'>"+i.length+"</strong></label>").appendTo(a.divEstados);if(a.estadosActivos[h]==null){a.estadosActivos[h]=true}g.on("click",function(){a.setEstado(g)})});a.refreshGrid()};c.request()};a.setEstado=function(c){if(c.attr("activo")=="true"){c.css("background-color","transparent");c.attr("activo","false");a.estadosActivos[c.attr("estado")]=false}else{c.css("background-color","lightblue");c.attr("activo","true");a.estadosActivos[c.attr("estado")]=true}a.refreshGrid()};a.refreshGrid=function(){var h=a.window.scrollTop();var c=$.grep(a.data.ordenes,function(k,j){return true});var g=$(".lblEstadoContador");for(var d=0;d<g.length;d++){var f=$(g[d]);if(f.attr("activo")=="false"){c=$.grep(c,function(k,j){return k.Estado!=f.attr("estado")})}}var h=a.window.scrollTop();var e=a.divTransferenciasTitulos.swidget().initialOptions;e.dataSource.data=c;a.divTransferenciasTitulos.swidget().refresh(e);a.txtFilter.keydown();a.window.scrollTop(h);a.loaded=true}};Core.Business.eTipoTransferencias={Locales:1,Internacionales:2};Core.Business.TransfTitulosLocales=new function(){var a=this;a.init=function(b,c){Core.Business.BaseTransfTitulos.init(b,c,{id:"BackofficeTitulosTransferenciasLocales",namespace:"Core.Business.TransfTitulosLocales",tipoTransferencias:Core.Business.eTipoTransferencias.Locales,idNegocio:Core.Enums.eNegocio.BCV})}};Core.Business.TransfTitulosInternacionales=new function(){var a=this;a.init=function(b,c){Core.Business.BaseTransfTitulos.init(b,c,{id:"BackofficeTitulosTransferenciasInternacionales",namespace:"Core.Business.TransfTitulosInternacionales",tipoTransferencias:Core.Business.eTipoTransferencias.Internacionales,idNegocio:Core.Enums.eNegocio.BCV})}};Core.Business.TransfTitulosLocalesBCI=new function(){var a=this;a.init=function(b,c){Core.Business.BaseTransfTitulos.init(b,c,{id:"BackofficeTitulosTransferenciasLocalesBCI",namespace:"Core.Business.TransfTitulosLocalesBCI",tipoTransferencias:Core.Business.eTipoTransferencias.Locales,idNegocio:Core.Enums.eNegocio.BCI})}};Core.Business.TransfTitulosInternacionalesBCI=new function(){var a=this;a.init=function(b,c){Core.Business.BaseTransfTitulos.init(b,c,{id:"BackofficeTitulosTransferenciasInternacionalesBCI",namespace:"Core.Business.TransfTitulosInternacionalesBCI",tipoTransferencias:Core.Business.eTipoTransferencias.Internacionales,idNegocio:Core.Enums.eNegocio.BCI})}};Core.Business.BaseTransfTitulos=new function(){var a=this;var b=1800000;a.id="";a.namespace="";a.eTipoTransferencias=0;a.idNegocio=0;a.init=function(c,d,e){Core.loadPage("backoffice-transferencias-titulos-v2.html",function(){a.id=e.id;a.namespace=e.namespace;a.tipoTransferencias=e.tipoTransferencias;a.idNegocio=e.idNegocio;var f=("Transferencias Títulos"+(a.tipoTransferencias==Core.Business.eTipoTransferencias.Locales?" Locales":" Internacionales")+(a.idNegocio==Core.Enums.eNegocio.BCV?" BCV":" BCI"));document.title=f;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[d]);a.lblTitle=$(".lbl-title");a.lblTitle.text(f);a.divMain=$(".div-main");a.divTransferenciasTitulos=$(".div-transferencias-titulos");a.txtFilter=$(".textbox-filter");a.btnImportacionMasiva=$(".btn-importacion-masiva");a.btnDescargarTSA=$(".btn-descargar-tsa");a.btnDescargarMovimdia=$(".btn-descargar-movimdia");a.btnRefresh=$(".btn-refresh");a.btnFinalizarOrdenes=$(".btn-finalizar-ordenes");a.divEstados=$(".div-estados");a.chkVerTodas=$(".checkbox-ver-todas");a.estadosActivos={};a.timeout=null;a.data=[];a.window=$(window);a.loaded=false;a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,c,d,function(){a.loaded=false;a.loadGrid()},a.namespace);a.timerId=window.setInterval(function(){a.loadGrid()},(a.pageOptions&&a.pageOptions.RefreshTimer?a.pageOptions.RefreshTimer:b));Core.Objects.Context.Timers.push(a.timerId)})};a.initControls=function(){function d(f){return(!f||f=="-1")?"":Core.Functions.grid.formatIntegerNumber(f)}var c=[];c.push({width:"5%",field:"idOrden",title:"ID",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});c.push({width:"5%",field:"FechaNegociacion",title:"Fecha Concertación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatStringDate});c.push({width:"5%",field:"InmDif",title:"Plazo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"5%",field:"FechaLiquidacion",title:"Fecha Liquidación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatStringDate});c.push({width:"5%",field:"EmiRec",title:"Emisor/ Repector",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"5%",field:"Comitente",title:"Comitente",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});c.push({width:"15%",field:"Cuenta",title:"Cuenta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"5%",field:"PaisContraparte",title:"País Contraparte",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"10%",field:"AgenteContraparte",title:"Agente Contraparte",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"5%",field:"NumComitenteContraparte",title:"Comitente Contraparte",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});c.push({width:"5%",field:"Ticker",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"5%",field:"Cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});c.push({width:"5%",field:"Estado",title:"Estado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"15%",field:"SubEstadoOrden",title:"Sub-Estado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"5%",field:"idExterno",title:"ID Externo",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:d});c.push({width:"5%",field:"Operador",title:"Operador",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"5%",field:"CodMovimiento",title:"Arancel",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});var e=Core.Functions.grid.getHeaderAttribute(c.length);c.push({width:40,field:"",title:" ",headerAttributes:e,columnTemplate:function(f,g,h){if(g.Color){f.parent().css("background-color","rgba("+Core.Functions.grid.hexToRgb(g.Color)+((h%2==0)?", 0.6":", 1 ")+")")}if(g.AdvertenciaColor){var i=(g.length>140)?(g.AdvertenciaColor.substr(0,140)+"..."):(g.AdvertenciaColor);f.html('<button type="button" title="'+i+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-warning-sign"></span></button>');f.addClass("link-cell");f.on("click",function(){var j=new Core.Controls.Dialog("Advertencia",(g.AdvertenciaColor)?g.AdvertenciaColor:"",{displayButtons:{close:true,accept:false}});j.show()})}}});if(a.tipoTransferencias==Core.Business.eTipoTransferencias.Internacionales){c.push({width:40,field:"",title:" ",headerAttributes:e,columnTemplate:function(g,h,i){if(h.verArancelImportarVBolsa){var f=$('<button type="button" title="Aranceles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-chevron-right"></span></button>').appendTo(g);f.on("click",function(){var j=new Core.Ajax.ServerRequest({overlayElement:f,showOverlay:true,secureRequest:true,requestUrl:"transf-titulos/aranceles/importar-vbolsa",requestType:"PUT",requestData:{data:{idCuenta:h.idCuenta,idOrden:h.idOrden}}});j.onSuccess=function(k){a.loaded=false;a.loadGrid()};j.request()})}}})}c.push({width:40,field:"",title:" ",headerAttributes:e,columnTemplate:function(g,h,i){if(h.displayNameArchivo){var f=$('<button type="button" title="Ver Adjunto" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>').appendTo(g);f.on("click",function(){window.open((Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"documento/"+h.displayNameArchivo),"_blank")})}}});c.push({width:40,field:"",title:" ",headerAttributes:e,columnTemplate:function(g,h,i){if(h.verBotonDetalle){var f=$('<button type="button" title="Detalle" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(g);f.on("click",function(){new Core.Business.BaseTransfTitulos.Edit({orden:h,overlayElement:f,readOnly:true,idNegocio:a.idNegocio}).show()})}}});c.push({width:40,field:"",title:" ",headerAttributes:e,columnTemplate:function(g,h,i){if(h.verBotonEditar){var f=$('<button type="button" title="Editar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(g);f.on("click",function(){new Core.Business.BaseTransfTitulos.Edit({orden:h,overlayElement:f,onSuccess:function(){a.loaded=false;a.loadGrid()},idNegocio:a.idNegocio,readOnly:false}).show()})}}});c.push({width:40,field:"",title:" ",headerAttributes:e,columnTemplate:function(g,h,i){if(h.verBotonActualizarIdExterno){var f=$('<button type="button" title="Actualizar Id Externo" class="btn-sm balanz-button"><span class="glyphicon glyphicon-check"></span></button>').appendTo(g);f.on("click",function(){new Core.Controls.ActualizarIdExternoOrdenTesoreria({orden:h,onSuccess:function(){a.loaded=false;a.loadGrid()}}).show()})}}});c.push({width:40,field:"",title:" ",headerAttributes:e,columnTemplate:function(g,h,i){if(h.verBotonRechazar){var f=$('<button type="button" title="Eliminar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(g);f.on("click",function(){new Core.Controls.Prompt("Confirmación","¿Estás seguro que desea rechazar la orden de ID: "+h.idOrden+" ? Ingrese el motivo del rechazo:",{allowEmptyText:false,onAccepted:function(j){var k=new Core.Ajax.ServerRequest({overlayElement:f,showOverlay:true,secureRequest:true,requestUrl:"transf-titulos/orden",requestType:"PUT",requestData:{id:h.idOrden,idCuenta:h.idCuenta,idEstadoOrden:h.idEstadoRechazar,observacionesBackoffice:j,VersionActual:h.VersionActual}});k.onSuccess=function(l){a.loaded=false;a.loadGrid()};k.request()}}).show()})}}});c.push({width:40,field:"",title:" ",headerAttributes:e,columnTemplate:function(g,h,i){if(h.verAvanzarEstado){var f=$('<button type="button" title="Avanzar Estado" class="btn-sm balanz-button"><span class="glyphicon glyphicon-arrow-right"></span></button>').appendTo(g);f.on("click",function(){var j=new Core.Ajax.ServerRequest({overlayElement:f,showOverlay:true,secureRequest:true,requestUrl:"transf-titulos/orden",requestType:"PUT",requestData:{id:h.idOrden,idCuenta:h.idCuenta,idEstadoOrden:h.idEstadoAvanzar,VersionActual:h.VersionActual}});j.onSuccess=function(k){a.loaded=false;a.loadGrid()};j.request()})}}});c.push({width:40,field:"",title:" ",headerAttributes:e,columnTemplate:function(f,g,h){if(g.chk){$(g.chk).appendTo(f)}}});a.divTransferenciasTitulos.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:c,paging:{pageSize:100,pageLinksCount:10}});a.btnRefresh.on("click",function(){a.loaded=false;a.loadGrid()});a.chkVerTodas.on("change",function(){a.loaded=false;a.loadGrid()});a.btnDescargarTSA.hide();a.btnImportacionMasiva.hide();a.btnDescargarMovimdia.hide();a.btnFinalizarOrdenes.hide();if(a.pageOptions&&a.pageOptions.VerBotonesLiquidaciones){if(a.tipoTransferencias==Core.Business.eTipoTransferencias.Locales){a.btnDescargarTSA.show();a.btnDescargarTSA.on("click",function(){var f={ordenes:[]};a.divTransferenciasTitulos.swidget().dataSource.data.forEach(function(h,g){if(h.chk&&h.chk[0].checked){f.ordenes.push({idOrden:h.idOrden,idCuenta:h.idCuenta})}});if(f.ordenes.length==0){new Core.Controls.Dialog("Aviso","Debe seleccionar al menos una orden.",{displayButtons:{close:true,accept:false}}).show();return}Core.Functions.File.downloadWithData(a.btnDescargarTSA,Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"ordenesbackoffice/transferenciastitulos/archivotranstitulostsa",{Accept:"application/json","Content-Type":"application/json"},f,function(){})})}if(a.tipoTransferencias==Core.Business.eTipoTransferencias.Internacionales){a.btnImportacionMasiva.show();a.btnImportacionMasiva.click(function(){var f={ordenes:[]};a.divTransferenciasTitulos.swidget().dataSource.data.forEach(function(h,g){if(h.chk&&h.chk[0].checked){f.ordenes.push({idOrden:h.idOrden,idCuenta:h.idCuenta})}});if(f.ordenes.length==0){new Core.Controls.Dialog("Aviso","Debe seleccionar al menos una orden.",{displayButtons:{close:true,accept:false}}).show();return}new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea importar "+((f.ordenes.length>1)?("las "+f.ordenes.length+" ordenes seleccionados"):("la orden seleccionada"))+"?",{onAccepted:function(){var g=new Core.Ajax.ServerRequest({overlayElement:a.btnImportacionMasiva,showOverlay:true,secureRequest:true,requestUrl:"transf-titulos/aranceles/importar-vbolsa-masivo",requestType:"POST",requestData:f});g.onSuccess=function(h){new Core.Controls.ProcessProgress({idProcess:((h&&h.idProceso)?h.idProceso:0),overlayElement:a.divMain,onFinish:function(){a.loaded=false;a.loadGrid()}}).show()};g.request()}}).show()})}a.btnDescargarMovimdia.show();a.btnDescargarMovimdia.on("click",function(){var f={ordenes:[]};a.divTransferenciasTitulos.swidget().dataSource.data.forEach(function(h,g){if(h.chk&&h.chk[0].checked){f.ordenes.push({idOrden:h.idOrden,idCuenta:h.idCuenta})}});if(f.ordenes.length==0){new Core.Controls.Dialog("Aviso","Debe seleccionar al menos una orden.",{displayButtons:{close:true,accept:false}}).show();return}Core.Functions.File.downloadWithData(a.btnDescargarMovimdia,Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"transf-titulos/archivo-movimdia",{Accept:"application/json","Content-Type":"application/json"},f,function(){})});a.btnFinalizarOrdenes.show();a.btnFinalizarOrdenes.on("click",function(){var f=new Core.Ajax.ServerRequest({overlayElement:a.btnFinalizarOrdenes,showOverlay:true,secureRequest:true,requestUrl:("transf-titulos/finalizar-ordenes/"+a.tipoTransferencias+"/"+a.idNegocio),requestType:"POST"});f.onSuccess=function(g){new Core.Controls.ProcessProgress({idProcess:((g&&g.idProceso)?g.idProceso:0),overlayElement:a.divMain,onFinish:function(){a.loaded=false;a.loadGrid()}}).show()};f.request()})}a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var f=a.divTransferenciasTitulos.swidget().dataSource;if(value){f.filter={or:[{path:"Comitente",filter:"contains",value:value},{path:"NumComitenteContraparte",filter:"contains",value:value},{path:"Cuenta",filter:"contains",value:value},{path:"Ticker",filter:"contains",value:value}]}}else{f.filter=null}f.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,(a.namespace+".txtFilter"))};a.loadGrid=function(){var c=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,overlayElement:a.divMain,secureRequest:true,requestUrl:("ordenesbackoffice/transferenciastitulos/"+a.tipoTransferencias+"/"+(a.chkVerTodas[0].checked?"1":"0")+"/"+a.idNegocio),requestType:"GET"});c.onSuccess=function(d){a.data=d;var e=[];$.each(a.data.ordenes,function(f,g){if(g.verSeleccion){g.chk=$('<input type="checkbox" />')}if(e.indexOf(g.Estado)<0){e.push(g.Estado)}});e.sort(function(f,g){if(f>g){return 1}else{return -1}});a.divEstados.empty();e.forEach(function(h,f){var i=$.grep(a.data.ordenes,function(k,j){return k.Estado==h});var g=$("<label style='background-color: "+((a.estadosActivos[h]==false)?"transparent; ":"lightblue; ")+"margin: 8px 6px 8px 0; padding: 4px 5px; border: 1px solid #ccc;  font-weight: normal;' activo='"+((a.estadosActivos[h]==false)?"false":"true")+"' valor='"+h+"'>"+h+": <strong style='color: #333;'>"+i.length+"</strong></label>").appendTo(a.divEstados);if(a.estadosActivos[h]==null){a.estadosActivos[h]=true}g.on("click",function(){Core.Functions.DynamicFilter.setFilter(g,"lightblue","transparent",a.estadosActivos);a.refreshGrid()})});a.refreshGrid()};c.request()};a.refreshGrid=function(){var d=Core.Functions.DynamicFilter.getActiveFilters(a.estadosActivos);var c=$.grep(a.data.ordenes,function(h,g){return d.indexOf(h.Estado)>=0});var f=a.window.scrollTop();var e=a.divTransferenciasTitulos.swidget().initialOptions;e.dataSource.data=c;a.divTransferenciasTitulos.swidget().refresh(e);a.txtFilter.keydown();a.window.scrollTop(f);a.loaded=true}};Core.Business.BaseTransfTitulos.Edit=function(b){var a=this;a.divModal=$(".div-backoffice-transferencias-titulos-editar");a.overlayElement=null;a.onSuccess=function(){};a.orden=null;a.readOnly=true;a.idNegocio=Core.Enums.eNegocio.BCV;$.extend(true,a,b);a.show=function(){a.lblTitle=a.divModal.find(".lbl-title");a.lblTitle.text("Editar órden: "+a.orden.idOrden);a.divAlert=a.divModal.find(".div-alert");a.divAlert.slideUp();a.lblTipoTransferencia=a.divModal.find(".label-tipo-transferencia");a.lblTipoTransferencia.text(Core.Functions.grid.formatUndefinedString(a.orden.EmiRec));a.lblPaisContraparte=a.divModal.find(".label-pais-contraparte");a.lblPaisContraparte.text(Core.Functions.grid.formatUndefinedString(a.orden.PaisContraparte));a.divFechaConcertacionEditable=a.divModal.find(".div-fecha-concertacion-editable");var c=new Date();c.setDate(c.getDate()+1);a.txtFechaConcertacion=$(".date-fecha-concertacion");a.txtFechaConcertacion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:Core.Functions.Date.getDateByString(a.orden.FechaNegociacion)});Core.Functions.Validations.toggleValidation(a.txtFechaConcertacion,false);a.lblFechaConcertacion=a.divModal.find(".label-fecha-concertacion");a.lblFechaConcertacion.text(Core.Functions.grid.formatStringDateWithTime(a.orden.FechaNegociacion));a.divFechaConcertacionEditable.hide();a.lblFechaConcertacion.hide();if(a.readOnly){a.lblFechaConcertacion.show()}else{a.divFechaConcertacionEditable.show()}a.divPlazo=a.divModal.find(".div-plazo");a.divPlazoEditable=a.divModal.find(".div-plazo-editable");a.ddlPlazo=$(".dropdown-plazo");a.ddlPlazo.shieldDropDown({dataSource:{data:[]},textTemplate:"{texto}",valueTemplate:"{inicial}",value:a.orden.InmDif});Core.Functions.Validations.toggleValidation(a.ddlPlazo,false);a.lblPlazo=a.divModal.find(".label-plazo");a.lblPlazo.text(Core.Functions.grid.formatUndefinedString(a.orden.InmDif));a.divPlazo.hide();a.divPlazoEditable.hide();a.lblPlazo.hide();if(a.orden.PaisContraparte=="Argentina"){a.divPlazo.show();if(a.readOnly){a.lblPlazo.show()}else{a.divPlazoEditable.show()}}a.divFechaLiquidacionEditable=a.divModal.find(".div-fecha-liquidacion-editable");var c=new Date();c.setDate(c.getDate()+1);a.txtFechaLiquidacion=$(".date-fecha-liquidacion");a.txtFechaLiquidacion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:Core.Functions.Date.getDateByString(a.orden.FechaLiquidacion)});Core.Functions.Validations.toggleValidation(a.txtFechaLiquidacion,false);a.lblFechaLiquidacion=a.divModal.find(".label-fecha-liquidacion");a.lblFechaLiquidacion.text(Core.Functions.grid.formatStringDateWithTime(a.orden.FechaLiquidacion));a.divFechaLiquidacionEditable.hide();a.lblFechaLiquidacion.hide();if(a.readOnly){a.lblFechaLiquidacion.show()}else{a.divFechaLiquidacionEditable.show()}a.lblAgenteContraparte=a.divModal.find(".label-agente-contraparte");a.lblAgenteContraparte.text(Core.Functions.grid.formatUndefinedString(a.orden.AgenteContraparte));a.lblComitenteContraparte=a.divModal.find(".label-comitente-contraparte");a.lblComitenteContraparte.text(Core.Functions.grid.formatUndefinedIntegerNumber(a.orden.NumComitenteContraparte));a.lblDescripcionComitenteContraparte=a.divModal.find(".label-descripcion-comitente-contraparte");a.lblDescripcionComitenteContraparte.text(Core.Functions.grid.formatUndefinedString(a.orden.DescripcionContraparte));a.lblEmailContraparte=a.divModal.find(".label-email-contraparte");a.lblEmailContraparte.text(Core.Functions.grid.formatUndefinedString(a.orden.EmailContraparte));a.lblEspecie=a.divModal.find(".label-especie");a.lblEspecie.text(Core.Functions.grid.formatUndefinedString(a.orden.Ticker));a.lblCantidad=a.divModal.find(".label-cantidad");a.lblCantidad.text(Core.Functions.grid.formatUndefinedIntegerNumber(a.orden.Cantidad));a.lblObservaciones=a.divModal.find(".label-observaciones");a.lblObservaciones.text(Core.Functions.grid.formatUndefinedString(a.orden.observaciones));a.lblEstado=a.divModal.find(".label-estado");a.lblEstado.text(Core.Functions.grid.formatUndefinedString(a.orden.Estado));a.divSubEstadoEditable=a.divModal.find(".div-sub-estado-editable");a.ddlSubEstado=a.divModal.find(".dropdown-sub-estado");a.ddlSubEstado.shieldDropDown({dataSource:{data:[]},textTemplate:"{SubEstado}",valueTemplate:"{id}",value:a.orden.idSubEstadoOrden.toString()});Core.Functions.Validations.toggleValidation(a.ddlSubEstado,false);a.lblSubEstado=a.divModal.find(".label-sub-estado");a.lblSubEstado.text(Core.Functions.grid.formatUndefinedString(a.orden.SubEstadoOrden));a.divSubEstadoEditable.hide();a.lblSubEstado.hide();if(a.readOnly){a.lblSubEstado.show()}else{a.divSubEstadoEditable.show()}a.divEnteLiquidadorEditable=a.divModal.find(".div-ente-liquidador-editable");a.ddlEnteLiquidador=a.divModal.find(".dropdown-ente-liquidador");a.ddlEnteLiquidador.shieldDropDown({dataSource:{data:[]},textTemplate:"{ente}",valueTemplate:"{id}",value:a.orden.idEnteLiquidador.toString()});Core.Functions.Validations.toggleValidation(a.ddlEnteLiquidador,false);a.lblEnteLiquidador=a.divModal.find(".label-ente-liquidador");a.lblEnteLiquidador.text(Core.Functions.grid.formatUndefinedString(a.orden.enteLiquidador));a.divEnteLiquidadorEditable.hide();a.lblEnteLiquidador.hide();if(a.readOnly){a.lblEnteLiquidador.show()}else{a.divEnteLiquidadorEditable.show()}a.divObservacionesBackOfficeEditable=a.divModal.find(".div-observaciones-backoffice-editable");a.txtObservacionesBackOffice=$(".text-observaciones-backoffice");a.txtObservacionesBackOffice.shieldTextBox({value:a.orden.observacionesBackoffice});Core.Functions.Validations.toggleValidation(a.txtObservacionesBackOffice,false);a.lblObservacionesBackOffice=a.divModal.find(".label-observaciones-backoffice");a.lblObservacionesBackOffice.text(Core.Functions.grid.formatUndefinedString(a.orden.observacionesBackoffice));a.divObservacionesBackOfficeEditable.hide();a.lblObservacionesBackOffice.hide();if(a.readOnly){a.lblObservacionesBackOffice.show()}else{a.divObservacionesBackOfficeEditable.show()}a.btnConfirmar=a.divModal.find(".btn-confirmar");a.btnConfirmar.unbind("click");a.btnConfirmar.hide();if(!a.readOnly){a.btnConfirmar.show();a.btnConfirmar.click(function(){a.save()})}a.btnConfirmarYAvanzar=a.divModal.find(".btn-confirmar-y-avanzar");a.btnConfirmarYAvanzar.unbind("click");a.btnConfirmarYAvanzar.hide();if(!a.readOnly&&a.orden.verAvanzarEstado){a.btnConfirmarYAvanzar.show();a.btnConfirmarYAvanzar.click(function(){a.save(a.orden.idEstadoAvanzar)})}if(a.readOnly){d()}else{a.loadControls(function(){d()})}function d(){a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.divModal.modal({show:true})}};a.loadControls=function(c){var d=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,showOverlay:true,secureRequest:true,requestUrl:"transf-titulos/sub-estados",requestType:"GET"});d.onSuccess=function(f){var e=a.ddlSubEstado.swidget().initialOptions;e.dataSource.data=((f&&f.subestados)?f.subestados:[]);a.ddlSubEstado.swidget().refresh(e);var g=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,showOverlay:true,secureRequest:true,requestUrl:("transf-titulos/ente-liquidador/"+a.idNegocio+"/"+a.orden.CodAgente),requestType:"GET"});g.onSuccess=function(j){var h=(j&&j["entes-liquidadores"])?j["entes-liquidadores"]:[];h.unshift({id:0,ente:"Sin Asignar"});var i=a.ddlEnteLiquidador.swidget().initialOptions;i.dataSource.data=h;a.ddlEnteLiquidador.swidget().refresh(i);var k=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,showOverlay:true,secureRequest:true,requestUrl:"transf-titulos/inmediata-diferida",requestType:"GET"});k.onSuccess=function(m){var l=a.ddlPlazo.swidget().initialOptions;l.dataSource.data=(m.plazo?m.plazo:[]);a.ddlPlazo.swidget().refresh(l);c()};k.request()};g.request()};d.request()};a.save=function(c){Core.Functions.Validations.toggleValidation(a.ddlSubEstado,false);Core.Functions.Validations.toggleValidation(a.ddlEnteLiquidador,false);Core.Functions.Validations.toggleValidation(a.txtObservacionesBackOffice,false);Core.Functions.Validations.toggleValidation(a.txtFechaLiquidacion,false);Core.Functions.Validations.toggleValidation(a.txtFechaConcertacion,false);Core.Functions.Validations.toggleValidation(a.ddlPlazo,false);a.divAlert.slideUp();var f={value:true};var d={id:a.orden.idOrden,idCuenta:a.orden.idCuenta,idExterno:a.orden.idExterno,VersionActual:a.orden.VersionActual,idSubEstadoOrden:Core.Functions.Validations.getValidatedDropDownValue(a.ddlSubEstado,f),idEnteLiquidador:Core.Functions.Validations.getValidatedDropDownValue(a.ddlEnteLiquidador,f),InmDif:Core.Functions.Validations.getValidatedDropDownValue(a.ddlPlazo,f),observacionesBackoffice:a.txtObservacionesBackOffice.swidget().value()};if(c){d.idEstadoOrden=c}d.FechaNegociacion=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaConcertacion,f));d.FechaLiquidacion=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaLiquidacion,f));if(d.FechaLiquidacion<d.FechaNegociacion){f.value=false;Core.Functions.Validations.toggleValidation(a.txtFechaLiquidacion,true);a.divAlert.text("La fecha de liquidación no debe ser menor a la fecha de concertación.");a.divAlert.slideDown()}if(f.value){var e=new Core.Ajax.ServerRequest({overlayElement:a.divModal,requestType:"PUT",requestUrl:"transf-titulos/orden",requestData:d});e.onSuccess=function(g){a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){if(g&&g.Descripcion){new Core.Controls.Dialog("Mensaje",g.Descripcion,{displayButtons:{close:true,accept:false}}).show()}a.onSuccess();a.destroy()});a.divModal.modal("hide")};e.request()}};a.destroy=function(){a.ddlPlazo.swidget().destroy();a.txtFechaLiquidacion.swidget().destroy();a.txtFechaConcertacion.swidget().destroy();a.ddlSubEstado.swidget().destroy();a.ddlEnteLiquidador.swidget().destroy();a.txtObservacionesBackOffice.swidget().destroy()}};Core.Business.UnificarCuentas=new function(){var a=this;a.idDefaultAccount=null;a.idDefaultProfile=null;a.id="homeUnificarCuentas";a.txtComitente=null;a.txtCuotapartista=null;a.btnBuscar=null;a.divContainerCondominiosComitente=null;a.divContainerCondominiosCuotapartista=null;a.divCondominiosComitente=null;a.divCondominiosCuotapartista=null;a.pageOptions=null;a.divAdvertencia=null;a.lblAdvertencia=null;a.divAcciones=null;a.chkUnificarCuentas=null;a.btnUnificarCuentas=null;a.init=function(b,c){Core.loadPage("backoffice-unificar-cuentas.html",function(){document.title="Unificar Cuentas";a.idDefaultAccount=b;a.idDefaultProfile=c;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.txtComitente=$(".textbox-comitente");a.txtCuotapartista=$(".textbox-cuotapartista");a.btnBuscar=$(".btn-buscar");a.divCondominiosComitente=$(".div-condominios-comitente");a.divCondominiosCuotapartista=$(".div-condominios-cuotapartista");a.divContainerCondominiosComitente=$(".div-container-condominios-comitente");a.divContainerCondominiosCuotapartista=$(".div-container-condominios-cuotapartista");a.divAperturas=$(".div-aperturas");a.divContainerAperturas=$(".div-container-aperturas");a.divAdvertencia=$(".div-advertencia");a.lblAdvertencia=$(".lbl-advertencia");a.divAcciones=$(".div-acciones");a.chkUnificarCuentas=$(".checkbox-unificar-cuentas");a.btnUnificarCuentas=$(".btn-unificar-cuentas");a.initGrid();a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){},"Core.Business.UnificarCuentas")})};a.initControls=function(){a.btnBuscar.on("click",function(){a.loadGrids()});a.txtComitente.shieldNumericTextBox({min:0,max:999999,step:1});a.txtCuotapartista.shieldNumericTextBox({min:0,max:999999,step:1});a.chkUnificarCuentas.shieldCheckBox({label:"Autorizar Unificación.",checked:false,events:{click:function(b){if(a.chkUnificarCuentas.swidget().checked()){a.btnUnificarCuentas.show()}else{a.btnUnificarCuentas.hide()}}}});a.btnUnificarCuentas.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea unificar las cuentas (Comitente: "+a.data.Datos[0].NumComitente+" Cuotapartista: "+a.data.Datos[0].NumCuotapartista+")?",{onAccepted:function(){var b={data:{}};b.data.NumComitente=a.data.Datos[0].NumComitente;b.data.NumCuotapartista=a.data.Datos[0].NumCuotapartista;b.data.AutorizarUnificacionForzada=((a.chkUnificarCuentas.swidget().visible()&&a.chkUnificarCuentas.swidget().checked())?1:0);a.divAperturas.swidget().dataSource.data.forEach(function(e,d){if(e.chk[0].checked){b.data.idApertura=e.idApertura}});var c=new Core.Ajax.ServerRequest({overlayElement:a.btnUnificarCuentas,secureRequest:true,requestUrl:"/unificarcuentas/unificar",requestType:"POST",requestData:b});c.onSuccess=function(d){a.divContainerCondominiosComitente.hide();a.divContainerCondominiosCuotapartista.hide();a.divContainerAperturas.hide();a.divAdvertencia.hide();a.divAcciones.hide();a.txtCuotapartista.swidget().value("");a.txtComitente.swidget().value("");a.chkUnificarCuentas.swidget().checked(false);var e=new Core.Controls.Dialog("Aviso","Las cuentas fueron unificadas con éxito.",{displayButtons:{close:true,accept:false}});e.show()};c.request()}}).show()});a.divAcciones.hide()};a.initGrid=function(){a.divContainerCondominiosComitente.hide();a.divCondominiosComitente.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,events:{detailCreated:a.detailCreatedComitente},columns:[{width:"10%",field:"NumComitente",title:"Comitente",headerAttributes:Core.Functions.grid.getCellEvenClass(),attributes:Core.Functions.grid.getRightAlignedColumnClass()},{width:"40%",field:"DescripcionComitente",title:"Descripción",headerAttributes:Core.Functions.grid.getCellOddClass(),attributes:Core.Functions.grid.getLeftAlignedColumnClass()},{width:"20%",field:"CUITComitente",title:"CUIT",headerAttributes:Core.Functions.grid.getCellEvenClass(),attributes:Core.Functions.grid.getRightAlignedColumnClass()},{width:"10%",field:"FechaIngresoComitente",title:"Fecha Ingreso",headerAttributes:Core.Functions.grid.getCellOddClass(),attributes:Core.Functions.grid.getLeftAlignedColumnClass()},{width:"20%",field:"AsesorComitente",title:"Asesor",headerAttributes:Core.Functions.grid.getCellEvenClass(),attributes:Core.Functions.grid.getLeftAlignedColumnClass()}]});a.divContainerCondominiosCuotapartista.hide();a.divCondominiosCuotapartista.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,events:{detailCreated:a.detailCreatedCuotapartista},columns:[{width:"10%",field:"NumCuotapartista",title:"Cuotapartista",headerAttributes:Core.Functions.grid.getCellEvenClass(),attributes:Core.Functions.grid.getRightAlignedColumnClass()},{width:"40%",field:"DescripcionCuotapartista",title:"Descripción",headerAttributes:Core.Functions.grid.getCellOddClass(),attributes:Core.Functions.grid.getLeftAlignedColumnClass()},{width:"20%",field:"CUITCuotapartista",title:"CUIT",headerAttributes:Core.Functions.grid.getCellEvenClass(),attributes:Core.Functions.grid.getRightAlignedColumnClass()},{width:"10%",field:"FechaIngresoCuotapartista",title:"Fecha Ingreso",headerAttributes:Core.Functions.grid.getCellOddClass(),attributes:Core.Functions.grid.getLeftAlignedColumnClass()},{width:"20%",field:"AsesorCuotapartista",title:"Asesor",headerAttributes:Core.Functions.grid.getCellEvenClass(),attributes:Core.Functions.grid.getLeftAlignedColumnClass()}]});a.divContainerAperturas.hide();a.divAperturas.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:[{title:" ",field:"",width:40,filterable:false,headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(b,d,c){if(d.chk){$(d.chk).appendTo(b)}}},{width:"20%",field:"Cuenta",title:"Cuenta",headerAttributes:Core.Functions.grid.getCellEvenClass(),attributes:Core.Functions.grid.getLeftAlignedColumnClass()},{width:"10%",field:"Numero",title:"Número",headerAttributes:Core.Functions.grid.getCellOddClass(),attributes:Core.Functions.grid.getRightAlignedColumnClass()},{width:"20%",field:"idApertura",title:"Id Legajo",headerAttributes:Core.Functions.grid.getCellEvenClass(),attributes:Core.Functions.grid.getRightAlignedColumnClass()},{width:"10%",field:"Version",title:"Versión",headerAttributes:Core.Functions.grid.getCellOddClass(),attributes:Core.Functions.grid.getRightAlignedColumnClass()},{width:"20%",field:"UltimaActualizacion",title:"Ultima Actualización",headerAttributes:Core.Functions.grid.getCellEvenClass(),attributes:Core.Functions.grid.getLeftAlignedColumnClass()},{width:"20%",field:"TipoLegajo",title:"Tipo Legajo",headerAttributes:Core.Functions.grid.getCellOddClass(),attributes:Core.Functions.grid.getLeftAlignedColumnClass()}]})};a.loadGrids=function(){if(a.txtComitente.swidget().value()&&a.txtCuotapartista.swidget().value()){var c=new Core.Ajax.ServerRequest({overlayElement:a.btnBuscar,secureRequest:true,requestUrl:"unificarcuentas/obtenerdata?NumComitente="+a.txtComitente.swidget().value()+"&NumCuotapartista="+a.txtCuotapartista.swidget().value(),requestType:"GET"});c.onSuccess=function(e){a.data=e;a.divContainerCondominiosComitente.hide();a.divContainerCondominiosCuotapartista.hide();a.divContainerAperturas.hide();a.divAdvertencia.hide();a.divAcciones.hide();a.chkUnificarCuentas.swidget().visible(false);a.chkUnificarCuentas.swidget().checked(false);a.btnUnificarCuentas.hide();if(!a.data.Datos||!a.data.Datos[0]||a.data.Datos[0].Error){var l=(a.data.Datos&&a.data.Datos[0])?a.data.Datos[0].Error:"Ha ocurrido un error intente nuevamente.";var f=new Core.Controls.Dialog("Aviso",l,{displayButtons:{close:true,accept:false}});f.show();return}a.divAcciones.show();if(a.data.Datos[0].Advertencia){a.lblAdvertencia.text(a.data.Datos[0].Advertencia);if(a.pageOptions.UnificarCuentasForzadas){a.chkUnificarCuentas.swidget().visible(true)}a.divAdvertencia.show();a.btnUnificarCuentas.hide()}else{a.divAdvertencia.hide();a.btnUnificarCuentas.show()}a.divContainerCondominiosComitente.show();a.divContainerCondominiosCuotapartista.show();a.divContainerAperturas.show();var j=a.divCondominiosComitente.swidget().initialOptions;j.dataSource.data=a.data.Datos;j.events.detailCreated=a.detailCreatedComitente;a.divCondominiosComitente.swidget().refresh(j);var k=a.divCondominiosCuotapartista.swidget().initialOptions;k.dataSource.data=a.data.Datos;k.events.detailCreated=a.detailCreatedCuotapartista;a.divCondominiosCuotapartista.swidget().refresh(k);for(var g=0;g<a.divCondominiosComitente.swidget().contentTable[0].rows.length;g++){var m=a.divCondominiosComitente.swidget().contentTable[0].rows[g];var d=$(m.cells[0]);d.click()}for(var g=0;g<a.divCondominiosCuotapartista.swidget().contentTable[0].rows.length;g++){var m=a.divCondominiosCuotapartista.swidget().contentTable[0].rows[g];var d=$(m.cells[0]);d.click()}a.data.Aperturas.forEach(function(n,i){n.chk=$('<input type="checkbox" '+(n.Seleccionado?"checked":"")+"/>");n.chk.on("change",function(){a.divAperturas.swidget().dataSource.data.forEach(function(p,o){p.chk[0].checked=false});$(this)[0].checked=true})});var h=a.divAperturas.swidget().initialOptions;h.dataSource.data=a.data.Aperturas;a.divAperturas.swidget().refresh(h)};c.request()}else{var b=new Core.Controls.Dialog("Aviso","Debe ingresar un valor para Comitente y uno para Cuotapartista.",{displayButtons:{close:true,accept:false}});b.show()}};a.detailCreatedComitente=function(b){$("<div class='grid-details'/>").appendTo(b.detailCell).shieldGrid({dataSource:{data:a.data.CondominiosComitente},selection:false,rowHover:false,columns:[{width:"5%",field:"Orden",title:"Orden",headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"19%",field:"Nombre",title:"Nombre Persona",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"19%",field:"TipoDocumento",title:"Tipo Documento",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"19%",field:"NumDocumento",title:"Documento",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"19%",field:"CUIT_CUIL",title:"CUIL / CUIT",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"19%",field:"Tipo",title:"Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()}]})};a.detailCreatedCuotapartista=function(b){$("<div class='grid-details'/>").appendTo(b.detailCell).shieldGrid({dataSource:{data:a.data.CondominiosCuotapartista},selection:false,rowHover:false,columns:[{width:"5%",field:"Orden",title:"Orden",headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"19%",field:"NombrePersona",title:"Nombre Persona",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"19%",field:"TipoDocumento",title:"Tipo Documento",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"19%",field:"NumDocumento",title:"Documento",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"19%",field:"CUIT_CUIL",title:"CUIL / CUIT",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"19%",field:"Tipo",title:"Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()}]})}};Core.Business.VisibilidadCuentas=new function(){var a=this;a.id="visibilidadCuentas";a.idDefaultAccount=null;a.idDefaultProfile=null;a.ddlAsesor=null;a.lblUnidadNegocioAsesor=null;a.lblEquipoAsesor=null;a.btnNuevaVisibilidad=null;a.btnVerCuentas=null;a.divCuentasContainer=null;a.divCuentas=null;a.init=function(b,c){Core.loadPage("backoffice-visibilidad-cuentas.html",function(){document.title="Visibilidad Cuentas";a.idDefaultAccount=b;a.idDefaultProfile=c;a.ddlAsesor=$(".dropdown-asesor");a.lblUnidadNegocioAsesor=$(".div-unidad-negocio-asesor");a.lblEquipoAsesor=$(".div-equipo-asesor");a.btnNuevaVisibilidad=$(".btn-nueva-visibilidad");a.btnVerCuentas=$(".btn-ver-cuentas");a.divCuentasContainer=$(".div-cuentas-container");a.divCuentas=$(".div-cuentas");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadControls()},"Core.Business.VisibilidadCuentas")})};a.initControls=function(){a.ddlAsesor.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idPersona}",textTemplate:"{NombreMostrar}",autoComplete:{enabled:true,filter:{or:[{path:"NombreMostrar",filter:"contains",value:""}]}},events:{select:function(b){a.loadCuentas()}}});a.btnNuevaVisibilidad.hide();a.btnNuevaVisibilidad.on("click",function(){new Core.Business.VisibilidadCuentas.ManagerVisibilidad({idAsesor:a.ddlAsesor.swidget().value(),onSave:function(){a.loadCuentas()}}).show()});a.btnVerCuentas.hide();a.btnVerCuentas.on("click",function(){new Core.Business.VisibilidadCuentas.VerCuentas({overlayElement:a.btnVerCuentas,idPersona:a.ddlAsesor.swidget().value()}).show()});a.divCuentasContainer.hide();a.divCuentas.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:50,pageLinksCount:10},noRecordsText:"No se encontraron cuentas",columns:[{width:"20%",field:"Tipo",title:"Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"50%",field:"Nombre",title:"Valor",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"10%",field:"Visible",title:"Visible",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatBoolean},{width:"10%",field:"Operar",title:"Operar",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatBoolean},{width:"10%",field:"Comisiones",title:"Comisiones",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatBoolean},{width:"10%",field:"Asesores",title:"Ve Asesores",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatBoolean},{title:" ",width:150,headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,g){var c=$('<button type="button" title="Detalles de cuentas" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(e);c.on("click",function(){new Core.Business.VisibilidadCuentas.VerCuentas({overlayElement:c,visibilidad:f}).show()});var d=$('<button type="button" title="Editar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(e);d.on("click",function(){new Core.Business.VisibilidadCuentas.ManagerVisibilidad({visibilidad:f,idAsesor:a.ddlAsesor.swidget().value(),onSave:function(){a.loadCuentas()}}).show()});var b=$('<button type="button" title="Eliminar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(e);b.on("click",function(){new Core.Controls.Prompt("Eliminar Visibilidad","Ingrese un comentario",{allowEmptyText:true,onAccepted:function(h){var i={};i.idPersona=f.idPersona;i.idUnidadDeNegocio=f.idUnidadDeNegocio;i.idEquipo=f.idEquipo;i.idPersonaAsesor=f.idPersonaAsesor;i.idCuenta=f.idCuenta;i.comentario=h;var j=new Core.Ajax.ServerRequest({overlayElement:d,secureRequest:true,requestUrl:"visibilidadCuentas/eliminarVisibilidad",requestType:"POST",requestData:i});j.onSuccess=function(k){a.loadCuentas()};j.request()}}).show()})}}]})};a.loadControls=function(){var b=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"visibilidadCuentas/obtenerAsesores",requestType:"GET"});b.onSuccess=function(c){var d=a.ddlAsesor.swidget().initialOptions;d.dataSource.data=c.asesores;a.ddlAsesor.swidget().refresh(d)};b.request()};a.loadCuentas=function(){if(a.ddlAsesor.swidget().selectedItem()&&a.ddlAsesor.swidget().value()){var b=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"visibilidadCuentas/visibilidadDeCuentas/"+encodeURIComponent(a.ddlAsesor.swidget().value()),requestType:"GET"});b.onSuccess=function(c){var d=a.divCuentas.swidget().initialOptions;d.dataSource.data=c.visibilidadcuentas;a.divCuentas.swidget().refresh(d);a.divCuentasContainer.show();a.btnVerCuentas.show();a.btnNuevaVisibilidad.show();a.lblUnidadNegocioAsesor.html("<strong>Unidad de Negocio:</strong> "+a.ddlAsesor.swidget().selectedItem().UnidadesDeNegocio);a.lblEquipoAsesor.html("<strong>Equipo:</strong> "+a.ddlAsesor.swidget().selectedItem().Equipo)};b.request()}else{a.lblUnidadNegocioAsesor.html("");a.lblEquipoAsesor.html("");a.btnVerCuentas.hide();a.btnNuevaVisibilidad.hide();a.divCuentasContainer.hide()}}};Core.Business.VisibilidadCuentas.ManagerVisibilidad=function(b){var a=this;a.divModal=$(".modal-manager-visibilidad");a.divVisibilidadSobre=null;a.ddlVisibilidadSobre=null;a.divOptions=null;a.lblOptions=null;a.ddlOptions=null;a.divBuscarCuenta=null;a.btnBuscarCuentas=null;a.lblDescripcionCuentaSeleccionada=null;a.idCuentaSeleccionada=null;a.chkVisible=null;a.chkOperar=null;a.chkComisiones=null;a.chkVerAsesores=null;a.chkCuentasLocales=null;a.chkCuentasInternacionales=null;a.btnGuardar=null;a.divVisibilidadTipo=null;a.divVisibilidadValor=null;a.visibilidad=null;a.idAsesor=null;a.eVisibilidadSobre={Todos:1,UnidadDeNegocio:2,Equipo:3,Asesor:4,Cuenta:5};a.onSave=function(){};$.extend(true,a,b);a.show=function(){a.initControls();a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.divModal.modal({show:true})};a.initControls=function(){a.divVisibilidadSobre=a.divModal.find(".div-dropdown-visibilidad-sobre");if(a.visibilidad){a.divVisibilidadSobre.hide()}else{a.divVisibilidadSobre.show()}a.ddlVisibilidadSobre=a.divModal.find(".dropdown-visibilidad-sobre");a.ddlVisibilidadSobre.shieldDropDown({dataSource:{data:[{ID:a.eVisibilidadSobre.Todos,Description:"Todos"},{ID:a.eVisibilidadSobre.UnidadDeNegocio,Description:"Unidad de Negocio"},{ID:a.eVisibilidadSobre.Equipo,Description:"Equipo"},{ID:a.eVisibilidadSobre.Asesor,Description:"Asesor"},{ID:a.eVisibilidadSobre.Cuenta,Description:"Cuenta"}]},valueTemplate:"{ID}",textTemplate:"{Description}",events:{select:function(c){a.divOptions.hide();a.divBuscarCuenta.hide();a.lblOptions.text(a.ddlVisibilidadSobre.swidget().selectedItem().Description);if(a.ddlVisibilidadSobre.swidget().value()==a.eVisibilidadSobre.UnidadDeNegocio){a.loadOptionsUnidadesDeNegocio()}else{if(a.ddlVisibilidadSobre.swidget().value()==a.eVisibilidadSobre.Equipo){a.loadOptionsEquipos()}else{if(a.ddlVisibilidadSobre.swidget().value()==a.eVisibilidadSobre.Asesor){a.loadOptionsAsesores()}else{if(a.ddlVisibilidadSobre.swidget().value()==a.eVisibilidadSobre.Cuenta){a.loadOptionsCuentas()}}}}}},value:a.eVisibilidadSobre.Todos.toString()});a.divOptions=a.divModal.find(".div-dropdown-options");a.divOptions.hide();a.lblOptions=a.divModal.find(".lbl-options");a.ddlOptions=a.divModal.find(".dropdown-options");a.ddlOptions.shieldComboBox({dataSource:{data:[]},autoComplete:{enabled:true,filter:{or:[{path:"NombreMostrar",filter:"contains",value:""},{path:"Descripcion",filter:"contains",value:""}]}}});a.btnBuscarCuentas=a.divModal.find(".button-buscar-cuentas");a.btnBuscarCuentas.unbind("click");a.btnBuscarCuentas.click(function(){new Core.Business.VisibilidadCuentas.BuscarCuentas({onSelected:function(c){a.idCuentaSeleccionada=c.idCuenta;a.lblDescripcionCuentaSeleccionada.text(c.Descripcion)}}).show()});a.divBuscarCuenta=a.divModal.find(".div-buscar-cuenta");a.divBuscarCuenta.hide();a.lblDescripcionCuentaSeleccionada=a.divModal.find(".lbl-cuenta-descripcion");a.lblDescripcionCuentaSeleccionada.text("");a.idCuentaSeleccionada=null;a.chkVisible=a.divModal.find(".checkbox-visible");a.chkVisible[0].checked=((a.visibilidad)?a.visibilidad.Visible:true);a.chkOperar=a.divModal.find(".checkbox-operar");a.chkOperar[0].checked=((a.visibilidad)?a.visibilidad.Operar:false);a.chkComisiones=a.divModal.find(".checkbox-comisiones");a.chkComisiones[0].checked=((a.visibilidad)?a.visibilidad.Comisiones:false);a.chkVerAsesores=a.divModal.find(".checkbox-ver-asesores");a.chkVerAsesores[0].checked=((a.visibilidad)?a.visibilidad.Asesores:false);a.chkCuentasLocales=a.divModal.find(".checkbox-cuentas-locales");a.chkCuentasLocales[0].checked=((a.visibilidad)?a.visibilidad.AR:false);a.chkCuentasInternacionales=a.divModal.find(".checkbox-cuentas-internacionales");a.chkCuentasInternacionales[0].checked=((a.visibilidad)?a.visibilidad.PA:false);a.divVisibilidadTipo=a.divModal.find(".div-visibilidad-tipo");a.divVisibilidadValor=a.divModal.find(".div-visibilidad-valor");a.divVisibilidadTipo.hide();a.divVisibilidadValor.hide();a.divVisibilidadComentario=a.divModal.find(".div-visibilidad-comentario");a.txtVisibilidadComentario=a.divModal.find(".text-visibilidad-comentario");a.txtVisibilidadComentario.shieldTextBox({});a.txtVisibilidadComentario.swidget().value("");if(a.visibilidad){if(a.visibilidad.Tipo){a.divVisibilidadTipo.html("<strong>Tipo: </strong>"+Core.Functions.grid.formatUndefinedString(a.visibilidad.Tipo));a.divVisibilidadTipo.show()}if(a.visibilidad.Nombre){a.divVisibilidadValor.html("<strong>Valor: </strong>"+Core.Functions.grid.formatUndefinedString(a.visibilidad.Nombre));a.divVisibilidadValor.show()}}a.btnGuardar=a.divModal.find(".btn-guardar");a.btnGuardar.unbind("click");a.btnGuardar.on("click",function(){Core.Functions.Validations.toggleValidation(a.ddlOptions,false);if((a.ddlVisibilidadSobre.swidget().value()==a.eVisibilidadSobre.Asesor||a.ddlVisibilidadSobre.swidget().value()==a.eVisibilidadSobre.Equipo||a.ddlVisibilidadSobre.swidget().value()==a.eVisibilidadSobre.UnidadDeNegocio)&&!a.ddlOptions.swidget().selectedItem()){Core.Functions.Validations.toggleValidation(a.ddlOptions,true);return}if(a.ddlVisibilidadSobre.swidget().value()==a.eVisibilidadSobre.Cuenta&&!a.idCuentaSeleccionada){new Core.Controls.Dialog("Aviso","Debe seleccionar una cuenta.",{displayButtons:{close:true,accept:false}}).show();return}var c={};c.idPersona=a.idAsesor;c.idUnidadDeNegocio=((a.visibilidad)?a.visibilidad.idUnidadDeNegocio:((a.ddlVisibilidadSobre.swidget().value()!=a.eVisibilidadSobre.UnidadDeNegocio)?0:a.ddlOptions.swidget().value()));c.idEquipo=((a.visibilidad)?a.visibilidad.idEquipo:((a.ddlVisibilidadSobre.swidget().value()==a.eVisibilidadSobre.Todos)?-1:((a.ddlVisibilidadSobre.swidget().value()!=a.eVisibilidadSobre.Equipo)?0:a.ddlOptions.swidget().value())));c.idPersonaAsesor=((a.visibilidad)?a.visibilidad.idPersonaAsesor:((a.ddlVisibilidadSobre.swidget().value()!=a.eVisibilidadSobre.Asesor)?0:a.ddlOptions.swidget().value()));c.idCuenta=((a.visibilidad)?a.visibilidad.idCuenta:((a.ddlVisibilidadSobre.swidget().value()!=a.eVisibilidadSobre.Cuenta)?0:a.idCuentaSeleccionada));c.visible=(a.chkVisible[0].checked?1:0);c.operar=(a.chkOperar[0].checked?1:0);c.comisiones=(a.chkComisiones[0].checked?1:0);c.veasesores=(a.chkVerAsesores[0].checked?1:0);c.cuentasloc=(a.chkCuentasLocales[0].checked?1:0);c.cuentasint=(a.chkCuentasInternacionales[0].checked?1:0);c.comentario=a.txtVisibilidadComentario.swidget().value();var d=new Core.Ajax.ServerRequest({overlayElement:a.btnGuardar,secureRequest:true,requestUrl:"visibilidadCuentas/ActualizarVisibilidad",requestType:"POST",requestData:c});d.onSuccess=function(e){a.onSave();a.divModal.modal("hide")};d.request()})};a.loadOptionsUnidadesDeNegocio=function(){var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"visibilidadCuentas/unidadesDeNegocio",requestType:"GET"});c.onSuccess=function(d){var e=a.ddlOptions.swidget().initialOptions;e.dataSource.data=d.unidadesDeNegocio;e.valueTemplate="{idUnidadDeNegocio}";e.textTemplate="{Descripcion}";e.enabled=true;e.value="";a.ddlOptions.swidget().refresh(e);a.divOptions.show()};c.request()};a.loadOptionsEquipos=function(){var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"visibilidadCuentas/equipos",requestType:"GET"});c.onSuccess=function(d){var e=a.ddlOptions.swidget().initialOptions;e.dataSource.data=d.equipos;e.valueTemplate="{idEquipo}";e.textTemplate="{Descripcion}";e.enabled=true;e.value="";a.ddlOptions.swidget().refresh(e);a.divOptions.show()};c.request()};a.loadOptionsAsesores=function(){var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"visibilidadCuentas/obtenerAsesores",requestType:"GET"});c.onSuccess=function(d){var e=a.ddlOptions.swidget().initialOptions;e.dataSource.data=d.asesores;e.valueTemplate="{idPersona}";e.textTemplate="{NombreMostrar}";e.enabled=true;e.value="";a.ddlOptions.swidget().refresh(e);a.divOptions.show()};c.request()};a.loadOptionsCuentas=function(){a.divBuscarCuenta.show()};a.destroy=function(){a.ddlVisibilidadSobre.swidget().destroy();a.ddlOptions.swidget().destroy();a.txtVisibilidadComentario.swidget().destroy()}};Core.Business.VisibilidadCuentas.BuscarCuentas=function(b){var a=this;a.divModal=$(".modal-buscar-cuentas");a.divGridCuentas=null;a.onSelected=function(){};$.extend(true,a,b);a.show=function(){a.divGridCuentas=a.divModal.find(".div-cuentas-options");a.txtFilter=a.divModal.find(".textbox-filter-cuentas");a.initControls();a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.txtFilter.swidget().focus(true);a.divModal.modal({show:true})};a.initControls=function(){a.divGridCuentas.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:[{field:"Comitente",width:"15%",title:"Comitente",headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"Cuotapartista",width:"15%",title:"Cuotapartista",headerAttributes:Core.Functions.grid.getCellOddClass()},{field:"Descripcion",width:"60%",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"",title:" ",width:"10%",headerAttributes:Core.Functions.grid.getCellOddClass(),buttons:[{caption:"Seleccionar",cls:"",commandName:"Seleccionar",click:function(d){var c=a.divGridCuentas.swidget().dataItem(d);a.onSelected(c);a.divModal.modal("hide")}}]}]});a.txtFilter.shieldTextBox({value:"",events:{blur:function(){a.loadGrid()}}})};a.loadGrid=function(){if(a.txtFilter.val()){var c=new Core.Ajax.ServerRequest({showOverlay:false,secureRequest:true,requestUrl:"visibilidadCuentas/cuentas/"+a.txtFilter.val(),requestType:"GET"});c.onSuccess=function(f){var d=f.cuentas==null?[]:f.cuentas;var e=a.divGridCuentas.swidget().initialOptions;e.dataSource.data=d;a.divGridCuentas.swidget().refresh(e)};c.request()}};a.destroy=function(){a.divGridCuentas.swidget().destroy();a.txtFilter.swidget().destroy()}};Core.Business.VisibilidadCuentas.VerCuentas=function(b){var a=this;a.divModal=$(".modal-ver-cuentas");a.divGridCuentas=null;a.txtFilter=null;a.idPersona=null;a.visibilidad=null;a.overlayElement=null;a.timeout=null;$.extend(true,a,b);a.show=function(){a.divGridCuentas=a.divModal.find(".div-cuentas-detalles");a.txtFilter=a.divModal.find(".textbox-filter-cuentas");a.initControls();a.loadGrid();a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()})};a.initControls=function(){var d=["Descripcion","Comitente","Cuotapartista","CUIT","Asesor","Equipo","UnidadDeNegocio"];var c=[{width:"19%",field:"Descripcion",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"8%",field:"Comitente",title:"Comitente",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"8%",field:"Cuotapartista",title:"Cuotapartista",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"12%",field:"CUIT",title:"CUIT",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"19%",field:"Asesor",title:"Asesor",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"10%",field:"Equipo",title:"Equipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"10%",field:"UnidadDeNegocio",title:"Unidad de Negocio",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString}];if(a.idPersona){d.push("Ver");d.push("Operar");d.push("Comisiones");d.push("Relacion");c.push({width:"6%",field:"Ver",title:"Ver",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatBoolean});c.push({width:"6%",field:"Operar",title:"Operar",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatBoolean});c.push({width:"6%",field:"Comisiones",title:"Comisiones",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatBoolean});c.push({width:"8%",field:"Relacion",title:"Relación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString})}a.divGridCuentas.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,paging:{pageSize:50,pageLinksCount:10},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Cuentas",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:d,header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Cuentas"}}},columns:c});a.divModal.unbind("keydown");a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var e=a.divGridCuentas.swidget().dataSource;if(value){e.filter={or:[{path:"Descripcion",filter:"contains",value:value},{path:"Comitente",filter:"contains",value:value},{path:"Cuotapartista",filter:"contains",value:value},{path:"CUIT",filter:"contains",value:value},{path:"Asesor",filter:"contains",value:value},{path:"Equipo",filter:"contains",value:value},{path:"UnidadDeNegocio",filter:"contains",value:value},{path:"Ver",filter:"contains",value:value},{path:"Operar",filter:"contains",value:value},{path:"Comisiones",filter:"contains",value:value},{path:"Relacion",filter:"contains",value:value}]}}else{e.filter=null}e.read()},50)})};a.loadGrid=function(){var c=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,showOverlay:false,secureRequest:true,requestUrl:((a.idPersona)?("visibilidadCuentas/visibilidadDeCuentas/detalles/"+a.idPersona):("visibilidadCuentas/cuentas/"+a.visibilidad.idUnidadDeNegocio+"/"+a.visibilidad.idEquipo+"/"+a.visibilidad.idCuenta+"/"+a.visibilidad.idPersonaAsesor)),requestType:"GET"});c.onSuccess=function(f){var d=((a.idPersona)?(f.visibilidadcuentas==null?[]:f.visibilidadcuentas):(f.cuentas==null?[]:f.cuentas));var e=a.divGridCuentas.swidget().initialOptions;e.dataSource.data=d;e.exportOptions.excel.dataSource.data=d;e.exportOptions.excel.readDataSource=true;a.divGridCuentas.swidget().refresh(e);a.txtFilter.keydown();a.divModal.modal({show:true})};c.request()};a.destroy=function(){a.divGridCuentas.swidget().destroy()}};Core.Business.BalanzCambioAsientos=new function(){var a=this;a.id="balanzcambioAsientos";a.divAsientos=null;a.lblTitle=null;a.txtFilter=null;a.timeout=null;a.txtDateFrom=null;a.txtDateTo=null;a.btnNuevoAsiento=null;a.divContainerAsientos=null;a.divContainerNuevoAsiento=null;a.timerId=null;a.btnRefresh=null;a.timeout=null;a.window=$(window);a.dataGrid=null;a.divColores=null;a.coloresActivos={};a.init=function(b,c,d){Core.loadPage("balanz-cambio-asientos.html",function(){document.title="Asientos";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divContainerAsientos=$(".div-container-asientos");a.divContainerAsientos.show();a.divContainerNuevoAsiento=$(".div-container-nuevo-asiento");a.divContainerNuevoAsiento.hide();a.divAsientos=a.divContainerAsientos.find(".div-asientos");a.lblTitle=a.divContainerAsientos.find(".label-title");a.txtFilter=a.divContainerAsientos.find(".textbox-filter");a.txtDateFrom=a.divContainerAsientos.find(".date-picker-from");a.txtDateTo=a.divContainerAsientos.find(".date-picker-to");a.btnRefresh=a.divContainerAsientos.find(".btn-refresh");a.divColores=a.divContainerAsientos.find(".div-colores");a.btnNuevoAsiento=a.divContainerAsientos.find(".btn-nuevo-asiento");a.initControls();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadGrid()},"Core.Business.BalanzCambioAsientos")})};a.initControls=function(){var b=new Date();b.setDate(b.getDate()-1);a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:b,max:new Date(),events:{change:function(c){a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loadGrid()}}});a.btnRefresh.on("click",function(){a.loadGrid()});a.btnNuevoAsiento.on("click",function(){new Core.Business.BalanzCambioAsientos.NuevoAsiento({overlayElement:a.btnNuevoAsiento,onSave:function(){a.loadGrid()},onLoad:function(){a.divContainerNuevoAsiento.show();a.divContainerAsientos.hide();$("html, body").animate({scrollTop:0},1000)},onClosed:function(){a.divContainerNuevoAsiento.hide();a.divContainerAsientos.show();$("html, body").animate({scrollTop:0},1000)},container:a.divContainerNuevoAsiento}).show()});a.btnNuevoAsiento.hide();if(a.pageOptions&&a.pageOptions.balanzcambioAsientosGestionar){a.btnNuevoAsiento.show()}a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var c=a.divAsientos.swidget().dataSource;if(value){c.filter={or:[{path:"NumAsiento",filter:"contains",value:value},{path:"FechaConcertacion",filter:"contains",value:value},{path:"FechaLiquidacion",filter:"contains",value:value},{path:"Leyenda",filter:"contains",value:value},{path:"Fecha",filter:"contains",value:value},{path:"Origen",filter:"contains",value:value},{path:"idExterno",filter:"contains",value:value}]}}else{c.filter=null}c.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,("Core.Business.BalanzCambioAsientos.txtFilter"))};a.initGrid=function(){var b=[];b.push({width:"12%",field:"NumAsiento",title:"Número",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({width:"12%",field:"FechaConcertacion",title:"Concertación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({width:"12%",field:"FechaLiquidacion",title:"Liquidación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({width:"28%",field:"Leyenda",title:"Leyenda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({width:"12%",field:"Fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({width:"12%",field:"Origen",title:"Origen",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({width:"12%",field:"idExterno",title:"Id Externo",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});var c=Core.Functions.grid.getHeaderAttribute(b.length);b.push({width:40,title:" ",headerAttributes:c,columnTemplate:function(e,f,g){if(f.Color!=""){e.parent().css("background-color","rgba("+a.hexToRgb(f.Color)+((g%2==0)?", 0.6":", 1 ")+")")}var d=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(e);d.on("click",function(){var h=new Core.Ajax.ServerRequest({overlayElement:d,requestUrl:"balanzcambio/asientos/obtenerDatosAsiento/"+f.idAsiento,requestType:"GET"});h.onSuccess=function(l){var j="";if(l.Datos&&l.Datos[0]){j+="<label>Datos</label>";j+="<table class='table table-striped'>";j+="<thead><tr><th>Nombre</th><th>Valor</th></tr></thead>";j+="<tbody>";$.each(l.Datos[0],function(i,o){j+="<tr>";j+="<td>"+i+"</td>";j+="<td>"+o+"</td>";j+="</tr>"});j+="</tbody>";j+="</table>"}if(l.Items&&l.Items.length){var m=0;var n=0;j+="<label>Items</label>";j+="<table class='table table-striped'>";j+="<thead><tr><th>Cuenta Contable</th><th>Moneda</th><th>Debe</th><th>Haber</th><th>Cotización</th></tr></thead>";j+="<tbody>";for(var k=0;k<l.Items.length;k++){j+="<tr>";j+="<td>"+l.Items[k].CuentaContable+"</td>";j+="<td>"+l.Items[k].Moneda+"</td>";j+="<td>"+(l.Items[k].Tipo=="D"?Core.Functions.grid.formatUndefinedNumber(l.Items[k].Importe):"")+"</td>";j+="<td>"+(l.Items[k].Tipo=="H"?Core.Functions.grid.formatUndefinedNumber(l.Items[k].Importe):"")+"</td>";j+="<td>"+Core.Functions.grid.formatUndefinedNumber(l.Items[k].Cotizacion)+"</td>";j+="</tr>";if(l.Items[k].Tipo=="D"){m+=(l.Items[k].Importe*l.Items[k].Cotizacion)}if(l.Items[k].Tipo=="H"){n+=(l.Items[k].Importe*l.Items[k].Cotizacion)}}j+="</tbody>";j+=("<thead><tr><th></th><th></th><th>Total: "+Core.Functions.grid.formatUndefinedNumber(Core.Functions.Decimal.parseFloat(m.toFixed(2)))+"</th><th>Total: "+Core.Functions.grid.formatUndefinedNumber(Core.Functions.Decimal.parseFloat(n.toFixed(2)))+"</th><th></th></tr></thead>");j+="</table>"}new Core.Controls.Dialog(("Detalles del Asiento "+f.idAsiento),j?j:"No se encontraron detalles.",{displayButtons:{close:true,accept:false}}).show()};h.request()})}});if(a.pageOptions&&a.pageOptions.balanzcambioAsientosGestionar){b.push({width:40,title:" ",headerAttributes:c,columnTemplate:function(e,f,g){if(f.BotonEliminar){var d=$('<button type="button" title="Elminar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(e);d.on("click",function(){new Core.Controls.Prompt("Está seguro que desea eliminar este Asiento?","Ingrese un comentario",{allowEmptyText:true,onAccepted:function(h){var i={};i.idAsiento=f.idAsiento;i.comentario=h;var j=new Core.Ajax.ServerRequest({overlayElement:d,secureRequest:true,requestUrl:"balanzcambio/asientos/eliminarAsiento",requestType:"POST",requestData:i});j.onSuccess=function(k){a.loadGrid()};j.request()}}).show()})}}})}a.divAsientos.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:b,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Asientos",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["NumAsiento","FechaConcertacion","FechaLiquidacion","Leyenda","Fecha","Origen","idExterno","borrado"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Asientos"}}},paging:{pageSize:50,pageLinksCount:10}})};a.loadGrid=function(){a.lblTitle.text("Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var b="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));b+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"balanzcambio/asientos/obtenerAsientos",requestType:"GET",requestData:b});c.onSuccess=function(e){a.dataGrid=e;var d=[];a.dataGrid.Asientos.forEach(function(g,f){if(d.indexOf(g.Color)==-1){d.push(g.Color)}});d.sort(function(f,g){if(f>g){return 1}else{return -1}});a.divColores.empty();$('<label style="width:100px;" class="text-center">Total: '+a.dataGrid.Asientos.length+"</label>").appendTo(a.divColoress);d.forEach(function(h,g){var f=$.grep(a.dataGrid.Asientos,function(k,j){return k.Color==h});var i=$('<label class="text-center lblColorContador" color="'+h+'" activo="'+((a.coloresActivos[h]==false)?"false":"true")+'" style="color: #2d2d2d !important; border-radius:4px; margin-right:3px; width:75px; border: 4px solid '+(h?h:"transparent")+"; background-color:"+((a.coloresActivos[h]==false)?"#c4c4c4":h)+';">'+f.length+"</label>").appendTo(a.divColores);if(a.coloresActivos[h]==null){a.coloresActivos[h]=true}i.on("click",function(){a.setColor(i)})});a.refreshGrid()};c.request()};a.setColor=function(b){if(b.attr("activo")=="true"){b.css("background-color","#c4c4c4");b.attr("activo","false");a.coloresActivos[b.attr("color")]=false}else{b.css("background-color",b.attr("color"));b.attr("activo","true");a.coloresActivos[b.attr("color")]=true}a.refreshGrid()};a.refreshGrid=function(){var c=$.grep(a.dataGrid.Asientos,function(j,h){return true});var b=$(".lblColorContador");for(var d=0;d<b.length;d++){var f=$(b[d]);if(f.attr("activo")=="false"){c=$.grep(c,function(j,h){return j.Color!=f.attr("color")})}}var g=a.window.scrollTop();var e=a.divAsientos.swidget().initialOptions;e.dataSource.data=c;e.dataSource.sort=a.divAsientos.swidget().dataSource.sort;e.exportOptions.excel.dataSource.data=c;e.exportOptions.excel.readDataSource=true;a.divAsientos.swidget().refresh(e);a.txtFilter.keydown();a.window.scrollTop(g)};a.hexToRgb=function(d){d=d.replace("#","");var f=parseInt(d.substring(0,2),16);var e=parseInt(d.substring(2,4),16);var c=parseInt(d.substring(4,6),16);var h=f+","+e+","+c;return h}};Core.Business.BalanzCambioAsientos.NuevoAsiento=function(b){var a=this;a.container=null;a.onSave=function(){};a.onLoad=function(){};a.onClosed=function(){};a.overlayElement=null;$.extend(true,a,b);a.opciones=null;a.cuentaSeleccionada=null;a.decimalCount=10;a.items=[];a.show=function(){var c=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,showOverlay:true,requestUrl:"balanzcambio/asientos/obtenerDatos",requestType:"GET"});c.onSuccess=function(d){a.opciones=d;a.txtLeyenda=a.container.find(".textbox-leyenda");a.txtLeyenda.shieldTextBox({});Core.Functions.Validations.toggleValidation(a.txtLeyenda,false);a.txtIdExterno=a.container.find(".textbox-id-externo");a.txtIdExterno.shieldTextBox({});a.txtFechaConcertacion=a.container.find(".date-picker-fecha-concertacion");a.txtFechaConcertacion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date()});Core.Functions.Validations.toggleValidation(a.txtFechaConcertacion,false);a.txtFechaLiquidacion=a.container.find(".date-picker-fecha-liquidacion");a.txtFechaLiquidacion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date()});Core.Functions.Validations.toggleValidation(a.txtFechaLiquidacion,false);a.btnNuevoItem=a.container.find(".btn-nuevo-item");a.btnNuevoItem.unbind("click");a.btnNuevoItem.on("click",function(){a.addNewItem()});a.divItems=a.container.find(".div-items");a.divItems.empty();a.lblTotalDebe=a.container.find(".lbl-total-debe");a.totalDebe=0;a.lblTotalHaber=a.container.find(".lbl-total-haber");a.totalHaber=0;a.txtComentarios=a.container.find(".textbox-comentarios");a.txtComentarios.shieldTextBox({});a.btnConfirmar=a.container.find(".btn-confirmar");a.btnConfirmar.unbind("click");a.btnConfirmar.on("click",function(){Core.Functions.Validations.toggleValidation(a.txtLeyenda,false);Core.Functions.Validations.toggleValidation(a.txtFechaConcertacion,false);Core.Functions.Validations.toggleValidation(a.txtFechaLiquidacion,false);a.items.forEach(function(j,h){Core.Functions.Validations.toggleValidation(j.ddlTipo,false);Core.Functions.Validations.toggleValidation(j.ddlCuentaContable,false);Core.Functions.Validations.toggleValidation(j.ddlMoneda,false);Core.Functions.Validations.toggleValidation(j.txtImporteDebe,false);Core.Functions.Validations.toggleValidation(j.txtImporteHaber,false);Core.Functions.Validations.toggleValidation(j.txtCotizacion,false)});var g={value:true};var e={data:{}};e.data.Leyenda=Core.Functions.Validations.getValidatedSwidgetValue(a.txtLeyenda,g);e.data.idExterno=a.txtIdExterno.swidget().value();e.data.FechaConcertacion=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaConcertacion,g));e.data.FechaLiquidacion=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaLiquidacion,g));e.data.Comentario=a.txtComentarios.swidget().value();e.data.Items=[];a.items.forEach(function(i,h){e.data.Items.push({Item:(h+1),Tipo:Core.Functions.Validations.getValidatedDropDownValue(i.ddlTipo,g),idCuentaContable:Core.Functions.Validations.getValidatedDropDownValue(i.ddlCuentaContable,g),Importe:Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedPositiveNumericInputValue((i.ddlTipo.swidget().value()=="D"?i.txtImporteDebe:i.txtImporteHaber),g)),Cotizacion:Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedPositiveNumericInputValue(i.txtCotizacion,g))})});if(g.value&&(a.totalDebe==0||a.totalHaber==0||a.totalDebe!=a.totalHaber)){g.value=false;new Core.Controls.Dialog("Aviso","Ambos totales deben ser mayores a 0 e iguales.",{displayButtons:{close:true,accept:false}}).show()}if(!g.value){return}var f=new Core.Ajax.ServerRequest({overlayElement:a.btnConfirmar,showOverlay:true,requestUrl:"balanzcambio/asientos/insertarAsiento",requestType:"POST",requestData:e});f.onSuccess=function(h){a.onSave();a.destroy()};f.request()});a.btnVolver=a.container.find(".btn-volver");a.btnVolver.unbind("click");a.btnVolver.on("click",function(){a.destroy()});a.setTotal();a.onLoad()};c.request()};a.addNewItem=function(){var c={};c.divItem=$("<tr></tr>").appendTo(a.divItems);c.divTipo=$("<td></td>").appendTo(c.divItem);c.divContainerTipo=$('<div class="control-group form-group" style="margin: 5px 5px 5px 0px;"></div>').appendTo(c.divTipo);c.ddlTipo=$('<select class="form-control"></select>').appendTo(c.divContainerTipo);c.ddlTipo.shieldDropDown({dataSource:{data:[{text:"Debe",value:"D"},{text:"Haber",value:"H"}]},valueTemplate:"{value}",textTemplate:"{text}",value:"",events:{select:function(d){a.setControlsByTipo(c)}}});Core.Functions.Validations.toggleValidation(c.ddlTipo,false);c.divCuentaContable=$("<td></td>").appendTo(c.divItem);c.divContainerCuentaContable=$('<div class="control-group form-group" style="margin: 5px 5px 5px 0px;"></div>').appendTo(c.divCuentaContable);c.ddlCuentaContable=$('<select class="form-control"></select>').appendTo(c.divContainerCuentaContable);c.ddlCuentaContable.shieldComboBox({dataSource:{data:$.grep(a.opciones.CuentasContables,function(e,d){return e.idMoneda>0})},valueTemplate:"{idCuentaContable}",textTemplate:"{Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""}]}},value:"",events:{select:function(d){a.setControlsByCuentaContable(c)}}});Core.Functions.Validations.toggleValidation(c.ddlCuentaContable,false);c.divMoneda=$("<td></td>").appendTo(c.divItem);c.divContainerMoneda=$('<div class="control-group form-group" style="margin: 5px 5px 5px 0px;"></div>').appendTo(c.divMoneda);c.ddlMoneda=$('<select class="form-control"></select>').appendTo(c.divContainerMoneda);c.ddlMoneda.shieldDropDown({dataSource:{data:a.opciones.Monedas},valueTemplate:"{idMoneda}",textTemplate:"{Descripcion}",value:"",enabled:false});Core.Functions.Validations.toggleValidation(c.ddlMoneda,false);c.divImporteDebe=$("<td></td>").appendTo(c.divItem);c.divContainerImporteDebe=$('<div class="control-group form-group" style="margin: 5px 0px 5px 0px;"></div>').appendTo(c.divImporteDebe);c.txtImporteDebe=$('<input type="text" class="form-control" />').appendTo(c.divContainerImporteDebe);new Core.Controls.DecimalPicker(c.txtImporteDebe,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:"",onChange:function(){a.setTotal()}});Core.Functions.Validations.toggleValidation(c.txtImporteDebe,false);c.divImporteHaber=$("<td></td>").appendTo(c.divItem);c.divContainerImporteHaber=$('<div class="control-group form-group" style="margin: 5px 0px 5px 0px;"></div>').appendTo(c.divImporteHaber);c.txtImporteHaber=$('<input type="text" class="form-control" />').appendTo(c.divContainerImporteHaber);new Core.Controls.DecimalPicker(c.txtImporteHaber,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:"",onChange:function(){a.setTotal()}});Core.Functions.Validations.toggleValidation(c.txtImporteHaber,false);c.divCotizacion=$("<td></td>").appendTo(c.divItem);c.divContainerCotizacion=$('<div class="control-group form-group" style="margin: 5px 0px 5px 0px;"></div>').appendTo(c.divCotizacion);c.txtCotizacion=$('<input type="text" class="form-control" />').appendTo(c.divContainerCotizacion);new Core.Controls.DecimalPicker(c.txtCotizacion,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:"",onChange:function(){a.setTotal()}});Core.Functions.Validations.toggleValidation(c.txtCotizacion,false);c.divAcciones=$("<td></td>").appendTo(c.divItem);c.btnEliminar=$('<button type="button" title="Eliminar item" class="btn-sm balanz-button right"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(c.divAcciones);c.btnEliminar.click(function(){c.divItem.hide();a.items.remove(c);a.setTotal()});a.setControlsByTipo(c);a.setControlsByCuentaContable(c);a.items.push(c)};a.setControlsByTipo=function(c){c.divContainerImporteDebe.hide();c.divContainerImporteHaber.hide();if(c.ddlTipo.swidget().selectedItem()){if(c.ddlTipo.swidget().value()=="D"){c.divContainerImporteDebe.show()}else{c.divContainerImporteHaber.show()}}a.setTotal()};a.setControlsByCuentaContable=function(c){c.ddlMoneda.swidget().value(c.ddlCuentaContable.swidget().selectedItem()?c.ddlCuentaContable.swidget().selectedItem().idMoneda.toString():"");c.txtCotizacion.removeAttr("disabled");if(c.ddlMoneda.swidget().selectedItem()){if(c.ddlMoneda.swidget().selectedItem().idMoneda==Core.Enums.Currency.Pesos.idMoneda){c.txtCotizacion.attr("disabled","disabled");c.txtCotizacion.val("1");c.txtCotizacion.blur();a.setTotal()}else{if(a.txtFechaConcertacion.swidget().value()){var d=new Core.Ajax.ServerRequest({showOverlay:true,requestUrl:"balanzcambio/comun/obtenerCotizacion/"+c.ddlMoneda.swidget().selectedItem().idMoneda+"/"+Core.Functions.Date.getDateAsString(a.txtFechaConcertacion.swidget().value()),requestType:"GET"});d.onSuccess=function(e){if(e.Cotizacion&&e.Cotizacion[0]){c.txtCotizacion.val(e.Cotizacion[0].Cotizacion);c.txtCotizacion.blur();a.setTotal()}};d.request()}}}};a.setTotal=function(){a.totalDebe=0;a.totalHaber=0;a.items.forEach(function(e,c){if(e.ddlTipo.swidget().selectedItem()){if(e.ddlTipo.swidget().value()=="D"){var d=Core.Functions.Decimal.parseFloat((Core.Functions.Decimal.parseFloat(e.txtImporteDebe.val())*Core.Functions.Decimal.parseFloat(e.txtCotizacion.val())).toFixed(2));a.totalDebe+=d}else{var d=Core.Functions.Decimal.parseFloat((Core.Functions.Decimal.parseFloat(e.txtImporteHaber.val())*Core.Functions.Decimal.parseFloat(e.txtCotizacion.val())).toFixed(2));a.totalHaber+=d}}});a.totalDebe=Core.Functions.Decimal.parseFloat(a.totalDebe.toFixed(2));a.totalHaber=Core.Functions.Decimal.parseFloat(a.totalHaber.toFixed(2));a.lblTotalDebe.text("Total: "+Core.Functions.grid.formatNumber(a.totalDebe));a.lblTotalHaber.text("Total: "+Core.Functions.grid.formatNumber(a.totalHaber))};a.destroy=function(){a.txtLeyenda.swidget().destroy();a.txtIdExterno.swidget().destroy();a.txtFechaConcertacion.swidget().destroy();a.txtFechaLiquidacion.swidget().destroy();a.onClosed()}};Core.Business.BalanzCambioBoletos=new function(){var a=this;a.id="balanzcambioBoletos";a.divBoletos=null;a.lblTitle=null;a.txtFilter=null;a.timeout=null;a.txtDateFrom=null;a.txtDateTo=null;a.timerId=null;a.btnRefresh=null;a.timeout=null;a.window=$(window);a.dataGrid=null;a.divContadores=null;a.coloresActivos={};a.idNegocio=1;a.init=function(b,c,d){Core.loadPage("balanz-cambio-boletos.html",function(){document.title="Boletos";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divBoletos=$(".div-boletos");a.lblTitle=$(".label-title");a.txtFilter=$(".textbox-filter");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.btnRefresh=$(".btn-refresh");a.divContadores=$(".div-contadores");a.initControls();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadGrid()},"Core.Business.BalanzCambioBoletos")})};a.initControls=function(){var b=new Date();b.setDate(b.getDate()-1);a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:b,max:new Date(),events:{change:function(c){a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loadGrid()}}});a.btnRefresh.on("click",function(){a.loadGrid()});a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var c=a.divBoletos.swidget().dataSource;if(value){c.filter={or:[{path:"NumBoleto",filter:"contains",value:value},{path:"FechaConcertacion",filter:"contains",value:value},{path:"FechaLiquidacion",filter:"contains",value:value},{path:"NumCuentaCambio",filter:"contains",value:value},{path:"CUIT_CUIL",filter:"contains",value:value},{path:"Cuenta",filter:"contains",value:value},{path:"Operacion",filter:"contains",value:value},{path:"Cantidad",filter:"contains",value:value},{path:"Cotizacion",filter:"contains",value:value},{path:"MonedaGastos",filter:"contains",value:value},{path:"Gastos",filter:"contains",value:value},{path:"Fecha",filter:"contains",value:value},{path:"idExterno",filter:"contains",value:value}]}}else{c.filter=null}c.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,("Core.Business.BalanzCambioBoletos.txtFilter"))};a.initGrid=function(){var b=[];b.push({width:"6%",field:"NumBoleto",title:"Boleto",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({width:"6%",field:"FechaConcertacion",title:"Concertación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({width:"6%",field:"FechaLiquidacion",title:"Liquidación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({width:"7%",field:"NumCuentaCambio",title:"Cuenta Cambio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({width:"7%",field:"CUIT_CUIL",title:"CUIL",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({width:"20%",field:"Cuenta",title:"Cuenta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({width:"7%",field:"Operacion",title:"Operación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({width:"7%",field:"Cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatPrice});b.push({width:"7%",field:"Cotizacion",title:"Cotización",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatPrice});b.push({width:"6%",field:"MonedaGastos",title:"Mon Gtos",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({width:"7%",field:"Gastos",title:"Gastos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatPrice});b.push({width:"8%",field:"Fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({width:"6%",field:"idExterno",title:"Id Externo",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});var c=Core.Functions.grid.getHeaderAttribute(b.length);if(a.pageOptions&&a.pageOptions.balanzcambioBoletosGestionar){b.push({width:40,title:" ",headerAttributes:c,columnTemplate:function(e,f,g){if(f.BotonEliminar){var d=$('<button type="button" title="Anular Boleto" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(e);d.on("click",function(){new Core.Controls.Prompt("Anular Boleto","Ingrese un comentario",{allowEmptyText:true,onAccepted:function(h){var i={};i.idBoleto=f.idBoleto;i.comentario=h;var j=new Core.Ajax.ServerRequest({overlayElement:d,secureRequest:true,requestUrl:"balanzcambio/boletos/anularBoleto",requestType:"POST",requestData:i});j.onSuccess=function(k){a.loadGrid()};j.request()}}).show()})}}})}b.push({width:40,title:" ",headerAttributes:c,columnTemplate:function(e,f,g){if(f.Color!=""){e.parent().css("background-color","rgba("+a.hexToRgb(f.Color)+((g%2==0)?", 0.6":", 1 ")+")")}if(f.reporte&&f.reporte!=""&&f.codigo&&f.codigo!=""){var d=$('<button type="button" title="Descargar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>').appendTo(e);d.on("click",function(){function i(p){var o=new Blob([p.response],{type:p.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(o);return}var j=window.URL.createObjectURL(o);var n=document.createElement("a");n.href=j;var l=p.getResponseHeader("Content-Disposition").split("; ");var k="filename=file.pdf";for(var m=0;m<l.length;m++){if(l[m].indexOf("filename")>=0){k=l[m]}}n.download=k.split("=")[1];n.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(j)}var h=new XMLHttpRequest();h.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"descargar/"+f.reporte+"/"+f.codigo,true);h.responseType="blob";h.setRequestHeader("Authorization",Core.Objects.Context.Token);h.onload=function(j){if(h.status==200){i(h)}else{var k=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga del comprobante.</p>",{displayButtons:{close:true,accept:false}});k.show()}};h.send()})}}});a.divBoletos.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:b,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Boletos",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["NumBoleto","FechaConcertacion","FechaLiquidacion","NumCuentaCambio","CUIT_CUIL","Cuenta","Operacion","Cantidad","Cotizacion","MonedaGastos","Gastos","Fecha","idExterno","MonedaImpPAIS","ImpPAIS","MonedaPercepGan","PercepGan","borrado"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Boletos"}}},paging:{pageSize:50,pageLinksCount:10}})};a.getFormatDate=function(b){return b.substr(6,4)+b.substr(3,2)+b.substr(0,2)};a.loadGrid=function(){a.lblTitle.text("Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var b="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));b+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"balanzcambio/boletos/obtenerBoletos",requestType:"GET",requestData:b});c.onSuccess=function(e){a.dataGrid=e;var d=[];e.Boletos.forEach(function(g,f){if(d.indexOf(g.Color)==-1){d.push(g.Color)}});d.sort(function(f,g){if(f>g){return 1}else{return -1}});a.divContadores.empty();$('<label style="width:100px;" class="text-center">Total: '+e.Boletos.length+"</label>").appendTo(a.divContadores);d.forEach(function(h,g){var f=$.grep(e.Boletos,function(k,j){return k.Color==h});var i=$('<label class="text-center lblColorContador" color="'+h+'" activo="'+((a.coloresActivos[h]==false)?"false":"true")+'" style="color: #2d2d2d !important; border-radius:4px; margin-right:3px; width:75px; border: 4px solid '+(h?h:"transparent")+"; background-color:"+((a.coloresActivos[h]==false)?"#c4c4c4":h)+';">'+f.length+"</label>").appendTo(a.divContadores);if(a.coloresActivos[h]==null){a.coloresActivos[h]=true}i.on("click",function(){a.setColor(i)})});a.refreshGrid()};c.request()};a.setColor=function(b){if(b.attr("activo")=="true"){b.css("background-color","#c4c4c4");b.attr("activo","false");a.coloresActivos[b.attr("color")]=false}else{b.css("background-color",b.attr("color"));b.attr("activo","true");a.coloresActivos[b.attr("color")]=true}a.refreshGrid()};a.refreshGrid=function(){var c=$.grep(a.dataGrid.Boletos,function(j,h){return true});var b=$(".lblColorContador");for(var d=0;d<b.length;d++){var f=$(b[d]);if(f.attr("activo")=="false"){c=$.grep(c,function(j,h){return j.Color!=f.attr("color")})}}var g=a.window.scrollTop();var e=a.divBoletos.swidget().initialOptions;e.dataSource.data=c;e.dataSource.sort=a.divBoletos.swidget().dataSource.sort;e.exportOptions.excel.dataSource.data=c;e.exportOptions.excel.readDataSource=true;a.divBoletos.swidget().refresh(e);a.txtFilter.keydown();a.window.scrollTop(g)};a.hexToRgb=function(d){d=d.replace("#","");var f=parseInt(d.substring(0,2),16);var e=parseInt(d.substring(2,4),16);var c=parseInt(d.substring(4,6),16);var h=f+","+e+","+c;return h}};Core.Business.BalanzCambioCuentas=new function(){var b=this;var a=13;b.idDefaultAccount=null;b.idDefaultProfile=null;b.id="balanzcambioCuentas";b.divContainerCuentas=null;b.divCuentas=null;b.divFiltroColores=null;b.pageOptions=null;b.txtSearch=null;b.btnSearch=null;b.txtFilter=null;b.timeout=null;b.coloresActivos={};b.init=function(c,d){Core.loadPage("balanz-cambio-cuentas.html",function(){document.title="Cuentas";b.idDefaultAccount=c;b.idDefaultProfile=d;b.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(b.id,Core.Objects.Context.Profiles[d]);b.divContainerCuentas=$(".div-container-balanz-cambio-cuentas");b.divContainerCuentas.hide();b.divCuentas=$(".div-balanz-cambio-cuentas");b.txtFilter=$(".textbox-filter");b.txtSearch=$(".textbox-search");b.btnSearch=$(".btn-search");b.divFiltroColores=$(".div-filtro-colores");b.initGrid();b.initFilter();b.header=new Core.Controls.Header($("#topNav"),{});b.header.init(false,c,d,function(){if(Core.Objects.BalanzCambioCuentas){b.divContainerCuentas.show()}},"Core.Business.BalanzCambioCuentas")})};b.initFilter=function(){b.txtFilter.on("keydown",function(){clearTimeout(b.timeout);b.timeout=setTimeout(function(){value=b.txtFilter.val();var c=b.divCuentas.swidget().dataSource;if(value){c.filter={or:[{path:"idCuenta",filter:"contains",value:value},{path:"Descripcion",filter:"contains",value:value},{path:"NumCuentaCambio",filter:"contains",value:value},{path:"CUIT_CUIL",filter:"contains",value:value},{path:"FechaAlta",filter:"contains",value:value},{path:"Estado",filter:"contains",value:value}]}}else{c.filter=null}c.read()},50)});Core.Functions.Persistence.setTextBox(b.txtFilter,"Core.Business.BalanzCambioCuentas.txtFilter");b.txtSearch.on("keyup",function(c){if(c.keyCode==a){b.loadGrid()}});Core.Functions.Persistence.setTextBox(b.txtSearch,"Core.Business.BalanzCambioCuentas.txtSearch");b.btnSearch.on("click",function(){b.loadGrid()})};b.initGrid=function(){var c=[];c.push({width:"10%",field:"idCuenta",title:"ID Cuenta",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});c.push({width:"40%",field:"Descripcion",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"15%",field:"NumCuentaCambio",title:"Número Cuenta Cambio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});c.push({width:"10%",field:"CUIT_CUIL",title:"CUIT / CUIL",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"10%",field:"FechaAlta",title:"Fecha Alta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"15%",field:"Estado",title:"Estado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});var d=Core.Functions.grid.getHeaderAttribute(c.length);if(b.pageOptions&&b.pageOptions.balanzcambioCuentasGestionar){c.push({width:40,field:"",title:" ",headerAttributes:d,columnTemplate:function(f,g,h){var e=$('<button type="button" title="Editar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(f);e.on("click",function(){new Core.Business.BalanzCambioCuentas.EditarCuenta({cuenta:g,onSave:function(){b.loadGrid()}}).show()})}})}c.push({width:40,field:"",title:" ",headerAttributes:d,columnTemplate:function(f,g,h){if(g.Color){f.parent().css("background-color","rgba("+Core.Functions.grid.hexToRgb(g.Color)+((h%2==0)?", 0.6":", 1 ")+")")}var e=$('<button type="button" title="Descargar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>').appendTo(f);e.on("click",function(){function j(q){var p=new Blob([q.response],{type:q.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(p);return}var k=window.URL.createObjectURL(p);var o=document.createElement("a");o.href=k;var m=q.getResponseHeader("Content-Disposition").split("; ");var l="filename=file.pdf";for(var n=0;n<m.length;n++){if(m[n].indexOf("filename")>=0){l=m[n]}}o.download=l.split("=")[1];o.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(k)}var i=new XMLHttpRequest();i.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"balanzcambio/cuentas/pdf/"+g.idCuentaCambio,true);i.responseType="blob";i.setRequestHeader("Authorization",Core.Objects.Context.Token);i.onload=function(k){if(i.status==200){j(i)}else{var l=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga del comprobante.</p>",{displayButtons:{close:true,accept:false}});l.show()}};i.send()})}});b.divCuentas.shieldGrid({dataSource:{data:Core.Objects.BalanzCambioCuentas?Core.Objects.BalanzCambioCuentas:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},exportOptions:{excel:{fileName:"Balanz Cambio Cuentas",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["idCuenta","Descripcion","NumCuentaCambio","CUIT_CUIL","FechaAlta","Estado"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Balanz Cambio Cuentas"}}},columns:c})};b.loadGrid=function(){Core.Objects.BalanzCambioCuentas=null;b.divContainerCuentas.hide();if(b.txtSearch.val()&&b.txtSearch.val().length>=3){var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"balanzcambio/cuentas/obtenerCuentas?search="+b.txtSearch.val(),requestType:"GET"});c.onSuccess=function(e){var d=[];e.Cuentas.forEach(function(g,f){if(d.indexOf(g.Color)==-1){d.push(g.Color)}});d.sort(function(f,g){if(f>g){return 1}else{return -1}});b.divFiltroColores.empty();$('<label style="width:75px;" class="text-center">Total: '+e.Cuentas.length+"</label>").appendTo(b.divFiltroColores);d.forEach(function(h,g){var f=$.grep(e.Cuentas,function(k,j){return k.Color==h});var i=$('<label class="text-center lblColorContador" color="'+h+'" activo="'+((b.coloresActivos[h]==false)?"false":"true")+'" style="color: #2d2d2d !important; border-radius:4px; margin-right:3px; width:75px; border: 4px solid '+(h?h:"transparent")+"; background-color:"+((b.coloresActivos[h]==false)?"#c4c4c4":h)+';">'+f.length+"</label>").appendTo(b.divFiltroColores);if(b.coloresActivos[h]==null){b.coloresActivos[h]=true}i.on("click",function(){b.setColor(i)})});Core.Objects.BalanzCambioCuentas=e.Cuentas;b.refreshGrid()};c.request()}else{new Core.Controls.Dialog("Aviso","<p>Debe ingresar un patrón de búsqueda de al menos 3 caracteres.</p>",{displayButtons:{close:true,accept:false}}).show()}};b.setColor=function(c){if(c.attr("activo")=="true"){c.css("background-color","#c4c4c4");c.attr("activo","false");b.coloresActivos[c.attr("color")]=false}else{c.css("background-color",c.attr("color"));c.attr("activo","true");b.coloresActivos[c.attr("color")]=true}b.refreshGrid()};b.refreshGrid=function(){var d=$.grep(Core.Objects.BalanzCambioCuentas,function(j,h){return true});var c=$(".lblColorContador");for(var e=0;e<c.length;e++){var g=$(c[e]);if(g.attr("activo")=="false"){d=$.grep(d,function(j,h){return j.Color!=g.attr("color")})}}var f=b.divCuentas.swidget().initialOptions;f.dataSource.data=d;f.exportOptions.excel.dataSource.data=d;f.exportOptions.excel.readDataSource=true;b.divCuentas.swidget().refresh(f);b.txtFilter.keydown();b.divContainerCuentas.show()}};Core.Business.BalanzCambioCuentas.EditarCuenta=function(b){var a=this;a.divModal=$(".div-modal-editar-cambio-balanz-cuenta");a.ddlEstado=null;a.txtComentario=null;a.btnConfirmar=null;a.onSave=null;a.cuenta=null;a.onSave=function(){};a.overlayElement=null;$.extend(true,a,b);a.show=function(){var c=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,showOverlay:true,requestUrl:"balanzcambio/comun/obtenerEstadosCuentas",requestType:"GET"});c.onSuccess=function(d){a.lblTitle=a.divModal.find(".lbl-title");a.lblTitle.text("Editar Cuenta - "+Core.Functions.grid.formatUndefinedIntegerNumber(a.cuenta.NumCuentaCambio));a.txtComentario=a.divModal.find(".textbox-comentarios");a.txtComentario.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtComentario,false);a.ddlEstado=a.divModal.find(".dropdown-estado");a.ddlEstado.shieldDropDown({dataSource:{data:d.EstadosCuentas},valueTemplate:"{idEstadoCuenta}",textTemplate:"{Descripcion}",value:a.cuenta?a.cuenta.idEstadoCuenta.toString():""});Core.Functions.Validations.toggleValidation(a.ddlEstado,false);a.btnConfirmar=a.divModal.find(".btn-confirmar");a.btnConfirmar.unbind("click");a.btnConfirmar.click(function(){Core.Functions.Validations.toggleValidation(a.ddlEstado,false);Core.Functions.Validations.toggleValidation(a.txtComentario,false);if(!a.ddlEstado.swidget().selectedItem()){Core.Functions.Validations.toggleValidation(a.ddlEstado,true);return}var e={idCuenta:a.cuenta.idCuenta,idEstadoCuenta:a.ddlEstado.swidget().selectedItem().idEstadoCuenta,comentario:a.txtComentario.swidget().value()};var f=new Core.Ajax.ServerRequest({overlayElement:a.btnConfirmar,secureRequest:true,requestUrl:"balanzcambio/cuentas/actualizarCuentaEstado",requestType:"POST",requestData:e});f.onSuccess=function(g){a.onSave();a.divModal.modal("hide")};f.request()});a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.divModal.modal({show:true})};c.request()};a.destroy=function(){a.txtComentario.swidget().destroy();a.ddlEstado.swidget().destroy()}};Core.Business.BalanzCambioMovimientosTesoreria=new function(){var a=this;a.id="balanzcambioMovimientosTesoreria";a.divMovimientos=null;a.lblTitle=null;a.txtFilter=null;a.timeout=null;a.txtDateFrom=null;a.txtDateTo=null;a.timerId=null;a.btnRefresh=null;a.btnNuevoMovimiento=null;a.timeout=null;a.window=$(window);a.dataGrid=null;a.divContadores=null;a.coloresActivos={};a.divTiposMovimientos=null;a.tiposMovimientosActivos={};a.idNegocio=1;a.init=function(b,c,d){Core.loadPage("balanz-cambio-movimientos-tesoreria.html",function(){document.title="Movimientos";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divMovimientos=$(".div-movimientos");a.lblTitle=$(".label-title");a.txtFilter=$(".textbox-filter");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.btnRefresh=$(".btn-refresh");a.btnNuevoMovimiento=$(".btn-nuevo-movimiento");a.divContadores=$(".div-contadores");a.divTiposMovimientos=$(".div-contadores-tipo-movimiento");a.divContainerMovimientos=$(".div-container-movimientos");a.divContainerMovimientos.show();a.divContainerNuevoMovimiento=$(".div-container-nuevo-movimiento");a.divContainerNuevoMovimiento.hide();a.initControls();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadGrid()},"Core.Business.BalanzCambioMovimientosTesoreria")})};a.initControls=function(){var b=new Date();b.setDate(b.getDate()-1);a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:b,max:new Date(),events:{change:function(c){a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loadGrid()}}});a.btnRefresh.on("click",function(){a.loadGrid()});a.btnNuevoMovimiento.on("click",function(){new Core.Business.BalanzCambioMovimientosTesoreria.NuevoMovimiento({overlayElement:a.btnNuevoMovimiento,onSave:function(){a.loadGrid()},onLoad:function(){a.divContainerNuevoMovimiento.show();a.divContainerMovimientos.hide();$("html, body").animate({scrollTop:0},1000)},onClosed:function(){a.divContainerNuevoMovimiento.hide();a.divContainerMovimientos.show();$("html, body").animate({scrollTop:0},1000)},container:a.divContainerNuevoMovimiento}).show()});a.btnNuevoMovimiento.hide();if(a.pageOptions&&a.pageOptions.balanzcambioMovimientosTesoreriaGestionar){a.btnNuevoMovimiento.show()}a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var c=a.divMovimientos.swidget().dataSource;if(value){c.filter={or:[{path:"NumTesoreriaMovimiento",filter:"contains",value:value},{path:"TipoMovimiento",filter:"contains",value:value},{path:"FechaConcertacion",filter:"contains",value:value},{path:"FechaLiquidacion",filter:"contains",value:value},{path:"NumCuentaCambio",filter:"contains",value:value},{path:"CUIT_CUIL",filter:"contains",value:value},{path:"Cuenta",filter:"contains",value:value},{path:"Moneda",filter:"contains",value:value},{path:"Importe",filter:"contains",value:value},{path:"Banco",filter:"contains",value:value},{path:"Fecha",filter:"contains",value:value},{path:"idExterno",filter:"contains",value:value}]}}else{c.filter=null}c.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,("Core.Business.BalanzCambioMovimientosTesoreria.txtFilter"))};a.initGrid=function(){var b=[];b.push({width:"6%",field:"NumTesoreriaMovimiento",title:"Número",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({width:"6%",field:"TipoMovimiento",title:"Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({width:"7%",field:"FechaConcertacion",title:"Concertación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({width:"7%",field:"FechaLiquidacion",title:"Liquidación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({width:"8%",field:"NumCuentaCambio",title:"Cuenta Cambio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({width:"8%",field:"CUIT_CUIL",title:"CUIL",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({width:"20%",field:"Cuenta",title:"Cuenta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({width:"6%",field:"Moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({width:"8%",field:"Importe",title:"Importe",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatPrice});b.push({width:"8%",field:"Banco",title:"Banco",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({width:"6%",field:"idExterno",title:"Id Externo",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"10%",field:"Fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,e,f){d.text(e.Fecha);if(e.Color!=""){d.parent().css("background-color","rgba("+a.hexToRgb(e.Color)+((f%2==0)?", 0.6":", 1 ")+")")}}});if(a.pageOptions&&a.pageOptions.balanzcambioMovimientosTesoreriaGestionar){var c=Core.Functions.grid.getHeaderAttribute(b.length);b.push({width:40,title:" ",headerAttributes:c,columnTemplate:function(e,f,g){if(f.BotonModificar){var d=$('<button type="button" title="Modificar Movimiento" class="btn-sm balanz-button"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(e);d.on("click",function(){new Core.Business.BalanzCambioMovimientosTesoreria.ModificarMovimiento({idTesoreriaMovimiento:f.idTesoreriaMovimiento,onSave:function(){a.loadGrid()}}).show()})}}});b.push({width:40,title:" ",headerAttributes:c,columnTemplate:function(e,f,g){if(f.BotonEliminar){var d=$('<button type="button" title="Elminar Movimiento" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(e);d.on("click",function(){new Core.Controls.Prompt("Está seguro que desea eliminar este Movimiento?","Ingrese un comentario",{allowEmptyText:true,onAccepted:function(h){var i={};i.idTesoreriaMovimiento=f.idTesoreriaMovimiento;i.comentario=h;var j=new Core.Ajax.ServerRequest({overlayElement:d,secureRequest:true,requestUrl:"balanzcambio/movimientosTesoreria/eliminarMovimientoTesoreria",requestType:"POST",requestData:i});j.onSuccess=function(k){a.loadGrid()};j.request()}}).show()})}}})}a.divMovimientos.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:b,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Movimientos",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["NumTesoreriaMovimiento","TipoMovimiento","FechaConcertacion","FechaLiquidacion","NumCuentaCambio","CUIT_CUIL","Cuenta","Moneda","Importe","Banco","idExterno","Fecha","borrado"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Movimientos"}}},paging:{pageSize:50,pageLinksCount:10}})};a.getFormatDate=function(b){return b.substr(6,4)+b.substr(3,2)+b.substr(0,2)};a.loadGrid=function(){a.lblTitle.text("Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var b="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));b+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"balanzcambio/movimientosTesoreria/obtenerMovimientosTesoreria",requestType:"GET",requestData:b});c.onSuccess=function(e){a.dataGrid=e;var d=[];var f=[];e.Movimientos.forEach(function(h,g){if(d.indexOf(h.Color)==-1){d.push(h.Color)}if(f.indexOf(h.TipoMovimiento)==-1){f.push(h.TipoMovimiento)}});d.sort(function(g,h){if(g>h){return 1}else{return -1}});a.divContadores.empty();$('<label style="width:100px;" class="text-center">Total: '+e.Movimientos.length+"</label>").appendTo(a.divContadores);d.forEach(function(i,h){var g=$.grep(e.Movimientos,function(l,k){return l.Color==i});var j=$('<label class="text-center lblColorContador" color="'+i+'" activo="'+((a.coloresActivos[i]==false)?"false":"true")+'" style="color: #2d2d2d !important; border-radius:4px; margin-right:3px; width:75px; border: 4px solid '+(i?i:"transparent")+"; background-color:"+((a.coloresActivos[i]==false)?"#c4c4c4":i)+';">'+g.length+"</label>").appendTo(a.divContadores);if(a.coloresActivos[i]==null){a.coloresActivos[i]=true}j.on("click",function(){a.setColor(j)})});f.sort(function(g,h){if(g>h){return 1}else{return -1}});a.divTiposMovimientos.empty();$.each(f,function(g,j){var i=$.grep(e.Movimientos,function(l,k){return l.TipoMovimiento==j});var h=$("<label class='lblTipoMovimientoContador' style='background-color: "+((a.tiposMovimientosActivos[j]==false)?"transparent; ":"lightblue; ")+"margin: 8px 6px 8px 0; padding: 4px 5px; border: 1px solid #ccc;  font-weight: normal;' activo='"+((a.tiposMovimientosActivos[j]==false)?"false":"true")+"' tipomovimiento='"+j+"'>"+j+": <strong style='color: #333;'>"+i.length+"</strong></label>").appendTo(a.divTiposMovimientos);if(a.tiposMovimientosActivos[j]==null){a.tiposMovimientosActivos[j]=true}h.on("click",function(){a.setTipoMovimiento(h)})});a.refreshGrid()};c.request()};a.setColor=function(b){if(b.attr("activo")=="true"){b.css("background-color","#c4c4c4");b.attr("activo","false");a.coloresActivos[b.attr("color")]=false}else{b.css("background-color",b.attr("color"));b.attr("activo","true");a.coloresActivos[b.attr("color")]=true}a.refreshGrid()};a.setTipoMovimiento=function(b){if(b.attr("activo")=="true"){b.css("background-color","transparent");b.attr("activo","false");a.tiposMovimientosActivos[b.attr("tipomovimiento")]=false}else{b.css("background-color","lightblue");b.attr("activo","true");a.tiposMovimientosActivos[b.attr("tipomovimiento")]=true}a.refreshGrid()};a.refreshGrid=function(){var c=$.grep(a.dataGrid.Movimientos,function(k,j){return true});var b=$(".lblColorContador");for(var d=0;d<b.length;d++){var f=$(b[d]);if(f.attr("activo")=="false"){c=$.grep(c,function(k,j){return k.Color!=f.attr("color")})}}var h=$(".lblTipoMovimientoContador");for(var d=0;d<h.length;d++){var f=$(h[d]);if(f.attr("activo")=="false"){c=$.grep(c,function(k,j){return k.TipoMovimiento!=f.attr("tipomovimiento")})}}var g=a.window.scrollTop();var e=a.divMovimientos.swidget().initialOptions;e.dataSource.data=c;e.dataSource.sort=a.divMovimientos.swidget().dataSource.sort;e.exportOptions.excel.dataSource.data=c;e.exportOptions.excel.readDataSource=true;a.divMovimientos.swidget().refresh(e);a.txtFilter.keydown();a.window.scrollTop(g)};a.hexToRgb=function(d){d=d.replace("#","");var f=parseInt(d.substring(0,2),16);var e=parseInt(d.substring(2,4),16);var c=parseInt(d.substring(4,6),16);var h=f+","+e+","+c;return h}};Core.Business.BalanzCambioMovimientosTesoreria.ModificarMovimiento=function(c){var b=this;var a=13;b.divModal=$(".div-modal-modificar-movimiviento");b.txtCuil=null;b.divCuenta=null;b.lblCuenta=null;b.divComentarios=null;b.txtComentarios=null;b.btnBuscar=null;b.divConfirmar=null;b.btnConfirmar=null;b.idTesoreriaMovimiento=null;b.cuentaSeleccionada=null;b.onSave=function(){};$.extend(true,b,c);b.show=function(){b.txtCuil=b.divModal.find(".text-cuil");b.txtCuil.val("");b.txtCuil.unbind("keyup");b.txtCuil.on("keyup",function(d){if(d.keyCode==a){b.searchAccount()}});b.btnBuscar=b.divModal.find(".btn-buscar");b.btnBuscar.unbind("click");b.btnBuscar.on("click",function(){b.searchAccount()});b.divCuenta=b.divModal.find(".div-cuenta");b.divCuenta.hide();b.lblCuenta=b.divModal.find(".lbl-cuenta");b.lblCuenta.text("No se ha encontrado ninguna cuenta.");b.divComentarios=b.divModal.find(".div-comentarios");b.divComentarios.hide();b.txtComentarios=b.divModal.find(".text-comentarios");b.txtComentarios.val("");b.divConfirmar=b.divModal.find(".div-confirmar");b.divConfirmar.hide();b.btnConfirmar=b.divModal.find(".btn-confirmar");b.btnConfirmar.unbind("click");b.btnConfirmar.on("click",function(){var d={data:{}};d.data.idTesoreriaMovimiento=b.idTesoreriaMovimiento;d.data.idCuentaCambio=b.cuentaSeleccionada.idCuentaCambio;d.data.comentario=b.txtComentarios.val();var e=new Core.Ajax.ServerRequest({overlayElement:b.divModal.find(".modal-body"),secureRequest:true,requestUrl:"balanzcambio/movimientosTesoreria/modificarMovimientoTesoreria",requestType:"POST",requestData:d});e.onSuccess=function(f){b.divModal.modal("hide");b.onSave()};e.request()});b.divModal.modal({show:true})};b.searchAccount=function(){b.divCuenta.hide();b.divConfirmar.hide();b.divComentarios.hide();b.cuentaSeleccionada=null;if(!b.txtCuil.val()||!b.isNumeric(b.txtCuil.val())||!Core.Functions.Validations.isCuit(b.txtCuil.val())){b.lblCuenta.text("Debe ingresar un CUIL válido.");b.divCuenta.show();return}var d=new Core.Ajax.ServerRequest({overlayElement:b.divModal.find(".modal-body"),secureRequest:true,requestUrl:"balanzcambio/cuentas/obtenerCuentaActivaCUIL",requestType:"GET",requestData:{CUIL:b.txtCuil.val()}});d.onSuccess=function(e){b.divCuenta.show();if(e.Cuentas&&e.Cuentas[0]){b.lblCuenta.text(e.Cuentas[0].NumCuentaCambio+" | "+e.Cuentas[0].Descripcion);b.divConfirmar.show();b.divComentarios.show();b.cuentaSeleccionada=e.Cuentas[0]}else{b.lblCuenta.text("No se ha encontrado ninguna cuenta para el CUIL ingresado.")}};d.request()};b.isNumeric=function(d){var e=/^[0-9]+$/;if(d&&!e.test(d)){return false}return true}};Core.Business.BalanzCambioMovimientosTesoreria.NuevoMovimiento=function(b){var a=this;a.container=null;a.onSave=function(){};a.onLoad=function(){};a.onClosed=function(){};a.overlayElement=null;$.extend(true,a,b);a.eTipoCuenta={CuentaCambio:1,CuentaContable:2,CuentaContableBancaria:3};a.opciones=null;a.cuentaSeleccionada=null;a.decimalCount=10;a.items=[];a.show=function(){var c=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,showOverlay:true,requestUrl:"balanzcambio/movimientosTesoreria/obtenerDatos",requestType:"GET"});c.onSuccess=function(d){a.opciones=d;a.ddlTipoMovimiento=a.container.find(".dropdown-tipo-movimiento");a.ddlTipoMovimiento.shieldDropDown({dataSource:{data:a.opciones.TiposMovimientos},valueTemplate:"{idTipoMovimiento}",textTemplate:"{Descripcion}",value:"",events:{select:function(e){a.setControlsByTipoMovimiento()}}});Core.Functions.Validations.toggleValidation(a.ddlTipoMovimiento,false);a.txtIdExterno=a.container.find(".textbox-id-externo");a.txtIdExterno.shieldTextBox({value:""});a.txtFechaConcertacion=a.container.find(".date-picker-fecha-concertacion");a.txtFechaConcertacion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date()});Core.Functions.Validations.toggleValidation(a.txtFechaConcertacion,false);a.txtFechaLiquidacion=a.container.find(".date-picker-fecha-liquidacion");a.txtFechaLiquidacion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date()});Core.Functions.Validations.toggleValidation(a.txtFechaLiquidacion,false);a.divCuenta=a.container.find(".div-cuenta");a.lblCuenta=a.container.find(".lbl-cuenta");a.btnCuenta=a.container.find(".button-buscar-cuentas");a.ddlCuenta=a.container.find(".dropdown-cuenta");a.ddlCuenta.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idCuentaContable}",textTemplate:"{Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""}]}},value:"",events:{select:function(e){a.setControlsByCuenta()}}});a.btnCuenta.unbind("click");a.btnCuenta.click(function(){new Core.Business.BalanzCambioMovimientosTesoreria.NuevoMovimiento.BuscarCuentas({onSelected:function(e){a.cuentaSeleccionada=e;a.setControlsByCuenta()}}).show()});a.lblInfoCuenta=a.container.find(".label-cuenta-info");a.lblInfoCuenta.text("Cuenta no seleccionada");Core.Functions.Validations.toggleValidation(a.ddlCuenta,false);a.ddlMoneda=a.container.find(".dropdown-moneda");a.ddlMoneda.shieldDropDown({dataSource:{data:a.opciones.Monedas},valueTemplate:"{idMoneda}",textTemplate:"{Descripcion}",value:"",events:{select:function(e){a.setControlsByMoneda()}}});Core.Functions.Validations.toggleValidation(a.ddlMoneda,false);a.txtCotizacion=a.container.find(".textbox-cotizacion");new Core.Controls.DecimalPicker(a.txtCotizacion,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:""});Core.Functions.Validations.toggleValidation(a.txtCotizacion,false);a.btnNuevoItem=a.container.find(".btn-nuevo-item");a.btnNuevoItem.unbind("click");a.btnNuevoItem.on("click",function(){a.addNewItem(true)});a.divItems=a.container.find(".div-items");a.divItems.empty();a.lblCuentaContable=a.container.find(".lbl-cuenta-contable");a.lblTotal=a.container.find(".lbl-total");a.total=0;a.txtComentarios=a.container.find(".textbox-comentarios");a.txtComentarios.shieldTextBox({value:""});a.btnConfirmar=a.container.find(".btn-confirmar");a.btnConfirmar.unbind("click");a.btnConfirmar.on("click",function(){Core.Functions.Validations.toggleValidation(a.ddlTipoMovimiento,false);Core.Functions.Validations.toggleValidation(a.txtFechaConcertacion,false);Core.Functions.Validations.toggleValidation(a.txtFechaLiquidacion,false);Core.Functions.Validations.toggleValidation(a.ddlCuenta,false);Core.Functions.Validations.toggleValidation(a.ddlMoneda,false);Core.Functions.Validations.toggleValidation(a.txtCotizacion,false);a.items.forEach(function(j,h){Core.Functions.Validations.toggleValidation(j.ddlCuentaContable,false);Core.Functions.Validations.toggleValidation(j.txtImporte,false)});var g={value:true};var e={data:{}};e.data.idTipoMovimiento=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoMovimiento,g);e.data.idExterno=a.txtIdExterno.swidget().value();e.data.FechaConcertacion=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaConcertacion,g));e.data.FechaLiquidacion=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaLiquidacion,g));e.data.idCuentaCambio=((a.ddlTipoMovimiento.swidget().selectedItem().TipoCuenta==a.eTipoCuenta.CuentaCambio)?a.getCuentaCambio(g):0);e.data.idCuentaContable=((a.ddlTipoMovimiento.swidget().selectedItem().TipoCuenta!=a.eTipoCuenta.CuentaCambio)?Core.Functions.Validations.getValidatedDropDownValue(a.ddlCuenta,g):0);e.data.idMoneda=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMoneda,g);e.data.Cotizacion=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedPositiveNumericInputValue(a.txtCotizacion,g));e.data.Comentario=a.txtComentarios.swidget().value();e.data.Items=[];a.items.forEach(function(i,h){e.data.Items.push({Item:(h+1),idCuentaContable:Core.Functions.Validations.getValidatedDropDownValue(i.ddlCuentaContable,g),Importe:Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedPositiveNumericInputValue(i.txtImporte,g))})});if(g.value&&a.total==0){g.value=false;new Core.Controls.Dialog("Aviso","El total debe ser mayor a 0.",{displayButtons:{close:true,accept:false}}).show()}if(!g.value){return}var f=new Core.Ajax.ServerRequest({overlayElement:a.btnConfirmar,showOverlay:true,requestUrl:"balanzcambio/movimientosTesoreria/insertarMovimientoTesoreria",requestType:"POST",requestData:e});f.onSuccess=function(h){a.onSave();a.destroy()};f.request()});a.btnVolver=a.container.find(".btn-volver");a.btnVolver.unbind("click");a.btnVolver.on("click",function(){a.destroy()});a.setControlsByTipoMovimiento();a.onLoad()};c.request()};a.getCuentaCambio=function(c){if(a.cuentaSeleccionada){return a.cuentaSeleccionada.idCuentaCambio}else{c.value=false;new Core.Controls.Dialog("Aviso","Debe seleccionar una cuenta cambio.",{displayButtons:{close:true,accept:false}}).show()}};a.addNewItem=function(d){var c={};c.divItem=$("<tr></tr>").appendTo(a.divItems);c.divCuentaContable=$("<td></td>").appendTo(c.divItem);c.divContainerCuentaContable=$('<div class="control-group form-group" style="margin: 5px 5px 5px 0px;"></div>').appendTo(c.divCuentaContable);c.ddlCuentaContable=$('<select class="form-control"></select>').appendTo(c.divContainerCuentaContable);c.ddlCuentaContable.shieldComboBox({dataSource:{data:((a.ddlMoneda.swidget().selectedItem())?$.grep(a.opciones.CuentasContables,function(f,e){return f.idMoneda==a.ddlMoneda.swidget().selectedItem().idMoneda}):a.opciones.CuentasContables)},valueTemplate:"{idCuentaContable}",textTemplate:"{Descripcion}",value:"",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""}]}}});Core.Functions.Validations.toggleValidation(c.ddlCuentaContable,false);c.divImporte=$("<td></td>").appendTo(c.divItem);c.divContainerImporte=$('<div class="control-group form-group" style="margin: 5px 0px 5px 0px;"></div>').appendTo(c.divImporte);c.txtImporte=$('<input type="text" class="form-control" />').appendTo(c.divContainerImporte);new Core.Controls.DecimalPicker(c.txtImporte,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:"",onChange:function(){a.setTotal()}});Core.Functions.Validations.toggleValidation(c.txtImporte,false);c.divAcciones=$("<td></td>").appendTo(c.divItem);c.btnEliminar=$('<button type="button" title="Eliminar item" class="btn-sm balanz-button right"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(c.divAcciones);c.btnEliminar.click(function(){c.divItem.hide();a.items.remove(c);a.setTotal()});if(!d){c.btnEliminar.hide()}a.items.push(c)};a.setControlsByTipoMovimiento=function(){a.btnCuenta.hide();a.divCuenta.hide();a.lblCuenta.text("Cuenta");a.lblCuentaContable.text("Cuenta Contable");if(a.ddlTipoMovimiento.swidget().selectedItem()){if(a.ddlTipoMovimiento.swidget().selectedItem().idTipoMovimiento==5){a.lblCuenta.text("Desde");a.lblCuentaContable.text("Hacia")}if(a.ddlTipoMovimiento.swidget().selectedItem().TipoCuenta==a.eTipoCuenta.CuentaCambio){a.btnCuenta.show()}else{a.divCuenta.show()}var d=a.ddlCuenta.swidget().initialOptions;d.dataSource.data=((a.ddlTipoMovimiento.swidget().selectedItem().TipoCuenta==a.eTipoCuenta.CuentaContableBancaria)?$.grep(a.opciones.CuentasContables,function(f,e){return f.idCuentaBancaria>0}):a.opciones.CuentasContables);a.ddlCuenta.swidget().refresh(d);a.items=[];a.divItems.empty();a.btnNuevoItem.show();if(a.ddlTipoMovimiento.swidget().selectedItem().Items){a.btnNuevoItem.hide();for(var c=0;c<a.ddlTipoMovimiento.swidget().selectedItem().Items;c++){a.addNewItem(false)}}a.setTotal();a.setControlsByCuenta()}};a.setControlsByCuenta=function(){if(a.ddlTipoMovimiento.swidget().selectedItem()){if(a.ddlTipoMovimiento.swidget().selectedItem().TipoCuenta==a.eTipoCuenta.CuentaCambio){a.ddlMoneda.swidget().enabled(true);a.lblInfoCuenta.text(a.cuentaSeleccionada?(a.cuentaSeleccionada.NumCuentaCambio+" - "+a.cuentaSeleccionada.Descripcion):"Cuenta no seleccionada")}else{a.ddlMoneda.swidget().enabled(false);a.ddlMoneda.swidget().value(a.ddlCuenta.swidget().selectedItem()?a.ddlCuenta.swidget().selectedItem().idMoneda.toString():"");a.lblInfoCuenta.text(a.ddlCuenta.swidget().selectedItem()?(a.ddlCuenta.swidget().selectedItem().Codigo+" - "+a.ddlCuenta.swidget().selectedItem().Descendecia):"Cuenta no seleccionada")}a.setControlsByMoneda()}};a.setControlsByMoneda=function(){a.txtCotizacion.removeAttr("disabled");if(a.ddlMoneda.swidget().selectedItem()){if(a.ddlMoneda.swidget().selectedItem().idMoneda==Core.Enums.Currency.Pesos.idMoneda){a.txtCotizacion.attr("disabled","disabled");a.txtCotizacion.val("1");a.txtCotizacion.blur()}else{if(a.txtFechaConcertacion.swidget().value()){var c=new Core.Ajax.ServerRequest({showOverlay:true,requestUrl:"balanzcambio/comun/obtenerCotizacion/"+a.ddlMoneda.swidget().selectedItem().idMoneda+"/"+Core.Functions.Date.getDateAsString(a.txtFechaConcertacion.swidget().value()),requestType:"GET"});c.onSuccess=function(d){if(d.Cotizacion&&d.Cotizacion[0]){a.txtCotizacion.val(d.Cotizacion[0].Cotizacion);a.txtCotizacion.blur()}};c.request()}}}a.items.forEach(function(f,d){var e=f.ddlCuentaContable.swidget().initialOptions;e.dataSource.data=((a.ddlMoneda.swidget().selectedItem())?$.grep(a.opciones.CuentasContables,function(h,g){return h.idMoneda==a.ddlMoneda.swidget().selectedItem().idMoneda}):a.opciones.CuentasContables);f.ddlCuentaContable.swidget().refresh(e)})};a.setTotal=function(){a.total=0;a.items.forEach(function(e,c){var d=(e.txtImporte.val()?Core.Functions.Decimal.parseFloat(e.txtImporte.val()):0);a.total+=d});a.lblTotal.text(Core.Functions.grid.formatNumber(a.total.toFixed(6)))};a.destroy=function(){a.ddlTipoMovimiento.swidget().destroy();a.txtIdExterno.swidget().destroy();a.txtFechaConcertacion.swidget().destroy();a.txtFechaLiquidacion.swidget().destroy();a.ddlCuenta.swidget().destroy();a.ddlMoneda.swidget().destroy();a.txtComentarios.swidget().destroy();a.onClosed()}};Core.Business.BalanzCambioMovimientosTesoreria.NuevoMovimiento.BuscarCuentas=function(b){var a=this;a.divModal=$(".modal-buscar-cuentas-cambio");a.divGridCuentas=null;a.onSelected=function(){};$.extend(true,a,b);a.show=function(){a.divGridCuentas=a.divModal.find(".div-cuentas-options");a.txtFilter=a.divModal.find(".textbox-filter-cuentas");a.initControls();a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.txtFilter.swidget().focus(true);a.divModal.modal({show:true})};a.initControls=function(){a.divGridCuentas.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:[{field:"NumCuentaCambio",width:"15%",title:"Cuenta Cambio",headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"CUIT_CUIL",width:"20%",title:"CUIT / CUIL",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{field:"Descripcion",width:"55%",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"",title:" ",width:"10%",headerAttributes:Core.Functions.grid.getCellOddClass(),buttons:[{caption:"Seleccionar",cls:"",commandName:"Seleccionar",click:function(d){var c=a.divGridCuentas.swidget().dataItem(d);a.onSelected(c);a.divModal.modal("hide")}}]}]});a.txtFilter.shieldTextBox({value:"",events:{blur:function(){a.loadGrid()}}})};a.loadGrid=function(){if(a.txtFilter.val()){var c=new Core.Ajax.ServerRequest({overlayElement:a.divModal.find(".modal-body"),showOverlay:true,secureRequest:true,requestUrl:"balanzcambio/comun/buscarCuentas",requestType:"GET",requestData:{Search:a.txtFilter.val()}});c.onSuccess=function(f){var d=f.Cuentas==null?[]:$.grep(f.Cuentas,function(h,g){return h.idEstadoCuenta==1});var e=a.divGridCuentas.swidget().initialOptions;e.dataSource.data=d;a.divGridCuentas.swidget().refresh(e)};c.request()}};a.destroy=function(){a.divGridCuentas.swidget().destroy();a.txtFilter.swidget().destroy()}};Core.Business.BCRAOperadoresCambio=new function(){var a=this;a.id="homeBCRAOperadoresCambio";a.divOperadoresCambio=null;a.lblTitle=null;a.txtAño=null;a.ddlMes=null;a.btnBuscar=null;a.btnDescargar=null;a.pageOptions=null;a.timeout=null;a.init=function(b,c){Core.loadPage("bcra-operadores-cambio.html",function(){document.title="BCRA Operadores Cambio";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divOperadoresCambio=$(".div-operadores-cambio");a.lblTitle=$(".label-title");a.txtAño=$(".textbox-anio");a.ddlMes=$(".dropdown-mes");a.btnBuscar=$(".btn-buscar");a.btnDescargar=$(".btn-descargar");a.initControls();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.BCRAOperadoresCambio")})};a.initControls=function(){var b=new Date();a.txtAño.shieldNumericTextBox({min:1900,max:b.getFullYear(),step:1,value:b.getFullYear().toString()});a.ddlMes.shieldDropDown({dataSource:{data:[{text:"Enero",value:1},{text:"Febrero",value:2},{text:"Marzo",value:3},{text:"Abril",value:4},{text:"Mayo",value:5},{text:"Junio",value:6},{text:"Julio",value:7},{text:"Agosto",value:8},{text:"Septiembre",value:9},{text:"Octubre",value:10},{text:"Noviembre",value:11},{text:"Diciembre",value:12}]},textTemplate:"{text}",valueTemplate:"{value}",value:(b.getMonth()).toString()});a.btnBuscar.on("click",function(){a.loadGrid()});a.btnDescargar.on("click",function(){function d(l){var k=new Blob([l.response],{type:l.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(k);return}var e=window.URL.createObjectURL(k);var j=document.createElement("a");j.href=e;var g=l.getResponseHeader("Content-Disposition").split("; ");var f="filename=file.DAT";for(var h=0;h<g.length;h++){if(g[h].indexOf("filename")>=0){f=g[h]}}j.download=f.split("=")[1];j.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(e)}if(a.validInputs()){var c=new XMLHttpRequest();c.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"reporteBCRA/operadoresCambio/archivo/"+a.ddlMes.swidget().value()+"/"+a.txtAño.swidget().value(),true);c.responseType="blob";c.setRequestHeader("Authorization",Core.Objects.Context.Token);c.onload=function(e){if(c.status==200){d(c)}else{var f=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga del archivo.</p>",{displayButtons:{close:true,accept:false}});f.show()}};c.send()}})};a.initGrid=function(){a.divOperadoresCambio.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],paging:{pageSize:100,pageLinksCount:10},exportOptions:{excel:{fileName:"BCRA Operadores Cambio",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:[],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"BCRA Operadores Cambio"}}},selection:false,rowHover:false,sorting:{multiple:true},columns:[]})};a.getColumns=function(c){var b={columns:[],columnsExcel:[]};if(c){$.each(c,function(d,e){b.columns.push({field:d,title:e,attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.columns.length),format:Core.Functions.grid.formatIntegerNumber});b.columnsExcel.push(d)})}return b};a.validInputs=function(){var e={value:true};Core.Functions.Validations.toggleValidation(a.txtAño,false);Core.Functions.Validations.toggleValidation(a.ddlMes,false);var d=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMes,e);var c=Core.Functions.Validations.getValidatedNumericSwidgetValue(a.txtAño,e);var b=new Date();if(e.value&&c==b.getFullYear()&&d>(b.getMonth()+1)){Core.Functions.Validations.toggleValidation(a.txtAño,true);Core.Functions.Validations.toggleValidation(a.ddlMes,true);e.value=false}return e.value};a.loadGrid=function(){if(a.validInputs()){a.lblTitle.text("Año: "+a.txtAño.swidget().value()+" | Mes: "+a.ddlMes.swidget().selectedItem().text);var b=new Core.Ajax.ServerRequest({overlayElement:a.divOperadoresCambio.parent(),secureRequest:true,requestUrl:"reporteBCRA/operadoresCambio/cuadro/"+a.ddlMes.swidget().value()+"/"+a.txtAño.swidget().value(),requestType:"GET"});b.onSuccess=function(f){var d=f.cuadro?f.cuadro:[];var c=a.getColumns(d.shift());var e=a.divOperadoresCambio.swidget().initialOptions;e.columns=c.columns;e.dataSource.data=d;e.exportOptions.excel.columnFields=c.columnsExcel;e.exportOptions.excel.dataSource.data=d;e.exportOptions.excel.readDataSource=true;a.divOperadoresCambio.swidget().refresh(e)};b.request()}}};Core.Business.Boletos=new function(){var a=this;a.id="boletos";a.divBoletos=null;a.lblTitle=null;a.txtDateFrom=null;a.txtDateTo=null;a.init=function(b,c){Core.loadPage("boletos.html",function(){document.title="Boletos";a.divBoletos=$(".div-boletos");a.lblTitle=$(".label-title");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.initDatePickers();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,b,c,a.loadGrid,"Core.Business.Boletos")})};a.initDatePickers=function(){var b=new Date();b.setDate(b.getDate()-31);a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:b,max:new Date(),events:{change:function(c){a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loadGrid()}}})};a.initGrid=function(){var b=[];b.push({field:"NumBoleto",title:"Número",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Operacion",title:"Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Ticker",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});if(!Core.Functions.isMobile&&!Core.Functions.isTablet){b.push({field:"Especie",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"20%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)})}b.push({field:"Concertacion",title:"Concertación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Liquidacion",title:"Liquidación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Cantidad",title:"Cant.",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumber});b.push({field:"Precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatPrice});if(!Core.Functions.isMobile&&!Core.Functions.isTablet){b.push({field:"Bruto",title:"Bruto",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumber});b.push({field:"CostosMercado",title:"C. Mdo",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumber});b.push({field:"Arancel",title:"Arancel",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumber})}b.push({field:"Neto",title:"Neto",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumber});b.push({field:"Moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});a.divBoletos.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"boletos",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["NumBoleto","Operacion","Ticker","Especie","Concertacion","Liquidacion","Cantidad","Precio","Bruto","CostosMercado","Arancel","Neto","Moneda"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"boletos"}}},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},grouping:{showGroupHeader:true,allowDragToGroup:true,message:"Arrastre un encabezado de columna para agrupar por esa columna"},columns:b})};a.loadGrid=function(){a.lblTitle.text("Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var b;b="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));b+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));var c=new Core.Ajax.ServerRequest({overlayElement:a.divBoletos.parent(),secureRequest:true,requestUrl:"boletos/"+encodeURIComponent(a.header.selectedIdAccount),requestType:"GET",requestData:b});c.onSuccess=function(d){var e=a.divBoletos.swidget().initialOptions;e.dataSource.data=d;e.dataSource.schema={data:"boletos"};e.dataSource.group=[{field:"Concertacion",order:"asc"}];e.exportOptions.excel.dataSource.data=d;e.exportOptions.excel.dataSource.schema={data:"boletos"};e.exportOptions.excel.readDataSource=true;a.divBoletos.swidget().refresh(e)};c.request()}};Core.Business.Bonos=new function(){var a=this;a.id="cot_bonos";a.optionsCotizaciones=null;a.divBonos=null;a.divChksMonedas=null;a.lblChkPesos=null;a.chkPesos=null;a.lblChkDolaresMep=null;a.chkDolaresMep=null;a.lblChkDolaresCable=null;a.chkDolaresCable=null;a.txtFilterBonos=null;a.timeoutBonos=null;a.divPlazo=null;a.ddlPlazo=null;a.maxToken=0;a.lastData=null;a.window=$(window);a.timerId=null;a.timerIdForceRefresh=null;a.loaded=false;a.refresh=false;a.forceRefresh=false;a.init=function(b,c){Core.loadPage("bonos.html",function(){document.title="Bonos";a.loaded=false;a.refresh=false;a.forceRefresh=false;a.optionsCotizaciones=Core.Functions.Context.Profiles.getPageOptionsByMenu("cotizaciones",Core.Objects.Context.Profiles[c]);a.maxToken=0;a.lastData=null;a.divBonos=$(".div-bonos");a.txtFilterBonos=$(".textbox-bonos-filter");a.divChksMonedas=$(".div-chks-monedas");a.divChksMonedas.hide();a.lblChkPesos=$(".lbl-checkbox-pesos");a.chkPesos=$(".checkbox-pesos");a.chkPesos[0].checked=true;a.lblChkDolaresMep=$(".lbl-checkbox-dolares-mep");a.chkDolaresMep=$(".checkbox-dolares-mep");a.chkDolaresMep[0].checked=true;a.lblChkDolaresCable=$(".lbl-checkbox-dolares-cable");a.chkDolaresCable=$(".checkbox-dolares-cable");a.chkDolaresCable[0].checked=true;a.divPlazo=$(".div-plazo");a.ddlPlazo=$(".dropdown-plazo");a.divPlazo.hide();Core.Functions.grid.Cotizaciones.initGrid(a.divBonos,true,true,false,Core.Objects.Context.Profiles[c].opciones.maxWatchlists,null,null,a.optionsCotizaciones.cot_profundidad,Core.Enums.ePanel.Bonos,b,c);a.ddlPlazo.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",events:{select:function(d){a.setTab()}},width:150});a.chkPesos.on("change",function(){a.setTab()});a.chkDolaresMep.on("change",function(){a.setTab()});a.chkDolaresCable.on("change",function(){a.setTab()});Core.Functions.grid.Cotizaciones.initFilter(a.divBonos,a.txtFilterBonos,a.timeoutBonos,a.window);a.ddlInstrumentSearch=$(".dropdown-instrument-search");Core.Functions.grid.Cotizaciones.initInstrumentSearch(a.ddlInstrumentSearch,b,c);a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){Core.Functions.grid.Cotizaciones.loadInstrumentSearch(b,a.ddlInstrumentSearch,function(){a.setTab()})},"Core.Business.Bonos")})};a.setTab=function(){Core.Functions.grid.Cotizaciones.details=[];a.maxToken=0;a.lastData=null;a.refresh=false;a.forceRefresh=false;if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:0,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(b){}}window.clearInterval(a.timerId);Core.Objects.Context.Timers.remove(a.timerId);window.clearInterval(a.timerIdForceRefresh);Core.Objects.Context.Timers.remove(a.timerIdForceRefresh);Core.Functions.grid.Cotizaciones.loadGrid(a.divBonos,null,"bonos/1",a.lastData,a.maxToken,null,null,function(c,b){return(!a.loaded||(c.plazo==a.ddlPlazo.swidget().selectedItem().value&&a.filterMoneda(c.mo)))},function(e,f){a.lastData=e;a.maxToken=f;if(!a.loaded){var h=[];var g=[];a.lastData.forEach(function(j,i){if(h.indexOf(j.plazo)==-1){h.push(j.plazo)}if(g.indexOf(j.mo)==-1){g.push(j.mo)}});var b=[];h.forEach(function(j,i){b.push({value:j,text:j})});var c=a.ddlPlazo.swidget().initialOptions;c.dataSource.data=b;a.ddlPlazo.swidget().refresh(c);a.ddlPlazo.swidget().selected(h.length-1,true);if(h.length>1){a.divPlazo.show()}if(g.length>1){a.divChksMonedas.show();if(g.indexOf("Pesos")==-1){a.chkPesos.hide();a.lblChkPesos.hide()}if(g.indexOf("Dolar MEP")==-1){a.chkDolaresMep.hide();a.lblChkDolaresMep.hide()}if(g.indexOf("Dolar Cable")==-1){a.chkDolaresCable.hide();a.lblChkDolaresCable.hide()}}a.loaded=true;var d=a.divBonos.swidget().initialOptions;d.dataSource.data=$.grep(a.lastData,function(j,i){return j.plazo==a.ddlPlazo.val()&&a.filterMoneda(j.mo)});a.divBonos.swidget().refresh(d)}},a.optionsCotizaciones.cot_profundidad);a.timerId=window.setInterval(function(){if(a.loaded&&(a.refresh||a.forceRefresh)){Core.Functions.grid.Cotizaciones.loadGrid(a.divBonos,null,"bonos/1",a.lastData,a.maxToken,null,null,function(c,b){return c.plazo==a.ddlPlazo.swidget().selectedItem().value&&a.filterMoneda(c.mo)},function(b,c){a.lastData=b;a.maxToken=c},a.optionsCotizaciones.cot_profundidad);a.forceRefresh=false}a.refresh=true},Core.Functions.grid.Cotizaciones.REFRESH_TIME);Core.Objects.Context.Timers.push(a.timerId);a.timerIdForceRefresh=window.setInterval(function(){a.forceRefresh=true},600000);Core.Objects.Context.Timers.push(a.timerIdForceRefresh);if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:Core.Enums.ePanel.Bonos,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(c){if(a.loaded){var b={cotizaciones:[]};b.cotizaciones.push(JSON.parse(c.data));Core.Functions.grid.Cotizaciones.refreshGrid(b,a.divBonos,null,a.lastData,a.maxToken,null,null,function(e,d){return e.plazo==a.ddlPlazo.swidget().selectedItem().value&&a.filterMoneda(e.mo)},function(d,e){a.lastData=d;a.maxToken=e;a.refresh=false},a.optionsCotizaciones.cot_profundidad)}}}};a.filterMoneda=function(b){return(b=="Pesos"&&(!a.divChksMonedas.is(":visible")||(a.chkPesos[0].checked)))||(b=="Dolar MEP"&&(!a.divChksMonedas.is(":visible")||(a.chkDolaresMep[0].checked)))||(b=="Dolar Cable"&&(!a.divChksMonedas.is(":visible")||(a.chkDolaresCable[0].checked)))}};Core.Business.Cauciones=new function(){var a=this;a.id="cot_cauciones";a.optionsCotizaciones=null;a.divBonos=null;a.txtFilterBonos=null;a.divChksMonedas=null;a.lblChkPesos=null;a.chkPesos=null;a.lblChkDolaresMep=null;a.chkDolaresMep=null;a.lblChkDolaresCable=null;a.chkDolaresCable=null;a.timeoutBonos=null;a.maxToken=0;a.lastData=null;a.timerId=null;a.timerIdForceRefresh=null;a.loaded=false;a.refresh=false;a.forceRefresh=false;a.window=$(window);a.init=function(b,c){Core.loadPage("cauciones.html",function(){document.title="Cauciones";a.loaded=false;a.refresh=false;a.forceRefresh=false;a.optionsCotizaciones=Core.Functions.Context.Profiles.getPageOptionsByMenu("cotizaciones",Core.Objects.Context.Profiles[c]);a.maxToken=0;a.lastData=null;a.divBonos=$(".div-cauciones");a.txtFilterBonos=$(".textbox-cauciones-filter");a.divChksMonedas=$(".div-chks-monedas");a.divChksMonedas.hide();a.lblChkPesos=$(".lbl-checkbox-pesos");a.chkPesos=$(".checkbox-pesos");a.chkPesos[0].checked=true;a.lblChkDolaresMep=$(".lbl-checkbox-dolares-mep");a.chkDolaresMep=$(".checkbox-dolares-mep");a.chkDolaresMep[0].checked=true;a.lblChkDolaresCable=$(".lbl-checkbox-dolares-cable");a.chkDolaresCable=$(".checkbox-dolares-cable");a.chkDolaresCable[0].checked=true;Core.Functions.grid.Cotizaciones.initGrid(a.divBonos,true,true,false,Core.Objects.Context.Profiles[c].opciones.maxWatchlists,null,null,a.optionsCotizaciones.cot_profundidad,Core.Enums.ePanel.Cauciones,b,c);a.chkPesos.on("change",function(){a.setTab()});a.chkDolaresMep.on("change",function(){a.setTab()});a.chkDolaresCable.on("change",function(){a.setTab()});Core.Functions.grid.Cotizaciones.initFilter(a.divBonos,a.txtFilterBonos,a.timeoutBonos,a.window);a.ddlInstrumentSearch=$(".dropdown-instrument-search");Core.Functions.grid.Cotizaciones.initInstrumentSearch(a.ddlInstrumentSearch,b,c);a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){Core.Functions.grid.Cotizaciones.loadInstrumentSearch(b,a.ddlInstrumentSearch,function(){a.setTab()})},"Core.Business.Cauciones")})};a.setTab=function(){Core.Functions.grid.Cotizaciones.details=[];a.maxToken=0;a.lastData=null;a.refresh=false;a.forceRefresh=false;if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:0,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(b){}}window.clearInterval(a.timerId);Core.Objects.Context.Timers.remove(a.timerId);window.clearInterval(a.timerIdForceRefresh);Core.Objects.Context.Timers.remove(a.timerIdForceRefresh);Core.Functions.grid.Cotizaciones.loadGrid(a.divBonos,null,"panel/34",a.lastData,a.maxToken,null,null,function(c,b){return(!a.loaded||a.filterMoneda(c.mo))},function(c,d){a.lastData=c;a.maxToken=d;if(!a.loaded){var e=[];a.lastData.forEach(function(g,f){if(e.indexOf(g.mo)==-1){e.push(g.mo)}});if(e.length>1){a.divChksMonedas.show();if(e.indexOf("Pesos")==-1){a.chkPesos.hide();a.lblChkPesos.hide()}if(e.indexOf("Dolar MEP")==-1){a.chkDolaresMep.hide();a.lblChkDolaresMep.hide()}if(e.indexOf("Dolar Cable")==-1){a.chkDolaresCable.hide();a.lblChkDolaresCable.hide()}}a.loaded=true;var b=a.divBonos.swidget().initialOptions;b.dataSource.data=$.grep(a.lastData,function(g,f){return(a.filterMoneda(g.mo))});a.divBonos.swidget().refresh(b)}},a.optionsCotizaciones.cot_profundidad);a.timerId=window.setInterval(function(){if(a.loaded&&(a.refresh||a.forceRefresh)){Core.Functions.grid.Cotizaciones.loadGrid(a.divBonos,null,"panel/34",a.lastData,a.maxToken,null,null,function(c,b){return(a.filterMoneda(c.mo))},function(b,c){a.lastData=b;a.maxToken=c},a.optionsCotizaciones.cot_profundidad);a.forceRefresh=false}a.refresh=true},Core.Functions.grid.Cotizaciones.REFRESH_TIME);Core.Objects.Context.Timers.push(a.timerId);a.timerIdForceRefresh=window.setInterval(function(){a.forceRefresh=true},600000);Core.Objects.Context.Timers.push(a.timerIdForceRefresh);if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:Core.Enums.ePanel.Cauciones,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(c){if(a.loaded){var b={cotizaciones:[]};b.cotizaciones.push(JSON.parse(c.data));Core.Functions.grid.Cotizaciones.refreshGrid(b,a.divBonos,null,a.lastData,a.maxToken,null,null,function(e,d){return(a.filterMoneda(e.mo))},function(d,e){a.lastData=d;a.maxToken=e;a.refresh=false},a.optionsCotizaciones.cot_profundidad)}}}};a.filterMoneda=function(b){return(b=="Pesos"&&(!a.divChksMonedas.is(":visible")||(a.chkPesos[0].checked)))||(b=="Dolar MEP"&&(!a.divChksMonedas.is(":visible")||(a.chkDolaresMep[0].checked)))||(b=="Dolar Cable"&&(!a.divChksMonedas.is(":visible")||(a.chkDolaresCable[0].checked)))}};Core.Business.Cedears=new function(){var a=this;a.id="cot_cedears";a.optionsCotizaciones=null;a.divBonos=null;a.txtFilterBonos=null;a.divChksMonedas=null;a.lblChkPesos=null;a.chkPesos=null;a.lblChkDolaresMep=null;a.chkDolaresMep=null;a.lblChkDolaresCable=null;a.chkDolaresCable=null;a.divPlazo=null;a.ddlPlazo=null;a.timeoutBonos=null;a.maxToken=0;a.lastData=null;a.timerId=null;a.timerIdForceRefresh=null;a.loaded=false;a.refresh=false;a.forceRefresh=false;a.window=$(window);a.init=function(b,c){Core.loadPage("cedears.html",function(){document.title="Cedears";a.loaded=false;a.refresh=false;a.forceRefresh=false;a.optionsCotizaciones=Core.Functions.Context.Profiles.getPageOptionsByMenu("cotizaciones",Core.Objects.Context.Profiles[c]);a.maxToken=0;a.lastData=null;a.divBonos=$(".div-cedears");a.txtFilterBonos=$(".textbox-cedears-filter");a.divChksMonedas=$(".div-chks-monedas");a.divChksMonedas.hide();a.lblChkPesos=$(".lbl-checkbox-pesos");a.chkPesos=$(".checkbox-pesos");a.chkPesos[0].checked=true;a.lblChkDolaresMep=$(".lbl-checkbox-dolares-mep");a.chkDolaresMep=$(".checkbox-dolares-mep");a.chkDolaresMep[0].checked=false;a.lblChkDolaresCable=$(".lbl-checkbox-dolares-cable");a.chkDolaresCable=$(".checkbox-dolares-cable");a.chkDolaresCable[0].checked=false;a.divPlazo=$(".div-plazo");a.ddlPlazo=$(".dropdown-plazo");a.divPlazo.hide();Core.Functions.grid.Cotizaciones.initGrid(a.divBonos,true,true,false,Core.Objects.Context.Profiles[c].opciones.maxWatchlists,null,null,a.optionsCotizaciones.cot_profundidad,Core.Enums.ePanel.Cedears,b,c);a.ddlPlazo.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",events:{select:function(d){a.setTab()}},width:150});a.chkPesos.on("change",function(){a.setTab()});a.chkDolaresMep.on("change",function(){a.setTab()});a.chkDolaresCable.on("change",function(){a.setTab()});Core.Functions.grid.Cotizaciones.initFilter(a.divBonos,a.txtFilterBonos,a.timeoutBonos,a.window);a.ddlInstrumentSearch=$(".dropdown-instrument-search");Core.Functions.grid.Cotizaciones.initInstrumentSearch(a.ddlInstrumentSearch,b,c);a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){Core.Functions.grid.Cotizaciones.loadInstrumentSearch(b,a.ddlInstrumentSearch,function(){a.setTab()})},"Core.Business.Cedears")})};a.setTab=function(){Core.Functions.grid.Cotizaciones.details=[];a.maxToken=0;a.lastData=null;a.refresh=false;a.forceRefresh=false;if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:0,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(b){}}window.clearInterval(a.timerId);Core.Objects.Context.Timers.remove(a.timerId);window.clearInterval(a.timerIdForceRefresh);Core.Objects.Context.Timers.remove(a.timerIdForceRefresh);Core.Functions.grid.Cotizaciones.loadGrid(a.divBonos,null,"cedears",a.lastData,a.maxToken,null,null,function(c,b){return(!a.loaded||(c.plazo==a.ddlPlazo.swidget().selectedItem().value&&a.filterMoneda(c.mo)))},function(e,f){a.lastData=e;a.maxToken=f;if(!a.loaded){var h=[];var g=[];a.lastData.forEach(function(j,i){if(h.indexOf(j.plazo)==-1){h.push(j.plazo)}if(g.indexOf(j.mo)==-1){g.push(j.mo)}});var b=[];h.forEach(function(j,i){b.push({value:j,text:j})});var c=a.ddlPlazo.swidget().initialOptions;c.dataSource.data=b;a.ddlPlazo.swidget().refresh(c);a.ddlPlazo.swidget().selected(h.length-1,true);if(h.length>1){a.divPlazo.show()}if(g.length>1){a.divChksMonedas.show();if(g.indexOf("Pesos")==-1){a.chkPesos.hide();a.lblChkPesos.hide()}if(g.indexOf("Dolar MEP")==-1){a.chkDolaresMep.hide();a.lblChkDolaresMep.hide()}if(g.indexOf("Dolar Cable")==-1){a.chkDolaresCable.hide();a.lblChkDolaresCable.hide()}}a.loaded=true;a.lastData=$.grep(a.lastData,function(j,i){return(j.plazo==a.ddlPlazo.swidget().selectedItem().value&&a.filterMoneda(j.mo))});var d=a.divBonos.swidget().initialOptions;d.dataSource.data=a.lastData;a.divBonos.swidget().refresh(d)}},a.optionsCotizaciones.cot_profundidad);a.timerId=window.setInterval(function(){if(a.loaded&&(a.refresh||a.forceRefresh)){Core.Functions.grid.Cotizaciones.loadGrid(a.divBonos,null,"cedears",a.lastData,a.maxToken,null,null,function(c,b){return(c.plazo==a.ddlPlazo.swidget().selectedItem().value&&a.filterMoneda(c.mo))},function(b,c){a.lastData=b;a.maxToken=c},a.optionsCotizaciones.cot_profundidad);a.forceRefresh=false}a.refresh=true},Core.Functions.grid.Cotizaciones.REFRESH_TIME);Core.Objects.Context.Timers.push(a.timerId);a.timerIdForceRefresh=window.setInterval(function(){a.forceRefresh=true},600000);Core.Objects.Context.Timers.push(a.timerIdForceRefresh);if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:Core.Enums.ePanel.Cedears,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(c){if(a.loaded){var b={cotizaciones:[]};b.cotizaciones.push(JSON.parse(c.data));Core.Functions.grid.Cotizaciones.refreshGrid(b,a.divBonos,null,a.lastData,a.maxToken,null,null,function(e,d){return(e.plazo==a.ddlPlazo.swidget().selectedItem().value&&a.filterMoneda(e.mo))},function(d,e){a.lastData=d;a.maxToken=e;a.refresh=false},a.optionsCotizaciones.cot_profundidad)}}}};a.filterMoneda=function(b){return(b=="Pesos"&&(!a.divChksMonedas.is(":visible")||(a.chkPesos[0].checked)))||(b=="Dolar MEP"&&(!a.divChksMonedas.is(":visible")||(a.chkDolaresMep[0].checked)))||(b=="Dolar Cable"&&(!a.divChksMonedas.is(":visible")||(a.chkDolaresCable[0].checked)))}};Core.Business.Clientes=new function(){var b=this;var a=13;b.id="homeClientes";b.divContainerClientes=null;b.divClientes=null;b.pageOptions=null;b.txtFilter=null;b.txtSearch=null;b.btnSearch=null;b.timeout=null;b.init=function(c,d){Core.loadPage("clientes.html",function(){document.title="Clientes";b.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(b.id,Core.Objects.Context.Profiles[d]);b.divClientes=$(".div-clientes");b.divContainerClientes=$(".div-container-clientes");b.divContainerClientes.hide();b.txtFilter=$(".textbox-filter");b.txtSearch=$(".textbox-search");b.btnSearch=$(".btn-search");b.initControls();b.header=new Core.Controls.Header($("#topNav"),{});b.header.init(false,c,d,function(){if(Core.Objects.AsesoresPorClientes){b.txtFilter.keydown();b.divContainerClientes.show()}},"Core.Business.Clientes")})};b.initControls=function(){b.divClientes.shieldGrid({dataSource:{data:Core.Objects.AsesoresPorClientes?Core.Objects.AsesoresPorClientes:[]},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:50,pageLinksCount:10},columns:[{width:30,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(c,d,e){if(d.idNegocio==Core.Enums.eNegocio.BCI){$('<img src="/images/icono-internacional.svg" style="margin-left:10px; width:20px; height:20px;" />').appendTo(c)}}},{width:"25%",field:"Descripcion",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"7%",field:"Comitente",title:"Comitente",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"7%",field:"Cuotapartista",title:"Cuotapartista",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"12%",field:"Asesor",title:"Asesor",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"12%",field:"Equipo",title:"Equipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"12%",field:"UnidadDeNegocio",title:"Unidad de Negocio",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"25%",field:"Condominios",title:"Condominios",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString}]});b.txtFilter.on("keydown",function(){clearTimeout(b.timeout);b.timeout=setTimeout(function(){value=b.txtFilter.val();var c=b.divClientes.swidget().dataSource;if(value){c.filter={or:[{path:"Descripcion",filter:"contains",value:value},{path:"Comitente",filter:"contains",value:value},{path:"Cuotapartista",filter:"contains",value:value},{path:"Asesor",filter:"contains",value:value},{path:"Equipo",filter:"contains",value:value},{path:"UnidadDeNegocio",filter:"contains",value:value},{path:"Condominios",filter:"contains",value:value}]}}else{c.filter=null}c.read()},50)});Core.Functions.Persistence.setTextBox(b.txtFilter,"Core.Business.Clientes.txtFilter");b.txtSearch.on("keyup",function(c){if(c.keyCode==a){b.loadGrid()}});Core.Functions.Persistence.setTextBox(b.txtSearch,"Core.Business.Clientes.txtSearch");b.btnSearch.on("click",function(){b.loadGrid()})};b.loadGrid=function(){Core.Objects.AsesoresPorClientes=null;b.divContainerClientes.hide();if(b.txtSearch.val()&&b.txtSearch.val().length>=3){var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"clientes/asesoresPorClientes?search="+b.txtSearch.val(),requestType:"GET"});c.onSuccess=function(e){Core.Objects.AsesoresPorClientes=e.clientesAsesores;var d=b.divClientes.swidget().initialOptions;d.dataSource.data=e.clientesAsesores;b.divClientes.swidget().refresh(d);b.txtFilter.keydown();b.divContainerClientes.show()};c.request()}else{new Core.Controls.Dialog("Aviso","<p>Debe ingresar un patrón de búsqueda de al menos 3 caracteres.</p>",{displayButtons:{close:true,accept:false}}).show()}}};Core.Business.Comisiones=new function(){var a=this;a.id="homeComisiones";a.divComisiones=null;a.lblTitle=null;a.txtDateFrom=null;a.txtDateTo=null;a.txtFilter=null;a.lblChkCuentasPropias=null;a.chkCuentasPropias=null;a.pageOptions=null;a.timeout=null;a.init=function(b,c){Core.loadPage("comisiones.html",function(){document.title="Comisiones";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divComisiones=$(".div-comisiones");a.lblTitle=$(".label-title");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.txtFilter=$(".textbox-filter");a.initDatePickers();a.initGrid();a.chkCuentasPropias=$(".checkbox-cuentas-propias");a.lblChkCuentasPropias=$(".lbl-checkbox-cuentas-propias");a.chkCuentasPropias[0].checked=true;a.chkCuentasPropias.on("change",function(){a.loadGrid()});a.lblChkCuentasPropias.hide();a.chkCuentasPropias.hide();if(a.pageOptions&&a.pageOptions.verTodasLasComisiones){a.lblChkCuentasPropias.show();a.chkCuentasPropias.show()}a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var d=a.divComisiones.swidget().dataSource;if(value){d.filter={or:[{path:"Comitente",filter:"contains",value:value},{path:"Cuotapartista",filter:"contains",value:value},{path:"Cuenta",filter:"contains",value:value},{path:"Descripcion",filter:"contains",value:value},{path:"Tipo",filter:"contains",value:value}]}}else{d.filter=null}d.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.Comisiones.txtFilter");a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.Comisiones")})};a.initDatePickers=function(){var b=new Date();b.setDate(1);a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:b,max:new Date(),events:{change:function(c){a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loadGrid()}}})};a.initGrid=function(){a.divComisiones.shieldGrid({dataSource:{data:[],aggregate:[{field:"FechaConcertacion",aggregate:"count"},{field:"IVAComision",aggregate:"sum"},{field:"ComisionPesificada",aggregate:"sum"},{field:"ComisionDolarizada",aggregate:"sum"}]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],paging:{pageSize:100,pageLinksCount:10},exportOptions:{excel:{fileName:"Comisiones",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:[],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Comisiones"}}},selection:false,rowHover:false,sorting:{multiple:true},columns:[]})};a.loadGrid=function(){a.lblTitle.text("Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var b;b="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));b+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));b+=("&propias="+((a.chkCuentasPropias[0].checked)?"1":"0"));var c=new Core.Ajax.ServerRequest({overlayElement:a.divComisiones.parent(),secureRequest:true,requestUrl:"comisiones/"+encodeURIComponent(Core.Objects.Context.IdPersona),requestType:"GET",requestData:b});c.onSuccess=function(f){var d=[];var e=[];d.push({footerTemplate:"<div style='text-align: center;'>Cantidad: {count}</div>",field:"FechaConcertacion",title:"Fecha",width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});e.push("FechaConcertacion");d.push({field:"Comitente",title:"Comitente",width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});e.push("Comitente");d.push({field:"Cuotapartista",title:"Cuotapartista",width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});e.push("Cuotapartista");d.push({field:"Cuenta",title:"Cuenta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"20%",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});e.push("Cuenta");d.push({field:"Tipo",title:"Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});e.push("Tipo");d.push({field:"Descripcion",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"24%",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});e.push("Descripcion");d.push({field:"Ticker",title:"Ticker",width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});e.push("Ticker");d.push({field:"Cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatNuleablePrice});e.push("Cantidad");d.push({field:"Precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatNuleablePrice});e.push("Precio");d.push({field:"PrecioRef",title:"Precio Referencia",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatNuleablePrice});e.push("PrecioRef");if(!Core.Objects.Context.Configuration.idAplicacion){d.push({field:"Precio2",title:"Precio Productor",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatNuleablePrice});e.push("Precio2")}d.push({footerTemplate:"<div style='text-align: right;'>{sum:c2}</div>",field:"ComisionPesificada",title:"Comisión Pesos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatNuleablePrice});e.push("ComisionPesificada");if(f.comisiones.length>0&&f.comisiones[0].ComisionDolarizada!=null){d.push({footerTemplate:"<div style='text-align: right;'>{sum:c2}</div>",field:"ComisionDolarizada",title:"Comisión Dólares",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatNuleablePrice});e.push("ComisionDolarizada");e.push("CotizacionDolar")}d.push({footerTemplate:"<div style='text-align: right;'>{sum:c2}</div>",field:"IVAComision",title:"IVA Comisión",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatNuleablePrice});e.push("IVAComision");e.push("Asesor");e.push("Equipo");e.push("UnidadDeNegocio");e.push("Referidor");e.push("Arancel");e.push("EsquemaComisiones");e.push("FechaAlta");e.push("Productor");var g=a.divComisiones.swidget().initialOptions;g.columns=d;g.dataSource.data=f;g.dataSource.schema={data:"comisiones"};g.exportOptions.excel.columnFields=e;g.exportOptions.excel.dataSource.data=f;g.exportOptions.excel.dataSource.schema={data:"comisiones"};g.exportOptions.excel.readDataSource=true;a.divComisiones.swidget().refresh(g);a.txtFilter.keydown()};c.request()}};Core.Business.ComisionesColocacionesPrimarias=new function(){var a=this;a.id="comisionesColocacionesPrimarias";a.idDefaultAccount=null;a.idDefaultProfile=null;a.txtDateFrom=null;a.txtDateTo=null;a.btnNueva=null;a.chkIncluirFinalizados=null;a.lblTitle=null;a.divColocacionesPrimarias=null;a.pageOptions=null;a.loaded=false;a.init=function(b,c){Core.loadPage("comisiones-colocaciones-primarias.html",function(){document.title="Comisiones Colocaciones Primarias";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.idDefaultAccount=b;a.idDefaultProfile=c;a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.chkIncluirFinalizados=$(".checkbox-incluir-finalizados");a.btnNueva=$(".btn-nueva");a.lblTitle=$(".label-title");a.divColocacionesPrimarias=$(".div-colocaciones-primarias");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loaded=false;a.loadGrid()},"Core.Business.ComisionesColocacionesPrimarias")})};a.initControls=function(){a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loaded=false;a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loaded=false;a.loadGrid()}}});a.chkIncluirFinalizados.on("change",function(){a.loaded=false;a.loadGrid()});a.btnNueva.on("click",function(){new Core.Business.ComisionesColocacionesPrimarias.Manager({overlayElement:a.btnNueva,onSuccess:function(){a.loaded=false;a.loadGrid()}}).show()});a.btnNueva.hide();if(a.pageOptions.comisionesColocacionesPrimariasAlta){a.btnNueva.show()}var b=[];b.push({field:"id",title:"ID",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"fechaCarga",title:"Fecha Carga",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatStringDate});b.push({field:"fechaColocacion",title:"Fecha Colocación",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatStringDate});b.push({field:"ticker",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Mercado",title:"Mercado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"FechaTope",title:"Fecha Tope",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatStringDate});b.push({field:"Monto",title:"Monto",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatPrice});b.push({title:"Obs.",width:75,headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,d,e){if(d.Observacion){var f=(d.length>140)?(d.Observacion.substr(0,140)+"..."):(d.Observacion);c.html('<button type="button" title="'+f+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');c.addClass("link-cell");c.on("click",function(){var g=new Core.Controls.Dialog("Observaciones",(d.Observacion)?d.Observacion:"",{displayButtons:{close:true,accept:false}});g.show()})}}});b.push({field:"Finalizado",title:"Finalizado",width:75,attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatBoolean});b.push({field:"Moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({title:" ",width:150,headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(f,g,h){var d=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(f);d.on("click",function(){new Core.Business.ComisionesColocacionesPrimarias.Detalle({overlayElement:d,comision:g}).show()});var e=$('<button type="button" title="Editar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-pencil"></span></button>').appendTo(f);e.on("click",function(){if(a.pageOptions.comisionesColocacionesPrimariasAsesores||!g.TieneDistribucion){new Core.Business.ComisionesColocacionesPrimarias.Manager({overlayElement:e,comision:g,onSuccess:function(){a.loaded=false;a.loadGrid()}}).show()}else{new Core.Business.ComisionesColocacionesPrimarias.ManagerDistribucion({overlayElement:e,comision:g,onSuccess:function(){a.loaded=false;a.loadGrid()}}).show()}});if(g.idColocacionUnidadDeNegocio==0){var c=$('<button type="button" title="Eliminar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(f);c.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar la colocación primaria de ID: "+g.id+"?",{onAccepted:function(){var i=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:c,secureRequest:true,requestUrl:("colocacionPrimaria/"+g.id),requestType:"DELETE"});i.onSuccess=function(j){a.loaded=false;a.loadGrid()};i.request()}}).show()})}}});a.divColocacionesPrimarias.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:b})};a.loadGrid=function(){a.lblTitle.text("Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var b="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));b+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));b+="&finalizados="+((a.chkIncluirFinalizados[0].checked)?"1":"0");var c=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"colocacionPrimarias",requestType:"GET",requestData:b});c.onSuccess=function(d){var e=a.divColocacionesPrimarias.swidget().initialOptions;e.dataSource.data=d;e.dataSource.schema={data:"colocacionesPrimarias"};e.dataSource.sort=a.divColocacionesPrimarias.swidget().dataSource.sort;a.divColocacionesPrimarias.swidget().refresh(e)};c.request()}};Core.Business.ComisionesColocacionesPrimarias.Detalle=function(b){var a=this;a.divModalDetalle=$(".div-comision-detalle");a.comision=null;a.overlayElement=null;a.title=null;a.divDetalle=null;$.extend(true,a,b);a.show=function(){var c=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,requestUrl:((a.comision&&a.comision.idColocacionUnidadDeNegocio>0)?("colocacionPrimarias/detalle/asesores/"+a.comision.idColocacionUnidadDeNegocio):("colocacionPrimarias/detalle/unidades/"+a.comision.id)),requestType:"GET"});c.onSuccess=function(g){a.divDetalle=a.divModalDetalle.find(".div-detalle");a.title=a.divModalDetalle.find(".lbl-title");a.title.text("Detalle ID: "+a.comision.id);function e(h){if(h=="1"){return"HEAD"}else{""}}var d=[];if(a.comision&&a.comision.idColocacionUnidadDeNegocio>0){d.push({field:"HeadUnidad",title:"Head Unidad",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:e});d.push({field:"Equipo",title:"Equipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedString});g.colocacionesPrimariasPorAsesor.sort(function(h,i){if(h.HeadUnidad>i.HeadUnidad){return -1}else{if(h.HeadUnidad<i.HeadUnidad){return 1}else{if(h.Equipo<i.Equipo){return -1}else{if(h.Equipo>i.Equipo){return 1}else{if(h.NombreAsesor<i.NombreAsesor){return -1}else{if(h.Monto>i.Monto){return -1}else{if(h.Monto<i.Monto){return 1}else{if(h.NombreAsesor>i.NombreAsesor){return 1}else{return 0}}}}}}}}})}else{d.push({field:"NombreHead",title:"Nombre Head",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedString});d.push({field:"UnidadDescripcion",title:"Unidad",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedString});g.colocacionesPrimariasPorUnidadNegocio.sort(function(h,i){if(h.Monto>i.Monto){return -1}else{if(h.Monto<i.Monto){return 1}else{if(h.UnidadDescripcion<i.UnidadDescripcion){return -1}else{if(h.UnidadDescripcion>i.UnidadDescripcion){return 1}else{if(h.NombreHead<i.NombreHead){return -1}else{if(h.NombreHead>i.NombreHead){return 1}else{return 0}}}}}}})}d.push({field:"Monto",title:"Monto",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatPrice});if(a.comision&&a.comision.idColocacionUnidadDeNegocio>0){d.push({field:"NombreAsesor",title:"Asesor",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedString})}var f={dataSource:{data:((a.comision&&a.comision.idColocacionUnidadDeNegocio>0)?g.colocacionesPrimariasPorAsesor:g.colocacionesPrimariasPorUnidadNegocio)},selection:false,rowHover:false,sorting:{multiple:true},columns:d,noRecordsText:"No se encontraron detalles."};a.divDetalle.shieldGrid(f);a.divModalDetalle.unbind("hidden.bs.modal");a.divModalDetalle.on("hidden.bs.modal",function(){a.divDetalle.swidget().destroy()});a.divModalDetalle.modal({show:true})};c.request()}};Core.Business.ComisionesColocacionesPrimarias.Manager=function(b){var a=this;a.divModalManager=$(".div-comision-manager");a.comision=null;a.overlayElement=null;a.title=null;a.divDetalle=null;a.divTicker=null;a.txtTicker=null;a.divMoneda=null;a.ddlMoneda=null;a.divMercado=null;a.ddlMercado=null;a.divFechaColocacion=null;a.txtFechaColocacion=null;a.divObservaciones=null;a.txtObservaciones=null;a.btnDistribucion=null;a.divDistribucion=null;a.ddlDistribucion=null;a.unidadesDeNegocio=null;a.asesores=null;a.detalleComision=null;a.onSuccess=function(){};a.divAlert=null;a.divMontoMaximo=null;a.lblMontoMaximo=null;a.divMontoCargado=null;a.lblMontoCargado=null;a.eMercado={Merval:1,MAE:2};$.extend(true,a,b);a.show=function(){a.getInitialData(function(){if(a.comision){var c=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,requestUrl:((a.comision&&a.comision.idColocacionUnidadDeNegocio>0)?("colocacionPrimarias/detalle/asesores/"+a.comision.idColocacionUnidadDeNegocio):("colocacionPrimarias/detalle/unidades/"+a.comision.id)),requestType:"GET"});c.onSuccess=function(d){a.detalleComision=d;a.loadControls()};c.request()}else{a.loadControls()}})};a.getInitialData=function(c){a.unidadesDeNegocio=[];a.asesores=[];if(a.comision&&a.comision.idColocacionUnidadDeNegocio>0){var d=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,requestUrl:"colocacionPrimarias/asesores",requestType:"GET"});d.onSuccess=function(f){a.asesores=f.asesores;c()};d.request()}else{var e=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,requestUrl:"colocacionPrimarias/unidadesDeNegocio",requestType:"GET"});e.onSuccess=function(f){a.unidadesDeNegocio=f.unidadesDeNegocio;c()};e.request()}};a.loadControls=function(){a.divDetalle=a.divModalManager.find(".div-detalle");a.title=a.divModalManager.find(".lbl-title");a.title.text((a.comision)?("Editar - ID: "+a.comision.id):"Nueva");a.divTicker=a.divModalManager.find(".div-ticker");a.txtTicker=a.divModalManager.find(".text-ticker");a.txtTicker.shieldTextBox({});a.txtTicker.val((a.comision)?a.comision.ticker:"");a.divMoneda=a.divModalManager.find(".div-moneda");a.ddlMoneda=a.divModalManager.find(".dropdown-moneda");a.ddlMoneda.shieldDropDown({dataSource:{data:[Core.Enums.Currency.Pesos,Core.Enums.Currency.Dolares]},textTemplate:"{Descripcion}",valueTemplate:"{idMoneda}"});a.ddlMoneda.swidget().value((a.comision)?a.comision.idMoneda.toString():"");a.divMercado=a.divModalManager.find(".div-mercado");a.ddlMercado=a.divModalManager.find(".dropdown-mercado");a.ddlMercado.shieldDropDown({dataSource:{data:[{ID:a.eMercado.Merval,Descripcion:"Merval"},{ID:a.eMercado.MAE,Descripcion:"MAE"}]},textTemplate:"{Descripcion}",valueTemplate:"{ID}"});a.ddlMercado.swidget().value((a.comision)?a.comision.idMercado.toString():"");a.divFechaColocacion=a.divModalManager.find(".div-fecha-colocacion");a.txtFechaColocacion=a.divModalManager.find(".date-fecha-colocacion");a.txtFechaColocacion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:((a.comision&&a.comision.fechaColocacion)?new Date(a.comision.fechaColocacion+" 12:00"):""),max:new Date()});a.txtObservaciones=a.divModalManager.find(".text-observaciones");a.txtObservaciones.shieldTextBox({});a.txtObservaciones.val((a.comision)?a.comision.Observacion:"");a.divObservaciones=a.divModalManager.find(".div-observaciones");a.divDistribucion=a.divModalManager.find(".div-distribucion");a.divDistribucion.hide();a.ddlDistribucion=a.divModalManager.find(".dropdown-distribucion");a.ddlDistribucion.shieldDropDown({dataSource:{data:[]},textTemplate:"{Distribucion}",valueTemplate:"{idTipoDistribucion}",events:{select:function(g){var h=new Core.Ajax.ServerRequest({overlayElement:a.btnDistribucion,requestUrl:"colocacionPrimarias/detalle/asesores/sugeridos/"+a.comision.idColocacionUnidadDeNegocio+"/"+a.ddlDistribucion.swidget().value(),requestType:"GET"});h.onSuccess=function(l){a.divAlert.slideUp();if(l.colocacionesPrimariasPorAsesor.length>0){var i=a.divDetalle.swidget().dataSource.data;var k=0;i.forEach(function(o,m){var n=$.grep(l.colocacionesPrimariasPorAsesor,function(q,p){return q.idPersonaAsesor==o.idPersona})[0];if(n){o.Monto=n.Monto;k+=n.Monto}else{o.Monto=0}});var j=a.divDetalle.swidget().initialOptions;j.dataSource.data=i;a.divDetalle.swidget().refresh(j);a.lblMontoCargado.text(Core.Functions.grid.formatNumber(k));if(a.comision&&a.comision.idColocacionUnidadDeNegocio>0&&k>a.comision.Monto){a.divModalManager.find(".btn-confirmar").hide();a.divAlert.text("Monto Cargado excede el Máximo.");a.divAlert.slideDown()}else{a.divModalManager.find(".btn-confirmar").show();a.divAlert.slideUp()}}else{a.divAlert.text("No se posible calcular una distribución sugerida.");a.divAlert.slideDown()}};h.request()}}});a.btnDistribucion=a.divModalManager.find(".btn-distribucion");a.btnDistribucion.unbind("click");a.btnDistribucion.click(function(){var g=new Core.Ajax.ServerRequest({overlayElement:a.btnDistribucion,requestUrl:"colocacionPrimarias/distribuciones/tipo",requestType:"GET"});g.onSuccess=function(i){var h=a.ddlDistribucion.swidget().initialOptions;h.dataSource.data=i.sugerencias;a.ddlDistribucion.swidget().refresh(h);a.ddlDistribucion.swidget().value("");a.btnDistribucion.hide();a.divDistribucion.show()};g.request()});a.divAlert=a.divModalManager.find(".div-alert");a.divMontoMaximo=a.divModalManager.find(".div-monto-maximo");a.lblMontoMaximo=a.divModalManager.find(".lbl-monto-maximo");a.divMontoCargado=a.divModalManager.find(".div-monto-cargado");a.lblMontoCargado=a.divModalManager.find(".lbl-monto-cargado");a.divAlert.slideUp();a.divObservaciones.show();if(a.comision&&a.comision.idColocacionUnidadDeNegocio>0){a.divObservaciones.hide();a.divTicker.hide();a.divMercado.hide();a.divMoneda.hide();a.divFechaColocacion.hide();a.lblMontoMaximo.text(Core.Functions.grid.formatPrice(a.comision.Monto));a.btnDistribucion.show()}else{a.divMontoMaximo.hide();a.btnDistribucion.hide()}function d(g){if(g=="1"){return"HEAD"}else{""}}var c=[];if(a.comision&&a.comision.idColocacionUnidadDeNegocio>0){c.push({field:"headUnidad",title:"Head Unidad",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:d});c.push({field:"Equipo",title:"Equipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});a.asesores.forEach(function(i,h){i.Monto=0;if(a.detalleComision){var g=$.grep(a.detalleComision.colocacionesPrimariasPorAsesor,function(j,k){return j.idPersonaAsesor==i.idPersona})[0];if(g){i.Monto=g.Monto}}});a.asesores.sort(function(g,h){if(g.headUnidad>h.headUnidad){return -1}else{if(g.headUnidad<h.headUnidad){return 1}else{if(g.Equipo<h.Equipo){return -1}else{if(g.Equipo>h.Equipo){return 1}else{if(g.Monto>h.Monto){return -1}else{if(g.Monto<h.Monto){return 1}else{if(g.Nombre<h.Nombre){return -1}else{if(g.Nombre>h.Nombre){return 1}else{return 0}}}}}}}}})}else{c.push({field:"Descripcion",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});a.unidadesDeNegocio.forEach(function(h,g){h.Monto=0;if(a.detalleComision){var i=$.grep(a.detalleComision.colocacionesPrimariasPorUnidadNegocio,function(k,j){return k.idUnidadNegocio==h.idUnidadDeNegocio})[0];if(i){h.Monto=i.Monto;h.idDetalle=i.id}}});a.unidadesDeNegocio.sort(function(g,h){if(g.Monto>h.Monto){return -1}else{if(g.Monto<h.Monto){return 1}else{if(g.Descripcion<h.Descripcion){return -1}else{if(g.Descripcion>h.Descripcion){return 1}else{return 0}}}}})}c.push({field:"Monto",title:"Monto",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),columnTemplate:function(h,i,j){var g=$("<a>"+(!i.Monto?"No definido":Core.Functions.grid.formatPrice(i.Monto))+"</a>");h.html(g);g.on("click",function(){var k=$("<input type='text' />");h.html(k);new Core.Controls.DecimalPicker(k,{maxDecimalDigitCount:8,showThousandsSeparator:"",defaultValue:i.Monto,onChange:function(){var m=Core.Functions.Decimal.parseFloat(k.val());i.Monto=(m&&m>0)?m:0;var l=a.divDetalle.swidget().initialOptions;l.dataSource.data=a.divDetalle.swidget().dataSource.data;a.divDetalle.swidget().refresh(l);var n=0;a.divDetalle.swidget().dataSource.data.forEach(function(p,o){n+=p.Monto});a.lblMontoCargado.text(Core.Functions.grid.formatNumber(n));if(a.comision&&a.comision.idColocacionUnidadDeNegocio>0&&n>a.comision.Monto){a.divModalManager.find(".btn-confirmar").hide();a.divAlert.text("Monto Cargado excede el Máximo.");a.divAlert.slideDown()}else{a.divModalManager.find(".btn-confirmar").show();a.divAlert.slideUp()}}})})}});if(a.comision&&a.comision.idColocacionUnidadDeNegocio>0){c.push({field:"Nombre",title:"Asesor",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString})}var e={dataSource:{data:((a.comision&&a.comision.idColocacionUnidadDeNegocio>0)?a.asesores:a.unidadesDeNegocio)},selection:false,rowHover:false,sorting:{multiple:true},columns:c,noRecordsText:"No se encontraron detalles."};a.divDetalle.shieldGrid(e);var f=0;a.divDetalle.swidget().dataSource.data.forEach(function(h,g){f+=h.Monto});a.lblMontoCargado.text(Core.Functions.grid.formatNumber(f));a.divModalManager.find(".btn-confirmar").unbind("click");a.divModalManager.find(".btn-confirmar").click(function(){var g={};if((a.comision&&a.comision.idColocacionUnidadDeNegocio>0)){g.colocacionAsesor=[];a.divDetalle.swidget().dataSource.data.forEach(function(m,k){var l=Core.Functions.Decimal.parseFloat(m.Monto);if(l){g.colocacionAsesor.push({idAsesor:m.idPersona,monto:l})}})}else{g.divisionUnidadNegocio=[];var i=0;a.divDetalle.swidget().dataSource.data.forEach(function(n,k){var m=Core.Functions.Decimal.parseFloat(n.Monto);if(m){i+=m;var l={idUnidadNegocio:n.idUnidadDeNegocio,monto:m};if(n.idDetalle){l.id=n.idDetalle}g.divisionUnidadNegocio.push(l)}});g.colocacion=[{monto:i,observacion:a.txtObservaciones.val()}];var j={value:true};g.colocacion[0].fechaColocacion=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaColocacion,j));g.colocacion[0].ticker=Core.Functions.Validations.getValidatedInputValue(a.txtTicker,j);g.colocacion[0].idMercado=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMercado,j);g.colocacion[0].idMoneda=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMoneda,j);if(!j.value){return}}var h=new Core.Ajax.ServerRequest({requestType:((a.comision)?"PUT":"POST"),requestUrl:((a.comision&&a.comision.idColocacionUnidadDeNegocio>0)?("colocacionPrimaria/colocacionPorAsesores/"+a.comision.idColocacionUnidadDeNegocio):("colocacionPrimaria"+((a.comision)?("/"+a.comision.id):""))),requestData:g});h.onSuccess=function(k){a.divModalManager.modal("hide");a.onSuccess()};h.request()});a.divModalManager.unbind("hidden.bs.modal");a.divModalManager.on("hidden.bs.modal",function(){a.divDetalle.swidget().destroy();a.txtObservaciones.swidget().destroy();a.ddlMercado.swidget().destroy();a.ddlMoneda.swidget().destroy();a.txtTicker.swidget().destroy();a.txtFechaColocacion.swidget().destroy();a.ddlDistribucion.swidget().destroy()});a.divModalManager.modal({show:true})}};Core.Business.ComisionesColocacionesPrimarias.ManagerDistribucion=function(b){var a=this;a.divModalManager=$(".div-comision-manager-distribucion");a.comision=null;a.overlayElement=null;a.title=null;a.divDetalle=null;a.unidadesDeNegocio=null;a.detalleComision=null;a.onSuccess=function(){};a.isModified=false;$.extend(true,a,b);a.show=function(){a.isModified=false;a.getInitialData(function(){var c=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,requestUrl:"colocacionPrimarias/detalle/unidades/"+a.comision.id,requestType:"GET"});c.onSuccess=function(d){a.detalleComision=d;a.loadControls()};c.request()})};a.getInitialData=function(c){a.unidadesDeNegocio=[];var d=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,requestUrl:"colocacionPrimarias/unidadesDeNegocio",requestType:"GET"});d.onSuccess=function(e){a.unidadesDeNegocio=e.unidadesDeNegocio;c()};d.request()};a.loadControls=function(){a.divDetalle=a.divModalManager.find(".div-detalle");a.title=a.divModalManager.find(".lbl-title");a.title.text("Editar - ID: "+a.comision.id);var c=[];c.push({field:"Descripcion",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});a.unidadesDeNegocio.forEach(function(f,e){f.Monto=0;if(a.detalleComision){var g=$.grep(a.detalleComision.colocacionesPrimariasPorUnidadNegocio,function(j,h){return j.idUnidadNegocio==f.idUnidadDeNegocio})[0];if(g){f.Monto=g.Monto;f.idDetalle=g.id;f.idUnidadDeNegocio=g.idUnidadNegocio}}});a.unidadesDeNegocio.sort(function(e,f){if(e.Monto>f.Monto){return -1}else{if(e.Monto<f.Monto){return 1}else{if(e.Descripcion<f.Descripcion){return -1}else{if(e.Descripcion>f.Descripcion){return 1}else{return 0}}}}});c.push({field:"Monto",title:"Monto",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),columnTemplate:function(f,g,h){var e=$("<a>"+(!g.Monto?"No definido":Core.Functions.grid.formatPrice(g.Monto))+"</a>");f.html(e);e.on("click",function(){var i=$("<input type='text' />");f.html(i);new Core.Controls.DecimalPicker(i,{maxDecimalDigitCount:8,showThousandsSeparator:"",defaultValue:g.Monto,onChange:function(){var j=Core.Functions.Decimal.parseFloat(i.val());j=(j&&j>0)?j:0;var k={colocacion:{idColocacionPrimaria:a.comision.id,idUnidadDeNegocio:g.idUnidadDeNegocio,nuevoMonto:j}};var l=new Core.Ajax.ServerRequest({overlayElement:f,requestUrl:"colocacionPrimaria/asignar/nuevomonto",requestType:"PUT",requestData:k});l.onSuccess=function(){a.isModified=true;g.Monto=j;var m=a.divDetalle.swidget().initialOptions;m.dataSource.data=a.divDetalle.swidget().dataSource.data;a.divDetalle.swidget().refresh(m)};l.request()}})})}});var d={dataSource:{data:a.unidadesDeNegocio},selection:false,rowHover:false,sorting:{multiple:true},columns:c,noRecordsText:"No se encontraron detalles."};a.divDetalle.shieldGrid(d);a.divModalManager.unbind("hidden.bs.modal");a.divModalManager.on("hidden.bs.modal",function(){a.divDetalle.swidget().destroy();if(a.isModified){a.onSuccess()}});a.divModalManager.modal({show:true})}};Core.Business.ComisionesParaDistribuir=new function(){var a=this;a.id="comisionesParaDistribuir";a.idDefaultAccount=null;a.idDefaultProfile=null;a.txtDateFrom=null;a.txtDateTo=null;a.btnNueva=null;a.chkIncluirFinalizados=null;a.lblTitle=null;a.divComisionesParaDistribuir=null;a.pageOptions=null;a.loaded=false;a.init=function(b,c){Core.loadPage("comisiones-para-distribuir.html",function(){document.title="Comisiones para Distribuir";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.idDefaultAccount=b;a.idDefaultProfile=c;a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.chkIncluirFinalizados=$(".checkbox-incluir-finalizados");a.btnNueva=$(".btn-nueva");a.lblTitle=$(".label-title");a.divComisionesParaDistribuir=$(".div-comisiones-para-distribuir");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loaded=false;a.loadGrid()},"Core.Business.ComisionesParaDistribuir")})};a.initControls=function(){a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loaded=false;a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loaded=false;a.loadGrid()}}});a.chkIncluirFinalizados.on("change",function(){a.loaded=false;a.loadGrid()});a.btnNueva.on("click",function(){new Core.Business.ComisionesParaDistribuir.Manager({overlayElement:a.btnNueva,onSuccess:function(){a.loaded=false;a.loadGrid()}}).show()});a.btnNueva.hide();if(a.pageOptions.comisionesParaDistribuirAlta){a.btnNueva.show()}var b=[];b.push({field:"id",title:"ID",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Tipo",title:"Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"fechaCarga",title:"Fecha Carga",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatStringDate});b.push({field:"fecha",title:"Fecha",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatStringDate});b.push({field:"ticker",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Mercado",title:"Mercado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"FechaTope",title:"Fecha Tope",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatStringDate});b.push({field:"Monto",title:"Monto",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatPrice});b.push({title:"Obs.",width:75,headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,d,e){if(d.Observacion){var f=(d.length>140)?(d.Observacion.substr(0,140)+"..."):(d.Observacion);c.html('<button type="button" title="'+f+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');c.addClass("link-cell");c.on("click",function(){var g=new Core.Controls.Dialog("Observaciones",(d.Observacion)?d.Observacion:"",{displayButtons:{close:true,accept:false}});g.show()})}}});b.push({field:"Finalizado",title:"Finalizado",width:75,attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatBoolean});b.push({field:"Moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({title:" ",width:150,headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(f,g,h){var d=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(f);d.on("click",function(){new Core.Business.ComisionesParaDistribuir.Detalle({overlayElement:d,comision:g}).show()});var e=$('<button type="button" title="Editar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-pencil"></span></button>').appendTo(f);e.on("click",function(){if(a.pageOptions.comisionesParaDistribuirAsesores||!g.TieneDistribucion){new Core.Business.ComisionesParaDistribuir.Manager({overlayElement:e,comision:g,onSuccess:function(){a.loaded=false;a.loadGrid()}}).show()}else{new Core.Business.ComisionesParaDistribuir.ManagerDistribucion({overlayElement:e,comision:g,onSuccess:function(){a.loaded=false;a.loadGrid()}}).show()}});if(g.idComisionParaDistribuirUnidadDeNegocio==0){var c=$('<button type="button" title="Eliminar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(f);c.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar la comisión para distribuir de ID: "+g.id+"?",{onAccepted:function(){var i=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:c,secureRequest:true,requestUrl:("comision-para-distribuir/"+g.id),requestType:"DELETE"});i.onSuccess=function(j){a.loaded=false;a.loadGrid()};i.request()}}).show()})}}});a.divComisionesParaDistribuir.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:b})};a.loadGrid=function(){a.lblTitle.text("Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var b="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));b+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));b+="&finalizados="+((a.chkIncluirFinalizados[0].checked)?"1":"0");var c=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"comision-para-distribuir",requestType:"GET",requestData:b});c.onSuccess=function(d){var e=a.divComisionesParaDistribuir.swidget().initialOptions;e.dataSource.data=d;e.dataSource.schema={data:"comisionesParaDistribuir"};e.dataSource.sort=a.divComisionesParaDistribuir.swidget().dataSource.sort;a.divComisionesParaDistribuir.swidget().refresh(e)};c.request()}};Core.Business.ComisionesParaDistribuir.Detalle=function(b){var a=this;a.divModalDetalle=$(".div-comision-para-distribuir-detalle");a.comision=null;a.overlayElement=null;a.title=null;a.divDetalle=null;$.extend(true,a,b);a.show=function(){var c=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,requestUrl:((a.comision&&a.comision.idComisionParaDistribuirUnidadDeNegocio>0)?("comision-para-distribuir/detalle/asesores/"+a.comision.idComisionParaDistribuirUnidadDeNegocio):("comision-para-distribuir/detalle/unidades/"+a.comision.id)),requestType:"GET"});c.onSuccess=function(g){a.divDetalle=a.divModalDetalle.find(".div-detalle");a.title=a.divModalDetalle.find(".lbl-title");a.title.text("Detalle ID: "+a.comision.id);function e(h){if(h=="1"){return"HEAD"}else{""}}var d=[];if(a.comision&&a.comision.idComisionParaDistribuirUnidadDeNegocio>0){d.push({field:"HeadUnidad",title:"Head Unidad",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:e});d.push({field:"Equipo",title:"Equipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedString});g.comisionParaDistribuirPorAsesor.sort(function(h,i){if(h.HeadUnidad>i.HeadUnidad){return -1}else{if(h.HeadUnidad<i.HeadUnidad){return 1}else{if(h.Equipo<i.Equipo){return -1}else{if(h.Equipo>i.Equipo){return 1}else{if(h.NombreAsesor<i.NombreAsesor){return -1}else{if(h.Monto>i.Monto){return -1}else{if(h.Monto<i.Monto){return 1}else{if(h.NombreAsesor>i.NombreAsesor){return 1}else{return 0}}}}}}}}})}else{d.push({field:"NombreHead",title:"Nombre Head",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedString});d.push({field:"UnidadDescripcion",title:"Unidad",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedString});g.comisionParaDistribuirPorUnidadNegocio.sort(function(h,i){if(h.Monto>i.Monto){return -1}else{if(h.Monto<i.Monto){return 1}else{if(h.UnidadDescripcion<i.UnidadDescripcion){return -1}else{if(h.UnidadDescripcion>i.UnidadDescripcion){return 1}else{if(h.NombreHead<i.NombreHead){return -1}else{if(h.NombreHead>i.NombreHead){return 1}else{return 0}}}}}}})}d.push({field:"Monto",title:"Monto",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatPrice});if(a.comision&&a.comision.idComisionParaDistribuirUnidadDeNegocio>0){d.push({field:"NombreAsesor",title:"Asesor",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedString})}var f={dataSource:{data:((a.comision&&a.comision.idComisionParaDistribuirUnidadDeNegocio>0)?g.comisionParaDistribuirPorAsesor:g.comisionParaDistribuirPorUnidadNegocio)},selection:false,rowHover:false,sorting:{multiple:true},columns:d,noRecordsText:"No se encontraron detalles."};a.divDetalle.shieldGrid(f);a.divModalDetalle.unbind("hidden.bs.modal");a.divModalDetalle.on("hidden.bs.modal",function(){a.divDetalle.swidget().destroy()});a.divModalDetalle.modal({show:true})};c.request()}};Core.Business.ComisionesParaDistribuir.Manager=function(b){var a=this;a.divModalManager=$(".div-comision-para-distribuir-manager");a.comision=null;a.overlayElement=null;a.title=null;a.divDetalle=null;a.divTipo=null;a.ddlTipo=null;a.divTicker=null;a.txtTicker=null;a.divMoneda=null;a.ddlMoneda=null;a.divMercado=null;a.ddlMercado=null;a.divFecha=null;a.txtFecha=null;a.divObservaciones=null;a.txtObservaciones=null;a.btnDistribucion=null;a.divDistribucion=null;a.ddlDistribucion=null;a.unidadesDeNegocio=null;a.asesores=null;a.tipos=null;a.detalleComision=null;a.onSuccess=function(){};a.divAlert=null;a.divMontoMaximo=null;a.lblMontoMaximo=null;a.divMontoCargado=null;a.lblMontoCargado=null;a.eMercado={Merval:1,MAE:2};a.txtFilter=null;a.timeout=null;$.extend(true,a,b);a.show=function(){a.getInitialData(function(){if(a.comision){var c=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,requestUrl:((a.comision&&a.comision.idComisionParaDistribuirUnidadDeNegocio>0)?("comision-para-distribuir/detalle/asesores/"+a.comision.idComisionParaDistribuirUnidadDeNegocio):("comision-para-distribuir/detalle/unidades/"+a.comision.id)),requestType:"GET"});c.onSuccess=function(d){a.detalleComision=d;a.loadControls()};c.request()}else{a.loadControls()}})};a.getInitialData=function(c){a.unidadesDeNegocio=[];a.asesores=[];a.tipos=[];if(a.comision&&a.comision.idComisionParaDistribuirUnidadDeNegocio>0){var d=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,requestUrl:"comision-para-distribuir/asesores",requestType:"GET"});d.onSuccess=function(f){a.asesores=f.asesores;c()};d.request()}else{var e=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,requestUrl:"comision-para-distribuir/unidades-de-negocio",requestType:"GET"});e.onSuccess=function(f){var g=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,requestUrl:"comision-para-distribuir/tipos",requestType:"GET"});g.onSuccess=function(h){a.tipos=h.tipos;a.unidadesDeNegocio=f.unidadesDeNegocio;c()};g.request()};e.request()}};a.loadControls=function(){a.divDetalle=a.divModalManager.find(".div-detalle");a.title=a.divModalManager.find(".lbl-title");a.title.text((a.comision)?("Editar - ID: "+a.comision.id):"Nueva");a.divTipo=a.divModalManager.find(".div-tipo");a.divTipo.show();a.ddlTipo=a.divModalManager.find(".dropdown-tipo");a.ddlTipo.shieldDropDown({dataSource:{data:a.tipos},textTemplate:"{Tipo}",valueTemplate:"{idTipo}",events:{select:function(g){a.setControlsByTipo()}}});a.ddlTipo.swidget().value((a.comision)?a.comision.idTipo.toString():"");a.divTicker=a.divModalManager.find(".div-ticker");a.divTicker.show();a.txtTicker=a.divModalManager.find(".text-ticker");a.txtTicker.shieldTextBox({});a.txtTicker.val((a.comision)?a.comision.ticker:"");a.divMoneda=a.divModalManager.find(".div-moneda");a.divMoneda.show();a.ddlMoneda=a.divModalManager.find(".dropdown-moneda");a.ddlMoneda.shieldDropDown({dataSource:{data:[Core.Enums.Currency.Pesos,Core.Enums.Currency.Dolares]},textTemplate:"{Descripcion}",valueTemplate:"{idMoneda}"});a.ddlMoneda.swidget().value((a.comision)?a.comision.idMoneda.toString():"");a.divMercado=a.divModalManager.find(".div-mercado");a.divMercado.show();a.ddlMercado=a.divModalManager.find(".dropdown-mercado");a.ddlMercado.shieldDropDown({dataSource:{data:[{ID:a.eMercado.Merval,Descripcion:"Merval"},{ID:a.eMercado.MAE,Descripcion:"MAE"}]},textTemplate:"{Descripcion}",valueTemplate:"{ID}"});a.ddlMercado.swidget().value((a.comision)?a.comision.idMercado.toString():"");a.divFecha=a.divModalManager.find(".div-fecha");a.divFecha.show();a.txtFecha=a.divModalManager.find(".date-fecha");a.txtFecha.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:((a.comision&&a.comision.fecha)?new Date(a.comision.fecha+" 12:00"):""),max:new Date()});a.txtObservaciones=a.divModalManager.find(".text-observaciones");a.txtObservaciones.shieldTextBox({});a.txtObservaciones.val((a.comision)?a.comision.Observacion:"");a.divObservaciones=a.divModalManager.find(".div-observaciones");a.divObservaciones.show();a.divDistribucion=a.divModalManager.find(".div-distribucion");a.divDistribucion.hide();a.ddlDistribucion=a.divModalManager.find(".dropdown-distribucion");a.ddlDistribucion.shieldDropDown({dataSource:{data:[]},textTemplate:"{Distribucion}",valueTemplate:"{idTipoDistribucion}",events:{select:function(g){a.divAlert.slideUp();var h=new Core.Ajax.ServerRequest({overlayElement:a.btnDistribucion,requestUrl:"comision-para-distribuir/detalle/asesores/sugeridos/"+a.comision.idComisionParaDistribuirUnidadDeNegocio+"/"+a.ddlDistribucion.swidget().value(),requestType:"GET"});h.onSuccess=function(l){if(l.comisionParaDistribuirPorAsesor.length>0){var i=a.divDetalle.swidget().dataSource.data;var k=0;i.forEach(function(o,m){var n=$.grep(l.comisionParaDistribuirPorAsesor,function(q,p){return q.idPersonaAsesor==o.idPersona})[0];if(n){o.Monto=n.Monto;k+=n.Monto}else{o.Monto=0}});var j=a.divDetalle.swidget().initialOptions;j.dataSource.data=i;a.divDetalle.swidget().refresh(j);a.lblMontoCargado.text(Core.Functions.grid.formatNumber(k));if(a.comision&&a.comision.idComisionParaDistribuirUnidadDeNegocio>0&&k>a.comision.Monto){a.divModalManager.find(".btn-confirmar").hide();a.divAlert.text("El monto cargado excede el máximo.");a.divAlert.slideDown()}else{a.divModalManager.find(".btn-confirmar").show();a.divAlert.slideUp()}}else{a.divAlert.text("No es posible calcular una distribución sugerida.");a.divAlert.slideDown()}};h.onError=function(j){var i=(j.responseJSON&&j.responseJSON.Descripcion)?j.responseJSON.Descripcion:"Algunos componentes de la página no se cargaron correctamente. Por favor intente mas tarde...";a.divAlert.text(i);a.divAlert.slideDown()};h.request()}}});a.btnDistribucion=a.divModalManager.find(".btn-distribucion");a.btnDistribucion.unbind("click");a.btnDistribucion.click(function(){var g=new Core.Ajax.ServerRequest({overlayElement:a.btnDistribucion,requestUrl:"comision-para-distribuir/distribuciones/tipo/"+a.comision.idTipo,requestType:"GET"});g.onSuccess=function(i){var h=a.ddlDistribucion.swidget().initialOptions;h.dataSource.data=i.sugerencias;a.ddlDistribucion.swidget().refresh(h);a.ddlDistribucion.swidget().value("");a.btnDistribucion.hide();a.divDistribucion.show()};g.request()});a.divAlert=a.divModalManager.find(".div-alert");a.divMontoMaximo=a.divModalManager.find(".div-monto-maximo");a.lblMontoMaximo=a.divModalManager.find(".lbl-monto-maximo");a.divMontoCargado=a.divModalManager.find(".div-monto-cargado");a.lblMontoCargado=a.divModalManager.find(".lbl-monto-cargado");a.divAlert.slideUp();if(a.comision&&a.comision.idComisionParaDistribuirUnidadDeNegocio>0){a.divObservaciones.hide();a.divTipo.hide();a.divTicker.hide();a.divMercado.hide();a.divMoneda.hide();a.divFecha.hide();a.lblMontoMaximo.text(Core.Functions.grid.formatPrice(a.comision.Monto));a.btnDistribucion.show()}else{a.setControlsByTipo();a.divMontoMaximo.hide();a.btnDistribucion.hide()}function d(g){if(g=="1"){return"HEAD"}else{""}}var c=[];if(a.comision&&a.comision.idComisionParaDistribuirUnidadDeNegocio>0){c.push({field:"headUnidad",title:"Head Unidad",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:d});c.push({field:"Equipo",title:"Equipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});a.asesores.forEach(function(i,h){i.Monto=0;if(a.detalleComision){var g=$.grep(a.detalleComision.comisionParaDistribuirPorAsesor,function(j,k){return j.idPersonaAsesor==i.idPersona})[0];if(g){i.Monto=g.Monto}}});a.asesores.sort(function(g,h){if(g.headUnidad>h.headUnidad){return -1}else{if(g.headUnidad<h.headUnidad){return 1}else{if(g.Equipo<h.Equipo){return -1}else{if(g.Equipo>h.Equipo){return 1}else{if(g.Monto>h.Monto){return -1}else{if(g.Monto<h.Monto){return 1}else{if(g.Nombre<h.Nombre){return -1}else{if(g.Nombre>h.Nombre){return 1}else{return 0}}}}}}}}})}else{c.push({field:"Descripcion",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});a.unidadesDeNegocio.forEach(function(h,g){h.Monto=0;if(a.detalleComision){var i=$.grep(a.detalleComision.comisionParaDistribuirPorUnidadNegocio,function(k,j){return k.idUnidadNegocio==h.idUnidadDeNegocio})[0];if(i){h.Monto=i.Monto;h.idDetalle=i.id}}});a.unidadesDeNegocio.sort(function(g,h){if(g.Monto>h.Monto){return -1}else{if(g.Monto<h.Monto){return 1}else{if(g.Descripcion<h.Descripcion){return -1}else{if(g.Descripcion>h.Descripcion){return 1}else{return 0}}}}})}c.push({field:"Monto",title:"Monto",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),columnTemplate:function(h,i,j){var g=$("<a>"+(!i.Monto?"No definido":Core.Functions.grid.formatPrice(i.Monto))+"</a>");h.html(g);g.on("click",function(){var k=$("<input type='text' />");h.html(k);new Core.Controls.DecimalPicker(k,{maxDecimalDigitCount:8,showThousandsSeparator:"",defaultValue:i.Monto,onChange:function(){var m=Core.Functions.Decimal.parseFloat(k.val());i.Monto=(m&&m>0)?m:0;var l=a.divDetalle.swidget().initialOptions;l.dataSource.data=a.divDetalle.swidget().dataSource.data;a.divDetalle.swidget().refresh(l);var n=0;a.divDetalle.swidget().dataSource.data.forEach(function(p,o){n+=p.Monto});a.lblMontoCargado.text(Core.Functions.grid.formatNumber(n));if(a.comision&&a.comision.idComisionParaDistribuirUnidadDeNegocio>0&&n>a.comision.Monto){a.divModalManager.find(".btn-confirmar").hide();a.divAlert.text("El monto cargado excede el máximo.");a.divAlert.slideDown()}else{a.divModalManager.find(".btn-confirmar").show();a.divAlert.slideUp()}}})})}});if(a.comision&&a.comision.idComisionParaDistribuirUnidadDeNegocio>0){c.push({field:"Nombre",title:"Asesor",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString})}var e={dataSource:{data:((a.comision&&a.comision.idComisionParaDistribuirUnidadDeNegocio>0)?a.asesores:a.unidadesDeNegocio)},selection:false,rowHover:false,sorting:{multiple:true},columns:c,noRecordsText:"No se encontraron detalles."};a.divDetalle.shieldGrid(e);var f=0;a.divDetalle.swidget().dataSource.data.forEach(function(h,g){f+=h.Monto});a.lblMontoCargado.text(Core.Functions.grid.formatNumber(f));a.txtFilter=a.divModalManager.find(".textbox-filter");a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var g=a.divDetalle.swidget().dataSource;if(value){g.filter={or:[{path:"headUnidad",filter:"contains",value:value},{path:"Equipo",filter:"contains",value:value},{path:"Descripcion",filter:"contains",value:value},{path:"Nombre",filter:"contains",value:value}]}}else{g.filter=null}g.read()},50)});a.divModalManager.find(".btn-confirmar").unbind("click");a.divModalManager.find(".btn-confirmar").click(function(){var g={};if((a.comision&&a.comision.idComisionParaDistribuirUnidadDeNegocio>0)){g.comisionParaDistribuirAsesor=[];a.divDetalle.swidget().dataSource.data.forEach(function(m,k){var l=Core.Functions.Decimal.parseFloat(m.Monto);if(l){g.comisionParaDistribuirAsesor.push({idAsesor:m.idPersona,monto:l})}})}else{g.divisionUnidadNegocio=[];var i=0;a.divDetalle.swidget().dataSource.data.forEach(function(n,k){var m=Core.Functions.Decimal.parseFloat(n.Monto);if(m){i+=m;var l={idUnidadNegocio:n.idUnidadDeNegocio,monto:m};if(n.idDetalle){l.id=n.idDetalle}g.divisionUnidadNegocio.push(l)}});g.comisionParaDistribuir=[{monto:i,observacion:a.txtObservaciones.val()}];var j={value:true};g.comisionParaDistribuir[0].idTipo=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipo,j);g.comisionParaDistribuir[0].fecha=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFecha,j));if(g.comisionParaDistribuir[0].idTipo!=2){g.comisionParaDistribuir[0].ticker=Core.Functions.Validations.getValidatedInputValue(a.txtTicker,j);g.comisionParaDistribuir[0].idMercado=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMercado,j)}g.comisionParaDistribuir[0].idMoneda=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMoneda,j);if(!j.value){return}}var h=new Core.Ajax.ServerRequest({requestType:((a.comision)?"PUT":"POST"),requestUrl:((a.comision&&a.comision.idComisionParaDistribuirUnidadDeNegocio>0)?("comision-para-distribuir/por-asesores/"+a.comision.idComisionParaDistribuirUnidadDeNegocio):("comision-para-distribuir"+((a.comision)?("/"+a.comision.id):""))),requestData:g});h.onSuccess=function(k){a.divModalManager.modal("hide");a.onSuccess()};h.request()});a.divModalManager.unbind("hidden.bs.modal");a.divModalManager.on("hidden.bs.modal",function(){a.divDetalle.swidget().destroy();a.txtObservaciones.swidget().destroy();a.ddlTipo.swidget().destroy();a.ddlMercado.swidget().destroy();a.ddlMoneda.swidget().destroy();a.txtTicker.swidget().destroy();a.txtFecha.swidget().destroy();a.ddlDistribucion.swidget().destroy();a.txtFilter.val("")});a.divModalManager.modal({show:true})};a.setControlsByTipo=function(){if(a.ddlTipo.swidget().value()!=2){a.divTicker.show();a.divMercado.show()}else{a.divTicker.hide();a.divMercado.hide()}}};Core.Business.ComisionesParaDistribuir.ManagerDistribucion=function(b){var a=this;a.divModalManager=$(".div-comision-para-distribuir-manager-distribucion");a.comision=null;a.overlayElement=null;a.title=null;a.divDetalle=null;a.unidadesDeNegocio=null;a.detalleComision=null;a.onSuccess=function(){};a.isModified=false;$.extend(true,a,b);a.show=function(){a.isModified=false;a.getInitialData(function(){var c=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,requestUrl:"comision-para-distribuir/detalle/unidades/"+a.comision.id,requestType:"GET"});c.onSuccess=function(d){a.detalleComision=d;a.loadControls()};c.request()})};a.getInitialData=function(c){a.unidadesDeNegocio=[];var d=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,requestUrl:"comision-para-distribuir/unidades-de-negocio",requestType:"GET"});d.onSuccess=function(e){a.unidadesDeNegocio=e.unidadesDeNegocio;c()};d.request()};a.loadControls=function(){a.divDetalle=a.divModalManager.find(".div-detalle");a.title=a.divModalManager.find(".lbl-title");a.title.text("Editar - ID: "+a.comision.id);var c=[];c.push({field:"Descripcion",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});a.unidadesDeNegocio.forEach(function(f,e){f.Monto=0;if(a.detalleComision){var g=$.grep(a.detalleComision.comisionParaDistribuirPorUnidadNegocio,function(j,h){return j.idUnidadNegocio==f.idUnidadDeNegocio})[0];if(g){f.Monto=g.Monto;f.idDetalle=g.id;f.idUnidadDeNegocio=g.idUnidadNegocio}}});a.unidadesDeNegocio.sort(function(e,f){if(e.Monto>f.Monto){return -1}else{if(e.Monto<f.Monto){return 1}else{if(e.Descripcion<f.Descripcion){return -1}else{if(e.Descripcion>f.Descripcion){return 1}else{return 0}}}}});c.push({field:"Monto",title:"Monto",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),columnTemplate:function(f,g,h){var e=$("<a>"+(!g.Monto?"No definido":Core.Functions.grid.formatPrice(g.Monto))+"</a>");f.html(e);e.on("click",function(){var i=$("<input type='text' />");f.html(i);new Core.Controls.DecimalPicker(i,{maxDecimalDigitCount:8,showThousandsSeparator:"",defaultValue:g.Monto,onChange:function(){var j=Core.Functions.Decimal.parseFloat(i.val());j=(j&&j>0)?j:0;var k={comisionParaDistribuir:{idComisionParaDistribuir:a.comision.id,idUnidadDeNegocio:g.idUnidadDeNegocio,nuevoMonto:j}};var l=new Core.Ajax.ServerRequest({overlayElement:f,requestUrl:"comision-para-distribuir/asignar/nuevomonto",requestType:"PUT",requestData:k});l.onSuccess=function(){a.isModified=true;g.Monto=j;var m=a.divDetalle.swidget().initialOptions;m.dataSource.data=a.divDetalle.swidget().dataSource.data;a.divDetalle.swidget().refresh(m)};l.request()}})})}});var d={dataSource:{data:a.unidadesDeNegocio},selection:false,rowHover:false,sorting:{multiple:true},columns:c,noRecordsText:"No se encontraron detalles."};a.divDetalle.shieldGrid(d);a.divModalManager.unbind("hidden.bs.modal");a.divModalManager.on("hidden.bs.modal",function(){a.divDetalle.swidget().destroy();if(a.isModified){a.onSuccess()}});a.divModalManager.modal({show:true})}};Core.Business.comisionesRetrocesionAlta=new function(){var a=this;a.id="comisionesRetrocesionAlta";a.init=function(b,c){Core.loadPage("comisiones-retrocesion-alta.html",function(){document.title="Porcentaje de Retrocesión";a.inputFiles=$(".input-upload-file");a.btnConfirmarArchivos=$(".btn-confirmar-archivos");a.txtFilter=$(".textbox-filter");a.btnRefresh=$(".btn-refresh");a.divRetrocesion=$(".div-retrocesion");a.lblTotal=$(".lbl-total");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadGrid()},"Core.Business.comisionesRetrocesionAlta")})};a.initControls=function(){a.btnConfirmarArchivos.on("click",function(){if(a.inputFiles[0].files.length!=1){var k=new Core.Controls.Dialog("Aviso","<p>Debe seleccionar un archivo.</p>",{displayButtons:{close:true,accept:false}}).show();return}for(var j=0,e;e=a.inputFiles[0].files[j];j++){var g=e.name.split(".");var d=g[g.length-1];if(d!="xlsx"){var k=new Core.Controls.Dialog("Aviso","<p>Los archivos seleccionados deben ser: xlsx.</p>",{displayButtons:{close:true,accept:false}}).show();return}}var h={Authorization:Core.Objects.Context.Token,Accept:"application/json"};var c=new FormData();for(var j=0,e;e=a.inputFiles[0].files[j];j++){c.append("file-"+j,e)}var l=new Core.Controls.Overlay(a.btnConfirmarArchivos,{});$.ajax({type:"POST",url:Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"upload/csv/comisionesIFA/retrocesion",data:c,cache:false,contentType:false,processData:false,method:"POST",headers:h,success:function(f){l.destroy();a.inputFiles.val("");new Core.Controls.Dialog("Aviso","Archivo procesado exitosamente.",{displayButtons:{close:true,accept:false}}).show();a.loadGrid()},error:function(i){l.destroy();a.inputFiles.val("");var n=JSON.parse(i.responseText);if(i.status==400){new Core.Business.comisionesRetrocesionAlta.Rechazos({rechazos:n.rechazos?n.rechazos:[]}).show()}else{var o=(n&&n.Descripcion)?"Mensaje":"Error de conexión";var f=(n&&n.Descripcion)?n.Descripcion:"Algunos componentes de la página no se cargaron correctamente. Por favor intente mas tarde...";var m=new Core.Controls.Dialog(o,f,{displayButtons:{close:true,accept:false}});m.show()}}})});a.btnRefresh.on("click",function(){a.loadGrid()});a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var c=a.divRetrocesion.swidget().dataSource;if(value){c.filter={or:[{path:"asesor",filter:"contains",value:value},{path:"equipo",filter:"contains",value:value},{path:"usuario",filter:"contains",value:value}]}}else{c.filter=null}c.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.comisionesRetrocesionAlta.txtFilter");var b=[];b.push({width:"10%",field:"idpersona",title:"ID Persona",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatIntegerNumber});b.push({width:"20%",field:"asesor",title:"Asesor",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({width:"20%",field:"equipo",title:"Equipo",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({width:"10%",field:"unidad_negocio",title:"Unidad de Negocio",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({width:"10%",field:"tipo_asesor",title:"Tipo de Asesor",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({width:"10%",field:"usuario",title:"Usuario",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({width:"10%",field:"cuentas",title:"Cuentas",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatIntegerNumber});b.push({width:"10%",field:"retrocesion",title:"Retrocesión",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatDecimal});a.divRetrocesion.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:b,paging:{pageSize:50,pageLinksCount:10},noRecordsText:"No se encontraron datos."})};a.loadGrid=function(){var b=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"comisiones/retrocesion",requestType:"GET"});b.onSuccess=function(c){var d=c.retrocesion?c.retrocesion:[];var e=a.divRetrocesion.swidget().initialOptions;e.dataSource.data=d;a.divRetrocesion.swidget().refresh(e);a.txtFilter.keydown();a.lblTotal.text("Total: "+d.length)};b.request()}};Core.Business.comisionesRetrocesionAlta.Rechazos=function(b){var a=this;a.divModal=$(".div-modal-retrocesion-rechazos");a.divRechazos=null;a.rechazos=[];$.extend(true,a,b);a.show=function(){a.divRechazos=a.divModal.find(".div-rechazos");var c=[];c.push({width:"10%",field:"idpersona",title:"ID Persona",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});c.push({width:"30%",field:"nombreasesor",title:"Asesor",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});c.push({width:"10%",field:"retrocesion",title:"Retrocesión",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});c.push({width:"50%",field:"motivorechazo",title:"Motivo Rechazo",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});a.divRechazos.shieldGrid({dataSource:{data:a.rechazos},selection:false,rowHover:false,columns:c,paging:{pageSize:50,pageLinksCount:10},noRecordsText:"No se encontraron rechazos."});a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.divModal.modal({show:true})};a.destroy=function(){a.divRechazos.swidget().destroy()}};Core.Business.Configuracion=new function(){var a=this;a.id="configuracion";a.divParametros=null;a.btnRefresh=null;a.txtFilter=null;a.pageOptions=null;a.timeout=null;a.init=function(b,c){Core.loadPage("configuracion.html",function(){document.title="Configuración";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divParametros=$(".div-parametros");a.txtFilter=$(".textbox-filter");a.btnRefresh=$(".btn-refresh");a.btnRefresh.on("click",function(){a.loadGrid()});a.initGrid();a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var d=a.divParametros.swidget().dataSource;if(value){d.filter={or:[{path:"Descripcion",filter:"contains",value:value}]}}else{d.filter=null}d.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.Configuracion.txtFilter");a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.Configuracion")})};a.initGrid=function(){function c(d){if(!d){return""}return d.substr(6,2)+"/"+d.substr(4,2)+"/"+d.substr(0,4)}var b=[];b.push({title:"Descripcion",field:"Descripción",width:"60%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,e,f){d.html(Core.Functions.grid.formatUndefinedString(e.Descripcion));if(e.DescripcionFull!=null){d[0].title=e.DescripcionFull}d.on("click",function(){new Core.Controls.Dialog("Descripción: "+e.Descripcion,e.DescripcionFull,{displayButtons:{close:true,accept:false}}).show()})}});b.push({title:"Valor",field:"Valor",width:"35%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,e,f){if(e.TipoDato=="I"){d.html(Core.Functions.grid.formatIntegerNumber(e.Valor))}else{if(e.TipoDato=="D"){d.html(Core.Functions.grid.formatPrice(e.Valor))}else{if(e.TipoDato=="B"){d.html(Core.Functions.grid.formatBoolean(e.Valor))}else{if(e.TipoDato=="F"){d.html(c(e.Valor))}else{d.html(Core.Functions.grid.formatUndefinedString(e.Valor))}}}}}});b.push({title:" ",field:"",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(e,f,g){var d=$('<button type="button" title="Modificar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(e);d.on("click",function(){new Core.Business.Configuracion.EditarParametro({parametro:f,onConfirm:function(){a.loadGrid()}}).show()})}});a.divParametros.shieldGrid({dataSource:{data:[],group:[{field:"Grupo",order:"asc"}]},paging:{pageSize:100,pageLinksCount:10},selection:false,rowHover:false,columns:b})};a.loadGrid=function(){var b=new Core.Ajax.ServerRequest({overlayElement:a.divParametros.parent(),secureRequest:true,requestUrl:"configuracion/obtener",requestType:"GET"});b.onSuccess=function(c){var d=a.divParametros.swidget().initialOptions;d.dataSource.data=c.Configuraciones;a.divParametros.swidget().refresh(d);a.txtFilter.keydown()};b.request()}};Core.Business.Configuracion.EditarParametro=function(b){var a=this;a.divModal=$(".div-modal-editar-parametro");a.lblDescripcionFullParametro=null;a.lblDescripcionParametro=null;a.txtNuevoValorNumerico=null;a.txtNuevoValorDate=null;a.chkNuevoValor=null;a.txtNuevoValorString=null;a.txtComentarios=null;a.btnConfirmar=null;a.onConfirm=function(){};a.parametro=null;$.extend(true,a,b);a.show=function(){a.lblDescripcionParametro=a.divModal.find(".label-descripcion-parametro");a.lblDescripcionFullParametro=a.divModal.find(".label-descripcion-full-parametro");a.divNuevoValorNumerico=a.divModal.find(".div-textbox-nuevo-valor-numerico");a.divNuevoValorDate=a.divModal.find(".div-date-picker-nuevo-valor");a.divNuevoValorString=a.divModal.find(".div-textbox-nuevo-valor");a.divNuevoValorCheck=a.divModal.find(".div-checkbox-nuevo-valor");a.txtNuevoValorNumerico=a.divModal.find(".textbox-nuevo-valor-numerico");a.txtNuevoValorDate=a.divModal.find(".date-picker-nuevo-valor");a.txtNuevoValorString=a.divModal.find(".textbox-nuevo-valor");a.chkNuevoValor=a.divModal.find(".checkbox-nuevo-valor");a.txtComentarios=a.divModal.find(".textbox-comentarios");a.btnConfirmar=a.divModal.find(".btn-confirmar");a.initControls();a.divModal.modal({show:true});a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()})};a.initControls=function(){a.divNuevoValorNumerico.hide();a.divNuevoValorDate.hide();a.divNuevoValorString.hide();a.divNuevoValorCheck.hide();if(a.parametro.TipoDato=="D"||a.parametro.TipoDato=="I"){a.divNuevoValorNumerico.show()}else{if(a.parametro.TipoDato=="B"){a.divNuevoValorCheck.show()}else{if(a.parametro.TipoDato=="F"){a.divNuevoValorDate.show()}else{a.divNuevoValorString.show()}}}a.lblDescripcionParametro.text(a.parametro.Descripcion);a.lblDescripcionFullParametro.text(a.parametro.DescripcionFull);a.txtComentarios.shieldTextBox({value:""});a.txtNuevoValorString.shieldTextBox({value:a.parametro.TipoDato=="S"?a.parametro.Valor:""});Core.Functions.Validations.toggleValidation(a.txtNuevoValorString,false);new Core.Controls.DecimalPicker(a.txtNuevoValorNumerico,{maxDecimalDigitCount:(a.parametro.TipoDato=="I"?0:10),showThousandsSeparator:false,defaultValue:((a.parametro.TipoDato=="D"||a.parametro.TipoDato=="I")?a.parametro.Valor:"")});Core.Functions.Validations.toggleValidation(a.txtNuevoValorNumerico,false);a.txtNuevoValorDate.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.parametro&&a.parametro.TipoDato=="F")?a.getDate(a.parametro.Valor):new Date(),max:new Date()});Core.Functions.Validations.toggleValidation(a.txtNuevoValorDate,false);a.chkNuevoValor.shieldCheckBox({label:"Valor"});if(a.parametro&&a.parametro.TipoDato=="B"&&a.parametro.Valor==1){a.chkNuevoValor.swidget().checked(true)}else{a.chkNuevoValor.swidget().checked(false)}a.btnConfirmar.unbind("click");a.btnConfirmar.on("click",function(){var e={value:true};Core.Functions.Validations.toggleValidation(a.txtNuevoValorNumerico,false);var c={Configuraciones:{}};c.Configuraciones.Nombre=a.parametro.Nombre;c.Configuraciones.Comentario=a.txtComentarios.swidget().value();if(a.parametro.TipoDato=="D"||a.parametro.TipoDato=="I"){c.Configuraciones.Valor=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtNuevoValorNumerico,e))}else{if(a.parametro.TipoDato=="B"){c.Configuraciones.Valor=(a.chkNuevoValor.swidget().checked()?1:0)}else{if(a.parametro.TipoDato=="F"){c.Configuraciones.Valor=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtNuevoValorDate,e))}else{c.Configuraciones.Valor=Core.Functions.Validations.getValidatedSwidgetValue(a.txtNuevoValorString,e)}}}if(!e.value){return}else{var d=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"configuracion/actualizar",requestType:"POST",requestData:c});d.onSuccess=function(){a.onConfirm();a.divModal.modal("hide")};d.request()}})};a.getDate=function(c){var d=c.substr(6,2);var e=c.substr(4,2);var g=c.substr(0,4);var f=new Date();f.setDate(d);f.setMonth(e-1);f.setYear(g);return f};a.destroy=function(){a.txtComentarios.swidget().destroy();a.txtNuevoValorDate.swidget().destroy();a.txtNuevoValorString.swidget().destroy();a.chkNuevoValor.swidget().destroy()}};Core.Business.ConfiguracionAlertas=new function(){var a=this;a.id="configuracionAlertas";a.divConfiguraciones=null;a.dispositivos=[];a.configuraciones=[];a.init=function(b,c){Core.loadPage("configuracion-alertas.html",function(){document.title="Configuración";a.divConfiguraciones=$(".div-configuraciones-alertas");a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadData,"Core.Business.ConfiguracionAlertas")})};a.loadData=function(){var b=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"configuracion/usuario?allDevices=1",requestType:"GET"});b.onSuccess=function(c){a.dispositivos=$.grep(c.dispositivos,function(e,d){return e.FirebaseToken});a.configuraciones=$.grep(c.configuracion,function(e,d){return e.TipoDato=="B"});a.renderConfigurations()};b.request()};a.renderConfigurations=function(){a.divConfiguraciones.empty();var b=[];a.configuraciones.forEach(function(d,c){if(b.indexOf(d.Menu)<0){b.push(d.Menu)}});b.forEach(function(c,d){a.renderMenu(c)})};a.renderMenu=function(f){var c=$('<div style="margin-top:10px;" class="col-lg-12 col-md-12 col-sm-12"></div>').appendTo(a.divConfiguraciones);var b=$('<div class="panel panel-info"></div>').appendTo(c);$('<div class="heading-table bgGris3 blanco radius tAcenter"><div class="panel-title"><span class="title tAleft">'+f+"</span></div></div>").appendTo(b);var d=$('<div style="padding-top:10px" class="panel-body"></div>').appendTo(b);var g=$.grep(a.configuraciones,function(i,h){return i.Menu==f});var e=[];g.forEach(function(i,h){if(e.indexOf(i.Grupo)<0){e.push(i.Grupo)}});e.forEach(function(h,i){a.renderGroup(d,f,h)})};a.renderGroup=function(b,f,d){var c=$('<div class="col-lg-12 col-md-12 col-sm-12 pad0"></div>').appendTo(b);$("<h3>"+d+"</h3>").appendTo(c);var e=$.grep(a.configuraciones,function(i,h){return i.Menu==f&&i.Grupo==d});var g=[];e.forEach(function(i,h){if(g.indexOf(i.SubMenu)<0){g.push(i.SubMenu)}});g.forEach(function(h,i){a.renderSubMenu(c,f,d,h)})};a.renderSubMenu=function(c,j,i,m){var g=$('<div class="col-lg-12 col-md-12 col-sm-12 pad0 mB15 box-nov"></div>').appendTo(c);var d=$('<div class="col-lg-4 col-md-12 col-sm-12"></div>').appendTo(g);$('<label class="label-subt">'+m+"</label>").appendTo(d);var l=$.grep(a.configuraciones,function(o,n){return o.Menu==j&&o.Grupo==i&&o.SubMenu==m&&o.Tipo=="User"})[0];var h=$('<div class="col-lg-4 col-md-12 col-sm-12"></div>').appendTo(g);if(l){var b=$('<input type="checkbox" '+(!l.habilitado?"disabled":"")+"/>").appendTo(h);$('<span class="span-check">'+l.Descripcion+"</span>").appendTo(h);$('<p class="small">'+l.DescripcionFull+"</p>").appendTo(h);b[0].checked=(l.Valor==1);b.on("change",function(){a.saveConfiguration(l.idConfiguracionUsuario,"",(b[0].checked?1:0))})}var k=$.grep(a.configuraciones,function(o,n){return o.Menu==j&&o.Grupo==i&&o.SubMenu==m&&o.Tipo=="Device"});var e=$('<div class="col-lg-4 col-md-12 col-sm-12"></div>').appendTo(g);if(k.length>0){$("<span>"+k[0].Descripcion+"</span>").appendTo(e);$('<p class="small">'+k[0].DescripcionFull+"</p>").appendTo(e);if(a.dispositivos.length>0){var f=$('<div style="width:100%; border:1px solid gray; padding:5px;"></div>').appendTo(e);a.dispositivos.forEach(function(o,p){var r=$.grep(k,function(t,s){return t.idDispositivo==o.idDispositivo})[0];var q=$("<div></div>").appendTo(f);var n=$('<input type="checkbox" '+(r&&!r.habilitado?"disabled":"")+"/>").appendTo(q);$('<span class="span-check">'+o.Nombre+"</span>").appendTo(q);n[0].checked=(r&&r.Valor==1);n.on("change",function(){a.saveConfiguration(k[0].idConfiguracionUsuario,o.idDispositivo,(n[0].checked?1:0))})})}else{$('<div style="width:100%;border:1px solid gray;padding: 1rem;background-color: #f5f5f5;"><p class="" style=" display: block; padding: 0;margin: 0;"><i class="fa fa-exclamation-circle" aria-hidden="true" style="color: #a5a5a5;"></i><span style="margin-left:1rem;">Aún no vinculaste ningún dispositivo.</span></p></div>').appendTo(e)}}};a.saveConfiguration=function(b,c,f){var d={idConfiguracionUsuario:b,idDispositivo:c,Valor:f};var e=new Core.Ajax.ServerRequest({overlayElement:a.divConfiguraciones,secureRequest:true,requestUrl:"configuracion/usuario",requestType:"POST",requestData:d});e.onSuccess=function(){new Core.Controls.Dialog("Mensaje","Su configuracion ha sido modificada exitosamente.",{displayButtons:{close:true,accept:false}}).show()};e.request()}};Core.Business.BCIICE=new function(){var a=this;a.id="cot_bci_exterior";a.idDefaultAccount=null;a.idDefaultProfile=null;a.divAlertaTipoPrecio=null;a.btnNyse=null;a.btnNasdaq=null;a.btnEtf=null;a.divNyse=null;a.txtFilterNyse=null;a.timeoutNyse=null;a.divNasdaq=null;a.txtFilterNasdaq=null;a.timeoutNasdaq=null;a.divEtf=null;a.txtFilterEtf=null;a.timeoutEtf=null;a.maxToken=0;a.lastData=null;a.timerId=null;a.timerIdForceRefresh=null;a.loaded=false;a.refresh=false;a.forceRefresh=false;a.window=$(window);a.init=function(b,c){Core.loadPage("cotizaciones_bci_ice.html",function(){document.title="BCI Internacional";a.loaded=false;a.refresh=false;a.forceRefresh=false;a.idDefaultAccount=b;a.idDefaultProfile=c;a.maxToken=0;a.lastData=null;a.setTabs();var d=Core.Objects.Context.Profiles[c].opciones.maxWatchlists;Core.Functions.grid.Cotizaciones.initGrid(a.divNyse,true,true,false,d,null,null,false,Core.Enums.ePanel.BCINYSE,b,c);Core.Functions.grid.Cotizaciones.initFilter(a.divNyse,a.txtFilterNyse,a.timeoutNyse,a.window);Core.Functions.grid.Cotizaciones.initGrid(a.divNasdaq,true,true,false,d,null,null,false,Core.Enums.ePanel.BCINASDAQ,b,c);Core.Functions.grid.Cotizaciones.initFilter(a.divNasdaq,a.txtFilterNasdaq,a.timeoutNasdaq,a.window);Core.Functions.grid.Cotizaciones.initGrid(a.divEtf,true,true,false,d,null,null,false,Core.Enums.ePanel.BCIETF,b,c);Core.Functions.grid.Cotizaciones.initFilter(a.divEtf,a.txtFilterEtf,a.timeoutEtf,a.window);a.ddlInstrumentSearch=$(".dropdown-instrument-search");Core.Functions.grid.Cotizaciones.initInstrumentSearch(a.ddlInstrumentSearch,b,c);a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){Core.Functions.grid.Cotizaciones.loadInstrumentSearch(b,a.ddlInstrumentSearch,function(){a.loadTab(a.divNyse,"exterior/60",Core.Enums.ePanel.BCINYSE)})},"Core.Business.BCIICE")})};a.setTabs=function(){a.divAlertaTipoPrecio=$(".div-alert-price-type");a.divAlertaTipoPrecio.hide();a.divNyse=$(".div-nyse");a.txtFilterNyse=$(".textbox-nyse-filter");a.divNasdaq=$(".div-nasdaq");a.txtFilterNasdaq=$(".textbox-nasdaq-filter");a.divEtf=$(".div-etf");a.txtFilterEtf=$(".textbox-etf-filter");a.btnNyse=$(".btn-nyse");a.btnNasdaq=$(".btn-nasdaq");a.btnEtf=$(".btn-etf");a.btnNyse.click(function(){a.loaded=false;a.refresh=false;a.forceRefresh=false;a.loadTab(a.divNyse,"exterior/60",Core.Enums.ePanel.BCINYSE)});a.btnNasdaq.click(function(){a.loaded=false;a.refresh=false;a.forceRefresh=false;a.loadTab(a.divNasdaq,"exterior/61",Core.Enums.ePanel.BCINASDAQ)});a.btnEtf.click(function(){a.loaded=false;a.refresh=false;a.forceRefresh=false;a.loadTab(a.divEtf,"exterior/62",Core.Enums.ePanel.BCIETF)})};a.loadTab=function(b,d,c){Core.Functions.grid.Cotizaciones.details=[];a.maxToken=0;a.lastData=null;a.divAlertaTipoPrecio.hide();a.clearTimers();Core.Functions.grid.Cotizaciones.loadGrid(b,null,d,a.lastData,a.maxToken,null,null,function(f,e){return true},function(e,h,f,g,i){a.lastData=e;a.maxToken=h;a.loaded=true;a.refresh=true;a.clearTimers();a.timerId=window.setInterval(function(){if(a.loaded&&(a.refresh||a.forceRefresh)){Core.Functions.grid.Cotizaciones.loadGrid(b,null,d,a.lastData,a.maxToken,null,null,function(k,j){return true},function(j,k){a.lastData=j;a.maxToken=k},false);a.forceRefresh=false}a.refresh=true},((i&&i.PoolTimer)?i.PoolTimer:Core.Functions.grid.Cotizaciones.REFRESH_TIME));Core.Objects.Context.Timers.push(a.timerId);a.timerIdForceRefresh=window.setInterval(function(){a.forceRefresh=true},600000);Core.Objects.Context.Timers.push(a.timerIdForceRefresh);if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:c,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(k){if(a.loaded){var j={cotizaciones:[]};j.cotizaciones.push(JSON.parse(k.data));Core.Functions.grid.Cotizaciones.refreshGrid(j,b,null,a.lastData,a.maxToken,null,null,function(m,l){return true},function(l,m){a.lastData=l;a.maxToken=m;a.refresh=false},false)}}}if(i){Core.Functions.grid.Cotizaciones.setAlertPriceType(a.divAlertaTipoPrecio,i.TextoAlerta,i.TipoAlerta,a.idDefaultAccount,a.idDefaultProfile)}},false)};a.clearTimers=function(){if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:0,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(b){}}window.clearInterval(a.timerId);Core.Objects.Context.Timers.remove(a.timerId);window.clearInterval(a.timerIdForceRefresh);Core.Objects.Context.Timers.remove(a.timerIdForceRefresh)}};Core.Business.CotizacionesBonos=new function(){var a=this;a.id="cot_bonos";a.optionsCotizaciones=null;a.idDefaultAccount=null;a.idDefaultProfile=null;a.btnSoberanos=null;a.btnSubsoberanos=null;a.divSoberanos=null;a.txtFilterSoberanos=null;a.timeoutSoberanos=null;a.divSubsoberanos=null;a.txtFilterSubsoberanos=null;a.timeoutSubsoberanos=null;a.divSoberanosPlazo=null;a.ddlSoberanosPlazo=null;a.divSubsoberanosPlazo=null;a.ddlSubsoberanosPlazo=null;a.divSoberanosChksMonedas=null;a.lblSoberanosChkPesos=null;a.chkSoberanosPesos=null;a.lblSoberanosChkDolaresMep=null;a.chkSoberanosDolaresMep=null;a.lblSoberanosChkDolaresCable=null;a.chkSoberanosDolaresCable=null;a.divSubsoberanosChksMonedas=null;a.lblSubsoberanosChkPesos=null;a.chkSubsoberanosPesos=null;a.lblSubsoberanosChkDolaresMep=null;a.chkSubsoberanosDolaresMep=null;a.lblSubsoberanosChkDolaresCable=null;a.chkSubsoberanosDolaresCable=null;a.maxToken=0;a.lastData=null;a.timerId=null;a.timerIdForceRefresh=null;a.loaded=false;a.refresh=false;a.forceRefresh=false;a.window=$(window);a.init=function(b,c){Core.loadPage("cotizaciones_bonos.html",function(){document.title="Bonos";a.loaded=false;a.refresh=false;a.forceRefresh=false;a.optionsCotizaciones=Core.Functions.Context.Profiles.getPageOptionsByMenu("cotizaciones",Core.Objects.Context.Profiles[c]);a.idDefaultAccount=b;a.idDefaultProfile=c;a.maxToken=0;a.lastData=null;a.setTabs();Core.Functions.grid.Cotizaciones.initGrid(a.divSoberanos,true,true,false,Core.Objects.Context.Profiles[c].opciones.maxWatchlists,null,null,a.optionsCotizaciones.cot_profundidad,Core.Enums.ePanel.BonosSoberanos,b,c);Core.Functions.grid.Cotizaciones.initFilter(a.divSoberanos,a.txtFilterSoberanos,a.timeoutSoberanos,a.window);Core.Functions.grid.Cotizaciones.initGrid(a.divSubsoberanos,true,true,false,Core.Objects.Context.Profiles[c].opciones.maxWatchlists,null,null,a.optionsCotizaciones.cot_profundidad,Core.Enums.ePanel.BonosSubsoberanos,b,c);Core.Functions.grid.Cotizaciones.initFilter(a.divSubsoberanos,a.txtFilterSubsoberanos,a.timeoutSubsoberanos,a.window);a.ddlInstrumentSearch=$(".dropdown-instrument-search");Core.Functions.grid.Cotizaciones.initInstrumentSearch(a.ddlInstrumentSearch,b,c);a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){Core.Functions.grid.Cotizaciones.loadInstrumentSearch(b,a.ddlInstrumentSearch,function(){a.loaded=false;a.refresh=false;a.forceRefresh=false;a.loadTab(a.divSoberanos,"panel/23",Core.Enums.ePanel.BonosSoberanos,a.divSoberanosPlazo,a.ddlSoberanosPlazo,a.divSoberanosChksMonedas,a.chkSoberanosPesos,a.lblSoberanosChkPesos,a.chkSoberanosDolaresMep,a.lblSoberanosChkDolaresMep,a.chkSoberanosDolaresCable,a.lblSoberanosChkDolaresCable)})},"Core.Business.CotizacionesBonos")})};a.setTabs=function(){a.divSoberanos=$(".div-soberanos");a.txtFilterSoberanos=$(".textbox-soberanos-filter");a.divSubsoberanos=$(".div-subsoberanos");a.txtFilterSubsoberanos=$(".textbox-subsoberanos-filter");a.btnSoberanos=$(".btn-soberanos");a.btnSubsoberanos=$(".btn-subsoberanos");a.divSoberanosPlazo=$(".div-soberanos-plazo");a.ddlSoberanosPlazo=$(".dropdown-soberanos-plazo");a.divSoberanosPlazo.hide();a.ddlSoberanosPlazo.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",events:{select:function(b){a.loadTab(a.divSoberanos,"panel/23",Core.Enums.ePanel.BonosSoberanos,a.divSoberanosPlazo,a.ddlSoberanosPlazo,a.divSoberanosChksMonedas,a.chkSoberanosPesos,a.lblSoberanosChkPesos,a.chkSoberanosDolaresMep,a.lblSoberanosChkDolaresMep,a.chkSoberanosDolaresCable,a.lblSoberanosChkDolaresCable)}},width:150});a.divSubsoberanosPlazo=$(".div-subsoberanos-plazo");a.ddlSubsoberanosPlazo=$(".dropdown-subsoberanos-plazo");a.divSubsoberanosPlazo.hide();a.ddlSubsoberanosPlazo.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",events:{select:function(b){a.loadTab(a.divSubsoberanos,"panel/24",Core.Enums.ePanel.BonosSubsoberanos,a.divSubsoberanosPlazo,a.ddlSubsoberanosPlazo,a.divSubsoberanosChksMonedas,a.chkSubsoberanosPesos,a.lblSubsoberanosChkPesos,a.chkSubsoberanosDolaresMep,a.lblSubsoberanosChkDolaresMep,a.chkSubsoberanosDolaresCable,a.lblSubsoberanosChkDolaresCable)}},width:150});a.divSoberanosChksMonedas=$(".div-chks-soberanos-monedas");a.divSoberanosChksMonedas.hide();a.lblSoberanosChkPesos=$(".lbl-checkbox-soberanos-pesos");a.chkSoberanosPesos=$(".checkbox-soberanos-pesos");a.chkSoberanosPesos[0].checked=true;a.lblSoberanosChkDolaresMep=$(".lbl-checkbox-soberanos-dolares-mep");a.chkSoberanosDolaresMep=$(".checkbox-soberanos-dolares-mep");a.chkSoberanosDolaresMep[0].checked=true;a.lblSoberanosChkDolaresCable=$(".lbl-checkbox-soberanos-dolares-cable");a.chkSoberanosDolaresCable=$(".checkbox-soberanos-dolares-cable");a.chkSoberanosDolaresCable[0].checked=true;a.chkSoberanosPesos.on("change",function(){a.loadTab(a.divSoberanos,"panel/23",Core.Enums.ePanel.BonosSoberanos,a.divSoberanosPlazo,a.ddlSoberanosPlazo,a.divSoberanosChksMonedas,a.chkSoberanosPesos,a.lblSoberanosChkPesos,a.chkSoberanosDolaresMep,a.lblSoberanosChkDolaresMep,a.chkSoberanosDolaresCable,a.lblSoberanosChkDolaresCable)});a.chkSoberanosDolaresMep.on("change",function(){a.loadTab(a.divSoberanos,"panel/23",Core.Enums.ePanel.BonosSoberanos,a.divSoberanosPlazo,a.ddlSoberanosPlazo,a.divSoberanosChksMonedas,a.chkSoberanosPesos,a.lblSoberanosChkPesos,a.chkSoberanosDolaresMep,a.lblSoberanosChkDolaresMep,a.chkSoberanosDolaresCable,a.lblSoberanosChkDolaresCable)});a.chkSoberanosDolaresCable.on("change",function(){a.loadTab(a.divSoberanos,"panel/23",Core.Enums.ePanel.BonosSoberanos,a.divSoberanosPlazo,a.ddlSoberanosPlazo,a.divSoberanosChksMonedas,a.chkSoberanosPesos,a.lblSoberanosChkPesos,a.chkSoberanosDolaresMep,a.lblSoberanosChkDolaresMep,a.chkSoberanosDolaresCable,a.lblSoberanosChkDolaresCable)});a.divSubsoberanosChksMonedas=$(".div-chks-subsoberanos-monedas");a.divSubsoberanosChksMonedas.hide();a.lblSubsoberanosChkPesos=$(".lbl-checkbox-subsoberanos-pesos");a.chkSubsoberanosPesos=$(".checkbox-subsoberanos-pesos");a.chkSubsoberanosPesos[0].checked=true;a.lblSubsoberanosChkDolaresMep=$(".lbl-checkbox-subsoberanos-dolares-mep");a.chkSubsoberanosDolaresMep=$(".checkbox-subsoberanos-dolares-mep");a.chkSubsoberanosDolaresMep[0].checked=true;a.lblSubsoberanosChkDolaresCable=$(".lbl-checkbox-subsoberanos-dolares-cable");a.chkSubsoberanosDolaresCable=$(".checkbox-subsoberanos-dolares-cable");a.chkSubsoberanosDolaresCable[0].checked=true;a.chkSubsoberanosPesos.on("change",function(){a.loadTab(a.divSubsoberanos,"panel/24",Core.Enums.ePanel.BonosSubsoberanos,a.divSubsoberanosPlazo,a.ddlSubsoberanosPlazo,a.divSubsoberanosChksMonedas,a.chkSubsoberanosPesos,a.lblSubsoberanosChkPesos,a.chkSubsoberanosDolaresMep,a.lblSubsoberanosChkDolaresMep,a.chkSubsoberanosDolaresCable,a.lblSubsoberanosChkDolaresCable)});a.chkSubsoberanosDolaresMep.on("change",function(){a.loadTab(a.divSubsoberanos,"panel/24",Core.Enums.ePanel.BonosSubsoberanos,a.divSubsoberanosPlazo,a.ddlSubsoberanosPlazo,a.divSubsoberanosChksMonedas,a.chkSubsoberanosPesos,a.lblSubsoberanosChkPesos,a.chkSubsoberanosDolaresMep,a.lblSubsoberanosChkDolaresMep,a.chkSubsoberanosDolaresCable,a.lblSubsoberanosChkDolaresCable)});a.chkSubsoberanosDolaresCable.on("change",function(){a.loadTab(a.divSubsoberanos,"panel/24",Core.Enums.ePanel.BonosSubsoberanos,a.divSubsoberanosPlazo,a.ddlSubsoberanosPlazo,a.divSubsoberanosChksMonedas,a.chkSubsoberanosPesos,a.lblSubsoberanosChkPesos,a.chkSubsoberanosDolaresMep,a.lblSubsoberanosChkDolaresMep,a.chkSubsoberanosDolaresCable,a.lblSubsoberanosChkDolaresCable)});a.btnSoberanos.on("shown.bs.tab",function(){a.loaded=false;a.loadTab(a.divSoberanos,"panel/23",Core.Enums.ePanel.BonosSoberanos,a.divSoberanosPlazo,a.ddlSoberanosPlazo,a.divSoberanosChksMonedas,a.chkSoberanosPesos,a.lblSoberanosChkPesos,a.chkSoberanosDolaresMep,a.lblSoberanosChkDolaresMep,a.chkSoberanosDolaresCable,a.lblSoberanosChkDolaresCable)});a.btnSubsoberanos.on("shown.bs.tab",function(){a.loaded=false;a.loadTab(a.divSubsoberanos,"panel/24",Core.Enums.ePanel.BonosSubsoberanos,a.divSubsoberanosPlazo,a.ddlSubsoberanosPlazo,a.divSubsoberanosChksMonedas,a.chkSubsoberanosPesos,a.lblSubsoberanosChkPesos,a.chkSubsoberanosDolaresMep,a.lblSubsoberanosChkDolaresMep,a.chkSubsoberanosDolaresCable,a.lblSubsoberanosChkDolaresCable)})};a.loadTab=function(e,m,i,h,f,g,d,l,c,k,b,j){Core.Functions.grid.Cotizaciones.details=[];a.maxToken=0;a.lastData=null;a.refresh=false;a.forceRefresh=false;if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:0,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(n){}}window.clearInterval(a.timerId);Core.Objects.Context.Timers.remove(a.timerId);window.clearInterval(a.timerIdForceRefresh);Core.Objects.Context.Timers.remove(a.timerIdForceRefresh);Core.Functions.grid.Cotizaciones.loadGrid(e,null,m,a.lastData,a.maxToken,null,null,function(o,n){return(!a.loaded||(o.plazo==f.swidget().selectedItem().value&&a.filterMoneda(o.mo,g,d,c,b)))},function(q,r){a.lastData=q;a.maxToken=r;if(!a.loaded){var t=[];var s=[];a.lastData.forEach(function(v,u){if(t.indexOf(v.plazo)==-1){t.push(v.plazo)}if(s.indexOf(v.mo)==-1){s.push(v.mo)}});var n=[];t.forEach(function(v,u){n.push({value:v,text:v})});var o=f.swidget().initialOptions;o.dataSource.data=n;f.swidget().refresh(o);f.swidget().selected(t.length-1,true);if(t.length>1){h.show()}if(s.length>1){g.show();if(s.indexOf("Pesos")==-1){d.hide();l.hide()}if(s.indexOf("Dolar MEP")==-1){c.hide();k.hide()}if(s.indexOf("Dolar Cable")==-1){b.hide();j.hide()}}a.loaded=true;a.lastData=$.grep(a.lastData,function(v,u){return v.plazo==f.swidget().selectedItem().value&&a.filterMoneda(v.mo,g,d,c,b)});var p=e.swidget().initialOptions;p.dataSource.data=a.lastData;e.swidget().refresh(p)}},a.optionsCotizaciones.cot_profundidad);a.timerId=window.setInterval(function(){if(a.loaded&&(a.refresh||a.forceRefresh)){Core.Functions.grid.Cotizaciones.loadGrid(e,null,m,a.lastData,a.maxToken,null,null,function(o,n){return o.plazo==f.swidget().selectedItem().value&&a.filterMoneda(o.mo,g,d,c,b)},function(n,o){a.lastData=n;a.maxToken=o},a.optionsCotizaciones.cot_profundidad);a.forceRefresh=false}a.refresh=true},Core.Functions.grid.Cotizaciones.REFRESH_TIME);Core.Objects.Context.Timers.push(a.timerId);a.timerIdForceRefresh=window.setInterval(function(){a.forceRefresh=true},600000);Core.Objects.Context.Timers.push(a.timerIdForceRefresh);if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:i,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(o){if(a.loaded){var n={cotizaciones:[]};n.cotizaciones.push(JSON.parse(o.data));Core.Functions.grid.Cotizaciones.refreshGrid(n,e,null,a.lastData,a.maxToken,null,null,function(q,p){return q.plazo==f.swidget().selectedItem().value&&a.filterMoneda(q.mo,g,d,c,b)},function(p,q){a.lastData=p;a.maxToken=q;a.refresh=false},a.optionsCotizaciones.cot_profundidad)}}}};a.filterMoneda=function(f,e,d,c,b){return(f=="Pesos"&&(!e.is(":visible")||(d[0].checked)))||(f=="Dolar MEP"&&(!e.is(":visible")||(c[0].checked)))||(f=="Dolar Cable"&&(!e.is(":visible")||(b[0].checked)))}};Core.Business.CotizacionesCorporativos=new function(){var a=this;a.id="cot_corporativos";a.optionsCotizaciones=null;a.idDefaultAccount=null;a.idDefaultProfile=null;a.divObligacionesNegociables=null;a.txtFilterObligacionesNegociables=null;a.timeoutObligacionesNegociables=null;a.divObligacionesNegociablesPlazo=null;a.ddlObligacionesNegociablesPlazo=null;a.divObligacionesNegociablesChksMonedas=null;a.lblObligacionesNegociablesChkPesos=null;a.chkObligacionesNegociablesPesos=null;a.lblObligacionesNegociablesChkDolaresMep=null;a.chkObligacionesNegociablesDolaresMep=null;a.lblObligacionesNegociablesChkDolaresCable=null;a.chkObligacionesNegociablesDolaresCable=null;a.maxToken=0;a.lastData=null;a.timerId=null;a.timerIdForceRefresh=null;a.loaded=false;a.refresh=false;a.forceRefresh=false;a.window=$(window);a.init=function(b,c){Core.loadPage("cotizaciones_corporativos.html",function(){document.title="Corporativos";a.loaded=false;a.refresh=false;a.forceRefresh=false;a.optionsCotizaciones=Core.Functions.Context.Profiles.getPageOptionsByMenu("cotizaciones",Core.Objects.Context.Profiles[c]);a.idDefaultAccount=b;a.idDefaultProfile=c;a.maxToken=0;a.lastData=null;a.setTabs();Core.Functions.grid.Cotizaciones.initGrid(a.divObligacionesNegociables,true,true,false,Core.Objects.Context.Profiles[c].opciones.maxWatchlists,null,null,a.optionsCotizaciones.cot_profundidad,Core.Enums.ePanel.CorporativosObligacionesNegociables,b,c);Core.Functions.grid.Cotizaciones.initFilter(a.divObligacionesNegociables,a.txtFilterObligacionesNegociables,a.timeoutObligacionesNegociables,a.window);a.ddlInstrumentSearch=$(".dropdown-instrument-search");Core.Functions.grid.Cotizaciones.initInstrumentSearch(a.ddlInstrumentSearch,b,c);a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){Core.Functions.grid.Cotizaciones.loadInstrumentSearch(b,a.ddlInstrumentSearch,function(){a.loaded=false;a.refresh=false;a.forceRefresh=false;a.loadTab(a.divObligacionesNegociables,"panel/27",Core.Enums.ePanel.CorporativosObligacionesNegociables,a.divObligacionesNegociablesPlazo,a.ddlObligacionesNegociablesPlazo,a.divObligacionesNegociablesChksMonedas,a.chkObligacionesNegociablesPesos,a.lblObligacionesNegociablesChkPesos,a.chkObligacionesNegociablesDolaresMep,a.lblObligacionesNegociablesChkDolaresMep,a.chkObligacionesNegociablesDolaresCable,a.lblObligacionesNegociablesChkDolaresCable)})},"Core.Business.CotizacionesCorporativos")})};a.setTabs=function(){a.divObligacionesNegociables=$(".div-obligaciones-negociables");a.txtFilterObligacionesNegociables=$(".textbox-obligaciones-negociables-filter");a.divObligacionesNegociablesPlazo=$(".div-obligaciones-negociables-plazo");a.ddlObligacionesNegociablesPlazo=$(".dropdown-obligaciones-negociables-plazo");a.divObligacionesNegociablesPlazo.hide();a.ddlObligacionesNegociablesPlazo.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",events:{select:function(b){a.loadTab(a.divObligacionesNegociables,"panel/27",Core.Enums.ePanel.CorporativosObligacionesNegociables,a.divObligacionesNegociablesPlazo,a.ddlObligacionesNegociablesPlazo,a.divObligacionesNegociablesChksMonedas,a.chkObligacionesNegociablesPesos,a.lblObligacionesNegociablesChkPesos,a.chkObligacionesNegociablesDolaresMep,a.lblObligacionesNegociablesChkDolaresMep,a.chkObligacionesNegociablesDolaresCable,a.lblObligacionesNegociablesChkDolaresCable)}},width:150});a.divObligacionesNegociablesChksMonedas=$(".div-chks-obligaciones-negociables-monedas");a.divObligacionesNegociablesChksMonedas.hide();a.lblObligacionesNegociablesChkPesos=$(".lbl-checkbox-obligaciones-negociables-pesos");a.chkObligacionesNegociablesPesos=$(".checkbox-obligaciones-negociables-pesos");a.chkObligacionesNegociablesPesos[0].checked=true;a.lblObligacionesNegociablesChkDolaresMep=$(".lbl-checkbox-obligaciones-negociables-dolares-mep");a.chkObligacionesNegociablesDolaresMep=$(".checkbox-obligaciones-negociables-dolares-mep");a.chkObligacionesNegociablesDolaresMep[0].checked=true;a.lblObligacionesNegociablesChkDolaresCable=$(".lbl-checkbox-obligaciones-negociables-dolares-cable");a.chkObligacionesNegociablesDolaresCable=$(".checkbox-obligaciones-negociables-dolares-cable");a.chkObligacionesNegociablesDolaresCable[0].checked=true;a.chkObligacionesNegociablesPesos.on("change",function(){a.loadTab(a.divObligacionesNegociables,"panel/27",Core.Enums.ePanel.CorporativosObligacionesNegociables,a.divObligacionesNegociablesPlazo,a.ddlObligacionesNegociablesPlazo,a.divObligacionesNegociablesChksMonedas,a.chkObligacionesNegociablesPesos,a.lblObligacionesNegociablesChkPesos,a.chkObligacionesNegociablesDolaresMep,a.lblObligacionesNegociablesChkDolaresMep,a.chkObligacionesNegociablesDolaresCable,a.lblObligacionesNegociablesChkDolaresCable)});a.chkObligacionesNegociablesDolaresMep.on("change",function(){a.loadTab(a.divObligacionesNegociables,"panel/27",Core.Enums.ePanel.CorporativosObligacionesNegociables,a.divObligacionesNegociablesPlazo,a.ddlObligacionesNegociablesPlazo,a.divObligacionesNegociablesChksMonedas,a.chkObligacionesNegociablesPesos,a.lblObligacionesNegociablesChkPesos,a.chkObligacionesNegociablesDolaresMep,a.lblObligacionesNegociablesChkDolaresMep,a.chkObligacionesNegociablesDolaresCable,a.lblObligacionesNegociablesChkDolaresCable)});a.chkObligacionesNegociablesDolaresCable.on("change",function(){a.loadTab(a.divObligacionesNegociables,"panel/27",Core.Enums.ePanel.CorporativosObligacionesNegociables,a.divObligacionesNegociablesPlazo,a.ddlObligacionesNegociablesPlazo,a.divObligacionesNegociablesChksMonedas,a.chkObligacionesNegociablesPesos,a.lblObligacionesNegociablesChkPesos,a.chkObligacionesNegociablesDolaresMep,a.lblObligacionesNegociablesChkDolaresMep,a.chkObligacionesNegociablesDolaresCable,a.lblObligacionesNegociablesChkDolaresCable)})};a.loadTab=function(e,m,i,h,f,g,d,l,c,k,b,j){Core.Functions.grid.Cotizaciones.details=[];a.maxToken=0;a.lastData=null;a.refresh=false;a.forceRefresh=false;if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:0,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(n){}}window.clearInterval(a.timerId);Core.Objects.Context.Timers.remove(a.timerId);window.clearInterval(a.timerIdForceRefresh);Core.Objects.Context.Timers.remove(a.timerIdForceRefresh);Core.Functions.grid.Cotizaciones.loadGrid(e,null,m,a.lastData,a.maxToken,null,null,function(o,n){return(!a.loaded||(o.plazo==f.swidget().selectedItem().value&&a.filterMoneda(o.mo,g,d,c,b)))},function(q,r){a.lastData=q;a.maxToken=r;if(!a.loaded){var t=[];var s=[];a.lastData.forEach(function(v,u){if(t.indexOf(v.plazo)==-1){t.push(v.plazo)}if(s.indexOf(v.mo)==-1){s.push(v.mo)}});var n=[];t.forEach(function(v,u){n.push({value:v,text:v})});var o=f.swidget().initialOptions;o.dataSource.data=n;f.swidget().refresh(o);f.swidget().selected(t.length-1,true);if(t.length>1){h.show()}if(s.length>1){g.show();if(s.indexOf("Pesos")==-1){d.hide();l.hide()}if(s.indexOf("Dolar MEP")==-1){c.hide();k.hide()}if(s.indexOf("Dolar Cable")==-1){b.hide();j.hide()}}a.loaded=true;var p=e.swidget().initialOptions;p.dataSource.data=$.grep(a.lastData,function(v,u){return v.plazo==f.swidget().selectedItem().value&&a.filterMoneda(v.mo,g,d,c,b)});e.swidget().refresh(p)}},a.optionsCotizaciones.cot_profundidad);a.timerId=window.setInterval(function(){if(a.loaded&&(a.refresh||a.forceRefresh)){Core.Functions.grid.Cotizaciones.loadGrid(e,null,m,a.lastData,a.maxToken,null,null,function(o,n){return o.plazo==f.swidget().selectedItem().value&&a.filterMoneda(o.mo,g,d,c,b)},function(n,o){a.lastData=n;a.maxToken=o},a.optionsCotizaciones.cot_profundidad);a.forceRefresh=false}a.refresh=true},Core.Functions.grid.Cotizaciones.REFRESH_TIME);Core.Objects.Context.Timers.push(a.timerId);a.timerIdForceRefresh=window.setInterval(function(){a.forceRefresh=true},600000);Core.Objects.Context.Timers.push(a.timerIdForceRefresh);if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:i,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(o){if(a.loaded){var n={cotizaciones:[]};n.cotizaciones.push(JSON.parse(o.data));Core.Functions.grid.Cotizaciones.refreshGrid(n,e,null,a.lastData,a.maxToken,null,null,function(q,p){return q.plazo==f.swidget().selectedItem().value&&a.filterMoneda(q.mo,g,d,c,b)},function(p,q){a.lastData=p;a.maxToken=q;a.refresh=false},a.optionsCotizaciones.cot_profundidad)}}}};a.filterMoneda=function(f,e,d,c,b){return(f=="Pesos"&&(!e.is(":visible")||(d[0].checked)))||(f=="Dolar MEP"&&(!e.is(":visible")||(c[0].checked)))||(f=="Dolar Cable"&&(!e.is(":visible")||(b[0].checked)))}};Core.Business.CotizacionesDolarBolsa=new function(){var a=this;a.id="cot_dolarbolsa";a.optionsCotizaciones=null;a.idDefaultAccount=null;a.idDefaultProfile=null;a.divDolarBolsa=null;a.txtFilterDolarBolsa=null;a.timeoutDolarBolsa=null;a.divDolarBolsaPlazo=null;a.ddlDolarBolsaPlazo=null;a.divDolarBolsaChksMonedas=null;a.lblDolarBolsaChkPesos=null;a.chkDolarBolsaPesos=null;a.lblDolarBolsaChkDolaresMep=null;a.chkDolarBolsaDolaresMep=null;a.lblDolarBolsaChkDolaresCable=null;a.chkDolarBolsaDolaresCable=null;a.maxToken=0;a.lastData=null;a.timerId=null;a.timerIdForceRefresh=null;a.loaded=false;a.refresh=false;a.forceRefresh=false;a.window=$(window);a.init=function(b,c){Core.loadPage("cotizaciones-dolar-bolsa.html",function(){document.title="Dólar Bolsa";a.loaded=false;a.refresh=false;a.forceRefresh=false;a.optionsCotizaciones=Core.Functions.Context.Profiles.getPageOptionsByMenu("cotizaciones",Core.Objects.Context.Profiles[c]);a.idDefaultAccount=b;a.idDefaultProfile=c;a.maxToken=0;a.lastData=null;a.setTabs();Core.Functions.grid.Cotizaciones.initGrid(a.divDolarBolsa,false,false,false,Core.Objects.Context.Profiles[c].opciones.maxWatchlists,null,null,a.optionsCotizaciones.cot_profundidad,Core.Enums.ePanel.DolarBolsa,b,c);Core.Functions.grid.Cotizaciones.initFilter(a.divDolarBolsa,a.txtFilterDolarBolsa,a.timeoutDolarBolsa,a.window);a.ddlInstrumentSearch=$(".dropdown-instrument-search");Core.Functions.grid.Cotizaciones.initInstrumentSearch(a.ddlInstrumentSearch,b,c);a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){Core.Functions.grid.Cotizaciones.loadInstrumentSearch(b,a.ddlInstrumentSearch,function(){a.loaded=false;a.refresh=false;a.forceRefresh=false;a.loadTab(a.divDolarBolsa,"panel/35",Core.Enums.ePanel.DolarBolsa,a.divDolarBolsaPlazo,a.ddlDolarBolsaPlazo,a.divDolarBolsaChksMonedas,a.chkDolarBolsaPesos,a.lblDolarBolsaChkPesos,a.chkDolarBolsaDolaresMep,a.lblDolarBolsaChkDolaresMep,a.chkDolarBolsaDolaresCable,a.lblDolarBolsaChkDolaresCable)})},"Core.Business.CotizacionesDolarBolsa")})};a.setTabs=function(){a.divDolarBolsa=$(".div-dolar-bolsa");a.txtFilterDolarBolsa=$(".textbox-dolar-bolsa-filter");a.divDolarBolsaPlazo=$(".div-dolar-bolsa-plazo");a.ddlDolarBolsaPlazo=$(".dropdown-dolar-bolsa-plazo");a.divDolarBolsaPlazo.hide();a.ddlDolarBolsaPlazo.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",events:{select:function(b){a.loadTab(a.divDolarBolsa,"panel/35",Core.Enums.ePanel.DolarBolsa,a.divDolarBolsaPlazo,a.ddlDolarBolsaPlazo,a.divDolarBolsaChksMonedas,a.chkDolarBolsaPesos,a.lblDolarBolsaChkPesos,a.chkDolarBolsaDolaresMep,a.lblDolarBolsaChkDolaresMep,a.chkDolarBolsaDolaresCable,a.lblDolarBolsaChkDolaresCable)}},width:150});a.divDolarBolsaChksMonedas=$(".div-chks-dolar-bolsa-monedas");a.divDolarBolsaChksMonedas.hide();a.lblDolarBolsaChkPesos=$(".lbl-checkbox-dolar-bolsa-pesos");a.chkDolarBolsaPesos=$(".checkbox-dolar-bolsa-pesos");a.chkDolarBolsaPesos[0].checked=true;a.lblDolarBolsaChkDolaresMep=$(".lbl-checkbox-dolar-bolsa-dolares-mep");a.chkDolarBolsaDolaresMep=$(".checkbox-dolar-bolsa-dolares-mep");a.chkDolarBolsaDolaresMep[0].checked=true;a.lblDolarBolsaChkDolaresCable=$(".lbl-checkbox-dolar-bolsa-dolares-cable");a.chkDolarBolsaDolaresCable=$(".checkbox-dolar-bolsa-dolares-cable");a.chkDolarBolsaDolaresCable[0].checked=true;a.chkDolarBolsaPesos.on("change",function(){a.loadTab(a.divDolarBolsa,"panel/35",Core.Enums.ePanel.DolarBolsa,a.divDolarBolsaPlazo,a.ddlDolarBolsaPlazo,a.divDolarBolsaChksMonedas,a.chkDolarBolsaPesos,a.lblDolarBolsaChkPesos,a.chkDolarBolsaDolaresMep,a.lblDolarBolsaChkDolaresMep,a.chkDolarBolsaDolaresCable,a.lblDolarBolsaChkDolaresCable)});a.chkDolarBolsaDolaresMep.on("change",function(){a.loadTab(a.divDolarBolsa,"panel/35",Core.Enums.ePanel.DolarBolsa,a.divDolarBolsaPlazo,a.ddlDolarBolsaPlazo,a.divDolarBolsaChksMonedas,a.chkDolarBolsaPesos,a.lblDolarBolsaChkPesos,a.chkDolarBolsaDolaresMep,a.lblDolarBolsaChkDolaresMep,a.chkDolarBolsaDolaresCable,a.lblDolarBolsaChkDolaresCable)});a.chkDolarBolsaDolaresCable.on("change",function(){a.loadTab(a.divDolarBolsa,"panel/35",Core.Enums.ePanel.DolarBolsa,a.divDolarBolsaPlazo,a.ddlDolarBolsaPlazo,a.divDolarBolsaChksMonedas,a.chkDolarBolsaPesos,a.lblDolarBolsaChkPesos,a.chkDolarBolsaDolaresMep,a.lblDolarBolsaChkDolaresMep,a.chkDolarBolsaDolaresCable,a.lblDolarBolsaChkDolaresCable)})};a.loadTab=function(e,m,i,h,f,g,d,l,c,k,b,j){Core.Functions.grid.Cotizaciones.details=[];a.maxToken=0;a.lastData=null;a.refresh=false;a.forceRefresh=false;if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:0,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(n){}}window.clearInterval(a.timerId);Core.Objects.Context.Timers.remove(a.timerId);window.clearInterval(a.timerIdForceRefresh);Core.Objects.Context.Timers.remove(a.timerIdForceRefresh);Core.Functions.grid.Cotizaciones.loadGrid(e,null,m,a.lastData,a.maxToken,null,null,function(o,n){return(!a.loaded||(o.plazo==f.swidget().selectedItem().value&&a.filterMoneda(o.mo,g,d,c,b)))},function(q,r){a.lastData=q;a.maxToken=r;if(!a.loaded){var t=[];var s=[];a.lastData.forEach(function(v,u){if(t.indexOf(v.plazo)==-1){t.push(v.plazo)}if(s.indexOf(v.mo)==-1){s.push(v.mo)}});var n=[];t.forEach(function(v,u){n.push({value:v,text:v})});var o=f.swidget().initialOptions;o.dataSource.data=n;f.swidget().refresh(o);f.swidget().selected(t.length-1,true);if(t.length>1){h.show()}if(s.length>1){g.show();if(s.indexOf("Pesos")==-1){d.hide();l.hide()}if(s.indexOf("Dolar MEP")==-1){c.hide();k.hide()}if(s.indexOf("Dolar Cable")==-1){b.hide();j.hide()}}a.loaded=true;var p=e.swidget().initialOptions;p.dataSource.data=$.grep(a.lastData,function(v,u){return v.plazo==f.swidget().selectedItem().value&&a.filterMoneda(v.mo,g,d,c,b)});e.swidget().refresh(p)}},a.optionsCotizaciones.cot_profundidad);a.timerId=window.setInterval(function(){if(a.loaded&&(a.refresh||a.forceRefresh)){Core.Functions.grid.Cotizaciones.loadGrid(e,null,m,a.lastData,a.maxToken,null,null,function(o,n){return o.plazo==f.swidget().selectedItem().value&&a.filterMoneda(o.mo,g,d,c,b)},function(n,o){a.lastData=n;a.maxToken=o},a.optionsCotizaciones.cot_profundidad);a.forceRefresh=false}a.refresh=true},Core.Functions.grid.Cotizaciones.REFRESH_TIME);Core.Objects.Context.Timers.push(a.timerId);a.timerIdForceRefresh=window.setInterval(function(){a.forceRefresh=true},600000);Core.Objects.Context.Timers.push(a.timerIdForceRefresh);if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:i,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(o){if(a.loaded){var n={cotizaciones:[]};n.cotizaciones.push(JSON.parse(o.data));Core.Functions.grid.Cotizaciones.refreshGrid(n,e,null,a.lastData,a.maxToken,null,null,function(q,p){return q.plazo==f.swidget().selectedItem().value&&a.filterMoneda(q.mo,g,d,c,b)},function(p,q){a.lastData=p;a.maxToken=q;a.refresh=false},a.optionsCotizaciones.cot_profundidad)}}}};a.filterMoneda=function(f,e,d,c,b){return(f=="Pesos"&&(!e.is(":visible")||(d[0].checked)))||(f=="Dolar MEP"&&(!e.is(":visible")||(c[0].checked)))||(f=="Dolar Cable"&&(!e.is(":visible")||(b[0].checked)))}};Core.Business.ICE=new function(){var a=this;a.id="cot_exterior";a.idDefaultAccount=null;a.idDefaultProfile=null;a.divAlertaTipoPrecio=null;a.btnNyse=null;a.btnNasdaq=null;a.btnEtf=null;a.divNyse=null;a.txtFilterNyse=null;a.timeoutNyse=null;a.divNasdaq=null;a.txtFilterNasdaq=null;a.timeoutNasdaq=null;a.divEtf=null;a.txtFilterEtf=null;a.timeoutEtf=null;a.maxToken=0;a.lastData=null;a.timerId=null;a.timerIdForceRefresh=null;a.loaded=false;a.refresh=false;a.forceRefresh=false;a.window=$(window);a.init=function(b,c){Core.loadPage("cotizaciones_ice.html",function(){document.title="Internacional";a.loaded=false;a.refresh=false;a.forceRefresh=false;a.idDefaultAccount=b;a.idDefaultProfile=c;a.maxToken=0;a.lastData=null;a.setTabs();var d=Core.Objects.Context.Profiles[c].opciones.maxWatchlists;Core.Functions.grid.Cotizaciones.initGrid(a.divNyse,true,true,false,d,null,null,false,Core.Enums.ePanel.NYSE,b,c);Core.Functions.grid.Cotizaciones.initFilter(a.divNyse,a.txtFilterNyse,a.timeoutNyse,a.window);Core.Functions.grid.Cotizaciones.initGrid(a.divNasdaq,true,true,false,d,null,null,false,Core.Enums.ePanel.NASDAQ,b,c);Core.Functions.grid.Cotizaciones.initFilter(a.divNasdaq,a.txtFilterNasdaq,a.timeoutNasdaq,a.window);Core.Functions.grid.Cotizaciones.initGrid(a.divEtf,true,true,false,d,null,null,false,Core.Enums.ePanel.ETF,b,c);Core.Functions.grid.Cotizaciones.initFilter(a.divEtf,a.txtFilterEtf,a.timeoutEtf,a.window);a.ddlInstrumentSearch=$(".dropdown-instrument-search");Core.Functions.grid.Cotizaciones.initInstrumentSearch(a.ddlInstrumentSearch,b,c);a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){Core.Functions.grid.Cotizaciones.loadInstrumentSearch(b,a.ddlInstrumentSearch,function(){a.loadTab(a.divNyse,"exterior/19",Core.Enums.ePanel.NYSE)})},"Core.Business.ICE")})};a.setTabs=function(){a.divAlertaTipoPrecio=$(".div-alert-price-type");a.divAlertaTipoPrecio.hide();a.divNyse=$(".div-nyse");a.txtFilterNyse=$(".textbox-nyse-filter");a.divNasdaq=$(".div-nasdaq");a.txtFilterNasdaq=$(".textbox-nasdaq-filter");a.divEtf=$(".div-etf");a.txtFilterEtf=$(".textbox-etf-filter");a.btnNyse=$(".btn-nyse");a.btnNasdaq=$(".btn-nasdaq");a.btnEtf=$(".btn-etf");a.btnNyse.click(function(){a.loaded=false;a.refresh=false;a.forceRefresh=false;a.loadTab(a.divNyse,"exterior/19",Core.Enums.ePanel.NYSE)});a.btnNasdaq.click(function(){a.loaded=false;a.refresh=false;a.forceRefresh=false;a.loadTab(a.divNasdaq,"exterior/21",Core.Enums.ePanel.NASDAQ)});a.btnEtf.click(function(){a.loaded=false;a.refresh=false;a.forceRefresh=false;a.loadTab(a.divEtf,"exterior/22",Core.Enums.ePanel.ETF)})};a.loadTab=function(b,d,c){Core.Functions.grid.Cotizaciones.details=[];a.maxToken=0;a.lastData=null;a.divAlertaTipoPrecio.hide();a.clearTimers();Core.Functions.grid.Cotizaciones.loadGrid(b,null,d,a.lastData,a.maxToken,null,null,function(f,e){return true},function(e,h,f,g,i){a.lastData=e;a.maxToken=h;a.loaded=true;a.refresh=true;a.clearTimers();a.timerId=window.setInterval(function(){if(a.loaded&&(a.refresh||a.forceRefresh)){Core.Functions.grid.Cotizaciones.loadGrid(b,null,d,a.lastData,a.maxToken,null,null,function(k,j){return true},function(j,k){a.lastData=j;a.maxToken=k},false);a.forceRefresh=false}a.refresh=true},((i&&i.PoolTimer)?i.PoolTimer:Core.Functions.grid.Cotizaciones.REFRESH_TIME));Core.Objects.Context.Timers.push(a.timerId);a.timerIdForceRefresh=window.setInterval(function(){a.forceRefresh=true},600000);Core.Objects.Context.Timers.push(a.timerIdForceRefresh);if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:c,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(k){if(a.loaded){var j={cotizaciones:[]};j.cotizaciones.push(JSON.parse(k.data));Core.Functions.grid.Cotizaciones.refreshGrid(j,b,null,a.lastData,a.maxToken,null,null,function(m,l){return true},function(l,m){a.lastData=l;a.maxToken=m;a.refresh=false},false)}}}if(i){Core.Functions.grid.Cotizaciones.setAlertPriceType(a.divAlertaTipoPrecio,i.TextoAlerta,i.TipoAlerta,a.idDefaultAccount,a.idDefaultProfile)}},false)};a.clearTimers=function(){if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:0,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(b){}}window.clearInterval(a.timerId);Core.Objects.Context.Timers.remove(a.timerId);window.clearInterval(a.timerIdForceRefresh);Core.Objects.Context.Timers.remove(a.timerIdForceRefresh)}};Core.Business.CotizacionesLetras=new function(){var a=this;a.id="cot_letras";a.optionsCotizaciones=null;a.idDefaultAccount=null;a.idDefaultProfile=null;a.btnLetes=null;a.btnLecaps=null;a.btnLecers=null;a.btnLelinks=null;a.divLetes=null;a.txtFilterLetes=null;a.timeoutLetes=null;a.divLecaps=null;a.txtFilterLecaps=null;a.timeoutLecaps=null;a.divLecers=null;a.txtFilterLecers=null;a.timeoutLecers=null;a.divLelinks=null;a.txtFilterLelinks=null;a.timeoutLelinks=null;a.divLetesPlazo=null;a.ddlLetesPlazo=null;a.divLecapsPlazo=null;a.ddlLecapsPlazo=null;a.divLecersPlazo=null;a.ddlLecersPlazo=null;a.divLelinksPlazo=null;a.ddlLelinksPlazo=null;a.divLetesChksMonedas=null;a.lblLetesChkPesos=null;a.chkLetesPesos=null;a.lblLetesChkDolaresMep=null;a.chkLetesDolaresMep=null;a.lblLetesChkDolaresCable=null;a.chkLetesDolaresCable=null;a.divLecapsChksMonedas=null;a.lblLecapsChkPesos=null;a.chkLecapsPesos=null;a.lblLecapsChkDolaresMep=null;a.chkLecapsDolaresMep=null;a.lblLecapsChkDolaresCable=null;a.chkLecapsDolaresCable=null;a.divLecersChksMonedas=null;a.lblLecersChkPesos=null;a.chkLecersPesos=null;a.lblLecersChkDolaresMep=null;a.chkLecersDolaresMep=null;a.lblLecersChkDolaresCable=null;a.chkLecersDolaresCable=null;a.divLelinksChksMonedas=null;a.lblLelinksChkPesos=null;a.chkLelinksPesos=null;a.lblLelinksChkDolaresMep=null;a.chkLelinksDolaresMep=null;a.lblLelinksChkDolaresCable=null;a.chkLelinksDolaresCable=null;a.maxToken=0;a.lastData=null;a.timerId=null;a.timerIdForceRefresh=null;a.loaded=false;a.refresh=false;a.forceRefresh=false;a.window=$(window);a.init=function(b,c){Core.loadPage("cotizaciones_letras.html",function(){document.title="Letras";a.loaded=false;a.refresh=false;a.forceRefresh=false;a.optionsCotizaciones=Core.Functions.Context.Profiles.getPageOptionsByMenu("cotizaciones",Core.Objects.Context.Profiles[c]);a.idDefaultAccount=b;a.idDefaultProfile=c;a.maxToken=0;a.lastData=null;a.setTabs();Core.Functions.grid.Cotizaciones.initGrid(a.divLetes,true,true,false,Core.Objects.Context.Profiles[c].opciones.maxWatchlists,null,null,a.optionsCotizaciones.cot_profundidad,Core.Enums.ePanel.LetrasLetes,b,c);Core.Functions.grid.Cotizaciones.initFilter(a.divLetes,a.txtFilterLetes,a.timeoutLetes,a.window);Core.Functions.grid.Cotizaciones.initGrid(a.divLecaps,true,true,false,Core.Objects.Context.Profiles[c].opciones.maxWatchlists,null,null,a.optionsCotizaciones.cot_profundidad,Core.Enums.ePanel.LetrasLecaps,b,c);Core.Functions.grid.Cotizaciones.initFilter(a.divLecaps,a.txtFilterLecaps,a.timeoutLecaps,a.window);Core.Functions.grid.Cotizaciones.initGrid(a.divLecers,true,true,false,Core.Objects.Context.Profiles[c].opciones.maxWatchlists,null,null,a.optionsCotizaciones.cot_profundidad,Core.Enums.ePanel.LetrasLecers,b,c);Core.Functions.grid.Cotizaciones.initFilter(a.divLecers,a.txtFilterLecers,a.timeoutLecers,a.window);Core.Functions.grid.Cotizaciones.initGrid(a.divLelinks,true,true,false,Core.Objects.Context.Profiles[c].opciones.maxWatchlists,null,null,a.optionsCotizaciones.cot_profundidad,Core.Enums.ePanel.LetrasLelinks,b,c);Core.Functions.grid.Cotizaciones.initFilter(a.divLelinks,a.txtFilterLelinks,a.timeoutLelinks,a.window);a.ddlInstrumentSearch=$(".dropdown-instrument-search");Core.Functions.grid.Cotizaciones.initInstrumentSearch(a.ddlInstrumentSearch,b,c);a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){Core.Functions.grid.Cotizaciones.loadInstrumentSearch(b,a.ddlInstrumentSearch,function(){a.loaded=false;a.refresh=false;a.forceRefresh=false;a.loadTab(a.divLetes,"panel/25",Core.Enums.ePanel.LetrasLetes,a.divLetesPlazo,a.ddlLetesPlazo,a.divLetesChksMonedas,a.chkLetesPesos,a.lblLetesChkPesos,a.chkLetesDolaresMep,a.lblLetesChkDolaresMep,a.chkLetesDolaresCable,a.lblLetesChkDolaresCable)})},"Core.Business.CotizacionesLetras")})};a.setTabs=function(){a.divLetes=$(".div-letes");a.txtFilterLetes=$(".textbox-letes-filter");a.divLecaps=$(".div-lecaps");a.txtFilterLecaps=$(".textbox-lecaps-filter");a.divLecers=$(".div-lecers");a.txtFilterLecers=$(".textbox-lecers-filter");a.divLelinks=$(".div-lelinks");a.txtFilterLelinks=$(".textbox-lelinks-filter");a.btnLetes=$(".btn-letes");a.btnLecaps=$(".btn-lecaps");a.btnLecers=$(".btn-lecers");a.btnLelinks=$(".btn-lelinks");a.divLetesPlazo=$(".div-letes-plazo");a.ddlLetesPlazo=$(".dropdown-letes-plazo");a.divLetesPlazo.hide();a.ddlLetesPlazo.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",events:{select:function(b){a.loadTab(a.divLetes,"panel/25",Core.Enums.ePanel.LetrasLetes,a.divLetesPlazo,a.ddlLetesPlazo,a.divLetesChksMonedas,a.chkLetesPesos,a.lblLetesChkPesos,a.chkLetesDolaresMep,a.lblLetesChkDolaresMep,a.chkLetesDolaresCable,a.lblLetesChkDolaresCable)}},width:150});a.divLecapsPlazo=$(".div-lecaps-plazo");a.ddlLecapsPlazo=$(".dropdown-lecaps-plazo");a.divLecapsPlazo.hide();a.ddlLecapsPlazo.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",events:{select:function(b){a.loadTab(a.divLecaps,"panel/26",Core.Enums.ePanel.LetrasLecaps,a.divLecapsPlazo,a.ddlLecapsPlazo,a.divLecapsChksMonedas,a.chkLecapsPesos,a.lblLecapsChkPesos,a.chkLecapsDolaresMep,a.lblLecapsChkDolaresMep,a.chkLecapsDolaresCable,a.lblLecapsChkDolaresCable)}},width:150});a.divLecersPlazo=$(".div-lecers-plazo");a.ddlLecersPlazo=$(".dropdown-lecers-plazo");a.divLecersPlazo.hide();a.ddlLecersPlazo.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",events:{select:function(b){a.loadTab(a.divLecers,"panel/29",Core.Enums.ePanel.LetrasLecers,a.divLecersPlazo,a.ddlLecersPlazo,a.divLecersChksMonedas,a.chkLecersPesos,a.lblLecersChkPesos,a.chkLecersDolaresMep,a.lblLecersChkDolaresMep,a.chkLecersDolaresCable,a.lblLecersChkDolaresCable)}},width:150});a.divLelinksPlazo=$(".div-lelinks-plazo");a.ddlLelinksPlazo=$(".dropdown-lelinks-plazo");a.divLelinksPlazo.hide();a.ddlLelinksPlazo.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",events:{select:function(b){a.loadTab(a.divLelinks,"panel/32",Core.Enums.ePanel.LetrasLelinks,a.divLelinksPlazo,a.ddlLelinksPlazo,a.divLelinksChksMonedas,a.chkLelinksPesos,a.lblLelinksChkPesos,a.chkLelinksDolaresMep,a.lblLelinksChkDolaresMep,a.chkLelinksDolaresCable,a.lblLelinksChkDolaresCable)}},width:150});a.divLetesChksMonedas=$(".div-chks-letes-monedas");a.divLetesChksMonedas.hide();a.lblLetesChkPesos=$(".lbl-checkbox-letes-pesos");a.chkLetesPesos=$(".checkbox-letes-pesos");a.chkLetesPesos[0].checked=false;a.lblLetesChkDolaresMep=$(".lbl-checkbox-letes-dolares-mep");a.chkLetesDolaresMep=$(".checkbox-letes-dolares-mep");a.chkLetesDolaresMep[0].checked=true;a.lblLetesChkDolaresCable=$(".lbl-checkbox-letes-dolares-cable");a.chkLetesDolaresCable=$(".checkbox-letes-dolares-cable");a.chkLetesDolaresCable[0].checked=false;a.chkLetesPesos.on("change",function(){a.loadTab(a.divLetes,"panel/25",Core.Enums.ePanel.LetrasLetes,a.divLetesPlazo,a.ddlLetesPlazo,a.divLetesChksMonedas,a.chkLetesPesos,a.lblLetesChkPesos,a.chkLetesDolaresMep,a.lblLetesChkDolaresMep,a.chkLetesDolaresCable,a.lblLetesChkDolaresCable)});a.chkLetesDolaresMep.on("change",function(){a.loadTab(a.divLetes,"panel/25",Core.Enums.ePanel.LetrasLetes,a.divLetesPlazo,a.ddlLetesPlazo,a.divLetesChksMonedas,a.chkLetesPesos,a.lblLetesChkPesos,a.chkLetesDolaresMep,a.lblLetesChkDolaresMep,a.chkLetesDolaresCable,a.lblLetesChkDolaresCable)});a.chkLetesDolaresCable.on("change",function(){a.loadTab(a.divLetes,"panel/25",Core.Enums.ePanel.LetrasLetes,a.divLetesPlazo,a.ddlLetesPlazo,a.divLetesChksMonedas,a.chkLetesPesos,a.lblLetesChkPesos,a.chkLetesDolaresMep,a.lblLetesChkDolaresMep,a.chkLetesDolaresCable,a.lblLetesChkDolaresCable)});a.divLecapsChksMonedas=$(".div-chks-lecaps-monedas");a.divLecapsChksMonedas.hide();a.lblLecapsChkPesos=$(".lbl-checkbox-lecaps-pesos");a.chkLecapsPesos=$(".checkbox-lecaps-pesos");a.chkLecapsPesos[0].checked=true;a.lblLecapsChkDolaresMep=$(".lbl-checkbox-lecaps-dolares-mep");a.chkLecapsDolaresMep=$(".checkbox-lecaps-dolares-mep");a.chkLecapsDolaresMep[0].checked=false;a.lblLecapsChkDolaresCable=$(".lbl-checkbox-lecaps-dolares-cable");a.chkLecapsDolaresCable=$(".checkbox-lecaps-dolares-cable");a.chkLecapsDolaresCable[0].checked=false;a.chkLecapsPesos.on("change",function(){a.loadTab(a.divLecaps,"panel/26",Core.Enums.ePanel.LetrasLecaps,a.divLecapsPlazo,a.ddlLecapsPlazo,a.divLecapsChksMonedas,a.chkLecapsPesos,a.lblLecapsChkPesos,a.chkLecapsDolaresMep,a.lblLecapsChkDolaresMep,a.chkLecapsDolaresCable,a.lblLecapsChkDolaresCable)});a.chkLecapsDolaresMep.on("change",function(){a.loadTab(a.divLecaps,"panel/26",Core.Enums.ePanel.LetrasLecaps,a.divLecapsPlazo,a.ddlLecapsPlazo,a.divLecapsChksMonedas,a.chkLecapsPesos,a.lblLecapsChkPesos,a.chkLecapsDolaresMep,a.lblLecapsChkDolaresMep,a.chkLecapsDolaresCable,a.lblLecapsChkDolaresCable)});a.chkLecapsDolaresCable.on("change",function(){a.loadTab(a.divLecaps,"panel/26",Core.Enums.ePanel.LetrasLecaps,a.divLecapsPlazo,a.ddlLecapsPlazo,a.divLecapsChksMonedas,a.chkLecapsPesos,a.lblLecapsChkPesos,a.chkLecapsDolaresMep,a.lblLecapsChkDolaresMep,a.chkLecapsDolaresCable,a.lblLecapsChkDolaresCable)});a.divLecersChksMonedas=$(".div-chks-lecers-monedas");a.divLecersChksMonedas.hide();a.lblLecersChkPesos=$(".lbl-checkbox-lecers-pesos");a.chkLecersPesos=$(".checkbox-lecers-pesos");a.chkLecersPesos[0].checked=true;a.lblLecersChkDolaresMep=$(".lbl-checkbox-lecers-dolares-mep");a.chkLecersDolaresMep=$(".checkbox-lecers-dolares-mep");a.chkLecersDolaresMep[0].checked=false;a.lblLecersChkDolaresCable=$(".lbl-checkbox-lecers-dolares-cable");a.chkLecersDolaresCable=$(".checkbox-lecers-dolares-cable");a.chkLecersDolaresCable[0].checked=false;a.chkLecersPesos.on("change",function(){a.loadTab(a.divLecers,"panel/29",Core.Enums.ePanel.LetrasLecers,a.divLecersPlazo,a.ddlLecersPlazo,a.divLecersChksMonedas,a.chkLecersPesos,a.lblLecersChkPesos,a.chkLecersDolaresMep,a.lblLecersChkDolaresMep,a.chkLecersDolaresCable,a.lblLecersChkDolaresCable)});a.chkLecersDolaresMep.on("change",function(){a.loadTab(a.divLecers,"panel/29",Core.Enums.ePanel.LetrasLecers,a.divLecersPlazo,a.ddlLecersPlazo,a.divLecersChksMonedas,a.chkLecersPesos,a.lblLecersChkPesos,a.chkLecersDolaresMep,a.lblLecersChkDolaresMep,a.chkLecersDolaresCable,a.lblLecersChkDolaresCable)});a.chkLecersDolaresCable.on("change",function(){a.loadTab(a.divLecers,"panel/29",Core.Enums.ePanel.LetrasLecers,a.divLecersPlazo,a.ddlLecersPlazo,a.divLecersChksMonedas,a.chkLecersPesos,a.lblLecersChkPesos,a.chkLecersDolaresMep,a.lblLecersChkDolaresMep,a.chkLecersDolaresCable,a.lblLecersChkDolaresCable)});a.divLelinksChksMonedas=$(".div-chks-lelinks-monedas");a.divLelinksChksMonedas.hide();a.lblLelinksChkPesos=$(".lbl-checkbox-lelinks-pesos");a.chkLelinksPesos=$(".checkbox-lelinks-pesos");a.chkLelinksPesos[0].checked=true;a.lblLelinksChkDolaresMep=$(".lbl-checkbox-lelinks-dolares-mep");a.chkLelinksDolaresMep=$(".checkbox-lelinks-dolares-mep");a.chkLelinksDolaresMep[0].checked=false;a.lblLelinksChkDolaresCable=$(".lbl-checkbox-lelinks-dolares-cable");a.chkLelinksDolaresCable=$(".checkbox-lelinks-dolares-cable");a.chkLelinksDolaresCable[0].checked=false;a.chkLelinksPesos.on("change",function(){a.loadTab(a.divLelinks,"panel/32",Core.Enums.ePanel.LetrasLelinks,a.divLelinksPlazo,a.ddlLelinksPlazo,a.divLelinksChksMonedas,a.chkLelinksPesos,a.lblLelinksChkPesos,a.chkLelinksDolaresMep,a.lblLelinksChkDolaresMep,a.chkLelinksDolaresCable,a.lblLelinksChkDolaresCable)});a.chkLelinksDolaresMep.on("change",function(){a.loadTab(a.divLelinks,"panel/32",Core.Enums.ePanel.LetrasLelinks,a.divLelinksPlazo,a.ddlLelinksPlazo,a.divLelinksChksMonedas,a.chkLelinksPesos,a.lblLelinksChkPesos,a.chkLelinksDolaresMep,a.lblLelinksChkDolaresMep,a.chkLelinksDolaresCable,a.lblLelinksChkDolaresCable)});a.chkLelinksDolaresCable.on("change",function(){a.loadTab(a.divLelinks,"panel/32",Core.Enums.ePanel.LetrasLelinks,a.divLelinksPlazo,a.ddlLelinksPlazo,a.divLelinksChksMonedas,a.chkLelinksPesos,a.lblLelinksChkPesos,a.chkLelinksDolaresMep,a.lblLelinksChkDolaresMep,a.chkLelinksDolaresCable,a.lblLelinksChkDolaresCable)});a.btnLetes.on("shown.bs.tab",function(){a.loaded=false;a.loadTab(a.divLetes,"panel/25",Core.Enums.ePanel.LetrasLetes,a.divLetesPlazo,a.ddlLetesPlazo,a.divLetesChksMonedas,a.chkLetesPesos,a.lblLetesChkPesos,a.chkLetesDolaresMep,a.lblLetesChkDolaresMep,a.chkLetesDolaresCable,a.lblLetesChkDolaresCable)});a.btnLecaps.on("shown.bs.tab",function(){a.loaded=false;a.loadTab(a.divLecaps,"panel/26",Core.Enums.ePanel.LetrasLecaps,a.divLecapsPlazo,a.ddlLecapsPlazo,a.divLecapsChksMonedas,a.chkLecapsPesos,a.lblLecapsChkPesos,a.chkLecapsDolaresMep,a.lblLecapsChkDolaresMep,a.chkLecapsDolaresCable,a.lblLecapsChkDolaresCable)});a.btnLecers.on("shown.bs.tab",function(){a.loaded=false;a.loadTab(a.divLecers,"panel/29",Core.Enums.ePanel.LetrasLecers,a.divLecersPlazo,a.ddlLecersPlazo,a.divLecersChksMonedas,a.chkLecersPesos,a.lblLecersChkPesos,a.chkLecersDolaresMep,a.lblLecersChkDolaresMep,a.chkLecersDolaresCable,a.lblLecersChkDolaresCable)});a.btnLelinks.on("shown.bs.tab",function(){a.loaded=false;a.loadTab(a.divLelinks,"panel/32",Core.Enums.ePanel.LetrasLelinks,a.divLelinksPlazo,a.ddlLelinksPlazo,a.divLelinksChksMonedas,a.chkLelinksPesos,a.lblLelinksChkPesos,a.chkLelinksDolaresMep,a.lblLelinksChkDolaresMep,a.chkLelinksDolaresCable,a.lblLelinksChkDolaresCable)})};a.loadTab=function(e,m,i,h,f,g,d,l,c,k,b,j){Core.Functions.grid.Cotizaciones.details=[];a.maxToken=0;a.lastData=null;a.refresh=false;a.forceRefresh=false;if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:0,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(n){}}window.clearInterval(a.timerId);Core.Objects.Context.Timers.remove(a.timerId);window.clearInterval(a.timerIdForceRefresh);Core.Objects.Context.Timers.remove(a.timerIdForceRefresh);Core.Functions.grid.Cotizaciones.loadGrid(e,null,m,a.lastData,a.maxToken,null,null,function(o,n){return(!a.loaded||(o.plazo==f.swidget().selectedItem().value&&a.filterMoneda(o.mo,g,d,c,b)))},function(q,r){a.lastData=q;a.maxToken=r;if(!a.loaded){var t=[];var s=[];a.lastData.forEach(function(v,u){if(t.indexOf(v.plazo)==-1){t.push(v.plazo)}if(s.indexOf(v.mo)==-1){s.push(v.mo)}});var n=[];t.forEach(function(v,u){n.push({value:v,text:v})});var o=f.swidget().initialOptions;o.dataSource.data=n;f.swidget().refresh(o);f.swidget().selected(t.length-1,true);if(t.length>1){h.show()}g.hide();if(s.length>1){g.show();if(s.indexOf("Pesos")==-1){d.hide();l.hide()}if(s.indexOf("Dolar MEP")==-1){c.hide();k.hide()}if(s.indexOf("Dolar Cable")==-1){b.hide();j.hide()}}a.loaded=true;var p=e.swidget().initialOptions;p.dataSource.data=$.grep(a.lastData,function(v,u){return v.plazo==f.swidget().selectedItem().value&&a.filterMoneda(v.mo,g,d,c,b)});e.swidget().refresh(p)}},a.optionsCotizaciones.cot_profundidad);a.timerId=window.setInterval(function(){if(a.loaded&&(a.refresh||a.forceRefresh)){Core.Functions.grid.Cotizaciones.loadGrid(e,null,m,a.lastData,a.maxToken,null,null,function(o,n){return o.plazo==f.swidget().selectedItem().value&&a.filterMoneda(o.mo,g,d,c,b)},function(n,o){a.lastData=n;a.maxToken=o},a.optionsCotizaciones.cot_profundidad);a.forceRefresh=false}a.refresh=true},Core.Functions.grid.Cotizaciones.REFRESH_TIME);Core.Objects.Context.Timers.push(a.timerId);a.timerIdForceRefresh=window.setInterval(function(){a.forceRefresh=true},600000);Core.Objects.Context.Timers.push(a.timerIdForceRefresh);if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:i,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(o){if(a.loaded){var n={cotizaciones:[]};n.cotizaciones.push(JSON.parse(o.data));Core.Functions.grid.Cotizaciones.refreshGrid(n,e,null,a.lastData,a.maxToken,null,null,function(q,p){return q.plazo==f.swidget().selectedItem().value&&a.filterMoneda(q.mo,g,d,c,b)},function(p,q){a.lastData=p;a.maxToken=q;a.refresh=false},a.optionsCotizaciones.cot_profundidad)}}}};a.filterMoneda=function(f,e,d,c,b){return(f=="Pesos"&&(!e.is(":visible")||(d[0].checked)))||(f=="Dolar MEP"&&(!e.is(":visible")||(c[0].checked)))||(f=="Dolar Cable"&&(!e.is(":visible")||(b[0].checked)))}};Core.Business.Monedas=new function(){var a=this;a.id="cot_monedas";a.idDefaultAccount=null;a.idDefaultProfile=null;a.divMonedas=null;a.txtFilterMonedas=null;a.timeoutMonedas=null;a.maxToken=0;a.lastData=null;a.timerId=null;a.timerIdForceRefresh=null;a.loaded=false;a.refresh=false;a.forceRefresh=false;a.window=$(window);a.init=function(b,c){Core.loadPage("cotizaciones-monedas.html",function(){document.title="Monedas";a.loaded=false;a.refresh=false;a.forceRefresh=false;a.idDefaultAccount=b;a.idDefaultProfile=c;a.maxToken=0;a.lastData=null;a.divMonedas=$(".div-monedas");a.txtFilterMonedas=$(".textbox-monedas-filter");Core.Functions.grid.Cotizaciones.initGrid(a.divMonedas,false,false,false,0,null,null,false,Core.Enums.ePanel.Monedas,b,c);Core.Functions.grid.Cotizaciones.initFilter(a.divMonedas,a.txtFilterMonedas,a.timeoutMonedas,a.window);a.ddlInstrumentSearch=$(".dropdown-instrument-search");Core.Functions.grid.Cotizaciones.initInstrumentSearch(a.ddlInstrumentSearch,b,c);a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){Core.Functions.grid.Cotizaciones.loadInstrumentSearch(b,a.ddlInstrumentSearch,function(){a.loadTab(a.divMonedas,"exterior/20")})},"Core.Business.Monedas")})};a.loadTab=function(b,c){Core.Functions.grid.Cotizaciones.details=[];a.maxToken=0;a.lastData=null;if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:0,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(d){}}window.clearInterval(a.timerId);Core.Objects.Context.Timers.remove(a.timerId);window.clearInterval(a.timerIdForceRefresh);Core.Objects.Context.Timers.remove(a.timerIdForceRefresh);Core.Functions.grid.Cotizaciones.loadGrid(b,null,c,a.lastData,a.maxToken,null,null,function(e,d){return true},function(d,e){a.lastData=d;a.maxToken=e;a.loaded=true;a.refresh=true},false);a.timerId=window.setInterval(function(){if(a.loaded&&(a.refresh||a.forceRefresh)){Core.Functions.grid.Cotizaciones.loadGrid(b,null,c,a.lastData,a.maxToken,null,null,function(e,d){return true},function(d,e){a.lastData=d;a.maxToken=e},false);a.forceRefresh=false}a.refresh=true},Core.Functions.grid.Cotizaciones.REFRESH_TIME);Core.Objects.Context.Timers.push(a.timerId);a.timerIdForceRefresh=window.setInterval(function(){a.forceRefresh=true},600000);Core.Objects.Context.Timers.push(a.timerIdForceRefresh);if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:Core.Enums.ePanel.Monedas,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(e){if(a.loaded){var d={cotizaciones:[]};d.cotizaciones.push(JSON.parse(e.data));Core.Functions.grid.Cotizaciones.refreshGrid(d,b,null,a.lastData,a.maxToken,null,null,function(g,f){return true},function(f,g){a.lastData=f;a.maxToken=g;a.refresh=false},false)}}}}};Core.Business.CotizacionesRealEstate=new function(){var a=this;a.id="cot_realestate";a.idDefaultAccount=null;a.idDefaultProfile=null;a.pageOptions=null;a.divMain=null;a.init=function(b,c){a.idDefaultAccount=b;a.idDefaultProfile=c;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);Core.loadPage("cotizaciones-real-estate.html",function(){document.title="Real Estate";a.divMain=$(".div-cotizaciones-real-estate");a.divCotizaciones=$(".div-cotizaciones");a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadControls()},"Core.Business.CotizacionesRealEstate")})};a.loadControls=function(){var b=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divMain,secureRequest:true,requestUrl:"cotizaciones/panel/"+Core.Enums.ePanel.OferentesExternos,requestType:"GET"});b.onSuccess=function(c){a.divCotizaciones.empty();c.cotizaciones.forEach(function(n,m){var j=$('<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 pad0 mt-2"></div>').appendTo(a.divCotizaciones);var e=$('<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 box-descripcion azul"></div>').appendTo(j);var l=$('<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 pad0"></div>').appendTo(e);$('<div class="col-lg-4 col-md-4 col-sm-12 col-xs-12 text-center"><h4>'+Core.Functions.grid.formatUndefinedString(n.Nombre)+"</h4></div>").appendTo(l);var i=$('<div class="col-lg-4 col-md-4 col-sm-12 col-xs-12"></div>').appendTo(e);$('<img class="img-proyecto" src="'+Core.Functions.grid.formatUndefinedString(n.ImagenURL)+'" />').appendTo(i);var f=$('<div class="col-lg-8 col-md-8 col-sm-12 col-xs-12"></div>').appendTo(e);var h=$('<div  class="col-lg-12"></div>').appendTo(f);$('<div class="col-lg-3 col-md-6 col-sm-6 col-xs-12 space"><p>Rentabilidad Estimada</p><p class="size-text"><strong>'+Core.Functions.grid.formatUndefinedString(n.RentabilidadEstimada)+"</strong></p></div>").appendTo(h);$('<div class="col-lg-3 col-md-6 col-sm-6 col-xs-12 space"><p>Estado</p><p class="size-text"><strong>'+Core.Functions.grid.formatUndefinedString(n.Estado)+"</strong></p></div>").appendTo(h);$('<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12 space"><p>Completado</p><div class="div-icon"><img class="img-icon" src="/images/pie-chart-icon.svg" /></div><p class="size-text"><strong>'+Core.Functions.grid.formatNullNumber(n.Completado)+" %</strong></p></div>").appendTo(h);var k=$('<div  class="col-lg-12"></div>').appendTo(f);$('<div class="col-lg-3 col-md-6 col-sm-6 col-xs-12 space"><p>Moneda del Fondo</p><p class="size-text"><strong>'+Core.Functions.grid.formatUndefinedString(n.Moneda)+"</strong></p></div>").appendTo(k);$('<div class="col-lg-3 col-md-6 col-sm-6 col-xs-12 space"><p>Duración Estimada</p><p class="size-text"><strong>'+Core.Functions.grid.formatUndefinedString(n.Plazo)+"</strong></p></div>").appendTo(k);$('<div class="col-lg-3 col-md-6 col-sm-6 col-xs-12 space"><p>Ubicación</p><div class="div-icon"><i class="fa fa-map-marker label-icon" aria-hidden="true"></i></div><p class="size-text"><a class="btn-ubicacion"><strong>'+Core.Functions.grid.formatUndefinedString(n.Ubicacion)+"</strong></a></p></div>").appendTo(k);k.find(".btn-ubicacion").on("click",function(){window.open("https://www.google.com/maps/place/"+n.Latitud+","+n.Longitud)});var g=$('<div class="col-lg-3 col-md-6 col-sm-6 col-xs-12 space"></div>').appendTo(k);var d=$('<button class="btn btn-success btn-invertir">Detalle</button>').appendTo(g);d.on("click",function(){Core.Business.DetalleRealEstate.init(a.idDefaultAccount,a.idDefaultProfile,{ticker:n.Ticker,operarRealEstate:(a.pageOptions&&a.pageOptions.operarrealestate)})})})};b.request()}};Core.Business.CuentaCorriente=new function(){var a=this;a.id="movimientos";a.divMovimientos=null;a.lblTitle=null;a.txtDateFrom=null;a.txtDateTo=null;a.txtFilter=null;a.chkPorLiquidacion=null;a.timeout=null;a.init=function(b,c){Core.loadPage("cuenta-corriente.html",function(){document.title="Cuenta Corriente";a.divMovimientos=$(".div-cuenta-corriente");a.lblTitle=$(".label-title");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.txtFilter=$(".textbox-filter");a.chkPorLiquidacion=$(".checkbox-por-liquidacion");a.chkPorLiquidacion.change(function(){a.loadGrid()});a.initDatePickers();a.initGrid();a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var d=a.divMovimientos.swidget().dataSource;if(value){d.filter={or:[{path:"tipo",filter:"contains",value:value},{path:"descripcion",filter:"contains",value:value},{path:"ticker",filter:"contains",value:value},{path:"cantidad",filter:"contains",value:value}]}}else{d.filter=null}d.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.CuentaCorriente.txtFilter");a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,b,c,a.loadGrid,"Core.Business.CuentaCorriente")})};a.initDatePickers=function(){var b=new Date();b.setDate(b.getDate()-31);a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:b,max:new Date(),events:{change:function(c){a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loadGrid()}}})};a.initGrid=function(){a.divMovimientos.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Cuenta Corriente",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["fecha","descripcion","cantidad","moneda","importe","saldo"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Cuenta Corriente"}}},selection:false,rowHover:false,paging:{pageSize:30,pageLinksCount:10},grouping:{showGroupHeader:true,allowDragToGroup:false,message:"Arrastre un encabezado de columna para agrupar por esa columna"},columns:[{field:"fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"15%",headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"descripcion",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"40%",headerAttributes:Core.Functions.grid.getCellOddClass()},{field:"cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"15%",headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"importe",title:"Importe",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"15%",headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNumber},{field:"saldo",title:"Saldo",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"15%",headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNumber}]})};a.loadGrid=function(){a.lblTitle.text("Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var b;b="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));b+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));b+="&Liquidacion="+(a.chkPorLiquidacion.get(0).checked?"1":"0");var c=new Core.Ajax.ServerRequest({overlayElement:a.divMovimientos.parent(),secureRequest:true,requestUrl:"cuentascorrientes/"+encodeURIComponent(a.header.selectedIdAccount),requestType:"GET",requestData:b});c.onSuccess=function(d){var e=a.divMovimientos.swidget().initialOptions;e.dataSource.data=d;e.dataSource.schema={data:"ctacorriente"};e.dataSource.group=[{field:"moneda",order:"asc"}];e.exportOptions.excel.dataSource.data=d;e.exportOptions.excel.dataSource.schema={data:"ctacorriente"};e.exportOptions.excel.readDataSource=true;a.divMovimientos.swidget().refresh(e);a.txtFilter.keydown()};c.request()}};Core.Business.CuponesDividendos=new function(){var a=this;a.id="homeCuponesDividendos";a.divCuponesDividendos=null;a.lblTitle=null;a.txtDateFrom=null;a.txtDateTo=null;a.btnRefresh=null;a.txtFilter=null;a.chkCuentasPropias=null;a.pageOptions=null;a.timeout=null;a.init=function(b,c){Core.loadPage("cupones-dividendos.html",function(){document.title="Cupones y Dividendos";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divCuponesDividendos=$(".div-cupones-dividendos");a.lblTitle=$(".label-title");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.txtFilter=$(".textbox-filter");a.btnRefresh=$(".btn-refresh");a.btnRefresh.on("click",function(){a.loadGrid()});a.chkCuentasPropias=$(".checkbox-cuentas-propias");a.chkCuentasPropias[0].checked=true;a.chkCuentasPropias.on("change",function(){a.loadGrid()});a.initDatePickers();a.initGrid();a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var d=a.divCuponesDividendos.swidget().dataSource;if(value){d.filter={or:[{path:"Comitente",filter:"contains",value:value},{path:"Cuenta",filter:"contains",value:value},{path:"Tipo",filter:"contains",value:value},{path:"Descripcion",filter:"contains",value:value},{path:"Moneda",filter:"contains",value:value}]}}else{d.filter=null}d.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.CuponesDividendos.txtFilter");a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.CuponesDividendos")})};a.initDatePickers=function(){var b=new Date();b.setDate(b.getDate()-1);a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:b,max:new Date(),events:{change:function(c){a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loadGrid()}}})};a.initGrid=function(){var b=[];b.push({field:"FechaConcertacion",title:"Concertación",width:"8%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Comitente",title:"Comitente",width:"8%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Cuenta",title:"Cuenta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"26%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),title:"Tipo",width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Descripcion",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"26%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNuleablePrice});b.push({field:"Moneda",title:"Moneda",width:"8%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"TipoCambio",title:"Tipo Cambio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNuleablePrice});a.divCuponesDividendos.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],paging:{pageSize:100,pageLinksCount:10},exportOptions:{excel:{fileName:"CuponesYDividendos",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["FechaConcertacion","Comitente","Cuenta","Tipo","Descripcion","Cantidad","Moneda","TipoCambio","Asesor","Equipo","UnidadDeNegocio","idPersonaAsesor","Referidor","idCuenta"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Cupones y Dividendos"}}},selection:false,rowHover:false,sorting:{multiple:true},columns:b})};a.loadGrid=function(){a.lblTitle.text("Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var b;b="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));b+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));b+=("&propias="+((a.chkCuentasPropias[0].checked)?"1":"0"));var c=new Core.Ajax.ServerRequest({overlayElement:a.divCuponesDividendos.parent(),secureRequest:true,requestUrl:"reporte/cuponesdividendos",requestType:"GET",requestData:b});c.onSuccess=function(d){var e=a.divCuponesDividendos.swidget().initialOptions;e.dataSource.data=d;e.dataSource.schema={data:"cuponesdividendos"};e.exportOptions.excel.dataSource.data=d;e.exportOptions.excel.dataSource.schema={data:"cuponesdividendos"};e.exportOptions.excel.readDataSource=true;a.divCuponesDividendos.swidget().refresh(e);a.txtFilter.keydown()};c.request()}};Core.Business.DashboardAsesores=new function(){var a=this;a.id="homeAsesoresDashboard";a.divMain=null;a.init=function(b,c){Core.loadPage("dashboard-asesores.html",function(){document.title="Dashboard Asesores";$(".footer").hide();a.divMain=$(".div-main");a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){var d=$("<balanz-dash-asesor></balanz-dash-asesor>").appendTo(a.divMain);d.attr("token",Core.Objects.Context.Token);d.attr("idpersona",Core.Objects.Context.IdPersona)},"Core.Business.DashboardAsesores")})}};Core.Business.DescargarReportes=new function(){var a=this;a.init=function(b,c){Core.Business.BaseProcesosDinamicos.init(b,c,{id:"homeReportes",namespace:"Core.Business.DescargarReportes"})}};Core.Business.EjecutarProcesos=new function(){var a=this;a.init=function(b,c){Core.Business.BaseProcesosDinamicos.init(b,c,{id:"homeEjecutarProcesos",namespace:"Core.Business.EjecutarProcesos"})}};Core.Business.ReportesPowerBI=new function(){var a=this;a.init=function(b,c){Core.Business.BaseProcesosDinamicos.init(b,c,{id:"homePowerBI",namespace:"Core.Business.ReportesPowerBI"})}};Core.Business.BaseProcesosDinamicos=new function(){var a=this;a.id="";a.namespace="";a.init=function(b,c,d){Core.loadPage("descargar-reportes.html",function(){a.id=d.id;a.namespace=d.namespace;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);document.title=a.getTitle();a.lblTitle=$(".page-title");a.lblTitle.text(document.title);a.divMain=$(".div-main");a.ddlReport=$(".dropdown-reporte");a.btnDownload=$(".btn-descargar");a.btnDownload.hide();a.btnExecute=$(".btn-ejecutar");a.btnExecute.hide();a.divParameters=$(".div-parametros");a.divParameters.hide();a.divReportParameters=$(".div-parametros-reporte");a.divReportParameters.empty();a.reportParameters=null;a.divIframe=$(".div-iframe");a.divIframe.hide();a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadReports,a.namespace)})};a.initControls=function(){a.ddlReport.shieldComboBox({dataSource:{data:[]},valueTemplate:"{IdReporte}",textTemplate:"{Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""}]}},value:"",events:{select:function(b){a.loadParameters()}}});a.btnDownload.on("click",function(){var d=a.getRequestData();if(!d){return}function e(m){var l=new Blob([m.response],{type:m.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(l);return}var f=window.URL.createObjectURL(l);var k=document.createElement("a");k.href=f;var h=m.getResponseHeader("Content-Disposition").split("; ");var g="filename=file.DAT";for(var j=0;j<h.length;j++){if(h[j].indexOf("filename")>=0){g=h[j]}}k.download=g.split("=")[1];k.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(f)}var b=new Core.Controls.Overlay(a.divMain,{});var c=new XMLHttpRequest();c.open("POST",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"download/reportes/descargar"+Core.Functions.Context.getPathname()+a.ddlReport.swidget().selectedItem().IdReporte,true);c.responseType="blob";c.setRequestHeader("Authorization",Core.Objects.Context.Token);c.setRequestHeader("Accept","application/json");c.setRequestHeader("Content-Type","application/json");c.onload=function(f){if(c.status==200){e(c)}else{var g=new FileReader();g.onloadend=function(i){var h=((i&&i.srcElement&&i.srcElement.result)?JSON.parse(i.srcElement.result):{});var j=new Core.Controls.Dialog("Mensaje",((h&&h.Descripcion)?h.Descripcion:"No se ha podido realizar la descarga del archivo."),{displayButtons:{close:true,accept:false}});j.show()};g.readAsText(c.response)}b.destroy()};c.send(JSON.stringify(d))});if(a.id=="homeReportes"){a.btnDownload.show()}a.btnExecute.on("click",function(){var b=a.getRequestData();if(!b){return}var c=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.btnExecute,secureRequest:true,requestUrl:"download/reportes/ejecutar"+Core.Functions.Context.getPathname()+a.ddlReport.swidget().selectedItem().IdReporte,requestType:"POST",requestData:b});c.onSuccess=function(d){if(d&&d.idProceso){new Core.Controls.ProcessProgress({idProcess:d.idProceso,overlayElement:a.divMain}).show()}else{new Core.Controls.Dialog("Aviso",((d&&d.Mensaje)?d.Mensaje:"Se ejecución se ha realizado exitosamente."),{displayButtons:{close:true,accept:false}}).show()}};c.request()});if(a.id=="homeEjecutarProcesos"){a.btnExecute.show()}};a.loadReports=function(){var b=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"reportes/obtenerReportes",requestType:"GET",requestData:{Pantalla:a.id}});b.onSuccess=function(d){var c=a.ddlReport.swidget().initialOptions;c.dataSource.data=(d.reportes?d.reportes:[]);a.ddlReport.swidget().refresh(c);a.loadParameters()};b.request()};a.loadParameters=function(){a.divParameters.hide();a.divReportParameters.empty();a.reportParameters=null;a.divIframe.hide();if(a.ddlReport.swidget().selectedItem()){if(a.ddlReport.swidget().selectedItem().HTML){a.divIframe.html(a.ddlReport.swidget().selectedItem().HTML);a.divIframe.show()}else{if(a.ddlReport.swidget().selectedItem().IdReporte){var b=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"reportes/obtenerParametros/"+a.ddlReport.swidget().selectedItem().IdReporte,requestType:"GET"});b.onSuccess=function(c){a.reportParameters=c.parametros?c.parametros:[];a.reportParameters.forEach(function(e,d){a.createParameter(e)});a.divParameters.show()};b.request()}}}};a.createParameter=function(g){var b=$('<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 row"></div>').appendTo(a.divReportParameters);var e=$('<div class="col-lg-3 col-md-3 col-sm-6 col-xs-6"></div>').appendTo(b);var f=$("<p>"+g.DescripcionCampo+"</p>").appendTo(e);var d=$('<div class="control-group form-group"></div>').appendTo(e);var c=$('<div class="controls"></div>').appendTo(d);if(g.TipoDato=="DATE"){g.txtControl=$('<div class="form-control lila"></div>').appendTo(c);g.txtControl.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date()})}if(g.TipoDato=="TEXT"){g.txtControl=$('<input type="text" />').appendTo(c);g.txtControl.shieldTextBox({value:""})}if(g.TipoDato=="INTEGER"||g.TipoDato=="NUMERIC"){g.txtControl=$('<input type="text" class="form-control" />').appendTo(c);new Core.Controls.DecimalPicker(g.txtControl,{maxDecimalDigitCount:(g.TipoDato=="INTEGER"?0:10),showThousandsSeparator:"",defaultValue:""})}if(g.TipoDato=="BOOLEAN"){g.chkControl=$('<input type="checkbox" />').appendTo(c);g.chkControl.shieldCheckBox({label:g.DescripcionCampo});f.hide()}};a.getRequestData=function(){if(a.reportParameters&&a.ddlReport.swidget().selectedItem()){var c={value:true};var b={Parametros:{}};a.reportParameters.forEach(function(e,d){if(e.TipoDato=="DATE"){b.Parametros[e.NombreCampo]=Core.Functions.Date.getDisplayDateWithSeparator(Core.Functions.Validations.getValidatedSwidgetValue(e.txtControl,c),"-")}if(e.TipoDato=="TEXT"){b.Parametros[e.NombreCampo]=Core.Functions.Validations.getValidatedSwidgetValue(e.txtControl,c)}if(e.TipoDato=="INTEGER"||e.TipoDato=="NUMERIC"){b.Parametros[e.NombreCampo]=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedPositiveNumericInputValue(e.txtControl,c))}if(e.TipoDato=="BOOLEAN"){b.Parametros[e.NombreCampo]=(e.chkControl.swidget().checked()?1:0)}});if(!c.value){return null}else{return b}}else{return null}};a.getTitle=function(){if(a.id=="homeReportes"){return"Descargar Reportes"}else{if(a.id=="homeEjecutarProcesos"){return"Ejecutar Procesos"}else{return"Reportes Power BI"}}}};Core.Business.DetalleInstrumento=new function(){var a=this;var b=60000;a.id="detalle_instrumento";a.window=$(window);a.init=function(c,d,e){Core.loadPage("detalle-instrumento.html",function(){a.idDefaultAccount=c;a.idDefaultProfile=d;a.ticker=null;a.tickerHistorico=null;a.idPlazo=null;a.plazo=null;a.fondo=null;$.extend(true,a,e);document.title="Detalle";a.lblSearch=$(".lbl-title-search");a.ddlSearch=$(".dropdown-search");a.divDetalleInstrumento=$(".div-detalle-instrumento");a.divDetalleFondo=$(".div-detalle-fondo");a.divBuscadorInfo=$(".div-buscador-info");a.divAlertaTipoPrecio=$(".div-alert-price-type");a.firstEntry=true;a.loaded=false;a.executeCotizacionInstrumento=false;a.panel=null;a.securityID=null;a.lastDataCotizacionInstrumento=null;a.divLogoInstrumento=$(".box-logo-instrumento");a.divLogoInstrumento.hide();a.imgLogoInstrumento=$(".logo-instrumento");a.divIndicadorMercadoContenedor=$(".indicador-mercado-contenedor");a.divIndicadorMercado=$(".indicador-mercado");a.lblIndicadorMercado=$(".indicador-mercado-descripcion");a.lblTitleInstrumento=$(".lbl-title-instrumento");a.lblInstrumento=$(".lbl-instrumento");a.lblUltimoOperado=$(".lbl-ultimo-operado");a.lblVariacion=$(".lbl-variacion");a.divRatioIsin=$(".div-ratio-isin");a.divRatio=$(".detalle-ratio");a.lblRatio=$(".lbl-ratio");a.divIsin=$(".detalle-isin");a.lblIsin=$(".lbl-isin");a.lblFechaUtimaOperacion=$(".lbl-fecha-ultima-operacion");a.lblPrecioApertura=$(".lbl-precio-apertura");a.lblPrecioMaximo=$(".lbl-precio-maximo");a.lblVolumen=$(".lbl-volumen");a.lblPrecioCierreAnterior=$(".lbl-precio-cierre-anterior");a.lblPrecioMinimo=$(".lbl-precio-minimo");a.lblPrecioVenta=$(".lbl-precio-venta");a.lblPrecioCompra=$(".lbl-precio-compra");a.imgCambioPrecioDiario=$(".img-cambio-precio-diario");a.lblCambioPrecioDiario=$(".lbl-cambio-precio-diario");a.imgCambioPrecioSemanal=$(".img-cambio-precio-semanal");a.lblCambioPrecioSemanal=$(".lbl-cambio-precio-semanal");a.imgCambioPrecioMensual=$(".img-cambio-precio-mensual");a.lblCambioPrecioMensual=$(".lbl-cambio-precio-mensual");a.imgCambioPrecioAnual=$(".img-cambio-precio-anual");a.lblCambioPrecioAnual=$(".lbl-cambio-precio-anual");a.btnHistorico=$(".btn-historico");a.divGraficos=$(".div-graficos");a.btnIntradiario=$(".btn-intradiario");a.btnOperacionesDiarias=$(".btn-operaciones-diarias");a.divContainerIntradiario=$(".div-balanz-intradiario");a.chartIntradiario=null;a.divHistorico=$(".div-historico");a.chartHistorico=null;a.gridOperaciones=$(".div-grid-operaciones");a.divCompraVenta=$(".div-compra-venta");a.divCompraVenta.show();a.divCompraVentaProfundidad=$(".div-compra-venta-profundidad");a.divCompraVentaProfundidad.hide();a.btnComprarInstrumento=$(".btn-comprar-instrumento");a.btnVenderInstrumento=$(".btn-vender-instrumento");a.lblProfundidad1=$(".lbl-profundidad-1");a.lblProfundidad2=$(".lbl-profundidad-2");a.lblProfundidad3=$(".lbl-profundidad-3");a.lblProfundidad4=$(".lbl-profundidad-4");a.lblProfundidad5=$(".lbl-profundidad-5");a.lblProfundidad1CompraCantidad=$(".lbl-profundidad-1-compra-cantidad");a.lblProfundidad2CompraCantidad=$(".lbl-profundidad-2-compra-cantidad");a.lblProfundidad3CompraCantidad=$(".lbl-profundidad-3-compra-cantidad");a.lblProfundidad4CompraCantidad=$(".lbl-profundidad-4-compra-cantidad");a.lblProfundidad5CompraCantidad=$(".lbl-profundidad-5-compra-cantidad");a.lblProfundidad1VentaCantidad=$(".lbl-profundidad-1-venta-cantidad");a.lblProfundidad2VentaCantidad=$(".lbl-profundidad-2-venta-cantidad");a.lblProfundidad3VentaCantidad=$(".lbl-profundidad-3-venta-cantidad");a.lblProfundidad4VentaCantidad=$(".lbl-profundidad-4-venta-cantidad");a.lblProfundidad5VentaCantidad=$(".lbl-profundidad-5-venta-cantidad");a.lblProfundidad1CompraPrecio=$(".lbl-profundidad-1-compra-precio");a.lblProfundidad2CompraPrecio=$(".lbl-profundidad-2-compra-precio");a.lblProfundidad3CompraPrecio=$(".lbl-profundidad-3-compra-precio");a.lblProfundidad4CompraPrecio=$(".lbl-profundidad-4-compra-precio");a.lblProfundidad5CompraPrecio=$(".lbl-profundidad-5-compra-precio");a.lblProfundidad1VentaPrecio=$(".lbl-profundidad-1-venta-precio");a.lblProfundidad2VentaPrecio=$(".lbl-profundidad-2-venta-precio");a.lblProfundidad3VentaPrecio=$(".lbl-profundidad-3-venta-precio");a.lblProfundidad4VentaPrecio=$(".lbl-profundidad-4-venta-precio");a.lblProfundidad5VentaPrecio=$(".lbl-profundidad-5-venta-precio");a.divPlazos=$(".div-plazos");a.btnAlertPrice=$(".btn-alert-price");a.btnWatchlist=$(".btn-watchlist");a.lblFondo=$(".lbl-fondo");a.lblFechaUltimaCotizacionFondo=$(".lbl-fecha-ultima-cotizacion-fondo");a.lblCuotaparteFondo=$(".lbl-cuotaparte-fondo");a.lblVariacionFondo=$(".lbl-variacion-fondo");a.lblClaseFondo=$(".lbl-clase-fondo");a.lblPlazoRescateFondo=$(".lbl-plazo-rescate-fondo");a.lblFechaInicioFondo=$(".lbl-fecha-inicio-fondo");a.lblMonedaFondo=$(".lbl-moneda-fondo");a.lblCalificacionFondo=$(".lbl-calificacion-fondo");a.btnRescatarFondo=$(".btn-rescatar-fondo");a.btnSuscribirFondo=$(".btn-suscribir-fondo");a.btnCambiarFondo=$(".btn-cambiar-fondo");a.imgCambioPrecioDiarioFondo=$(".img-cambio-precio-diario-fondo");a.lblCambioPrecioDiarioFondo=$(".lbl-cambio-precio-diario-fondo");a.imgCambioPrecioSemanalFondo=$(".img-cambio-precio-semanal-fondo");a.lblCambioPrecioSemanalFondo=$(".lbl-cambio-precio-semanal-fondo");a.imgCambioPrecioMensualFondo=$(".img-cambio-precio-mensual-fondo");a.lblCambioPrecioMensualFondo=$(".lbl-cambio-precio-mensual-fondo");a.imgCambioPrecioAnualFondo=$(".img-cambio-precio-anual-fondo");a.lblCambioPrecioAnualFondo=$(".lbl-cambio-precio-anual-fondo");a.divChartHistoricoFondo=$(".div-chart-historico-fondo");var g=Core.Objects.Context.Profiles[a.idDefaultProfile];a.maxWatchlists=((g&&g.opciones&&g.opciones.maxWatchlists)?g.opciones.maxWatchlists:0);a.initControls();a.initControlsInstrumento();a.initControlsFondo();if(!Core.Objects.Context.Watchlists){var h=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"watchlists",requestType:"GET"});h.onSuccess=function(i){Core.Objects.Context.Watchlists=i.watchlists;if(!Core.Functions.Validations.isBlockedStorage()&&Core.Functions.Persistence.getStorage()){Core.Functions.Persistence.getStorage().setItem("CoreContext",LZString.compressToUTF16(JSON.stringify(Core.Objects.Context)))}};h.request()}var f=window.setInterval(function(){if(Core.Objects.Context.Watchlists){window.clearInterval(f);a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,a.idDefaultAccount,a.idDefaultProfile,function(){a.pagePath=Core.Functions.Context.Profiles.getPagePathByNamespace("Core.Business.DetalleInstrumento",Core.Objects.Context.Profiles[a.idDefaultProfile]);Core.Functions.grid.Cotizaciones.loadInstrumentSearch(a.header.selectedIdAccount,a.ddlSearch,function(){a.divBuscadorInfo.show();a.divAlertaTipoPrecio.hide();a.divDetalleInstrumento.hide();a.divDetalleFondo.hide();a.lblSearch.hide();var i=a.ddlSearch.swidget().initialOptions;i.value=((a.ticker)?a.ticker:((a.fondo)?a.fondo:""));a.ddlSearch.swidget().refresh(i);a.search()})},"Core.Business.DetalleInstrumento",e)}},50)})};a.initControls=function(){Core.Functions.grid.Cotizaciones.initInstrumentSearch(a.ddlSearch,a.idDefaultAccount,a.idDefaultProfile);var c=a.ddlSearch.swidget().initialOptions;c.value=a.defaultEspecie;c.events.select=function(d){a.stopRefresh();a.idPlazo=null;if(d.index>=0){var f={};var g="";if(a.ddlSearch.swidget().selectedItem()){if(a.ddlSearch.swidget().selectedItem().panel==Core.Enums.ePanel.Fondos){g="?fondo="+a.ddlSearch.swidget().selectedItem().DisplayTicker;f.fondo=a.ddlSearch.swidget().selectedItem().DisplayTicker}else{if(a.ddlSearch.swidget().selectedItem().panel!=Core.Enums.ePanel.OferentesExternos&&a.ddlSearch.swidget().selectedItem().panel!=Core.Enums.ePanel.Packs){g="?ticker="+a.ddlSearch.swidget().selectedItem().DisplayTicker;f.ticker=a.ddlSearch.swidget().selectedItem().DisplayTicker}}}history.pushState({namespace:"Core.Business.DetalleInstrumento",namespaceParameters:f},"",(Core.Functions.Context.getPathname()+a.pagePath+g).replaceAll("//","/"));a.search()}else{a.divBuscadorInfo.show();a.divAlertaTipoPrecio.hide();a.divDetalleInstrumento.hide();a.divDetalleFondo.hide();a.lblSearch.hide();a.lblTitleInstrumento.text("Buscador de Instrumentos")}};a.ddlSearch.swidget().refresh(c)};a.setCambioPrecio=function(f,g,e,d){d.removeClass("arrow-green");d.removeClass("arrow-red");e.removeClass("green");e.removeClass("red");if(!f||!g){e.text("-");d.attr("src","")}else{var c=f-g;if(c>0){e.text(Core.Functions.grid.formatNumber(parseFloat(c.toFixed(2)))+" ("+Core.Functions.grid.formatNumber(parseFloat((c/g*100).toFixed(2)))+" %)");e.addClass("green");d.addClass("arrow-green");d.attr("src","/images/arrow-up.svg")}else{if(c==0){e.text("0.00 (0.00 %)");d.attr("src","")}else{if(c<0){e.text(Core.Functions.grid.formatNumber(parseFloat(c.toFixed(2)))+" ("+Core.Functions.grid.formatNumber(parseFloat((c/g*100).toFixed(2)))+" %)");e.addClass("red");d.addClass("arrow-red");d.attr("src","/images/arrow-down.svg")}}}}};a.search=function(){a.stopRefresh();if(a.ddlSearch.swidget().selectedItem()||(a.firstEntry&&(a.fondo||a.ticker))){a.divBuscadorInfo.hide();a.divAlertaTipoPrecio.hide();a.lblSearch.show();if((a.ddlSearch.swidget().selectedItem()&&a.ddlSearch.swidget().selectedItem().panel==Core.Enums.ePanel.Fondos)||(a.firstEntry&&a.fondo)){a.ticker=null;a.fondo=((a.ddlSearch.swidget().selectedItem())?a.ddlSearch.swidget().selectedItem().DisplayTicker:a.fondo);a.getInitialDataFondo()}else{if(a.ddlSearch.swidget().selectedItem()&&a.ddlSearch.swidget().selectedItem().panel==Core.Enums.ePanel.OferentesExternos){Core.Business.DetalleRealEstate.init(a.header.selectedIdAccount,a.idDefaultProfile,{ticker:a.ddlSearch.swidget().selectedItem().Ticker})}else{if(a.ddlSearch.swidget().selectedItem()&&a.ddlSearch.swidget().selectedItem().panel==Core.Enums.ePanel.Packs){Core.Business.DetallePack.init(a.header.selectedIdAccount,a.idDefaultProfile,{ticker:a.ddlSearch.swidget().selectedItem().Ticker})}else{a.ticker=((a.ddlSearch.swidget().selectedItem())?a.ddlSearch.swidget().selectedItem().DisplayTicker:a.ticker);a.fondo=null;a.getInitialDataInstrumento()}}}}a.firstEntry=false};a.initControlsInstrumento=function(){a.btnAlertPrice.on("click",function(){var c={securityId:a.securityID,ticker:a.ticker,plazo:{id:a.idPlazo,description:a.plazo}};c.descripcion=a.lastDataCotizacionInstrumento.Cotizacion.Descripcion;c.precio=a.lastDataCotizacionInstrumento.Cotizacion.UltimoPrecio;var d=a.getVariation(a.lastDataCotizacionInstrumento);c.variacion=d==null?0:d;new Core.Controls.ManagerAlertaPrecio({overlayElement:document.body,cotizacion:c,}).show()});a.btnHistorico.on("click",function(){a.divHistorico.empty();a.chartHistorico=$('<balanz-trading-chart id="chartHistorico"></balanz-trading-chart>').appendTo(a.divHistorico);$("#chartHistorico").attr("token",Core.Objects.Context.Token);$("#chartHistorico").attr("nivel",Core.Objects.Context.Profiles[0].opciones.nivelUsuario);$("#chartHistorico").attr("debug",Core.Debug?true:false);$("#chartHistorico").attr("symbol",a.tickerHistorico?a.tickerHistorico:a.ticker);$("#chartHistorico").attr("plazo",a.idPlazo);$("#chartHistorico").attr("autosize",true);$("#chartHistorico").attr("interval","D");$("#chartHistorico").attr("urlprefix",Core.Functions.Context.getPathname());$("#chartHistorico").attr("clientid",window.location.hostname);$("#chartHistorico").attr("userid",Core.Objects.Context.IdPersona)});a.btnIntradiario.on("click",function(){a.divContainerIntradiario.empty();a.chartIntradiario=$('<balanz-trading-chart id="chartIntradiario"></balanz-trading-chart>').appendTo(a.divContainerIntradiario);$("#chartIntradiario").attr("token",Core.Objects.Context.Token);$("#chartIntradiario").attr("nivel",Core.Objects.Context.Profiles[0].opciones.nivelUsuario);$("#chartIntradiario").attr("debug",Core.Debug?true:false);$("#chartIntradiario").attr("symbol",a.ticker);$("#chartIntradiario").attr("plazo",a.idPlazo);$("#chartIntradiario").attr("autosize",true);$("#chartIntradiario").attr("interval","1");$("#chartIntradiario").attr("urlprefix",Core.Functions.Context.getPathname());$("#chartIntradiario").attr("clientid",window.location.hostname);$("#chartIntradiario").attr("userid",Core.Objects.Context.IdPersona)});a.gridOperaciones.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:15,pageLinksCount:3},columns:[]});a.btnOperacionesDiarias.on("click",function(){a.loadCotizacionIntradiario()});a.btnComprarInstrumento.on("click",function(){var c={};var d=Core.Enums.eEspeciesTipoOperacion.Compra;if(a.panel==Core.Enums.ePanel.Cauciones){d=Core.Enums.eEspeciesTipoOperacion.CaucionTomadora}c.defaultTipoOperacion=d;c.defaultEspecie=(a.panel==Core.Enums.ePanel.Cauciones)?a.securityID:a.ticker;if(a.lastDataCotizacionInstrumento.Cotizacion.PrecioVenta){c.defaultValorLimite=a.lastDataCotizacionInstrumento.Cotizacion.PrecioVenta}if(a.idPlazo!=null){c.defaultPlazo=a.idPlazo}a.callOperar(c)});a.btnVenderInstrumento.on("click",function(){var c={};var d=Core.Enums.eEspeciesTipoOperacion.Venta;if(a.panel==Core.Enums.ePanel.Cauciones){d=Core.Enums.eEspeciesTipoOperacion.CaucionColocadora}c.defaultTipoOperacion=d;c.defaultEspecie=(a.panel==Core.Enums.ePanel.Cauciones)?a.securityID:a.ticker;if(a.lastDataCotizacionInstrumento.Cotizacion.PrecioCompra){c.defaultValorLimite=a.lastDataCotizacionInstrumento.Cotizacion.PrecioCompra}if(a.idPlazo!=null){c.defaultPlazo=a.idPlazo}a.callOperar(c)})};a.getInitialDataInstrumento=function(){a.divDetalleInstrumento.show();a.divDetalleFondo.hide();var c={};c.ticker=a.ticker;if(a.idPlazo!=null){c.plazo=a.idPlazo}var d=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"cotizacioninstrumento",requestType:"GET",requestData:c});d.onSuccess=function(e){a.panel=e.Cotizacion.panel;a.securityID=e.Cotizacion.SecurityID;a.idPlazo=e.Cotizacion.plazoHistorico;a.plazo=e.Cotizacion.plazo;a.tickerHistorico=e.Cotizacion.TickerHistorico;Core.Functions.grid.Cotizaciones.setAlertPriceType(a.divAlertaTipoPrecio,e.Cotizacion.TextoAlerta,e.Cotizacion.TipoAlerta,a.header.selectedIdAccount,a.idDefaultProfile);a.loadCotizacionInstrumento(e);a.divPlazos.empty();if(e.Cotizacion.ListaPlazos){Core.Functions.Plazo.getPlazos(e.Cotizacion.ListaPlazos).forEach(function(h,g){var f=$('<button type="button" class="btn btn-default btn-plazo">'+h.text+"</button>").appendTo(a.divPlazos);if(h.value==a.idPlazo){f.addClass("active")}f.on("click",function(){a.idPlazo=h.value;a.stopRefresh();a.getInitialDataInstrumento()})})}Core.Functions.Watchlists.initMenu(a.btnWatchlist,a,a.maxWatchlists,document.body);a.btnAlertPrice.parent().hide();if(a.panel!=Core.Enums.ePanel.DolarBolsa&&a.panel!=Core.Enums.ePanel.Monedas&&Core.Functions.Context.Profiles.existPageInMenu("alertasPrecios",Core.Objects.Context.Profiles[a.idDefaultProfile])&&!e.Cotizacion.Demora){a.btnAlertPrice.parent().show()}a.btnWatchlist.parent().hide();if(a.panel!=Core.Enums.ePanel.DolarBolsa&&a.panel!=Core.Enums.ePanel.Monedas&&Core.Functions.Context.Profiles.existPageInMenu("watchlists",Core.Objects.Context.Profiles[a.idDefaultProfile])&&!e.Cotizacion.Demora){a.btnWatchlist.parent().show()}a.btnHistorico.click();a.timerIdCotizacionInstrumento=window.setInterval(function(){if(a.loaded&&a.executeCotizacionInstrumento&&a.ticker){var f={};f.ticker=a.ticker;if(a.idPlazo!=null){f.plazo=a.idPlazo}var g=new Core.Ajax.ServerRequest({showOverlay:false,secureRequest:true,requestUrl:"cotizacioninstrumento",requestType:"GET",requestData:f});g.onSuccess=function(h){a.loadCotizacionInstrumento(h)};g.request()}a.executeCotizacionInstrumento=true},b);Core.Objects.Context.Timers.push(a.timerIdCotizacionInstrumento);if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:a.panel,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(g){if(a.loaded){var f=JSON.parse(g.data);if(f.SecurityID==a.securityID&&a.lastDataCotizacionInstrumento){a.loadCotizacionInstrumento(a.processWebSocketData(f));a.executeCotizacionInstrumento=false}}}}a.loaded=true};d.request()};a.processWebSocketData=function(d){var g={Cotizacion:{},Profundidad:[],CambiosPrecios:{}};g.Cotizacion.Descripcion=a.lastDataCotizacionInstrumento.Cotizacion.Descripcion;g.Cotizacion.SimboloMoneda=a.lastDataCotizacionInstrumento.Cotizacion.SimboloMoneda;g.Cotizacion.plazo=a.lastDataCotizacionInstrumento.Cotizacion.plazo;g.Cotizacion.idWatchlist=a.lastDataCotizacionInstrumento.Cotizacion.idWatchlist;g.Cotizacion.verProfundidad=a.lastDataCotizacionInstrumento.Cotizacion.verProfundidad;g.Cotizacion.Ratio=a.lastDataCotizacionInstrumento.Cotizacion.Ratio;g.Cotizacion.ISIN=a.lastDataCotizacionInstrumento.Cotizacion.ISIN;g.Cotizacion.StatusColor=a.lastDataCotizacionInstrumento.Cotizacion.StatusColor;g.Cotizacion.LogoLink=a.lastDataCotizacionInstrumento.Cotizacion.LogoLink;g.CambiosPrecios=a.lastDataCotizacionInstrumento.CambiosPrecios;var c=new Date();var f=(c.getMonth()+1).toString();if(f.length==1){f="0"+f}var e=(c.getDate()).toString();if(e.length==1){e="0"+e}g.Cotizacion.UltimaOperacion=(d.f.length==10)?d.f:c.getFullYear()+"-"+f+"-"+e+" "+d.f;g.Cotizacion.UltimoPrecio=d.u;g.Cotizacion.PrecioApertura=d.ap;g.Cotizacion.PrecioMaximo=d.max;g.Cotizacion.Volumen=d.v;g.Cotizacion.PrecioCierreAnterior=d.ant;g.Cotizacion.PrecioMinimo=d.min;g.Cotizacion.PrecioCompra=d.pc;g.Cotizacion.PrecioVenta=d.pv;g.Cotizacion.CantCompra=d.cc;g.Cotizacion.CantVenta=d.cv;if(d.cc2||d.pc2||d.pv2||d.cv2){g.Profundidad.push({CantCompra:d.cc2,PrecioCompra:d.pc2,PrecioVenta:d.pv2,CantVenta:d.cv2})}if(d.cc3||d.pc3||d.pv3||d.cv3){g.Profundidad.push({CantCompra:d.cc3,PrecioCompra:d.pc3,PrecioVenta:d.pv3,CantVenta:d.cv3})}if(d.cc4||d.pc4||d.pv4||d.cv4){g.Profundidad.push({CantCompra:d.cc4,PrecioCompra:d.pc4,PrecioVenta:d.pv4,CantVenta:d.cv4})}if(d.cc5||d.pc5||d.pv5||d.cv5){g.Profundidad.push({CantCompra:d.cc5,PrecioCompra:d.pc5,PrecioVenta:d.pv5,CantVenta:d.cv5})}return g};a.loadCotizacionInstrumento=function(c){var d=new Date();d.setHours(0,0,0,0);var e=(c.Cotizacion.UltimaOperacion)?new Date(c.Cotizacion.UltimaOperacion):new Date();e.setHours(0,0,0,0);a.lblTitleInstrumento.text(c.Cotizacion.Descripcion);a.lblInstrumento.html(a.ticker);a.lblFechaUtimaOperacion.text((c.Cotizacion.UltimaOperacion)?((d.getTime()!=e.getTime())?(c.Cotizacion.UltimaOperacion.substr(0,10)):(c.Cotizacion.UltimaOperacion.substr(11,5))):"-");a.divRatioIsin.hide();a.divRatio.hide();if(c.Cotizacion.Ratio){a.divRatioIsin.show();a.divRatio.show();a.lblRatio.text(c.Cotizacion.Ratio)}a.divIsin.hide();if(c.Cotizacion.ISIN){a.divRatioIsin.show();a.divIsin.show();a.lblIsin.text(c.Cotizacion.ISIN)}a.divIndicadorMercadoContenedor.hide();if(c.Cotizacion.StatusColor){a.divIndicadorMercadoContenedor.show();a.divIndicadorMercado.css("background-color",c.Cotizacion.StatusColor);a.divIndicadorMercado.attr("title",c.Cotizacion.SecurityStatus);a.lblIndicadorMercado.text(c.Cotizacion.SecurityStatus)}a.divLogoInstrumento.hide();if(c.Cotizacion.LogoLink){a.divLogoInstrumento.show();a.imgLogoInstrumento.attr("src",c.Cotizacion.LogoLink)}a.lblUltimoOperado.text((c.Cotizacion.UltimoPrecio)?(c.Cotizacion.SimboloMoneda+" "+Core.Functions.grid.formatPrice(c.Cotizacion.UltimoPrecio)):"-");if(a.lastDataCotizacionInstrumento){Core.Functions.setHighlight(a.lblUltimoOperado,c.Cotizacion.UltimoPrecio,a.lastDataCotizacionInstrumento.Cotizacion.UltimoPrecio)}a.lblPrecioApertura.text((c.Cotizacion.PrecioApertura)?(Core.Functions.grid.formatPrice(c.Cotizacion.PrecioApertura)):"-");if(a.lastDataCotizacionInstrumento){Core.Functions.setHighlight(a.lblPrecioApertura,c.Cotizacion.PrecioApertura,a.lastDataCotizacionInstrumento.Cotizacion.PrecioApertura)}a.lblPrecioMaximo.text((c.Cotizacion.PrecioMaximo)?(Core.Functions.grid.formatPrice(c.Cotizacion.PrecioMaximo)):"-");if(a.lastDataCotizacionInstrumento){Core.Functions.setHighlight(a.lblPrecioMaximo,c.Cotizacion.PrecioMaximo,a.lastDataCotizacionInstrumento.Cotizacion.PrecioMaximo)}a.lblVolumen.text((c.Cotizacion.Volumen)?(Core.Functions.grid.formatIntegerNumber(c.Cotizacion.Volumen)):"-");if(a.lastDataCotizacionInstrumento){Core.Functions.setHighlight(a.lblVolumen,c.Cotizacion.Volumen,a.lastDataCotizacionInstrumento.Cotizacion.Volumen)}a.lblPrecioCierreAnterior.text((c.Cotizacion.PrecioCierreAnterior)?(Core.Functions.grid.formatPrice(c.Cotizacion.PrecioCierreAnterior)):"-");if(a.lastDataCotizacionInstrumento){Core.Functions.setHighlight(a.lblPrecioCierreAnterior,c.Cotizacion.PrecioCierreAnterior,a.lastDataCotizacionInstrumento.Cotizacion.PrecioCierreAnterior)}a.lblPrecioMinimo.text((c.Cotizacion.PrecioMinimo)?(Core.Functions.grid.formatPrice(c.Cotizacion.PrecioMinimo)):"-");if(a.lastDataCotizacionInstrumento){Core.Functions.setHighlight(a.lblPrecioMinimo,c.Cotizacion.PrecioMinimo,a.lastDataCotizacionInstrumento.Cotizacion.PrecioMinimo)}if(c.Cotizacion.verProfundidad&&c.Profundidad.length>0){a.divCompraVentaProfundidad.show();a.divCompraVenta.hide();a.setItemProfunidad(c.Cotizacion,a.lblProfundidad1,a.lblProfundidad1VentaCantidad,a.lblProfundidad1VentaPrecio,a.lblProfundidad1CompraCantidad,a.lblProfundidad1CompraPrecio,((a.lastDataCotizacionInstrumento)?a.lastDataCotizacionInstrumento.Cotizacion:null));a.setItemProfunidad(c.Profundidad[0],a.lblProfundidad2,a.lblProfundidad2VentaCantidad,a.lblProfundidad2VentaPrecio,a.lblProfundidad2CompraCantidad,a.lblProfundidad2CompraPrecio,((a.lastDataCotizacionInstrumento)?a.lastDataCotizacionInstrumento.Profundidad[0]:null));a.setItemProfunidad(c.Profundidad[1],a.lblProfundidad3,a.lblProfundidad3VentaCantidad,a.lblProfundidad3VentaPrecio,a.lblProfundidad3CompraCantidad,a.lblProfundidad3CompraPrecio,((a.lastDataCotizacionInstrumento)?a.lastDataCotizacionInstrumento.Profundidad[1]:null));a.setItemProfunidad(c.Profundidad[2],a.lblProfundidad4,a.lblProfundidad4VentaCantidad,a.lblProfundidad4VentaPrecio,a.lblProfundidad4CompraCantidad,a.lblProfundidad4CompraPrecio,((a.lastDataCotizacionInstrumento)?a.lastDataCotizacionInstrumento.Profundidad[2]:null));a.setItemProfunidad(c.Profundidad[3],a.lblProfundidad5,a.lblProfundidad5VentaCantidad,a.lblProfundidad5VentaPrecio,a.lblProfundidad5CompraCantidad,a.lblProfundidad5CompraPrecio,((a.lastDataCotizacionInstrumento)?a.lastDataCotizacionInstrumento.Profundidad[3]:null))}else{a.divCompraVentaProfundidad.hide();a.divCompraVenta.show();a.lblPrecioVenta.text((c.Cotizacion.PrecioCompra)?(Core.Functions.grid.formatPrice(c.Cotizacion.PrecioCompra)):"-");if(a.lastDataCotizacionInstrumento){Core.Functions.setHighlight(a.lblPrecioVenta,c.Cotizacion.PrecioCompra,a.lastDataCotizacionInstrumento.Cotizacion.PrecioCompra)}a.lblPrecioCompra.text((c.Cotizacion.PrecioVenta)?(Core.Functions.grid.formatPrice(c.Cotizacion.PrecioVenta)):"-");if(a.lastDataCotizacionInstrumento){Core.Functions.setHighlight(a.lblPrecioCompra,c.Cotizacion.PrecioVenta,a.lastDataCotizacionInstrumento.Cotizacion.PrecioVenta)}}a.lblVariacion.removeClass("variacion-positiva");a.lblVariacion.removeClass("variacion-negativa");var f=a.getVariation(c);if(f==null){a.lblVariacion.text("0.00 %")}else{if(f>0){a.lblVariacion.addClass("variacion-positiva");a.lblVariacion.text(Core.Functions.grid.formatNumber(f)+" %")}if(f==0){a.lblVariacion.text("0.00 %")}else{if(f<0){a.lblVariacion.addClass("variacion-negativa");a.lblVariacion.text(Core.Functions.grid.formatNumber(f)+" %")}}if(a.lastDataCotizacionInstrumento){Core.Functions.setHighlight(a.lblVariacion,c.Cotizacion.UltimoPrecio,a.lastDataCotizacionInstrumento.Cotizacion.UltimoPrecio)}}a.setCambioPrecio(c.Cotizacion.UltimoPrecio,c.Cotizacion.PrecioCierreAnterior,a.lblCambioPrecioDiario,a.imgCambioPrecioDiario);if(a.lastDataCotizacionInstrumento){Core.Functions.setHighlight(a.lblCambioPrecioDiario,c.Cotizacion.UltimoPrecio,a.lastDataCotizacionInstrumento.Cotizacion.UltimoPrecio)}a.setCambioPrecio(c.Cotizacion.UltimoPrecio,c.CambiosPrecios.semana,a.lblCambioPrecioSemanal,a.imgCambioPrecioSemanal);if(a.lastDataCotizacionInstrumento){Core.Functions.setHighlight(a.lblCambioPrecioSemanal,c.Cotizacion.UltimoPrecio,a.lastDataCotizacionInstrumento.Cotizacion.UltimoPrecio)}a.setCambioPrecio(c.Cotizacion.UltimoPrecio,c.CambiosPrecios.mes,a.lblCambioPrecioMensual,a.imgCambioPrecioMensual);if(a.lastDataCotizacionInstrumento){Core.Functions.setHighlight(a.lblCambioPrecioMensual,c.Cotizacion.UltimoPrecio,a.lastDataCotizacionInstrumento.Cotizacion.UltimoPrecio)}a.setCambioPrecio(c.Cotizacion.UltimoPrecio,c.CambiosPrecios.anio,a.lblCambioPrecioAnual,a.imgCambioPrecioAnual);if(a.lastDataCotizacionInstrumento){Core.Functions.setHighlight(a.lblCambioPrecioAnual,c.Cotizacion.UltimoPrecio,a.lastDataCotizacionInstrumento.Cotizacion.UltimoPrecio)}a.btnWatchlist.attr("src",(c.Cotizacion.idWatchlist?"/images/ico-watchlist-activa.svg":"/images/ico-watchlist-inactiva.svg"));a.lastDataCotizacionInstrumento=c};a.setItemProfunidad=function(d,c,g,i,f,h,e){if(d){g.text((d.CantCompra)?(Core.Functions.grid.formatIntegerNumber(d.CantCompra)+" x "):"");if(e){Core.Functions.setHighlight(g,d.CantCompra,e.CantCompra)}i.text((d.PrecioCompra)?(Core.Functions.grid.formatPrice(d.PrecioCompra)):"");if(e){Core.Functions.setHighlight(i,d.PrecioCompra,e.PrecioCompra)}f.text((d.CantVenta)?(" x "+Core.Functions.grid.formatIntegerNumber(d.CantVenta)):"");if(e){Core.Functions.setHighlight(f,d.CantVenta,e.CantVenta)}h.text((d.PrecioVenta)?(Core.Functions.grid.formatPrice(d.PrecioVenta)):"");if(e){Core.Functions.setHighlight(h,d.PrecioVenta,e.PrecioVenta)}c.show()}else{c.hide()}};a.getPrecioAnterior=function(d){if(!a.cotizacionHistoricoInstrumento.historico[0]){return null}var c=new Date(a.cotizacionHistoricoInstrumento.historico[0].fecha+"T12:00:00");c.setHours(0,0,0,0);if(c.getTime()>d.getTime()){return null}var e=null;while(!e){e=$.grep(a.cotizacionHistoricoInstrumento.historico,function(h,g){var f=new Date(h.fecha+"T12:00:00");f.setHours(0,0,0,0);return f.getTime()==d.getTime()})[0];if(!e){d.setDate(d.getDate()-1)}}return e.preciocierre};a.loadCotizacionIntradiario=function(){var c={detalle:1,agrupado:0};c.ticker=a.ticker;if(a.idPlazo!=null){c.plazo=a.idPlazo}var d=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divGraficos,secureRequest:true,requestUrl:"cotizacionintradiario",requestType:"GET",requestData:c});d.onSuccess=function(e){if(!e.intradiario){e.intradiario=[]}var g=a.gridOperaciones.swidget().pager.page();var f=a.gridOperaciones.swidget().initialOptions;e.intradiario.sort(function(h,j){var m=j.cantidadoperaciones-h.cantidadoperaciones;if(m==0){var l=new Date();var i=new Date(l.getFullYear()+"-"+(l.getMonth()+1)+"-"+l.getDate()+" "+h.hora);var k=new Date(l.getFullYear()+"-"+(l.getMonth()+1)+"-"+l.getDate()+" "+j.hora);m=k.getTime()-i.getTime()}return m});f.dataSource.data=e.intradiario;f.columns=a.getColsIntradiario(e.intradiario);a.gridOperaciones.swidget().refresh(f);if(g>1){a.gridOperaciones.swidget().pager.page(g)}};d.request()};a.getColsIntradiario=function(c){if(c[0]&&c[0].cantidadoperaciones!=0){return[{width:"20%",field:"hora",title:"Hora",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"30%",field:"cantidadoperaciones",title:"Operaciones",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatIntegerNumber},{width:"25%",field:"precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatPrice},{width:"25%",field:"cantidad",title:"Nominales",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getDolarCellEvenClass(),format:Core.Functions.grid.formatNumber}]}else{return[{field:"hora",title:"Hora",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{field:"precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatPrice},{field:"cantidad",title:"Nominales",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNumber}]}};a.getVariation=function(c){var d=new Date();d.setHours(0,0,0,0);var f=(c.Cotizacion.UltimaOperacion)?new Date(c.Cotizacion.UltimaOperacion):new Date();f.setHours(0,0,0,0);if(!c.Cotizacion.UltimaOperacion||!c.Cotizacion.PrecioCierreAnterior||!c.Cotizacion.UltimoPrecio||d.getTime()!=f.getTime()){return null}else{var e=c.Cotizacion.UltimoPrecio-c.Cotizacion.PrecioCierreAnterior;a.lblVariacion.addClass("variacion-negativa");return parseFloat((e/c.Cotizacion.PrecioCierreAnterior*100).toFixed(2))}};a.callOperar=function(d){var c=$.grep(Core.Objects.Accounts?Core.Objects.Accounts:[],function(f,e){return f.idCuenta==a.header.selectedIdAccount})[0];if(!c||c.NumComitente==""){return}if(a.panel==Core.Enums.ePanel.Acciones&&Core.Functions.Context.Profiles.existPageInMenu("acciones",Core.Objects.Context.Profiles[a.idDefaultProfile])){Core.Business.Operar.Acciones.init(c.idCuenta,a.idDefaultProfile,d)}else{if(a.panel==Core.Enums.ePanel.Opciones&&Core.Functions.Context.Profiles.existPageInMenu("opciones",Core.Objects.Context.Profiles[a.idDefaultProfile])){Core.Business.Operar.Opciones.init(c.idCuenta,a.idDefaultProfile,d)}else{if(a.panel==Core.Enums.ePanel.Bonos&&Core.Functions.Context.Profiles.existPageInMenu("bonos",Core.Objects.Context.Profiles[a.idDefaultProfile])){Core.Business.Operar.Bonos.init(c.idCuenta,a.idDefaultProfile,d)}else{if(a.panel==Core.Enums.ePanel.Cedears&&Core.Functions.Context.Profiles.existPageInMenu("cedears",Core.Objects.Context.Profiles[a.idDefaultProfile])){Core.Business.Operar.Cedears.init(c.idCuenta,a.idDefaultProfile,d)}else{if(a.panel==Core.Enums.ePanel.Lebacs&&Core.Functions.Context.Profiles.existPageInMenu("lebacs",Core.Objects.Context.Profiles[a.idDefaultProfile])){Core.Business.Operar.Lebacs.init(c.idCuenta,a.idDefaultProfile,d)}else{if(a.panel==Core.Enums.ePanel.Letes&&Core.Functions.Context.Profiles.existPageInMenu("letes",Core.Objects.Context.Profiles[a.idDefaultProfile])){Core.Business.Operar.Letes.init(c.idCuenta,a.idDefaultProfile,d)}else{if(a.panel==Core.Enums.ePanel.ONs&&Core.Functions.Context.Profiles.existPageInMenu("obligacionesnegociables",Core.Objects.Context.Profiles[a.idDefaultProfile])){Core.Business.Operar.ObligacionesNegociables.init(c.idCuenta,a.idDefaultProfile,d)}else{if(a.panel==Core.Enums.ePanel.Futuros&&Core.Functions.Context.Profiles.existPageInMenu("futuros",Core.Objects.Context.Profiles[a.idDefaultProfile])){Core.Business.Operar.Futuros.init(c.idCuenta,a.idDefaultProfile,d)}else{if(a.panel==Core.Enums.ePanel.Cauciones&&Core.Functions.Context.Profiles.existPageInMenu("cauciones",Core.Objects.Context.Profiles[a.idDefaultProfile])){Core.Business.Operar.Cauciones.init(c.idCuenta,a.idDefaultProfile,d)}else{if(a.panel==Core.Enums.ePanel.NYSE&&Core.Functions.Context.Profiles.existPageInMenu("internacional",Core.Objects.Context.Profiles[a.idDefaultProfile])){Core.Business.Operar.Internacional.init(c.idCuenta,a.idDefaultProfile,d)}else{if(a.panel==Core.Enums.ePanel.BCINYSE&&Core.Functions.Context.Profiles.existPageInMenu("bci_internacional",Core.Objects.Context.Profiles[a.idDefaultProfile])){Core.Business.Operar.BCIAcciones.init(c.idCuenta,a.idDefaultProfile,d)}}}}}}}}}}}};a.stopRefresh=function(){a.loaded=false;a.executeCotizacionInstrumento=false;a.lastDataCotizacionInstrumento=null;if(a.timerIdCotizacionInstrumento){window.clearInterval(a.timerIdCotizacionInstrumento);Core.Objects.Context.Timers.remove(a.timerIdCotizacionInstrumento)}};a.initControlsFondo=function(){a.btnSuscribirFondo.on("click",function(){var c={};c.defaultTipoOperacion=Core.Enums.eFondosTipoOperacion.Suscripcion;c.defaultFondoDestino=a.fondo.substr(0,a.fondo.length-1);c.defaultMoneda=a.cotizacionFondo.Cotizacion.Moneda;Core.Business.Operar.FCI.init(a.header.selectedIdAccount,a.idDefaultProfile,c)});a.btnRescatarFondo.on("click",function(){var c={};c.defaultTipoOperacion=Core.Enums.eFondosTipoOperacion.Rescate;c.defaultFondoOrigen=a.fondo;Core.Business.Operar.FCI.init(a.header.selectedIdAccount,a.idDefaultProfile,c)});a.btnCambiarFondo.on("click",function(){var c={};c.defaultTipoOperacion=Core.Enums.eFondosTipoOperacion.CambioFondo;c.defaultFondoOrigen=a.fondo;Core.Business.Operar.FCI.init(a.header.selectedIdAccount,a.idDefaultProfile,c)})};a.getInitialDataFondo=function(){a.divDetalleInstrumento.hide();a.divDetalleFondo.show();var c={};c.ticker=a.fondo;var d=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"cotizacioncuotaparte",requestType:"GET",requestData:c});d.onSuccess=function(e){a.loadCotizacionFondo(e);a.cotizacionFondo=e;var f={};f.ticker=a.fondo;var g=new Core.Ajax.ServerRequest({overlayElement:a.divGraficos,showOverlay:true,secureRequest:true,requestUrl:"cotizacionhistorico",requestType:"GET",requestData:f});g.onSuccess=function(h){a.cotizacionHistoricoFondo=h;var j=a.getValorCuotaparteAnteriorDiario(e.Cotizacion.UltimaCotizacion);a.setCambioPrecio(e.Cotizacion.Cotizacion,j,a.lblCambioPrecioDiarioFondo,a.imgCambioPrecioDiarioFondo);a.lblVariacionFondo.removeClass("variacion-positiva");a.lblVariacionFondo.removeClass("variacion-negativa");if(!j||!e.Cotizacion.Cotizacion){a.lblVariacionFondo.text("0.00 %")}else{var i=e.Cotizacion.Cotizacion-j;if(i>0){a.lblVariacionFondo.addClass("variacion-positiva");a.lblVariacionFondo.text(Core.Functions.grid.formatNumber(parseFloat((i/j*100).toFixed(2)))+" %")}else{if(i==0){a.lblVariacionFondo.text("0.00 %")}else{if(i<0){a.lblVariacionFondo.addClass("variacion-negativa");a.lblVariacionFondo.text(Core.Functions.grid.formatNumber(parseFloat((i/j*100).toFixed(2)))+" %")}}}}a.setCambioPrecio(e.Cotizacion.Cotizacion,a.getValorCuotaparteAnteriorSemanal(e.Cotizacion.UltimaCotizacion),a.lblCambioPrecioSemanalFondo,a.imgCambioPrecioSemanalFondo);a.setCambioPrecio(e.Cotizacion.Cotizacion,a.getValorCuotaparteAnteriorMensual(e.Cotizacion.UltimaCotizacion),a.lblCambioPrecioMensualFondo,a.imgCambioPrecioMensualFondo);a.setCambioPrecio(e.Cotizacion.Cotizacion,a.getValorCuotaparteAnteriorAnual(e.Cotizacion.UltimaCotizacion),a.lblCambioPrecioAnualFondo,a.imgCambioPrecioAnualFondo);a.loadChartHistoricoFondo()};g.request()};d.request()};a.loadCotizacionFondo=function(c){a.lblTitleInstrumento.html(c.Cotizacion.Descripcion);a.lblFondo.text(a.fondo);a.lblCuotaparteFondo.text((c.Cotizacion.Cotizacion)?(c.Cotizacion.SimboloMoneda+" "+Core.Functions.grid.formatPrice(c.Cotizacion.Cotizacion)):"-");a.lblClaseFondo.text((c.Cotizacion.Clase)?c.Cotizacion.Clase:"-");a.lblPlazoRescateFondo.text((c.Cotizacion.PlazoRescate)?c.Cotizacion.PlazoRescate:"-");a.lblFechaInicioFondo.text((c.Cotizacion.FechaInicio)?c.Cotizacion.FechaInicio:"-");a.lblMonedaFondo.text((c.Cotizacion.Moneda)?c.Cotizacion.Moneda:"-");a.lblCalificacionFondo.text((c.Cotizacion.Riesgo)?c.Cotizacion.Riesgo:"-");a.lblFechaUltimaCotizacionFondo.text((c.Cotizacion.UltimaCotizacion)?c.Cotizacion.UltimaCotizacion:"-")};a.getValorCuotaparteAnteriorDiario=function(d){if(!d){return null}var c=new Date(d.substr(6,4)+"-"+d.substr(3,2)+"-"+d.substr(0,2)+"T12:00:00");c.setDate(c.getDate()-1);c.setHours(0,0,0,0);return a.getValorCuotaparteAnterior(c)};a.getValorCuotaparteAnteriorSemanal=function(d){if(!d){return null}var c=new Date(d.substr(6,4)+"-"+d.substr(3,2)+"-"+d.substr(0,2)+"T12:00:00");c.setDate(c.getDate()-7);c.setHours(0,0,0,0);return a.getValorCuotaparteAnterior(c)};a.getValorCuotaparteAnteriorMensual=function(d){if(!d){return null}var c=new Date(d.substr(6,4)+"-"+d.substr(3,2)+"-"+d.substr(0,2)+"T12:00:00");c.setMonth(c.getMonth()-1);c.setHours(0,0,0,0);return a.getValorCuotaparteAnterior(c)};a.getValorCuotaparteAnteriorAnual=function(d){if(!d){return null}var c=new Date(d.substr(6,4)+"-"+d.substr(3,2)+"-"+d.substr(0,2)+"T12:00:00");c.setFullYear(c.getFullYear()-1);c.setHours(0,0,0,0);return a.getValorCuotaparteAnterior(c)};a.getValorCuotaparteAnterior=function(c){if(!a.cotizacionHistoricoFondo.historico[0]){return null}var d=new Date(a.cotizacionHistoricoFondo.historico[0].fecha+"T12:00:00");d.setHours(0,0,0,0);if(d.getTime()>c.getTime()){return null}var e=null;while(!e){e=$.grep(a.cotizacionHistoricoFondo.historico,function(h,g){var f=new Date(h.fecha+"T12:00:00");f.setHours(0,0,0,0);return f.getTime()==c.getTime()})[0];if(!e){c.setDate(c.getDate()-1)}}return e.valorcuotaparte};a.loadChartHistoricoFondo=function(){a.cotizacionHistoricoFondo.historico.forEach(function(d,c){d.date=new Date(d.fecha+"T12:00:00")});a.chartHistoricoFondo=AmCharts.makeChart(a.divChartHistoricoFondo[0],{type:"stock",theme:"light",dataSets:[{color:"#254C79",fieldMappings:[{fromField:"valorcuotaparte",toField:"value"}],dataProvider:a.cotizacionHistoricoFondo.historico,categoryField:"date",}],panels:[{title:"",stockGraphs:[{id:"g1",valueField:"value",fillAlphas:0.25}],stockLegend:{valueTextRegular:" ",markerType:"none"}}],chartScrollbarSettings:{graph:"g1"},chartCursorSettings:{valueBalloonsEnabled:true,graphBulletSize:1,valueLineBalloonEnabled:true,valueLineEnabled:true,valueLineAlpha:0.5},categoryAxesSettings:{equalSpacing:true,maxSeries:500},periodSelector:{periods:[{period:"DD",count:10,label:"10 days"},{period:"MM",count:1,label:"1 month"},{period:"YYYY",count:1,label:"1 year"},{period:"YTD",selected:true,label:"YTD"},{period:"MAX",label:"MAX"}]},panelsSettings:{usePrefixes:true},"export":{enabled:true}})}};Core.Business.DetallePack=new function(){var a=this;a.id="packdetalle";a.idDefaultAccount=null;a.idDefaultProfile=null;a.pageOptions=null;a.ticker=null;a.detallePack=null;a.init=function(b,c,d){a.idDefaultAccount=b;a.idDefaultProfile=c;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.ticker=0;a.detallePack=null;$.extend(true,a,d);Core.loadPage("detalle-pack.html",function(){document.title="Detalle Pack";a.divMain=$(".div-main");a.lblPack=$(".lbl-pack");a.lblTitulo=$(".lbl-titulo");a.lblDescripcion=$(".lbl-descripcion");a.imgRecomendadoPor=$(".img-recomendado-por");a.lblRecomendadoPor=$(".lbl-recomendado-por");a.lblRecomendadoPorDescripcion=$(".lbl-recomendado-por-descripcion");a.lblPrecioUnidad=$(".lbl-precio-unidad");a.lblPlazo=$(".lbl-plazo");a.lblRiesgo=$(".lbl-riesgo");a.lblInstrumento=$(".lbl-instrumento");a.btnInvertir=$(".btn-invertir");a.divLinks=$(".box-links");a.divLinks.hide();a.btnInforme=$(".btn-informe");a.divInforme=$(".div-informe");a.divInforme.hide();a.btnVideo=$(".btn-video");a.divVideo=$(".div-video");a.divVideo.hide();a.divComposicion=$(".div-composicion");a.divComposicion.hide();a.divGraficoComposicion=$(".div-grafico-composicion");a.divLogos=$(".div-logos");a.chartComposicion=null;a.detallePack=null;a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadControls()},"Core.Business.DetallePack",d)})};a.initControls=function(){a.chartComposicion=AmCharts.makeChart(a.divGraficoComposicion[0],{type:"pie",theme:"light",titleField:"Ticker",valueField:"Porcentaje",labelRadius:1,radius:85,innerRadius:"40%",legend:window.innerWidth>800?{position:"right",marginRight:0,autoMargin:false,valueText:false}:{position:"absolute",marginRight:0,top:"250px !important",left:0,autoMargins:false,valueText:false},labelsEnabled:false,balloonFunction:function(c,b){return(c.value*100).toFixed(2)+"%"}});a.btnInvertir.on("click",function(){if(a.detallePack){Core.Business.OperarPack.init(a.idDefaultAccount,a.idDefaultProfile,{detallePack:a.detallePack})}});a.btnInforme.on("click",function(){if(a.detallePack&&a.detallePack.detalle[0]&&a.detallePack.detalle[0].Link){window.open(a.detallePack.detalle[0].Link,"_blank")}});a.btnVideo.on("click",function(){if(a.detallePack&&a.detallePack.detalle[0]&&a.detallePack.detalle[0].LinkVideo){window.open(a.detallePack.detalle[0].LinkVideo,"_blank")}})};a.loadControls=function(){var b=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divMain,secureRequest:true,requestUrl:"sinteticos/detalle",requestType:"GET",requestData:{Ticker:a.ticker}});b.onSuccess=function(d){a.detallePack=d;if(a.detallePack&&a.detallePack.detalle[0]){a.lblTitulo.text(Core.Functions.grid.formatUndefinedString(a.detallePack.detalle[0].Titulo));a.lblPack.text(Core.Functions.grid.formatUndefinedString(a.detallePack.detalle[0].Ticker));a.lblDescripcion.text(Core.Functions.grid.formatUndefinedString(a.detallePack.detalle[0].DescripcionLarga));a.lblRecomendadoPor.text(Core.Functions.grid.formatUndefinedString(a.detallePack.detalle[0].RecomendadorNombre));a.lblRecomendadoPorDescripcion.text(Core.Functions.grid.formatUndefinedString(a.detallePack.detalle[0].RecomendadorDescripcion));a.imgRecomendadoPor.attr("src",a.detallePack.detalle[0].RecomendadorURLImagen?Core.Functions.grid.formatUndefinedString(a.detallePack.detalle[0].RecomendadorURLImagen):"/images/logo-balanz.png");a.lblPlazo.text(Core.Functions.grid.formatUndefinedString(a.detallePack.detalle[0].PlazoInversion));a.lblRiesgo.text(Core.Functions.grid.formatUndefinedString(a.detallePack.detalle[0].Riesgo));a.lblInstrumento.text(Core.Functions.grid.formatUndefinedString(a.detallePack.detalle[0].TipoInstrumento));a.lblPrecioUnidad.text(Core.Functions.grid.formatPrice(a.detallePack.detalle[0].Ultimo));if(a.detallePack.detalle[0].Link){a.divInforme.show()}if(a.detallePack.detalle[0].LinkVideo){a.divVideo.show()}if(a.detallePack.detalle[0].Link||a.detallePack.detalle[0].LinkVideo){a.divLinks.show()}}if(a.detallePack&&a.detallePack.composicion&&a.detallePack.composicion.length){var c=[];a.detallePack.composicion.forEach(function(g,f){if(g.Color){c.push(g.Color)}if(g.Imagen&&g.Ticker){var e=$('<div><img class="img-logo-pack" src="'+g.Imagen+'" /></div>').appendTo(a.divLogos);e.on("click",function(){Core.Business.DetalleInstrumento.init(a.idDefaultAccount,a.idDefaultProfile,{ticker:g.Ticker})})}g.Porcentaje=g.Ponderacion?(g.Ponderacion/100).toFixed(4):0});a.chartComposicion.colors=c;a.chartComposicion.dataProvider=a.detallePack.composicion;a.chartComposicion.validateData();if(a.detallePack.composicion.length>1){a.divComposicion.show()}else{a.divLogos.addClass("center-logo")}}};b.request()}};Core.Business.DetalleRealEstate=new function(){var a=this;a.id="realestatedetalle";a.idDefaultAccount=null;a.idDefaultProfile=null;a.pageOptions=null;a.ticker=null;a.operarRealEstate=null;a.detalleProyecto=null;a.divMain=null;a.lblTitulo=null;a.lblDescripcion=null;a.divImagenes=null;a.lblRentabilidadEstimada=null;a.lblEstado=null;a.lblMoneda=null;a.lblDuracionEstimada=null;a.lblTipoProyecto=null;a.lblUbicacion=null;a.btnUbicacion=null;a.lblCompletado=null;a.btnInvertir=null;a.init=function(b,c,d){a.idDefaultAccount=b;a.idDefaultProfile=c;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.ticker="";a.operarRealEstate=false;a.detalleProyecto=null;$.extend(true,a,d);Core.loadPage("detalle-real-estate.html",function(){document.title="Real Estate";a.divMain=$(".div-detalle-real-estate");a.lblTitulo=$(".lbl-titulo");a.lblDescripcion=$(".lbl-descripcion");a.divImagenes=$(".div-imagenes");a.lblRentabilidadEstimada=$(".lbl-rentabilidad-estimada");a.lblEstado=$(".lbl-estado");a.lblMoneda=$(".lbl-moneda");a.lblDuracionEstimada=$(".lbl-duracion-estimada");a.lblTipoProyecto=$(".lbl-tipo-proyecto");a.lblUbicacion=$(".lbl-ubicacion");a.btnUbicacion=$(".btn-ubicacion");a.lblCompletado=$(".lbl-completado");a.btnInvertir=$(".btn-invertir");a.detalleProyecto=null;a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadControls()},"Core.Business.DetalleRealEstate",d)})};a.initControls=function(){a.btnInvertir.on("click",function(){if(a.operarRealEstate&&a.detalleProyecto&&a.detalleProyecto.PermiteInversiones){Core.Business.OperarRealEstate.init(a.idDefaultAccount,a.idDefaultProfile,{defaultProyecto:a.detalleProyecto.Ticker})}})};a.loadControls=function(){var b=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divMain,secureRequest:true,requestUrl:"oferentesexternos/realestate/detalle",requestType:"GET",requestData:{Ticker:a.ticker}});b.onSuccess=function(c){a.lblTitulo.text(Core.Functions.grid.formatUndefinedString(c.Detalle.Nombre));a.lblDescripcion.text(Core.Functions.grid.formatUndefinedString(c.Detalle.Descripcion));a.divImagenes.empty();c.Detalle.imagenes.forEach(function(f,e){var d=$('<div class="item'+(e==0?" active":"")+'"></div>').appendTo(a.divImagenes);$('<img class="img-proyecto" src="'+f.ImagenURL+'" />').appendTo(d)});a.lblRentabilidadEstimada.text(Core.Functions.grid.formatUndefinedString(c.Detalle.RentabilidadEstimada));a.lblEstado.text(Core.Functions.grid.formatUndefinedString(c.Detalle.Estado));a.lblCompletado.text(Core.Functions.grid.formatNullNumber(c.Detalle.Completado)+" %");a.lblMoneda.text(Core.Functions.grid.formatUndefinedString(c.Detalle.Moneda));a.lblDuracionEstimada.text(Core.Functions.grid.formatUndefinedString(c.Detalle.Plazo));a.lblTipoProyecto.text(Core.Functions.grid.formatUndefinedString(c.Detalle.Tipo));a.lblUbicacion.text(Core.Functions.grid.formatUndefinedString(c.Detalle.Ubicacion));a.btnUbicacion.on("click",function(){window.open("https://www.google.com/maps/place/"+c.Detalle.Latitud+","+c.Detalle.Longitud)});a.detalleProyecto=c.Detalle;a.btnInvertir.hide();if(a.operarRealEstate&&a.detalleProyecto&&a.detalleProyecto.PermiteInversiones){a.btnInvertir.show()}};b.request()}};Core.Business.DistribucionComisiones=new function(){var a=this;a.id="homeDistribucionComisiones";a.idDefaultAccount=null;a.idDefaultProfile=null;a.btnDescargarReporte=null;a.divContainerTabs=null;a.divContainerDistribucionPeriodo=null;a.diContainerEditarNivel=null;a.divContainerPeriodosProductor=null;a.divContainerPooles=null;a.divContainerEditarPool=null;a.managerUnidadNegocio=null;a.btnUnidadNegocio=null;a.managerEquipos=null;a.btnEquipos=null;a.managerAsesoresProductores=null;a.btnAsesoresProductores=null;a.managerCuentas=null;a.btnCuentas=null;a.pageOptions=null;a.window=$(window);a.init=function(b,c){Core.loadPage("distribucion-comisiones.html",function(){document.title="Distribución Comisiones";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.idDefaultAccount=b;a.idDefaultProfile=c;a.btnDescargarReporte=$(".btn-descargar-reporte");a.divContainerTabs=$(".div-container-tabs");a.divContainerTabs.show();a.divContainerDistribucionPeriodo=$(".div-container-distribucion-periodo");a.divContainerDistribucionPeriodo.hide();a.diContainerEditarNivel=$(".div-container-editar-nivel");a.diContainerEditarNivel.hide();a.divContainerPeriodosProductor=$(".div-container-periodos-productor");a.divContainerPeriodosProductor.hide();a.divContainerPooles=$(".div-container-pooles");a.divContainerPooles.hide();a.divContainerEditarPool=$(".div-container-editar-pool");a.divContainerEditarPool.hide();a.managerUnidadNegocio=null;a.btnUnidadNegocio=$(".btn-unidad-negocio");a.managerEquipos=null;a.btnEquipos=$(".btn-equipos");a.managerAsesoresProductores=null;a.btnAsesoresProductores=$(".btn-asesores-productores");a.managerCuentas=null;a.btnCuentas=$(".btn-cuentas");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.btnUnidadNegocio.click()},"Core.Business.DistribucionComisiones")})};a.initControls=function(){a.btnDescargarReporte.on("click",function(){new Core.Business.DistribucionComisiones.DescargarReporte({}).show()});a.managerUnidadNegocio=new Core.Business.DistribucionComisiones.UnidadNegocio({containerTabs:a.divContainerTabs});a.managerUnidadNegocio.init();a.btnUnidadNegocio.on("click",function(){a.managerUnidadNegocio.load()});a.managerEquipos=new Core.Business.DistribucionComisiones.Equipos({containerTabs:a.divContainerTabs});a.managerEquipos.init();a.btnEquipos.on("click",function(){a.managerEquipos.load()});a.managerAsesoresProductores=new Core.Business.DistribucionComisiones.AsesoresProductores({containerTabs:a.divContainerTabs});a.managerAsesoresProductores.init();a.btnAsesoresProductores.on("click",function(){a.managerAsesoresProductores.load()});a.managerCuentas=new Core.Business.DistribucionComisiones.Cuentas({containerTabs:a.divContainerTabs});a.managerCuentas.init();a.btnCuentas.on("click",function(){a.managerCuentas.load()})}};Core.Business.DistribucionComisiones.UnidadNegocio=function(b){var a=this;a.containerTabs=null;$.extend(true,a,b);a.init=function(){a.idUnidad=-1;a.container=a.containerTabs.find(".div-container-unidad-negocio");a.btnNuevoPeriodo=a.container.find(".btn-nuevo-periodo");a.btnNuevoPeriodo.unbind("click");a.btnNuevoPeriodo.on("click",function(){new Core.Business.DistribucionComisiones.NuevoPeriodo({onConfirm:function(c){a.periodos.push(c);a.refreshPeriodos(a.periodos)}}).show()});a.ddlCuentas=a.container.find(".dropdown-cuentas");a.ddlCuentas.shieldDropDown({dataSource:{data:[{value:1,text:"Todas"},{value:2,text:"Con Productor"},{value:3,text:"Sin Productor"}]},valueTemplate:"{value}",textTemplate:"{text}",events:{select:function(c){a.load()}}});Core.Functions.Validations.toggleValidation(a.ddlCuentas,false);a.periodos=[];a.gridPeriodos=a.container.find(".div-periodos");Core.Business.DistribucionComisiones.InitGridPeriodos(a.containerTabs,a.gridPeriodos,function(c){a.gridPeriodos.swidget().dataSource.data.remove(c);a.refreshPeriodos(a.gridPeriodos.swidget().dataSource.data)});a.btnConfirmar=a.container.find(".btn-confirmar");a.btnConfirmar.unbind("click");a.btnConfirmar.on("click",function(){Core.Business.DistribucionComisiones.ConfirmarPeriodos(null,null,null,a.idUnidad,a.ddlCuentas,a.periodos,a.btnConfirmar,a.load)})};a.load=function(){Core.Functions.Validations.toggleValidation(a.ddlCuentas,false);if(a.ddlCuentas.swidget().selectedItem()){var c=new Core.Ajax.ServerRequest({showOverlay:true,requestUrl:"comisiones/abm/obtenerPeriodo/1/-1/"+a.ddlCuentas.swidget().selectedItem().value,requestType:"GET"});c.onSuccess=function(d){a.idUnidad=((d.unidadNegocio&&d.unidadNegocio[0])?d.unidadNegocio[0].id_unidad:-1);a.refreshPeriodos((d.respuesta?d.respuesta:[]))};c.request()}else{Core.Functions.Validations.toggleValidation(a.ddlCuentas,true);a.refreshPeriodos([])}};a.refreshPeriodos=function(d){a.periodos=d;var c=a.gridPeriodos.swidget().initialOptions;c.dataSource.data=a.periodos;a.gridPeriodos.swidget().refresh(c)}};Core.Business.DistribucionComisiones.Equipos=function(b){var a=this;a.containerTabs=null;$.extend(true,a,b);a.init=function(){a.container=a.containerTabs.find(".div-container-equipos");a.btnNuevoPeriodo=a.container.find(".btn-nuevo-periodo");a.btnNuevoPeriodo.unbind("click");a.btnNuevoPeriodo.on("click",function(){new Core.Business.DistribucionComisiones.NuevoPeriodo({onConfirm:function(c){a.periodos.push(c);a.refreshPeriodos(a.periodos)}}).show()});a.ddlCuentas=a.container.find(".dropdown-cuentas");a.ddlCuentas.shieldDropDown({dataSource:{data:[{value:1,text:"Todas"},{value:2,text:"Con Productor"},{value:3,text:"Sin Productor"}]},valueTemplate:"{value}",textTemplate:"{text}",events:{select:function(c){a.loadPeriodos()}}});Core.Functions.Validations.toggleValidation(a.ddlCuentas,false);a.ddlEquipo=a.container.find(".dropdown-equipo");a.ddlEquipo.shieldDropDown({dataSource:{data:[]},valueTemplate:"{id_equipo}",textTemplate:"{descripcion}",events:{select:function(c){a.loadPeriodos()}}});Core.Functions.Validations.toggleValidation(a.ddlEquipo,false);a.periodos=[];a.gridPeriodos=a.container.find(".div-periodos");Core.Business.DistribucionComisiones.InitGridPeriodos(a.containerTabs,a.gridPeriodos,function(c){a.gridPeriodos.swidget().dataSource.data.remove(c);a.refreshPeriodos(a.gridPeriodos.swidget().dataSource.data)});a.btnConfirmar=a.container.find(".btn-confirmar");a.btnConfirmar.unbind("click");a.btnConfirmar.on("click",function(){Core.Business.DistribucionComisiones.ConfirmarPeriodos(null,a.ddlEquipo,null,null,a.ddlCuentas,a.periodos,a.btnConfirmar,a.loadPeriodos)})};a.load=function(){var c=new Core.Ajax.ServerRequest({showOverlay:true,requestUrl:"comisiones/abm/obtenerEquipos",requestType:"GET"});c.onSuccess=function(f){var d=f.respuesta?f.respuesta:[];var e=a.ddlEquipo.swidget().initialOptions;e.dataSource.data=d;a.ddlEquipo.swidget().refresh(e);a.loadPeriodos()};c.request()};a.loadPeriodos=function(){Core.Functions.Validations.toggleValidation(a.ddlCuentas,false);Core.Functions.Validations.toggleValidation(a.ddlEquipo,false);if(a.ddlCuentas.swidget().selectedItem()&&a.ddlEquipo.swidget().selectedItem()){var c=new Core.Ajax.ServerRequest({showOverlay:true,requestUrl:"comisiones/abm/obtenerPeriodo/2/"+a.ddlEquipo.swidget().selectedItem().id_equipo+"/"+a.ddlCuentas.swidget().selectedItem().value,requestType:"GET"});c.onSuccess=function(d){a.refreshPeriodos((d.respuesta?d.respuesta:[]))};c.request()}else{Core.Functions.Validations.toggleValidation(a.ddlCuentas,true);Core.Functions.Validations.toggleValidation(a.ddlEquipo,true);a.refreshPeriodos([])}};a.refreshPeriodos=function(d){a.periodos=d;var c=a.gridPeriodos.swidget().initialOptions;c.dataSource.data=a.periodos;a.gridPeriodos.swidget().refresh(c)}};Core.Business.DistribucionComisiones.AsesoresProductores=function(b){var a=this;a.containerTabs=null;$.extend(true,a,b);a.init=function(){a.container=a.containerTabs.find(".div-container-asesores-productores");a.btnNuevoPeriodo=a.container.find(".btn-nuevo-periodo");a.btnNuevoPeriodo.unbind("click");a.btnNuevoPeriodo.on("click",function(){new Core.Business.DistribucionComisiones.NuevoPeriodo({onConfirm:function(c){a.periodos.push(c);a.refreshPeriodos(a.periodos)}}).show()});a.periodosProductor=null;a.btnPeriodosProductor=a.container.find(".btn-periodos-productor");a.btnPeriodosProductor.unbind("click");a.btnPeriodosProductor.on("click",function(){if(a.periodosProductor){new Core.Business.DistribucionComisiones.AsesoresProductores.PeriodosProductor({periodosProductor:a.periodosProductor,onLoad:function(){a.containerTabs.hide()},onClosed:function(){a.loadPeriodos();a.containerTabs.show()}}).show()}});a.btnPeriodosProductor.hide();a.btnEliminarPeriodosProductor=a.container.find(".btn-eliminar-periodos-productor");a.btnEliminarPeriodosProductor.unbind("click");a.btnEliminarPeriodosProductor.on("click",function(){if(a.periodosProductor){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar los períodos del productor?",{onAccepted:function(){var c=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.btnEliminarPeriodosProductor,secureRequest:true,requestUrl:"comisiones/abm/borrarProductor",requestType:"POST",requestData:{idproductor:a.periodosProductor.Productor[0].idproductor}});c.onSuccess=function(d){a.periodosProductor.Porcentajes=[];a.periodosProductor.Productor=[{idproductor:a.periodosProductor.Productor[0].idproductor}];a.btnEliminarPeriodosProductor.hide();a.btnPeriodosProductor.text("Crear Períodos Productor");a.btnPeriodosProductor.show()};c.request()}}).show()}});a.btnEliminarPeriodosProductor.hide();a.ddlAsesor=a.container.find(".dropdown-asesor");a.ddlAsesor.shieldDropDown({dataSource:{data:[]},valueTemplate:"{id_asesor}",textTemplate:"{descripcion}",events:{select:function(c){a.loadPeriodos()}}});Core.Functions.Validations.toggleValidation(a.ddlAsesor,false);a.periodos=[];a.gridPeriodos=a.container.find(".div-periodos");Core.Business.DistribucionComisiones.InitGridPeriodos(a.containerTabs,a.gridPeriodos,function(c){a.gridPeriodos.swidget().dataSource.data.remove(c);a.refreshPeriodos(a.gridPeriodos.swidget().dataSource.data)});a.btnConfirmar=a.container.find(".btn-confirmar");a.btnConfirmar.unbind("click");a.btnConfirmar.on("click",function(){Core.Business.DistribucionComisiones.ConfirmarPeriodos(null,null,a.ddlAsesor,null,null,a.periodos,a.btnConfirmar,a.loadPeriodos)})};a.load=function(){var c=new Core.Ajax.ServerRequest({showOverlay:true,requestUrl:"comisiones/abm/obtenerAsesores",requestType:"GET"});c.onSuccess=function(f){var d=f.respuesta?f.respuesta:[];var e=a.ddlAsesor.swidget().initialOptions;e.dataSource.data=d;a.ddlAsesor.swidget().refresh(e);a.loadPeriodos()};c.request()};a.loadPeriodos=function(){a.btnEliminarPeriodosProductor.hide();a.btnPeriodosProductor.hide();a.periodosProductor=null;Core.Functions.Validations.toggleValidation(a.ddlAsesor,false);if(a.ddlAsesor.swidget().selectedItem()){var c=new Core.Ajax.ServerRequest({showOverlay:true,requestUrl:"comisiones/abm/obtenerPeriodo/3/"+a.ddlAsesor.swidget().selectedItem().id_asesor+"/1",requestType:"GET"});c.onSuccess=function(d){a.refreshPeriodos((d.respuesta?d.respuesta:[]));if(a.ddlAsesor.swidget().selectedItem().id_productor){var e=new Core.Ajax.ServerRequest({showOverlay:true,requestUrl:"comisiones/abm/obtenerProductor/"+a.ddlAsesor.swidget().selectedItem().id_productor,requestType:"GET"});e.onSuccess=function(f){a.periodosProductor={};a.periodosProductor.Productor=((f.Productor&&f.Productor[0])?f.Productor:[{idproductor:a.ddlAsesor.swidget().selectedItem().id_productor}]);a.periodosProductor.Porcentajes=((f.Porcentajes&&f.Porcentajes[0])?f.Porcentajes:[]);a.btnPeriodosProductor.text((a.periodosProductor.Porcentajes.length?"Editar":"Crear")+" Períodos Productor");a.btnPeriodosProductor.show();if(a.periodosProductor.Porcentajes.length){a.btnEliminarPeriodosProductor.show()}};e.request()}};c.request()}else{Core.Functions.Validations.toggleValidation(a.ddlAsesor,true);a.refreshPeriodos([])}};a.refreshPeriodos=function(d){a.periodos=d;var c=a.gridPeriodos.swidget().initialOptions;c.dataSource.data=a.periodos;a.gridPeriodos.swidget().refresh(c)}};Core.Business.DistribucionComisiones.Cuentas=function(b){var a=this;a.containerTabs=null;$.extend(true,a,b);a.init=function(){a.cuentaSeleccionada=null;a.container=a.containerTabs.find(".div-container-cuentas");a.btnNuevoPeriodo=a.container.find(".btn-nuevo-periodo");a.btnNuevoPeriodo.unbind("click");a.btnNuevoPeriodo.on("click",function(){new Core.Business.DistribucionComisiones.NuevoPeriodo({onConfirm:function(c){a.periodos.push(c);a.refreshPeriodos(a.periodos)}}).show()});a.txtComitente=a.container.find(".textbox-comitente");a.txtComitente.shieldNumericTextBox({min:0,max:9999999,step:1});Core.Functions.Validations.toggleValidation(a.txtComitente,false);a.txtCuotapartista=a.container.find(".textbox-cuotapartista");a.txtCuotapartista.shieldNumericTextBox({min:0,max:9999999,step:1});Core.Functions.Validations.toggleValidation(a.txtCuotapartista,false);a.btnBuscarCuenta=a.container.find(".btn-buscar-cuenta");a.btnBuscarCuenta.unbind("click");a.btnBuscarCuenta.on("click",function(){a.load(a.btnBuscarCuenta)});a.lblDescripcionCuenta=a.container.find(".lbl-descripcion-cuenta");a.lblDescripcionCuenta.text("No se ha seleccionado una cuenta");a.periodos=[];a.gridPeriodos=a.container.find(".div-periodos");Core.Business.DistribucionComisiones.InitGridPeriodos(a.containerTabs,a.gridPeriodos,function(c){a.gridPeriodos.swidget().dataSource.data.remove(c);a.refreshPeriodos(a.gridPeriodos.swidget().dataSource.data)});a.btnConfirmar=a.container.find(".btn-confirmar");a.btnConfirmar.unbind("click");a.btnConfirmar.on("click",function(){if(a.cuentaSeleccionada){Core.Business.DistribucionComisiones.ConfirmarPeriodos(a.cuentaSeleccionada.id_cuenta,null,null,null,null,a.periodos,a.btnConfirmar,a.loadPeriodos)}else{new Core.Controls.Dialog("Aviso","Debe seleccionar una cuenta.",{displayButtons:{close:true,accept:false}}).show()}})};a.load=function(c){Core.Functions.Validations.toggleValidation(a.txtComitente,false);Core.Functions.Validations.toggleValidation(a.txtCuotapartista,false);if(!a.txtComitente.swidget().value()&&!a.txtCuotapartista.swidget().value()){Core.Functions.Validations.toggleValidation(a.txtComitente,true);Core.Functions.Validations.toggleValidation(a.txtCuotapartista,true);return}var d=new Core.Ajax.ServerRequest({overlayElement:c,showOverlay:true,requestUrl:"comisiones/abm/obtenerCuenta/"+(a.txtComitente.swidget().value()?a.txtComitente.swidget().value():"-1")+"/"+(a.txtCuotapartista.swidget().value()?a.txtCuotapartista.swidget().value():"-1"),requestType:"GET"});d.onSuccess=function(e){if(e.respuesta&&e.respuesta[0]){a.cuentaSeleccionada=e.respuesta[0];a.lblDescripcionCuenta.text(a.cuentaSeleccionada.descripcion)}else{a.cuentaSeleccionada=null;a.lblDescripcionCuenta.text("No se ha seleccionado una cuenta");new Core.Controls.Dialog("Aviso","No existe la cuenta.",{displayButtons:{close:true,accept:false}}).show()}a.loadPeriodos()};d.request()};a.loadPeriodos=function(){if(a.cuentaSeleccionada){var c=new Core.Ajax.ServerRequest({showOverlay:true,requestUrl:"comisiones/abm/obtenerPeriodo/4/"+a.cuentaSeleccionada.id_cuenta+"/1",requestType:"GET"});c.onSuccess=function(d){a.refreshPeriodos((d.respuesta?d.respuesta:[]))};c.request()}else{a.refreshPeriodos([])}};a.refreshPeriodos=function(d){a.periodos=d;var c=a.gridPeriodos.swidget().initialOptions;c.dataSource.data=a.periodos;a.gridPeriodos.swidget().refresh(c)}};Core.Business.DistribucionComisiones.NuevoPeriodo=function(b){var a=this;a.divModal=$(".div-nuevo-periodo");a.onConfirm=function(c){};$.extend(true,a,b);a.show=function(){a.txtFechaDesde=a.divModal.find(".date-picker-fecha-desde");a.txtFechaDesde.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],enabled:true,value:new Date()});Core.Functions.Validations.toggleValidation(a.txtFechaDesde,false);a.chkFechaDesdeSinPeriodo=a.divModal.find(".checkbox-fecha-desde-sin-periodo");a.chkFechaDesdeSinPeriodo.shieldCheckBox({label:"Sin Período",checked:false,events:{click:function(c){a.txtFechaDesde.swidget().enabled(!a.chkFechaDesdeSinPeriodo.swidget().checked())}}});a.chkFechaDesdeSinPeriodo.swidget().checked(false);Core.Functions.Validations.toggleValidation(a.chkFechaDesdeSinPeriodo,false);a.txtFechaHasta=a.divModal.find(".date-picker-fecha-hasta");a.txtFechaHasta.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],enabled:true,value:new Date()});Core.Functions.Validations.toggleValidation(a.txtFechaHasta,false);a.chkFechaHastaSinPeriodo=a.divModal.find(".checkbox-fecha-hasta-sin-periodo");a.chkFechaHastaSinPeriodo.shieldCheckBox({label:"Sin Período",checked:false,events:{click:function(c){a.txtFechaHasta.swidget().enabled(!a.chkFechaHastaSinPeriodo.swidget().checked())}}});a.chkFechaHastaSinPeriodo.swidget().checked(false);Core.Functions.Validations.toggleValidation(a.chkFechaHastaSinPeriodo,false);a.btnConfirm=a.divModal.find(".btn-confirmar");a.btnConfirm.unbind("click");a.btnConfirm.click(function(){var d={value:true};var c={};c.fecha_desde=a.chkFechaDesdeSinPeriodo.swidget().checked()?"-":a.getFormatDate(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaDesde,d));c.fecha_hasta=a.chkFechaHastaSinPeriodo.swidget().checked()?"-":a.getFormatDate(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaHasta,d));if(d.value){a.onConfirm(c);a.divModal.modal("hide")}});a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.divModal.modal({show:true})};a.getFormatDate=function(c){if(!c){return""}return c.getFullYear().toString()+"-"+Core.Functions.Date.getTwoCharsNumber(c.getMonth()+1)+"-"+Core.Functions.Date.getTwoCharsNumber(c.getDate())};a.destroy=function(){a.txtFechaDesde.swidget().destroy();a.txtFechaHasta.swidget().destroy();a.chkFechaDesdeSinPeriodo.swidget().destroy();a.chkFechaHastaSinPeriodo.swidget().destroy()}};Core.Business.DistribucionComisiones.ConfirmarPeriodos=function(d,c,a,e,b,h,g,f){var k={value:true};var i={};i.id_Cuenta=d?d:-1;i.id_Equipo=c?Core.Functions.Validations.getValidatedDropDownValue(c,k):-1;i.id_Asesor=a?Core.Functions.Validations.getValidatedDropDownValue(a,k):-1;i.id_Unidad=e?e:-1;i.conProductor=b?Core.Functions.Validations.getValidatedDropDownValue(b,k):1;i.periodos=[];h.forEach(function(m,l){var n={};n.fecha_desde=m.fecha_desde;n.fecha_hasta=m.fecha_hasta;if(m.id_comision_cuenta){n.id_comision_cuenta=m.id_comision_cuenta}i.periodos.push(n)});if(k.value){var j=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:g,secureRequest:true,requestUrl:"comisiones/abm/cargarPeriodo",requestType:"POST",requestData:i});j.onSuccess=function(){f()};j.request()}};Core.Business.DistribucionComisiones.InitGridPeriodos=function(a,b,c){b.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,noRecordsText:"No existen períodos registrados",columns:[{field:"fecha_desde",width:"35%",title:"Fecha Desde",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{field:"fecha_hasta",width:"35%",title:"Fecha Hasta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{field:"",title:" ",width:"30%",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(f,g,h){var d=$('<button type="button" class="btn btn-primary" style="margin: 0px 8px 0px 0px;">Distribuir</button>').appendTo(f);d.on("click",function(){if(g.id_comision_cuenta){new Core.Business.DistribucionComisiones.DistribucionPeriodo({id_comision_cuenta:g.id_comision_cuenta,onLoad:function(){a.hide()},onClosed:function(){a.show()},overlayElement:d}).show()}else{new Core.Controls.Dialog("Aviso","Debe confirmar los períodos para continuar",{displayButtons:{close:true,accept:false}}).show()}});var e=$('<button type="button" class="btn btn-primary" style="margin: 0px 0px 0px 8px;">Eliminar</button>').appendTo(f);e.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar el período?",{onAccepted:function(){if(g.id_comision_cuenta){var i=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:e,secureRequest:true,requestUrl:"comisiones/abm/borrarPeriodo",requestType:"POST",requestData:{id_comision_cuenta:g.id_comision_cuenta}});i.onSuccess=function(j){c(g)};i.request()}else{c(g)}}}).show()})}}]})};Core.Business.DistribucionComisiones.DistribucionPeriodo=function(b){var a=this;a.container=$(".div-container-distribucion-periodo");a.id_comision_cuenta=null;a.onLoad=function(){};a.onClosed=function(){};a.overlayElement=null;$.extend(true,a,b);a.show=function(){a.gridNiveles=a.container.find(".div-niveles");a.gridNiveles.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,noRecordsText:"No existen niveles registrados",columns:[{field:"nivel",width:"10%",title:"Nivel",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{field:"nivelanterior",width:"10%",title:"Nivel Anterior",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{field:"",title:" ",width:40,headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(d,e,f){if(e.id_nivel_anterior&&e.nivel>1){var c=$('<button type="button" class="btn-sm balanz-button"><span class="glyphicon glyphicon-search"></span></button>').appendTo(d);c.on("click",function(){a.gridNiveles.swidget().dataSource.data.forEach(function(h,g){if(e.id_nivel_anterior==h.id_comision_nivel){var i=$.grep(a.gridNiveles.swidget().contentTable[0].rows,function(j,k){return k==g})[0];if(i){Core.Functions.Highlight($(i),{cssClass:"animation-lightgreen-pulse"})}}})})}}},{field:"distribucion",width:"50%",title:"Distribución",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{field:"",title:" ",width:"30%",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(e,f,g){var c=$('<button type="button" class="btn btn-primary" style="margin: 0px 8px 0px 0px;">Editar</button>').appendTo(e);c.on("click",function(){new Core.Business.DistribucionComisiones.EditarNivel({id_comision_nivel:f.id_comision_nivel,id_comision_cuenta:a.id_comision_cuenta,onLoad:function(){a.container.hide()},onClosed:function(){a.loadNiveles();a.container.show()},overlayElement:c}).show()});var d=$('<button type="button" class="btn btn-primary" style="margin: 0px 0px 0px 8px;">Eliminar</button>').appendTo(e);d.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar el nivel?",{onAccepted:function(){var h=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:d,secureRequest:true,requestUrl:"comisiones/abm/borrarNivel",requestType:"POST",requestData:{id_comision_nivel:f.id_comision_nivel}});h.onSuccess=function(i){a.gridNiveles.swidget().dataSource.data.remove(f);a.refreshNiveles(a.gridNiveles.swidget().dataSource.data)};h.request()}}).show()})}}]});a.btnVerGrafico=a.container.find(".btn-ver-grafico");a.btnVerGrafico.unbind("click");a.btnVerGrafico.on("click",function(){window.open((Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"download/reportes/descargar/comisiones/getEsquema/"+a.id_comision_cuenta),"_blank")});a.btnVolver=a.container.find(".btn-volver");a.btnVolver.unbind("click");a.btnVolver.on("click",function(){a.destroy()});a.loadNiveles(a.overlayElement,function(){a.container.show();a.onLoad()})};a.loadNiveles=function(d,c){var e=new Core.Ajax.ServerRequest({overlayElement:d,showOverlay:true,secureRequest:true,requestUrl:"comisiones/abm/obtenerNiveles/"+a.id_comision_cuenta,requestType:"GET"});e.onSuccess=function(f){a.refreshNiveles((f.respuesta?f.respuesta:[]));if(c){c()}};e.request()};a.refreshNiveles=function(d){a.niveles=d;var c=a.gridNiveles.swidget().initialOptions;c.dataSource.data=a.niveles;a.gridNiveles.swidget().refresh(c)};a.destroy=function(){a.gridNiveles.swidget().destroy();a.container.hide();a.onClosed()}};Core.Business.DistribucionComisiones.EditarNivel=function(b){var a=this;a.container=$(".div-container-editar-nivel");a.id_comision_nivel=null;a.id_comision_cuenta=null;a.onLoad=function(){};a.onClosed=function(){};a.overlayElement=null;a.pooles=[];a.entidades=[];$.extend(true,a,b);a.show=function(){var c=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,showOverlay:true,secureRequest:true,requestUrl:"comisiones/abm/obtenerEntidades",requestType:"GET"});c.onSuccess=function(d){var e=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,showOverlay:true,secureRequest:true,requestUrl:"comisiones/abm/obtenerPooles",requestType:"GET"});e.onSuccess=function(f){a.entidades=d.entidades?d.entidades:[];a.pooles=f.entidades?f.entidades:[];a.personaSeleccionada=null;a.ddlEntidades=a.container.find(".dropdown-entidades");a.ddlEntidades.shieldDropDown({dataSource:{data:a.entidades},valueTemplate:"{id_entidad}",textTemplate:"{descripcion}",value:"",events:{select:function(g){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.ddlEntidades,false);a.divPooles=a.container.find(".div-pooles");a.ddlPooles=a.container.find(".dropdown-pooles");a.ddlPooles.shieldDropDown({dataSource:{data:a.pooles},valueTemplate:"{id_pool}",textTemplate:"{descripcion}",value:""});Core.Functions.Validations.toggleValidation(a.ddlPooles,false);a.btnEditarPooles=a.container.find(".btn-editar-pooles");a.btnEditarPooles.unbind("click");a.btnEditarPooles.on("click",function(){new Core.Business.DistribucionComisiones.Pooles({pooles:a.pooles,entidades:a.entidades,onLoad:function(){a.container.hide()},onClosed:function(h){a.pooles=h;var g=a.ddlPooles.swidget().initialOptions;g.dataSource.data=a.pooles;g.value=a.ddlPooles.swidget().value();a.ddlPooles.swidget().refresh(g);a.container.show()}}).show()});a.divBuscarPersona=a.container.find(".div-buscar-persona");a.txtDocumento=a.container.find(".textbox-documento");a.txtDocumento.shieldNumericTextBox({min:0,max:999999999,step:1,value:""});Core.Functions.Validations.toggleValidation(a.txtDocumento,false);a.btnBuscarDocumento=a.container.find(".btn-buscar-documento");a.btnBuscarDocumento.unbind("click");a.btnBuscarDocumento.on("click",function(){a.personaSeleccionada=null;a.lblDescripcionPersona.text("No se ha seleccionado ninguna persona");Core.Functions.Validations.toggleValidation(a.txtDocumento,false);if(!a.txtDocumento.swidget().value()){Core.Functions.Validations.toggleValidation(a.txtDocumento,true);return}var g=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.btnBuscarDocumento,secureRequest:true,requestUrl:"comisiones/abm/obtenerPersona/"+a.txtDocumento.swidget().value(),requestType:"GET"});g.onSuccess=function(h){if(h.entidades&&h.entidades[0]){a.personaSeleccionada=h.entidades[0];a.lblDescripcionPersona.text(a.personaSeleccionada.nyap)}};g.request()});a.lblDescripcionPersona=a.container.find(".lbl-descripcion-persona");a.lblDescripcionPersona.text("No se ha seleccionado ninguna persona");a.btnAgregar=a.container.find(".btn-agregar");a.btnAgregar.unbind("click");a.btnAgregar.on("click",function(){Core.Functions.Validations.toggleValidation(a.ddlEntidades,false);Core.Functions.Validations.toggleValidation(a.ddlPooles,false);Core.Functions.Validations.toggleValidation(a.txtDocumento,false);if(!a.ddlEntidades.swidget().selectedItem()){Core.Functions.Validations.toggleValidation(a.ddlEntidades,true);return}var g={id_entidad:a.ddlEntidades.swidget().selectedItem().id_entidad,id_fuente_entidad:-1,descripcion:a.ddlEntidades.swidget().selectedItem().descripcion,comision:1};if(a.ddlEntidades.swidget().selectedItem().id_entidad==9){if(!a.ddlPooles.swidget().selectedItem()){Core.Functions.Validations.toggleValidation(a.ddlPooles,true);return}else{g.descripcion+=(" - "+a.ddlPooles.swidget().selectedItem().descripcion);g.id_fuente_entidad=a.ddlPooles.swidget().selectedItem().id_pool}}if(a.ddlEntidades.swidget().selectedItem().id_entidad==8){if(!a.personaSeleccionada){Core.Functions.Validations.toggleValidation(a.txtDocumento,true);return}else{g.descripcion+=(" - "+a.personaSeleccionada.nyap);g.id_fuente_entidad=a.personaSeleccionada.idpersona}}if($.grep(a.distribuciones,function(i,h){return i.id_entidad==g.id_entidad&&i.id_fuente_entidad==g.id_fuente_entidad})[0]){Core.Functions.Validations.toggleValidation(a.ddlEntidades,true);if(g.id_entidad==8){Core.Functions.Validations.toggleValidation(a.txtDocumento,true)}if(g.id_entidad==9){Core.Functions.Validations.toggleValidation(a.ddlPooles,true)}new Core.Controls.Dialog("Aviso","Ya existe una distribución para los datos seleccionados.",{displayButtons:{close:true,accept:false}}).show();return}a.distribuciones.push(g);a.refreshDistribuciones(a.distribuciones)});a.gridDistribuciones=a.container.find(".div-distribuciones");a.gridDistribuciones.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,noRecordsText:"No existen distribuciones registrados",columns:[{field:"descripcion",width:"30%",title:"Entidad",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{field:"",title:"Comisión",width:"30%",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(g,h,i){var j=$('<input type="text" class="form-control sui-input" />').appendTo(g);new Core.Controls.DecimalPicker(j,{maxDecimalDigitCount:2,showThousandsSeparator:true,defaultValue:(h.comision)?h.comision:"",onChange:function(){h.comision=Core.Functions.Decimal.parseFloat(j.val());a.refreshDistribuciones(a.gridDistribuciones.swidget().dataSource.data)}})}},{field:"",title:" ",width:"40%",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(i,j,k){var g=$('<button type="button" class="btn btn-primary" style="margin: 0px 8px 0px 0px;">Crear Nuevo Nivel</button>').appendTo(i);g.on("click",function(){if(j.id_comision_detalle){var l=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:g,secureRequest:true,requestUrl:"comisiones/abm/cargarNivel",requestType:"POST",requestData:{id_comision_cuenta:a.id_comision_cuenta,id_comision_detalle_niv_ant:j.id_comision_detalle}});l.onSuccess=function(m){new Core.Controls.Dialog("Aviso","Nivel: "+m.nivel+" creado correctamente",{displayButtons:{close:true,accept:false}}).show()};l.request()}else{new Core.Controls.Dialog("Aviso","Debe confirmar los detalles para continuar",{displayButtons:{close:true,accept:false}}).show()}});var h=$('<button type="button" class="btn btn-primary" style="margin: 0px 0px 0px 8px;">Eliminar</button>').appendTo(i);h.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar la distribución?",{onAccepted:function(){if(j.id_comision_detalle){var l=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:h,secureRequest:true,requestUrl:"comisiones/abm/borrarDetalles",requestType:"POST",requestData:{id_detalle:j.id_comision_detalle}});l.onSuccess=function(m){a.gridDistribuciones.swidget().dataSource.data.remove(j);a.refreshDistribuciones(a.gridDistribuciones.swidget().dataSource.data)};l.request()}else{a.gridDistribuciones.swidget().dataSource.data.remove(j);a.refreshDistribuciones(a.gridDistribuciones.swidget().dataSource.data)}}}).show()})}}]});a.btnConfirmar=a.container.find(".btn-confirmar");a.btnConfirmar.unbind("click");a.btnConfirmar.on("click",function(){var j={value:true};var i=0;var g={};g.id_nivel=a.id_comision_nivel;g.distribuciones=[];a.distribuciones.forEach(function(k,m){var l={};l.id_entidad=k.id_entidad;l.id_fuente_entidad=k.id_fuente_entidad;l.comision=k.comision;if(k.id_comision_detalle){l.id_comision_detalle=k.id_comision_detalle}if(l.comision<0.1){j.value=false}i=Core.Functions.Decimal.parseFloat((i+l.comision).toFixed(2));g.distribuciones.push(k)});if(j.value&&i==100){var h=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.btnConfirmar,secureRequest:true,requestUrl:"comisiones/abm/cargarDetalles",requestType:"POST",requestData:g});h.onSuccess=function(){a.loadDistribuciones()};h.request()}else{new Core.Controls.Dialog("Aviso","Revise las comisiones ingresadas. Las mismas deben ser mayor o igual a 0.1 y deben sumar 100.",{displayButtons:{close:true,accept:false}}).show()}});a.btnVolver=a.container.find(".btn-volver");a.btnVolver.unbind("click");a.btnVolver.on("click",function(){a.destroy()});a.setControls();a.loadDistribuciones(a.overlayElement,function(){a.container.show();a.onLoad()})};e.request()};c.request()};a.setControls=function(){a.divBuscarPersona.hide();a.divPooles.hide();if(a.ddlEntidades.swidget().selectedItem().id_entidad==8){a.divBuscarPersona.show()}else{if(a.ddlEntidades.swidget().selectedItem().id_entidad==9){a.divPooles.show()}}};a.loadDistribuciones=function(d,c){var e=new Core.Ajax.ServerRequest({overlayElement:d,showOverlay:true,secureRequest:true,requestUrl:"comisiones/abm/obtenerDetalles/"+a.id_comision_nivel,requestType:"GET"});e.onSuccess=function(f){a.refreshDistribuciones((f.respuesta?f.respuesta:[]));if(c){c()}};e.request()};a.refreshDistribuciones=function(c){a.distribuciones=c;var d=a.gridDistribuciones.swidget().initialOptions;d.dataSource.data=a.distribuciones;a.gridDistribuciones.swidget().refresh(d)};a.destroy=function(){a.ddlEntidades.swidget().destroy();a.ddlPooles.swidget().destroy();a.txtDocumento.swidget().destroy();a.gridDistribuciones.swidget().destroy();a.container.hide();a.onClosed()}};Core.Business.DistribucionComisiones.AsesoresProductores.PeriodosProductor=function(b){var a=this;a.container=$(".div-container-periodos-productor");a.periodosProductor=null;a.onLoad=function(){};a.onClosed=function(){};$.extend(true,a,b);a.show=function(){a.txtMesesPeriodo=a.container.find(".textbox-meses-periodo");a.txtMesesPeriodo.shieldNumericTextBox({min:0,max:999999999,step:1,value:a.periodosProductor.Productor[0].meses_periodo?a.periodosProductor.Productor[0].meses_periodo:""});Core.Functions.Validations.toggleValidation(a.txtMesesPeriodo,false);a.txtFechaInicio=a.container.find(".date-picker-fecha-inicio");a.txtFechaInicio.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],enabled:true,value:a.getDate(a.periodosProductor.Productor[0].fecha_inicio)});Core.Functions.Validations.toggleValidation(a.txtFechaInicio,false);a.btnNuevoPorcentaje=a.container.find(".btn-nuevo-porcentaje");a.btnNuevoPorcentaje.unbind("click");a.btnNuevoPorcentaje.on("click",function(){new Core.Business.DistribucionComisiones.AsesoresProductores.NuevoPorcentaje({onConfirm:function(c){a.porcentajes.push(c);a.refreshPorcentajes(a.porcentajes)}}).show()});a.gridPorcentajes=a.container.find(".div-porcentajes");a.gridPorcentajes.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,noRecordsText:"No existen porcentajes registrados",columns:[{field:"porcentaje",width:"25%",title:"Porcentaje",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNuleableNumber},{field:"monto_desde",width:"25%",title:"Monto Desde",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNuleableNumber},{field:"monto_hasta",width:"25%",title:"Monto Hasta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNuleableNumber},{field:"",title:" ",width:"25%",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(d,e,f){var c=$('<button type="button" class="btn btn-primary" style="margin: 0px 8px 0px 0px;">Eliminar</button>').appendTo(d);c.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar el porcentaje?",{onAccepted:function(){a.gridPorcentajes.swidget().dataSource.data.remove(e);a.refreshPorcentajes(a.gridPorcentajes.swidget().dataSource.data)}}).show()})}}]});a.btnVolver=a.container.find(".btn-volver");a.btnVolver.unbind("click");a.btnVolver.on("click",function(){a.destroy()});a.btnConfirmar=a.container.find(".btn-confirmar");a.btnConfirmar.unbind("click");a.btnConfirmar.on("click",function(){var e={value:true};var c={};c.idproductor=a.periodosProductor.Productor[0].idproductor;c.meses_periodo=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtMesesPeriodo,e));c.fecha_inicio=Core.Functions.Date.getDisplayDateWithSeparator(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaInicio,e),"-");c.Porcentajes=[];a.porcentajes.forEach(function(g,f){var h={};h.monto_desde=g.monto_desde;h.monto_hasta=g.monto_hasta;h.porcentaje=g.porcentaje;c.Porcentajes.push(h)});if(e.value){var d=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.btnConfirmar,secureRequest:true,requestUrl:"comisiones/abm/cargarProductor",requestType:"POST",requestData:c});d.onSuccess=function(){new Core.Controls.Dialog("Aviso","La carga se ha realizado exitosamente.",{displayButtons:{close:true,accept:false}}).show();a.destroy()};d.request()}});a.refreshPorcentajes(a.periodosProductor.Porcentajes);a.container.show();a.onLoad()};a.refreshPorcentajes=function(d){a.porcentajes=d?d:[];var c=a.gridPorcentajes.swidget().initialOptions;c.dataSource.data=a.porcentajes;a.gridPorcentajes.swidget().refresh(c)};a.getDate=function(c){if(!c){return new Date()}var d=c.substr(8,2);var e=c.substr(5,2);var g=c.substr(0,4);var f=new Date();f.setDate(1);f.setYear(g);f.setMonth(e-1);f.setDate(d);return f};a.destroy=function(){a.txtMesesPeriodo.swidget().destroy();a.txtFechaInicio.swidget().destroy();a.gridPorcentajes.swidget().destroy();a.container.hide();a.onClosed()}};Core.Business.DistribucionComisiones.AsesoresProductores.NuevoPorcentaje=function(b){var a=this;a.divModal=$(".div-nuevo-porcentaje");a.onConfirm=function(c){};$.extend(true,a,b);a.decimalCount=2;a.show=function(){a.txtPorcentaje=a.divModal.find(".textbox-porcentaje");new Core.Controls.DecimalPicker(a.txtPorcentaje,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:""});Core.Functions.Validations.toggleValidation(a.txtPorcentaje,false);a.txtMontoDesde=a.divModal.find(".textbox-monto-desde");a.txtMontoDesde.removeAttr("disabled");new Core.Controls.DecimalPicker(a.txtMontoDesde,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:""});Core.Functions.Validations.toggleValidation(a.txtMontoDesde,false);a.chkMontoDesdeSinMonto=a.divModal.find(".checkbox-monto-desde-sin-monto");a.chkMontoDesdeSinMonto.shieldCheckBox({label:"Sin Monto",checked:false,events:{click:function(c){a.txtMontoDesde.removeAttr("disabled");if(a.chkMontoDesdeSinMonto.swidget().checked()){a.txtMontoDesde.attr("disabled","disabled")}}}});a.chkMontoDesdeSinMonto.swidget().checked(false);Core.Functions.Validations.toggleValidation(a.chkMontoDesdeSinMonto,false);a.txtMontoHasta=a.divModal.find(".textbox-monto-hasta");a.txtMontoHasta.removeAttr("disabled");new Core.Controls.DecimalPicker(a.txtMontoHasta,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:""});Core.Functions.Validations.toggleValidation(a.txtMontoHasta,false);a.chkMontoHastaSinMonto=a.divModal.find(".checkbox-monto-hasta-sin-monto");a.chkMontoHastaSinMonto.shieldCheckBox({label:"Sin Monto",checked:false,events:{click:function(c){a.txtMontoHasta.removeAttr("disabled");if(a.chkMontoHastaSinMonto.swidget().checked()){a.txtMontoHasta.attr("disabled","disabled")}}}});a.chkMontoHastaSinMonto.swidget().checked(false);Core.Functions.Validations.toggleValidation(a.chkMontoHastaSinMonto,false);a.btnConfirm=a.divModal.find(".btn-confirmar");a.btnConfirm.unbind("click");a.btnConfirm.click(function(){var d={value:true};var c={};c.porcentaje=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtPorcentaje,d));c.monto_desde=a.chkMontoDesdeSinMonto.swidget().checked()?-1:Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtMontoDesde,d));c.monto_hasta=a.chkMontoHastaSinMonto.swidget().checked()?-1:Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtMontoHasta,d));if(d.value){a.onConfirm(c);a.divModal.modal("hide")}});a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.divModal.modal({show:true})};a.destroy=function(){a.chkMontoDesdeSinMonto.swidget().destroy();a.chkMontoHastaSinMonto.swidget().destroy()}};Core.Business.DistribucionComisiones.Pooles=function(b){var a=this;a.container=$(".div-container-pooles");a.onLoad=function(){};a.onClosed=function(){};a.pooles=null;a.entidades=null;$.extend(true,a,b);a.show=function(){a.btnNuevoPool=a.container.find(".btn-nuevo-pool");a.btnNuevoPool.unbind("click");a.btnNuevoPool.on("click",function(){new Core.Business.DistribucionComisiones.EditarPool({entidades:a.entidades,pooles:a.pooles,overlayElement:a.btnNuevoPool,onLoad:function(){a.container.hide()},onClosed:function(c){a.getPooles();a.container.show()}}).show()});a.gridPooles=a.container.find(".div-pooles");a.gridPooles.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,noRecordsText:"No existen pooles registrados",columns:[{field:"descripcion",width:"25%",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{field:"descripcion_dist",width:"50%",title:"Distribución",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{field:"",title:" ",width:"25%",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,g){var c=$('<button type="button" class="btn btn-primary" style="margin: 0px 8px 0px 0px;">Editar</button>').appendTo(e);c.on("click",function(){new Core.Business.DistribucionComisiones.EditarPool({id_pool:f.id_pool,entidades:a.entidades,pooles:a.pooles,overlayElement:c,onLoad:function(){a.container.hide()},onClosed:function(h){a.getPooles();a.container.show()}}).show()});var d=$('<button type="button" class="btn btn-primary" style="margin: 0px 0px 0px 8px;">Eliminar</button>').appendTo(e);d.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar el pool?",{onAccepted:function(){var h=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:d,secureRequest:true,requestUrl:"comisiones/abm/borrarPool",requestType:"POST",requestData:{id_pool:f.id_pool}});h.onSuccess=function(i){a.gridPooles.swidget().dataSource.data.remove(f);a.refreshPooles(a.gridPooles.swidget().dataSource.data)};h.request()}}).show()})}}]});a.btnVolver=a.container.find(".btn-volver");a.btnVolver.unbind("click");a.btnVolver.on("click",function(){a.destroy()});a.refreshPooles((a.pooles?a.pooles:[]));a.container.show();a.onLoad()};a.getPooles=function(){var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"comisiones/abm/obtenerPooles",requestType:"GET"});c.onSuccess=function(d){a.pooles=d.entidades?d.entidades:[];a.refreshPooles(a.pooles)};c.request()};a.refreshPooles=function(d){a.pooles=d;var c=a.gridPooles.swidget().initialOptions;c.dataSource.data=a.pooles;a.gridPooles.swidget().refresh(c)};a.destroy=function(){a.gridPooles.swidget().destroy();a.container.hide();a.onClosed(a.pooles)}};Core.Business.DistribucionComisiones.EditarPool=function(b){var a=this;a.container=$(".div-container-editar-pool");a.onLoad=function(){};a.onClosed=function(){};a.overlayElement=null;a.pooles=[];a.entidades=[];a.id_pool=null;$.extend(true,a,b);a.show=function(){a.personaSeleccionada=null;a.txtDescripcion=a.container.find(".textbox-descripcion");a.txtDescripcion.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtDescripcion,false);a.chkSinDistribucion=a.container.find(".checkbox-sin-distribucion");a.chkSinDistribucion.shieldCheckBox({label:"Sin Distribución",checked:false,events:{click:function(c){a.setControls()}}});a.chkSinDistribucion.swidget().checked(false);Core.Functions.Validations.toggleValidation(a.chkSinDistribucion,false);a.divControlesDistribucion=a.container.find(".div-controls-distribucion");a.divControlesDistribucion.show();a.ddlEntidades=a.container.find(".dropdown-entidades");a.ddlEntidades.shieldDropDown({dataSource:{data:a.entidades},valueTemplate:"{id_entidad}",textTemplate:"{descripcion}",value:"",events:{select:function(c){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.ddlEntidades,false);a.divPooles=a.container.find(".div-pooles");a.ddlPooles=a.container.find(".dropdown-pooles");a.ddlPooles.shieldDropDown({dataSource:{data:$.grep(a.pooles,function(d,c){return !a.id_pool||a.id_pool!=d.id_pool})},valueTemplate:"{id_pool}",textTemplate:"{descripcion}",value:""});Core.Functions.Validations.toggleValidation(a.ddlPooles,false);a.divBuscarPersona=a.container.find(".div-buscar-persona");a.txtDocumento=a.container.find(".textbox-documento");a.txtDocumento.shieldNumericTextBox({min:0,max:999999999,step:1,value:""});Core.Functions.Validations.toggleValidation(a.txtDocumento,false);a.btnBuscarDocumento=a.container.find(".btn-buscar-documento");a.btnBuscarDocumento.unbind("click");a.btnBuscarDocumento.on("click",function(){a.personaSeleccionada=null;a.lblDescripcionPersona.text("No se ha seleccionado ninguna persona");Core.Functions.Validations.toggleValidation(a.txtDocumento,false);if(!a.txtDocumento.swidget().value()){Core.Functions.Validations.toggleValidation(a.txtDocumento,true);return}var c=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.btnBuscarDocumento,secureRequest:true,requestUrl:"comisiones/abm/obtenerPersona/"+a.txtDocumento.swidget().value(),requestType:"GET"});c.onSuccess=function(d){if(d.entidades&&d.entidades[0]){a.personaSeleccionada=d.entidades[0];a.lblDescripcionPersona.text(a.personaSeleccionada.nyap)}};c.request()});a.lblDescripcionPersona=a.container.find(".lbl-descripcion-persona");a.lblDescripcionPersona.text("No se ha seleccionado ninguna persona");a.btnAgregar=a.container.find(".btn-agregar");a.btnAgregar.unbind("click");a.btnAgregar.on("click",function(){Core.Functions.Validations.toggleValidation(a.ddlEntidades,false);Core.Functions.Validations.toggleValidation(a.ddlPooles,false);Core.Functions.Validations.toggleValidation(a.txtDocumento,false);if(!a.ddlEntidades.swidget().selectedItem()){Core.Functions.Validations.toggleValidation(a.ddlEntidades,true);return}var c={id_entidad:a.ddlEntidades.swidget().selectedItem().id_entidad,id_fuente_entidad:-1,descripcion:a.ddlEntidades.swidget().selectedItem().descripcion,comision:1};if(a.ddlEntidades.swidget().selectedItem().id_entidad==9){if(!a.ddlPooles.swidget().selectedItem()){Core.Functions.Validations.toggleValidation(a.ddlPooles,true);return}else{c.descripcion+=(" - "+a.ddlPooles.swidget().selectedItem().descripcion);c.id_fuente_entidad=a.ddlPooles.swidget().selectedItem().id_pool}}if(a.ddlEntidades.swidget().selectedItem().id_entidad==8){if(!a.personaSeleccionada){Core.Functions.Validations.toggleValidation(a.txtDocumento,true);return}else{c.descripcion+=(" - "+a.personaSeleccionada.nyap);c.id_fuente_entidad=a.personaSeleccionada.idpersona}}if($.grep(a.distribuciones,function(e,d){return e.id_entidad==c.id_entidad&&e.id_fuente_entidad==c.id_fuente_entidad})[0]){Core.Functions.Validations.toggleValidation(a.ddlEntidades,true);if(c.id_entidad==8){Core.Functions.Validations.toggleValidation(a.txtDocumento,true)}if(c.id_entidad==9){Core.Functions.Validations.toggleValidation(a.ddlPooles,true)}new Core.Controls.Dialog("Aviso","Ya existe una distribución para los datos seleccionados.",{displayButtons:{close:true,accept:false}}).show();return}a.distribuciones.push(c);a.refreshDistribuciones(a.distribuciones)});a.gridDistribuciones=a.container.find(".div-distribuciones");a.gridDistribuciones.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,noRecordsText:"No existen distribuciones registrados",columns:[{field:"descripcion",width:"40%",title:"Entidad",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{field:"",title:"Comisión",width:"40%",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(c,d,e){var f=$('<input type="text" class="form-control sui-input" />').appendTo(c);new Core.Controls.DecimalPicker(f,{maxDecimalDigitCount:2,showThousandsSeparator:true,defaultValue:(d.comision)?d.comision:"",onChange:function(){d.comision=Core.Functions.Decimal.parseFloat(f.val());a.refreshDistribuciones(a.gridDistribuciones.swidget().dataSource.data)}})}},{field:"",title:" ",width:"20%",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(d,e,f){var c=$('<button type="button" class="btn btn-primary" style="margin: 0px 0px 0px 8px;">Eliminar</button>').appendTo(d);c.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar la distribución?",{onAccepted:function(){a.gridDistribuciones.swidget().dataSource.data.remove(e);a.refreshDistribuciones(a.gridDistribuciones.swidget().dataSource.data)}}).show()})}}]});a.btnConfirmar=a.container.find(".btn-confirmar");a.btnConfirmar.unbind("click");a.btnConfirmar.on("click",function(){var g={value:true};var d={};d.id_pool=a.id_pool?a.id_pool:-1;d.descripcion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtDescripcion,g);d.distribuido=a.chkSinDistribucion.swidget().checked()?0:1;if(d.distribuido){var f=0;var c=false;d.distribuciones=[];a.distribuciones.forEach(function(h,k){var j={};j.id_entidad=h.id_entidad;j.id_fuente_entidad=h.id_fuente_entidad;j.comision=h.comision;if(j.comision<0.1){c=true}f=Core.Functions.Decimal.parseFloat((f+j.comision).toFixed(2));d.distribuciones.push(h)});if(c||f!=100){new Core.Controls.Dialog("Aviso","Revise las comisiones ingresadas. Las mismas deben ser mayor o igual a 0.1 y deben sumar 100.",{displayButtons:{close:true,accept:false}}).show();return}}if(!g.value){return}var e=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.btnConfirmar,secureRequest:true,requestUrl:"comisiones/abm/cargarPool",requestType:"POST",requestData:d});e.onSuccess=function(){new Core.Controls.Dialog("Aviso","El pool se ha guardado correctamente.",{displayButtons:{close:true,accept:false}}).show();a.destroy()};e.request()});a.btnVolver=a.container.find(".btn-volver");a.btnVolver.unbind("click");a.btnVolver.on("click",function(){a.destroy()});a.loadPool(a.overlayElement,function(){a.setControls();a.container.show();a.onLoad()})};a.setControls=function(){a.divControlesDistribucion.show();if(a.chkSinDistribucion.swidget().checked()){a.divControlesDistribucion.hide()}a.divBuscarPersona.hide();a.divPooles.hide();if(a.ddlEntidades.swidget().selectedItem().id_entidad==8){a.divBuscarPersona.show()}else{if(a.ddlEntidades.swidget().selectedItem().id_entidad==9){a.divPooles.show()}}};a.loadPool=function(d,c){if(a.id_pool){var e=new Core.Ajax.ServerRequest({overlayElement:d,showOverlay:true,secureRequest:true,requestUrl:"comisiones/abm/obtenerPool/"+a.id_pool,requestType:"GET"});e.onSuccess=function(f){if(f.pool[0]){a.txtDescripcion.swidget().value(f.pool[0].descripcion?f.pool[0].descripcion:"");a.chkSinDistribucion.swidget().checked(f.pool[0].distribuido?false:true)}a.refreshDistribuciones((f.pool_distribucion?f.pool_distribucion:[]));if(c){c()}};e.request()}else{a.refreshDistribuciones([]);if(c){c()}}};a.refreshDistribuciones=function(c){a.distribuciones=c;var d=a.gridDistribuciones.swidget().initialOptions;d.dataSource.data=a.distribuciones;a.gridDistribuciones.swidget().refresh(d)};a.destroy=function(){a.txtDescripcion.swidget().destroy();a.chkSinDistribucion.swidget().destroy();a.ddlEntidades.swidget().destroy();a.ddlPooles.swidget().destroy();a.txtDocumento.swidget().destroy();a.gridDistribuciones.swidget().destroy();a.container.hide();a.onClosed()}};Core.Business.DistribucionComisiones.DescargarReporte=function(b){var a=this;a.divModal=$(".div-descargar-reporte");$.extend(true,a,b);a.show=function(){var c=new Date();c.setDate(1);a.txtFechaDesde=a.divModal.find(".date-picker-fecha-desde");a.txtFechaDesde.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:c});Core.Functions.Validations.toggleValidation(a.txtFechaDesde,false);a.txtFechaHasta=a.divModal.find(".date-picker-fecha-hasta");a.txtFechaHasta.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date()});Core.Functions.Validations.toggleValidation(a.txtFechaHasta,false);a.chkPropias=a.divModal.find(".checkbox-propias");a.chkPropias.shieldCheckBox({label:"Propias"});Core.Functions.Validations.toggleValidation(a.chkPropias,false);a.btnConfirm=a.divModal.find(".btn-confirmar");a.btnConfirm.unbind("click");a.btnConfirm.click(function(){var g={value:true};var e=Core.Functions.Date.getDisplayDateWithSeparator(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaDesde,g),"-");e+=("/"+Core.Functions.Date.getDisplayDateWithSeparator(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaHasta,g),"-"));e+=("/"+(a.chkPropias.swidget().checked()?"1":"0"));if(g.value){function f(o){var n=new Blob([o.response],{type:o.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(n);return}var h=window.URL.createObjectURL(n);var m=document.createElement("a");m.href=h;var k=o.getResponseHeader("Content-Disposition").split("; ");var j="filename=file.DAT";for(var l=0;l<k.length;l++){if(k[l].indexOf("filename")>=0){j=k[l]}}m.download=j.split("=")[1];m.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(h)}var d=new XMLHttpRequest();d.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"download/reportes/descargar/comisiones/"+e,true);d.responseType="blob";d.setRequestHeader("Authorization",Core.Objects.Context.Token);d.onload=function(h){if(d.status==200){f(d)}else{var i=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga del comprobante.</p>",{displayButtons:{close:true,accept:false}});i.show()}};d.send();a.divModal.modal("hide")}});a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.divModal.modal({show:true})};a.destroy=function(){a.txtFechaDesde.swidget().destroy();a.txtFechaHasta.swidget().destroy();a.chkPropias.swidget().destroy()}};Core.Business.EjecutarOrdenPrecargada=new function(){var a=this;a.id="ejecutarOrdenPrecargada";a.init=function(b,c,d){if(d){if(d.idCuenta&&d.idOrdenPrecargada){var e=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:("precargar/obtener/"+d.idCuenta+"/"+d.idOrdenPrecargada),requestType:"GET"});e.onSuccess=function(f){if(f&&f.orden&&f.orden[0]){if(Core.Functions.Operar.enabledOperar(f.orden[0].panel,d.idCuenta,c)){if(f.orden[0].ContinuarAutomaticamente){if(f.orden[0].idLicitacion){Core.Functions.Operar.srOperarLicitacion(a.getOperarRequestData(f.orden[0]),function(){},d.idCuenta,c)}else{Core.Functions.Operar.srOperarEspecies(a.getOperarRequestData(f.orden[0]),function(){},d.idCuenta,c,false,true)}}else{Core.Functions.Operar.callOperar(f.orden[0].panel,f.orden[0].idTipoOperacion,d.idCuenta,c,{ordenPrecargada:f.orden[0]})}}else{a.showError(d)}}else{a.showError(d)}};e.request()}else{a.showError(d)}}};a.getOperarRequestData=function(b){var c={};if(b.idCuenta!=undefined){c.idCuenta=b.idCuenta}if(b.FechaVencimiento!=undefined){c.FechaVencimiento=b.FechaVencimiento}if(b.idTipoOperacion!=undefined){c.idTipoOperacion=b.idTipoOperacion}if(b.idLicitacion!=undefined){c.idLicitacion=b.idLicitacion}if(b.Ticker!=undefined){c.ticker=b.Ticker}if(b.Plazo!=undefined){c.Plazo=b.Plazo}if(b.idMoneda!=undefined){c.idMoneda=b.idMoneda}if(b.Cantidad!=undefined){c.Cantidad=b.Cantidad}if(b.Monto!=undefined){c.Monto=b.Monto}if(b.PrecioDisparo!=undefined){c.PrecioDisparo=b.PrecioDisparo}if(b.Observaciones!=undefined){c.Observaciones=b.Observaciones}if(b.idOrdenPrecargada!=undefined){c.idOrdenPrecargada=b.idOrdenPrecargada}if(b.OrderType!=undefined){c.OrderType=b.OrderType}if(b.TimeInForce!=undefined){c.TimeInForce=b.TimeInForce}if(b.DisplayQty!=undefined){c.DisplayQty=b.DisplayQty}if(b.ExecInst!=undefined){c.ExecInst=b.ExecInst}if(b.PrecioLimite!=undefined){c.PrecioLimite=b.PrecioLimite}if(b.FechaEjecucion!=undefined){c.FechaEjecucion=b.FechaEjecucion}if(b.MinutosEjecucion!=undefined){c.MinutosEjecucion=b.MinutosEjecucion}if(b.FechaExpiracion!=undefined){c.FechaExpiracion=b.FechaExpiracion}if(b.MinutosExpiracion!=undefined){c.MinutosExpiracion=b.MinutosExpiracion}if(b.EjecutarValidaciones!=undefined){c.EjecutarValidaciones=b.EjecutarValidaciones}if(b.ContinuarAutomaticamente!=undefined){c.ContinuarAutomaticamente=b.ContinuarAutomaticamente}if(b.idTipoNegociacion!=undefined){c.idTipoNegociacion=b.idTipoNegociacion}if(b.ValorNegociacion!=undefined){c.ValorNegociacion=b.ValorNegociacion}if(b.tickerRenovacion!=undefined){c.tickerRenovacion=b.tickerRenovacion}return c};a.showError=function(b){new Core.Controls.Dialog("Aviso",b.MensajeError?b.MensajeError:"La orden no ha podido ser procesada correctamente.",{displayButtons:{close:true,accept:false}}).show()}};Core.Business.eEvolucionPorTipo={Activos:1,Monedas:2,Totales:3};Core.Business.eEvolucionMoneda={Pesos:1,Dolares:2};Core.Business.EvolucionCarteraEnPesos=new function(){var a=this;a.init=function(b,c){Core.Business.EvolucionCartera.init(b,c,Core.Business.eEvolucionMoneda.Pesos)}};Core.Business.EvolucionCarteraEnDolares=new function(){var a=this;a.init=function(b,c){Core.Business.EvolucionCartera.init(b,c,Core.Business.eEvolucionMoneda.Dolares)}};Core.Business.EvolucionCartera=new function(){var a=this;a.id="evolucionDeCartera";a.generalTitle=null;a.pageOptions=null;a.divRendimiento=null;a.divChartRendimiento=null;a.chartRendimiento=null;a.ddlTipoEvolucion=null;a.divValorCuenta=null;a.divGridValorCuenta=null;a.divDateRange=null;a.header=null;a.txtDateFrom=null;a.txtDateTo=null;a.btnDates=null;a.chkStockTypes=null;a.divStockTypes=null;a.divEvolucionPorTipoActivos=null;a.chartEvolucionPorTipoActivos=null;a.divEvolucionPorMonedas=null;a.chartEvolucionPorMonedas=null;a.divEvolucionPorTotales=null;a.chartEvolucionPorTotales=null;a.idMoneda=null;a.resumenData=null;a.rendimientoData=null;a.evolucionData=null;a.eventosData=null;a.init=function(b,c,d){Core.loadPage("evolucion-cartera.html",function(){a.idMoneda=d;document.title="Evolución Cartera";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.generalTitle=$(".general-title");(a.idMoneda==Core.Business.eEvolucionMoneda.Dolares)?a.generalTitle.text("Evolución de Cartera en Dólares"):a.generalTitle.text("Evolución de Cartera en Pesos");a.divRendimiento=$(".div-rendimiento");a.divChartRendimiento=$(".div-chart-rendimiento");a.ddlTipoEvolucion=$(".dropdown-tipo-evolucion");a.divValorCuenta=$(".div-valor-cuenta");a.divGridValorCuenta=$(".div-grid-valor-cuenta");a.divDateRange=$(".div-select-date-range");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.btnDates=$(".amChartsButton, .amChartsButtonSelected");a.chkStockTypes=$(".checkbox-stock-type");for(var f=0;f<a.chkStockTypes.length;f++){var e=$(a.chkStockTypes[f]);e[0].checked=true}a.divStockTypes=$(".div-chk-stock-events-types");a.divEvolucionPorTipoActivos=$(".div-evolucion-por-tipo-activos");a.divEvolucionPorMonedas=$(".div-evolucion-por-monedas");a.divEvolucionPorTotales=$(".div-evolucion-por-totales");a.initDatePickersAndButtons();a.initGrid();a.initAmCharts();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,b,c,a.loadCharts,((a.idMoneda==Core.Business.eEvolucionMoneda.Dolares)?"Core.Business.EvolucionCarteraEnDolares":"Core.Business.EvolucionCarteraEnPesos"))})};a.initDatePickersAndButtons=function(){a.divDateRange.hide();if(a.pageOptions.showEvolucionCartera){a.divDateRange.show()}var c=function(){var d=new Core.Ajax.ServerRequest({overlayElement:a.divGridValorCuenta.parent(),secureRequest:true,requestUrl:"evoluciondecartera/"+encodeURIComponent(a.header.selectedIdAccount),requestType:"GET",requestData:{FechaDesde:Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()),FechaHasta:Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()),idMoneda:a.idMoneda,Tenencia:0,Eventos:0}});d.onSuccess=function(e){a.resumenData=e.resumen;a.rendimientoData=e.rendimiento;a.loadGridValorCuenta();if(a.pageOptions.showEvolucionCartera){a.loadChartRendimiento()}};d.request()};a.btnDates.on("click",function(){a.btnDates.removeClass("amChartsButtonSelected amChartsButton").addClass("amChartsButton");$(this).removeClass("amChartsButton").addClass("amChartsButtonSelected");var g=$(this).val();var f=new Date();f.setHours(0);a.txtDateTo.swidget().value(f);var d=new Date();d.setHours(0);if(g=="YTD"){d.setDate(1);d.setMonth(0)}else{var e=parseInt(g.replace("M",""));d.setMonth(d.getMonth()-e)}a.txtDateFrom.swidget().value(d);c()});var b=new Date();if(a.pageOptions.showEvolucionCartera){b.setMonth(b.getMonth()-3)}else{b.setDate(b.getDate()-7)}a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:b,max:new Date(),events:{change:function(){a.btnDates.removeClass("amChartsButtonSelected amChartsButton").addClass("amChartsButton");c()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(){a.btnDates.removeClass("amChartsButtonSelected amChartsButton").addClass("amChartsButton");c()}}})};a.initGrid=function(){if(!a.pageOptions.showEvolucionCartera){a.divValorCuenta.removeClass("col-md-6");a.divValorCuenta.addClass("col-md-12")}a.divGridValorCuenta.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false})};a.initAmCharts=function(){a.divRendimiento.hide();if(a.pageOptions.showEvolucionCartera){a.divRendimiento.show();a.amchartRendimiento=AmCharts.makeChart(a.divChartRendimiento[0],{type:"serial",categoryField:"Fecha",dataDateFormat:"DD/MM/YYYY",marginRight:20,marginTop:20,fontSize:12,theme:"default",categoryAxis:{parseDates:true,equalSpacing:true},chartCursor:{enabled:true},trendLines:[],graphs:[{columnWidth:0.1,cornerRadiusTop:8,fillAlphas:0.15,id:"AmGraph-1",lineAlpha:2,lineColor:(a.idMoneda==Core.Business.eEvolucionMoneda.Dolares)?"#488348":"#254C79",title:"Rendimiento",fillAlphas:0.25,type:"smoothedLine",valueField:"Rendimiento"}],guides:[],valueAxes:[{id:"ValueAxis-1",title:""}],allLabels:[],balloon:{},titles:[]})}a.chartEvolucionPorTotales=AmCharts.makeChart(a.divEvolucionPorTotales[0],{type:"stock",theme:"light",dataDateFormat:"DD/MM/YYYY",dataSets:[{color:(a.idMoneda==Core.Business.eEvolucionMoneda.Dolares)?"#488348":"#254C79",fieldMappings:[{fromField:"Tenencia",toField:"value"}],categoryField:"Fecha",stockEvents:[],dataProvider:[]}],panels:[{stockGraphs:[{id:"graph1",valueField:"value",type:"line",lineColor:"#FFF000",title:"Evolución de Cartera",fillAlphas:0.25}]}],panelsSettings:{startDuration:1},categoryAxesSettings:{dashLength:10,startOnAxis:true},valueAxesSettings:{dashLength:10,},chartScrollbarSettings:{graph:"graph1",graphType:"line"},chartCursorSettings:{valueBalloonsEnabled:true},categoryAxesSettings:{equalSpacing:true,maxSeries:500},periodSelector:{periods:[{period:"DD",count:10,label:"10 días",},{period:"MM",count:1,label:"1 Mes",},{period:"MM",count:3,label:"3 Meses",selected:true},{period:"YTD",label:"YTD",},{period:"MAX",label:"MAX",}]}});a.chartEvolucionPorMonedas=AmCharts.makeChart(a.divEvolucionPorMonedas[0],{type:"serial",categoryField:"Fecha",dataDateFormat:"DD/MM/YYYY",parseDates:true,startDuration:0.3,startEffect:"easeInSine",autoMarginOffset:40,marginRight:60,marginTop:60,fontSize:12,chartCursor:{enabled:true},chartScrollbar:{enabled:true},categoryAxis:{gridPosition:"start",startOnAxis:true,parseDates:true},trendLines:[],graphs:[{fillAlphas:0.7,id:"AmGraph-2",lineColor:"#8FE0FF",lineAlpha:0,title:"Pesos",valueField:"Pesos"},{fillAlphas:0.7,id:"AmGraph-4",lineColor:"#528566",lineAlpha:0,title:"Dolares",valueField:"Dolares"}],guides:[],valueAxes:[{id:"ValueAxis-1",stackType:"100%",minimum:0,}],allLabels:[],balloon:{},legend:{enabled:true,align:"center"}});a.chartEvolucionPorTipoActivos=AmCharts.makeChart(a.divEvolucionPorTipoActivos[0],{type:"serial",categoryField:"Fecha",dataDateFormat:"DD/MM/YYYY",parseDates:true,startDuration:0.3,startEffect:"easeInSine",autoMarginOffset:40,marginRight:60,marginTop:60,fontSize:12,chartCursor:{enabled:true},chartScrollbar:{enabled:true},categoryAxis:{gridPosition:"start",startOnAxis:true,parseDates:true,equalSpacing:true},trendLines:[],graphs:[{fillAlphas:0.7,id:"AmGraph-1",lineColor:"#8FE0FF",lineAlpha:0,title:"Pesos",valueField:"MonedasPesos"},{fillAlphas:0.7,id:"AmGraph-2",lineColor:"#528566",lineAlpha:0,title:"Dólares",valueField:"MonedasDolares"},{fillAlphas:0.7,id:"AmGraph-3",lineColor:"#8675B2",lineAlpha:0,title:"Bonos",valueField:"Bonos"},{fillAlphas:0.7,id:"AmGraph-4",lineColor:"#14145F",lineAlpha:0,title:"Fondos",valueField:"FCI"},{fillAlphas:0.7,id:"AmGraph-5",lineColor:"#B6041C",lineAlpha:0,title:"Acciones",valueField:"Acciones"},{fillAlphas:0.7,id:"AmGraph-6",lineColor:"#ff0000",lineAlpha:0,title:"Opciones",valueField:"Opciones"}],guides:[],valueAxes:[{id:"ValueAxis-1",stackType:"regular",minimum:0,}],allLabels:[],balloon:{},legend:{enabled:true,align:"center",equalWidths:true}})};a.loadCharts=function(){var b=new Core.Ajax.ServerRequest({overlayElement:a.divGridValorCuenta.parent(),secureRequest:true,requestUrl:"evoluciondecartera/"+encodeURIComponent(a.header.selectedIdAccount),requestType:"GET",requestData:{FechaDesde:Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()),FechaHasta:Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()),idMoneda:a.idMoneda,Tenencia:1,Eventos:1}});b.onSuccess=function(c){a.resumenData=c.resumen;a.rendimientoData=c.rendimiento;a.evolucionData=c.tenencia;a.eventosData=c.eventos;a.loadGridValorCuenta();if(a.pageOptions.showEvolucionCartera){a.loadChartRendimiento()}a.loadChartEvolucionCartera()};b.request()};a.loadGridValorCuenta=function(){var c=a.divGridValorCuenta.swidget().initialOptions;c.dataSource.data=a.resumenData;var b=[];b.push({field:"Nombre",title:"Concepto",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length,a.idMoneda)});b.push({field:"Rango",title:(a.pageOptions.showEvolucionCartera)?"Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()):"7D",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length,a.idMoneda),format:Core.Functions.grid.formatNumber});if(!a.pageOptions.showEvolucionCartera){b.push({field:"1M",title:"1M",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length,a.idMoneda),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatNumber})}if(Core.Functions.isLarge){b.push({field:"3M",title:"3M",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length,a.idMoneda),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatNumber})}if(Core.Functions.isLarge&&!a.pageOptions.showEvolucionCartera){b.push({field:"6M",title:"6M",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length,a.idMoneda),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatNumber})}if(Core.Functions.isLarge){b.push({field:"12M",title:"12M",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length,a.idMoneda),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatNumber})}b.push({field:"YTD",title:"YTD",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length,a.idMoneda),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatNumber});c.columns=b;a.divGridValorCuenta.swidget().refresh(c);if(a.idMoneda==Core.Business.eEvolucionMoneda.Dolares){$(".sui-alt-row").css("background-color","#eaf7ea")}};a.loadChartRendimiento=function(){a.amchartRendimiento.dataProvider=a.rendimientoData;a.amchartRendimiento.validateData()};a.loadChartEvolucionCartera=function(){a.loadChartEvolucionCarteraPorTotales(a.evolucionData,a.eventosData);a.ddlTipoEvolucion.val(Core.Business.eEvolucionPorTipo.Totales);a.ddlTipoEvolucion.change(function(){if(parseInt(a.ddlTipoEvolucion.val())==Core.Business.eEvolucionPorTipo.Activos){a.loadChartEvolucionCarteraPorTipoActivos(a.evolucionData)}else{if(parseInt(a.ddlTipoEvolucion.val())==Core.Business.eEvolucionPorTipo.Monedas){a.loadChartEvolucionCarteraPorMonedas(a.evolucionData)}else{if(parseInt(a.ddlTipoEvolucion.val())==Core.Business.eEvolucionPorTipo.Totales){a.loadChartEvolucionCarteraPorTotales(a.evolucionData,a.eventosData)}}}});a.chkStockTypes.on("change",function(){a.refreshStockEvents(a.eventosData,false)})};a.loadChartEvolucionCarteraPorTipoActivos=function(b){a.divStockTypes.hide();a.divEvolucionPorMonedas.hide();a.divEvolucionPorTotales.hide();a.divEvolucionPorTipoActivos.show();a.chartEvolucionPorTipoActivos.dataProvider=b;a.chartEvolucionPorTipoActivos.validateData()};a.loadChartEvolucionCarteraPorMonedas=function(b){a.divStockTypes.hide();a.divEvolucionPorMonedas.show();a.divEvolucionPorTotales.hide();a.divEvolucionPorTipoActivos.hide();a.chartEvolucionPorMonedas.dataProvider=b;a.chartEvolucionPorMonedas.validateData()};a.loadChartEvolucionCarteraPorTotales=function(b,c){a.divStockTypes.show();a.divEvolucionPorMonedas.hide();a.divEvolucionPorTotales.show();a.divEvolucionPorTipoActivos.hide();a.chartEvolucionPorTotales.dataSets[0].dataProvider=b;a.refreshStockEvents(c,true)};a.refreshStockEvents=function(c,d){var f=[];for(var e=0;e<a.chkStockTypes.length;e++){var b=$(a.chkStockTypes[e]);if(b[0].checked){f=f.concat($.grep(c,function(h,g){return((b.attr("stock-event-type").indexOf(h.type)>-1)&&(b.attr("stock-event-backgroundColor").indexOf(h.backgroundColor)>-1))}))}}a.chartEvolucionPorTotales.dataSets[0].stockEvents=f;if(d){a.chartEvolucionPorTotales.validateData();a.chartEvolucionPorTotales.validateNow();a.chartEvolucionPorTotales.setDefaultPeriod()}else{a.chartEvolucionPorTotales.validateData()}}};Core.Business.ExternalUrl=new function(){var a=this;var b=500;a.timerId=null;a.id="externalUrl";a.idDefaultAccount=null;a.idDefaultProfile=null;a.iframe=null;a.url=null;a.init=function(c,d,e){Core.loadPage("external-url.html",function(){document.title="Externa";a.idDefaultAccount=c;a.idDefaultProfile=d;a.iframe=$(".iframe-external-url");a.url="";$.extend(true,a,e);a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,c,d,function(){a.iframe.attr("src",a.url)},"Core.Business.ExternalUrl")})}};Core.Business.FacturasProveedores=new function(){var a=this;a.id="homeFacturasProveedores";a.idDefaultAccount=null;a.idDefaultProfile=null;a.eVista={BackOffice:1,AprobacionCompras:2,Carga:3};a.divVista=null;a.ddlVista=null;a.divCarga=null;a.divAprobacionCompras=null;a.divBackOffice=null;a.divManagerFactura=null;a.pageOptions=null;a.vistaActual=null;a.window=$(window);a.init=function(b,c){Core.loadPage("facturas-proveedores.html",function(){document.title="Facturas Proveedores";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.idDefaultAccount=b;a.idDefaultProfile=c;a.vistaActual=null;a.divVista=$(".div-vista");a.ddlVista=$(".dropdown-vista");a.divCarga=$(".div-carga");a.divCarga.hide();a.divAprobacionCompras=$(".div-aprobacion-compras");a.divAprobacionCompras.hide();a.divBackOffice=$(".div-backoffice");a.divBackOffice.hide();a.divManagerFactura=$(".div-manager-factura");a.divManagerFactura.hide();a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.setVista()},"Core.Business.FacturasProveedores")})};a.initControls=function(){var b=[];if(a.pageOptions&&a.pageOptions.FacturasProveedoresBackoffice){b.push({value:a.eVista.BackOffice,text:"BackOffice"});b.push({value:a.eVista.AprobacionCompras,text:"Aprobación Compras"});b.push({value:a.eVista.Carga,text:"Carga"})}else{if(a.pageOptions&&a.pageOptions.FacturasProveedoresAprobacionCompras){b.push({value:a.eVista.AprobacionCompras,text:"Aprobación Compras"});b.push({value:a.eVista.Carga,text:"Carga"})}else{if(a.pageOptions&&a.pageOptions.FacturasProveedoresCarga){b.push({value:a.eVista.Carga,text:"Carga"})}}}a.ddlVista.shieldDropDown({dataSource:{data:b},valueTemplate:"{value}",textTemplate:"{text}",value:"",events:{select:function(c){a.setVista()}}});a.divVista.hide();if(b.length>1){a.divVista.show()}};a.setVista=function(){if(a.vistaActual){a.vistaActual.destroy();a.vistaActual=null}if(a.ddlVista.swidget().value()==a.eVista.BackOffice){a.vistaActual=new Core.Business.FacturasProveedores.BackOffice()}else{if(a.ddlVista.swidget().value()==a.eVista.AprobacionCompras){a.vistaActual=new Core.Business.FacturasProveedores.AprobacionCompras()}else{if(a.ddlVista.swidget().value()==a.eVista.Carga){a.vistaActual=new Core.Business.FacturasProveedores.Carga()}}}a.vistaActual.show()}};Core.Business.FacturasProveedores.Carga=function(){var a=this;a.divContainerGrids=$(".div-grillas-facturas");a.container=$(".div-carga");a.show=function(){a.idProceso=0;a.facturas=[];a.initControls();a.btnCargarFacturas.click();a.container.show()};a.initControls=function(){a.btnCargarFacturas=a.container.find(".btn-cargar-facturas");a.btnCargarFacturas.unbind("click");a.btnCargarFacturas.on("click",function(){a.divContainerFacturas.hide();if(a.idProceso){Core.Business.FacturasProveedores.loadGrid("facturasProveedores/listarFacturas/1/"+a.idProceso,a.container,a.divFacturas,a.divDescripcionEstados,function(b){a.facturas=b;a.divContainerFacturas.show()})}});a.btnCargaManual=a.container.find(".btn-carga-manual");a.btnCargaManual.unbind("click");a.btnCargaManual.on("click",function(){new Core.Business.FacturasProveedores.ManagerFactura({onLoad:function(){a.divContainerGrids.hide()},onClosed:function(){a.divContainerGrids.show();a.btnFacturasCargadas.click()}}).show()});a.inputFiles=a.container.find(".input-upload-file");a.inputFiles.val("");a.btnConfirmarArchivos=a.container.find(".btn-confirmar-archivos");a.btnConfirmarArchivos.unbind("click");a.btnConfirmarArchivos.on("click",function(){a.divContainerFacturas.hide();if(a.inputFiles[0].files.length==0){new Core.Controls.Dialog("Aviso","<p>Debe seleccionar al menos un archivo.</p>",{displayButtons:{close:true,accept:false}}).show();return}for(var h=0,d;d=a.inputFiles[0].files[h];h++){var e=d.name.split(".");var c=e[e.length-1];if(c!="pdf"){new Core.Controls.Dialog("Aviso","<p>Los archivos seleccionados deben ser: pdf.</p>",{displayButtons:{close:true,accept:false}}).show();return}}var g={Authorization:Core.Objects.Context.Token,Accept:"application/json"};var b=new FormData();for(var h=0,d;d=a.inputFiles[0].files[h];h++){b.append("file-"+h,d)}var j=new Core.Controls.Overlay(a.btnConfirmarArchivos,{});$.ajax({type:"POST",url:Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"upload/csv/facturasProveedores",data:b,cache:false,contentType:false,processData:false,method:"POST",headers:g,success:function(f){a.idProceso=(f&&f.idProceso)?f.idProceso:0;new Core.Controls.ProcessProgress({idProcess:a.idProceso,overlayElement:a.container,onFinish:function(){Core.Business.FacturasProveedores.loadGrid("facturasProveedores/listarFacturas/1/"+a.idProceso,a.container,a.divFacturas,a.divDescripcionEstados,function(i){a.facturas=i;a.divContainerFacturas.show()})}}).show();a.inputFiles.val("");j.destroy()},error:function(i){var l=JSON.parse(i.responseText);var m=(l&&l.descripcion)?"Mensaje":"Error de conexión";var f=(l&&l.descripcion)?l.descripcion:"Algunos componentes de la página no se cargaron correctamente. Por favor intente mas tarde...";var k=new Core.Controls.Dialog(m,"<p>"+f+"</p>",{displayButtons:{close:true,accept:false}});k.show();j.destroy()}})});a.divContainerFacturas=a.container.find(".div-container-facturas");a.divContainerFacturas.hide();a.divDescripcionEstados=a.container.find(".div-descripcion-estados");a.divFacturas=a.container.find(".div-facturas");Core.Business.FacturasProveedores.initGrid(a.divFacturas,a.divContainerGrids,true,false,function(){Core.Business.FacturasProveedores.loadGrid("facturasProveedores/listarFacturas/1/"+a.idProceso,a.container,a.divFacturas,a.divDescripcionEstados,function(b){a.facturas=b;a.divContainerFacturas.show()})});a.btnConfirmarCarga=a.container.find(".btn-confirmar-carga");a.btnConfirmarCarga.unbind("click");a.btnConfirmarCarga.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea confirmar la carga de las facturas?",{onAccepted:function(){if(!a.facturas.length){new Core.Controls.Dialog("Aviso","No hay ninguna factura cargada para confirmar.",{displayButtons:{close:true,accept:false}}).show();return}var b={facturas:[]};a.facturas.forEach(function(e,d){b.facturas.push({IdFactura:e.IdFactura})});var c=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.btnConfirmarCarga,requestUrl:"facturasProveedores/avanzarEstado",requestType:"POST",requestData:b});c.onSuccess=function(){a.idProceso=null;a.btnFacturasCargadas.click()};c.request()}}).show()});a.btnFacturasCargadas=a.container.find(".btn-facturas-cargadas");a.btnFacturasCargadas.unbind("click");a.btnFacturasCargadas.on("click",function(){a.loadFacturasCargadas()});a.txtFechaDesde=a.container.find(".date-picker-from");a.txtFechaHasta=a.container.find(".date-picker-to");Core.Business.FacturasProveedores.initDatePickers(a.txtFechaDesde,a.txtFechaHasta,function(){a.loadFacturasCargadas()});a.divDescripcionEstadosFacturasCargadas=a.container.find(".div-descripcion-estados-facturas-cargadas");a.divFacturasCargadas=a.container.find(".div-facturas-cargadas");Core.Business.FacturasProveedores.initGrid(a.divFacturasCargadas,a.divContainerGrids,true,false,function(){a.loadFacturasCargadas()})};a.loadFacturasCargadas=function(){Core.Functions.Validations.toggleValidation(a.txtFechaDesde,false);Core.Functions.Validations.toggleValidation(a.txtFechaHasta,false);if(a.txtFechaDesde.swidget().value()&&a.txtFechaHasta.swidget().value()){var b="?fechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtFechaDesde.swidget().value()));b+="&fechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtFechaHasta.swidget().value()));Core.Business.FacturasProveedores.loadGrid("facturasProveedores/listarFacturas/2/1"+b,a.container,a.divFacturasCargadas,a.divDescripcionEstadosFacturasCargadas)}else{Core.Functions.Validations.toggleValidation(a.txtFechaDesde,true);Core.Functions.Validations.toggleValidation(a.txtFechaHasta,true)}};a.destroy=function(){a.txtFechaDesde.swidget().destroy();a.txtFechaHasta.swidget().destroy();a.divFacturas.swidget().destroy();a.divFacturasCargadas.swidget().destroy();a.container.hide()}};Core.Business.FacturasProveedores.AprobacionCompras=function(){var a=this;a.divContainerGrids=$(".div-grillas-facturas");a.container=$(".div-aprobacion-compras");a.show=function(){a.facturasParaAprobar=[];a.initControls();a.btnFacturasParaAprobar.click();a.container.show()};a.initControls=function(){a.btnFacturasParaAprobar=a.container.find(".btn-aprobacion-compras-facturas-para-aprobar");a.btnFacturasParaAprobar.unbind("click");a.btnFacturasParaAprobar.on("click",function(){Core.Business.FacturasProveedores.loadGrid("facturasProveedores/listarFacturas/2/0",a.container,a.divFacturasParaAprobar,a.divFacturasParaAprobarEstados,function(b){a.facturasParaAprobar=b})});a.divFacturasParaAprobarEstados=a.container.find(".div-descripcion-estados-facturas-para-aprobar");a.divFacturasParaAprobar=a.container.find(".div-facturas-para-aprobar");Core.Business.FacturasProveedores.initGrid(a.divFacturasParaAprobar,a.divContainerGrids,true,true,function(){Core.Business.FacturasProveedores.loadGrid("facturasProveedores/listarFacturas/2/0",a.container,a.divFacturasParaAprobar,a.divFacturasParaAprobarEstados,function(b){a.facturasParaAprobar=b})});a.btnAprobar=a.container.find(".btn-aprobar");a.btnAprobar.unbind("click");a.btnAprobar.on("click",function(){var b=[];a.facturasParaAprobar.forEach(function(d,c){if(d.chk&&d.chk[0].checked){b.push(d)}});if(b.length==0){new Core.Controls.Dialog("Aviso","Debe seleccionar al menos una factura a aprobar.",{displayButtons:{close:true,accept:false}}).show();return}new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea aprobar "+((b.length>1)?("las "+b.length+" facturas seleccionadas"):("la factura seleccionada"))+"?",{onAccepted:function(){var c={facturas:[]};b.forEach(function(f,e){c.facturas.push({IdFactura:f.IdFactura})});var d=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.btnAprobar,requestUrl:"facturasProveedores/avanzarEstado",requestType:"POST",requestData:c});d.onSuccess=function(){Core.Business.FacturasProveedores.loadGrid("facturasProveedores/listarFacturas/2/0",a.container,a.divFacturasParaAprobar,a.divFacturasParaAprobarEstados,function(e){a.facturasParaAprobar=e})};d.request()}}).show()});a.btnFacturasAprobadas=a.container.find(".btn-aprobacion-compras-facturas-aprobadas");a.btnFacturasAprobadas.unbind("click");a.btnFacturasAprobadas.on("click",function(){a.loadFacturasAprobadas()});a.txtFechaDesde=a.container.find(".date-picker-from");a.txtFechaHasta=a.container.find(".date-picker-to");Core.Business.FacturasProveedores.initDatePickers(a.txtFechaDesde,a.txtFechaHasta,function(){a.loadFacturasAprobadas()});a.divFacturasAprobadasEstados=a.container.find(".div-descripcion-estados-facturas-aprobadas");a.divFacturasAprobadas=a.container.find(".div-facturas-aprobadas");Core.Business.FacturasProveedores.initGrid(a.divFacturasAprobadas,a.divContainerGrids,false,false,function(){a.loadFacturasAprobadas()})};a.loadFacturasAprobadas=function(){Core.Functions.Validations.toggleValidation(a.txtFechaDesde,false);Core.Functions.Validations.toggleValidation(a.txtFechaHasta,false);if(a.txtFechaDesde.swidget().value()&&a.txtFechaHasta.swidget().value()){var b="?fechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtFechaDesde.swidget().value()));b+="&fechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtFechaHasta.swidget().value()));Core.Business.FacturasProveedores.loadGrid("facturasProveedores/listarFacturas/3/1"+b,a.container,a.divFacturasAprobadas,a.divFacturasAprobadasEstados)}else{Core.Functions.Validations.toggleValidation(a.txtFechaDesde,true);Core.Functions.Validations.toggleValidation(a.txtFechaHasta,true)}};a.destroy=function(){a.txtFechaDesde.swidget().destroy();a.txtFechaHasta.swidget().destroy();a.divFacturasParaAprobar.swidget().destroy();a.divFacturasAprobadas.swidget().destroy();a.container.hide()}};Core.Business.FacturasProveedores.BackOffice=function(){var a=this;a.divContainerGrids=$(".div-grillas-facturas");a.container=$(".div-backoffice");a.show=function(){a.facturasCargadas=[];a.initControls();a.btnFacturasACargar.click();a.container.show()};a.initControls=function(){a.btnFacturasACargar=a.container.find(".btn-backoffice-facturas-a-cargar");a.btnFacturasACargar.unbind("click");a.btnFacturasACargar.on("click",function(){Core.Business.FacturasProveedores.loadGrid("facturasProveedores/listarFacturas/3/0",a.container,a.divFacturasACargar,a.divFacturasACargarEstados,function(b){a.facturasCargadas=b})});a.divFacturasACargarEstados=a.container.find(".div-descripcion-estados-facturas-a-cargar");a.divFacturasACargar=a.container.find(".div-facturas-a-cargar");Core.Business.FacturasProveedores.initGrid(a.divFacturasACargar,a.divContainerGrids,true,true,function(){Core.Business.FacturasProveedores.loadGrid("facturasProveedores/listarFacturas/3/0",a.container,a.divFacturasACargar,a.divFacturasACargarEstados,function(b){a.facturasCargadas=b})});a.btnCargar=a.container.find(".btn-cargar");a.btnCargar.unbind("click");a.btnCargar.on("click",function(){var b=[];a.facturasCargadas.forEach(function(d,c){if(d.chk&&d.chk[0].checked){b.push(d)}});if(b.length==0){new Core.Controls.Dialog("Aviso","Debe seleccionar al menos una factura a aprobar.",{displayButtons:{close:true,accept:false}}).show();return}new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea aprobar "+((b.length>1)?("las "+b.length+" facturas seleccionadas"):("la factura seleccionada"))+"?",{onAccepted:function(){var c={facturas:[]};b.forEach(function(f,e){c.facturas.push({IdFactura:f.IdFactura})});var d=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.btnCargar,requestUrl:"upload/csv/facturasProveedores/confirmarCarga",requestType:"POST",requestData:c});d.onSuccess=function(e){if(e.nombreArchivo){Core.Functions.File.download(a.btnCargar,Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"download/facturasProveedores/descargarInterfaz/"+e.nombreArchivo,function(){Core.Business.FacturasProveedores.loadGrid("facturasProveedores/listarFacturas/3/0",a.container,a.divFacturasACargar,a.divFacturasACargarEstados,function(f){a.facturasCargadas=f})})}else{Core.Business.FacturasProveedores.loadGrid("facturasProveedores/listarFacturas/3/0",a.container,a.divFacturasACargar,a.divFacturasACargarEstados,function(f){a.facturasCargadas=f})}};d.request()}}).show()});a.btnFacturasCargadas=a.container.find(".btn-backoffice-facturas-cargadas");a.btnFacturasCargadas.unbind("click");a.btnFacturasCargadas.on("click",function(){a.loadFacturasCargadas()});a.txtFechaDesde=a.container.find(".date-picker-from");a.txtFechaHasta=a.container.find(".date-picker-to");Core.Business.FacturasProveedores.initDatePickers(a.txtFechaDesde,a.txtFechaHasta,function(){a.loadFacturasCargadas()});a.divDescripcionEstadosFacturasCargadas=a.container.find(".div-descripcion-estados-facturas-cargadas");a.divFacturasCargadas=a.container.find(".div-facturas-cargadas");Core.Business.FacturasProveedores.initGrid(a.divFacturasCargadas,a.divContainerGrids,false,false,function(){a.loadFacturasCargadas()})};a.loadFacturasCargadas=function(){Core.Functions.Validations.toggleValidation(a.txtFechaDesde,false);Core.Functions.Validations.toggleValidation(a.txtFechaHasta,false);if(a.txtFechaDesde.swidget().value()&&a.txtFechaHasta.swidget().value()){var b="?fechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtFechaDesde.swidget().value()));b+="&fechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtFechaHasta.swidget().value()));Core.Business.FacturasProveedores.loadGrid("facturasProveedores/listarFacturas/4/0"+b,a.container,a.divFacturasCargadas,a.divDescripcionEstadosFacturasCargadas)}else{Core.Functions.Validations.toggleValidation(a.txtFechaDesde,true);Core.Functions.Validations.toggleValidation(a.txtFechaHasta,true)}};a.destroy=function(){a.txtFechaDesde.swidget().destroy();a.txtFechaHasta.swidget().destroy();a.divFacturasACargar.swidget().destroy();a.divFacturasCargadas.swidget().destroy();a.container.hide()}};Core.Business.FacturasProveedores.initDatePickers=function(c,d,b){var a=new Date();a.setDate(a.getDate()-30);c.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:a,max:new Date(),events:{change:function(f){b()}}});d.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(f){b()}}})};Core.Business.FacturasProveedores.initGrid=function(c,b,e,f,d){var a=[];a.push({width:"10%",field:"TipoFactura",title:"Tipo Factura",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(a.length),format:Core.Functions.grid.formatUndefinedString});a.push({width:"10%",field:"FechaEmision",title:"Fecha Emisión",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(a.length),format:Core.Functions.grid.formatStringDate});a.push({width:"15%",field:"ImporteTotal",title:"Importe Total",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(a.length),format:Core.Functions.grid.formatNumberWithDecimals});a.push({width:"50%",field:"ProductoServicio",title:"Producto / Servicio",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(a.length),columnTemplate:function(g,h,i){if(h.ColorFila){g.parent().css("background-color","rgba("+Core.Functions.grid.hexToRgb(h.ColorFila)+((i%2==0)?", 0.6":", 1 ")+")")}g.html(Core.Functions.grid.formatUndefinedString(h.ProductoServicio).replaceAll("\\*","<br/>"))}});a.push({width:"15%",field:"NombreArchivo",title:"Archivo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(a.length),format:Core.Functions.grid.formatUndefinedString});a.push({width:180,field:"",title:" ",headerAttributes:Core.Functions.grid.getHeaderAttribute(a.length),columnTemplate:function(k,l,m){if(e){var h=$('<button type="button" title="Modificar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(k);h.on("click",function(){new Core.Business.FacturasProveedores.ManagerFactura({idFactura:l.IdFactura,overlayElement:h,onLoad:function(){b.hide()},onClosed:function(){b.show();d()}}).show()});var g=$('<button type="button" title="Descartar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(k);g.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar la factura?",{onAccepted:function(){var n=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:g,requestUrl:"facturasProveedores/Eliminar/"+l.IdFactura,requestType:"DELETE"});n.onSuccess=function(){d()};n.request()}}).show()})}var i=$('<button type="button" title="Ver Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(k);i.on("click",function(){new Core.Business.FacturasProveedores.ManagerFactura({idFactura:l.IdFactura,overlayElement:i,onLoad:function(){b.hide()},onClosed:function(){b.show()},readOnly:true}).show()});var j=$('<button type="button" title="Ver Factura" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>').appendTo(k);j.on("click",function(){if(l.Archivo){window.open((Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"documento/"+l.Archivo),"_blank")}})}});if(f){a.push({title:" ",field:"",width:40,filterable:false,headerAttributes:Core.Functions.grid.getHeaderAttribute(a.length),columnTemplate:function(g,i,h){if(i.chk){$(i.chk).appendTo(g)}}})}c.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:a})};Core.Business.FacturasProveedores.loadGrid=function(e,d,b,a,c){var f=new Core.Ajax.ServerRequest({overlayElement:d,secureRequest:true,requestUrl:e,requestType:"GET"});f.onSuccess=function(g){var i=((g&&g.facturas)?g.facturas:[]);var h=[];a.empty();i.forEach(function(l,k){l.chk=$('<input type="checkbox" />');if(l.ColorFila&&l.DescripcionFila&&$.grep(h,function(m,n){return m.descripcion==l.DescripcionFila&&m.color==l.ColorFila}).length==0){h.push({descripcion:l.DescripcionFila,color:l.ColorFila})}});h.forEach(function(k,l){$('<label style="margin-right:10px; padding:5px;'+(k.color?("background:rgb("+Core.Functions.grid.hexToRgb(k.color)+");"):"")+'">'+k.descripcion+"</label>").appendTo(a)});var j=b.swidget().initialOptions;j.dataSource.data=i;b.swidget().refresh(j);if(c){c(i)}};f.request()};Core.Business.FacturasProveedores.ManagerFactura=function(b){var a=this;a.container=$(".div-manager-factura");a.onLoad=function(){};a.onClosed=function(){};a.idFactura=null;a.overlayElement=null;a.readOnly=false;$.extend(true,a,b);a.show=function(){a.factura=null;a.productos=[];if(a.idFactura){var c=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,secureRequest:true,requestUrl:"facturasProveedores/obtenerFactura/"+a.idFactura,requestType:"GET"});c.onSuccess=function(d){a.factura=((d&&d.factura&&d.factura[0])?d.factura[0]:null);a.productos=((d&&d.productoServicio)?d.productoServicio:[]);a.initControls()};c.request()}else{a.initControls()}};a.initControls=function(){a.imagenFactura=null;a.lblTitulo=a.container.find(".label-titulo");a.lblTitulo.text(a.readOnly?"Ver Factura":(a.factura?"Editar Factura":"Nueva Factura"));a.divTipoFactura=a.container.find(".div-tipo-factura");a.ddlTipoFactura=a.container.find(".dropdown-tipo-factura");a.ddlTipoFactura.shieldDropDown({dataSource:{data:[{value:"A"},{value:"B"},{value:"C"},{value:"M"}]},valueTemplate:"{value}",textTemplate:"{value}",value:(a.factura&&a.factura.TipoFactura!=null)?a.factura.TipoFactura:"",events:{select:function(c){a.setControlsBytipoFactura()}},enabled:!a.readOnly});Core.Functions.Validations.toggleValidation(a.ddlTipoFactura,false);a.divPuntoVenta=a.container.find(".div-punto-venta");a.txtPuntoVenta=a.container.find(".textbox-punto-venta");a.txtPuntoVenta.shieldTextBox({enabled:!a.readOnly,value:(a.factura&&a.factura.PuntoDeVent!=null)?a.factura.PuntoDeVent:""});Core.Functions.Validations.toggleValidation(a.txtPuntoVenta,false);a.divComprobanteNumero=a.container.find(".div-comprobante-numero");a.txtComprobanteNumero=a.container.find(".textbox-comprobante-numero");a.txtComprobanteNumero.shieldTextBox({enabled:!a.readOnly,value:(a.factura&&a.factura.ComprobanteNum!=null)?a.factura.ComprobanteNum:""});Core.Functions.Validations.toggleValidation(a.txtComprobanteNumero,false);a.divEmision=a.container.find(".div-emision");a.txtEmision=a.container.find(".date-picker-emision");a.txtEmision.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.factura&&a.factura.FechaEmision!=null)?Core.Functions.Date.getDateByString(a.factura.FechaEmision):new Date(),enabled:!a.readOnly});Core.Functions.Validations.toggleValidation(a.txtEmision,false);a.divRazonSocial=a.container.find(".div-razon-social");a.txtRazonSocial=a.container.find(".textbox-razon-social");a.txtRazonSocial.shieldTextBox({enabled:!a.readOnly,value:(a.factura&&a.factura.RazonSocial!=null)?a.factura.RazonSocial:""});Core.Functions.Validations.toggleValidation(a.txtRazonSocial,false);a.divCUIT=a.container.find(".div-cuit");a.txtCUIT=a.container.find(".textbox-cuit");a.txtCUIT.shieldTextBox({enabled:!a.readOnly,value:(a.factura&&a.factura.CUIT!=null)?a.factura.CUIT:""});Core.Functions.Validations.toggleValidation(a.txtCUIT,false);a.divIngresosBrutos=a.container.find(".div-ingresos-brutos");a.txtIngresosBrutos=a.container.find(".textbox-ingresos-brutos");a.txtIngresosBrutos.shieldTextBox({enabled:!a.readOnly,value:(a.factura&&a.factura.IngresosBrutos!=null)?a.factura.IngresosBrutos:""});Core.Functions.Validations.toggleValidation(a.txtIngresosBrutos,false);a.divDomicilioComercial=a.container.find(".div-domicilio-comercial");a.txtDomicilioComercial=a.container.find(".textbox-domicilio-comercial");a.txtDomicilioComercial.shieldTextBox({enabled:!a.readOnly,value:(a.factura&&a.factura.DomicilioComercial!=null)?a.factura.DomicilioComercial:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioComercial,false);a.divCondicionIVA=a.container.find(".div-condicion-iva");a.txtCondicionIVA=a.container.find(".textbox-condicion-iva");a.txtCondicionIVA.shieldTextBox({enabled:!a.readOnly,value:(a.factura&&a.factura.CondicionIVA!=null)?a.factura.CondicionIVA:""});Core.Functions.Validations.toggleValidation(a.txtCondicionIVA,false);a.divInicioActividad=a.container.find(".div-inicio-actividad");a.txtInicioActividad=a.container.find(".date-picker-inicio-actividad");a.txtInicioActividad.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.factura&&a.factura.FechaInicioActividad!=null)?Core.Functions.Date.getDateByString(a.factura.FechaInicioActividad):new Date(),enabled:!a.readOnly});Core.Functions.Validations.toggleValidation(a.txtInicioActividad,false);a.divPeriodoFacturadoDesde=a.container.find(".div-periodo-facturado-desde");a.txtPeriodoFacturadoDesde=a.container.find(".date-picker-periodo-facturado-desde");a.txtPeriodoFacturadoDesde.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.factura&&a.factura.PeriodoFacDesde!=null)?Core.Functions.Date.getDateByString(a.factura.PeriodoFacDesde):new Date(),enabled:!a.readOnly});Core.Functions.Validations.toggleValidation(a.txtPeriodoFacturadoDesde,false);a.divPeriodoFacturadoHasta=a.container.find(".div-periodo-facturado-hasta");a.txtPeriodoFacturadoHasta=a.container.find(".date-picker-periodo-facturado-hasta");a.txtPeriodoFacturadoHasta.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.factura&&a.factura.PeriodoFacHasta!=null)?Core.Functions.Date.getDateByString(a.factura.PeriodoFacHasta):new Date(),enabled:!a.readOnly});Core.Functions.Validations.toggleValidation(a.txtPeriodoFacturadoHasta,false);a.divVencimientoPago=a.container.find(".div-vencimiento-pago");a.txtVencimientoPago=a.container.find(".date-picker-vencimiento-pago");a.txtVencimientoPago.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.factura&&a.factura.FechaVtoPago!=null)?Core.Functions.Date.getDateByString(a.factura.FechaVtoPago):new Date(),enabled:!a.readOnly});Core.Functions.Validations.toggleValidation(a.txtVencimientoPago,false);a.divRetencionImpuestoGanancias=a.container.find(".div-retencion-impuesto-ganancias");a.txtRetencionImpuestoGanancias=a.container.find(".textbox-retencion-impuesto-ganancias");new Core.Controls.DecimalPicker(a.txtRetencionImpuestoGanancias,{maxDecimalDigitCount:2,showThousandsSeparator:"",enabledZero:true,defaultValue:(a.factura&&a.factura.PerRetImpuestoGanancias!=null)?a.factura.PerRetImpuestoGanancias.toString():""});a.setEnabled(a.txtRetencionImpuestoGanancias);Core.Functions.Validations.toggleValidation(a.txtRetencionImpuestoGanancias,false);a.divRetencionIVA=a.container.find(".div-retencion-iva");a.txtRetencionIVA=a.container.find(".textbox-retencion-iva");new Core.Controls.DecimalPicker(a.txtRetencionIVA,{maxDecimalDigitCount:2,showThousandsSeparator:"",enabledZero:true,defaultValue:(a.factura&&a.factura.PerRetIVA!=null)?a.factura.PerRetIVA.toString():""});a.setEnabled(a.txtRetencionIVA);Core.Functions.Validations.toggleValidation(a.txtRetencionIVA,false);a.divRetencionIngresosBrutos=a.container.find(".div-retencion-ingresos-brutos");a.txtRetencionIngresosBrutos=a.container.find(".textbox-retencion-ingresos-brutos");new Core.Controls.DecimalPicker(a.txtRetencionIngresosBrutos,{maxDecimalDigitCount:2,showThousandsSeparator:"",enabledZero:true,defaultValue:(a.factura&&a.factura.PerRetIngresosBruto!=null)?a.factura.PerRetIngresosBruto.toString():""});a.setEnabled(a.txtRetencionIngresosBrutos);Core.Functions.Validations.toggleValidation(a.txtRetencionIngresosBrutos,false);a.divImpuestosInternos=a.container.find(".div-impuestos-internos");a.txtImpuestosInternos=a.container.find(".textbox-impuestos-internos");new Core.Controls.DecimalPicker(a.txtImpuestosInternos,{maxDecimalDigitCount:2,showThousandsSeparator:"",enabledZero:true,defaultValue:(a.factura&&a.factura.ImpuestosInternos!=null)?a.factura.ImpuestosInternos.toString():""});a.setEnabled(a.txtImpuestosInternos);Core.Functions.Validations.toggleValidation(a.txtImpuestosInternos,false);a.divImpuestosMunicipales=a.container.find(".div-impuestos-municipales");a.txtImpuestosMunicipales=a.container.find(".textbox-impuestos-municipales");new Core.Controls.DecimalPicker(a.txtImpuestosMunicipales,{maxDecimalDigitCount:2,showThousandsSeparator:"",enabledZero:true,defaultValue:(a.factura&&a.factura.ImpuestosMunicipales!=null)?a.factura.ImpuestosMunicipales.toString():""});a.setEnabled(a.txtImpuestosMunicipales);Core.Functions.Validations.toggleValidation(a.txtImpuestosMunicipales,false);a.divImporteNetoGravado=a.container.find(".div-importe-neto-gravado");a.txtImporteNetoGravado=a.container.find(".textbox-importe-neto-gravado");new Core.Controls.DecimalPicker(a.txtImporteNetoGravado,{maxDecimalDigitCount:2,showThousandsSeparator:"",enabledZero:true,defaultValue:(a.factura&&a.factura.ImporteNetoGravado!=null)?a.factura.ImporteNetoGravado.toString():""});a.setEnabled(a.txtImporteNetoGravado);Core.Functions.Validations.toggleValidation(a.txtImporteNetoGravado,false);a.divImporteNetoNoGravado=a.container.find(".div-importe-neto-no-gravado");a.txtImporteNetoNoGravado=a.container.find(".textbox-importe-neto-no-gravado");new Core.Controls.DecimalPicker(a.txtImporteNetoNoGravado,{maxDecimalDigitCount:2,showThousandsSeparator:"",enabledZero:true,defaultValue:(a.factura&&a.factura.ImporteNetoNoGravado!=null)?a.factura.ImporteNetoNoGravado.toString():""});a.setEnabled(a.txtImporteNetoNoGravado);Core.Functions.Validations.toggleValidation(a.txtImporteNetoNoGravado,false);a.divIVA27=a.container.find(".div-iva-27");a.txtIVA27=a.container.find(".textbox-iva-27");new Core.Controls.DecimalPicker(a.txtIVA27,{maxDecimalDigitCount:2,showThousandsSeparator:"",enabledZero:true,defaultValue:(a.factura&&a.factura.IVA27!=null)?a.factura.IVA27.toString():""});a.setEnabled(a.txtIVA27);Core.Functions.Validations.toggleValidation(a.txtIVA27,false);a.divIVA21=a.container.find(".div-iva-21");a.txtIVA21=a.container.find(".textbox-iva-21");new Core.Controls.DecimalPicker(a.txtIVA21,{maxDecimalDigitCount:2,showThousandsSeparator:"",enabledZero:true,defaultValue:(a.factura&&a.factura.IVA21!=null)?a.factura.IVA21.toString():""});a.setEnabled(a.txtIVA21);Core.Functions.Validations.toggleValidation(a.txtIVA21,false);a.divIVA105=a.container.find(".div-iva-105");a.txtIVA105=a.container.find(".textbox-iva-105");new Core.Controls.DecimalPicker(a.txtIVA105,{maxDecimalDigitCount:2,showThousandsSeparator:"",enabledZero:true,defaultValue:(a.factura&&a.factura.IVA105!=null)?a.factura.IVA105.toString():""});a.setEnabled(a.txtIVA105);Core.Functions.Validations.toggleValidation(a.txtIVA105,false);a.divIVA5=a.container.find(".div-iva-5");a.txtIVA5=a.container.find(".textbox-iva-5");new Core.Controls.DecimalPicker(a.txtIVA5,{maxDecimalDigitCount:2,showThousandsSeparator:"",enabledZero:true,defaultValue:(a.factura&&a.factura.IVA5!=null)?a.factura.IVA5.toString():""});a.setEnabled(a.txtIVA5);Core.Functions.Validations.toggleValidation(a.txtIVA5,false);a.divIVA25=a.container.find(".div-iva-25");a.txtIVA25=a.container.find(".textbox-iva-25");new Core.Controls.DecimalPicker(a.txtIVA25,{maxDecimalDigitCount:2,showThousandsSeparator:"",enabledZero:true,defaultValue:(a.factura&&a.factura.IVA25!=null)?a.factura.IVA25.toString():""});a.setEnabled(a.txtIVA25);Core.Functions.Validations.toggleValidation(a.txtIVA25,false);a.divIVA0=a.container.find(".div-iva-0");a.txtIVA0=a.container.find(".textbox-iva-0");new Core.Controls.DecimalPicker(a.txtIVA0,{maxDecimalDigitCount:2,showThousandsSeparator:"",enabledZero:true,defaultValue:(a.factura&&a.factura.IVA0!=null)?a.factura.IVA0.toString():""});a.setEnabled(a.txtIVA0);Core.Functions.Validations.toggleValidation(a.txtIVA0,false);a.divSubtotal=a.container.find(".div-subtotal");a.txtSubtotal=a.container.find(".textbox-subtotal");new Core.Controls.DecimalPicker(a.txtSubtotal,{maxDecimalDigitCount:2,showThousandsSeparator:"",enabledZero:true,defaultValue:(a.factura&&a.factura.SubTotal!=null)?a.factura.SubTotal.toString():""});a.setEnabled(a.txtSubtotal);Core.Functions.Validations.toggleValidation(a.txtSubtotal,false);a.divOtrosTributos=a.container.find(".div-otros-tributos");a.txtOtrosTributos=a.container.find(".textbox-otros-tributos");new Core.Controls.DecimalPicker(a.txtOtrosTributos,{maxDecimalDigitCount:2,showThousandsSeparator:"",enabledZero:true,defaultValue:(a.factura&&a.factura.ImporteOtrosTributos!=null)?a.factura.ImporteOtrosTributos.toString():""});a.setEnabled(a.txtOtrosTributos);Core.Functions.Validations.toggleValidation(a.txtOtrosTributos,false);a.divTotal=a.container.find(".div-total");a.txtTotal=a.container.find(".textbox-total");new Core.Controls.DecimalPicker(a.txtTotal,{maxDecimalDigitCount:2,showThousandsSeparator:"",defaultValue:(a.factura&&a.factura.ImporteTotal!=null)?a.factura.ImporteTotal.toString():""});a.setEnabled(a.txtTotal);Core.Functions.Validations.toggleValidation(a.txtTotal,false);a.divNumeroCAE=a.container.find(".div-numero-cae");a.txtNumeroCAE=a.container.find(".textbox-numero-cae");a.txtNumeroCAE.shieldTextBox({enabled:!a.readOnly,value:(a.factura&&a.factura.NumCAE!=null)?a.factura.NumCAE:""});Core.Functions.Validations.toggleValidation(a.txtNumeroCAE,false);a.divVencimientoCAE=a.container.find(".div-vencimiento-cae");a.txtVencimientoCAE=a.container.find(".date-picker-vencimiento-cae");a.txtVencimientoCAE.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.factura&&a.factura.FechaVtoCAE!=null)?Core.Functions.Date.getDateByString(a.factura.FechaVtoCAE):new Date(),enabled:!a.readOnly});Core.Functions.Validations.toggleValidation(a.txtVencimientoCAE,false);a.divProductos=a.container.find(".div-productos");a.divProductos.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:[]});a.setControlsBytipoFactura();a.btnNuevoProducto=a.container.find(".btn-nuevo-producto");a.btnNuevoProducto.unbind("click");a.btnNuevoProducto.on("click",function(){new Core.Business.FacturasProveedores.ManagerProducto({tipoFactura:a.ddlTipoFactura.swidget().value(),onConfirm:function(c){a.productos.push(c);a.refreshProductos()}}).show()});a.btnNuevoProducto.show();if(a.readOnly){a.btnNuevoProducto.hide()}a.divContainerComprobante=a.container.find(".div-container-comprobante");a.divComprobante=a.container.find(".div-comprobante");a.fileUpload=new Core.Controls.FileUpload(a.divComprobante,{urlMethod:Core.PrefixUrl+"upload/documento/34",fileTypes:{"image/jpeg":"image/jpeg","image/png":"image/png","application/pdf":"application/pdf"},maxSize:10485760,onLoad:function(d){a.imagenFactura=d;var c=a.fileUpload.inputFile.val().split("\\");a.imagenFactura.NombreArchivo=c.length?c[c.length-1]:""},onFileChange:function(){a.imagenFactura=null},onError:function(){a.imagenFactura=null;new Core.Controls.Dialog("Error","No se ha podido adjuntar el comprobante",{displayButtons:{close:true,accept:false}}).show();return}});a.divContainerComprobante.show();if(a.idFactura||a.readOnly){a.divContainerComprobante.hide()}Core.Functions.Validations.toggleValidation(a.divComprobante,false);a.btnConfirmar=a.container.find(".btn-confirmar");a.btnConfirmar.unbind("click");a.btnConfirmar.on("click",function(){var e={value:true};var c={factura:{},ProductosServicios:a.productos};c.factura.TipoFactura=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoFactura,e);c.factura.RazonSocial=Core.Functions.Validations.getValidatedSwidgetValue(a.txtRazonSocial,e);c.factura.DomicilioComercial=Core.Functions.Validations.getValidatedSwidgetValue(a.txtDomicilioComercial,e);c.factura.CondicionIVA=Core.Functions.Validations.getValidatedSwidgetValue(a.txtCondicionIVA,e);c.factura.PuntoDeVent=Core.Functions.Validations.getValidatedSwidgetValue(a.txtPuntoVenta,e);c.factura.ComprobanteNum=Core.Functions.Validations.getValidatedSwidgetValue(a.txtComprobanteNumero,e);c.factura.FechaEmision=Core.Functions.Date.getDisplayDateWithSeparator(Core.Functions.Validations.getValidatedSwidgetValue(a.txtEmision,e),"-");c.factura.CUIT=Core.Functions.Validations.getValidatedSwidgetValue(a.txtCUIT,e);c.factura.IngresosBrutos=Core.Functions.Validations.getValidatedSwidgetValue(a.txtIngresosBrutos,e);c.factura.FechaInicioActividad=Core.Functions.Date.getDisplayDateWithSeparator(Core.Functions.Validations.getValidatedSwidgetValue(a.txtInicioActividad,e),"-");c.factura.PeriodoFacDesde=Core.Functions.Date.getDisplayDateWithSeparator(Core.Functions.Validations.getValidatedSwidgetValue(a.txtPeriodoFacturadoDesde,e),"-");c.factura.PeriodoFacHasta=Core.Functions.Date.getDisplayDateWithSeparator(Core.Functions.Validations.getValidatedSwidgetValue(a.txtPeriodoFacturadoHasta,e),"-");c.factura.FechaVtoPago=Core.Functions.Date.getDisplayDateWithSeparator(Core.Functions.Validations.getValidatedSwidgetValue(a.txtVencimientoPago,e),"-");if(a.ddlTipoFactura.swidget().value()=="A"||a.ddlTipoFactura.swidget().value()=="M"){c.factura.PerRetImpuestoGanancias=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedInputValue(a.txtRetencionImpuestoGanancias,e));c.factura.PerRetIVA=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedInputValue(a.txtRetencionIVA,e));c.factura.PerRetIngresosBruto=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedInputValue(a.txtRetencionIngresosBrutos,e));c.factura.ImpuestosInternos=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedInputValue(a.txtImpuestosInternos,e));c.factura.ImpuestosMunicipales=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedInputValue(a.txtImpuestosMunicipales,e));c.factura.ImporteNetoGravado=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedInputValue(a.txtImporteNetoGravado,e));c.factura.ImporteNetoNoGravado=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedInputValue(a.txtImporteNetoNoGravado,e));c.factura.IVA27=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedInputValue(a.txtIVA27,e));c.factura.IVA21=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedInputValue(a.txtIVA21,e));c.factura.IVA105=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedInputValue(a.txtIVA105,e));c.factura.IVA5=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedInputValue(a.txtIVA5,e));c.factura.IVA25=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedInputValue(a.txtIVA25,e));c.factura.IVA0=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedInputValue(a.txtIVA0,e))}if(a.ddlTipoFactura.swidget().value()=="B"||a.ddlTipoFactura.swidget().value()=="C"){c.factura.SubTotal=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedInputValue(a.txtSubtotal,e))}c.factura.ImporteOtrosTributos=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedInputValue(a.txtOtrosTributos,e));c.factura.ImporteTotal=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtTotal,e));c.factura.NumCAE=Core.Functions.Validations.getValidatedSwidgetValue(a.txtNumeroCAE,e);c.factura.FechaVtoCAE=Core.Functions.Date.getDisplayDateWithSeparator(Core.Functions.Validations.getValidatedSwidgetValue(a.txtVencimientoCAE,e),"-");if(!a.idFactura){c.factura.Reconocio=-1;Core.Functions.Validations.toggleValidation(a.divComprobante,false);if(!a.imagenFactura){e.value=false;Core.Functions.Validations.toggleValidation(a.divComprobante,true)}else{c.factura.IdArchivoImagen=a.imagenFactura.idArchivo;c.factura.NombreArchivo=a.imagenFactura.NombreArchivo}}if(e.value){var d=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.btnConfirmar,secureRequest:true,requestUrl:"facturasProveedores/"+(a.idFactura?("modificarFactura/"+a.idFactura):"cargarFactura/0"),requestType:"POST",requestData:c});d.onSuccess=function(){a.destroy()};d.request()}});a.btnConfirmar.show();if(a.readOnly){a.btnConfirmar.hide()}a.btnVolver=a.container.find(".btn-volver");a.btnVolver.unbind("click");a.btnVolver.on("click",function(){a.destroy()});a.onLoad();a.container.show()};a.setEnabled=function(c){c.removeAttr("disabled");if(a.readOnly){c.attr("disabled","disabled")}};a.setControlsBytipoFactura=function(){a.divRetencionImpuestoGanancias.hide();a.divRetencionIVA.hide();a.divRetencionIngresosBrutos.hide();a.divImpuestosInternos.hide();a.divImpuestosMunicipales.hide();a.divImporteNetoGravado.hide();a.divImporteNetoNoGravado.hide();a.divIVA27.hide();a.divIVA21.hide();a.divIVA105.hide();a.divIVA5.hide();a.divIVA25.hide();a.divIVA0.hide();a.divSubtotal.hide();if(a.ddlTipoFactura.swidget().value()=="A"||a.ddlTipoFactura.swidget().value()=="M"){a.divRetencionImpuestoGanancias.show();a.divRetencionIVA.show();a.divRetencionIngresosBrutos.show();a.divImpuestosInternos.show();a.divImpuestosMunicipales.show();a.divImporteNetoGravado.show();a.divImporteNetoNoGravado.show();a.divIVA27.show();a.divIVA21.show();a.divIVA105.show();a.divIVA5.show();a.divIVA25.show();a.divIVA0.show()}if(a.ddlTipoFactura.swidget().value()=="B"||a.ddlTipoFactura.swidget().value()=="C"){a.divSubtotal.show()}a.refreshProductos()};a.refreshProductos=function(){var c=[];c.push({field:"Codigo",title:"Código",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({field:"ProductoServicio",title:"Producto / Servicio",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({field:"Unidad",title:"Unidad",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({field:"Cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatNumberWithDecimals});c.push({field:"PrecioUnit",title:"Precio Unitario",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatNumberWithDecimals});c.push({field:"PorcentajeBonificacion",title:"% Bonificación",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatNumberWithDecimals});if(a.ddlTipoFactura.swidget().value()=="B"||a.ddlTipoFactura.swidget().value()=="C"){c.push({field:"ImporteBonificacion",title:"Importe Bonificación",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatNumberWithDecimals})}c.push({field:"Subtotal",title:"Sub-total",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatNumberWithDecimals});if(a.ddlTipoFactura.swidget().value()=="A"||a.ddlTipoFactura.swidget().value()=="M"){c.push({field:"AlicuotaIVA",title:"% Alicuota IVA",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatNumberWithDecimals});c.push({field:"SubtotalConIVA",title:"Sub-total c/IVA",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatNumberWithDecimals})}if(!a.readOnly){c.push({width:90,field:"",title:" ",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),columnTemplate:function(g,h,i){var f=$('<button type="button" title="Modificar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(g);f.on("click",function(){new Core.Business.FacturasProveedores.ManagerProducto({producto:h,tipoFactura:a.ddlTipoFactura.swidget().value(),onConfirm:function(j){a.productos[i]=j;a.refreshProductos()}}).show()});var e=$('<button type="button" title="Descartar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(g);e.on("click",function(){a.productos.remove(a.productos[i]);a.refreshProductos()})}})}var d=a.divProductos.swidget().initialOptions;d.columns=c;d.dataSource.data=a.productos;a.divProductos.swidget().refresh(d)};a.destroy=function(){a.ddlTipoFactura.swidget().destroy();a.txtPuntoVenta.swidget().destroy();a.txtComprobanteNumero.swidget().destroy();a.txtEmision.swidget().destroy();a.txtRazonSocial.swidget().destroy();a.txtCUIT.swidget().destroy();a.txtIngresosBrutos.swidget().destroy();a.txtDomicilioComercial.swidget().destroy();a.txtCondicionIVA.swidget().destroy();a.txtInicioActividad.swidget().destroy();a.txtPeriodoFacturadoDesde.swidget().destroy();a.txtPeriodoFacturadoHasta.swidget().destroy();a.txtVencimientoPago.swidget().destroy();a.txtNumeroCAE.swidget().destroy();a.txtVencimientoCAE.swidget().destroy();a.divProductos.swidget().destroy();a.fileUpload.destroy();a.container.hide();a.onClosed()}};Core.Business.FacturasProveedores.ManagerProducto=function(b){var a=this;a.divModal=$(".div-manager-producto");a.tipoFactura=null;a.producto=null;a.onConfirm=function(){};$.extend(true,a,b);a.decimalCount=2;a.show=function(){a.lblTitulo=a.divModal.find(".label-titulo");a.lblTitulo.text(a.producto?"Editar Producto / Servicio":"Nuevo Producto / Servicio");a.txtCodigo=a.divModal.find(".textbox-codigo");a.txtCodigo.shieldTextBox({value:(a.producto&&a.producto.Codigo!=null)?a.producto.Codigo:""});Core.Functions.Validations.toggleValidation(a.txtCodigo,false);a.txtProducto=a.divModal.find(".textbox-producto");a.txtProducto.shieldTextBox({value:(a.producto&&a.producto.ProductoServicio!=null)?a.producto.ProductoServicio:""});Core.Functions.Validations.toggleValidation(a.txtProducto,false);a.txtCantidad=a.divModal.find(".textbox-cantidad");new Core.Controls.DecimalPicker(a.txtCantidad,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",defaultValue:(a.producto&&a.producto.Cantidad!=null)?a.producto.Cantidad.toString():""});Core.Functions.Validations.toggleValidation(a.txtCantidad,false);a.txtUnidad=a.divModal.find(".textbox-unidad");a.txtUnidad.shieldTextBox({value:(a.producto&&a.producto.Unidad!=null)?a.producto.Unidad:""});Core.Functions.Validations.toggleValidation(a.txtUnidad,false);a.txtPrecioUnitario=a.divModal.find(".textbox-precio-unitario");new Core.Controls.DecimalPicker(a.txtPrecioUnitario,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",defaultValue:(a.producto&&a.producto.PrecioUnit!=null)?a.producto.PrecioUnit.toString():""});Core.Functions.Validations.toggleValidation(a.txtPrecioUnitario,false);a.txtPorcentajeBonificacion=a.divModal.find(".textbox-porcentaje-bonificacion");new Core.Controls.DecimalPicker(a.txtPorcentajeBonificacion,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",enabledZero:true,defaultValue:(a.producto&&a.producto.PorcentajeBonificacion!=null)?a.producto.PorcentajeBonificacion.toString():""});Core.Functions.Validations.toggleValidation(a.txtPorcentajeBonificacion,false);a.txtImporteBonificacion=a.divModal.find(".textbox-importe-bonificacion");new Core.Controls.DecimalPicker(a.txtImporteBonificacion,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",enabledZero:true,defaultValue:(a.producto&&a.producto.ImporteBonificacion!=null)?a.producto.ImporteBonificacion.toString():""});Core.Functions.Validations.toggleValidation(a.txtImporteBonificacion,false);a.divImporteBonificacion=a.divModal.find(".div-importe-bonificacion");a.divImporteBonificacion.hide();if(a.tipoFactura=="B"||a.tipoFactura=="C"){a.divImporteBonificacion.show()}a.txtSubTotal=a.divModal.find(".textbox-subtotal");new Core.Controls.DecimalPicker(a.txtSubTotal,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",defaultValue:(a.producto&&a.producto.Subtotal!=null)?a.producto.Subtotal.toString():""});Core.Functions.Validations.toggleValidation(a.txtSubTotal,false);a.txtAlicuotaIVA=a.divModal.find(".textbox-alicuota-iva");new Core.Controls.DecimalPicker(a.txtAlicuotaIVA,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",enabledZero:true,defaultValue:(a.producto&&a.producto.AlicuotaIVA!=null)?a.producto.AlicuotaIVA.toString():""});Core.Functions.Validations.toggleValidation(a.txtAlicuotaIVA,false);a.divAlicuotaIVA=a.divModal.find(".div-alicuota-iva");a.divAlicuotaIVA.hide();if(a.tipoFactura=="A"||a.tipoFactura=="M"){a.divAlicuotaIVA.show()}a.txtSubTotalIVA=a.divModal.find(".textbox-subtotal-iva");new Core.Controls.DecimalPicker(a.txtSubTotalIVA,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",defaultValue:(a.producto&&a.producto.SubtotalConIVA!=null)?a.producto.SubtotalConIVA.toString():""});Core.Functions.Validations.toggleValidation(a.txtSubTotalIVA,false);a.divSubTotalIVA=a.divModal.find(".div-subtotal-iva");a.divSubTotalIVA.hide();if(a.tipoFactura=="A"||a.tipoFactura=="M"){a.divSubTotalIVA.show()}a.btnConfirmar=a.divModal.find(".btn-confirmar");a.btnConfirmar.unbind("click");a.btnConfirmar.click(function(){var d={value:true};var c={};if(a.producto&&a.producto.IdproductoServicio){c.IdproductoServicio=a.producto.IdproductoServicio}c.Codigo=a.txtCodigo.swidget().value();c.ProductoServicio=Core.Functions.Validations.getValidatedSwidgetValue(a.txtProducto,d);c.Unidad=Core.Functions.Validations.getValidatedSwidgetValue(a.txtUnidad,d);c.Cantidad=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidad,d));c.PrecioUnit=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecioUnitario,d));c.PorcentajeBonificacion=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedInputValue(a.txtPorcentajeBonificacion,d));if(a.tipoFactura=="B"||a.tipoFactura=="C"){c.ImporteBonificacion=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedInputValue(a.txtImporteBonificacion,d))}c.Subtotal=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtSubTotal,d));if(a.tipoFactura=="A"||a.tipoFactura=="M"){c.AlicuotaIVA=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedInputValue(a.txtAlicuotaIVA,d));c.SubtotalConIVA=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtSubTotalIVA,d))}if(d.value){a.onConfirm(c);a.divModal.modal("hide")}});a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.divModal.modal({show:true})};a.destroy=function(){a.txtCodigo.swidget().destroy();a.txtProducto.swidget().destroy();a.txtUnidad.swidget().destroy()}};Core.Business.Faqs=new function(){var a=this;a.timerId=null;a.id="faqs";a.idDefaultAccount=null;a.idDefaultProfile=null;a.iframe=null;a.init=function(b,c,d){Core.loadPage("faqs.html",function(){document.title="FAQS";a.idDefaultAccount=b;a.idDefaultProfile=c;a.iframe=$(".iframe-faqs");$.extend(true,a,d);a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.iframe.attr("src","/static-www-content/faqs/")},"Core.Business.Faqs")})}};Core.Business.FCI=new function(){var a=this;a.id="cot_fci";a.divFCI=null;a.txtFilterFCI=null;a.timeoutFCI=null;a.window=$(window);a.init=function(b,c){Core.loadPage("fci.html",function(){document.title="FCI";a.idDefaultAccount=b;a.idDefaultProfile=c;a.divFCI=$(".div-fci");a.txtFilterFCI=$(".textbox-fci-filter");a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadGrid()},"Core.Business.FCI")})};a.initGrid=function(){function b(d){var c=new Date();c.setYear(c.getFullYear()-d);return Core.Functions.Date.getYearAsString(c)}a.divFCI.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:[{field:"ticker",title:"Ticker",width:"5%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(c,e,d){c.html("<a>"+e.ticker+"</a>");c.addClass("link-cell");c.on("click",function(){Core.Business.DetalleInstrumento.init(a.idDefaultAccount,a.idDefaultProfile,{fondo:e.ticker})})}},{field:"descripcion",title:"Nombre",width:"20%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"fecha",title:"Fecha",width:"6%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{field:"cotizacion",title:"Cuotaparte",width:"8%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"varDiaria",title:"Var. Diaria (%)",width:"8%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatPercentage},{field:"varMensual",title:"Var. Mensual (%)",width:"8%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatPercentage},{field:"varAnual",title:"Var. a/a (%)",width:"8%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatPercentage},{field:"varYTD",title:"Var "+b(0),width:"8%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatPercentage},{field:"varYear1",title:"Var "+b(1),width:"8%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatPercentage},{field:"varYear2",title:"Var "+b(2),width:"8%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatPercentage},{field:"varYear3",title:"Var "+b(3),width:"8%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatPercentage},{field:"varYear4",title:"Var "+b(4),width:"8%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatPercentage}]});a.txtFilterFCI.shieldTextBox({events:{change:function(c){clearTimeout(a.timeoutFCI);a.timeoutFCI=setTimeout(function(){value=c.value;var e=a.window.scrollTop();var d=a.divFCI.swidget().initialOptions;if(value){d.dataSource.filter={or:[{path:"ticker",filter:"contains",value:value},{path:"descripcion",filter:"contains",value:value}]}}else{d.dataSource.filter=null}a.divFCI.swidget().refresh(d);a.window.scrollTop(e)},50)}}})};a.loadGrid=function(){var b=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divFCI.parent(),secureRequest:true,requestUrl:"cotizaciones/fci",requestType:"GET"});b.onSuccess=function(c){var d=a.divFCI.swidget().initialOptions;d.dataSource.data=c.cotizaciones;a.divFCI.swidget().refresh(d)};b.request()}};Core.Business.FlujoProyectado=new function(){var a=this;var b=60000;a.id="flujoProyectado";a.idDefaultAccount=null;a.idDefaultProfile=null;a.divOpcionesVistas=null;a.divVistaDetalle=null;a.divVistaResumen=null;a.btnVistaDetalle=null;a.btnVistaResumen=null;a.divDetallePagos=null;a.btnDetallePagoPesos=null;a.btnTabDetallePagoPesos=null;a.btnDetallePagoDolares=null;a.btnTabDetallePagoDolares=null;a.btnVolver=null;a.divVistaResumenDolaresContainer=null;a.divVistaResumenPesosContainer=null;a.divBonosDolaresContainer=null;a.divBonosPesosContainer=null;a.divLetrasDolaresContainer=null;a.divLetrasPesosContainer=null;a.divPagosDolaresContainer=null;a.divPagosPesosContainer=null;a.gridBonosPesosDetalle=null;a.gridBonosDolaresDetalle=null;a.gridBonosPesosResumen=null;a.gridBonosDolaresResumen=null;a.divBonosPesosDetalle=null;a.divBonosDolaresDetalle=null;a.divBonosPesosResumen=null;a.divBonosDolaresResumen=null;a.gridPagosPesos=null;a.txtFilterPagosPesos=null;a.timeoutFilterPagosPesos=null;a.gridPagosDolares=null;a.txtFilterPagosDolares=null;a.timeoutFilterPagosDolares=null;a.gridLetrasDolaresDetalle=null;a.gridLetrasDolaresResumen=null;a.gridLetrasPesosDetalle=null;a.gridLetrasPesosResumen=null;a.divLetrasDolaresDetalle=null;a.divLetrasDolaresResumen=null;a.divLetrasPesosDetalle=null;a.divLetrasPesosResumen=null;a.divChartPagosPesos=null;a.chartPagosPesos=[];a.divChartPagosDolares=null;a.chartPagosDolares=[];a.lblInstrumentosExcluidos=null;a.divFlujoProyectadoVacio=null;a.pagosPesosDataChart=null;a.pagosDolaresDataChart=null;a.divDateRanges=null;a.divDateRangesResumen=null;a.btnDateRange3Meses=null;a.btnDateRange1Anio=null;a.btnDateRange3Anios=null;a.btnDateRange10Anios=null;a.btnDateRangeMax=null;a.window=$(window);a.init=function(c,d){Core.loadPage("flujo-de-fondo.html",function(){document.title="Flujos Proyectados de Renta Fija";a.idDefaultAccount=c;a.idDefaultProfile=d;a.divOpcionesVistas=$(".div-opciones-vistas");a.divVistaDetalle=$(".div-vista-detalle");a.divVistaResumen=$(".div-vista-resumen");a.btnVistaDetalle=$(".btn-vista-detalle");a.btnVistaResumen=$(".btn-vista-resumen");a.divDetallePagos=$(".div-detalle-pagos");a.divFlujoProyectadoVacio=$(".div-flujo-proyectado-vacio");a.divVistaResumenDolaresContainer=$(".div-vista-resumen-dolares-container");a.divVistaResumenPesosContainer=$(".div-vista-resumen-pesos-container");a.divBonosDolaresContainer=$(".div-bonos-dolares-container");a.divBonosPesosContainer=$(".div-bonos-pesos-container");a.divLetrasDolaresContainer=$(".div-letras-dolares-container");a.divLetrasPesosContainer=$(".div-letras-pesos-container");a.divPagosDolaresContainer=$(".div-pagos-dolares-container");a.divPagosPesosContainer=$(".div-pagos-pesos-container");a.btnDetallePagoPesos=$(".btn-detalle-pago-pesos");a.divMonedasDetallePagos=$(".div-monedas-detalle-pagos");a.btnTabDetallePagoPesos=$(".btn-tab-detalle-pago-pesos");a.divDetallePagoPesos=$(".div-detalle-pago-pesos");a.btnDetallePagoDolares=$(".btn-detalle-pago-dolares");a.btnTabDetallePagoDolares=$(".btn-tab-detalle-pago-dolares");a.divDetallePagoDolares=$(".div-detalle-pago-dolares");a.btnVolver=$(".btn-volver");a.gridBonosPesosDetalle=$(".grid-bonos-pesos-detalle");a.gridBonosDolaresDetalle=$(".grid-bonos-dolares-detalle");a.gridBonosPesosResumen=$(".grid-bonos-pesos-resumen");a.gridBonosDolaresResumen=$(".grid-bonos-dolares-resumen");a.gridPagosPesos=$(".grid-detalle-pagos-pesos");a.txtFilterPagosPesos=$(".textbox-filter-detalle-pagos-pesos");a.gridPagosDolares=$(".grid-detalle-pagos-dolares");a.txtFilterPagosDolares=$(".textbox-filter-detalle-pagos-dolares");a.gridLetrasDolaresDetalle=$(".grid-letras-dolares-detalle");a.gridLetrasDolaresResumen=$(".grid-letras-dolares-resumen");a.gridLetrasPesosDetalle=$(".grid-letras-pesos-detalle");a.gridLetrasPesosResumen=$(".grid-letras-pesos-resumen");a.divChartPagosPesos=$(".chart-pagos-en-pesos");a.divChartPagosDolares=$(".chart-pagos-en-dolares");a.lblInstrumentosExcluidos=$(".lbl-instrumentos-excluidos");a.divDateRanges=$(".div-date-ranges");a.divDateRangesResumen=$(".div-date-ranges-resumen");a.btnDateRange3Meses=$(".btn-date-ranges-3-meses");a.btnDateRange1Anio=$(".btn-date-ranges-1-anio");a.btnDateRange3Anios=$(".btn-date-ranges-3-anios");a.btnDateRange10Anios=$(".btn-date-ranges-10-anios");a.btnDateRangeMax=$(".btn-date-ranges-max");a.divOpcionesVistas.show();a.divVistaDetalle.hide();a.divVistaResumen.show();a.divDetallePagos.hide();a.divFlujoProyectadoVacio.hide();a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,a.idDefaultAccount,a.idDefaultProfile,function(){a.loadGrids()},"Core.Business.FlujoProyectado")})};a.initControls=function(){a.btnVistaDetalle.on("click",function(){a.divOpcionesVistas.show();a.divVistaDetalle.show();a.divVistaResumen.hide();a.divDetallePagos.hide();a.divDateRanges.show();a.divDateRangesResumen.hide();$("html, body").animate({scrollTop:0},1000)});a.btnVistaResumen.on("click",function(){a.divOpcionesVistas.show();a.divVistaDetalle.hide();a.divVistaResumen.show();a.divDetallePagos.hide();a.divDateRanges.show();a.divDateRangesResumen.show();$("html, body").animate({scrollTop:0},1000)});a.btnDetallePagoPesos.on("click",function(){a.divOpcionesVistas.hide();a.divVistaDetalle.hide();a.divVistaResumen.hide();a.divDetallePagos.show();a.divDateRanges.hide();a.divDateRangesResumen.hide();a.btnTabDetallePagoPesos.click();$("html, body").animate({scrollTop:0},1000)});a.btnDetallePagoDolares.on("click",function(){a.divOpcionesVistas.hide();a.divVistaDetalle.hide();a.divVistaResumen.hide();a.divDetallePagos.show();a.divDateRanges.hide();a.divDateRangesResumen.hide();a.btnTabDetallePagoDolares.click();$("html, body").animate({scrollTop:0},1000)});a.btnTabDetallePagoDolares.on("click",function(){a.divDetallePagoPesos.hide();a.divDetallePagoDolares.show()});a.btnTabDetallePagoPesos.on("click",function(){a.divDetallePagoPesos.show();a.divDetallePagoDolares.hide()});a.btnVolver.on("click",function(){a.btnVistaResumen.click()});a.btnDateRange3Meses.on("click",function(){a.setSelectedButton(a.btnDateRange3Meses);var n=new Date();n.setMonth(n.getMonth()+3);for(var o=0;o<a.chartPagosDolares.length;o++){a.chartPagosDolares[o].zoomToDates(new Date(),n)}for(var o=0;o<a.chartPagosPesos.length;o++){a.chartPagosPesos[o].zoomToDates(new Date(),n)}});a.btnDateRange1Anio.on("click",function(){a.setSelectedButton(a.btnDateRange1Anio);var n=new Date();n.setFullYear(n.getFullYear()+1);for(var o=0;o<a.chartPagosDolares.length;o++){a.chartPagosDolares[o].zoomToDates(new Date(),n)}for(var o=0;o<a.chartPagosPesos.length;o++){a.chartPagosPesos[o].zoomToDates(new Date(),n)}});a.btnDateRange3Anios.on("click",function(){a.setSelectedButton(a.btnDateRange3Anios);var n=new Date();n.setFullYear(n.getFullYear()+3);for(var o=0;o<a.chartPagosDolares.length;o++){a.chartPagosDolares[o].zoomToDates(new Date(),n)}for(var o=0;o<a.chartPagosPesos.length;o++){a.chartPagosPesos[o].zoomToDates(new Date(),n)}});a.btnDateRange10Anios.on("click",function(){a.setSelectedButton(a.btnDateRange10Anios);var n=new Date();n.setFullYear(n.getFullYear()+10);for(var o=0;o<a.chartPagosDolares.length;o++){a.chartPagosDolares[o].zoomToDates(new Date(),n)}for(var o=0;o<a.chartPagosPesos.length;o++){a.chartPagosPesos[o].zoomToDates(new Date(),n)}});a.btnDateRangeMax.on("click",function(){a.setSelectedButton(a.btnDateRangeMax);if(a.pagosPesosDataChart){var o=new Date(a.pagosPesosDataChart[a.pagosPesosDataChart.length-1].fecha+" 12:00");for(var p=0;p<a.chartPagosPesos.length;p++){a.chartPagosPesos[p].zoomToDates(new Date(),o)}}if(a.pagosDolaresDataChart){var n=new Date(a.pagosDolaresDataChart[a.pagosDolaresDataChart.length-1].fecha+" 12:00");for(var p=0;p<a.chartPagosDolares.length;p++){a.chartPagosDolares[p].zoomToDates(new Date(),n)}}});var d=[];d.push({field:"codigoespeciebono",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),columnTemplate:function(i,o,n){i.html("<a>"+o.codigoespeciebono+"</a>");i[0].title=o.descripcionbono;i.addClass("link-cell");i.on("click",function(){Core.Business.DetalleInstrumento.init(a.idDefaultAccount,a.idDefaultProfile,{ticker:o.codigoespeciebono})})}});d.push({field:"tenencia",title:"Nominales",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatIntegerNumber});d.push({field:"precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatPrice});d.push({field:"tir",title:"YTM (anual)",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedString});d.push({field:"tna",title:"YTM (nominal)",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedString});d.push({field:"spread",title:"Spread/Mercado",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedString});d.push({field:"currentyield",title:"Current Yield",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedString});d.push({field:"paridad",title:"Paridad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedString});d.push({field:"duration",title:"Duration",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatPrice});d.push({field:"cuponbono",title:"Cupón",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});d.push({field:"frec_pago",title:"Frec.Pago",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});d.push({field:"prox_pago",title:"Prox. Cupón",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});d.push({field:"obsprox_pago",title:"Obs. Prox. Pago",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});d.push({field:"vto",title:"Vencimiento",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});d.push({field:"amort",title:"Amortización",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});d.push({field:"residual",title:"Residual",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedString});var j={dataSource:{data:[],group:[{field:"tipo",order:"asc"}]},selection:false,rowHover:false,sorting:{multiple:true},columns:d,noRecordsText:"No hay información",grouping:{showGroupHeader:false,allowDragToGroup:false,message:"Arrastre un encabezado de columna para agrupar por esa columna"}};a.gridBonosDolaresDetalle.shieldGrid(j);a.gridBonosPesosDetalle.shieldGrid(j);var e=[];e.push({field:"codigoespeciebono",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),columnTemplate:function(i,o,n){i.html("<a>"+o.codigoespeciebono+"</a>");i[0].title=o.descripcionbono;i.addClass("link-cell");i.on("click",function(){Core.Business.DetalleInstrumento.init(a.idDefaultAccount,a.idDefaultProfile,{ticker:o.codigoespeciebono})})}});e.push({field:"tenencia",title:"Nominales",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatIntegerNumber});e.push({field:"precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatPrice});e.push({field:"tir",title:"YTM (anual)",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatUndefinedString});e.push({field:"tna",title:"YTM (nominal)",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatUndefinedString});if(!Core.Functions.isMobile&&!Core.Functions.isTablet){e.push({field:"spread",title:"Spread/Mercado",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatUndefinedString});e.push({field:"duration",title:"Duration",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatPrice});e.push({field:"int_corr",title:"Int. Corridos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatPrice});e.push({field:"prox_pago",title:"Prox. Cupón",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length)})}var k={dataSource:{data:[],group:[{field:"tipo",order:"asc"}]},selection:false,rowHover:false,sorting:{multiple:true},columns:e,noRecordsText:"No hay información",grouping:{showGroupHeader:false,allowDragToGroup:false,message:"Arrastre un encabezado de columna para agrupar por esa columna"}};a.gridBonosDolaresResumen.shieldGrid(k);a.gridBonosPesosResumen.shieldGrid(k);var f=[];f.push({field:"codigoespeciebono",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(f.length),columnTemplate:function(i,o,n){i.html("<a>"+o.codigoespeciebono+"</a>");i[0].title=o.descripcionbono;i.addClass("link-cell");i.on("click",function(){Core.Business.DetalleInstrumento.init(a.idDefaultAccount,a.idDefaultProfile,{ticker:o.codigoespeciebono})})}});f.push({field:"vto",title:"Vencimiento",headerAttributes:Core.Functions.grid.getHeaderAttribute(f.length)});f.push({field:"tenencia",title:"Nominales",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(f.length),format:Core.Functions.grid.formatIntegerNumber});f.push({field:"precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(f.length),format:Core.Functions.grid.formatPrice});f.push({field:"diasrestantes",title:"Días Restantes",headerAttributes:Core.Functions.grid.getHeaderAttribute(f.length),format:Core.Functions.grid.formatIntegerNumber});f.push({field:"tna",title:"TNA",headerAttributes:Core.Functions.grid.getHeaderAttribute(f.length),format:Core.Functions.grid.formatUndefinedString});var m={dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:f,noRecordsText:"No hay información"};a.gridLetrasDolaresDetalle.shieldGrid(m);a.gridLetrasDolaresResumen.shieldGrid(m);a.gridLetrasPesosDetalle.shieldGrid(m);a.gridLetrasPesosResumen.shieldGrid(m);var g=[];g.push({field:"codigoespeciebono",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(g.length),columnTemplate:function(i,o,n){i.html("<a>"+o.codigoespeciebono+"</a>");i.addClass("link-cell");i.on("click",function(){Core.Business.DetalleInstrumento.init(a.idDefaultAccount,a.idDefaultProfile,{ticker:o.codigoespeciebono})})}});g.push({field:"fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(g.length)});g.push({field:"renta",title:"Renta",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(g.length),format:Core.Functions.grid.formatPrice});g.push({field:"amort",title:"Amortización",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(g.length),format:Core.Functions.grid.formatPrice});g.push({field:"total",title:"Total",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(g.length),format:Core.Functions.grid.formatPrice});var l={dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Pagos",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["codigoespeciebono","fecha","renta","amort","total"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Pagos"}}},paging:{pageSize:10,pageLinksCount:10},selection:false,rowHover:false,sorting:{multiple:true},columns:g,noRecordsText:"No hay información"};a.gridPagosDolares.shieldGrid(l);a.gridPagosPesos.shieldGrid(l);a.txtFilterPagosPesos.on("keydown",function(){clearTimeout(a.timeoutFilterPagosPesos);a.timeoutFilterPagosPesos=setTimeout(function(){value=a.txtFilterPagosPesos.val();var i=a.gridPagosPesos.swidget().dataSource;if(value){i.filter={or:[{path:"codigoespeciebono",filter:"contains",value:value},{path:"fecha",filter:"contains",value:value},{path:"renta",filter:"contains",value:value},{path:"amort",filter:"contains",value:value},{path:"total",filter:"contains",value:value}]}}else{i.filter=null}i.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilterPagosPesos,"Core.Business.FlujoProyectado.txtFilterPagosPesos");a.txtFilterPagosDolares.on("keydown",function(){clearTimeout(a.timeoutFilterPagosDolares);a.timeoutFilterPagosDolares=setTimeout(function(){value=a.txtFilterPagosDolares.val();var i=a.gridPagosDolares.swidget().dataSource;if(value){i.filter={or:[{path:"codigoespeciebono",filter:"contains",value:value},{path:"fecha",filter:"contains",value:value},{path:"renta",filter:"contains",value:value},{path:"amort",filter:"contains",value:value},{path:"total",filter:"contains",value:value}]}}else{i.filter=null}i.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilterPagosDolares,"Core.Business.FlujoProyectado.txtFilterPagosDolares");for(var h=0;h<a.divChartPagosPesos.length;h++){var c=AmCharts.makeChart(a.divChartPagosPesos[h],{type:"serial",categoryField:"fecha",dataDateFormat:"YYYY-MM-DD",marginRight:20,marginTop:20,fontSize:12,theme:"default",categoryAxis:{parseDates:true,},chartScrollbar:{enabled:true,},chartCursor:{enabled:true},trendLines:[],graphs:[{columnWidth:20,id:"AmGraph-1",valueAxis:"v1",lineAlpha:2,lineColor:"#254C79",fillColors:"#254C79",title:"Pagos en Pesos",fillAlphas:0.25,type:"column",valueField:"total",balloonText:"<b>[[codigoespeciebono]]</b> [[rentaamort]]: <b>$[[value]]</b>"}],guides:[],valueAxes:[{id:"v1",title:"Pesos"}],allLabels:[],balloon:{},titles:[]});a.chartPagosPesos.push(c)}for(var h=0;h<a.divChartPagosDolares.length;h++){var c=AmCharts.makeChart(a.divChartPagosDolares[h],{type:"serial",categoryField:"fecha",dataDateFormat:"YYYY-MM-DD",marginRight:20,marginTop:20,fontSize:12,theme:"default",categoryAxis:{parseDates:true,},chartScrollbar:{enabled:true,},chartCursor:{enabled:true},graphs:[{columnWidth:20,id:"AmGraph-1",valueAxis:"v1",lineAlpha:2,lineColor:"#488348",fillColors:"#488348",title:"Pagos en Dolares",fillAlphas:0.25,type:"column",valueField:"total",balloonText:"<b>[[codigoespeciebono]]</b> [[rentaamort]]: <b>$[[value]]</b>"}],guides:[],valueAxes:[{id:"v1",title:"Dólares"}],allLabels:[],balloon:{},titles:[]});a.chartPagosDolares.push(c)}};a.loadGrids=function(){var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"bonos/flujoproyectado/"+encodeURIComponent(a.idDefaultAccount),requestType:"GET"});c.onSuccess=function(k){var d=$.grep(k.tabla,function(x,i){return(x.tipo_moneda==Core.Enums.Currency.Dolares.idMoneda&&(x.tipo!="LETEs"&&x.tipo!="LECAPs"&&x.tipo!="LECERs"&&x.tipo!="LETEs - LECAPs - LECERs"))});var e=a.gridBonosDolaresDetalle.swidget().initialOptions;e.dataSource.data=d;a.gridBonosDolaresDetalle.swidget().refresh(e);var f=a.gridBonosDolaresResumen.swidget().initialOptions;f.dataSource.data=d;a.gridBonosDolaresResumen.swidget().refresh(f);if(d.length>0){a.divBonosDolaresContainer.show()}else{a.divBonosDolaresContainer.hide()}var n=$.grep(k.tabla,function(x,i){return(x.tipo_moneda==Core.Enums.Currency.Dolares.idMoneda&&(x.tipo=="LETEs"||x.tipo=="LECAPs"||x.tipo=="LECERs"||x.tipo=="LETEs - LECAPs - LECERs"))});var o=a.gridLetrasDolaresDetalle.swidget().initialOptions;o.dataSource.data=n;a.gridLetrasDolaresDetalle.swidget().refresh(o);var p=a.gridLetrasDolaresResumen.swidget().initialOptions;p.dataSource.data=n;a.gridLetrasDolaresResumen.swidget().refresh(p);if(n.length>0){a.divLetrasDolaresContainer.show()}else{a.divLetrasDolaresContainer.hide()}if(d.length>0||n.length>0){a.divVistaResumenDolaresContainer.show()}else{a.divVistaResumenDolaresContainer.hide()}var g=$.grep(k.tabla,function(x,i){return(x.tipo_moneda==Core.Enums.Currency.Pesos.idMoneda&&(x.tipo!="LETEs"&&x.tipo!="LECAPs"&&x.tipo!="LECERs"&&x.tipo!="LETEs - LECAPs - LECERs"))});var h=a.gridBonosPesosDetalle.swidget().initialOptions;h.dataSource.data=g;a.gridBonosPesosDetalle.swidget().refresh(h);var j=a.gridBonosPesosResumen.swidget().initialOptions;j.dataSource.data=g;a.gridBonosPesosResumen.swidget().refresh(j);if(g.length>0){a.divBonosPesosContainer.show()}else{a.divBonosPesosContainer.hide()}var q=$.grep(k.tabla,function(x,i){return(x.tipo_moneda==Core.Enums.Currency.Pesos.idMoneda&&(x.tipo=="LETEs"||x.tipo=="LECAPs"||x.tipo=="LECERs"||x.tipo=="LETEs - LECAPs - LECERs"))});var r=a.gridLetrasPesosDetalle.swidget().initialOptions;r.dataSource.data=q;a.gridLetrasPesosDetalle.swidget().refresh(r);var s=a.gridLetrasPesosResumen.swidget().initialOptions;s.dataSource.data=q;a.gridLetrasPesosResumen.swidget().refresh(s);if(q.length>0){a.divLetrasPesosContainer.show()}else{a.divLetrasPesosContainer.hide()}if(g.length>0||q.length>0){a.divVistaResumenPesosContainer.show()}else{a.divVistaResumenPesosContainer.hide()}var v=$.grep(k.flujo,function(x,i){return x.tipo_moneda==Core.Enums.Currency.Pesos.idMoneda});var w=a.gridPagosPesos.swidget().initialOptions;w.dataSource.data=v;w.exportOptions.excel.dataSource.data=v;w.exportOptions.excel.readDataSource=true;a.gridPagosPesos.swidget().refresh(w);a.txtFilterPagosPesos.keydown();if(v.length>0){a.divPagosPesosContainer.show();a.pagosPesosDataChart=$.grep(v,function(x,i){return true});a.pagosPesosDataChart.unshift({amort:null,codigoespeciebono:null,fecha:a.getDateAsString(new Date()),renta:null,rentaamort:null,tipo_moneda:null,total:null,vr:null});for(var l=0;l<a.chartPagosPesos.length;l++){a.chartPagosPesos[l].dataProvider=a.pagosPesosDataChart;a.chartPagosPesos[l].validateData()}}else{a.divPagosPesosContainer.hide()}var t=$.grep(k.flujo,function(x,i){return x.tipo_moneda==Core.Enums.Currency.Dolares.idMoneda});var u=a.gridPagosDolares.swidget().initialOptions;u.dataSource.data=t;u.exportOptions.excel.dataSource.data=t;u.exportOptions.excel.readDataSource=true;a.gridPagosDolares.swidget().refresh(u);a.txtFilterPagosDolares.keydown();if(t.length>0){a.divPagosDolaresContainer.show();a.pagosDolaresDataChart=$.grep(t,function(x,i){return true});a.pagosDolaresDataChart.unshift({amort:null,codigoespeciebono:null,fecha:a.getDateAsString(new Date()),renta:null,rentaamort:null,tipo_moneda:null,total:null,vr:null});for(var l=0;l<a.chartPagosDolares.length;l++){a.chartPagosDolares[l].dataProvider=a.pagosDolaresDataChart;a.chartPagosDolares[l].validateData()}}else{a.divPagosDolaresContainer.hide()}if(t.length>0||v.length>0){a.btnDateRange3Anios.click()}if(t.length>0&&v.length>0){a.divMonedasDetallePagos.show()}else{a.divMonedasDetallePagos.hide()}if(d.length==0&&g.length==0&&n.length==0&&q.length==0&&t.length==0&&v.length==0){a.divFlujoProyectadoVacio.show();a.divOpcionesVistas.hide();a.divVistaDetalle.hide();a.divVistaResumen.hide();a.divDetallePagos.hide();a.divDateRanges.hide()}if(k.excluidos.length>0){var m="";k.excluidos.forEach(function(x,i){m+=(((m=="")?"":", ")+x.codigoespeciebono)});a.lblInstrumentosExcluidos.text("Los siguientes instrumentos no fueron incluídos en el análisis del flujo de fondos: "+m);a.lblInstrumentosExcluidos.show()}else{a.lblInstrumentosExcluidos.hide()}};c.request()};a.getDateAsString=function(c){if(!c){return""}return c.getFullYear().toString()+"-"+Core.Functions.Date.getTwoCharsNumber(c.getMonth()+1)+"-"+Core.Functions.Date.getTwoCharsNumber(c.getDate())};a.setSelectedButton=function(c){a.btnDateRange3Meses.removeClass("amChartsButtonSelected amChartsButton").addClass("amChartsButton");a.btnDateRange1Anio.removeClass("amChartsButtonSelected amChartsButton").addClass("amChartsButton");a.btnDateRange3Anios.removeClass("amChartsButtonSelected amChartsButton").addClass("amChartsButton");a.btnDateRange10Anios.removeClass("amChartsButtonSelected amChartsButton").addClass("amChartsButton");a.btnDateRangeMax.removeClass("amChartsButtonSelected amChartsButton").addClass("amChartsButton");c.removeClass("amChartsButton").addClass("amChartsButtonSelected")}};Core.Business.FondosExtractos=new function(){var a=this;a.id="fondos-extractos";a.divReporteExtractos=null;a.lblTitle=null;a.chkIncluirFinalizados=null;a.txtDateFrom=null;a.txtDateTo=null;a.timerId=null;a.btnRefresh=null;a.btnDescargarInterfaz=null;a.divBanco=null;a.ddlBanco=null;a.loaded=false;a.timeout=null;a.btnConfirmarArchivo=null;a.inputFiles=null;a.window=$(window);a.dataGrid=null;a.divContadores=null;a.coloresActivos={};a.init=function(b,c){Core.loadPage("fondos-extractos.html",function(){document.title="Extractos";a.divReporteExtractos=$(".div-reporte-extractos");a.lblTitle=$(".label-title");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.btnRefresh=$(".btn-refresh");a.btnDescargarInterfaz=$(".btn-descargar-interfaz");a.divBanco=$(".div-banco");a.ddlBanco=$(".dropdown-banco");a.chkIncluirFinalizados=$(".checkbox-incluir-finalizados");a.inputFiles=$(".input-upload-file");a.btnConfirmarArchivos=$(".btn-confirmar-archivos");a.divContadores=$(".div-contadores");a.initControls();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loaded=false;a.loadGrid()},"Core.Business.FondosExtractos")})};a.initControls=function(){var b=new Date();b.setDate(b.getDate()-1);a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:b,max:new Date(),events:{change:function(c){a.loaded=false;a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loaded=false;a.loadGrid()}}});a.ddlBanco.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",events:{select:function(c){a.refreshGrid()}},width:"85%"});a.btnRefresh.on("click",function(){a.loaded=false;a.loadGrid()});a.btnConfirmarArchivos.on("click",function(){for(var j=0,e;e=a.inputFiles[0].files[j];j++){var g=e.name.split(".");var d=g[g.length-1];if(d!="csv"&&d!="xls"&&d!="xlsx"){var k=new Core.Controls.Dialog("Aviso","<p>Los archivos seleccionados deben ser: csv, xls, xlsx.</p>",{displayButtons:{close:true,accept:false}}).show();return}}var h={Authorization:Core.Objects.Context.Token,Accept:"application/json"};var c=new FormData();for(var j=0,e;e=a.inputFiles[0].files[j];j++){c.append("file-"+j,e)}$.ajax({type:"POST",url:Core.Origin+"/backoffice/"+Core.PrefixUrl+"upload/csv/extractos/2",data:c,cache:false,contentType:false,processData:false,method:"POST",headers:h,success:function(f){a.inputFiles.val("");a.loaded=false;a.loadGrid();new Core.Controls.Dialog(title,"<p>Finalizo la importación del archivo.</p>",{displayButtons:{close:true,accept:false}}).show()},error:function(i){var m=JSON.parse(i.responseText);var n=(m&&m.descripcion)?"Mensaje":"Error de conexión";var f=(m&&m.descripcion)?m.descripcion:"Algunos componentes de la página no se cargaron correctamente. Por favor intente mas tarde...";var l=new Core.Controls.Dialog(n,"<p>"+f+"</p>",{displayButtons:{close:true,accept:false}});l.show()}})});a.btnDescargarInterfaz.on("click",function(){function e(m){var l=new Blob([m.response],{type:m.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(l);return}var f=window.URL.createObjectURL(l);var k=document.createElement("a");k.href=f;var h=m.getResponseHeader("Content-Disposition").split("; ");var g="filename=reporte.xlsx";for(var j=0;j<h.length;j++){if(h[j].indexOf("filename")>=0){g=h[j]}}k.download=g.split("=")[1];k.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(f)}var c=new XMLHttpRequest();var d=Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"backoffice/reportefondos/archivointerfazextractosbancarios?";d+="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));d+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));d+="&Fondo="+encodeURIComponent(a.ddlBanco.swidget().selectedItem().value);c.open("GET",d,true);c.responseType="blob";c.setRequestHeader("Authorization",Core.Objects.Context.Token);c.onload=function(f){if(c.status==200){e(c)}else{var g=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga del reporte.</p>",{displayButtons:{close:true,accept:false}});g.show()}};c.send()});a.chkIncluirFinalizados.on("change",function(){a.loaded=false;a.loadGrid()})};a.initGrid=function(){var b=[];b.push({field:"idExtracto",title:"Extracto",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Fecha",title:"Fecha",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"CuentaBalanz",title:"Fondo",width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"CUIL",title:"CUIL",width:"7%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Nombre",title:"Nombre",width:"15%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Importe",title:"Importe",width:"5%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatPrice});b.push({title:"Obs.",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,d,e){if(d.Observacion){var f=(d.length>140)?(d.Observacion.substr(0,140)+"..."):(d.Observacion);c.html('<button type="button" title="'+f+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');c.addClass("link-cell");c.on("click",function(){var g=new Core.Controls.Dialog("Observaciones",(d.Observacion)?d.Observacion:"",{displayButtons:{close:true,accept:false}});g.show()})}}});b.push({field:"idOrden",title:"Orden",width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,d,e){if(d.idOrdenNegritas==1){c.html("<a><strong>"+(d.idOrden==""?"No definido":d.idOrden)+"</strong></a>")}else{c.html("<a>"+(d.idOrden==""?"No definido":d.idOrden)+"</a>")}c.addClass("link-cell");c.on("click",function(){new Core.Controls.Prompt("Modificar nº orden","Ingrese nuevo nº (vacio para blanquearlo)",{allowEmptyText:true,onAccepted:function(g){if($.isNumeric(g)||g==""){var f=new Core.Ajax.ServerRequest({requestUrl:"backoffice/extractos/actualizar",requestData:{data:{idExtracto:d.idExtracto,idOrden:(g==""?" ":g)}}});f.onSuccess=function(h){a.loadGrid()};f.request()}}}).show()});if(d.ColorFila!=""){c.parent().css("background-color","rgba("+a.hexToRgb(d.ColorFila)+((e%2==0)?", 0.6":", 1 ")+")")}}});b.push({title:"Comp.",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,d,e){if(d.idArchivoComprobante!=0){c.html('<button type="button" title="Descargar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');c.addClass("link-cell");c.on("click",function(){function g(o){var n=new Blob([o.response],{type:o.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(n);return}var h=window.URL.createObjectURL(n);var m=document.createElement("a");m.href=h;var k=o.getResponseHeader("Content-Disposition").split("; ");var j="filename=reporte.xlsx";for(var l=0;l<k.length;l++){if(k[l].indexOf("filename")>=0){j=k[l]}}m.download=j.split("=")[1];m.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(h)}var f=new XMLHttpRequest();f.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"comprobantes/"+d.idTipoArchivo+"/"+d.idArchivoComprobante,true);f.responseType="blob";f.setRequestHeader("Authorization",Core.Objects.Context.Token);f.onload=function(h){if(f.status==200){g(f)}else{var i=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga del reporte.</p>",{displayButtons:{close:true,accept:false}});i.show()}};f.send()})}}});b.push({title:"Coutapartista",width:"7%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,d,e){if(d.CuentaNegritas==1){c.html("<a><strong>"+(d.Cuenta==""?"No definido":d.Cuenta)+"</strong></a>")}else{c.html("<a>"+(d.Cuenta==""?"No definido":d.Cuenta)+"</a>")}c.addClass("link-cell");c.on("click",function(){var f=new Core.Business.FondosExtractos.ChangeNumeroCuenta({cuenta:d,onSuccess:function(){a.loadGrid()}}).show()})}});b.push({field:"DescripcionCuenta",title:"Descripción",width:"18%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Solicitud",title:"Solicitud",width:"7%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({title:"Número Solicitud",width:"7%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,d,e){if(d.NumeroReciboNegritas==1){c.html("<a><strong>"+(d.NumeroRecibo==""?"No definido":d.NumeroRecibo)+"</strong></a>")}else{c.html("<a>"+(d.NumeroRecibo==""?"No definido":d.NumeroRecibo)+"</a>")}c.addClass("link-cell");c.on("click",function(){new Core.Controls.Prompt("Modificar nº de solicitud","Ingrese nuevo nº (vacio para blanquearlo)",{allowEmptyText:true,onAccepted:function(g){if($.isNumeric(g)||g==""){var f=new Core.Ajax.ServerRequest({requestUrl:"backoffice/extractos/actualizar",requestData:{data:{idExtracto:d.idExtracto,numExternoManual:(g==""?" ":g)}}});f.onSuccess=function(h){a.loadGrid()};f.request()}}}).show()})}});b.push({title:"Fin.",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,e,f){var c;if(e.Finalizado){c=$('<button type="button" title="Finalizado, click para deshacer" class="btn-sm balanz-button" style="background-color: green;border-color: green;"><span class="glyphicon glyphicon-ok"></span></button>').appendTo(d)}else{c=$('<button type="button" title="No finalizado, click para finalizar" class="btn-sm balanz-button" style="background-color: grey;border-color: grey;"><span class="glyphicon glyphicon-ok"></span></button>').appendTo(d)}c.on("click",function(){var g=new Core.Ajax.ServerRequest({overlatElement:c,requestUrl:"backoffice/extractos/actualizar",requestData:{data:{idExtracto:e.idExtracto,finalizado:(e.Finalizado==1?0:1)}}});g.onSuccess=function(h){a.loaded=false;a.loadGrid()};g.request()})}});a.divReporteExtractos.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Extractos",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["idExtracto","Fecha","CuentaBalanz","CUIL","Nombre","Importe","Observacion","idOrden","Cuenta","DescripcionCuenta","Solicitud","NumeroRecibo","Finalizado"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Extractos"}}},selection:false,rowHover:false,sorting:{multiple:true},columns:b})};a.loadGrid=function(){a.lblTitle.text("Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var b="idNegocio=2";b+="&FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));b+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));b+="&incluirFinalizados="+((a.chkIncluirFinalizados[0].checked)?"1":"0");var c=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,overlayElement:a.divReporteExtractos.parent(),secureRequest:true,requestUrl:"backoffice/extractos",requestType:"GET",requestData:b});c.onSuccess=function(f){a.dataGrid=f;var e=[];f.extractos.forEach(function(j,i){if(e.indexOf(j.ColorFila)==-1){e.push(j.ColorFila)}});e.sort(function(i,j){if(i>j){return 1}else{return -1}});a.divContadores.empty();$('<label style="width:100px;" class="text-center">Total: '+f.extractos.length+"</label>").appendTo(a.divContadores);e.forEach(function(k,j){var i=$.grep(f.extractos,function(n,m){return n.ColorFila==k});var l=$('<label class="text-center lblColorContador" color="'+k+'" activo="'+((a.coloresActivos[k]==false)?"false":"true")+'" style="color: #2d2d2d !important; border-radius:4px; margin-right:3px; width:75px; border: 4px solid '+(k?k:"transparent")+"; background-color:"+((a.coloresActivos[k]==false)?"#c4c4c4":k)+';">'+i.length+"</label>").appendTo(a.divContadores);if(a.coloresActivos[k]==null){a.coloresActivos[k]=true}l.on("click",function(){a.setColor(l)})});var d=[];var g=[{value:"Todos",text:"Todos"}];f.extractos.forEach(function(j,i){if(d.indexOf(j.CuentaBalanz)==-1){d.push(j.CuentaBalanz);g.push({value:j.CuentaBalanz,text:j.CuentaBalanz})}});var h=a.ddlBanco.swidget().initialOptions;h.dataSource.data=g;a.ddlBanco.swidget().refresh(h);a.divBanco.hide();if(d.length>1){a.divBanco.show()}a.refreshGrid();a.loaded=true};c.request()};a.setColor=function(b){if(b.attr("activo")=="true"){b.css("background-color","#c4c4c4");b.attr("activo","false");a.coloresActivos[b.attr("color")]=false}else{b.css("background-color",b.attr("color"));b.attr("activo","true");a.coloresActivos[b.attr("color")]=true}a.refreshGrid()};a.refreshGrid=function(){var c=$.grep(a.dataGrid.extractos,function(j,h){return true});if(a.ddlBanco.swidget().selectedItem().value!="Todos"){c=$.grep(c,function(i,h){return i.CuentaBalanz==a.ddlBanco.swidget().selectedItem().value})}var b=$(".lblColorContador");for(var d=0;d<b.length;d++){var f=$(b[d]);if(f.attr("activo")=="false"){c=$.grep(c,function(j,h){return j.ColorFila!=f.attr("color")})}}var g=a.window.scrollTop();var e=a.divReporteExtractos.swidget().initialOptions;e.dataSource.data=c;e.dataSource.sort=a.divReporteExtractos.swidget().dataSource.sort;e.exportOptions.excel.dataSource.data=c;e.exportOptions.excel.readDataSource=true;a.divReporteExtractos.swidget().refresh(e);a.window.scrollTop(g)};a.hexToRgb=function(d){d=d.replace("#","");var f=parseInt(d.substring(0,2),16);var e=parseInt(d.substring(2,4),16);var c=parseInt(d.substring(4,6),16);var h=f+","+e+","+c;return h}};Core.Business.FondosExtractos.ChangeNumeroCuenta=function(b){var a=this;a.divModal=$(".div-fondos-cambio-numero-cuenta");a.ddlNumeroCuentaSugeridas=null;a.divNuevoNumeroCuentaExterno=null;a.txtNuevoNumeroCuenta=null;a.cuenta=null;a.onSuccess=function(){};$.extend(true,a,b);a.show=function(){var c=new Core.Ajax.ServerRequest({requestUrl:"backoffice/extractos/cuentassugeridas/"+a.cuenta.idExtracto,requestType:"GET"});c.onSuccess=function(e){e.cuentassugeridas.unshift({Descripcion:"No definido",numCuentaExterno:"No definido"});e.cuentassugeridas.push({Descripcion:"Otro",numCuentaExterno:"Otro"});a.divNuevoNumeroCuentaExterno=a.divModal.find(".div-nuevo-numero-cuenta");a.txtNuevoNumeroCuenta=a.divModal.find(".textbox-nuevo-numero-cuenta");var d=$.grep(e.cuentassugeridas,function(g,f){return g.numCuentaExterno==a.cuenta.Cuenta})[0];new Core.Controls.DecimalPicker(a.txtNuevoNumeroCuenta,{maxDecimalDigitCount:0,showThousandsSeparator:"",defaultValue:(d)?"":a.cuenta.Cuenta.toString()});a.ddlNumeroCuentaSugeridas=a.divModal.find(".dropdown-numero-cuenta-sugeridos");a.ddlNumeroCuentaSugeridas.shieldDropDown({dataSource:{data:e.cuentassugeridas},textTemplate:"{Descripcion}",valueTemplate:"{numCuentaExterno}",value:(d)?a.cuenta.Cuenta:((a.cuenta.Cuenta=="")?"No definido":"Otro"),events:{select:function(f){a.ddlNumeroCuentaSugeridasChange()}}});a.divModal.find(".btn-confirmar-cambio-numero-cuenta").unbind("click");a.divModal.find(".btn-confirmar-cambio-numero-cuenta").click(function(){var f=a.ddlNumeroCuentaSugeridas.swidget().selectedItem().numCuentaExterno;if(f=="Otro"){f=a.txtNuevoNumeroCuenta.val()}if(f=="No definido"){f=""}var g=new Core.Ajax.ServerRequest({requestUrl:"backoffice/extractos/actualizar",requestData:{data:{idExtracto:a.cuenta.idExtracto,numCuentaExterno:f}}});g.onSuccess=function(h){a.onSuccess();a.divModal.modal("hide")};g.request()});a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.divModal.on("shown.bs.modal",function(){a.ddlNumeroCuentaSugeridas.focus()});a.divModal.modal({show:true});a.ddlNumeroCuentaSugeridasChange()};c.request()};a.ddlNumeroCuentaSugeridasChange=function(){if(a.ddlNumeroCuentaSugeridas.swidget().selectedItem().numCuentaExterno=="Otro"){a.divNuevoNumeroCuentaExterno.show()}else{a.divNuevoNumeroCuentaExterno.hide()}};a.destroy=function(){a.ddlNumeroCuentaSugeridas.swidget().destroy()}};Core.Business.FondosInstrumentosExentos=new function(){var a=this;a.id="homeFondosInstrumentosExentos";a.pageOptions=null;a.init=function(b,c){Core.loadPage("fondos-instrumentos-exentos.html",function(){document.title="Fondos Instrumentos Exentos";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divMain=$(".div-main");a.divDiasExentos=$(".div-dias-exentos");a.divPorcentajeExentoPorDia=$(".div-porcentaje-exento-por-dia");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.btnDetails=$(".btn-details");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrids,"Core.Business.FondosInstrumentosExentos")})};a.initControls=function(){var d=new Date();d.setDate(d.getDate()-30);a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:d,max:new Date(),events:{change:function(f){a.loadGrids()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(f){a.loadGrids()}}});a.btnDetails.on("click",function(){new Core.Business.FondosInstrumentosExentos.Detalle({dateFrom:a.txtDateFrom.swidget().value(),dateTo:a.txtDateTo.swidget().value(),overlayElement:a.btnDetails,onLoad:function(){a.divMain.hide()},onClosed:function(){a.divMain.show()}}).show()});var b=[];b.push({field:"Fondo",title:"Fondo",width:"50%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"DiasExcedidos",title:"Días Excedidos",width:"50%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({width:40,title:" ",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(f,g,h){var e=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-search"></span></button>').appendTo(f);e.on("click",function(){new Core.Business.FondosInstrumentosExentos.Detalle({fondo:g.Fondo,codFondo:g.CodFondo,dateFrom:a.txtDateFrom.swidget().value(),dateTo:a.txtDateTo.swidget().value(),overlayElement:e,onLoad:function(){a.divMain.hide()},onClosed:function(){a.divMain.show()}}).show()})}});a.divDiasExentos.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Fondos Instrumentos Exentos - Días Exentos",columnFields:["Fondo","DiasExcedidos"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Fondos Instrumentos Exentos - Días Exentos"}}},paging:{pageSize:100,pageLinksCount:10},selection:false,rowHover:false,columns:b});var c=[];c.push({field:"Fecha",title:"Fecha",width:"25%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"Fondo",title:"Fondo",width:"25%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"PorcentajeExento",title:"Porcentaje Exento",width:"25%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"Excedio75",title:"Excedió 75",width:"25%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({width:40,title:" ",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),columnTemplate:function(f,g,h){var e=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-search"></span></button>').appendTo(f);e.on("click",function(){new Core.Business.FondosInstrumentosExentos.Detalle({fondo:g.Fondo,codFondo:g.CodFondo,dateFrom:Core.Functions.Date.getDateByStringDisplayDate(g.Fecha),dateTo:Core.Functions.Date.getDateByStringDisplayDate(g.Fecha),overlayElement:e,onLoad:function(){a.divMain.hide()},onClosed:function(){a.divMain.show()}}).show()})}});a.divPorcentajeExentoPorDia.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Fondos Instrumentos Exentos - Porcentajes Agrupados por Día",columnFields:["Fondo","Fecha","PorcentajeExento","Excedio75"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Fondos Instrumentos Exentos - Porcentajes Agrupados por Día"}}},paging:{pageSize:100,pageLinksCount:10},selection:false,rowHover:false,columns:c})};a.loadGrids=function(){if(a.txtDateFrom.swidget().value()&&a.txtDateTo.swidget().value()){var b=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"fondos/instrumentosExentos/"+Core.Functions.Date.getDisplayDateWithSeparator(a.txtDateFrom.swidget().value(),"-")+"/"+Core.Functions.Date.getDisplayDateWithSeparator(a.txtDateTo.swidget().value(),"-")+"/AgrupPorDiasExentos",requestType:"GET"});b.onSuccess=function(c){var d=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"fondos/instrumentosExentos/"+Core.Functions.Date.getDisplayDateWithSeparator(a.txtDateFrom.swidget().value(),"-")+"/"+Core.Functions.Date.getDisplayDateWithSeparator(a.txtDateTo.swidget().value(),"-")+"/AgrupadoPorDia",requestType:"GET"});d.onSuccess=function(e){a.refreshGrids(c.Datos?c.Datos:[],e.Datos?e.Datos:[])};d.request()};b.request()}else{a.refreshGrids([],[]);new Core.Controls.Dialog("Aviso","Debe seleccionar un rango de fechas válido.",{displayButtons:{close:true,accept:false}}).show()}};a.refreshGrids=function(b,d){var c=a.divDiasExentos.swidget().initialOptions;c.dataSource.data=b;c.exportOptions.excel.dataSource.data=b;c.exportOptions.excel.readDataSource=true;a.divDiasExentos.swidget().refresh(c);var c=a.divPorcentajeExentoPorDia.swidget().initialOptions;c.dataSource.data=d;c.exportOptions.excel.dataSource.data=d;c.exportOptions.excel.readDataSource=true;a.divPorcentajeExentoPorDia.swidget().refresh(c)}};Core.Business.FondosInstrumentosExentos.Detalle=function(b){var a=this;a.container=$(".div-container-detalle-fondo");a.onLoad=function(){};a.onClosed=function(){};a.fondo=null;a.codFondo=null;a.overlayElement=null;a.dateFrom=null;a.dateTo=null;a.timeout=null;$.extend(true,a,b);a.show=function(){a.initControls();var c={};if(a.codFondo){c.fondo=a.codFondo}var d=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.overlayElement,requestUrl:"fondos/instrumentosExentos/"+Core.Functions.Date.getDisplayDateWithSeparator(a.dateFrom,"-")+"/"+Core.Functions.Date.getDisplayDateWithSeparator(a.dateTo,"-")+"/DetalleInstrumentos",requestType:"GET",requestData:c});d.onSuccess=function(e){var f=a.divDetalle.swidget().initialOptions;f.dataSource.data=e.Datos?e.Datos:[];f.exportOptions.excel.dataSource.data=e.Datos?e.Datos:[];f.exportOptions.excel.readDataSource=true;a.divDetalle.swidget().refresh(f);a.onLoad();a.container.show();$("html, body").animate({scrollTop:0},1000)};d.request()};a.initControls=function(){var d=((a.fondo?("Detalle Fondo: "+a.fondo):"Detalles ")+" del "+Core.Functions.Date.getDisplayDate(a.dateFrom)+" al "+Core.Functions.Date.getDisplayDate(a.dateTo));a.lblTitle=a.container.find(".lbl-title");a.lblTitle.text(d);a.txtFilter=a.container.find(".textbox-filter");a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var e=a.divDetalle.swidget().dataSource;if(value){e.filter={or:[{path:"Fondo",filter:"contains",value:value},{path:"Fecha",filter:"contains",value:value},{path:"CodigoEspecie",filter:"contains",value:value},{path:"Importe",filter:"contains",value:value},{path:"PorcentajeCartera",filter:"contains",value:value},{path:"exentoGravado",filter:"contains",value:value},]}}else{e.filter=null}e.read()},50)});var c=[];c.push({field:"Fondo",title:"Fondo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"Fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"CodigoEspecie",title:"Código Especie",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"Importe",title:"Importe",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"PorcentajeCartera",title:"Porcentaje Cartera",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"exentoGravado",title:"Exento Gravado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});a.divDetalle=a.container.find(".div-detalle-fondo");a.divDetalle.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:("Fondos Instrumentos Exentos - "+d),columnFields:["Fondo","Fecha","CodigoEspecie","Importe","PorcentajeCartera","exentoGravado"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:("Fondos Instrumentos Exentos - "+d)}}},paging:{pageSize:100,pageLinksCount:10},selection:false,rowHover:false,columns:c});a.btnVolver=a.container.find(".btn-volver");a.btnVolver.unbind("click");a.btnVolver.on("click",function(){a.destroy()})};a.destroy=function(){a.divDetalle.swidget().destroy();a.txtFilter.val("");a.container.hide();a.onClosed();$("html, body").animate({scrollTop:0},1000)}};Core.Business.FondosLiquidaciones=new function(){var a=this;a.id="fondos-liquidaciones";a.divReporteLiquidaciones=null;a.lblTitle=null;a.txtDateFrom=null;a.txtDateTo=null;a.timerId=null;a.btnRefresh=null;a.divFondo=null;a.chkInconsistencias=null;a.ddlFondo=null;a.loaded=false;a.window=$(window);a.dataGrid=null;a.init=function(b,c){Core.loadPage("fondos-liquidaciones.html",function(){document.title="Liquidaciones";a.divReporteLiquidaciones=$(".div-reporte-liquidaciones");a.lblTitle=$(".label-title");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.btnRefresh=$(".btn-refresh");a.divFondo=$(".div-fondo");a.ddlFondo=$(".dropdown-fondo");a.chkInconsistencias=$(".checkbox-inconsistencias");a.initControls();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loaded=false;a.loadGrid()},"Core.Business.FondosLiquidaciones")})};a.initControls=function(){var b=new Date();b.setDate(b.getDate()-1);a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:b,max:new Date(),events:{change:function(c){a.loaded=false;a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loaded=false;a.loadGrid()}}});a.ddlFondo.shieldDropDown({dataSource:{data:[]},textTemplate:"{descripcion}",valueTemplate:"{CodFondo}",events:{select:function(c){a.filterData()}}});a.btnRefresh.on("click",function(){a.loaded=false;a.loadGrid()});a.chkInconsistencias.on("change",function(){a.filterData()})};a.initGrid=function(){var b=[];b.push({field:"FechaLiquidacion",title:"Fecha Liquidación",width:"9%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"CodFondo",title:"Código Fondo",width:"9%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({field:"Importe",title:"Importe",width:"9%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatPrice});b.push({field:"Ocurrencia",title:"Ocurrencia",width:"9%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({field:"idExtractoBancario",title:"ID Extracto Bancario",width:"9%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({field:"Descripcion",title:"Descripción",width:"20%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"NumLiquidacion",title:"Número Liquidación",width:"9%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({field:"NumCuotapartista",title:"Número Cuotapartista",width:"9%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({field:"Cuotapartista",title:"Cuotapartista",width:"20%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,e,d){c.html(e.Cuotapartista);c.css("text-align","left");c.css("padding-right","5px");if(e.ColorRenglon){c.parent().css("background-color","rgba("+a.hexToRgb(e.ColorRenglon)+((d%2==0)?", 0.6":", 1 ")+")")}}});a.divReporteLiquidaciones.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Liquidaciones",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["FechaLiquidacion","CodFondo","Importe","Ocurrencia","idExtractoBancario","Descripcion","NumLiquidacion","NumCuotapartista","Cuotapartista"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Liquidaciones"}}},selection:false,rowHover:false,sorting:{multiple:true},columns:b})};a.loadGrid=function(){a.lblTitle.text("Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var b=function(d){if(!d){return""}return d.getFullYear().toString()+"-"+Core.Functions.Date.getTwoCharsNumber(d.getMonth()+1)+"-"+Core.Functions.Date.getTwoCharsNumber(d.getDate())};var c=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,overlayElement:a.divReporteLiquidaciones.parent(),secureRequest:true,requestUrl:"liquidaciones/fondos/"+b(a.txtDateFrom.swidget().value())+"/"+b(a.txtDateTo.swidget().value()),requestType:"GET"});c.onSuccess=function(d){a.dataGrid=d;d.fondos.unshift({CodFondo:0,descripcion:"Todos"});var e=a.ddlFondo.swidget().initialOptions;e.dataSource.data=d.fondos;a.ddlFondo.swidget().refresh(e);a.filterData();a.loaded=true};c.request()};a.filterData=function(){var b={};if(a.ddlFondo.swidget().selectedItem().descripcion!="Todos"){b.reporte=$.grep(a.dataGrid.reporte,function(f,e){return f.CodFondo==a.ddlFondo.swidget().selectedItem().CodFondo})}else{b.reporte=$.grep(a.dataGrid.reporte,function(f,e){return true})}if(a.chkInconsistencias[0].checked){b.reporte=$.grep(b.reporte,function(f,e){return f.ColorRenglon})}var d=a.window.scrollTop();var c=a.divReporteLiquidaciones.swidget().initialOptions;c.dataSource.data=b;c.dataSource.schema={data:"reporte"};c.dataSource.sort=a.divReporteLiquidaciones.swidget().dataSource.sort;c.exportOptions.excel.dataSource.data=b;c.exportOptions.excel.dataSource.schema={data:"reporte"};c.exportOptions.excel.readDataSource=true;a.divReporteLiquidaciones.swidget().refresh(c);a.window.scrollTop(d)};a.hexToRgb=function(d){d=d.replace("#","");var f=parseInt(d.substring(0,2),16);var e=parseInt(d.substring(2,4),16);var c=parseInt(d.substring(4,6),16);var h=f+","+e+","+c;return h}};Core.Business.ForgotUserPass=new function(){var b=this;var a=13;b.txtDocumentNumber=null;b.ddlDocumentType=null;b.txtEmail=null;b.btnSend=null;b.divLoginAlert=null;b.divMain=null;b.init=function(){if(Core.Functions.Validations.isBlockedStorage()||!Core.Functions.Persistence.getStorage()){var c=new Core.Controls.Dialog("Aviso","La aplicación no puede ejecutarse correctamente en modo Privado.",{displayButtons:{close:true,accept:false}});c.show();return}Core.loadPage("forgot-user-pass.html",function(){document.title="Balanz Capital - Recuperar usuario y clave";b.txtDocumentNumber=$(".textbox-document");b.ddlDocumentType=$(".dropdown-document-type");b.txtEmail=$(".textbox-email");b.txtEmail.on("keyup",function(d){if(d.keyCode==a){b.sendUserRecovery()}});b.btnSend=$("#btn-send");b.divLoginAlert=$(".login-alert");b.divMain=$(".panel-body");b.txtDocumentNumber.focus();b.btnSend.click(function(){b.sendUserRecovery()})})};b.sendUserRecovery=function(){var c=b.txtDocumentNumber.val();var d=b.txtEmail.val();if(!c||!c.length){Core.Functions.Validations.toggleValidation(b.txtDocumentNumber,true);return}if(!d||!d.length||!Core.Functions.Validations.isEmail(b.txtEmail.val())){Core.Functions.Validations.toggleValidation(b.txtEmail,true);return}b.divLoginAlert.slideUp();var e=new Core.Ajax.ServerRequest({overlayElement:b.divMain,secureRequest:false,requestUrl:"olvidoUsuarioClave",requestType:"POST",requestData:{data:{idTipoDocumento:b.ddlDocumentType.val(),documento:b.txtDocumentNumber.val(),email:b.txtEmail.val()}}});e.onSuccess=function(g){var f=new Core.Controls.Dialog("Recuperación de usuario","<p>"+g.Descripcion+"</p>",{displayButtons:{close:true,accept:false},onClosed:function(){Core.Business.Logout.clearSession();window.location.href=window.location.origin+Core.Functions.Context.getPathname()}});f.show();Core.Functions.Validations.toggleValidation(b.txtDocumentNumber,false);Core.Functions.Validations.toggleValidation(b.txtEmail,false);b.txtDocumentNumber.val("");b.txtEmail.val("")};e.onError=function(f){if(f.responseJSON.Descripcion&&f.responseJSON.Descripcion!=""){b.divLoginAlert.text(f.responseJSON.Descripcion);b.divLoginAlert.slideDown();Core.Functions.Validations.toggleValidation(b.txtEmail,true)}};e.request()}};Core.Business.FormularioPreciosInternacional=new function(){var a=this;a.id="formularioPreciosInternacional";a.init=function(b,c){Core.loadPage("formulario-precios-internacional.html",function(){document.title="Formulario Precios Internacional";a.idDefaultAccount=b;a.idDefaultProfile=c;a.divStep01=$(".div-step-1");a.btnContinueStep01=$(".btn-continue-step-1");a.divStep02=$(".div-step-2");a.txtNombreCompleto=$(".textbox-nombre-completo");a.txtDomicilioCompleto=$(".textbox-domicilio-completo");a.txtOcupacion=$(".textbox-ocupacion");a.txtNombreEmpresa=$(".textbox-nombre-empresa");a.txtDomicilioEmpresa=$(".textbox-domicilio-empresa");a.txtPuestoTrabajo=$(".textbox-puesto-trabajo");a.txtDescripcionPuestoTrabajo=$(".textbox-descripcion-puesto-trabajo");a.btnContinueStep02=$(".btn-continue-step-2");a.divStep03=$(".div-step-3");a.chkUsoDatosMercadoSi=$(".chk-uso-datos-mercado-si");a.chkUsoDatosMercadoNo=$(".chk-uso-datos-mercado-no");a.chkRecibeDatosMercadoSi=$(".chk-recibe-datos-mercado-si");a.chkRecibeDatosMercadoNo=$(".chk-recibe-datos-mercado-no");a.chkEsCalificadoSi=$(".chk-es-calificado-si");a.chkEsCalificadoNo=$(".chk-es-calificado-no");a.chkEstaRegistradoEnAgenciaValoresSi=$(".chk-esta-registrado-agencia-valores-si");a.chkEstaRegistradoEnAgenciaValoresNo=$(".chk-esta-registrado-agencia-valores-no");a.chkRealizaActividadDeAgenciaDeValoresSi=$(".chk-realiza-actividad-de-agencia-de-valores-si");a.chkRealizaActividadDeAgenciaDeValoresNo=$(".chk-realiza-actividad-de-agencia-de-valores-no");a.chkBrindaAsesoramientoSobreInversionesSi=$(".chk-brinda-asesoramiento-sobre-inversiones-si");a.chkBrindaAsesoramientoSobreInversionesNo=$(".chk-brinda-asesoramiento-sobre-inversiones-no");a.chkEsAdministradorDeActivosSi=$(".chk-es-administrador-de-activos-si");a.chkEsAdministradorDeActivosNo=$(".chk-es-administrador-de-activos-no");a.chkUtilizaCapitalDeTercerosSi=$(".chk-utiliza-capital-de-terceros-si");a.chkUtilizaCapitalDeTercerosNo=$(".chk-utiliza-capital-de-terceros-no");a.chkRealizaOperacionesComercialesSi=$(".chk-realiza-operaciones-comerciales-si");a.chkRealizaOperacionesComercialesNo=$(".chk-realiza-operaciones-comerciales-no");a.chkGananciasPorActividadesComercialesSi=$(".chk-ganancias-por-actividades-comerciales-si");a.chkGananciasPorActividadesComercialesNo=$(".chk-ganancias-por-actividades-comerciales-no");a.chkRecibeBeneficiosPorSuActividadComercialSi=$(".chk-recibe-beneficios-por-su-actividad-comercial-si");a.chkRecibeBeneficiosPorSuActividadComercialNo=$(".chk-recibe-beneficios-por-su-actividad-comercial-no");a.btnContinueStep03=$(".btn-continue-step-3");a.divStep04=$(".div-step-4");a.iframePdf=$(".iframe-pdf");a.btnContinueStep04=$(".btn-continue-step-4");a.formData=null;a.hashConfirmacion=null;a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,a.idDefaultAccount,a.idDefaultProfile,function(){a.loadControls()},"Core.Business.FormularioPreciosInternacional")})};a.initControls=function(){a.btnContinueStep01.on("click",function(){a.setActiveStep(2)});a.btnContinueStep02.on("click",function(){a.formData={};var b={value:true};a.formData.NombreCompleto=Core.Functions.Validations.getValidatedInputValue(a.txtNombreCompleto,b);a.formData.DomicilioCompleto=Core.Functions.Validations.getValidatedInputValue(a.txtDomicilioCompleto,b);a.formData.Ocupacion=Core.Functions.Validations.getValidatedInputValue(a.txtOcupacion,b);a.formData.NombreEmpresa=Core.Functions.Validations.getValidatedInputValue(a.txtNombreEmpresa,b);a.formData.DomicilioEmpresa=Core.Functions.Validations.getValidatedInputValue(a.txtDomicilioEmpresa,b);a.formData.PuestoTrabajo=Core.Functions.Validations.getValidatedInputValue(a.txtPuestoTrabajo,b);a.formData.DescripcionPuestoTrabajo=Core.Functions.Validations.getValidatedInputValue(a.txtDescripcionPuestoTrabajo,b);if(b.value){a.setActiveStep(3)}});a.btnContinueStep03.on("click",function(){var d={value:true};a.formData.UsoDatosMercado=a.getSelectedOption(a.chkUsoDatosMercadoSi,a.chkUsoDatosMercadoNo,d);a.formData.RecibeDatosMercado=a.getSelectedOption(a.chkRecibeDatosMercadoSi,a.chkRecibeDatosMercadoNo,d);a.formData.EsCalificado=a.getSelectedOption(a.chkEsCalificadoSi,a.chkEsCalificadoNo,d);a.formData.EstaRegistradoEnAgenciaValores=a.getSelectedOption(a.chkEstaRegistradoEnAgenciaValoresSi,a.chkEstaRegistradoEnAgenciaValoresNo,d);a.formData.RealizaActividadDeAgenciaDeValores=a.getSelectedOption(a.chkRealizaActividadDeAgenciaDeValoresSi,a.chkRealizaActividadDeAgenciaDeValoresNo,d);a.formData.BrindaAsesoramientoSobreInversiones=a.getSelectedOption(a.chkBrindaAsesoramientoSobreInversionesSi,a.chkBrindaAsesoramientoSobreInversionesNo,d);a.formData.EsAdministradorDeActivos=a.getSelectedOption(a.chkEsAdministradorDeActivosSi,a.chkEsAdministradorDeActivosNo,d);a.formData.UtilizaCapitalDeTerceros=a.getSelectedOption(a.chkUtilizaCapitalDeTercerosSi,a.chkUtilizaCapitalDeTercerosNo,d);a.formData.RealizaOperacionesComerciales=a.getSelectedOption(a.chkRealizaOperacionesComercialesSi,a.chkRealizaOperacionesComercialesNo,d);a.formData.GananciasPorActividadesComerciales=a.getSelectedOption(a.chkGananciasPorActividadesComercialesSi,a.chkGananciasPorActividadesComercialesNo,d);a.formData.RecibeBeneficiosPorSuActividadComercial=a.getSelectedOption(a.chkRecibeBeneficiosPorSuActividadComercialSi,a.chkRecibeBeneficiosPorSuActividadComercialNo,d);if(d.value){var b={idPersona:Core.Objects.Context.IdPersona,idServicio:1,idEstadoServicio:0,metadata:a.formData};var c=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.btnContinueStep03,secureRequest:true,requestUrl:"servicios/actualizar",requestType:"POST",requestData:b});c.onSuccess=function(e){a.iframePdf.attr("src",e.LinkConfirmacion);a.hashConfirmacion=e.hashConfirmacion;a.setActiveStep(4)};c.request()}else{new Core.Controls.Dialog("Aviso","Debe responder todas las preguntas solicitadas.",{displayButtons:{close:true,accept:false}}).show()}});a.btnContinueStep04.on("click",function(){if(a.hashConfirmacion){var b={idPersona:Core.Objects.Context.IdPersona,idServicio:1,idEstadoServicio:1,hash:a.hashConfirmacion};var c=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.btnContinueStep04,secureRequest:true,requestUrl:"servicios/actualizar",requestType:"POST",requestData:b});c.onSuccess=function(d){Core.Business.ICE.init(a.idDefaultAccount,a.idDefaultProfile)};c.request()}});a.setActiveStep(1)};a.loadControls=function(){var b=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"servicios/precargar",requestType:"POST",requestData:{idServicio:1,idPersona:Core.Objects.Context.IdPersona}});b.onSuccess=function(c){a.txtNombreCompleto.val(c.metadata.NombreCompleto);if(c.metadata.NombreCompleto){a.txtNombreCompleto.attr("disabled","disabled")}a.txtDomicilioCompleto.val(c.metadata.DomicilioCompleto);if(c.metadata.DomicilioCompleto){a.txtDomicilioCompleto.attr("disabled","disabled")}a.txtOcupacion.val(c.metadata.Ocupacion);if(c.metadata.Ocupacion){a.txtOcupacion.attr("disabled","disabled")}a.txtNombreEmpresa.val(c.metadata.NombreEmpresa);if(c.metadata.NombreEmpresa){a.txtNombreEmpresa.attr("disabled","disabled")}a.txtDomicilioEmpresa.val(c.metadata.DomicilioEmpresa);if(c.metadata.DomicilioEmpresa){a.txtDomicilioEmpresa.attr("disabled","disabled")}a.txtPuestoTrabajo.val(c.metadata.PuestoTrabajo);if(c.metadata.PuestoTrabajo){a.txtPuestoTrabajo.attr("disabled","disabled")}a.txtDescripcionPuestoTrabajo.val(c.metadata.DescripcionPuestoTrabajo);if(c.metadata.DescripcionPuestoTrabajo){a.txtDescripcionPuestoTrabajo.attr("disabled","disabled")}};b.request()};a.setActiveStep=function(b){a.divStep01.hide();a.divStep02.hide();a.divStep03.hide();a.divStep04.hide();if(b==1){a.divStep01.show()}else{if(b==2){a.divStep02.show()}else{if(b==3){a.divStep03.show()}else{if(b==4){a.divStep04.show()}}}}$("html, body").animate({scrollTop:0},1000)};a.getSelectedOption=function(c,b,d){if(c[0].checked){return 1}else{if(b[0].checked){return 0}else{d.value=false;return null}}}};Core.Business.Futuros=new function(){var a=this;a.id="cot_futuros";a.optionsCotizaciones=null;a.idDefaultAccount=null;a.idDefaultProfile=null;a.btnRofex=null;a.btnByma=null;a.btnMatba=null;a.divRofex=null;a.txtFilterRofex=null;a.timeoutRofex=null;a.divByma=null;a.txtFilterByma=null;a.timeoutByma=null;a.divMatba=null;a.txtFilterMatba=null;a.timeoutMatba=null;a.divRofexPlazo=null;a.ddlRofexPlazo=null;a.divBymaPlazo=null;a.ddlBymaPlazo=null;a.divMatbaPlazo=null;a.ddlMatbaPlazo=null;a.maxToken=0;a.lastData=null;a.timerId=null;a.timerIdForceRefresh=null;a.loaded=false;a.refresh=false;a.forceRefresh=false;a.window=$(window);a.init=function(b,c){Core.loadPage("futuros.html",function(){document.title="Futuros";a.loaded=false;a.refresh=false;a.forceRefresh=false;a.optionsCotizaciones=Core.Functions.Context.Profiles.getPageOptionsByMenu("cotizaciones",Core.Objects.Context.Profiles[c]);a.idDefaultAccount=b;a.idDefaultProfile=c;a.maxToken=0;a.lastData=null;a.setTabs();Core.Functions.grid.Cotizaciones.initGrid(a.divRofex,true,true,false,Core.Objects.Context.Profiles[c].opciones.maxWatchlists,null,null,a.optionsCotizaciones.cot_profundidad,Core.Enums.ePanel.Futuros,b,c);Core.Functions.grid.Cotizaciones.initFilter(a.divRofex,a.txtFilterRofex,a.timeoutRofex,a.window);Core.Functions.grid.Cotizaciones.initGrid(a.divByma,true,true,false,Core.Objects.Context.Profiles[c].opciones.maxWatchlists,null,null,a.optionsCotizaciones.cot_profundidad,Core.Enums.ePanel.FuturosByma,b,c);Core.Functions.grid.Cotizaciones.initFilter(a.divByma,a.txtFilterByma,a.timeoutByma,a.window);Core.Functions.grid.Cotizaciones.initGrid(a.divMatba,true,true,false,Core.Objects.Context.Profiles[c].opciones.maxWatchlists,null,null,a.optionsCotizaciones.cot_profundidad,Core.Enums.ePanel.FuturosMatba,b,c);Core.Functions.grid.Cotizaciones.initFilter(a.divMatba,a.txtFilterMatba,a.timeoutMatba,a.window);a.ddlInstrumentSearch=$(".dropdown-instrument-search");Core.Functions.grid.Cotizaciones.initInstrumentSearch(a.ddlInstrumentSearch,b,c);a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){Core.Functions.grid.Cotizaciones.loadInstrumentSearch(b,a.ddlInstrumentSearch,function(){a.loaded=false;a.refresh=false;a.forceRefresh=false;a.loadTab(a.divRofex,"panel/9",Core.Enums.ePanel.Futuros,a.divRofexPlazo,a.ddlRofexPlazo)})},"Core.Business.Futuros")})};a.setTabs=function(){a.divRofex=$(".div-rofex");a.txtFilterRofex=$(".textbox-rofex-filter");a.divByma=$(".div-byma");a.txtFilterByma=$(".textbox-byma-filter");a.divMatba=$(".div-matba");a.txtFilterMatba=$(".textbox-matba-filter");a.btnRofex=$(".btn-rofex");a.btnByma=$(".btn-byma");a.btnMatba=$(".btn-matba");a.divRofexPlazo=$(".div-rofex-plazo");a.ddlRofexPlazo=$(".dropdown-rofex-plazo");a.divRofexPlazo.hide();a.ddlRofexPlazo.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",events:{select:function(b){a.loadTab(a.divRofex,"panel/9",Core.Enums.ePanel.Futuros,a.divRofexPlazo,a.ddlRofexPlazo)}},width:150});a.divBymaPlazo=$(".div-byma-plazo");a.ddlBymaPlazo=$(".dropdown-byma-plazo");a.divBymaPlazo.hide();a.ddlBymaPlazo.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",events:{select:function(b){a.loadTab(a.divByma,"panel/31",Core.Enums.ePanel.FuturosByma,a.divBymaPlazo,a.ddlBymaPlazo)}},width:150});a.divMatbaPlazo=$(".div-matba-plazo");a.ddlMatbaPlazo=$(".dropdown-matba-plazo");a.divMatbaPlazo.hide();a.ddlMatbaPlazo.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",events:{select:function(b){a.loadTab(a.divMatba,"panel/33",Core.Enums.ePanel.FuturosMatba,a.divMatbaPlazo,a.ddlMatbaPlazo)}},width:150});a.btnRofex.on("shown.bs.tab",function(){a.loaded=false;a.loadTab(a.divRofex,"panel/9",Core.Enums.ePanel.Futuros,a.divRofexPlazo,a.ddlRofexPlazo)});a.btnByma.on("shown.bs.tab",function(){a.loaded=false;a.loadTab(a.divByma,"panel/31",Core.Enums.ePanel.FuturosByma,a.divBymaPlazo,a.ddlBymaPlazo)});a.btnMatba.on("shown.bs.tab",function(){a.loaded=false;a.loadTab(a.divMatba,"panel/33",Core.Enums.ePanel.FuturosMatba,a.divMatbaPlazo,a.ddlMatbaPlazo)})};a.loadTab=function(b,f,e,d,c){Core.Functions.grid.Cotizaciones.details=[];a.maxToken=0;a.lastData=null;a.refresh=false;a.forceRefresh=false;if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:0,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(g){}}window.clearInterval(a.timerId);Core.Objects.Context.Timers.remove(a.timerId);window.clearInterval(a.timerIdForceRefresh);Core.Objects.Context.Timers.remove(a.timerIdForceRefresh);Core.Functions.grid.Cotizaciones.loadGrid(b,null,f,a.lastData,a.maxToken,null,null,function(h,g){return(!a.loaded||(h.plazo==c.swidget().selectedItem().value))},function(j,k){a.lastData=j;a.maxToken=k;if(!a.loaded){var l=[];a.lastData.forEach(function(n,m){if(l.indexOf(n.plazo)==-1){l.push(n.plazo)}});var g=[];l.forEach(function(n,m){g.push({value:n,text:n})});var h=c.swidget().initialOptions;h.dataSource.data=g;c.swidget().refresh(h);c.swidget().selected(l.length-1,true);if(l.length>1){d.show()}a.loaded=true;var i=b.swidget().initialOptions;i.dataSource.data=$.grep(a.lastData,function(n,m){return n.plazo==c.swidget().selectedItem().value});b.swidget().refresh(i)}},a.optionsCotizaciones.cot_profundidad);a.timerId=window.setInterval(function(){if(a.loaded&&(a.refresh||a.forceRefresh)){Core.Functions.grid.Cotizaciones.loadGrid(b,null,f,a.lastData,a.maxToken,null,null,function(h,g){return h.plazo==c.swidget().selectedItem().value},function(g,h){a.lastData=g;a.maxToken=h},a.optionsCotizaciones.cot_profundidad);a.forceRefresh=false}a.refresh=true},Core.Functions.grid.Cotizaciones.REFRESH_TIME);Core.Objects.Context.Timers.push(a.timerId);a.timerIdForceRefresh=window.setInterval(function(){a.forceRefresh=true},600000);Core.Objects.Context.Timers.push(a.timerIdForceRefresh);if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:e,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(h){if(a.loaded){var g={cotizaciones:[]};g.cotizaciones.push(JSON.parse(h.data));Core.Functions.grid.Cotizaciones.refreshGrid(g,b,null,a.lastData,a.maxToken,null,null,function(j,i){return j.plazo==c.swidget().selectedItem().value},function(i,j){a.lastData=i;a.maxToken=j;a.refresh=false},a.optionsCotizaciones.cot_profundidad)}}}}};Core.Business.Help=new function(){var a=this;a.id="help";a.init=function(b,c){Core.loadPage("help.html",function(){document.title="Detalle de Instrumento";a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){},"Core.Business.Help")})}};Core.Business.HistoricoOrdenesClientes=new function(){var a=this;a.init=function(b,c){Core.Business.BaseHistoricoOrdenesClientes.init(b,c,{id:"reporteHistoricoOrdenesCliente",namespace:"Core.Business.HistoricoOrdenesClientes",tipoOrden:Core.Enums.eTipoOrden.Orden})}};Core.Business.HistoricoOrdenesPrecargadasClientes=new function(){var a=this;a.init=function(b,c){Core.Business.BaseHistoricoOrdenesClientes.init(b,c,{id:"reporteHistoricoOrdenesPrecargadasCliente",namespace:"Core.Business.HistoricoOrdenesPrecargadasClientes",tipoOrden:Core.Enums.eTipoOrden.Precarga})}};Core.Business.BaseHistoricoOrdenesClientes=new function(){var a=this;a.id="";a.namespace="";a.tipoOrden=0;a.pageOptions=null;a.divHistoricoOrdenes=null;a.lblTitle=null;a.divContainerHistoricoOrdenesDolarBCRA=null;a.divHistoricoOrdenesDolarBCRA=null;a.lblTitleDolarBCRA=null;a.txtFilter=null;a.txtFilterDolarBCRA=null;a.txtDateFrom=null;a.txtDateTo=null;a.timeout=null;a.timeoutDolarBCRA=null;a.init=function(b,c,d){Core.loadPage("historico-ordenes-clientes.html",function(){a.id=d.id;a.namespace=d.namespace;a.tipoOrden=d.tipoOrden;document.title=("Histórico "+a.getTitle());$(".title-page").text(("Histórico "+a.getTitle()));a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.optionsDolarBcra=Core.Functions.Context.Profiles.getPageOptionsByMenu("monedas",Core.Objects.Context.Profiles[c]);a.divHistoricoOrdenes=$(".div-historico-ordenes");a.lblTitle=$(".label-title");a.divContainerHistoricoOrdenesDolarBCRA=$(".div-container-historico-ordenes-dolar-bcra");a.divHistoricoOrdenesDolarBCRA=$(".div-historico-ordenes-dolar-bcra");a.lblTitleDolarBCRA=$(".label-title-dolar-bcra");a.txtFilterDolarBCRA=$(".textbox-filter-dolar-bcra");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.txtFilter=$(".textbox-filter");a.initDatePickers();a.initGrid();a.initFilter();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,b,c,a.loadGrid,a.namespace)})};a.initDatePickers=function(){a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(b){a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(b){a.loadGrid()}}})};a.initFilter=function(){a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var b=a.divHistoricoOrdenes.swidget().dataSource;if(value){b.filter={or:[{path:"Ticker",filter:"contains",value:value}]}}else{b.filter=null}b.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,(a.namespace+".txtFilter"));a.txtFilterDolarBCRA.on("keydown",function(){clearTimeout(a.timeoutDolarBCRA);a.timeoutDolarBCRA=setTimeout(function(){value=a.txtFilterDolarBCRA.val();var b=a.divHistoricoOrdenesDolarBCRA.swidget().dataSource;if(value){b.filter={or:[{path:"Ticker",filter:"contains",value:value}]}}else{b.filter=null}b.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilterDolarBCRA,(a.namespace+".txtFilterDolarBCRA"))};a.initGrid=function(){var b=[];var c=[];if(a.tipoOrden==Core.Enums.eTipoOrden.Orden){b.push({width:"5%",field:"idOrden",title:"Orden",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});c.push("idOrden")}else{b.push({width:"5%",field:"idOrdenPrecargada",title:"Precarga",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});c.push("idOrdenPrecargada")}b.push({width:"7%",field:"Fecha",title:"Fecha",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});c.push("Fecha");b.push({width:"7%",field:"Hora",title:"Hora",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});c.push("Hora");b.push({width:"10%",field:"Operacion",title:"Operación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});c.push("Operacion");b.push({width:"7%",field:"Ticker",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});c.push("Ticker");b.push({width:"5%",field:"Moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});c.push("Moneda");b.push({width:"10%",field:"Cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatPrice});c.push("Cantidad");b.push({width:"10%",field:"Precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatPrice});c.push("Precio");b.push({width:"10%",field:"Monto",title:"Monto",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatPrice});c.push("Monto");b.push({width:"6%",field:"Estado",title:"Estado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});c.push("Estado");if(a.tipoOrden==Core.Enums.eTipoOrden.Orden){b.push({width:"11%",field:"CantidadOperada",title:"Cantidad Operada",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatPrice});c.push("CantidadOperada");b.push({width:"12%",field:"PrecioOperado",title:"Precio Operado",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatPrice});c.push("PrecioOperado");b.push({title:"Comp.",width:"3%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,e,f){if(e.idArchivoComprobante!=0){d.html('<button type="button" title="Descargar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');d.addClass("link-cell");d.on("click",function(){function h(p){var o=new Blob([p.response],{type:p.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(o);return}var j=window.URL.createObjectURL(o);var n=document.createElement("a");n.href=j;var l=p.getResponseHeader("Content-Disposition").split("; ");var k="filename=reporte.xlsx";for(var m=0;m<l.length;m++){if(l[m].indexOf("filename")>=0){k=l[m]}}n.download=k.split("=")[1];n.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(j)}var g=new XMLHttpRequest();g.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"comprobantes/"+e.idTipoArchivo+"/"+e.idArchivoComprobante,true);g.responseType="blob";g.setRequestHeader("Authorization",Core.Objects.Context.Token);g.onload=function(i){if(g.status==200){h(g)}else{var j=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga del reporte.</p>",{displayButtons:{close:true,accept:false}});j.show()}};g.send()})}}})}b.push({title:" ",width:"3%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(e,f,g){var d=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(e);d.on("click",function(){if(a.tipoOrden==Core.Enums.eTipoOrden.Orden){Core.Functions.grid.OrdenDetails.showDetails(f.IdCuenta,f.idOrden,a.pageOptions)}else{Core.Functions.grid.OrdenDetails.showDetailsPrecarga(f.IdCuenta,f.idOrdenPrecargada)}})}});a.divHistoricoOrdenes.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:("Histórico "+a.getTitle()),dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:c,header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:("Histórico "+a.getTitle())}}},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},grouping:{showGroupHeader:true,allowDragToGroup:true,message:"Arrastre un encabezado de columna para agrupar por esa columna"},columns:b,noRecordsText:("No hay "+a.getTitle()+" para informar"),});a.divHistoricoOrdenesDolarBCRA.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:("Histórico "+a.getTitle()+" DolarBCRA"),dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:c,header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:("Histórico "+a.getTitle()+" DolarBCRA")}}},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},grouping:{showGroupHeader:true,allowDragToGroup:true,message:"Arrastre un encabezado de columna para agrupar por esa columna"},columns:b,noRecordsText:("No hay "+a.getTitle()+" para informar"),})};a.loadGrid=function(){a.lblTitle.text(a.getTitle()+" entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));a.lblTitleDolarBCRA.text(a.getTitle()+" dólar balanz - Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var b;b="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));b+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));var c=new Core.Ajax.ServerRequest({overlayElement:a.divHistoricoOrdenes.parent(),secureRequest:true,requestUrl:a.getRequestUrl(),requestType:"GET",requestData:b});c.onSuccess=function(d){var e=a.divHistoricoOrdenes.swidget().initialOptions;e.dataSource.data=d;e.dataSource.schema={data:"ordenes"};e.dataSource.group=[{field:"Fecha",order:"asc"}];e.exportOptions.excel.dataSource.data=d;e.exportOptions.excel.dataSource.schema={data:"ordenes"};e.exportOptions.excel.readDataSource=true;a.divHistoricoOrdenes.swidget().refresh(e);a.txtFilter.keydown();a.divContainerHistoricoOrdenesDolarBCRA.hide();if(d.ordenesDolarBalanz&&d.ordenesDolarBalanz.length&&a.optionsDolarBcra&&a.optionsDolarBcra.monedasBalanzCambio){var f=a.divHistoricoOrdenesDolarBCRA.swidget().initialOptions;f.dataSource.data=d;f.dataSource.schema={data:"ordenesDolarBalanz"};f.dataSource.group=[{field:"Fecha",order:"asc"}];f.exportOptions.excel.dataSource.data=d;f.exportOptions.excel.dataSource.schema={data:"ordenesDolarBalanz"};f.exportOptions.excel.readDataSource=true;a.divHistoricoOrdenesDolarBCRA.swidget().refresh(f);a.txtFilterDolarBCRA.keydown();a.divContainerHistoricoOrdenesDolarBCRA.show()}};c.request()};a.getRequestUrl=function(){if(a.tipoOrden==Core.Enums.eTipoOrden.Precarga){return("reportehistoricoprecargas/"+a.header.selectedIdAccount)}else{return("reportehistoricoordenes/"+a.header.selectedIdAccount)}};a.getTitle=function(){if(a.tipoOrden==Core.Enums.eTipoOrden.Precarga){return"Precargas"}else{return"Ordenes"}}};Core.Business.ImportadorCuentas=new function(){var a=this;a.idDefaultAccount=null;a.idDefaultProfile=null;a.id="homeImportadorCuentas";a.divCuentas=null;a.btnRefrescar=null;a.btnImportarPlataforma=null;a.btnImportarBolsa=null;a.btnImportarFondosApi=null;a.btnDescargarFondos=null;a.btnDescargarValores=null;a.btnDescargarInterfazMae=null;a.btnFinalizarTodas=null;a.pageOptions=null;a.txtFilter=null;a.timeout=null;a.init=function(b,c){Core.loadPage("importador-cuentas.html",function(){document.title="Importador Cuentas BCV";a.idDefaultAccount=b;a.idDefaultProfile=c;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divCuentas=$(".div-importador-cuentas-bcv");a.txtFilter=$(".textbox-filter");a.btnRefrescar=$(".btn-refrescar");a.btnImportarPlataforma=$(".btn-importar-plataforma");a.btnImportarBolsa=$(".btn-importar-bolsa");a.btnImportarFondosApi=$(".btn-importar-fondos-api");a.btnDescargarFondos=$(".btn-descargar-fondos");a.btnDescargarValores=$(".btn-descargar-valores");a.btnDescargarInterfazMae=$(".btn-descargar-interfaz-mae");a.btnFinalizarTodas=$(".btn-finalizar-todas");a.initGrid();a.initFilter();a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadGrid()},"Core.Business.ImportadorCuentas")})};a.initControls=function(){a.btnRefrescar.on("click",function(){a.loadGrid()});a.btnImportarPlataforma.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea importar en Plataforma?",{onAccepted:function(){var b=new Core.Ajax.ServerRequest({overlayElement:a.btnImportarPlataforma,secureRequest:true,requestUrl:"apertura/cuenta/interfaz/plataforma",requestType:"POST"});b.onSuccess=function(c){new Core.Controls.ProcessProgress({idProcess:((c&&c.idProceso)?c.idProceso:0),overlayElement:a.divCuentas.parent(),onFinish:function(){a.loadGrid()}}).show()};b.request()}}).show()});a.btnImportarBolsa.on("click",function(){var b=new Core.Ajax.ServerRequest({overlayElement:a.btnImportarBolsa,secureRequest:true,requestUrl:"apertura/cuenta/interfaz/bolsa",requestType:"POST"});b.onSuccess=function(c){new Core.Controls.ProcessProgress({idProcess:((c&&c.idProceso)?c.idProceso:0),overlayElement:a.divCuentas.parent(),onFinish:function(){a.loadGrid()}}).show()};b.request()});a.btnImportarFondosApi.hide();if(a.pageOptions&&a.pageOptions.botonImportadorCuentasFondos){a.btnImportarFondosApi.show();a.btnImportarFondosApi.on("click",function(){var b=new Core.Ajax.ServerRequest({overlayElement:a.btnImportarFondosApi,secureRequest:true,requestUrl:"apertura/cuenta/interfaz/fondos/masivo",requestType:"POST"});b.onSuccess=function(c){new Core.Controls.ProcessProgress({idProcess:((c&&c.idProceso)?c.idProceso:0),overlayElement:a.divCuentas.parent(),onFinish:function(){a.loadGrid()}}).show()};b.request()})}a.btnDescargarFondos.click(function(){function c(k){var j=new Blob([k.response],{type:k.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(j);return}var d=window.URL.createObjectURL(j);var h=document.createElement("a");h.href=d;var f=k.getResponseHeader("Content-Disposition").split("; ");var e="filename=file.DAT";for(var g=0;g<f.length;g++){if(f[g].indexOf("filename")>=0){e=f[g]}}h.download=e.split("=")[1];h.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(d)}var b=new XMLHttpRequest();b.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"apertura/cuenta/interfaz/fondos",true);b.responseType="blob";b.setRequestHeader("Authorization",Core.Objects.Context.Token);b.onload=function(d){if(b.status==200){c(b)}else{var e=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga del comprobante.</p>",{displayButtons:{close:true,accept:false}});e.show()}};b.send()});a.btnDescargarValores.click(function(){var b=new Core.Ajax.ServerRequest({overlayElement:a.btnDescargarValores,secureRequest:true,requestUrl:"apertura/cuenta/interfaz/cajadevalores",requestType:"POST"});b.onSuccess=function(c){new Core.Controls.ProcessProgress({idProcess:((c&&c.idProceso)?c.idProceso:0),overlayElement:a.divCuentas.parent(),onFinish:function(){a.loadGrid()}}).show()};b.request()});a.btnDescargarInterfazMae.click(function(){function c(k){var j=new Blob([k.response],{type:k.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(j);return}var d=window.URL.createObjectURL(j);var h=document.createElement("a");h.href=d;var f=k.getResponseHeader("Content-Disposition").split("; ");var e="filename=file.txt";for(var g=0;g<f.length;g++){if(f[g].indexOf("filename")>=0){e=f[g]}}h.download=e.split("=")[1];h.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(d)}var b=new XMLHttpRequest();b.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"apertura/cuenta/interfaz/mae",true);b.responseType="blob";b.setRequestHeader("Authorization",Core.Objects.Context.Token);b.onload=function(d){if(b.status==200){c(b)}else{var e=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga del comprobante.</p>",{displayButtons:{close:true,accept:false}});e.show()}};b.send()});a.btnFinalizarTodas.click(function(){var b=new Core.Ajax.ServerRequest({overlayElement:a.btnFinalizarTodas,secureRequest:true,requestUrl:"apertura/cuenta/importador/finalizarmasivo",requestType:"POST"});b.onSuccess=function(c){new Core.Controls.ProcessProgress({idProcess:((c&&c.idProceso)?c.idProceso:0),overlayElement:a.divCuentas.parent(),onFinish:function(){a.loadGrid()}}).show()};b.request()})};a.initFilter=function(){a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var b=a.divCuentas.swidget().dataSource;if(value){b.filter={or:[{path:"idAperturaCuenta",filter:"contains",value:value},{path:"idCuenta",filter:"contains",value:value},{path:"Version",filter:"contains",value:value},{path:"Comitente",filter:"contains",value:value},{path:"Cuotapartista",filter:"contains",value:value},{path:"Asesores",filter:"contains",value:value},{path:"Descripcion",filter:"contains",value:value}]}}else{b.filter=null}b.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.ImportadorCuentas.txtFilter")};a.initGrid=function(){a.divCuentas.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},events:{detailCreated:a.detailCreated},columns:[{width:"8%",field:"idAperturaCuenta",title:"ID Apertura",headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"8%",field:"Version",title:"Versión",headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"20%",field:"Descripcion",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"8%",field:"idCuenta",title:"ID Cuenta",headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"8%",field:"Comitente",title:"Comitente",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"8%",field:"Cuotapartista",title:"Cuotapartista",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"20%",field:"Asesores",title:"Asesores",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:40,title:"Plataforma",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(b,c,e){var d=$.grep(c.Personas,function(h,g){return h.ErroresPlataforma})[0];if(c.ErroresPlataforma||d){var f=(c.ErroresPlataforma.length>140)?(c.ErroresPlataforma.substr(0,140)+"..."):(c.ErroresPlataforma);if(!c.ErroresPlataforma){f="Error en Personas"}b.html('<button type="button" style="background-color:red; border-color:red;" title="'+f+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');b.addClass("link-cell");b.on("click",function(){var g=new Core.Controls.Dialog("Errores Plataforma",(c.ErroresPlataforma)?c.ErroresPlataforma:"",{displayButtons:{close:true,accept:false}});g.show()})}else{b.html('<button type="button" style="background-color:green; border-color:green;" class="btn-sm balanz-button"><span class="glyphicon glyphicon-ok"></span></button>')}}},{width:40,title:"V Bolsa",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(b,c,e){if(c.tieneComitente>0){var d=$.grep(c.Personas,function(h,g){return h.ErroresVBolsa})[0];if(c.ErroresVBolsa||d){var f=(c.ErroresVBolsa.length>140)?(c.ErroresVBolsa.substr(0,140)+"..."):(c.ErroresVBolsa);if(!c.ErroresVBolsa){f="Error en Personas"}b.html('<button type="button" style="background-color:red; border-color:red;" title="'+f+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');b.addClass("link-cell");b.on("click",function(){var g=new Core.Controls.Dialog("Errores V Bolsa",(c.ErroresVBolsa)?c.ErroresVBolsa:"",{displayButtons:{close:true,accept:false}});g.show()})}else{b.html('<button type="button" style="background-color:green; border-color:green;" class="btn-sm balanz-button"><span class="glyphicon glyphicon-ok"></span></button>')}}}},{width:40,title:"V Fondos",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(b,c,e){if(c.tieneCuotapartista>0){var d=$.grep(c.Personas,function(h,g){return h.ErroresVFondos})[0];if(c.ErroresVFondos||d){var f=(c.ErroresVFondos.length>140)?(c.ErroresVFondos.substr(0,140)+"..."):(c.ErroresVFondos);if(!c.ErroresVFondos){f="Error en Personas"}b.html('<button type="button" style="background-color:red; border-color:red;" title="'+f+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');b.addClass("link-cell");b.on("click",function(){var g=new Core.Controls.Dialog("Errores V Fondos",(c.ErroresVFondos)?c.ErroresVFondos:"",{displayButtons:{close:true,accept:false}});g.show()})}else{b.html('<button type="button" style="background-color:green; border-color:green;" class="btn-sm balanz-button"><span class="glyphicon glyphicon-ok"></span></button>')}}}},{width:40,title:"CV 0238",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(b,c,e){if(c.tieneComitente>0){var d=$.grep(c.Personas,function(h,g){return h.ErroresCV0238})[0];if(c.ErroresCV0238||d){var f=(c.ErroresCV0238.length>140)?(c.ErroresCV0238.substr(0,140)+"..."):(c.ErroresCV0238);if(!c.ErroresCV0238){f="Error en Personas"}b.html('<button type="button" style="background-color:red; border-color:red;" title="'+f+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');b.addClass("link-cell");b.on("click",function(){var g=new Core.Controls.Dialog("Errores CV 0238",(c.ErroresCV0238)?c.ErroresCV0238:"",{displayButtons:{close:true,accept:false}});g.show()})}else{b.html('<button type="button" style="background-color:green; border-color:green;" class="btn-sm balanz-button"><span class="glyphicon glyphicon-ok"></span></button>')}}}},{width:40,title:"CV 5892",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(b,c,e){if(c.tieneComitente>0){var d=$.grep(c.Personas,function(h,g){return h.ErroresCV5892})[0];if(c.ErroresCV5892||d){var f=(c.ErroresCV5892.length>140)?(c.ErroresCV5892.substr(0,140)+"..."):(c.ErroresCV5892);if(!c.ErroresCV5892){f="Error en Personas"}b.html('<button type="button" style="background-color:red; border-color:red;" title="'+f+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');b.addClass("link-cell");b.on("click",function(){var g=new Core.Controls.Dialog("Errores CV 5892",(c.ErroresCV5892)?c.ErroresCV5892:"",{displayButtons:{close:true,accept:false}});g.show()})}else{b.html('<button type="button" style="background-color:green; border-color:green;" class="btn-sm balanz-button"><span class="glyphicon glyphicon-ok"></span></button>')}}}},{width:40,title:"Finalizar",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(b,c,d){if(a.isComplete(c)){b.html('<button type="button" title="Finalizar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-chevron-right"></span></button>');b.addClass("link-cell");b.on("click",function(){var e=new Core.Ajax.ServerRequest({overlayElement:a.divCuentas.parent(),secureRequest:true,requestUrl:"/apertura/cuenta/importador/finalizar",requestType:"POST",requestData:{data:{idAperturaCuenta:c.idAperturaCuenta,VersionActual:c.Version}}});e.onSuccess=function(f){a.loadGrid()};e.request()})}}}]})};a.loadGrid=function(){var b=new Core.Ajax.ServerRequest({overlayElement:a.divCuentas.parent(),secureRequest:true,requestUrl:"apertura/cuenta/importador",requestType:"GET"});b.onSuccess=function(d){var f=a.divCuentas.swidget().initialOptions;f.dataSource.data=d;f.dataSource.schema={data:"Aperturas"};f.events.detailCreated=a.detailCreated;a.divCuentas.swidget().refresh(f);a.txtFilter.keydown();for(var e=0;e<a.divCuentas.swidget().contentTable[0].rows.length;e++){var g=a.divCuentas.swidget().contentTable[0].rows[e];var c=$(g.cells[0]);c.click()}};b.request()};a.isComplete=function(c){var b=c.ErroresPlataforma==""&&c.ErroresVBolsa==""&&c.ErroresVFondos==""&&c.ErroresCV0238==""&&c.ErroresCV5892=="";for(var d=0;d<c.Personas.length;d++){var e=c.Personas[d];if(b){b=e.ErroresPlataforma==""&&e.ErroresVBolsa==""&&e.ErroresVFondos==""&&e.ErroresCV0238==""&&e.ErroresCV5892==""}}return b};a.detailCreated=function(b){$("<div class='grid-details'/>").appendTo(b.detailCell).shieldGrid({dataSource:{data:b.item.Personas},selection:false,rowHover:false,columns:[{width:"20%",field:"Nombre",title:"Nombre",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"20%",field:"Apellido",title:"Apellido",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"20%",field:"Tipo",title:"Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(c,d,e){if(d.Tipo==Core.Business.eTipoPersonaCuenta.Titular){c.html("<span>Titular</span>")}else{if(d.Tipo==Core.Business.eTipoPersonaCuenta.Autorizado){c.html("<span>Autorizado</span>")}else{if(d.Tipo==Core.Business.eTipoPersonaCuenta.Firmante){c.html("<span>Firmante</span>")}else{if(d.Tipo==Core.Business.eTipoPersonaCuenta.Apoderado){c.html("<span>Apoderado</span>")}else{if(d.Tipo==Core.Business.eTipoPersonaCuenta.Accionista){c.html("<span>Accionista</span>")}else{if(d.Tipo==Core.Business.eTipoPersonaCuenta.BeneficiarioFinal){c.html("<span>Beneficiario Final</span>")}else{c.html("<span></span>")}}}}}}}},{width:"16%",field:"Numero",title:"Número",headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"6%",title:"Plataforma",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(c,d,e){if(d.ErroresPlataforma){var f=(d.ErroresPlataforma.length>140)?(d.ErroresPlataforma.substr(0,140)+"..."):(d.ErroresPlataforma);c.html('<button type="button" style="background-color:red; border-color:red;" title="'+f+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');c.addClass("link-cell");c.on("click",function(){var g=new Core.Controls.Dialog("Errores Plataforma",(d.ErroresPlataforma)?d.ErroresPlataforma:"",{displayButtons:{close:true,accept:false}});g.show()})}else{c.html('<button type="button" style="background-color:green; border-color:green;" class="btn-sm balanz-button"><span class="glyphicon glyphicon-ok"></span></button>')}}},{width:"6%",title:"V Bolsa",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(c,d,e){if(b.item.tieneComitente>0){if(d.ErroresVBolsa){var f=(d.ErroresVBolsa.length>140)?(d.ErroresVBolsa.substr(0,140)+"..."):(d.ErroresVBolsa);c.html('<button type="button" style="background-color:red; border-color:red;" title="'+f+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');c.addClass("link-cell");c.on("click",function(){var g=new Core.Controls.Dialog("Errores V Bolsa",(d.ErroresVBolsa)?d.ErroresVBolsa:"",{displayButtons:{close:true,accept:false}});g.show()})}else{c.html('<button type="button" style="background-color:green; border-color:green;" class="btn-sm balanz-button"><span class="glyphicon glyphicon-ok"></span></button>')}}}},{width:"6%",title:"V Fondos",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(c,d,e){if(b.item.tieneCuotapartista>0){if(d.ErroresVFondos){var f=(d.ErroresVFondos.length>140)?(d.ErroresVFondos.substr(0,140)+"..."):(d.ErroresVFondos);c.html('<button type="button" style="background-color:red; border-color:red;" title="'+f+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');c.addClass("link-cell");c.on("click",function(){var g=new Core.Controls.Dialog("Errores V Fondos",(d.ErroresVFondos)?d.ErroresVFondos:"",{displayButtons:{close:true,accept:false}});g.show()})}else{c.html('<button type="button" style="background-color:green; border-color:green;" class="btn-sm balanz-button"><span class="glyphicon glyphicon-ok"></span></button>')}}}},{width:"6%",title:"CV 0238",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(c,d,e){if(b.item.tieneComitente>0){if(d.ErroresCV0238){var f=(d.ErroresCV0238.length>140)?(d.ErroresCV0238.substr(0,140)+"..."):(d.ErroresCV0238);c.html('<button type="button" style="background-color:red; border-color:red;" title="'+f+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');c.addClass("link-cell");c.on("click",function(){var g=new Core.Controls.Dialog("Errores CV 0238",(d.ErroresCV0238)?d.ErroresCV0238:"",{displayButtons:{close:true,accept:false}});g.show()})}else{c.html('<button type="button" style="background-color:green; border-color:green;" class="btn-sm balanz-button"><span class="glyphicon glyphicon-ok"></span></button>')}}}},{width:"6%",title:"CV 5892",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(c,d,e){if(b.item.tieneComitente>0){if(d.ErroresCV5892){var f=(d.ErroresCV5892.length>140)?(d.ErroresCV5892.substr(0,140)+"..."):(d.ErroresCV5892);c.html('<button type="button" style="background-color:red; border-color:red;" title="'+f+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');c.addClass("link-cell");c.on("click",function(){var g=new Core.Controls.Dialog("Errores CV 5892",(d.ErroresCV5892)?d.ErroresCV5892:"",{displayButtons:{close:true,accept:false}});g.show()})}else{c.html('<button type="button" style="background-color:green; border-color:green;" class="btn-sm balanz-button"><span class="glyphicon glyphicon-ok"></span></button>')}}}},{width:"6%",field:" ",title:" ",headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString}]})}};Core.Business.ImportadorCuentasBCI=new function(){var a=this;a.idDefaultAccount=null;a.idDefaultProfile=null;a.id="homeImportadorCuentasBCI";a.divCuentas=null;a.btnRefrescar=null;a.btnImportarPlataforma=null;a.btnImportarBolsa=null;a.btnFinalizarTodas=null;a.pageOptions=null;a.txtFilter=null;a.timeout=null;a.init=function(b,c){Core.loadPage("importador-cuentas-bci.html",function(){document.title="Importador Cuentas BCI";a.idDefaultAccount=b;a.idDefaultProfile=c;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divCuentas=$(".div-importador-cuentas-bci");a.txtFilter=$(".textbox-filter");a.btnRefrescar=$(".btn-refrescar");a.btnImportarPlataforma=$(".btn-importar-plataforma");a.btnImportarBolsa=$(".btn-importar-bolsa");a.btnFinalizarTodas=$(".btn-finalizar-todas");a.initGrid();a.initFilter();a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadGrid()},"Core.Business.ImportadorCuentasBCI")})};a.initControls=function(){a.btnRefrescar.on("click",function(){a.loadGrid()});a.btnImportarPlataforma.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea importar en Plataforma?",{onAccepted:function(){var b=new Core.Ajax.ServerRequest({overlayElement:a.btnImportarPlataforma,secureRequest:true,requestUrl:"apertura/cuenta/interfazbci/plataforma",requestType:"POST"});b.onSuccess=function(c){new Core.Controls.ProcessProgress({idProcess:((c&&c.idProceso)?c.idProceso:0),overlayElement:a.divCuentas.parent(),onFinish:function(){a.loadGrid()}}).show()};b.request()}}).show()});a.btnImportarBolsa.on("click",function(){var b=new Core.Ajax.ServerRequest({overlayElement:a.btnImportarBolsa,secureRequest:true,requestUrl:"apertura/cuenta/interfazbci/bolsa",requestType:"POST"});b.onSuccess=function(c){new Core.Controls.ProcessProgress({idProcess:((c&&c.idProceso)?c.idProceso:0),overlayElement:a.divCuentas.parent(),onFinish:function(){a.loadGrid()}}).show()};b.request()});a.btnFinalizarTodas.click(function(){var b=new Core.Ajax.ServerRequest({overlayElement:a.btnFinalizarTodas,secureRequest:true,requestUrl:"apertura/cuenta/importadorbci/finalizarmasivo",requestType:"POST"});b.onSuccess=function(c){new Core.Controls.ProcessProgress({idProcess:((c&&c.idProceso)?c.idProceso:0),overlayElement:a.divCuentas.parent(),onFinish:function(){a.loadGrid()}}).show()};b.request()})};a.initFilter=function(){a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var b=a.divCuentas.swidget().dataSource;if(value){b.filter={or:[{path:"idAperturaCuenta",filter:"contains",value:value},{path:"idCuenta",filter:"contains",value:value},{path:"Version",filter:"contains",value:value},{path:"Comitente",filter:"contains",value:value},{path:"Asesores",filter:"contains",value:value},{path:"Descripcion",filter:"contains",value:value}]}}else{b.filter=null}b.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.ImportadorCuentasBCI.txtFilter")};a.initGrid=function(){a.divCuentas.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},events:{detailCreated:a.detailCreated},columns:[{width:"8%",field:"idAperturaCuenta",title:"ID Apertura",headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"8%",field:"Version",title:"Versión",headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"18%",field:"Descripcion",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"8%",field:"idCuenta",title:"ID Cuenta",headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"8%",field:"Comitente",title:"Comitente",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"18%",field:"Asesores",title:"Asesores",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"6%",title:"Plataforma",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(b,c,e){var d=$.grep(c.Personas,function(h,g){return h.ErroresPlataforma})[0];if(c.ErroresPlataforma||d){var f=(c.ErroresPlataforma.length>140)?(c.ErroresPlataforma.substr(0,140)+"..."):(c.ErroresPlataforma);if(!c.ErroresPlataforma){f="Error en Personas"}b.html('<button type="button" style="background-color:red; border-color:red;" title="'+f+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');b.addClass("link-cell");b.on("click",function(){var g=new Core.Controls.Dialog("Errores Plataforma",(c.ErroresPlataforma)?c.ErroresPlataforma:"",{displayButtons:{close:true,accept:false}});g.show()})}else{b.html('<button type="button" style="background-color:green; border-color:green;" class="btn-sm balanz-button"><span class="glyphicon glyphicon-ok"></span></button>')}}},{width:"6%",title:"V Bolsa",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(b,c,e){if(c.tieneComitente>0){var d=$.grep(c.Personas,function(h,g){return h.ErroresVBolsa})[0];if(c.ErroresVBolsa||d){var f=(c.ErroresVBolsa.length>140)?(c.ErroresVBolsa.substr(0,140)+"..."):(c.ErroresVBolsa);if(!c.ErroresVBolsa){f="Error en Personas"}b.html('<button type="button" style="background-color:red; border-color:red;" title="'+f+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');b.addClass("link-cell");b.on("click",function(){var g=new Core.Controls.Dialog("Errores V Bolsa",(c.ErroresVBolsa)?c.ErroresVBolsa:"",{displayButtons:{close:true,accept:false}});g.show()})}else{b.html('<button type="button" style="background-color:green; border-color:green;" class="btn-sm balanz-button"><span class="glyphicon glyphicon-ok"></span></button>')}}}},{width:"6%",title:"Finalizar",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(b,c,d){if(a.isComplete(c)){b.html('<button type="button" title="Finalizar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-chevron-right"></span></button>');b.addClass("link-cell");b.on("click",function(){var e=new Core.Ajax.ServerRequest({overlayElement:a.divCuentas.parent(),secureRequest:true,requestUrl:"/apertura/cuenta/importadorbci/finalizar",requestType:"POST",requestData:{data:{idAperturaCuenta:c.idAperturaCuenta,VersionActual:c.Version}}});e.onSuccess=function(f){a.loadGrid()};e.request()})}}}]})};a.loadGrid=function(){var b=new Core.Ajax.ServerRequest({overlayElement:a.divCuentas.parent(),secureRequest:true,requestUrl:"apertura/cuenta/importadorbci",requestType:"GET"});b.onSuccess=function(d){var f=a.divCuentas.swidget().initialOptions;f.dataSource.data=d;f.dataSource.schema={data:"Aperturas"};f.events.detailCreated=a.detailCreated;a.divCuentas.swidget().refresh(f);a.txtFilter.keydown();for(var e=0;e<a.divCuentas.swidget().contentTable[0].rows.length;e++){var g=a.divCuentas.swidget().contentTable[0].rows[e];var c=$(g.cells[0]);c.click()}};b.request()};a.isComplete=function(c){var b=c.ErroresPlataforma==""&&c.ErroresVBolsa=="";for(var d=0;d<c.Personas.length;d++){var e=c.Personas[d];if(b){b=e.ErroresPlataforma==""&&e.ErroresVBolsa==""}}return b};a.detailCreated=function(b){$("<div class='grid-details'/>").appendTo(b.detailCell).shieldGrid({dataSource:{data:b.item.Personas},selection:false,rowHover:false,columns:[{width:"20%",field:"Nombre",title:"Nombre",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"20%",field:"Apellido",title:"Apellido",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"20%",field:"Tipo",title:"Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(c,d,e){if(d.Tipo==Core.Business.eTipoPersonaCuenta.Titular){c.html("<span>Titular</span>")}else{if(d.Tipo==Core.Business.eTipoPersonaCuenta.Autorizado){c.html("<span>Autorizado</span>")}else{if(d.Tipo==Core.Business.eTipoPersonaCuenta.Firmante){c.html("<span>Firmante</span>")}else{if(d.Tipo==Core.Business.eTipoPersonaCuenta.Apoderado){c.html("<span>Apoderado</span>")}else{if(d.Tipo==Core.Business.eTipoPersonaCuenta.Accionista){c.html("<span>Accionista</span>")}else{if(d.Tipo==Core.Business.eTipoPersonaCuenta.BeneficiarioFinal){c.html("<span>Beneficiario Final</span>")}else{c.html("<span></span>")}}}}}}}},{width:"16%",field:"Numero",title:"Número",headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"6%",title:"Plataforma",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(c,d,e){if(d.ErroresPlataforma){var f=(d.ErroresPlataforma.length>140)?(d.ErroresPlataforma.substr(0,140)+"..."):(d.ErroresPlataforma);c.html('<button type="button" style="background-color:red; border-color:red;" title="'+f+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');c.addClass("link-cell");c.on("click",function(){var g=new Core.Controls.Dialog("Errores Plataforma",(d.ErroresPlataforma)?d.ErroresPlataforma:"",{displayButtons:{close:true,accept:false}});g.show()})}else{c.html('<button type="button" style="background-color:green; border-color:green;" class="btn-sm balanz-button"><span class="glyphicon glyphicon-ok"></span></button>')}}},{width:"6%",title:"V Bolsa",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(c,d,e){if(b.item.tieneComitente>0){if(d.ErroresVBolsa){var f=(d.ErroresVBolsa.length>140)?(d.ErroresVBolsa.substr(0,140)+"..."):(d.ErroresVBolsa);c.html('<button type="button" style="background-color:red; border-color:red;" title="'+f+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');c.addClass("link-cell");c.on("click",function(){var g=new Core.Controls.Dialog("Errores V Bolsa",(d.ErroresVBolsa)?d.ErroresVBolsa:"",{displayButtons:{close:true,accept:false}});g.show()})}else{c.html('<button type="button" style="background-color:green; border-color:green;" class="btn-sm balanz-button"><span class="glyphicon glyphicon-ok"></span></button>')}}}},{width:"6%",field:" ",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString}]})}};Core.Business.InformeDepositos=new function(){var a=this;a.id="informedepositos";a.lblComitenteCuenta=null;a.ddlMoneda=null;a.ddlDestino=null;a.txtImporte=null;a.txtNumeroComprobante=null;a.divUploadComprobante=null;a.fileUpload=null;a.divObservaciones=null;a.txtObservaciones=null;a.divFondo=null;a.ddlFondo=null;a.btnContinuar=null;a.idComprobanteAdjunto=null;a.pageOptions=null;a.init=function(b,c){Core.loadPage("informe-depositos.html",function(){document.title="Informe Depósitos";a.loaded=false;a.idDefaultAccount=b;a.idDefaultProfile=c;a.lblComitenteCuenta=$(".label-account-description");a.ddlMoneda=$(".dropdown-moneda");a.ddlDestino=$(".dropdown-destino");a.txtImporte=$(".textbox-importe");a.txtNumeroComprobante=$(".textbox-numero-comprobante");a.divUploadComprobante=$(".div-upload-comprobante");a.divFondo=$(".div-fondo");a.ddlFondo=$(".dropdown-fondo");a.divObservaciones=$(".div-observaciones");a.txtObservaciones=$(".text-observaciones");a.btnContinuar=$(".btn-continuar");a.initControls();a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,b,c,function(){a.loaded=false;a.setMonedas();a.setComitente();a.setCuentasByMoneda();a.setFondosDestinoByMoneda()},"Core.Business.InformeDepositos")})};a.initControls=function(){a.ddlMoneda.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{idMoneda}",events:{select:function(b){a.setCuentasByMoneda();a.setFondosDestinoByMoneda();a.txtImporte.swidget().value("")}}});a.ddlDestino.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idCuentaBancaria}",textTemplate:"{Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""}]}},events:{select:function(b){if(a.ddlDestino.swidget().value()==-1){a.divFondo.show()}else{a.divFondo.hide()}}}});a.txtImporte.shieldNumericTextBox({min:0,step:1e-06,max:999999999,spinners:false});a.txtNumeroComprobante.shieldTextBox({});a.fileUpload=new Core.Controls.FileUpload(a.divUploadComprobante,{urlMethod:Core.PrefixUrl+"upload/comprobante",fileTypes:{"image/jpeg":"image/jpeg","image/png":"image/png","image/gif":"image/gif","application/pdf":"application/pdf"},maxSize:10485760,onLoad:function(b){a.idComprobanteAdjunto=b.idArchivo},onFileChange:function(){a.idComprobanteAdjunto=null},onError:function(){a.idComprobanteAdjunto=null;var b=new Core.Controls.Dialog("Error","No se ha podido adjuntar el comprobante",{displayButtons:{close:true,accept:false}});b.show();return}});a.ddlFondo.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idCuentaBancaria}",textTemplate:"{Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""}]}}});a.divFondo.hide();a.txtObservaciones.shieldTextBox({});if(Core.Objects.Context.Configuration.idAplicacion==1){a.divObservaciones.hide()}a.btnContinuar.click(function(){var e={value:true};var c={idCuenta:a.header.selectedIdAccount,Monto:Core.Functions.Validations.getValidatedNumericSwidgetValue(a.txtImporte,e),idCuentaBancaria:-1,idCuentaDestino:Core.Functions.Validations.getValidatedDropDownValue(a.ddlDestino,e),NroReferencia:(a.txtNumeroComprobante.swidget().value())?a.txtNumeroComprobante.swidget().value():null,idArchivo:(a.idComprobanteAdjunto)?a.idComprobanteAdjunto:null,Observaciones:a.txtObservaciones.val()};if(c.idCuentaDestino==-1){c.idCuentaDestino=Core.Functions.Validations.getValidatedDropDownValue(a.ddlFondo,e);if(c.idArchivo==null&&!c.NroReferencia){var b=new Core.Controls.Dialog("Validación","Debe adjuntar un comprobante ó ingresar el número del mismo.",{displayButtons:{close:true,accept:false}});b.show();return}}else{if(c.idArchivo==null){var b=new Core.Controls.Dialog("Validación","Debe adjuntar un comprobante.",{displayButtons:{close:true,accept:false}});b.show();return}}if(!e.value){return}var d=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"operar/depositos/informar",requestType:"POST",requestData:c});d.onSuccess=function(g){var f=new Core.Controls.Dialog("Mensaje",g.Descripcion+((g.idOrden!=null&&g.idOrden!="")?" Número: "+g.idOrden:""),{displayButtons:{close:true,accept:false}});f.show();a.clearControls()};d.request()})};a.setMonedas=function(){var b=$.grep(Core.Objects.Accounts,function(f,e){return f.idCuenta==a.header.selectedIdAccount})[0];var c=[];if(b.idNegocio==Core.Enums.eNegocio.BCV){c.push(Core.Enums.Currency.Pesos);c.push(Core.Enums.Currency.Dolares)}c.push(Core.Enums.Currency.DolaresCable);var d=a.ddlMoneda.swidget().initialOptions;d.dataSource.data=c;a.ddlMoneda.swidget().refresh(d)};a.setFondosDestinoByMoneda=function(){var b=new Core.Ajax.ServerRequest({allowCache:true,showOverlay:!a.loaded,secureRequest:true,requestUrl:"fondos",requestType:"GET",requestData:{idCuenta:a.header.selectedIdAccount}});b.onSuccess=function(e){var c=$.grep(e.fondos,function(g,f){return g.idMoneda==a.ddlMoneda.swidget().value()});var d=a.ddlFondo.swidget().initialOptions;d.dataSource.data=c;a.ddlFondo.swidget().refresh(d)};b.request()};a.setCuentasByMoneda=function(){var b=new Core.Ajax.ServerRequest({allowCache:true,showOverlay:!a.loaded,secureRequest:true,requestUrl:"cuentasbancariasbalanz",requestType:"GET"});b.onSuccess=function(f){var e=a.ddlDestino.swidget().initialOptions;var d=$.grep(f.cuentas,function(h,g){return h.idMoneda==a.ddlMoneda.swidget().value()});var c=$.grep(Core.Objects.Accounts,function(h,g){return h.idCuenta==a.header.selectedIdAccount})[0];if(c&&c.NumCuotapartista!=""){d.push({idCuentaBancaria:-1,Descripcion:"Fondo Común de Inversion"})}e.dataSource.data=d;a.ddlDestino.swidget().refresh(e)};b.request()};a.setComitente=function(){var b=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"datoscuenta/"+encodeURIComponent(a.header.selectedIdAccount),requestType:"GET"});b.onSuccess=function(c){a.lblComitenteCuenta.text("Comitente Nº "+c.DatosCuenta.NumComitente+" | "+c.DatosCuenta.DescripcionBolsa)};b.request()};a.clearControls=function(){a.txtImporte.swidget().value("");a.txtNumeroComprobante.swidget().value("");a.idComprobanteAdjunto=null;a.fileUpload.clear();a.txtObservaciones.val("")}};Core.Business.InternacionalComisionesINTL=new function(){var a=this;a.eComisionEstado={Pendiente:0,Finalizado:1,Cerrado:2};a.id="comisionesInternacionalINTL";a.divComisionesINTL=null;a.lblTitle=null;a.txtDateFrom=null;a.txtDateTo=null;a.timerId=null;a.btnRefresh=null;a.btnAsesores=null;a.lblTotalRegistros=null;a.lblTotalComisiones=null;a.btnConfirmarArchivo=null;a.btnDetallesIncorporaciones=null;a.inputFiles=null;a.timeout=null;a.window=$(window);a.dataGrid=null;a.init=function(b,c){Core.loadPage("internacional-comisiones-intl.html",function(){document.title="Comisiones INTL";a.divComisionesINTL=$(".div-comisiones-intl");a.lblTitle=$(".label-title");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.btnRefresh=$(".btn-refresh");a.btnAsesores=$(".btn-asesores");a.lblTotalRegistros=$(".lbl-total-registros");a.lblTotalComisiones=$(".lbl-total-comisiones");a.inputFiles=$(".input-upload-file");a.btnConfirmarArchivos=$(".btn-confirmar-archivos");a.btnDetallesIncorporaciones=$(".btn-detalles-incorporaciones");a.initControls();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadGrid()},"Core.Business.InternacionalComisionesINTL")})};a.initControls=function(){var b=new Date();b.setDate(b.getDate()-1);a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:b,max:new Date(),events:{change:function(c){a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loadGrid()}}});a.btnRefresh.on("click",function(){a.loadGrid()});a.btnAsesores.on("click",function(){var c=new Core.Business.InternacionalComisionesINTL.Asesores({overlayElement:a.btnAsesores}).show()});a.btnConfirmarArchivos.on("click",function(){if(a.inputFiles[0].files.length==0){var k=new Core.Controls.Dialog("Aviso","<p>Debe seleccionar al menos un archivo.</p>",{displayButtons:{close:true,accept:false}}).show();return}for(var j=0,e;e=a.inputFiles[0].files[j];j++){var g=e.name.split(".");var d=g[g.length-1];if(d!="csv"){var k=new Core.Controls.Dialog("Aviso","<p>Los archivos seleccionados deben ser: csv.</p>",{displayButtons:{close:true,accept:false}}).show();return}}var h={Authorization:Core.Objects.Context.Token,Accept:"application/json"};var c=new FormData();for(var j=0,e;e=a.inputFiles[0].files[j];j++){c.append("file-"+j,e)}var l=new Core.Controls.Overlay(a.btnConfirmarArchivos,{});$.ajax({type:"POST",url:Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"upload/csv/intlConvertircsv",data:c,cache:false,contentType:false,processData:false,method:"POST",headers:h,success:function(f){l.destroy();a.inputFiles.val("");a.loadGrid();new Core.Controls.Dialog(title,"<p>Finalizo la importación del archivo.</p>",{displayButtons:{close:true,accept:false}}).show()},error:function(i){l.destroy();var n=JSON.parse(i.responseText);var o=(n&&n.descripcion)?"Mensaje":"Error de conexión";var f=(n&&n.descripcion)?n.descripcion:"Algunos componentes de la página no se cargaron correctamente. Por favor intente mas tarde...";var m=new Core.Controls.Dialog(o,"<p>"+f+"</p>",{displayButtons:{close:true,accept:false}});m.show()}})});a.btnDetallesIncorporaciones.on("click",function(){new Core.Business.InternacionalComisionesINTL.Incorporaciones({overlayElement:a.btnDetallesIncorporaciones,onDeleted:function(){a.loadGrid()}}).show()})};a.initGrid=function(){var b=[];b.push({field:"id",title:"ID",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"OrigenComision",title:"Origen",width:"8%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"FechaCreacion",title:"Fecha Creación",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"ActNumber",title:"ActNumber",width:"8%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Description1",title:"Descripción 1",width:"12%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Client",title:"Client",width:"18%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"idPersonaAsesor",title:"ID Asesor",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({title:"Asesor",width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),columnTemplate:function(c,d,e){c.addClass("text-left");if(d.permitirCambios){c.html("<a>"+(d.Asesor==""?"No definido":d.Asesor)+"</a>");c.addClass("link-cell");c.on("click",function(){new Core.Business.InternacionalComisionesINTL.EditarComision({comision:d,editarAsesor:true,onSuccess:function(){a.loaded=false;a.loadGrid()}}).show()})}else{c.html((d.Asesor==""||d.Asesor=="Seleccione...")?"Sin Asignar":d.Asesor)}}});b.push({field:"Commission",title:"Commission",width:"8%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatPrice});b.push({field:"Fecha",title:"Fecha Trade",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"idExcel",title:"Excel",width:"5%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Moneda",title:"Moneda",width:"8%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({title:" ",width:50,headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,e,f){d.parent().css("background-color","rgba("+a.hexToRgb(e.ColorFila)+((f%2==0)?", 0.6":", 1 ")+")");if(e.permitirCambios&&e.Estado!=a.eComisionEstado.Cerrado){var c=$('<button type="button" title="Eliminar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(d);c.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar la comisión de "+e.id+"?",{onAccepted:function(){var g=new Core.Ajax.ServerRequest({overlayElement:c,requestUrl:"intl/actualizar",requestType:"POST",requestData:{idINTL:e.id,eliminado:1}});g.onSuccess=function(h){a.loadGrid()};g.request()}}).show()})}}});a.divComisionesINTL.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Comisiones INTL",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["idExcel","ActNumber","Client","Description1","Description2","Description3","TradeDate","Quantity","Price","Commission","FechaCreacion","idPersonaAsesor","Asesor","Moneda"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Comisiones INTL"}}},selection:false,rowHover:false,sorting:{multiple:true},columns:b})};a.loadGrid=function(){a.lblTitle.text("Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var b="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));b+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));var c=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divComisionesINTL.parent(),secureRequest:true,requestUrl:"intl",requestType:"GET",requestData:b});c.onSuccess=function(e){var g=a.window.scrollTop();var f=a.divComisionesINTL.swidget().initialOptions;e.intl.sort(function(h,i){if(h.id>i.id){return -1}else{if(h.id<i.id){return 1}else{return 0}}});f.dataSource.data=e;f.dataSource.schema={data:"intl"};f.dataSource.sort=a.divComisionesINTL.swidget().dataSource.sort;f.exportOptions.excel.dataSource.data=e;f.exportOptions.excel.dataSource.schema={data:"intl"};f.exportOptions.excel.readDataSource=true;a.divComisionesINTL.swidget().refresh(f);if(e.intl.length){a.lblTotalRegistros.html("<strong>Total de Registros: </strong>"+Core.Functions.grid.formatIntegerNumber(e.intl.length))}else{a.lblTotalRegistros.html("")}var d=0;e.intl.forEach(function(i,h){d+=i.Commission});if(d){a.lblTotalComisiones.html("<strong>Total de Comisiones: </strong>"+Core.Functions.grid.formatNumber(d))}else{a.lblTotalComisiones.html("")}a.window.scrollTop(g)};c.request()};a.hexToRgb=function(d){d=d.replace("#","");var f=parseInt(d.substring(0,2),16);var e=parseInt(d.substring(2,4),16);var c=parseInt(d.substring(4,6),16);var h=f+","+e+","+c;return h}};Core.Business.InternacionalComisionesINTL.EditarComision=function(b){var a=this;a.divModal=$(".div-editar-comision");a.title=null;a.ddlOptions=null;a.comision=null;a.editarAsesor=null;a.editarUnidadNegocio=null;a.editarCuenta=null;a.onSuccess=function(){};a.requestUrl="intl";$.extend(true,a,b);a.show=function(){a.title=a.divModal.find(".title");a.divOptions=a.divModal.find(".div-options");a.ddlOptions=a.divModal.find(".dropdown-options");Core.Functions.Validations.toggleValidation(a.ddlOptions,false);a.divComitente=a.divModal.find(".div-comitente");a.txtComitente=a.divModal.find(".textbox-comitente");Core.Functions.Validations.toggleValidation(a.txtComitente,false);a.divCuotapartista=a.divModal.find(".div-cuotapartista");a.txtCuotapartista=a.divModal.find(".textbox-cuotapartista");Core.Functions.Validations.toggleValidation(a.txtCuotapartista,false);a.loadControls();a.divModal.find(".btn-confirmar-cambio-comision").unbind("click");a.divModal.find(".btn-confirmar-cambio-comision").click(function(){Core.Functions.Validations.toggleValidation(a.ddlOptions,false);Core.Functions.Validations.toggleValidation(a.txtComitente,false);Core.Functions.Validations.toggleValidation(a.txtCuotapartista,false);var e={value:true};var c={};c.idINTL=a.comision.id;if(a.editarAsesor){c.idAsesor=Core.Functions.Validations.getValidatedDropDownValue(a.ddlOptions,e)}if(a.editarUnidadNegocio){c.idUnidadNegocio=Core.Functions.Validations.getValidatedDropDownValue(a.ddlOptions,e)}if(a.editarCuenta){if(a.txtComitente.val()){c.NumComitente=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedPositiveNumericInputValue(a.txtComitente,e))}if(a.txtCuotapartista.val()){c.NumCuotapartista=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedPositiveNumericInputValue(a.txtCuotapartista,e))}if(!a.txtComitente.val()&&!a.txtCuotapartista.val()){e.value=false;Core.Functions.Validations.toggleValidation(a.txtComitente,true);Core.Functions.Validations.toggleValidation(a.txtCuotapartista,true)}}if(e.value){var d=new Core.Ajax.ServerRequest({requestUrl:a.requestUrl+"/actualizar",requestType:"POST",requestData:c});d.onSuccess=function(f){a.onSuccess();a.divModal.modal("hide")};d.request()}});a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()})};a.loadControls=function(){if(a.editarAsesor){a.title.text("Modificar Asesor");a.divOptions.show();a.divComitente.hide();a.divCuotapartista.hide();var c={idUnidadDeNegocios:a.comision.idUnidadDeNegocios};var d=new Core.Ajax.ServerRequest({requestUrl:a.requestUrl+"/asesores",requestType:"GET",requestData:c});d.onSuccess=function(f){a.ddlOptions.shieldComboBox({dataSource:{data:f.asesores},textTemplate:"{Nombre}",valueTemplate:"{idPersona}",value:a.comision.idPersonaAsesor.toString(),autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}}});a.divModal.modal({show:true})};d.request()}if(a.editarCuenta){a.title.text("Modificar Cuenta");a.divOptions.hide();a.divComitente.show();a.divCuotapartista.show();new Core.Controls.DecimalPicker(a.txtComitente,{maxDecimalDigitCount:0,showThousandsSeparator:"",defaultValue:""});new Core.Controls.DecimalPicker(a.txtCuotapartista,{maxDecimalDigitCount:0,showThousandsSeparator:"",defaultValue:""});a.divModal.modal({show:true})}if(a.editarUnidadNegocio){a.title.text("Modificar Unidad de Negocio");a.divOptions.show();a.divComitente.hide();a.divCuotapartista.hide();var e=new Core.Ajax.ServerRequest({requestUrl:a.requestUrl+"/unidadesDeNegocio",requestType:"GET"});e.onSuccess=function(f){a.ddlOptions.shieldDropDown({dataSource:{data:f.unidadesDeNegocio},textTemplate:"{Descripcion}",valueTemplate:"{idUnidadDeNegocio}",value:a.comision.idUnidadDeNegocios.toString()});a.divModal.modal({show:true})};e.request()}};a.destroy=function(){if(a.ddlOptions.swidget()){a.ddlOptions.swidget().destroy()}}};Core.Business.InternacionalComisionesINTL.Asesores=function(b){var a=this;a.divModal=$(".div-comisiones-asesores");a.overlayElement=null;a.divAsesores=null;a.requestUrl="intl";$.extend(true,a,b);a.show=function(){var c=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,requestUrl:a.requestUrl+"/unidadesasesores",requestType:"GET"});c.onSuccess=function(g){a.divAsesores=a.divModal.find(".div-asesores");var d=[];var e=[];d.push({field:"UnidadDeNegocio",title:"Unidad de Negocio",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedString});e.push("UnidadDeNegocio");if(a.requestUrl=="intl"){d.push({field:"Asesor",title:"Asesor",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedString});e.push("Asesor");d.push({field:"IdAsesor",title:"ID Asesor",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});e.push("IdAsesor")}else{d.push({field:"Nombre",title:"Nombre",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedString});e.push("Nombre");d.push({field:"idPersona",title:"ID Persona",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});e.push("idPersona")}var f={dataSource:{data:g.data},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Asesores",dataSource:{data:g.data},readDataSource:true,author:"Balanz Capital Valores S.A.",columnFields:e,header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Asesores"}}},selection:false,rowHover:false,sorting:{multiple:true},columns:d,noRecordsText:"No se encontraron asesores."};a.divAsesores.shieldGrid(f);a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.divAsesores.swidget().destroy()});a.divModal.modal({show:true})};c.request()}};Core.Business.InternacionalComisionesINTL.Incorporaciones=function(b){var a=this;a.divModal=$(".div-comisiones-incorporaciones");a.overlayElement=null;a.divIncorporaciones=null;a.requestUrl="intl";a.fuente=1;a.onDeleted=function(){};$.extend(true,a,b);a.show=function(){a.divIncorporaciones=a.divModal.find(".div-incorporaciones");var d=[];d.push({width:"10%",field:"idINTLArchivo",title:"ID",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});d.push({width:"70%",field:"Nombre",title:"Nombre",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedString});d.push({width:"20%",field:"FechaImportacion",title:"Fecha Importación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatStringDateWithTime});var c=Core.Functions.grid.getHeaderAttribute(d.length);d.push({width:45,title:" ",headerAttributes:c,columnTemplate:function(f,g,h){var e=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(f);e.on("click",function(){a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy();new Core.Business.InternacionalComisionesINTL.DetallesIncorporacion({requestUrl:a.requestUrl,idINTLArchivo:g.idINTLArchivo}).show()});a.divModal.modal("hide")})}});d.push({width:45,title:" ",headerAttributes:c,columnTemplate:function(f,g,h){var e=$('<button type="button" title="Eliminar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(f);e.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar el archivo de ID "+g.idINTLArchivo+"?",{onAccepted:function(){var i=new Core.Ajax.ServerRequest({overlayElement:a.divIncorporaciones,requestUrl:a.requestUrl+"/eliminarArchivo/"+g.idINTLArchivo,requestType:"PUT"});i.onSuccess=function(k){a.onDeleted();a.loadGrid();if(k.Descripcion){var j=new Core.Controls.Dialog("Aviso",k.Descripcion,{displayButtons:{close:true,accept:false}});j.show()}};i.request()}}).show()})}});a.divIncorporaciones.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:d,noRecordsText:"No se encontraron detalles."});a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.divModal.modal({show:true});a.loadGrid()};a.loadGrid=function(){var c=new Core.Ajax.ServerRequest({overlayElement:a.divIncorporaciones,requestUrl:"archivo/detalles/ultimosarchivos/"+a.fuente,requestType:"GET"});c.onSuccess=function(e){var d=a.divIncorporaciones.swidget().initialOptions;d.dataSource.data=e.detalles?e.detalles:[];a.divIncorporaciones.swidget().refresh(d)};c.request()};a.destroy=function(){a.divIncorporaciones.swidget().destroy()}};Core.Business.InternacionalComisionesINTL.DetallesIncorporacion=function(b){var a=this;a.divModal=$(".div-comisiones-detalles-incorporacion");a.divDetalles=null;a.idINTLArchivo=null;a.requestUrl="intl";$.extend(true,a,b);a.show=function(){var c=new Core.Ajax.ServerRequest({requestUrl:a.requestUrl+"/detalles/procesamiento/"+a.idINTLArchivo,requestType:"GET"});c.onSuccess=function(f){a.lblTitle=a.divModal.find(".lbl-title");a.lblTitle.text("Detalles archivo: "+a.idINTLArchivo);a.divDetalles=a.divModal.find(".div-detalles-incorporacion");var d=[];var e=[];d.push({width:"4%",field:"CodTipoLinea",title:"Línea",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedIntegerNumber});e.push("CodTipoLinea");if(a.requestUrl=="intl"){d.push({width:"4%",field:"CodTipoVinculacion",title:"Vin",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),columnTemplate:function(g,h,i){g.parent().css("background-color","rgba("+(h.Color?(Core.Functions.grid.hexToRgb(h.Color)+((i%2==0)?", 0.6":", 1 ")):"")+")");g.attr("title","Vinculación");g.text(Core.Functions.grid.formatUndefinedIntegerNumber(h.CodTipoVinculacion))}});e.push("CodTipoVinculacion");d.push({width:"10%",field:"InsertadoINTL",title:"Insertado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedString});e.push("InsertadoINTL")}else{d.push({width:"10%",field:"Insertado",title:"Insertado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedString});e.push("Insertado")}d.push({width:"30%",field:"Comentario",title:"Comentario",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedString});e.push("Comentario");if(a.requestUrl=="intl"){d.push({width:"4%",field:"idExcel",title:"Excel",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});e.push("idExcel")}d.push({width:"40%",field:"LineaOriginal",title:"Línea Original",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedString});e.push("LineaOriginal");a.divDetalles.shieldGrid({dataSource:{data:f.detalles?f.detalles:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:d,paging:{pageSize:10,pageLinksCount:10},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:f.detalles?f.detalles:[]},readDataSource:true,fileName:"Comisiones INTL",author:"Balanz Capital Valores S.A.",columnFields:e,header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Comisiones INTL"}}},noRecordsText:"No se encontraron detalles."});a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.divModal.modal({show:true})};c.request()};a.destroy=function(){a.divDetalles.swidget().destroy()}};Core.Business.otrasComisiones=new function(){var a=this;a.eComisionEstado={Pendiente:0,Finalizado:1,Cerrado:2};a.id="otrasComisiones";a.divComisiones=null;a.lblTitle=null;a.txtDateFrom=null;a.txtDateTo=null;a.timerId=null;a.btnRefresh=null;a.btnAsesores=null;a.lblTotalRegistros=null;a.lblTotalComisiones=null;a.btnConfirmarArchivo=null;a.btnDetallesIncorporaciones=null;a.inputFiles=null;a.timeout=null;a.window=$(window);a.dataGrid=null;a.init=function(b,c){Core.loadPage("internacional-otras-comisiones.html",function(){document.title="Otras Comisiones";a.divComisiones=$(".div-comisiones");a.lblTitle=$(".label-title");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.btnRefresh=$(".btn-refresh");a.btnAsesores=$(".btn-asesores");a.lblTotalRegistros=$(".lbl-total-registros");a.lblTotalComisiones=$(".lbl-total-comisiones");a.inputFiles=$(".input-upload-file");a.btnConfirmarArchivos=$(".btn-confirmar-archivos");a.btnDetallesIncorporaciones=$(".btn-detalles-incorporaciones");a.initControls();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadGrid()},"Core.Business.otrasComisiones")})};a.initControls=function(){var b=new Date();b.setDate(b.getDate()-1);a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:b,max:new Date(),events:{change:function(c){a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loadGrid()}}});a.btnRefresh.on("click",function(){a.loadGrid()});a.btnAsesores.on("click",function(){var c=new Core.Business.InternacionalComisionesINTL.Asesores({requestUrl:"comisionesAdicionales",overlayElement:a.btnAsesores}).show()});a.btnConfirmarArchivos.on("click",function(){if(a.inputFiles[0].files.length==0){var k=new Core.Controls.Dialog("Aviso","<p>Debe seleccionar al menos un archivo.</p>",{displayButtons:{close:true,accept:false}}).show();return}for(var j=0,e;e=a.inputFiles[0].files[j];j++){var g=e.name.split(".");var d=g[g.length-1];if(d!="csv"){var k=new Core.Controls.Dialog("Aviso","<p>Los archivos seleccionados deben ser: csv.</p>",{displayButtons:{close:true,accept:false}}).show();return}}var h={Authorization:Core.Objects.Context.Token,Accept:"application/json"};var c=new FormData();for(var j=0,e;e=a.inputFiles[0].files[j];j++){c.append("file-"+j,e)}var l=new Core.Controls.Overlay(a.btnConfirmarArchivos,{});$.ajax({type:"POST",url:Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"upload/csv/intlConvertircsv?otrascomi=S",data:c,cache:false,contentType:false,processData:false,method:"POST",headers:h,success:function(f){l.destroy();a.inputFiles.val("");a.loadGrid();new Core.Controls.Dialog(title,"<p>Finalizo la importación del archivo.</p>",{displayButtons:{close:true,accept:false}}).show()},error:function(i){l.destroy();var n=JSON.parse(i.responseText);var o=(n&&n.descripcion)?"Mensaje":"Error de conexión";var f=(n&&n.descripcion)?n.descripcion:"Algunos componentes de la página no se cargaron correctamente. Por favor intente mas tarde...";var m=new Core.Controls.Dialog(o,"<p>"+f+"</p>",{displayButtons:{close:true,accept:false}});m.show()}})});a.btnDetallesIncorporaciones.on("click",function(){new Core.Business.InternacionalComisionesINTL.Incorporaciones({requestUrl:"comisionesAdicionales",fuente:2,overlayElement:a.btnDetallesIncorporaciones,onDeleted:function(){a.loadGrid()}}).show()})};a.initGrid=function(){var b=[];b.push({field:"id",title:"ID",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({title:"Cuenta",width:"18%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),columnTemplate:function(c,d,e){c.addClass("text-left");if(d.permitirCambios){c.html("<a>"+(d.DescripcionCuenta==""?"No definido":d.DescripcionCuenta)+"</a>");c.addClass("link-cell");c.on("click",function(){var f=new Core.Business.InternacionalComisionesINTL.EditarComision({requestUrl:"comisionesAdicionales",comision:d,editarCuenta:true,onSuccess:function(){a.loadGrid()}}).show()})}else{c.html((d.DescripcionCuenta==""||d.DescripcionCuenta=="Seleccione...")?"Sin Asignar":d.DescripcionCuenta)}}});b.push({title:"Asesor",width:"18%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),columnTemplate:function(c,d,e){c.addClass("text-left");if(d.permitirCambios){c.html("<a>"+(d.Asesor==""?"No definido":d.Asesor)+"</a>");c.addClass("link-cell");c.on("click",function(){var f=new Core.Business.InternacionalComisionesINTL.EditarComision({requestUrl:"comisionesAdicionales",comision:d,editarAsesor:true,onSuccess:function(){a.loadGrid()}}).show()})}else{c.html((d.Asesor==""||d.Asesor=="Seleccione...")?"Sin Asignar":d.Asesor)}}});b.push({width:"6%",field:"FechaCreacion",title:"Fecha Creación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"6%",field:"FechaConcertacion",title:"Fecha Concertación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"5%",field:"idExterno",title:"ID Externo",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({width:"18%",field:"Descripcion",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"6%",field:"Ticker",title:"Ticker",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"6%",field:"Cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithDecimals});b.push({width:"6%",field:"Precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithDecimals});b.push({width:"6%",field:"IVAComision",title:"IVA Comisión",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithDecimals});b.push({width:"6%",field:"Comision",title:"Comisión",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithDecimals});b.push({width:"5%",field:"Moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({title:" ",width:50,headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,e,f){d.parent().css("background-color","rgba("+Core.Functions.grid.hexToRgb(e.ColorFila)+((f%2==0)?", 0.6":", 1 ")+")");if(e.permitirCambios&&e.Estado!=a.eComisionEstado.Cerrado){var c=$('<button type="button" title="Eliminar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(d);c.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar la comisión de "+e.id+"?",{onAccepted:function(){var g=new Core.Ajax.ServerRequest({overlayElement:c,requestUrl:"comisionesAdicionales/actualizar",requestType:"POST",requestData:{idINTL:e.id,eliminado:1}});g.onSuccess=function(h){a.loadGrid()};g.request()}}).show()})}}});a.divComisiones.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Otras Comisiones",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["id","DescripcionCuenta","Asesor","FechaCreacion","FechaConcertacion","idExterno","Descripcion","Ticker","Cantidad","Precio","IVAComision","Comision","Moneda"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Otras Comisiones"}}},selection:false,rowHover:false,sorting:{multiple:true},columns:b})};a.loadGrid=function(){a.lblTitle.text("Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var b="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));b+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));var c=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divComisiones.parent(),secureRequest:true,requestUrl:"comisionesAdicionales",requestType:"GET",requestData:b});c.onSuccess=function(e){var g=a.window.scrollTop();var f=a.divComisiones.swidget().initialOptions;e.intl.sort(function(h,i){if(h.id>i.id){return -1}else{if(h.id<i.id){return 1}else{return 0}}});f.dataSource.data=e;f.dataSource.schema={data:"intl"};f.dataSource.sort=a.divComisiones.swidget().dataSource.sort;f.exportOptions.excel.dataSource.data=e;f.exportOptions.excel.dataSource.schema={data:"intl"};f.exportOptions.excel.readDataSource=true;a.divComisiones.swidget().refresh(f);if(e.intl.length){a.lblTotalRegistros.html("<strong>Total de Registros: </strong>"+Core.Functions.grid.formatIntegerNumber(e.intl.length))}else{a.lblTotalRegistros.html("")}var d=0;e.intl.forEach(function(i,h){d+=i.Comision});if(d){a.lblTotalComisiones.html("<strong>Total de Comisiones: </strong>"+Core.Functions.grid.formatNumber(d))}else{a.lblTotalComisiones.html("")}a.window.scrollTop(g)};c.request()}};Core.Business.Lebacs=new function(){var a=this;a.id="cot_lebacs";a.optionsCotizaciones=null;a.divLebacs=null;a.divChksMonedas=null;a.lblChkPesos=null;a.chkPesos=null;a.lblChkDolaresMep=null;a.chkDolaresMep=null;a.lblChkDolaresCable=null;a.chkDolaresCable=null;a.txtFilterLebacs=null;a.timeoutLebacs=null;a.divPlazo=null;a.ddlPlazo=null;a.maxToken=0;a.lastData=null;a.window=$(window);a.timerId=null;a.timerIdForceRefresh=null;a.loaded=false;a.refresh=false;a.forceRefresh=false;a.init=function(b,c){Core.loadPage("lebacs.html",function(){document.title="Lebacs";a.loaded=false;a.refresh=false;a.forceRefresh=false;a.optionsCotizaciones=Core.Functions.Context.Profiles.getPageOptionsByMenu("cotizaciones",Core.Objects.Context.Profiles[c]);a.maxToken=0;a.lastData=null;a.divLebacs=$(".div-lebacs");a.txtFilterLebacs=$(".textbox-lebacs-filter");a.divChksMonedas=$(".div-chks-monedas");a.divChksMonedas.hide();a.lblChkPesos=$(".lbl-checkbox-pesos");a.chkPesos=$(".checkbox-pesos");a.chkPesos[0].checked=true;a.lblChkDolaresMep=$(".lbl-checkbox-dolares-mep");a.chkDolaresMep=$(".checkbox-dolares-mep");a.chkDolaresMep[0].checked=false;a.lblChkDolaresCable=$(".lbl-checkbox-dolares-cable");a.chkDolaresCable=$(".checkbox-dolares-cable");a.chkDolaresCable[0].checked=false;a.divPlazo=$(".div-plazo");a.ddlPlazo=$(".dropdown-plazo");a.divPlazo.hide();Core.Functions.grid.Cotizaciones.initGrid(a.divLebacs,true,true,false,Core.Objects.Context.Profiles[c].opciones.maxWatchlists,null,null,a.optionsCotizaciones.cot_profundidad,Core.Enums.ePanel.Lebacs,b,c);a.ddlPlazo.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",events:{select:function(d){a.setTab()}},width:150});a.chkPesos.on("change",function(){a.setTab()});a.chkDolaresMep.on("change",function(){a.setTab()});a.chkDolaresCable.on("change",function(){a.setTab()});Core.Functions.grid.Cotizaciones.initFilter(a.divLebacs,a.txtFilterLebacs,a.timeoutLebacs,a.window);a.ddlInstrumentSearch=$(".dropdown-instrument-search");Core.Functions.grid.Cotizaciones.initInstrumentSearch(a.ddlInstrumentSearch,b,c);a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){Core.Functions.grid.Cotizaciones.loadInstrumentSearch(b,a.ddlInstrumentSearch,function(){a.setTab()})},"Core.Business.Lebacs")})};a.setTab=function(){Core.Functions.grid.Cotizaciones.details=[];a.maxToken=0;a.lastData=null;a.refresh=false;a.forceRefresh=false;if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:0,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(b){}}window.clearInterval(a.timerId);Core.Objects.Context.Timers.remove(a.timerId);window.clearInterval(a.timerIdForceRefresh);Core.Objects.Context.Timers.remove(a.timerIdForceRefresh);Core.Functions.grid.Cotizaciones.loadGrid(a.divLebacs,null,"lebacs",a.lastData,a.maxToken,null,null,function(c,b){return(!a.loaded||(c.plazo==a.ddlPlazo.swidget().selectedItem().value&&a.filterMoneda(c.mo)))},function(e,f){a.lastData=e;a.maxToken=f;if(!a.loaded){var h=[];var g=[];a.lastData.forEach(function(j,i){if(h.indexOf(j.plazo)==-1){h.push(j.plazo)}if(g.indexOf(j.mo)==-1){g.push(j.mo)}});var b=[];h.forEach(function(j,i){b.push({value:j,text:j})});var c=a.ddlPlazo.swidget().initialOptions;c.dataSource.data=b;a.ddlPlazo.swidget().refresh(c);a.ddlPlazo.swidget().selected(0,true);if(h.length>1){a.divPlazo.show()}if(g.length>1){a.divChksMonedas.show();if(g.indexOf("Pesos")==-1){a.chkPesos.hide();a.lblChkPesos.hide()}if(g.indexOf("Dolar MEP")==-1){a.chkDolaresMep.hide();a.lblChkDolaresMep.hide()}if(g.indexOf("Dolar Cable")==-1){a.chkDolaresCable.hide();a.lblChkDolaresCable.hide()}}a.loaded=true;var d=a.divLebacs.swidget().initialOptions;d.dataSource.data=$.grep(a.lastData,function(j,i){return(j.plazo==a.ddlPlazo.val()&&a.filterMoneda(j.mo))});a.divLebacs.swidget().refresh(d)}},a.optionsCotizaciones.cot_profundidad);a.timerId=window.setInterval(function(){if(a.loaded&&(a.refresh||a.forceRefresh)){Core.Functions.grid.Cotizaciones.loadGrid(a.divLebacs,null,"lebacs",a.lastData,a.maxToken,null,null,function(c,b){return(c.plazo==a.ddlPlazo.swidget().selectedItem().value&&a.filterMoneda(c.mo))},function(b,c){a.lastData=b;a.maxToken=c},a.optionsCotizaciones.cot_profundidad);a.forceRefresh=false}a.refresh=true},Core.Functions.grid.Cotizaciones.REFRESH_TIME);Core.Objects.Context.Timers.push(a.timerId);a.timerIdForceRefresh=window.setInterval(function(){a.forceRefresh=true},600000);Core.Objects.Context.Timers.push(a.timerIdForceRefresh);if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:Core.Enums.ePanel.Lebacs,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(c){if(a.loaded){var b={cotizaciones:[]};b.cotizaciones.push(JSON.parse(c.data));Core.Functions.grid.Cotizaciones.refreshGrid(b,a.divLebacs,null,a.lastData,a.maxToken,null,null,function(e,d){return(e.plazo==a.ddlPlazo.swidget().selectedItem().value&&a.filterMoneda(e.mo))},function(d,e){a.lastData=d;a.maxToken=e;a.refresh=false},a.optionsCotizaciones.cot_profundidad)}}}};a.filterMoneda=function(b){return(b=="Pesos"&&(!a.divChksMonedas.is(":visible")||(a.chkPesos[0].checked)))||(b=="Dolar MEP"&&(!a.divChksMonedas.is(":visible")||(a.chkDolaresMep[0].checked)))||(b=="Dolar Cable"&&(!a.divChksMonedas.is(":visible")||(a.chkDolaresCable[0].checked)))}};Core.Business.Legajos=new function(){var b=this;var a=13;b.idDefaultAccount=null;b.idDefaultProfile=null;b.id="homeLegajos";b.divContainerTablaLegajos=null;b.divLegajos=null;b.pageOptions=null;b.txtSearch=null;b.btnSearch=null;b.txtFilter=null;b.containerLegajosCuentas=null;b.containerAltaCuenta=null;b.timeout=null;b.init=function(c,d,e){Core.loadPage("legajos-cuentas.html",function(){document.title="Legajos";b.idDefaultAccount=c;b.idDefaultProfile=d;b.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(b.id,Core.Objects.Context.Profiles[d]);b.divContainerTablaLegajos=$(".div-container-tabla-legajos");b.divContainerTablaLegajos.hide();b.divLegajos=$(".div-legajos");b.txtFilter=$(".textbox-filter");b.txtSearch=$(".textbox-search");b.btnSearch=$(".btn-search");b.containerLegajosCuentas=$(".div-container-legajos-cuentas");b.containerLegajosCuentas.show();b.containerAltaCuenta=$(".div-container-alta-cuenta");b.containerAltaCuenta.hide();b.initGrid();b.initFilter();b.header=new Core.Controls.Header($("#topNav"),{});b.header.init(false,c,d,function(){if(Core.Objects.Legajos){b.divContainerTablaLegajos.show()}if(e&&e.idLegajo){b.verLegajo(e.idLegajo,(e.version?e.version:0))}},"Core.Business.Legajos")})};b.initFilter=function(){b.txtFilter.on("keydown",function(){clearTimeout(b.timeout);b.timeout=setTimeout(function(){value=b.txtFilter.val();var c=b.divLegajos.swidget().dataSource;if(value){c.filter={or:[{path:"idLegajo",filter:"contains",value:value},{path:"VersionActual",filter:"contains",value:value},{path:"Estado",filter:"contains",value:value},{path:"Cuenta",filter:"contains",value:value},{path:"Comitente",filter:"contains",value:value},{path:"Cuotapartista",filter:"contains",value:value},{path:"Asesor",filter:"contains",value:value},{path:"FechaApertura",filter:"contains",value:value}]}}else{c.filter=null}c.read()},50)});Core.Functions.Persistence.setTextBox(b.txtFilter,"Core.Business.Legajos.txtFilter");b.txtSearch.on("keyup",function(c){if(c.keyCode==a){b.loadGrid()}});Core.Functions.Persistence.setTextBox(b.txtSearch,"Core.Business.Legajos.txtSearch");b.btnSearch.on("click",function(){b.loadGrid()})};b.initGrid=function(){var c=[];var d=Core.Functions.grid.getHeaderAttribute(1);c.push({width:30,field:"",title:" ",headerAttributes:d,columnTemplate:function(e,f,g){if(f.idNegocio==Core.Enums.eNegocio.BCI){$('<img src="/images/icono-internacional.svg" style="margin-left:10px; width:20px; height:20px;" />').appendTo(e)}}});c.push({width:"10%",field:"idLegajo",title:"ID Legajo",headerAttributes:d});c.push({width:"10%",field:"VersionActual",title:"Versión",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({width:"15%",field:"Estado",title:"Estado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({width:"20%",field:"Cuenta",title:"Cuenta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({width:"10%",field:"Comitente",title:"Comitente",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({width:"10%",field:"Cuotapartista",title:"Cuotapartista",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({width:"15%",field:"Asesor",title:"Asesor",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({width:"10%",field:"FechaApertura",title:"Fecha Apertura",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({width:50,field:"",title:" ",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),columnTemplate:function(e,f,h){var g=$('<button disabled style="border:3px solid; background-color:#fff;" type="button" title="Prueba de Vida" class="btn-sm balanz-button"><img src="/images/prueba-de-vida.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color",(!f.tienePruebaDeVida)?"lightcoral":((f.tienePruebaDeVida=="1")?"lightgreen":f.tienePruebaDeVida))}});c.push({width:180,field:"",title:" ",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),columnTemplate:function(i,j,k){var h=$('<button type="button" title="Acceder" class="btn-sm balanz-button"><span class="glyphicon glyphicon-resize-full"></span></button>').appendTo(i);h.on("click",function(){b.verLegajo(j.idLegajo,j.VersionActual)});var f=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(i);f.on("click",function(){new Core.Controls.DetalleAperturaCuenta({idAperturaCuenta:j.idLegajo,overlayElement:f}).show()});var e=$('<button type="button" title="Descargar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>').appendTo(i);e.on("click",function(){function m(t){var s=new Blob([t.response],{type:t.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(s);return}var n=window.URL.createObjectURL(s);var r=document.createElement("a");r.href=n;var p=t.getResponseHeader("Content-Disposition").split("; ");var o="filename=cuenta.zip";for(var q=0;q<p.length;q++){if(p[q].indexOf("filename")>=0){o=p[q]}}r.download=o.split("=")[1];r.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(n)}var l=new XMLHttpRequest();l.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"apertura/cuenta/zip/"+j.idLegajo,true);l.responseType="blob";l.setRequestHeader("Authorization",Core.Objects.Context.Token);l.onload=function(n){if(l.status==200){m(l)}else{var o=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga del legajo.</p>",{displayButtons:{close:true,accept:false}});o.show()}};l.send()});var g=$('<button type="button" title="Imprimir" class="btn-sm balanz-button"><span class="glyphicon glyphicon-print"></span></button>').appendTo(i);g.on("click",function(){function m(t){var s=new Blob([t.response],{type:t.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(s);return}var n=window.URL.createObjectURL(s);var r=document.createElement("a");r.href=n;var p=t.getResponseHeader("Content-Disposition").split("; ");var o="filename=cuenta.pdf";for(var q=0;q<p.length;q++){if(p[q].indexOf("filename")>=0){o=p[q]}}r.download=o.split("=")[1];r.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(n)}var l=new XMLHttpRequest();l.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"apertura/cuenta/pdf/"+j.idLegajo,true);l.responseType="blob";l.setRequestHeader("Authorization",Core.Objects.Context.Token);l.onload=function(n){if(l.status==200){m(l)}else{var o=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga del legajo.</p>",{displayButtons:{close:true,accept:false}});o.show()}};l.send()})}});b.divLegajos.shieldGrid({dataSource:{data:Core.Objects.Legajos?Core.Objects.Legajos:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},exportOptions:{excel:{fileName:"Legajos",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["idLegajo","VersionActual","Estado","Cuenta","Comitente","Cuotapartista","Asesor","FechaApertura"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Legajos"}}},columns:c})};b.loadGrid=function(){Core.Objects.Legajos=null;b.divContainerTablaLegajos.hide();if(b.txtSearch.val()&&b.txtSearch.val().length>=3){var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"legajos/casos?search="+b.txtSearch.val(),requestType:"GET"});c.onSuccess=function(d){Core.Objects.Legajos=d.casos;var e=b.divLegajos.swidget().initialOptions;e.dataSource.data=d;e.dataSource.schema={data:"casos"};e.exportOptions.excel.dataSource.data=d;e.exportOptions.excel.dataSource.schema={data:"casos"};e.exportOptions.excel.readDataSource=true;b.divLegajos.swidget().refresh(e);b.txtFilter.keydown();b.divContainerTablaLegajos.show()};c.request()}else{new Core.Controls.Dialog("Aviso","<p>Debe ingresar un patrón de búsqueda de al menos 3 caracteres.</p>",{displayButtons:{close:true,accept:false}}).show()}};b.verLegajo=function(c,d){b.containerLegajosCuentas.hide();b.containerAltaCuenta.show();new Core.Controls.ManagerAltaCuenta({idAperturaCuenta:c,versionActual:d,optionsApertura:b.pageOptions,namespaceActivo:"Legajos",onSave:function(e,f){$("html, body").animate({scrollTop:$(".cuenta").offset().top},1000);b.loadGrid()},onClose:function(){$("html, body").animate({scrollTop:$(".cuenta").offset().top},1000);b.containerLegajosCuentas.show();b.containerAltaCuenta.hide()},container:b.containerAltaCuenta,idDefaultAccount:b.idDefaultAccount,idDefaultProfile:b.idDefaultProfile}).show()}};Core.Business.Letes=new function(){var a=this;a.id="cot_letes";a.optionsCotizaciones=null;a.divLetes=null;a.divChksMonedas=null;a.lblChkPesos=null;a.chkPesos=null;a.lblChkDolaresMep=null;a.chkDolaresMep=null;a.lblChkDolaresCable=null;a.chkDolaresCable=null;a.txtFilterLetes=null;a.timeoutLetes=null;a.divPlazo=null;a.ddlPlazo=null;a.maxToken=0;a.lastData=null;a.window=$(window);a.timerId=null;a.timerIdForceRefresh=null;a.loaded=false;a.refresh=false;a.forceRefresh=false;a.init=function(b,c){Core.loadPage("letes.html",function(){document.title="Letes";a.loaded=false;a.refresh=false;a.forceRefresh=false;a.optionsCotizaciones=Core.Functions.Context.Profiles.getPageOptionsByMenu("cotizaciones",Core.Objects.Context.Profiles[c]);a.maxToken=0;a.lastData=null;a.divLetes=$(".div-letes");a.txtFilterLetes=$(".textbox-letes-filter");a.divChksMonedas=$(".div-chks-monedas");a.divChksMonedas.hide();a.lblChkPesos=$(".lbl-checkbox-pesos");a.chkPesos=$(".checkbox-pesos");a.chkPesos[0].checked=false;a.lblChkDolaresMep=$(".lbl-checkbox-dolares-mep");a.chkDolaresMep=$(".checkbox-dolares-mep");a.chkDolaresMep[0].checked=true;a.lblChkDolaresCable=$(".lbl-checkbox-dolares-cable");a.chkDolaresCable=$(".checkbox-dolares-cable");a.chkDolaresCable[0].checked=false;a.divPlazo=$(".div-plazo");a.ddlPlazo=$(".dropdown-plazo");a.divPlazo.hide();Core.Functions.grid.Cotizaciones.initGrid(a.divLetes,true,true,false,Core.Objects.Context.Profiles[c].opciones.maxWatchlists,null,null,a.optionsCotizaciones.cot_profundidad,Core.Enums.ePanel.Letes,b,c);a.ddlPlazo.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",events:{select:function(d){a.setTab()}},width:150});a.chkPesos.on("change",function(){a.setTab()});a.chkDolaresMep.on("change",function(){a.setTab()});a.chkDolaresCable.on("change",function(){a.setTab()});Core.Functions.grid.Cotizaciones.initFilter(a.divLetes,a.txtFilterLetes,a.timeoutLetes,a.window);a.ddlInstrumentSearch=$(".dropdown-instrument-search");Core.Functions.grid.Cotizaciones.initInstrumentSearch(a.ddlInstrumentSearch,b,c);a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){Core.Functions.grid.Cotizaciones.loadInstrumentSearch(b,a.ddlInstrumentSearch,function(){a.setTab()})},"Core.Business.Letes")})};a.setTab=function(){Core.Functions.grid.Cotizaciones.details=[];a.maxToken=0;a.lastData=null;a.refresh=false;a.forceRefresh=false;if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:0,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(b){}}window.clearInterval(a.timerId);Core.Objects.Context.Timers.remove(a.timerId);window.clearInterval(a.timerIdForceRefresh);Core.Objects.Context.Timers.remove(a.timerIdForceRefresh);Core.Functions.grid.Cotizaciones.loadGrid(a.divLetes,null,"letes",a.lastData,a.maxToken,null,null,function(c,b){return(!a.loaded||(c.plazo==a.ddlPlazo.swidget().selectedItem().value&&a.filterMoneda(c.mo)))},function(e,f){a.lastData=e;a.maxToken=f;if(!a.loaded){var h=[];var g=[];a.lastData.forEach(function(j,i){if(h.indexOf(j.plazo)==-1){h.push(j.plazo)}if(g.indexOf(j.mo)==-1){g.push(j.mo)}});var b=[];h.forEach(function(j,i){b.push({value:j,text:j})});var c=a.ddlPlazo.swidget().initialOptions;c.dataSource.data=b;a.ddlPlazo.swidget().refresh(c);a.ddlPlazo.swidget().selected(0,true);if(h.length>1){a.divPlazo.show()}if(g.length>1){a.divChksMonedas.show();if(g.indexOf("Pesos")==-1){a.chkPesos.hide();a.lblChkPesos.hide()}if(g.indexOf("Dolar MEP")==-1){a.chkDolaresMep.hide();a.lblChkDolaresMep.hide()}if(g.indexOf("Dolar Cable")==-1){a.chkDolaresCable.hide();a.lblChkDolaresCable.hide()}}a.loaded=true;var d=a.divLetes.swidget().initialOptions;d.dataSource.data=$.grep(a.lastData,function(j,i){return(j.plazo==a.ddlPlazo.val()&&a.filterMoneda(j.mo))});a.divLetes.swidget().refresh(d)}},a.optionsCotizaciones.cot_profundidad);a.timerId=window.setInterval(function(){if(a.loaded&&(a.refresh||a.forceRefresh)){Core.Functions.grid.Cotizaciones.loadGrid(a.divLetes,null,"letes",a.lastData,a.maxToken,null,null,function(c,b){return(c.plazo==a.ddlPlazo.swidget().selectedItem().value&&a.filterMoneda(c.mo))},function(b,c){a.lastData=b;a.maxToken=c},a.optionsCotizaciones.cot_profundidad);a.forceRefresh=false}a.refresh=true},Core.Functions.grid.Cotizaciones.REFRESH_TIME);Core.Objects.Context.Timers.push(a.timerId);a.timerIdForceRefresh=window.setInterval(function(){a.forceRefresh=true},600000);Core.Objects.Context.Timers.push(a.timerIdForceRefresh);if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:Core.Enums.ePanel.Letes,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(c){if(a.loaded){var b={cotizaciones:[]};b.cotizaciones.push(JSON.parse(c.data));Core.Functions.grid.Cotizaciones.refreshGrid(b,a.divLetes,null,a.lastData,a.maxToken,null,null,function(e,d){return(e.plazo==a.ddlPlazo.swidget().selectedItem().value&&a.filterMoneda(e.mo))},function(d,e){a.lastData=d;a.maxToken=e;a.refresh=false},a.optionsCotizaciones.cot_profundidad)}}}};a.filterMoneda=function(b){return(b=="Pesos"&&(!a.divChksMonedas.is(":visible")||(a.chkPesos[0].checked)))||(b=="Dolar MEP"&&(!a.divChksMonedas.is(":visible")||(a.chkDolaresMep[0].checked)))||(b=="Dolar Cable"&&(!a.divChksMonedas.is(":visible")||(a.chkDolaresCable[0].checked)))}};Core.Business.Link=new function(){var me=this;me.id="link";me.init=function(idDefaultAccount,idDefaultProfile,initialParameters){if(initialParameters.data){var data=JSON.parse(atob(initialParameters.data));if(data&&data.data&&data.data.namespace){var namespace=data.data.namespace;delete data.data.namespace;eval(namespace+".init("+idDefaultAccount+","+idDefaultProfile+","+JSON.stringify(data.data)+");")}}}};Core.Business.LinkExterno=new function(){var a=this;a.id="linkExterno";a.init=function(b,c,d){if(d&&d.URL){window.open((d.URL+(d.requierelogin=="1"?("?token="+Core.Objects.Context.Token):"")),"_blank")}}};Core.Business.Login2=new function(){var me=this;var KEY_CODE_ENTER=13;me.showOpenAccount=true;me.showUserPassRecovery=true;me.showFirstEntry=true;me.txtUserName=null;me.txtPassword=null;me.divLoginAlert=null;me.btnUserPassRecovery=null;me.btnFirstEntry=null;me.divMain=null;me.divOpenAccount=null;me.init=function(){if(!Core.Functions.Validations.isBlockedStorage()&&Core.Functions.Persistence.getStorage()){var coreContext=LZString.decompressFromUTF16(Core.Functions.Persistence.getStorage().getItem("CoreContext"));if(coreContext){Core.Objects.Context=JSON.parse(coreContext);var coreAccounts=LZString.decompressFromUTF16(Core.Functions.Persistence.getStorage().getItem("CoreAccounts"));if(coreAccounts){Core.Objects.Accounts=JSON.parse(coreAccounts)}else{Core.Objects.Accounts=null}me.initWebSocket();var pathname=window.location.pathname.split("/")[1].replaceAll("/","");pathname=((Core.Functions.Context.whiteList.indexOf(pathname)<0)?"":pathname);if(Core.Objects.Context.Configuration&&Core.Objects.Context.Configuration.location&&Core.Objects.Context.Configuration.location.origin==window.location.origin&&Core.Functions.Context.getPathname().replaceAll("/","")==pathname){if(Core.Objects.Context.Configuration.idAplicacion==1){me.initChat()}var defaultIndexProfile=0;me.redirectToInitialPage(Core.Objects.Context.Profiles[defaultIndexProfile],Core.Objects.Context.Configuration.lastIdAccount,defaultIndexProfile);return}}}Core.loadPage("login.html",function(){document.title="Balanz Capital - Login";me.txtUserName=$(".login-username");me.txtPassword=$(".login-password");me.divLoginAlert=$(".login-alert");me.btnUserPassRecovery=$(".btn-user-recovery");me.divOpenAccount=$(".div-open-account");if(me.showOpenAccount){me.divOpenAccount.show()}else{me.divOpenAccount.hide()}if(me.showUserPassRecovery){me.btnUserPassRecovery.show()}else{me.btnUserPassRecovery.hide()}me.btnFirstEntry=$(".btn-first-entry");if(me.showFirstEntry){me.btnFirstEntry.show()}else{me.btnFirstEntry.hide()}me.divMain=$(".panel-info");new Core.Controls.CapslockWarning(me.txtPassword);me.txtUserName.focus();me.txtUserName.add(me.txtPassword).on("focus",function(){Core.Functions.Validations.toggleValidation($(this),false)}).on("keyup",function(e){if(e.keyCode==KEY_CODE_ENTER){me.authenticate()}});Core.Objects.Context={Token:"",User:"",TokenSecret:"",Asesor:null,IdSession:0,IdPersona:0,Nombre:"",LastLogin:"",FiscalIdentifier:"",DocumentType:"",DocumentNumber:"",Email:"",Phone:"",Mobile:"",Avatar:"",TieneC4D:0,Parameters:[],Profiles:[],Timers:[],Dialogs:[],Watchlists:[],Configuration:null,TestInversor:null,Notifications:[],Banners:[]};Core.Objects.Accounts=[]})};var keyIsNull=function(value){return typeof value=="object"&&"@nil" in value};me.initWebSocket=function(){Core.Objects.Context.WebSocket=new WebSocket(Core.Debug?"wss://devusers.balanz.com/websocket":(((window.location.protocol==="https:")?"wss://":"ws://")+window.location.host+"/websocket"));Core.Objects.Context.WebSocket.onclose=function(ev){if(Core.Objects.Context.WebSocket){setTimeout(function(){if(Core.Objects.Context.WebSocket){me.initWebSocket()}},((ev.code==1006)?1800000:20000))}}};me.saveContext=function(){if(Core.Functions.Validations.isBlockedStorage()||!Core.Functions.Persistence.getStorage()){return}Core.Functions.Persistence.getStorage().setItem("CoreContext",LZString.compressToUTF16(JSON.stringify(Core.Objects.Context)))};me.authenticate=function(){var user=me.txtUserName.val();var password=me.txtPassword.val();if(Core.Functions.Validations.isBlockedStorage()||!Core.Functions.Persistence.getStorage()){var modal=new Core.Controls.Dialog("Aviso","<p>Estimado Cliente,<br/>La aplicación no puede validar correctamente sus credenciales si Ud. ingresa con navegación privada; deshabilite esta opción e inténtelo nuevamente.<br/>Gracias</p>",{displayButtons:{close:true,accept:false}});modal.show();return}if(!user||!user.length){Core.Functions.Validations.toggleValidation(me.txtUserName,true);return}if(!password||!password.length){Core.Functions.Validations.toggleValidation(me.txtPassword,true);return}me.divLoginAlert.slideUp();var sr=new Core.Ajax.ServerRequest({overlayElement:me.divMain,secureRequest:false,requestUrl:"login",requestType:"POST",requestData:{data:{user:user,pass:password}}});sr.onSuccess=function(responseObject){if(keyIsNull(responseObject.idSesion)){me.divLoginAlert.text("Su usuario ó su clave no coinciden.");me.divLoginAlert.slideDown();Core.Functions.Validations.toggleValidation(me.txtPassword,true);return}Core.Objects.Context.Token=responseObject.AccessToken;Core.Objects.Context.User=user;Core.Objects.Context.Asesor=responseObject.Asesor;Core.Objects.Context.IdSession=responseObject.idSesion;Core.Objects.Context.IdPersona=responseObject.idPersona;Core.Objects.Context.Nombre=responseObject.Nombre;Core.Objects.Context.LastLogin=responseObject.UltimoLogin;Core.Objects.Context.FiscalIdentifier=responseObject.CUIL;Core.Objects.Context.DocumentType=responseObject.TipoDocumento;Core.Objects.Context.DocumentNumber=responseObject.Documento;Core.Objects.Context.Email=responseObject.email;Core.Objects.Context.Phone=responseObject.TelefonoFijo;Core.Objects.Context.Mobile=responseObject.TelefonoMovil;Core.Objects.Context.Avatar=responseObject.Avatar;Core.Objects.Context.TieneC4D=responseObject.tieneC4D;Core.Objects.Context.Parameters=responseObject.Parametros;Core.Objects.Context.Configuration=Core.Objects.Configuration;Core.Objects.Context.Configuration.idAplicacion=responseObject.idAplicacion;Core.Objects.Context.Configuration.idProductor=responseObject.idProductor;Core.Objects.Context.Configuration.location=window.location;Core.Objects.Context.Configuration.lastIdAccount=0;Core.Objects.Context.Profiles=Core.Functions.Context.Profiles.extendParametersByUserLevel(responseObject.Permisos);Core.Objects.Context.Timers=[];Core.Objects.Context.Watchlists=null;Core.Objects.Context.TestInversor=null;Core.Objects.Context.Notifications=[];Core.Objects.Context.Banners=[];Core.Objects.Context.CommonParameters=null;Core.Objects.Accounts=null;me.saveContext();var srCommonParameters=new Core.Ajax.ServerRequest({overlayElement:me.divMain,secureRequest:true,requestUrl:"comun/parametrosnegocio",requestType:"GET"});srCommonParameters.onSuccess=function(responseCommonParameters){Core.Objects.Context.CommonParameters=responseCommonParameters;if(responseCommonParameters.Monedas){for(var key in Core.Enums.Currency){var moneda=$.grep(responseCommonParameters.Monedas,function(obj,index){return obj.idMoneda==Core.Enums.Currency[key].idMoneda})[0];if(moneda){Core.Enums.Currency[key]=moneda}}}getBanners()};srCommonParameters.onError=function(e){Core.Objects.Context.CommonParameters=null;getBanners()};srCommonParameters.request();function getBanners(){var srBanners=new Core.Ajax.ServerRequest({overlayElement:me.divMain,secureRequest:true,requestUrl:"banners",requestType:"GET"});srBanners.onSuccess=function(responseBanners){Core.Objects.Context.Banners=responseBanners.banners;goon()};srBanners.onError=function(e){Core.Objects.Context.Banners=[];goon()};srBanners.request()}function goon(){if(Core.Objects.Context.Configuration.idAplicacion==1){dataLayer.push({event:"login",method:"email"});me.initChat();var srTestInversor=new Core.Ajax.ServerRequest({overlayElement:me.divMain,secureRequest:true,requestUrl:"testinversor",requestType:"GET"});srTestInversor.onSuccess=function(responseTest){Core.Objects.Context.TestInversor=responseTest;me.saveContext();me.redictToPage(responseObject)};srTestInversor.onError=function(e){Core.Objects.Context.TestInversor=null;me.saveContext();me.redictToPage(responseObject)};srTestInversor.request()}else{me.saveContext();me.redictToPage(responseObject)}}};sr.onError=function(e){if(e.status==401){me.divLoginAlert.text(e.responseJSON.Descripcion);me.divLoginAlert.slideDown();Core.Functions.Validations.toggleValidation(me.txtPassword,true)}else{var title=(e.responseJSON&&e.responseJSON.Descripcion)?"Mensaje":"Error de conexión";var description=(e.responseJSON&&e.responseJSON.Descripcion)?"<p>"+e.responseJSON.Descripcion+"</p>":"<p>En estos momentos el sistema no esta disponible. Por favor intente mas tarde...</p>";var modal=new Core.Controls.Dialog(title,description,{displayButtons:{close:true,accept:false}});modal.show()}};sr.request()};me.redictToPage=function(responseLogin){var defaultIndexProfile=0;if(responseLogin.Terminos){var divTerminosyCondiciones=$(".terminos-y-condiciones-modal");var chkAccept=divTerminosyCondiciones.find(".checkbox-accept");divTerminosyCondiciones.find(".terminos-y-condiciones-link").attr("href",responseLogin.Terminos.urlTyC);divTerminosyCondiciones.find(".btn-accept").unbind("click");divTerminosyCondiciones.find(".btn-accept").click(function(){if(chkAccept[0].checked){divTerminosyCondiciones.modal("hide");var sr=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"terminos/aceptartyc",requestType:"POST",requestData:{idPersona:responseLogin.idPersona,idTerminoYCondicion:responseLogin.Terminos.idTerminoYCondicion}});sr.onSuccess=function(responseTerminos){divTerminosyCondiciones.on("hidden.bs.modal",function(){me.initWebSocket();me.redirectToInitialPage(Core.Objects.Context.Profiles[defaultIndexProfile],0,defaultIndexProfile)})};sr.request()}});divTerminosyCondiciones.modal({show:true})}else{me.initWebSocket();me.redirectToInitialPage(Core.Objects.Context.Profiles[defaultIndexProfile],0,defaultIndexProfile)}};me.redirectToInitialPage=function(option,idDefaultAccount,defaultIndexProfile){var forward=null;var parameters=window.location.search.replace("?","").split("&");var json={};parameters.forEach(function(o,i){var parameterName=o.split("=")[0];var parameterValue=o.split("=")[1];if(parameterName!="forward"){json[parameterName]=decodeURIComponent(parameterValue)}else{forward=parameterValue}});var pageForward=((forward)?Core.Functions.Context.Profiles.searchPageByPath(forward,Core.Objects.Context.Profiles[defaultIndexProfile]):null);if(pageForward){eval(pageForward.namespace+".init("+idDefaultAccount+", "+defaultIndexProfile+", "+JSON.stringify(json)+");")}else{if(option.menu!=null&&option.menu.length>0){me.redirectToInitialPage(option.menu[0],idDefaultAccount,defaultIndexProfile)}else{eval(option.namespace+".init("+idDefaultAccount+", "+defaultIndexProfile+");")}}};me.initChat=function(){var balanzChat=$(".balanz-chat-widget-element");if(balanzChat.length==0&&Core.Objects.Context.Profiles[0]&&Core.Objects.Context.Profiles[0].opciones&&Core.Objects.Context.Profiles[0].opciones.mostrarChatWeb&&(window.location.hostname=="clientes.balanz.com"||window.location.hostname=="dev.balanz.com")){$('<script type="text/javascript" src="https://widgets.balanz.com/components/'+(window.location.hostname=="clientes.balanz.com"?"":"desa/")+'chat-clientes/latest/balanz-chat-widget-element.js"></script>').appendTo($("html"));balanzChat=$('<balanz-chat-widget-element class="balanz-chat-widget-element"></balanz-chat-widget-element>').appendTo($("html"));balanzChat.attr("token",Core.Objects.Context.Token);balanzChat.attr("person",Core.Objects.Context.IdPersona);balanzChat.attr("name",Core.Objects.Context.Nombre);balanzChat.attr("compacto",true);balanzChat.attr("showchatweb",true);balanzChat.attr("showchatwhatsapp",Core.Objects.Context.Profiles[0].opciones.mostrarChatWhatsapp?true:false)}}};Core.Business.Logout=new function(){var a=this;a.logout=function(){history.pushState({namespace:"Core.Business.Login"},"",(Core.Functions.Context.getPathname()).replaceAll("//","/"));var b=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"auth/logout",requestType:"POST"});b.onSuccess=function(c){if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.close()}a.clearSession();$(window).off("unload");$(window).off("beforeunload");window.location.reload(true)};b.onError=function(){if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.close()}a.clearSession();$(window).off("unload");$(window).off("beforeunload");window.location.reload(true)};b.request()};a.clearSession=function(){Core.Functions.Timers.clear();if(!Core.Functions.Validations.isBlockedStorage()&&Core.Functions.Persistence.getStorage()){Core.Functions.Persistence.getStorage().clear()}Core.Objects.Context={Token:"",TokenSecret:"",IdSession:0,IdPersona:0,Nombre:"",Accounts:[],Parameters:[],Profiles:[],Timers:[],Dialogs:[]}}};Core.Business.ACDILotes=new function(){var a=this;a.id="acdiLotes";a.divContainerLoteDetalles=null;a.lblLoteDetallesTitle=null;a.divLoteDetalles=null;a.divContainerLotes=null;a.divLotes=null;a.lblTitle=null;a.txtDateFrom=null;a.txtDateTo=null;a.btnRefresh=null;a.btnVolver=null;a.btnArchivoEmulador=null;a.btnArchivoLiquidaciones=null;a.btnArchivoFondos=null;a.btnBuscarIdExterno=null;a.txtFilter=null;a.pageOptions=null;a.timeout=null;a.init=function(b,c){Core.loadPage("lotes-acdi.html",function(){document.title="Lotes ACDI";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divContainerLoteDetalles=$(".div-container-lote-detalles");a.divContainerLoteDetalles.hide();a.lblLoteDetallesTitle=$(".lbl-title-lote-detalles");a.divLoteDetalles=$(".div-lote-detalles");a.divContainerLotes=$(".div-container-lotes");a.divContainerLotes.show();a.divLotes=$(".div-lotes");a.lblTitle=$(".label-title");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.txtFilter=$(".textbox-filter");a.btnRefresh=$(".btn-refresh");a.btnArchivoEmulador=$(".btn-archivo-emulador");a.btnArchivoLiquidaciones=$(".btn-archivo-liquidaciones");a.btnArchivoFondos=$(".btn-archivo-fondos");a.btnVolver=$(".btn-lote-detalles-volver");a.btnBuscarIdExterno=$(".btn-buscar-id-externo");a.initControls();a.initGrids();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.LotesACDI")})};a.initControls=function(){a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(b){a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(b){a.loadGrid()}}});a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var b=a.divLotes.swidget().dataSource;if(value){b.filter={or:[{path:"Ticker",filter:"contains",value:value},{path:"SocGerenta",filter:"contains",value:value},{path:"Estado",filter:"contains",value:value}]}}else{b.filter=null}b.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.LotesACDI.txtFilter");a.btnVolver.on("click",function(){a.divContainerLoteDetalles.hide();a.divContainerLotes.show()});a.btnRefresh.on("click",function(){a.loadGrid()});a.btnArchivoEmulador.on("click",function(){new Core.Business.ACDILotes.IngresarFecha({onSuccess:function(b){var c=new XMLHttpRequest();c.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"acdi/lotes/interfaz/emulador?Fecha="+b,true);c.responseType="blob";c.setRequestHeader("Authorization",Core.Objects.Context.Token);c.onload=function(d){if(c.status==200){a.showFile(c)}else{var e=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga del comprobante.</p>",{displayButtons:{close:true,accept:false}});e.show()}};c.send()}}).show()});a.btnArchivoLiquidaciones.on("click",function(){new Core.Business.ACDILotes.IngresarFecha({onSuccess:function(b){var c=new XMLHttpRequest();c.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"acdi/lotes/interfaz/vbolsa?Fecha="+b,true);c.responseType="blob";c.setRequestHeader("Authorization",Core.Objects.Context.Token);c.onload=function(d){if(c.status==200){a.showFile(c)}else{var e=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga del comprobante.</p>",{displayButtons:{close:true,accept:false}});e.show()}};c.send()}}).show()});a.btnArchivoFondos.on("click",function(){new Core.Business.ACDILotes.IngresarFecha({onSuccess:function(b){var c=new XMLHttpRequest();c.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"acdi/lotes/interfaz/vfondos?Fecha="+b,true);c.responseType="blob";c.setRequestHeader("Authorization",Core.Objects.Context.Token);c.onload=function(d){if(c.status==200){a.showFile(c)}else{var e=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga del comprobante.</p>",{displayButtons:{close:true,accept:false}});e.show()}};c.send()}}).show()});a.btnBuscarIdExterno.on("click",function(){var b={};b.FechaDesde=encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));b.FechaHasta=encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));var c=new Core.Ajax.ServerRequest({overlayElement:a.btnBuscarIdExterno,secureRequest:true,requestUrl:"acdi/lotes/balanz/numsolicitud",requestType:"PUT",requestData:b});c.onSuccess=function(d){a.loadGrid()};c.request()})};a.initGrids=function(){var b=[];b.push({field:"idLoteACDI",title:"ID Lote",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({field:"FechaCreacion",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"HoraCreacion",title:"Hora",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Estado",title:"Estado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"SocGerenta",title:"Soc Gerenta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"TipoOperacion",title:"Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Ticker",title:"Cuotaparte",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"ListaOrdenes",title:"Ordenes",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Monto",title:"Monto",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNuleablePrice});b.push({field:"Cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({field:"idExterno",title:"ID Externo",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({field:"CantidadOperada",title:"Cantidad Operada",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({field:"PrecioOperado",title:"Precio Operado",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNuleablePrice});b.push({field:"MontoOperado",title:"Monto Operado",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNuleablePrice});b.push({width:200,title:" ",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(i,j,k){var f=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(i);f.on("click",function(){var l=new Core.Ajax.ServerRequest({overlayElement:f,secureRequest:true,requestUrl:"acdi/lotes/detalle?idLote="+j.idLoteACDI,requestType:"GET"});l.onSuccess=function(m){a.lblLoteDetallesTitle.text("Detalles Lote: "+j.idLoteACDI);var n=a.divLoteDetalles.swidget().initialOptions;n.dataSource.data=m;n.dataSource.schema={data:"ordenes"};a.divLoteDetalles.swidget().refresh(n);a.divContainerLoteDetalles.show();a.divContainerLotes.hide()};l.request()});var h=$('<button type="button" title="Actualizar Id Externo" class="btn-sm balanz-button"><span class="glyphicon glyphicon-pencil"></span></button>').appendTo(i);h.on("click",function(){var l=new Core.Business.ACDILotes.ActualizarIdExterno({lote:j,onSuccess:function(){a.loaded=false;a.loadGrid()}}).show()});var d=$('<button type="button" title="Actualizar Liquidación" class="btn-sm balanz-button"><span class="glyphicon glyphicon-check"></span></button>').appendTo(i);d.on("click",function(){var l=new Core.Business.ACDILotes.ActualizarLiquidacion({lote:j,onSuccess:function(){a.loaded=false;a.loadGrid()}}).show()});var g=$('<button type="button" title="Eliminar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(i);g.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar el lote: "+j.idLoteACDI+"?",{onAccepted:function(){var l={coti_bloom:[{idLote:j.idLoteACDI,borrado:1}]};var m=new Core.Ajax.ServerRequest({overlayElement:g,secureRequest:true,requestUrl:"acdi/lotes",requestType:"PUT",requestData:l});m.onSuccess=function(){a.loadGrid()};m.request()}}).show()});if(j.botonArchivoSistaco){var e=$('<button type="button" title="Archivo Sistado" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>').appendTo(i);e.on("click",function(){var l=new XMLHttpRequest();l.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"acdi/lotes/interfaz/sistaco?idLote="+j.idLoteACDI,true);l.responseType="blob";l.setRequestHeader("Authorization",Core.Objects.Context.Token);l.onload=function(m){if(l.status==200){a.showFile(l)}else{var n=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga del comprobante.</p>",{displayButtons:{close:true,accept:false}});n.show()}};l.send()})}}});a.divLotes.shieldGrid({dataSource:{data:[]},paging:{pageSize:100,pageLinksCount:10},selection:false,rowHover:false,sorting:{multiple:true},columns:b});var c=[];c.push({field:"idOrden",title:"ID Orden",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});c.push({field:"Estado",title:"Estado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({field:"Fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({field:"Hora",title:"Hora",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({field:"TipoOperacion",title:"Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({field:"Comitente",title:"Comitente",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});c.push({field:"Ticker",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({field:"Moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({field:"Monto",title:"Monto",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatNuleablePrice});c.push({field:"Ingreso",title:"Ingreso",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({field:"CantidadOperada",title:"Cantidad Operada",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});c.push({field:"PrecioOperado",title:"Precio Operado",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatNuleablePrice});c.push({field:"MontoOperado",title:"Monto Operado",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatNuleablePrice});a.divLoteDetalles.shieldGrid({dataSource:{data:[]},paging:{pageSize:100,pageLinksCount:10},selection:false,rowHover:false,sorting:{multiple:true},columns:c})};a.loadGrid=function(){a.lblTitle.text("Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var b;b="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));b+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));var c=new Core.Ajax.ServerRequest({overlayElement:a.divLotes.parent(),secureRequest:true,requestUrl:"acdi/lotes",requestType:"GET",requestData:b});c.onSuccess=function(d){var e=a.divLotes.swidget().initialOptions;e.dataSource.data=d;e.dataSource.schema={data:"lotes"};a.divLotes.swidget().refresh(e);a.txtFilter.keydown()};c.request()};a.showFile=function(h){var g=new Blob([h.response],{type:h.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(g);return}var b=window.URL.createObjectURL(g);var f=document.createElement("a");f.href=b;var d=h.getResponseHeader("Content-Disposition").split("; ");var c="filename=file.DAT";for(var e=0;e<d.length;e++){if(d[e].indexOf("filename")>=0){c=d[e]}}f.download=c.split("=")[1];f.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(b)}};Core.Business.ACDILotes.ActualizarIdExterno=function(b){var a=this;a.divModal=$(".div-acdi-lotes-actualizar-id-externo");a.lblTitle=null;a.txtIdExterno=null;a.lote=null;a.onSuccess=function(){};$.extend(true,a,b);a.show=function(){a.lblTitle=a.divModal.find(".title");a.lblTitle.text("Actualizar Id Externo - Lote: "+a.lote.idLoteACDI);a.txtIdExterno=a.divModal.find(".textbox-id-externo");new Core.Controls.DecimalPicker(a.txtIdExterno,{maxDecimalDigitCount:0,showThousandsSeparator:"",defaultValue:(a.lote.idExterno)?a.lote.idExterno:""});Core.Functions.Validations.toggleValidation(a.txtIdExterno,false);a.divModal.find(".btn-confirmar-id-externo").unbind("click");a.divModal.find(".btn-confirmar-id-externo").click(function(){Core.Functions.Validations.toggleValidation(a.txtIdExterno,false);var c=0;if(a.txtIdExterno.val()&&a.txtIdExterno.val()>0){c=Core.Functions.Decimal.parseFloat(a.txtIdExterno.val())}var d=new Core.Ajax.ServerRequest({overlayElement:a.divModal.find(".btn-confirmar-id-externo"),showOverlay:true,secureRequest:true,requestUrl:"acdi/lotes",requestType:"PUT",requestData:{data:{idLote:a.lote.idLoteACDI,idExterno:c}}});d.onSuccess=function(e){a.onSuccess();a.divModal.modal("hide")};d.request()});a.divModal.on("shown.bs.modal",function(){a.txtIdExterno.focus()});a.divModal.modal({show:true})}};Core.Business.ACDILotes.ActualizarLiquidacion=function(b){var a=this;a.divModal=$(".div-acdi-lotes-actualizar-liquidacion");a.lblTitle=null;a.txtMonto=null;a.txtCantidad=null;a.lote=null;a.onSuccess=function(){};$.extend(true,a,b);a.show=function(){a.lblTitle=a.divModal.find(".title");a.lblTitle.text("Actualizar Liquidación - Lote: "+a.lote.idLoteACDI);a.txtMonto=a.divModal.find(".textbox-monto");new Core.Controls.DecimalPicker(a.txtMonto,{maxDecimalDigitCount:2,showThousandsSeparator:true,defaultValue:(a.lote.Monto)?a.lote.Monto:""});Core.Functions.Validations.toggleValidation(a.txtMonto,false);a.txtCantidad=a.divModal.find(".textbox-cantidad");new Core.Controls.DecimalPicker(a.txtCantidad,{maxDecimalDigitCount:0,showThousandsSeparator:"",defaultValue:(a.lote.Cantidad)?a.lote.Cantidad:""});Core.Functions.Validations.toggleValidation(a.txtCantidad,false);a.divModal.find(".btn-confirmar-liquidacion").unbind("click");a.divModal.find(".btn-confirmar-liquidacion").click(function(){Core.Functions.Validations.toggleValidation(a.txtMonto,false);Core.Functions.Validations.toggleValidation(a.txtCantidad,false);if(!a.txtMonto.val()||a.txtMonto.val()<=0){Core.Functions.Validations.toggleValidation(a.txtMonto,true);return}if(!a.txtCantidad.val()||a.txtCantidad.val()<=0){Core.Functions.Validations.toggleValidation(a.txtCantidad,true);return}var c=new Core.Ajax.ServerRequest({overlayElement:a.divModal.find(".btn-confirmar-liquidacion"),showOverlay:true,secureRequest:true,requestUrl:"acdi/lotes",requestType:"PUT",requestData:{data:{idLote:a.lote.idLoteACDI,cantidad:Core.Functions.Decimal.parseFloat(a.txtCantidad.val()),monto:Core.Functions.Decimal.parseFloat(a.txtMonto.val())}}});c.onSuccess=function(d){a.onSuccess();a.divModal.modal("hide")};c.request()});a.divModal.on("shown.bs.modal",function(){a.txtIdExterno.focus()});a.divModal.modal({show:true})}};Core.Business.ACDILotes.IngresarFecha=function(b){var a=this;a.divModal=$(".div-acdi-lotes-ingresar-fecha");a.txtDate=null;a.onSuccess=function(){};$.extend(true,a,b);a.show=function(){a.txtDate=a.divModal.find(".textbox-date");a.txtDate.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date()});Core.Functions.Validations.toggleValidation(a.txtDate,false);a.divModal.find(".btn-confirmar-fecha").unbind("click");a.divModal.find(".btn-confirmar-fecha").click(function(){Core.Functions.Validations.toggleValidation(a.txtDate,false);var d={value:true};var c=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtDate,d));if(d.value){a.onSuccess(c);a.divModal.modal("hide")}else{Core.Functions.Validations.toggleValidation(a.txtDate,true);return}});a.divModal.on("shown.bs.modal",function(){a.txtDate.focus()});a.divModal.modal({show:true});a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()})};a.destroy=function(){a.txtDate.swidget().destroy()}};Core.Business.MAE=new function(){var a=this;a.id="cot_mae";a.optionsCotizaciones=null;a.divMae=null;a.txtFilter=null;a.divChksMonedas=null;a.lblChkPesos=null;a.chkPesos=null;a.lblChkDolaresMep=null;a.chkDolaresMep=null;a.lblChkDolaresCable=null;a.chkDolaresCable=null;a.divPlazo=null;a.ddlPlazo=null;a.timeout=null;a.maxToken=0;a.lastData=null;a.timerId=null;a.timerIdForceRefresh=null;a.loaded=false;a.refresh=false;a.forceRefresh=false;a.window=$(window);a.init=function(b,c){Core.loadPage("mae.html",function(){document.title="MAE";a.loaded=false;a.refresh=false;a.forceRefresh=false;a.optionsCotizaciones=Core.Functions.Context.Profiles.getPageOptionsByMenu("cotizaciones",Core.Objects.Context.Profiles[c]);a.maxToken=0;a.lastData=null;a.divMae=$(".div-mae");a.txtFilter=$(".textbox-mae-filter");a.divChksMonedas=$(".div-chks-monedas");a.divChksMonedas.hide();a.lblChkPesos=$(".lbl-checkbox-pesos");a.chkPesos=$(".checkbox-pesos");a.chkPesos[0].checked=true;a.lblChkDolaresMep=$(".lbl-checkbox-dolares-mep");a.chkDolaresMep=$(".checkbox-dolares-mep");a.chkDolaresMep[0].checked=true;a.lblChkDolaresCable=$(".lbl-checkbox-dolares-cable");a.chkDolaresCable=$(".checkbox-dolares-cable");a.chkDolaresCable[0].checked=true;a.divPlazo=$(".div-plazo");a.ddlPlazo=$(".dropdown-plazo");a.divPlazo.hide();Core.Functions.grid.Cotizaciones.initGrid(a.divMae,true,true,false,Core.Objects.Context.Profiles[c].opciones.maxWatchlists,null,null,a.optionsCotizaciones.cot_profundidad,Core.Enums.ePanel.MAE,b,c);a.ddlPlazo.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",events:{select:function(d){a.setTab()}},width:150});a.chkPesos.on("change",function(){a.setTab()});a.chkDolaresMep.on("change",function(){a.setTab()});a.chkDolaresCable.on("change",function(){a.setTab()});Core.Functions.grid.Cotizaciones.initFilter(a.divMae,a.txtFilter,a.timeout,a.window);a.ddlInstrumentSearch=$(".dropdown-instrument-search");Core.Functions.grid.Cotizaciones.initInstrumentSearch(a.ddlInstrumentSearch,b,c);a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){Core.Functions.grid.Cotizaciones.loadInstrumentSearch(b,a.ddlInstrumentSearch,function(){a.setTab()})},"Core.Business.MAE")})};a.setTab=function(){Core.Functions.grid.Cotizaciones.details=[];a.maxToken=0;a.lastData=null;a.refresh=false;a.forceRefresh=false;if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:0,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(b){}}window.clearInterval(a.timerId);Core.Objects.Context.Timers.remove(a.timerId);window.clearInterval(a.timerIdForceRefresh);Core.Objects.Context.Timers.remove(a.timerIdForceRefresh);Core.Functions.grid.Cotizaciones.loadGrid(a.divMae,null,"panel/36",a.lastData,a.maxToken,null,null,function(c,b){return(!a.loaded||(c.plazo==a.ddlPlazo.swidget().selectedItem().value&&a.filterMoneda(c.mo)))},function(e,f){a.lastData=e;a.maxToken=f;if(!a.loaded){var h=[];var g=[];a.lastData.forEach(function(j,i){if(h.indexOf(j.plazo)==-1){h.push(j.plazo)}if(g.indexOf(j.mo)==-1){g.push(j.mo)}});var b=[];h.forEach(function(j,i){b.push({value:j,text:j})});var c=a.ddlPlazo.swidget().initialOptions;c.dataSource.data=b;a.ddlPlazo.swidget().refresh(c);a.ddlPlazo.swidget().selected(0,true);if(h.length>1){a.divPlazo.show()}if(g.length>1){a.divChksMonedas.show();if(g.indexOf("Pesos")==-1){a.chkPesos.hide();a.lblChkPesos.hide()}if(g.indexOf("Dolar MEP")==-1){a.chkDolaresMep.hide();a.lblChkDolaresMep.hide()}if(g.indexOf("Dolar Cable")==-1){a.chkDolaresCable.hide();a.lblChkDolaresCable.hide()}}a.loaded=true;var d=a.divMae.swidget().initialOptions;d.dataSource.data=$.grep(a.lastData,function(j,i){return(j.plazo==a.ddlPlazo.val()&&a.filterMoneda(j.mo))});a.divMae.swidget().refresh(d)}},a.optionsCotizaciones.cot_profundidad);a.timerId=window.setInterval(function(){if(a.loaded&&(a.refresh||a.forceRefresh)){Core.Functions.grid.Cotizaciones.loadGrid(a.divMae,null,"panel/36",a.lastData,a.maxToken,null,null,function(c,b){return(c.plazo==a.ddlPlazo.swidget().selectedItem().value&&a.filterMoneda(c.mo))},function(b,c){a.lastData=b;a.maxToken=c},a.optionsCotizaciones.cot_profundidad);a.forceRefresh=false}a.refresh=true},Core.Functions.grid.Cotizaciones.REFRESH_TIME);Core.Objects.Context.Timers.push(a.timerId);a.timerIdForceRefresh=window.setInterval(function(){a.forceRefresh=true},600000);Core.Objects.Context.Timers.push(a.timerIdForceRefresh);if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:Core.Enums.ePanel.MAE,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(c){if(a.loaded){var b={cotizaciones:[]};b.cotizaciones.push(JSON.parse(c.data));Core.Functions.grid.Cotizaciones.refreshGrid(b,a.divMae,null,a.lastData,a.maxToken,null,null,function(e,d){return(e.plazo==a.ddlPlazo.swidget().selectedItem().value&&a.filterMoneda(e.mo))},function(d,e){a.lastData=d;a.maxToken=e;a.refresh=false},a.optionsCotizaciones.cot_profundidad)}}}};a.filterMoneda=function(b){return(b=="Pesos"&&(!a.divChksMonedas.is(":visible")||(a.chkPesos[0].checked)))||(b=="Dolar MEP"&&(!a.divChksMonedas.is(":visible")||(a.chkDolaresMep[0].checked)))||(b=="Dolar Cable"&&(!a.divChksMonedas.is(":visible")||(a.chkDolaresCable[0].checked)))}};Core.Business.MatrizDeRiesgo=new function(){var b=this;var a=13;b.id="matrizDeRiesgo";b.idDefaultAccount=null;b.idDefaultProfile=null;b.divContainerMatrizRiesgo=null;b.txtIdentificacionFiscal=null;b.btnConsultar=null;b.dataParametrosUsuario=null;b.managerMatrizRiesgo=null;b.init=function(c,d){Core.loadPage("matriz-de-riesgo.html",function(){document.title="Matriz de Riesgo";b.idDefaultAccount=c;b.idDefaultProfile=d;b.divContainerMatrizRiesgo=$(".div-container-matriz-riesgo");b.txtIdentificacionFiscal=$(".textbox-identificacion-fiscal");b.btnConsultar=$(".btn-consultar");b.initControls();b.managerMatrizRiesgo=null;b.header=new Core.Controls.Header($("#topNav"),{});b.header.init(false,c,d,function(){var e=new Core.Ajax.ServerRequest({allowCache:true,secureRequest:true,requestUrl:"apertura/cuenta/parametrosusuario",requestType:"GET"});e.onSuccess=function(f){b.dataParametrosUsuario=f};e.request()},"Core.Business.MatrizDeRiesgo")})};b.initControls=function(){b.divContainerMatrizRiesgo.hide();b.txtIdentificacionFiscal.shieldTextBox({value:""});b.txtIdentificacionFiscal.unbind("keyup");b.txtIdentificacionFiscal.on("keyup",function(c){if(c.keyCode==a){b.btnConsultar.click()}});b.btnConsultar.on("click",function(){if(b.managerMatrizRiesgo){b.managerMatrizRiesgo.destroy();b.managerMatrizRiesgo=null}b.divContainerMatrizRiesgo.hide();if(!b.txtIdentificacionFiscal.val()||!b.isNumeric(b.txtIdentificacionFiscal.val())||!Core.Functions.Validations.isCuit(b.txtIdentificacionFiscal.val())){new Core.Controls.Dialog("Aviso","Debe ingresar un Cuil o Cuit válido.",{displayButtons:{close:true,accept:false}}).show();return}else{b.divContainerMatrizRiesgo.show();b.managerMatrizRiesgo=new Core.Controls.ManagerMatrizRiesgo({container:b.divContainerMatrizRiesgo,showTitle:false,dataParametrosUsuario:b.dataParametrosUsuario,calcularMatriz:false,origenApertura:false,consultarMatriz:true,cuilCuit:b.txtIdentificacionFiscal.val(),onSave:function(d,c){b.managerMatrizRiesgo=null},onClose:function(){b.divContainerMatrizRiesgo.hide()}});b.managerMatrizRiesgo.show()}})};b.isNumeric=function(c){var d=/^[0-9]+$/;if(c&&!d.test(c)){return false}return true}};Core.Business.MatrizManual=new function(){var a=this;a.id="matrizManual";a.idDefaultAccount=null;a.idDefaultProfile=null;a.divContainerMatrizRiesgo=null;a.init=function(b,c){Core.loadPage("matriz-de-riesgo-manual.html",function(){document.title="Matriz de Riesgo Manual";a.idDefaultAccount=b;a.idDefaultProfile=c;a.divContainerMatrizRiesgo=$(".div-container-matriz-riesgo");a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){var d=new Core.Ajax.ServerRequest({allowCache:true,secureRequest:true,requestUrl:"apertura/cuenta/parametrosusuario",requestType:"GET"});d.onSuccess=function(e){var f=new Core.Ajax.ServerRequest({allowCache:true,secureRequest:true,requestUrl:"apertura/cuenta/parametros",requestType:"GET"});f.onSuccess=function(g){new Core.Controls.ManagerMatrizRiesgo({container:a.divContainerMatrizRiesgo,showTitle:false,dataParametrosUsuario:e,dataParametros:g,calcularMatriz:false,origenApertura:false,consultarMatriz:false,calcularMatrizManual:true}).show()};f.request()};d.request()},"Core.Business.MatrizManual")})}};Core.Business.Mensajeria=new function(){var a=this;a.id="homeMensajeria";a.divMain=null;a.init=function(b,c){Core.loadPage("mensajeria.html",function(){document.title="Mensajería";$(".footer").hide();a.divMain=$(".div-main");a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){var d=$('<balanz-chat-app id="chat-asesor"></balanz-chat-app>').appendTo(a.divMain);d.attr("token",Core.Objects.Context.Token);d.attr("person",Core.Objects.Context.IdPersona);d.attr("name",Core.Objects.Context.Asesor?Core.Objects.Context.Asesor.Nombre:"")},"Core.Business.Mensajeria")})}};Core.Business.AlgoDolar=new function(){var a=this;var b=60000;a.eSideSintetico={Compra:1,Venta:2};a.id="algoDolar";a.idDefaultAccount=null;a.idDefaultProfile=null;a.btnRefresh=null;a.btnDetalles=null;a.chkHabilitado=null;a.divContainerEstrategia=null;a.estrategiaControls=[];a.divTotales=null;a.originalData=null;a.timerId=null;a.pageOptions=null;a.loaded=false;a.executeTimer=true;a.window=$(window);a.init=function(c,d){Core.loadPage("mesa-algo-dolar.html",function(){document.title="Algo Dólar";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[d]);a.idDefaultAccount=c;a.idDefaultProfile=d;a.btnRefresh=$(".btn-refresh");a.btnDetalles=$(".btn-detalles");a.chkHabilitado=$(".chk-habilitado");a.divTotales=$(".grid-totales");a.divContainerEstrategia=$(".div-container-estrategias");a.divContainerEstrategia.html("");a.initControls();a.estrategiaControls=[];a.executeTimer=true;a.loaded=false;a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,c,d,function(){a.loadControls()},"Core.Business.AlgoDolar");a.timerId=window.setInterval(function(){if(a.executeTimer){a.loadControls()}},(a.pageOptions&&a.pageOptions.algoDolarRefresco?a.pageOptions.algoDolarRefresco:b));Core.Objects.Context.Timers.push(a.timerId)})};a.initControls=function(){a.btnRefresh.on("click",function(){a.loaded=false;a.loadControls()});a.btnDetalles.on("click",function(){if(a.originalData&&a.originalData.parametrosAlgo&&a.originalData.parametrosAlgo[0]){var e="";e+="<table class='table table-striped'>";e+="<thead><tr><th>Nombre</th><th>Valor</th></tr></thead>";e+="<tbody>";$.each(a.originalData.parametrosAlgo[0],function(f,g){if(!Array.isArray(g)){e+="<tr>";e+="<td>"+f+"</td>";e+="<td>"+g+"</td>";e+="</tr>"}});e+="</tbody>";e+="</table>";var d=new Core.Controls.Dialog("Detalles",e,{displayButtons:{close:true,accept:false}});d.show()}});a.chkHabilitado.shieldSwitch({checked:true,enabled:a.pageOptions&&a.pageOptions.algoDolarEdit==1?true:false,events:{click:function(d){var f=(a.originalData&&a.originalData.configuracion&&a.originalData.configuracion[0])?a.originalData.configuracion[0]:{};f.EjecutarOrdenes=a.chkHabilitado.swidget().checked()?1:0;var g=new Core.Ajax.ServerRequest({secureRequest:true,showOverlay:true,requestUrl:"algoritmo/configuracion",requestType:"POST",requestData:f});g.onSuccess=function(e){a.loaded=false;a.loadControls()};g.request()}}});var c=[];c.push({field:"Especie",title:"Especie",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass()});c.push({field:"FechaLiquidacion",title:"Fecha Liquidación",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass()});c.push({field:"Cociente",title:"Cociente",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),attributes:Core.Functions.grid.getRightAlignedColumnClass()});c.push({field:"Cantidad",title:"Cantidad",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),attributes:Core.Functions.grid.getRightAlignedColumnClass()});c.push({field:"Importe",title:"Importe",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),attributes:Core.Functions.grid.getRightAlignedColumnClass()});c.push({field:"Operador",title:"Operador",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass()});c.push({field:"TipoOperacion",title:"Tipo Operación",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass()});a.divTotales.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:c,paging:{pageSize:100,pageLinksCount:10}})};a.loadControls=function(){var c=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"algoritmo/datos",requestType:"GET"});c.onSuccess=function(d){a.originalData=d;a.chkHabilitado.swidget().checked(((a.originalData&&a.originalData.configuracion&&a.originalData.configuracion[0]&&a.originalData.configuracion[0].EjecutarOrdenes)?true:false));var e=[];a.originalData.estrategias.forEach(function(h,g){if(e.indexOf(h.Descripcion)<0){e.push(h.Descripcion)}});e.forEach(function(y,z){if(!$.grep(a.estrategiaControls,function(G,H){return G.estrategia==y})[0]){var r=$("<div class='col-md-6 col-sm-12 col-xs-12' />").appendTo(a.divContainerEstrategia);var m=$('<div class="box-total-full-width gris" style="height:115px;" />').appendTo(r);m.hide();$('<p class="total">Comprar '+y+"</p > ").appendTo(m);var n=$('<div class="col-lg-4 col-md-4 col-sm-12 col-xs-12" />').appendTo(m);var k=$('<input type="checkbox" />').appendTo(n);var h=$('<button type="button" title="Editar" class="btn-sm balanz-button" style="margin-left: 10px;"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(n);var g=$('<button type="button" title="Detalles" class="btn-sm balanz-button" style="margin-left: 10px;"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(n);if(!(a.pageOptions&&a.pageOptions.algoDolarEdit==1)){h.hide()}var p=$('<div class="col-lg-4 col-md-4 col-sm-12 col-xs-12" style="margin-top:4px;" />').appendTo(m);var A=$('<label style="color: black; font-size: 20px;"></label>').appendTo(p);var q=$('<div class="col-lg-4 col-md-4 col-sm-12 col-xs-12" />').appendTo(m);var B=$('<label style="color: black; font-size: 24px;"></label>').appendTo(q);var C=$('<label style="color: black; margin-left:8px;"></label>').appendTo(q);var o=$('<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="margin-top:8px;"/>').appendTo(m);k.shieldSwitch({enabled:a.pageOptions&&a.pageOptions.algoDolarEdit==1?true:false,events:{click:function(G){a.habilitar(y,a.eSideSintetico.Compra,k.swidget().checked())}}});h.on("click",function(){a.editar(y,a.eSideSintetico.Compra)});g.on("click",function(){a.detallesEstrategia(y,a.eSideSintetico.Compra)});a.estrategiaControls.push({estrategia:y,sideSintetico:a.eSideSintetico.Compra,div:m,lblCantidad:A,lblPrecio:B,lblUltimoPrecio:C,chkHabilitado:k,btnEditar:h,btnDetalles:g,divAlert:o});var s=$("<div class='col-md-6 col-sm-12 col-xs-12' />").appendTo(a.divContainerEstrategia);var t=$('<div class="box-total-full-width gris" style="height:115px;" />').appendTo(s);t.hide();$('<p class="total">Vender '+y+"</p > ").appendTo(t);var x=$('<div class="col-lg-4 col-md-4 col-sm-12 col-xs-12" />').appendTo(t);var F=$('<label style="color: black; margin-right:8px;"></label>').appendTo(x);var E=$('<label style="color: black; font-size: 24px;"></label>').appendTo(x);var w=$('<div class="col-lg-4 col-md-4 col-sm-12 col-xs-12" style="margin-top:4px;" />').appendTo(t);var D=$('<label style="color: black; font-size: 20px;"></label>').appendTo(w);var u=$('<div class="col-lg-4 col-md-4 col-sm-12 col-xs-12" />').appendTo(t);var i=$('<button type="button" title="Detalles" class="btn-sm balanz-button" style="margin-right: 10px;"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(u);var j=$('<button type="button" title="Editar" class="btn-sm balanz-button" style="margin-right: 10px;"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(u);if(!(a.pageOptions&&a.pageOptions.algoDolarEdit==1)){j.hide()}var l=$('<input type="checkbox" />').appendTo(u);var v=$('<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="margin-top:8px;"/>').appendTo(t);l.shieldSwitch({enabled:a.pageOptions&&a.pageOptions.algoDolarEdit==1?true:false,events:{click:function(G){a.habilitar(y,a.eSideSintetico.Venta,l.swidget().checked())}}});j.on("click",function(){a.editar(y,a.eSideSintetico.Venta)});i.on("click",function(){a.detallesEstrategia(y,a.eSideSintetico.Venta)});a.estrategiaControls.push({estrategia:y,sideSintetico:a.eSideSintetico.Venta,div:t,lblCantidad:D,lblPrecio:E,lblUltimoPrecio:F,chkHabilitado:l,btnEditar:j,btnDetalles:i,divAlert:v})}});a.estrategiaControls.forEach(function(h,g){h.div.hide()});a.originalData.estrategias.forEach(function(i,h){var g=$.grep(a.estrategiaControls,function(m,n){return m.estrategia==i.Descripcion&&m.sideSintetico==i.sideSintetico})[0];if(g){var j=null;if(a.originalData&&a.originalData.parametrosAlgo&&a.originalData.parametrosAlgo[0]&&a.originalData.parametrosAlgo[0].sinteticos){j=$.grep(a.originalData.parametrosAlgo[0].sinteticos,function(n,m){return n.idEstrategia==i.idEstrategia})[0]}if(i.cantidadOperar){var k=(" (%"+(((j&&j.accOperadoSintetico)?j.accOperadoSintetico:0)*100/i.cantidadOperar).toFixed(2)+") ");g.lblCantidad.text(Core.Functions.grid.formatIntegerNumber(i.cantidadOperar)+k)}else{g.lblCantidad.text("")}g.lblPrecio.text(i.priceOperar?("$ "+Core.Functions.grid.formatPrice(i.priceOperar)):"");var l=(j&&j.ultimoPrecioPunta)?parseFloat(j.ultimoPrecioPunta.toFixed(j.ultimoPrecioPunta<10?4:2)):0;g.lblUltimoPrecio.text(l?("("+l+")"):"");g.divAlert.html("");if(j&&j.cantidadOperacionesRealizadas>=j.maximoOperacionesRealizadas){g.divAlert.html("Verificar maximoOperacionesRealizadas")}g.chkHabilitado.swidget().checked(i.executeSintetico?true:false);g.div.css("background-color",((a.chkHabilitado.swidget().checked()&&g.chkHabilitado.swidget().checked())?"":"lightgrey"));g.div.css("opacity",((a.chkHabilitado.swidget().checked()&&g.chkHabilitado.swidget().checked())?"1":"0.6"));g.div.show()}});var f=a.divTotales.swidget().initialOptions;f.dataSource.data=(a.originalData&&a.originalData.totales)?a.originalData.totales:[];a.divTotales.swidget().refresh(f);a.loaded=true};c.onError=function(f){a.executeTimer=false;var h=(f.responseJSON&&f.responseJSON.Descripcion)?"Mensaje":"Error de conexión";var d=(f.responseJSON&&f.responseJSON.Descripcion)?f.responseJSON.Descripcion:"Algunos componentes de la página no se cargaron correctamente. Por favor intente mas tarde...";var g=new Core.Controls.Dialog(h,"<p>"+d+"</p>",{displayButtons:{close:true,accept:false},onClosed:function(){a.executeTimer=true;g.destroy()}});g.show()};c.request()};a.habilitar=function(c,f,d){var e=$.grep(a.originalData.estrategias,function(i,h){return i.Descripcion==c&&i.sideSintetico==f})[0];if(e){e.executeSintetico=d?1:0;e.reiniciarContador=0;var g=new Core.Ajax.ServerRequest({secureRequest:true,showOverlay:true,requestUrl:"algoritmo/estrategia/modificar",requestType:"POST",requestData:e});g.onSuccess=function(h){a.loaded=false;a.loadControls()};g.request()}};a.editar=function(c,e){var d=$.grep(a.originalData.estrategias,function(g,f){return g.Descripcion==c&&g.sideSintetico==e})[0];if(d){new Core.Business.AlgoDolar.ActualizarParametros({onSave:function(){a.loaded=false;a.loadControls()},requestData:d}).show()}};a.detallesEstrategia=function(d,f){var d=$.grep(a.originalData.estrategias,function(i,h){return i.Descripcion==d&&i.sideSintetico==f})[0];if(d&&a.originalData&&a.originalData.parametrosAlgo&&a.originalData.parametrosAlgo[0]&&a.originalData.parametrosAlgo[0].sinteticos){var e=$.grep(a.originalData.parametrosAlgo[0].sinteticos,function(i,h){return i.idEstrategia==d.idEstrategia})[0];if(e){var g="";g+="<table class='table table-striped'>";g+="<thead><tr><th>Nombre</th><th>Valor</th></tr></thead>";g+="<tbody>";$.each(e,function(h,i){if(!Array.isArray(i)){g+="<tr>";g+="<td>"+h+"</td>";g+="<td>"+i+"</td>";g+="</tr>"}});g+="</tbody>";g+="</table>";var c=new Core.Controls.Dialog("Detalles",g,{displayButtons:{close:true,accept:false}});c.show()}}}};Core.Business.AlgoDolar.ActualizarParametros=function(b){var a=this;a.divModal=$(".div-modal-actualizar-parametros");a.onSave=null;a.requestData=null;$.extend(true,a,b);a.eSideSintetico={Compra:1,Venta:2};a.divAlert=null;a.divCampoAdicional=null;a.divVerMas=null;a.btnVerMas=null;a.txtCantidad=null;a.txtPrecio=null;a.chkReiniciarContador=null;a.txtIdTipoEstrategia=null;a.txtDescripcion=null;a.txtPriority=null;a.ddlSideSintetico=null;a.txtInstrumentoCompra=null;a.txtInstrumentoVenta=null;a.txtOrderQty=null;a.txtMaximoOperacionesRealizadas=null;a.txtLimiteOperadoMaximo=null;a.txtCuentaCC=null;a.txtPorcentajeVariacionPrecio=null;a.btnConfirmar=null;a.show=function(){a.divAlert=$(".div-alert-actualizar-parametros");a.divAlert.slideUp();a.txtCantidad=a.divModal.find(".textbox-cantidad");new Core.Controls.DecimalPicker(a.txtCantidad,{maxDecimalDigitCount:0,showThousandsSeparator:"",defaultValue:(a.requestData&&a.requestData.cantidadOperar)?a.requestData.cantidadOperar:""});Core.Functions.Validations.toggleValidation(a.txtCantidad,false);a.txtPrecio=a.divModal.find(".textbox-precio");new Core.Controls.DecimalPicker(a.txtPrecio,{maxDecimalDigitCount:5,showThousandsSeparator:"",defaultValue:(a.requestData&&a.requestData.priceOperar)?a.requestData.priceOperar:""});Core.Functions.Validations.toggleValidation(a.txtPrecio,false);a.chkReiniciarContador=a.divModal.find(".checkbox-reiniciar-contador");a.chkReiniciarContador.shieldCheckBox({label:"Reiniciar contador"});a.chkReiniciarContador.swidget().checked((a.requestData&&a.requestData.reiniciarContador?true:false));a.txtIdTipoEstrategia=a.divModal.find(".textbox-id-tipo-estrategia");new Core.Controls.DecimalPicker(a.txtIdTipoEstrategia,{maxDecimalDigitCount:0,showThousandsSeparator:"",defaultValue:(a.requestData&&a.requestData.idTipoEstrategia)?a.requestData.idTipoEstrategia:""});Core.Functions.Validations.toggleValidation(a.txtIdTipoEstrategia,false);a.txtDescripcion=a.divModal.find(".textbox-descripcion");a.txtDescripcion.val((a.requestData&&a.requestData.Descripcion)?a.requestData.Descripcion:"");Core.Functions.Validations.toggleValidation(a.txtDescripcion,false);a.txtPriority=a.divModal.find(".textbox-prioridad");new Core.Controls.DecimalPicker(a.txtPriority,{maxDecimalDigitCount:0,showThousandsSeparator:"",defaultValue:(a.requestData&&a.requestData.priority)?a.requestData.priority:""});Core.Functions.Validations.toggleValidation(a.txtPriority,false);a.txtInstrumentoCompra=a.divModal.find(".textbox-instrumento-compra");a.txtInstrumentoCompra.val((a.requestData&&a.requestData.instrumentoCompra)?a.requestData.instrumentoCompra:"");Core.Functions.Validations.toggleValidation(a.txtInstrumentoCompra,false);a.txtInstrumentoVenta=a.divModal.find(".textbox-instrumento-venta");a.txtInstrumentoVenta.val((a.requestData&&a.requestData.instrumentoVenta)?a.requestData.instrumentoVenta:"");Core.Functions.Validations.toggleValidation(a.txtInstrumentoVenta,false);a.txtOrderQty=a.divModal.find(".textbox-cantidad-orden");new Core.Controls.DecimalPicker(a.txtOrderQty,{maxDecimalDigitCount:0,showThousandsSeparator:"",defaultValue:(a.requestData&&a.requestData.orderQty)?a.requestData.orderQty:""});Core.Functions.Validations.toggleValidation(a.txtOrderQty,false);a.txtMaximoOperacionesRealizadas=a.divModal.find(".textbox-maximo-operaciones-realizadas");new Core.Controls.DecimalPicker(a.txtMaximoOperacionesRealizadas,{maxDecimalDigitCount:0,showThousandsSeparator:"",defaultValue:(a.requestData&&a.requestData.maximoOperacionesRealizadas)?a.requestData.maximoOperacionesRealizadas:""});Core.Functions.Validations.toggleValidation(a.txtMaximoOperacionesRealizadas,false);a.txtLimiteOperadoMaximo=a.divModal.find(".textbox-limite-operado-maximo");new Core.Controls.DecimalPicker(a.txtLimiteOperadoMaximo,{maxDecimalDigitCount:0,showThousandsSeparator:"",defaultValue:(a.requestData&&a.requestData.limiteOperadoMaximo)?a.requestData.limiteOperadoMaximo:""});Core.Functions.Validations.toggleValidation(a.txtLimiteOperadoMaximo,false);a.txtCuentaCC=a.divModal.find(".textbox-cuenta-comitente");new Core.Controls.DecimalPicker(a.txtCuentaCC,{maxDecimalDigitCount:0,showThousandsSeparator:"",defaultValue:(a.requestData&&a.requestData.cuentaCC)?a.requestData.cuentaCC:""});Core.Functions.Validations.toggleValidation(a.txtCuentaCC,false);a.txtPorcentajeVariacionPrecio=a.divModal.find(".textbox-porcentaje-variacion-precio");new Core.Controls.DecimalPicker(a.txtPorcentajeVariacionPrecio,{maxDecimalDigitCount:5,showThousandsSeparator:"",defaultValue:(a.requestData&&a.requestData.porcentajeVariacionPrecio)?a.requestData.porcentajeVariacionPrecio:"0",enabledZero:true});Core.Functions.Validations.toggleValidation(a.txtPorcentajeVariacionPrecio,false);a.ddlSideSintetico=a.divModal.find(".dropdown-side-sintetico");a.ddlSideSintetico.shieldDropDown({dataSource:{data:[{value:a.eSideSintetico.Compra,text:"Compra"},{value:a.eSideSintetico.Venta,text:"Venta"}]},textTemplate:"{text}",valueTemplate:"{value}",value:(a.requestData&&a.requestData.sideSintetico)?a.requestData.sideSintetico.toString():""});Core.Functions.Validations.toggleValidation(a.ddlSideSintetico,false);a.divCampoAdicional=a.divModal.find(".div-campo-adicional");a.divCampoAdicional.hide();a.divVerMas=a.divModal.find(".div-ver-mas");a.divVerMas.show();a.btnVerMas=a.divModal.find(".btn-ver-mas");a.btnVerMas.unbind("click");a.btnVerMas.click(function(){a.divCampoAdicional.show();a.divVerMas.hide()});a.btnConfirmar=a.divModal.find(".btn-confirmar");a.btnConfirmar.unbind("click");a.btnConfirmar.click(function(){a.divAlert.slideUp();Core.Functions.Validations.toggleValidation(a.txtCantidad,false);Core.Functions.Validations.toggleValidation(a.txtPrecio,false);Core.Functions.Validations.toggleValidation(a.txtIdTipoEstrategia,false);Core.Functions.Validations.toggleValidation(a.txtDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtPriority,false);Core.Functions.Validations.toggleValidation(a.ddlSideSintetico,false);Core.Functions.Validations.toggleValidation(a.txtInstrumentoCompra,false);Core.Functions.Validations.toggleValidation(a.txtInstrumentoVenta,false);Core.Functions.Validations.toggleValidation(a.txtOrderQty,false);Core.Functions.Validations.toggleValidation(a.txtMaximoOperacionesRealizadas,false);Core.Functions.Validations.toggleValidation(a.txtLimiteOperadoMaximo,false);Core.Functions.Validations.toggleValidation(a.txtCuentaCC,false);Core.Functions.Validations.toggleValidation(a.txtPorcentajeVariacionPrecio,false);var d={value:true};a.requestData.cantidadOperar=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidad,d));a.requestData.priceOperar=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecio,d));a.requestData.idTipoEstrategia=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtIdTipoEstrategia,d));a.requestData.Descripcion=Core.Functions.Validations.getValidatedInputValue(a.txtDescripcion,d);a.requestData.priority=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtPriority,d));a.requestData.sideSintetico=Core.Functions.Validations.getValidatedDropDownValue(a.ddlSideSintetico,d);a.requestData.instrumentoCompra=Core.Functions.Validations.getValidatedInputValue(a.txtInstrumentoCompra,d);a.requestData.instrumentoVenta=Core.Functions.Validations.getValidatedInputValue(a.txtInstrumentoVenta,d);a.requestData.orderQty=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtOrderQty,d));a.requestData.maximoOperacionesRealizadas=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtMaximoOperacionesRealizadas,d));a.requestData.limiteOperadoMaximo=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtLimiteOperadoMaximo,d));a.requestData.cuentaCC=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtCuentaCC,d));a.requestData.reiniciarContador=a.chkReiniciarContador.swidget().checked()?1:0;a.requestData.porcentajeVariacionPrecio=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNoEmptyNumericInputValue(a.txtPorcentajeVariacionPrecio,d));if(a.requestData.porcentajeVariacionPrecio<0||a.requestData.porcentajeVariacionPrecio>2){d.value=false;Core.Functions.Validations.toggleValidation(a.txtPorcentajeVariacionPrecio,true);a.divAlert.text("El porcentaje de variación del precio debe encontrarse entre 0 y 2.");a.divAlert.slideDown()}if(d.value){var c=new Core.Ajax.ServerRequest({overlayElement:a.btnConfirmar,secureRequest:true,showOverlay:true,requestUrl:"algoritmo/estrategia/modificar",requestType:"POST",requestData:a.requestData});c.onSuccess=function(e){a.divModal.modal("hide");if(a.onSave){a.onSave()}};c.request()}});a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.divModal.modal({show:true})};a.destroy=function(){a.chkReiniciarContador.swidget().destroy();a.ddlSideSintetico.swidget().destroy()}};Core.Business.AlgoLetes=new function(){var a=this;var b=60000;a.eSide={Compra:"BUY",Venta:"SELL"};a.id="algoLetes";a.idDefaultAccount=null;a.idDefaultProfile=null;a.btnRefresh=null;a.btnDetalles=null;a.chkHabilitado=null;a.divContainerEstrategia=null;a.estrategiaControls=[];a.originalData=null;a.timerId=null;a.pageOptions=null;a.loaded=false;a.executeTimer=true;a.window=$(window);a.init=function(c,d){Core.loadPage("mesa-algo-letes.html",function(){document.title="Algo Letes";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[d]);a.idDefaultAccount=c;a.idDefaultProfile=d;a.btnRefresh=$(".btn-refresh");a.btnDetalles=$(".btn-detalles");a.chkHabilitado=$(".chk-habilitado");a.divContainerEstrategia=$(".div-container-estrategias");a.divContainerEstrategia.html("");a.initControls();a.estrategiaControls=[];a.executeTimer=true;a.loaded=false;a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,c,d,function(){a.loadControls()},"Core.Business.AlgoLetes");a.timerId=window.setInterval(function(){if(a.executeTimer){a.loadControls()}},(a.pageOptions&&a.pageOptions.algoLetesRefresco?a.pageOptions.algoLetesRefresco:b));Core.Objects.Context.Timers.push(a.timerId)})};a.initControls=function(){a.btnRefresh.on("click",function(){a.loaded=false;a.loadControls()});a.btnDetalles.on("click",function(){if(a.originalData&&a.originalData.algoParameters){var d="";d+="<table class='table table-striped'>";d+="<thead><tr><th>Nombre</th><th>Valor</th></tr></thead>";d+="<tbody>";$.each(a.originalData.algoParameters,function(e,f){if(!Array.isArray(f)){d+="<tr>";d+="<td>"+e+"</td>";d+="<td>"+f+"</td>";d+="</tr>"}});d+="</tbody>";d+="</table>";var c=new Core.Controls.Dialog("Detalles",d,{displayButtons:{close:true,accept:false}});c.show()}});a.chkHabilitado.shieldSwitch({checked:true,enabled:a.pageOptions&&a.pageOptions.algoLetesEdit==1?true:false,events:{click:function(c){var d=(a.originalData&&a.originalData.configuration&&a.originalData.configuration[0])?a.originalData.configuration[0]:{};d.EjecutarOrdenes=a.chkHabilitado.swidget().checked();var f=new Core.Ajax.ServerRequest({secureRequest:true,showOverlay:true,requestUrl:"algomm/configuracion",requestType:"POST",requestData:d});f.onSuccess=function(e){a.loaded=false;a.loadControls()};f.request()}}})};a.loadControls=function(){var c=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"algomm/datos",requestType:"GET"});c.onSuccess=function(d){a.originalData=d;a.chkHabilitado.swidget().checked(((a.originalData&&a.originalData.configuration&&a.originalData.configuration[0]&&a.originalData.configuration[0].EjecutarOrdenes)?true:false));var e=[];a.originalData.strategies.forEach(function(g,f){if(e.indexOf(g.name)<0){e.push(g.name)}});e.forEach(function(x,y){if(!$.grep(a.estrategiaControls,function(J,K){return J.estrategia==x})[0]){var q=$("<div class='col-md-6 col-sm-12 col-xs-12' />").appendTo(a.divContainerEstrategia);var l=$('<div class="box-total-full-width gris" style="height:115px;" />').appendTo(q);l.hide();var C=$('<p class="total"></p >').appendTo(l);var m=$('<div class="col-lg-4 col-md-4 col-sm-12 col-xs-12" />').appendTo(l);var j=$('<input type="checkbox" />').appendTo(m);var g=$('<button type="button" title="Editar" class="btn-sm balanz-button" style="margin-left: 10px;"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(m);var f=$('<button type="button" title="Detalles" class="btn-sm balanz-button" style="margin-left: 10px;"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(m);if(!(a.pageOptions&&a.pageOptions.algoLetesEdit==1)){g.hide()}var o=$('<div class="col-lg-4 col-md-4 col-sm-12 col-xs-12" style="margin-top:4px;" />').appendTo(l);var z=$('<label style="color: black; font-size: 20px;"></label>').appendTo(o);var A=$('<label style="color: black; margin-left:8px;"></label>').appendTo(o);var p=$('<div class="col-lg-4 col-md-4 col-sm-12 col-xs-12" />').appendTo(l);var B=$('<label style="color: black; font-size: 24px;"></label>').appendTo(p);var D=$('<label style="color: black; margin-left:8px;"></label>').appendTo(p);var n=$('<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="margin-top:8px;"/>').appendTo(l);j.shieldSwitch({enabled:a.pageOptions&&a.pageOptions.algoLetesEdit==1?true:false,events:{click:function(J){a.habilitar(x,a.eSide.Compra,j.swidget().checked())}}});g.on("click",function(){a.editar(x,a.eSide.Compra)});f.on("click",function(){a.detallesEstrategia(x,a.eSide.Compra)});a.estrategiaControls.push({estrategia:x,side:a.eSide.Compra,div:l,lblStrategy:C,lblCantidad:z,lblCantidadVariacion:A,lblPrecioOrden:B,lblPrecioMarketData:D,chkHabilitado:j,btnEditar:g,btnDetalles:f,divAlert:n});var r=$("<div class='col-md-6 col-sm-12 col-xs-12' />").appendTo(a.divContainerEstrategia);var s=$('<div class="box-total-full-width gris" style="height:115px;" />').appendTo(r);s.hide();var H=$('<p class="total"></p>').appendTo(s);var w=$('<div class="col-lg-4 col-md-4 col-sm-12 col-xs-12" />').appendTo(s);var I=$('<label style="color: black; margin-right:8px;"></label>').appendTo(w);var G=$('<label style="color: black; font-size: 24px;"></label>').appendTo(w);var v=$('<div class="col-lg-4 col-md-4 col-sm-12 col-xs-12" style="margin-top:4px;" />').appendTo(s);var F=$('<label style="color: black; margin-left:8px;"></label>').appendTo(v);var E=$('<label style="color: black; font-size: 20px;"></label>').appendTo(v);var t=$('<div class="col-lg-4 col-md-4 col-sm-12 col-xs-12" />').appendTo(s);var h=$('<button type="button" title="Detalles" class="btn-sm balanz-button" style="margin-right: 10px;"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(t);var i=$('<button type="button" title="Editar" class="btn-sm balanz-button" style="margin-right: 10px;"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(t);if(!(a.pageOptions&&a.pageOptions.algoLetesEdit==1)){i.hide()}var k=$('<input type="checkbox" />').appendTo(t);var u=$('<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="margin-top:8px;"/>').appendTo(s);k.shieldSwitch({enabled:a.pageOptions&&a.pageOptions.algoLetesEdit==1?true:false,events:{click:function(J){a.habilitar(x,a.eSide.Venta,k.swidget().checked())}}});i.on("click",function(){a.editar(x,a.eSide.Venta)});h.on("click",function(){a.detallesEstrategia(x,a.eSide.Venta)});a.estrategiaControls.push({estrategia:x,side:a.eSide.Venta,div:s,lblStrategy:H,lblCantidad:E,lblCantidadVariacion:F,lblPrecioOrden:G,lblPrecioMarketData:I,chkHabilitado:k,btnEditar:i,btnDetalles:h,divAlert:u})}});a.estrategiaControls.forEach(function(g,f){g.div.hide()});a.originalData.strategies.forEach(function(h,g){var f=$.grep(a.estrategiaControls,function(k,l){return k.estrategia==h.name&&k.side==h.side})[0];if(f){f.lblStrategy.text(h.name);var i=null;if(a.originalData&&a.originalData.algoParameters&&a.originalData.algoParameters.strategies){i=$.grep(a.originalData.algoParameters.strategies,function(l,k){return l.strategyId==h.strategyId})[0]}f.lblPrecioOrden.text(((i&&i.orderPlaced)?Core.Functions.grid.formatPrice(i.orderPlaced.price):""));f.lblPrecioMarketData.text((i?(" ("+Core.Functions.grid.formatPrice(i.instrumentPrice)+")"):""));f.lblCantidad.text(((i&&i.orderPlaced)?i.orderPlaced.origQty:""));var j=(i&&i.orderPlaced&&i.orderPlaced.origQty)?("(%"+(i.orderPlaced.executedQty*100/i.orderPlaced.origQty).toFixed(2)+") "):"";f.lblCantidadVariacion.text(j);f.chkHabilitado.swidget().checked(h.active?true:false);f.div.css("background-color",((a.chkHabilitado.swidget().checked()&&f.chkHabilitado.swidget().checked())?"":"lightgrey"));f.div.css("opacity",((a.chkHabilitado.swidget().checked()&&f.chkHabilitado.swidget().checked())?"1":"0.6"));f.div.show()}});a.loaded=true};c.onError=function(f){a.executeTimer=false;var h=(f.responseJSON&&f.responseJSON.Descripcion)?"Mensaje":"Error de conexión";var d=(f.responseJSON&&f.responseJSON.Descripcion)?f.responseJSON.Descripcion:"Algunos componentes de la página no se cargaron correctamente. Por favor intente mas tarde...";var g=new Core.Controls.Dialog(h,"<p>"+d+"</p>",{displayButtons:{close:true,accept:false},onClosed:function(){a.executeTimer=true;g.destroy()}});g.show()};c.request()};a.habilitar=function(c,f,d){var e=$.grep(a.originalData.strategies,function(i,h){return i.name==c&&i.side==f})[0];if(e){e.active=d;e.restart=false;var g=new Core.Ajax.ServerRequest({secureRequest:true,showOverlay:true,requestUrl:"algomm/estrategia",requestType:"POST",requestData:e});g.onSuccess=function(h){a.loaded=false;a.loadControls()};g.request()}};a.editar=function(c,e){var d=$.grep(a.originalData.strategies,function(g,f){return g.name==c&&g.side==e})[0];if(d){new Core.Business.AlgoLetes.ActualizarParametros({onSave:function(){a.loaded=false;a.loadControls()},requestData:d}).show()}};a.detallesEstrategia=function(d,g){var f=["orderPlaced_orderId","cancelOrderPlaced_orderId","strategyId","name","type","priority","side","securityIdMd","securityIdOr","price","orderQty","active","account","instrumentPrice"];var d=$.grep(a.originalData.strategies,function(j,i){return j.name==d&&j.side==g})[0];if(d&&a.originalData&&a.originalData.algoParameters&&a.originalData.algoParameters.strategies){var e=$.grep(a.originalData.algoParameters.strategies,function(j,i){return j.strategyId==d.strategyId})[0];if(e){e.orderPlaced_orderId=e.orderPlaced?e.orderPlaced.orderId:null;e.cancelOrderPlaced_orderId=e.cancelOrderPlaced?e.cancelOrderPlaced.orderId:null;var h="";h+="<table class='table table-striped'>";h+="<thead><tr><th>Nombre</th><th>Valor</th></tr></thead>";h+="<tbody>";$.each(e,function(i,j){if(!Array.isArray(j)&&f.indexOf(i)>=0){h+="<tr>";h+="<td>"+i+"</td>";h+="<td>"+(j!=null?j:"")+"</td>";h+="</tr>"}});h+="</tbody>";h+="</table>";var c=new Core.Controls.Dialog("Detalles",h,{displayButtons:{close:true,accept:false}});c.show()}}}};Core.Business.AlgoLetes.ActualizarParametros=function(b){var a=this;a.divModal=$(".div-modal-actualizar-parametros");a.onSave=null;a.requestData=null;$.extend(true,a,b);a.eSide={Compra:"BUY",Venta:"SELL"};a.divAlert=null;a.divCampoAdicional=null;a.divVerMas=null;a.btnVerMas=null;a.txtName=null;a.txtPrecio=null;a.txtCantidad=null;a.chkRestart=null;a.txtPrioridad=null;a.lblIDEstrategia=null;a.lblTipoEstrategia=null;a.lblTipoOperacion=null;a.lblSecurityIDMercado=null;a.lblSecurityIDOperaciones=null;a.lblCuenta=null;a.btnConfirmar=null;a.show=function(){a.divAlert=$(".div-alert-actualizar-parametros");a.divAlert.slideUp();a.txtNombre=a.divModal.find(".textbox-nombre");a.txtNombre.val((a.requestData&&a.requestData.name)?a.requestData.name:"");Core.Functions.Validations.toggleValidation(a.txtNombre,false);a.txtPrecio=a.divModal.find(".textbox-precio");new Core.Controls.DecimalPicker(a.txtPrecio,{maxDecimalDigitCount:5,showThousandsSeparator:"",defaultValue:(a.requestData&&a.requestData.price)?a.requestData.price:""});Core.Functions.Validations.toggleValidation(a.txtPrecio,false);a.txtCantidad=a.divModal.find(".textbox-cantidad");new Core.Controls.DecimalPicker(a.txtCantidad,{maxDecimalDigitCount:0,showThousandsSeparator:"",defaultValue:(a.requestData&&a.requestData.orderQty)?a.requestData.orderQty:""});Core.Functions.Validations.toggleValidation(a.txtCantidad,false);a.chkRestart=a.divModal.find(".checkbox-restart");a.chkRestart.shieldCheckBox({label:"Reiniciar"});a.chkRestart.swidget().checked((a.requestData&&a.requestData.restart?true:false));a.txtPrioridad=a.divModal.find(".textbox-prioridad");new Core.Controls.DecimalPicker(a.txtPrioridad,{maxDecimalDigitCount:0,showThousandsSeparator:"",defaultValue:(a.requestData&&a.requestData.priority)?a.requestData.priority:""});Core.Functions.Validations.toggleValidation(a.txtPrioridad,false);a.lblIDEstrategia=a.divModal.find(".label-id-estrategia");a.lblIDEstrategia.text((a.requestData&&a.requestData.strategyId)?a.requestData.strategyId:"");a.lblTipoEstrategia=a.divModal.find(".label-tipo-estrategia");a.lblTipoEstrategia.text((a.requestData&&a.requestData.type)?a.requestData.type:"");a.lblTipoOperacion=a.divModal.find(".label-tipo-operacion");a.lblTipoOperacion.text((a.requestData&&a.requestData.side)?a.requestData.side:"");a.lblSecurityIDMercado=a.divModal.find(".label-security-id-mercado");a.lblSecurityIDMercado.text((a.requestData&&a.requestData.securityIdMd)?a.requestData.securityIdMd:"");a.lblSecurityIDOperaciones=a.divModal.find(".label-security-id-operaciones");a.lblSecurityIDOperaciones.text((a.requestData&&a.requestData.securityIdOr)?a.requestData.securityIdOr:"");a.lblCuenta=a.divModal.find(".label-cuenta");a.lblCuenta.text((a.requestData&&a.requestData.account)?a.requestData.account:"");a.divCampoAdicional=a.divModal.find(".div-campo-adicional");a.divCampoAdicional.hide();a.divVerMas=a.divModal.find(".div-ver-mas");a.divVerMas.show();a.btnVerMas=a.divModal.find(".btn-ver-mas");a.btnVerMas.unbind("click");a.btnVerMas.click(function(){a.divCampoAdicional.show();a.divVerMas.hide()});a.btnConfirmar=a.divModal.find(".btn-confirmar");a.btnConfirmar.unbind("click");a.btnConfirmar.click(function(){a.divAlert.slideUp();Core.Functions.Validations.toggleValidation(a.txtNombre,false);Core.Functions.Validations.toggleValidation(a.txtPrecio,false);Core.Functions.Validations.toggleValidation(a.txtCantidad,false);Core.Functions.Validations.toggleValidation(a.txtPrioridad,false);var d={value:true};a.requestData.name=Core.Functions.Validations.getValidatedInputValue(a.txtNombre,d);a.requestData.price=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecio,d));a.requestData.orderQty=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidad,d));a.requestData.restart=a.chkRestart.swidget().checked();a.requestData.priority=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrioridad,d));if(d.value){var c=new Core.Ajax.ServerRequest({overlayElement:a.btnConfirmar,secureRequest:true,showOverlay:true,requestUrl:"algomm/estrategia",requestType:"POST",requestData:a.requestData});c.onSuccess=function(e){a.divModal.modal("hide");if(a.onSave){a.onSave()}};c.request()}});a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.divModal.modal({show:true})};a.destroy=function(){a.chkRestart.swidget().destroy()}};Core.Business.MesaCalculadoraBonos=new function(){var a=this;a.id="mesaCalculadoraBonos";a.idDefaultAccount=null;a.idDefaultProfile=null;a.btnEjecutar=null;a.init=function(b,c){Core.loadPage("mesa-calculadora-bonos.html",function(){document.title="Calculadora Bonos";a.idDefaultAccount=b;a.idDefaultProfile=c;a.btnEjecutar=$(".btn-ejecutar");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){},"Core.Business.MesaCalculadoraBonos")})};a.initControls=function(){a.btnEjecutar.on("click",function(){var b=new Core.Ajax.ServerRequest({overlayElement:a.btnEjecutar,secureRequest:true,requestUrl:"calculadorabonos",requestType:"POST"});b.onSuccess=function(d){var c=new Core.Controls.Dialog("Mensaje","Ejecución exitosa.",{displayButtons:{close:true,accept:false}});c.show()};b.request()})}};Core.Business.MesaConfAsignacionInstrumentos=new function(){var a=this;a.id="mesaConfiguracionAsignacionInstrumentos";a.divAsignacionesInstrumentos=null;a.btnAgregar=null;a.txtFilter=null;a.timeout=null;a.init=function(b,c){Core.loadPage("mesa-configuracion-asignacion-instrumentos.html",function(){document.title="Asignación de Instrumentos";a.divAsignacionesInstrumentos=$(".div-asignaciones-instrumentos");a.btnAgregar=$(".btn-agregar");a.txtFilter=$(".textbox-filter");a.initControls();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.MesaConfAsignacionInstrumentos")})};a.initGrid=function(){var c=function(d){if(!d){return""}return d.substr(0,16)};var b=[];b.push({field:"Equipo",title:"Equipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"33%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"SubTipoBono",title:"Sub-Tipo Bono",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"33%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:50,field:"",title:" ",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(e,f,g){if(f.verBotonLimpiarSubTipo){var d=$('<button type="button" title="Limpiar Sub-Tipo" class="btn-sm balanz-button"><span class="glyphicon glyphicon-trash"></span></button>').appendTo(e);d.on("click",function(){var h=new Core.Ajax.ServerRequest({overlayElement:d,showOverlay:true,requestUrl:"configuraciones/asignacioninstrumentos/subtipobono",requestType:"POST",requestData:{data:{idNegocio:f.idNegocio,idInstrumento:f.idInstrumento,idDerivado:f.idDerivado}}});h.onSuccess=function(i){a.loadGrid()};h.request()})}}});b.push({field:"FechaActualizacionCalculadora",title:"Calculadora",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"33%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:c});b.push({field:"Ticker",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"33%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:100,field:"",title:" ",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(f,g,h){var d=$('<button type="button" title="Editar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(f);d.on("click",function(){new Core.Business.MesaConfAsignacionInstrumentos.ManagerAsignacion({asignacion:g,overlayElement:d,onComplete:function(){a.loadGrid()}}).show()});var e=$('<button type="button" title="Eliminar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(f);e.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar la asignacion de Equipo: "+g.Equipo+", Sub-Tipo Bono: "+g.SubTipoBono+" y Ticker: "+g.Ticker+"?",{onAccepted:function(){var i=new Core.Ajax.ServerRequest({overlayElement:e,secureRequest:true,requestUrl:"configuraciones/asignacioninstrumentos",requestType:"POST",requestData:{data:{idNegocio:g.idNegocio,idInstrumento:g.idInstrumento,idDerivado:g.idDerivado,Borrado:1}}});i.onSuccess=function(j){a.loadGrid()};i.request()}}).show()})}});a.divAsignacionesInstrumentos.shieldGrid({dataSource:{data:[]},sorting:false,selection:false,rowHover:false,columns:b})};a.initControls=function(){a.btnAgregar.on("click",function(){new Core.Business.MesaConfAsignacionInstrumentos.ManagerAsignacion({overlayElement:a.btnAgregar,onComplete:function(){a.loadGrid()}}).show()});a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var b=a.divAsignacionesInstrumentos.swidget().dataSource;if(value){b.filter={or:[{path:"Equipo",filter:"contains",value:value},{path:"SubTipoBono",filter:"contains",value:value},{path:"Ticker",filter:"contains",value:value}]}}else{b.filter=null}b.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.MesaConfAsignacionInstrumentos.txtFilter")};a.loadGrid=function(){var b=new Core.Ajax.ServerRequest({overlayElement:a.divAsignacionesInstrumentos.parent(),secureRequest:true,requestUrl:"configuraciones/asignacioninstrumentos",requestType:"GET"});b.onSuccess=function(c){c.asignaciones.sort(function(e,f){if(e.Equipo<f.Equipo){return -1}else{if(e.Equipo>f.Equipo){return 1}else{if(e.SubTipoBono<f.SubTipoBono){return -1}else{if(e.SubTipoBono>f.SubTipoBono){return 1}else{if(e.Ticker<f.Ticker){return -1}else{if(e.Ticker>f.Ticker){return 1}else{return 0}}}}}}});var d=a.divAsignacionesInstrumentos.swidget().initialOptions;d.dataSource.data=c;d.dataSource.schema={data:"asignaciones"};a.divAsignacionesInstrumentos.swidget().refresh(d);a.txtFilter.keydown()};b.request()}};Core.Business.MesaConfAsignacionInstrumentos.ManagerAsignacion=function(b){var a=this;a.divModalManagerAsignacion=$(".div-modal-manager-asignacion");a.asignacion=null;a.overlayElement=null;a.lblEspecie=null;a.txtFilterEspecies=null;a.divEspecies=null;a.selectedItem=null;a.ddlEquipo=null;a.btnConfirmar=null;a.onComplete=function(){};$.extend(true,a,b);a.show=function(){var c=new Core.Ajax.ServerRequest({allowCache:true,showOverlay:true,secureRequest:true,overlayElement:a.overlayElement,requestUrl:"equipos/0",requestType:"GET"});c.onSuccess=function(d){a.ddlEquipo=a.divModalManagerAsignacion.find(".dropdown-equipo");a.ddlEquipo.shieldComboBox({dataSource:{data:d.equipos},valueTemplate:"{idEquipo}",textTemplate:"{Equipo}",value:((a.asignacion)?a.asignacion.idEquipo.toString():""),autoComplete:{enabled:true,filter:{or:[{path:"Equipo",filter:"contains",value:""}]}}});a.lblEspecie=a.divModalManagerAsignacion.find(".lbl-especie");a.lblEspecie.text("Especie");a.txtFilterEspecies=a.divModalManagerAsignacion.find(".textbox-filter-especies");a.txtFilterEspecies.shieldTextBox({value:"",events:{blur:function(){a.loadEspecies()}}});a.divEspecies=a.divModalManagerAsignacion.find(".div-especies");a.divEspecies.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:[{field:"Ticker",width:"35%",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"Descripcion",width:"50%",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{field:"",title:" ",width:"15%",headerAttributes:Core.Functions.grid.getCellEvenClass(),buttons:[{caption:"Seleccionar",cls:"",commandName:"Seleccionar",click:function(e){a.selectedItem=a.divEspecies.swidget().dataItem(e);a.lblEspecie.text("Especie - Seleccionada: "+a.selectedItem.Ticker)}}]}]});if(a.asignacion&&a.asignacion.Ticker){a.txtFilterEspecies.val(a.asignacion.Ticker);a.loadEspecies(true)}a.btnConfirmar=a.divModalManagerAsignacion.find(".btn-confirmar");a.btnConfirmar.unbind("click");a.btnConfirmar.click(function(){Core.Functions.Validations.toggleValidation(a.ddlEquipo,false);if(!a.ddlEquipo.swidget().selectedItem()){Core.Functions.Validations.toggleValidation(a.ddlEquipo,true);return}if(!a.selectedItem){Core.Functions.Validations.toggleValidation(a.txtFilterEspecies,true);return}var e={data:{}};e.data.idEquipo=a.ddlEquipo.swidget().selectedItem().idEquipo;if(a.asignacion){e.data.idNegocioNew=a.selectedItem.idNegocio;e.data.idInstrumentoNew=a.selectedItem.idInstrumento;e.data.idDerivadoNew=a.selectedItem.idDerivado;e.data.idNegocio=a.asignacion.idNegocio;e.data.idInstrumento=a.asignacion.idInstrumento;e.data.idDerivado=a.asignacion.idDerivado}else{e.data.idNegocio=a.selectedItem.idNegocio;e.data.idInstrumento=a.selectedItem.idInstrumento;e.data.idDerivado=a.selectedItem.idDerivado}var f=new Core.Ajax.ServerRequest({overlayElement:a.btnConfirmar,secureRequest:true,requestUrl:"configuraciones/asignacioninstrumentos",requestType:"POST",requestData:e});f.onSuccess=function(g){if(g.resultado==1){a.divModalManagerAsignacion.modal("hide");a.onComplete()}else{new Core.Controls.Dialog("Mensaje",g.Descripcion,{displayButtons:{close:true,accept:false}}).show()}};f.request()});a.divModalManagerAsignacion.unbind("shown.bs.modal");a.divModalManagerAsignacion.on("shown.bs.modal",function(){a.ddlEquipo.focus()});a.divModalManagerAsignacion.unbind("hidden.bs.modal");a.divModalManagerAsignacion.on("hidden.bs.modal",function(){a.ddlEquipo.swidget().destroy();a.divEspecies.swidget().destroy();a.txtFilterEspecies.swidget().destroy()});a.divModalManagerAsignacion.modal({show:true})};c.request()};a.loadEspecies=function(c){a.selectedItem=null;a.lblEspecie.text("Especie");var d=a.divEspecies.swidget().initialOptions;d.dataSource.data=[];a.divEspecies.swidget().refresh(d);if(a.txtFilterEspecies.val()){var e=new Core.Ajax.ServerRequest({showOverlay:false,secureRequest:true,requestUrl:"especies/ticker/substr",requestType:"GET",requestData:{tickersubstr:a.txtFilterEspecies.val()}});e.onSuccess=function(h){var f=h.especies==null?[]:h.especies;var g=a.divEspecies.swidget().initialOptions;g.dataSource.data=f;a.divEspecies.swidget().refresh(g);if(c){a.selectedItem=f.length>0?f[0]:null;a.lblEspecie.text("Especie - Seleccionada: "+a.selectedItem.Ticker)}};e.request()}}};Core.Business.MesaConfCodigosEspecies=new function(){var a=this;a.id="mesaConfCodigosEspecies";a.divCodigosEspecies=null;a.btnAgregar=null;a.init=function(b,c){Core.loadPage("mesa-configuracion-codigos-especies.html",function(){document.title="Configuración de Códigos Especies";a.divCodigosEspecies=$(".div-codigos-especies");a.btnAgregar=$(".btn-agregar");a.initControls();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.MesaConfCodigosEspecies")})};a.initGrid=function(){var b=[];b.push({field:"CodigoEspecie",title:"Código Especie",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"50%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"FechaAlta",title:"Fecha Alta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"25%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"username",title:"Usuario",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"25%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({width:50,field:"",title:" ",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,e,f){var c=$('<button type="button" title="Eliminar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(d);c.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar el código de especie: "+e.CodigoEspecie+"?",{onAccepted:function(){var g=new Core.Ajax.ServerRequest({overlayElement:c,secureRequest:true,requestUrl:"configuraciones/codigoespecie?especie="+e.CodigoEspecie,requestType:"DELETE"});g.onSuccess=function(h){a.loadGrid()};g.request()}}).show()})}});a.divCodigosEspecies.shieldGrid({dataSource:{data:[]},sorting:{multiple:true},selection:false,rowHover:false,columns:b})};a.initControls=function(){a.btnAgregar.on("click",function(){new Core.Controls.Prompt("Nuevo código especie","Ingrese el nuevo código de especie",{onAccepted:function(b){var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"configuraciones/codigoespecie",requestType:"POST",requestData:{codigoEspecie:b}});c.onSuccess=function(d){if(d.exito!=1){new Core.Controls.Dialog("Aviso",((d.mensaje)?d.mensaje:"Ha ocurrido un error al insertar el nuevo código, intente nuevamente."),{displayButtons:{close:true,accept:false}}).show()}else{a.loadGrid()}};c.request()}}).show()})};a.loadGrid=function(){var b=new Core.Ajax.ServerRequest({overlayElement:a.divCodigosEspecies.parent(),secureRequest:true,requestUrl:"configuraciones/codigoespecie",requestType:"GET"});b.onSuccess=function(c){var d=a.divCodigosEspecies.swidget().initialOptions;d.dataSource.data=c;d.dataSource.schema={data:"codigosespecies"};a.divCodigosEspecies.swidget().refresh(d)};b.request()}};Core.Business.MesaOperacionesExportar=new function(){var a=this;a.id="mesaOperacionesExportar";a.divOperaciones=null;a.lblTitle=null;a.txtDateFrom=null;a.txtDateTo=null;a.chkIncluirFinalizados=null;a.chkIncluirIgnorados=null;a.ddlCuenta=null;a.dataOperaciones=[];a.init=function(b,c){Core.loadPage("mesa-exportar-operaciones.html",function(){document.title="Exportar Operaciones";a.divOperaciones=$(".div-operaciones");a.lblTitle=$(".label-title");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.ddlCuenta=$(".dropdown-cuenta");a.chkIncluirFinalizados=$(".checkbox-incluir-finalizados");a.chkIncluirIgnorados=$(".checkbox-incluir-ignorados");a.initControls();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.MesaOperacionesExportar")})};a.initControls=function(){a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),events:{change:function(b){a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),events:{change:function(b){a.loadGrid()}}});a.ddlCuenta.shieldDropDown({dataSource:{data:[{value:Core.Enums.eVehiculo.BCV,text:"BCV"},{value:Core.Enums.eVehiculo.BCI,text:"BCI"},{value:Core.Enums.eVehiculo.INT,text:"INT"}]},valueTemplate:"{value}",textTemplate:"{text}",value:Core.Enums.eVehiculo.BCV.toString(),events:{select:function(b){a.loadGrid()}}});a.chkIncluirFinalizados[0].checked=false;a.chkIncluirFinalizados.on("change",function(){a.refreshGrid()});a.chkIncluirIgnorados[0].checked=false;a.chkIncluirIgnorados.on("change",function(){a.refreshGrid()})};a.initGrid=function(){a.divOperaciones.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Operaciones",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["cantidad","isin","abrev","moneda","concert","liq","precio","neto","tipoDeOp","agente","hora","tipoDeLiq","esDescubierto","comitente","liquidaPor","monedaaran","cuentaEnDep","observacionNum"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Operaciones"}}},selection:false,rowHover:false,columns:[{width:"6%",field:"cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNuleableIntegerNumber},{width:"8%",field:"isin",title:"Isin",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"4%",field:"abrev",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"7%",field:"moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"5%",field:"concert",title:"Concertación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"5%",field:"liq",title:"Liquidación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"6%",field:"precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatPrice},{width:"6%",field:"neto",title:"Neto",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatPrice},{width:"8%",field:"tipoDeOp",title:"Tipo Operación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"5%",field:"agente",title:"Agente",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"5%",field:"hora",title:"Hora",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"8%",field:"tipoDeLiq",title:"Tipo Liquidación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"4%",field:"esDescubierto",title:"Descubierto",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"4%",field:"comitente",title:"Comitente",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"5%",field:"liquidaPor",title:"Liquida Por",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"4%",field:"monedaaran",title:"MonedaAran",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"5%",field:"cuentaEnDep",title:"Cuenta Dep",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"4%",field:"EnVB",title:"En Visual",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"4%",field:"NumMinuta",title:"Minuta",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNuleableIntegerNumber},{width:"4%",field:"ignorados",title:"Ignorado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"5%",field:"observacionNum",title:"idOperacion",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{title:" ",width:40,filterable:false,headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(c,e,d){if(e.color){c.parent().css("background-color","rgba("+a.hexToRgb(e.color)+((d%2==0)?", 0.6":", 1 ")+")")}if(e.EnVB=="NO"){var b=$('<button type="button" title="'+((e.ignorados=="SI")?"Activar":"Ignorar")+'" class="btn-sm balanz-button"><span class="glyphicon '+((e.ignorados=="SI")?"glyphicon-ok":"glyphicon-remove")+'"></span></button>').appendTo(c);b.on("click",function(){var f={idOperacion:e.observacionNum,idTipoExportacion:e.idTipoExportacion};if(e.ignorados=="SI"){f.eliminar=1}var g=new Core.Ajax.ServerRequest({overlayElement:b,secureRequest:true,requestUrl:"ignorarexportacion",requestType:"POST",requestData:f});g.onSuccess=function(){a.loadGrid()};g.request()})}}}],paging:{pageSize:100,pageLinksCount:10}})};a.loadGrid=function(){a.lblTitle.text("Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var b;b="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));b+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));b+="&idCuenta="+a.ddlCuenta.swidget().selectedItem().value;var c=new Core.Ajax.ServerRequest({overlayElement:a.divOperaciones.parent(),secureRequest:true,requestUrl:"operacionesexportar",requestType:"GET",requestData:b});c.onSuccess=function(d){a.dataOperaciones=d.operaciones;a.refreshGrid()};c.request()};a.refreshGrid=function(){var b=$.grep(a.dataOperaciones,function(e,d){return true});if(!a.chkIncluirFinalizados[0].checked){b=$.grep(b,function(e,d){return e.EnVB=="NO"})}if(!a.chkIncluirIgnorados[0].checked){b=$.grep(b,function(e,d){return e.ignorados=="NO"})}var c=a.divOperaciones.swidget().initialOptions;c.dataSource.data=b;c.exportOptions.excel.dataSource.data=b;c.exportOptions.excel.readDataSource=true;a.divOperaciones.swidget().refresh(c)};a.hexToRgb=function(d){d=d.replace("#","");var f=parseInt(d.substring(0,2),16);var e=parseInt(d.substring(2,4),16);var c=parseInt(d.substring(4,6),16);var h=f+","+e+","+c;return h}};Core.Business.MesaOperacionesExportar2=new function(){var a=this;a.id="mesaOperacionesExportar2";a.divOperaciones=null;a.lblTitle=null;a.txtDateFrom=null;a.txtDateTo=null;a.ddlCuenta=null;a.init=function(b,c){Core.loadPage("mesa-exportar-operaciones-2.html",function(){document.title="Exportar Operaciones";a.divOperaciones=$(".div-operaciones");a.lblTitle=$(".label-title");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.ddlCuenta=$(".dropdown-cuenta");a.initControls();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.MesaOperacionesExportar2")})};a.initControls=function(){a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),events:{change:function(b){a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),events:{change:function(b){a.loadGrid()}}});a.ddlCuenta.shieldDropDown({dataSource:{data:[{value:Core.Enums.eVehiculo.BCV,text:"BCV"},{value:Core.Enums.eVehiculo.BCI,text:"BCI"},{value:Core.Enums.eVehiculo.INT,text:"INT"}]},valueTemplate:"{value}",textTemplate:"{text}",value:Core.Enums.eVehiculo.BCV.toString(),events:{select:function(b){a.loadGrid()}}})};a.initGrid=function(){a.divOperaciones.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Operaciones",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["cantidad","isin","abrev","moneda","concert","liq","precio","neto","tipoDeOp","agente","hora","tipoDeLiq","esDescubierto","comitente","liquidaPor","monedaaran","cuentaEnDep","observacionNum"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Operaciones"}}},selection:false,rowHover:false,columns:[{width:"6%",field:"cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNuleableIntegerNumber},{width:"8%",field:"isin",title:"Isin",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"4%",field:"abrev",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"7%",field:"moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"5%",field:"concert",title:"Concertación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"5%",field:"liq",title:"Liquidación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"6%",field:"precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatPrice},{width:"6%",field:"neto",title:"Neto",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatPrice},{width:"8%",field:"tipoDeOp",title:"Tipo Operación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"5%",field:"agente",title:"Agente",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"5%",field:"hora",title:"Hora",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"8%",field:"tipoDeLiq",title:"Tipo Liquidación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"4%",field:"esDescubierto",title:"Descubierto",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"4%",field:"comitente",title:"Comitente",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"5%",field:"liquidaPor",title:"Liquida Por",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"4%",field:"monedaaran",title:"MonedaAran",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"5%",field:"cuentaEnDep",title:"Cuenta Dep",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"5%",field:"observacionNum",title:"idOperacion",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()}]})};a.loadGrid=function(){a.lblTitle.text("Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var b;b="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));b+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));b+="&idCuenta="+a.ddlCuenta.swidget().selectedItem().value;var c=new Core.Ajax.ServerRequest({overlayElement:a.divOperaciones.parent(),secureRequest:true,requestUrl:"operacionesexportar2",requestType:"GET",requestData:b});c.onSuccess=function(d){var e=a.divOperaciones.swidget().initialOptions;e.dataSource.data=d;e.dataSource.schema={data:"operaciones"};e.exportOptions.excel.dataSource.data=d;e.exportOptions.excel.dataSource.schema={data:"operaciones"};e.exportOptions.excel.readDataSource=true;a.divOperaciones.swidget().refresh(e)};c.request()}};Core.Business.MesaLiquidacion=new function(){var a=this;var b=60000;a.id="mesaLiquidacion";a.eContrapartes={Todas:1,SoloEmpresasBcvBciInt:2,OtrasContrapartes:3};a.divContainerOperaciones=null;a.txtDateFrom=null;a.txtDateTo=null;a.btnNuevoDetalle=null;a.btnAjuste=null;a.btnVentaCompraBonos=null;a.btnTransferencias=null;a.divOperaciones=null;a.txtFilterOperaciones=null;a.btnDetallesPorDia=null;a.divDetallesPorDia=null;a.divGridDetallesPorDia=null;a.ddlMonedaDetallesPorDia=null;a.txtFechaLiquidacionDetallesPorDia=null;a.ddlEstado=null;a.ddlTipoContraparte=null;a.ddlOrigen=null;a.timeoutOperaciones=null;a.loaded=false;a.timerId=null;a.window=$(window);a.managerOperacion=null;a.idDefaultAccount=null;a.idDefaultProfile=null;a.init=function(c,d){Core.loadPage("mesa-liquidacion.html",function(){document.title="Liquidación";a.idDefaultAccount=c;a.idDefaultProfile=d;a.divContainerOperaciones=$(".div-container-operaciones");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.btnNuevoDetalle=$(".btn-nuevo-detalle");a.btnAjuste=$(".btn-ajuste");a.btnVentaCompraBonos=$(".btn-venta-compra-bonos");a.btnTransferencias=$(".btn-transferencias");a.divOperaciones=$(".div-operaciones");a.btnDetallesPorDia=$(".btn-detalles-por-dia");a.divDetallesPorDia=$(".div-detalles-por-dia");a.divGridDetallesPorDia=$(".div-grid-detalles-por-dia");a.ddlMonedaDetallesPorDia=$(".dropdown-moneda-detalles-por-dia");a.txtFechaLiquidacionDetallesPorDia=$(".textbox-fecha-liquidacion-detalles-por-dia");a.txtFilterOperaciones=$(".textbox-filter-operaciones");a.ddlEstado=$(".dropdown-filtro-estado");a.ddlTipoContraparte=$(".dropdown-filtro-tipo-contraparte");a.ddlOrigen=$(".dropdown-filtro-origen");a.initDatePickers();a.initGrid();a.initFilter();a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,a.idDefaultAccount,a.idDefaultProfile,function(){a.loadControls();a.loaded=true},"Core.Business.MesaLiquidacion");a.timerId=window.setInterval(function(){a.loadGrid()},b);Core.Objects.Context.Timers.push(a.timerId)})};a.initDatePickers=function(){var c=new Date();c.setDate(c.getDate()-7);a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:c,events:{change:function(d){a.loaded=false;a.loadGrid();if(a.divDetallesPorDia.is(":visible")){a.loadDetallesPorDia()}}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),events:{change:function(d){a.loaded=false;a.loadGrid()}}})};a.initGrid=function(){a.divOperaciones.shieldGrid({dataSource:{data:[],group:[{field:"Vehiculo",order:"asc"}]},selection:false,noRecordsText:"No hay operaciones para informar",rowHover:false,paging:{pageSize:100,pageLinksCount:10},grouping:{showGroupHeader:true,allowDragToGroup:true,message:"Arrastre un encabezado de columna para agrupar por esa columna"},sorting:{multiple:true},columns:[{width:"5%",field:"idOperacion",title:"ID",headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"5%",field:"FechaOperacion",title:"Concertación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatStringDate},{width:"5%",field:"FechaLiquidacion",title:"Liquidación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatStringDate},{width:"5%",field:"Vehiculo",title:"Cuenta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"6%",field:"TipoOperacion",title:"Operación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"10%",field:"OrigenOperacion",title:"Origen",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"8%",field:"Contraparte",title:"Contraparte",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"6%",field:"Ticker",title:"Especie",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"10%",field:"Isin",title:"Isin",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{title:"Cantidad",field:"Cantidad",width:"10%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(c,d,f){var e="";if(d.TipoOperacion=="Venta"){e="red"}c.html("<span class='"+e+"'>"+Core.Functions.grid.formatUndefinedNumber(a.getCantidad(d))+"</span>")}},{width:"10%",field:"Precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatPrice},{width:"8%",field:"Moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{title:"Monto",field:"Monto",width:"10%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(c,d,f){var e="";if(d.TipoOperacion=="Compra"){e="red"}c.html("<span class='"+e+"'>"+Core.Functions.grid.formatPrice(a.getMonto(d))+"</span>")}},{title:"Obs.",width:"6%",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(d,e,f){if(e.Observaciones&&e.Observaciones!=""){var h=(e.Observaciones.length>140)?(e.Observaciones.substr(0,140)+"..."):(e.Observaciones);var c=$('<button type="button" title="'+h+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>').appendTo(d);c.addClass("link-cell");c.on("click",function(){var i=new Core.Controls.Dialog("Observaciones",(e.Observaciones)?e.Observaciones:"",{displayButtons:{close:true,accept:false}});i.show()})}if(e.AdvertenciaFechaLiquidacion&&e.AdvertenciaFechaLiquidacion!=""){var g=(e.AdvertenciaFechaLiquidacion.length>140)?(e.AdvertenciaFechaLiquidacion.substr(0,140)+"..."):(e.AdvertenciaFechaLiquidacion);btnAdvertenciaFechaLiquidacion=$('<button type="button" title="'+g+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-exclamation-sign"></span></button>').appendTo(d);btnAdvertenciaFechaLiquidacion.addClass("link-cell");btnAdvertenciaFechaLiquidacion.on("click",function(){var i=new Core.Controls.Dialog("Advertencia",(e.AdvertenciaFechaLiquidacion)?e.AdvertenciaFechaLiquidacion:"",{displayButtons:{close:true,accept:false}});i.show()})}}},{width:"8%",field:"Estado",title:"Estado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"5%",field:"UsuarioCreacion",title:"Alta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"5%",field:"UsuarioOperador",title:"Operador",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"20%",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(h,i,j){var f=$('<button type="button" title="Modificar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(h);f.on("click",function(){if(a.managerOperacion!=null){Core.Objects.Context.Dialogs.remove(a.managerOperacion);a.managerOperacion.destroy()}a.managerOperacion=new Core.Controls.ManagerOperacion({operacion:i,pantallaOrigen:Core.Enums.eManagerOperacionPantallaOrigen.Liquidacion,origen:(i.idOrigenOperacion==Core.Enums.eMesaOperacionOrigen.CompraVentaBono)?Core.Enums.eMesaOperacionOrigen.Operacion:i.idOrigenOperacion,onSave:function(){a.loaded=false;a.loadGrid()},onDestroy:function(){a.managerOperacion=null},overlayElement:f});Core.Objects.Context.Dialogs.push(a.managerOperacion);a.managerOperacion.show()});if(Core.Objects.Context.Profiles[a.idDefaultProfile].opciones&&Core.Objects.Context.Profiles[a.idDefaultProfile].opciones.mesaDetalleCambios){var e=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-resize-full"></span></button>').appendTo(h);e.on("click",function(){a.loadDetails(i.idOperacion,e)})}if(i.liquidable){var g=$('<button type="button" title="Liquidar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-check"></span></button>').appendTo(h);g.on("click",function(){var k={};k.data={};k.data.id=i.idOperacion;k.data.idEstadoOperacion=Core.Enums.eEstadoOperacion.Liquidada;k.data.FechaLiquidacion=Core.Functions.Date.getDateAsString(new Date());var l=new Core.Ajax.ServerRequest({overlayElement:g,showOverlay:true,requestUrl:"operaciones",requestType:"PUT",requestData:k});l.onSuccess=function(m){a.loadGrid()};l.request()})}if(i.bajadasubida){var c=$('<button type="button" title="Bajada Subida" class="btn-sm balanz-button"><span class="glyphicon glyphicon-sort"></span></button>').appendTo(h);c.on("click",function(){if(a.managerOperacion!=null){Core.Objects.Context.Dialogs.remove(a.managerOperacion);a.managerOperacion.destroy()}var k=JSON.parse(JSON.stringify(i));k.idOperacion=null;k.FechaLiquidacion=null;k.FechaOperacion=null;k.idOrigenOperacion=Core.Enums.eMesaOperacionOrigen.CompraVentaBono;k.idTipoOperacion=((i.idTipoOperacion==Core.Enums.eMesaTipoOperacion.Venta)?Core.Enums.eMesaTipoOperacion.VentaBono:Core.Enums.eMesaTipoOperacion.CompraBono);a.managerOperacion=new Core.Controls.ManagerOperacion({operacion:k,pantallaOrigen:Core.Enums.eManagerOperacionPantallaOrigen.Liquidacion,origen:Core.Enums.eMesaOperacionOrigen.CompraVentaBono,onSave:function(){a.loaded=false;a.loadGrid()},onDestroy:function(){a.managerOperacion=null},overlayElement:c});Core.Objects.Context.Dialogs.push(a.managerOperacion);a.managerOperacion.show()})}var d=$('<button type="button" title="Eliminar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(h);d.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar la operación con ID: "+i.idOperacion+"?",{onAccepted:function(){var k={};k.data={};k.data.id=i.idOperacion;k.data.Borrado=1;var l=new Core.Ajax.ServerRequest({overlayElemet:d,requestUrl:"operaciones",requestType:"PUT",requestData:k});l.onSuccess=function(m){a.loaded=false;a.loadGrid()};l.request()}}).show()})}}],toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Operaciones",columnFields:["idOperacion","FechaOperacion","FechaLiquidacion","Vehiculo","TipoOperacion","OrigenOperacion","Contraparte","Ticker","Isin","Nominales","Precio","Moneda","Total","Observaciones","UsuarioCreacion","UsuarioOperador"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Operaciones"}}}})};a.initFilter=function(){a.txtFilterOperaciones.on("keydown",function(){clearTimeout(a.timeoutOperaciones);a.timeoutOperaciones=setTimeout(function(){value=a.txtFilterOperaciones.val();var c=a.divOperaciones.swidget().dataSource;if(value){c.filter={or:[{path:"idOperacion",filter:"contains",value:value},{path:"Ticker",filter:"contains",value:value},{path:"Isin",filter:"contains",value:value},{path:"Vehiculo",filter:"contains",value:value},{path:"Contraparte",filter:"contains",value:value},{path:"Moneda",filter:"contains",value:value},{path:"UsuarioOperador",filter:"contains",value:value},{path:"UsuarioCreacion",filter:"contains",value:value},{path:"TipoOperacion",filter:"contains",value:value},{path:"Cantidad",filter:"contains",value:value},{path:"Precio",filter:"contains",value:value},{path:"Monto",filter:"contains",value:value}]}}else{c.filter=null}c.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilterOperaciones,"Core.Business.MesaLiquidacion.txtFilterOperaciones");a.ddlEstado.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idEstadoOperacion}",textTemplate:"{Nombre}",width:"72%",events:{select:function(c){a.loaded=false;a.loadGrid()}}});a.ddlOrigen.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idOrigen}",textTemplate:"{Origen}",width:"72%",events:{select:function(c){a.loaded=false;a.loadGrid()}}});a.ddlTipoContraparte.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idTipoContraparte}",textTemplate:"{TipoContraparte}",width:"60%",value:"0",events:{select:function(c){a.loaded=false;a.loadGrid()}}})};a.initControls=function(){a.btnDetallesPorDia.attr("title","Abrir detalles");a.btnDetallesPorDia.click(function(){a.btnDetallesPorDia.removeClass("glyphicon-menu-down");a.btnDetallesPorDia.removeClass("glyphicon-menu-up");if(a.divDetallesPorDia.is(":visible")){a.btnDetallesPorDia.addClass("glyphicon-menu-down");a.divDetallesPorDia.hide();a.btnDetallesPorDia.attr("title","Abrir detalles")}else{a.btnDetallesPorDia.attr("title","Cerrar detalles");a.divDetallesPorDia.show();a.btnDetallesPorDia.addClass("glyphicon-menu-up");a.loadDetallesPorDia()}});a.divDetallesPorDia.hide();a.divGridDetallesPorDia.shieldGrid({dataSource:{data:[]},selection:false,noRecordsText:"No hay operaciones para informar",rowHover:false,columns:[]});a.ddlMonedaDetallesPorDia.shieldDropDown({dataSource:{data:[Core.Enums.Currency.Dolares,Core.Enums.Currency.DolaresCable,Core.Enums.Currency.Pesos,Core.Enums.Currency.Euros]},valueTemplate:"{idMoneda}",textTemplate:"{Descripcion}",width:"38%",value:Core.Enums.Currency.DolaresCable.toString(),events:{select:function(c){a.loadDetallesPorDia()}}});a.txtFechaLiquidacionDetallesPorDia.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),events:{change:function(c){a.loadDetallesPorDia()}}});a.btnNuevoDetalle.click(function(){var c={};c.onSave=function(){a.loaded=false;a.loadGrid();a.btnNuevoDetalle.click()};c.overlayElement=a.btnNuevoDetalle;c.pantallaOrigen=Core.Enums.eManagerOperacionPantallaOrigen.Liquidacion;c.origen=Core.Enums.eMesaOperacionOrigen.Operacion;c.onDestroy=function(){a.managerOperacion=null};if(a.managerOperacion!=null){Core.Objects.Context.Dialogs.remove(a.managerOperacion);a.managerOperacion.destroy()}a.managerOperacion=new Core.Controls.ManagerOperacion(c);Core.Objects.Context.Dialogs.push(a.managerOperacion);a.managerOperacion.show()});a.btnAjuste.click(function(){var c={};c.onSave=function(){a.loaded=false;a.loadGrid()};c.origen=Core.Enums.eMesaOperacionOrigen.Ajuste;c.pantallaOrigen=Core.Enums.eManagerOperacionPantallaOrigen.Liquidacion;c.overlayElement=a.btnAjuste;c.onDestroy=function(){a.managerOperacion=null};if(a.managerOperacion!=null){Core.Objects.Context.Dialogs.remove(a.managerOperacion);a.managerOperacion.destroy()}a.managerOperacion=new Core.Controls.ManagerOperacion(c);Core.Objects.Context.Dialogs.push(a.managerOperacion);a.managerOperacion.show()});a.btnTransferencias.click(function(){var c={};c.onSave=function(){a.loaded=false;a.loadGrid()};c.origen=Core.Enums.eMesaOperacionOrigen.Transferencia;c.pantallaOrigen=Core.Enums.eManagerOperacionPantallaOrigen.Liquidacion;c.overlayElement=a.btnTransferencias;c.onDestroy=function(){a.managerOperacion=null};if(a.managerOperacion!=null){Core.Objects.Context.Dialogs.remove(a.managerOperacion);a.managerOperacion.destroy()}a.managerOperacion=new Core.Controls.ManagerOperacion(c);Core.Objects.Context.Dialogs.push(a.managerOperacion);a.managerOperacion.show()});a.btnVentaCompraBonos.click(function(){var c={};c.origen=Core.Enums.eMesaOperacionOrigen.CompraVentaBono;c.pantallaOrigen=Core.Enums.eManagerOperacionPantallaOrigen.Liquidacion;c.overlayElement=a.btnVentaCompraBonos;c.onSave=function(){a.loaded=false;a.loadGrid();a.btnVentaCompraBonos.click()};c.onDestroy=function(){a.managerOperacion=null};if(a.managerOperacion!=null){Core.Objects.Context.Dialogs.remove(a.managerOperacion);a.managerOperacion.destroy()}a.managerOperacion=new Core.Controls.ManagerOperacion(c);Core.Objects.Context.Dialogs.push(a.managerOperacion);a.managerOperacion.show()})};a.loadControls=function(){var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"filtroestados",requestType:"GET"});c.onSuccess=function(d){var e=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"filtroorigenesoperaciones",requestType:"GET"});e.onSuccess=function(f){var g=new Core.Ajax.ServerRequest({allowCache:true,overlayElement:a.overlayElement,showOverlay:true,requestUrl:"tiposcontrapartes",requestType:"GET"});g.onSuccess=function(h){var i=a.ddlEstado.swidget().initialOptions;i.dataSource.data=d.estados;a.ddlEstado.swidget().refresh(i);var j=a.ddlOrigen.swidget().initialOptions;f.origenes.unshift({idOrigen:0,Origen:"TODOS"});j.dataSource.data=f.origenes;a.ddlOrigen.swidget().refresh(j);var k=a.ddlTipoContraparte.swidget().initialOptions;h.tiposcontrapartes.unshift({idTipoContraparte:0,TipoContraparte:"TODOS"});k.dataSource.data=h.tiposcontrapartes;a.ddlTipoContraparte.swidget().refresh(k);a.loadGrid()};g.request()};e.request()};c.request()};a.loadDetallesPorDia=function(){var c;c="idMoneda="+a.ddlMonedaDetallesPorDia.swidget().selectedItem().idMoneda;c+="&Fecha="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtFechaLiquidacionDetallesPorDia.swidget().value()));var d=new Core.Ajax.ServerRequest({overlayElement:a.divDetallesPorDia,showOverlay:true,secureRequest:true,requestUrl:"liquidacion/subtotales",requestType:"GET",requestData:c});d.onSuccess=function(e){var f=a.divGridDetallesPorDia.swidget().initialOptions;f.columns=[{width:"8%",field:"Cuenta",title:"Cuenta",headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"8%",field:"PrimerDiaCompra",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerTemplate:"<div style='text-align:right;'>Liquidación:  </div><div>COMPRAS</div>",headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNumberWithColorRed},{width:"8%",field:"PrimerDiaVenta",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerTemplate:"<div style='text-align:left;'>"+Core.Functions.grid.formatStringDate(e.subtotales[0].FechaLiquidacion.substr(0,10))+"</div><div>VENTAS</div>",headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNumber},{width:"8%",field:"SegundoDiaCompra",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerTemplate:"<div style='text-align:right;'>Liquidación:  </div><div>COMPRAS</div>",headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNumberWithColorRed},{width:"8%",field:"SegundoDiaVenta",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerTemplate:"<div style='text-align:left;'>"+Core.Functions.grid.formatStringDate(e.subtotales[3].FechaLiquidacion.substr(0,10))+"</div><div>VENTAS</div>",headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNumber},{width:"8%",field:"TercerDiaCompra",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerTemplate:"<div style='text-align:right;'>Liquidación:  </div><div>COMPRAS</div>",headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNumberWithColorRed},{width:"8%",field:"TercerDiaVenta",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerTemplate:"<div style='text-align:left;'>"+Core.Functions.grid.formatStringDate(e.subtotales[6].FechaLiquidacion.substr(0,10))+"</div><div>VENTAS</div>",headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNumber},{width:"8%",field:"CuartoDiaCompra",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerTemplate:"<div style='text-align:right;'>Liquidación:  </div><div>COMPRAS</div>",headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNumberWithColorRed},{width:"8%",field:"CuartoDiaVenta",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerTemplate:"<div style='text-align:left;'>"+Core.Functions.grid.formatStringDate(e.subtotales[9].FechaLiquidacion.substr(0,10))+"</div><div>VENTAS</div>",headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNumber}];f.dataSource.data=a.getFormatedData(e.subtotales);a.divGridDetallesPorDia.swidget().refresh(f)};d.request()};a.getFormatedData=function(g){var c=[];var d=$.grep(g,function(i,h){return i.idCuenta==Core.Enums.eVehiculo.BCI});var f=$.grep(g,function(i,h){return i.idCuenta==Core.Enums.eVehiculo.INT});var e=$.grep(g,function(i,h){return i.idCuenta==Core.Enums.eVehiculo.BCV});c.push({Cuenta:"BCI",PrimerDiaVenta:d[0].TotalVenta,SegundoDiaVenta:d[1].TotalVenta,TercerDiaVenta:d[2].TotalVenta,CuartoDiaVenta:d[3].TotalVenta,PrimerDiaCompra:d[0].TotalCompra,SegundoDiaCompra:d[1].TotalCompra,TercerDiaCompra:d[2].TotalCompra,CuartoDiaCompra:d[3].TotalCompra});c.push({Cuenta:"BCV",PrimerDiaVenta:e[0].TotalVenta,SegundoDiaVenta:e[1].TotalVenta,TercerDiaVenta:e[2].TotalVenta,CuartoDiaVenta:e[3].TotalVenta,PrimerDiaCompra:e[0].TotalCompra,SegundoDiaCompra:e[1].TotalCompra,TercerDiaCompra:e[2].TotalCompra,CuartoDiaCompra:e[3].TotalCompra});c.push({Cuenta:"INT",PrimerDiaVenta:f[0].TotalVenta,SegundoDiaVenta:f[1].TotalVenta,TercerDiaVenta:f[2].TotalVenta,CuartoDiaVenta:f[3].TotalVenta,PrimerDiaCompra:f[0].TotalCompra,SegundoDiaCompra:f[1].TotalCompra,TercerDiaCompra:f[2].TotalCompra,CuartoDiaCompra:f[3].TotalCompra});return c};a.loadGrid=function(){var c;c="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));c+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));c+="&idEstadoOperacion="+a.ddlEstado.swidget().selectedItem().idEstadoOperacion;c+="&idOrigenOperacion="+a.ddlOrigen.swidget().selectedItem().idOrigen;c+="&contrapartes="+a.ddlTipoContraparte.swidget().selectedItem().idTipoContraparte;var d=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"operaciones",requestType:"GET",requestData:c});d.onSuccess=function(e){e.operaciones.forEach(function(j,i){if(j.FechaLiquidacion){j.FechaLiquidacion=j.FechaLiquidacion+" 00:00:00.000"}j.FechaOperacion=j.FechaOperacion+" 00:00:00.000";j.Nominales=(j.TipoOperacion=="Venta")?(a.getCantidad(j)*-1):a.getCantidad(j);j.Total=(j.TipoOperacion=="Compra")?(a.getMonto(j)*-1):a.getMonto(j)});var h=a.window.scrollTop();var f=a.divOperaciones.swidget().initialOptions;f.dataSource.data=e.operaciones;f.dataSource.sort=a.divOperaciones.swidget().dataSource.sort;f.dataSource.group=a.divOperaciones.swidget().dataSource.group;var g=a.divOperaciones.swidget().pager.page();f.exportOptions.excel.dataSource.data=e.operaciones;f.exportOptions.excel.readDataSource=true;a.divOperaciones.swidget().refresh(f);a.txtFilterOperaciones.keydown();if(g>1){a.divOperaciones.swidget().pager.page(g)}a.window.scrollTop(h);a.loaded=true};d.request()};a.getCantidad=function(c){if(a.ddlEstado.swidget().selectedItem().idEstadoOperacion==Core.Enums.eEstadoOperacion.Pendiente&&c.idEstadoOperacion==Core.Enums.eEstadoOperacion.ParcialmenteLiquidada){return c.CantidadPendiente}if(a.ddlEstado.swidget().selectedItem().idEstadoOperacion==Core.Enums.eEstadoOperacion.Liquidada&&c.idEstadoOperacion==Core.Enums.eEstadoOperacion.ParcialmenteLiquidada){return c.nominalesLiquidados}return c.Cantidad};a.getMonto=function(c){if(a.ddlEstado.swidget().selectedItem().idEstadoOperacion==Core.Enums.eEstadoOperacion.Pendiente&&c.idEstadoOperacion==Core.Enums.eEstadoOperacion.ParcialmenteLiquidada){return c.MontoPendiente}if(a.ddlEstado.swidget().selectedItem().idEstadoOperacion==Core.Enums.eEstadoOperacion.Liquidada&&c.idEstadoOperacion==Core.Enums.eEstadoOperacion.ParcialmenteLiquidada){return c.MontoLiquidado}return c.Monto};a.loadDetails=function(c,d){var e=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:d,requestUrl:"operaciones/detallecambios/"+c,requestType:"GET"});e.onSuccess=function(h){var j="<table class='table table-striped'>";j+="<thead><tr><th style='width:33%;'>Fecha</th><th style='width:33%;'>Estado Inicial</th><th style='width:33%;'>Estado Final</th></tr></thead>";j+="<tbody>";for(var g=0;g<h.detalleCambiosEstados.length;g++){j+="<tr>";j+="<td>"+h.detalleCambiosEstados[g].fecha.substr(0,16)+" ("+h.detalleCambiosEstados[g].usuario+")</td>";j+="<td>"+h.detalleCambiosEstados[g].estadodesde+"</td>";j+="<td>"+h.detalleCambiosEstados[g].estadohasta+"</td></tr>"}j+="</tbody>";j+="</table>";j+="<table class='table table-striped'>";j+="<thead><tr><th style='width:20%;'>Fecha</th><th style='width:20%;'>Tipo Accion</th><th style='width:60%;'>Contexto</th></tr></thead>";j+="<tbody>";for(var g=0;g<h.detalleCampos.length;g++){j+="<tr>";j+="<td>"+h.detalleCampos[g].fecha.substr(0,16)+"<br />("+h.detalleCampos[g].usuario+")</td>";j+="<td>"+h.detalleCampos[g].tipo+"</td>";j+="<td>"+h.detalleCampos[g].contexto.substr(2,h.detalleCampos[g].contexto.length-2).replace(/\|\|/g,", ");+"</td></tr>"}j+="</tbody>";j+="</table>";var f=new Core.Controls.Dialog("Detalles",j,{displayButtons:{close:true,accept:false}});f.show()};e.request()}};Core.Business.MesaMercadoByma=new function(){var a=this;a.id="mesaMercadoByma";a.divOperacionesContainer=null;a.divOperaciones=null;a.divOperacionDetalles=null;a.lblOperacionDetallesTitle=null;a.gridOperacionDetalles=null;a.btnVolver=null;a.lblTitle=null;a.txtDate=null;a.pageOptions=null;a.btnRefresh=null;a.operacionDetalles=null;a.window=$(window);a.init=function(b,c){Core.loadPage("mesa-mercado-byma.html",function(){document.title="Mercado BYMA";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divOperaciones=$(".div-operaciones");a.divOperacionesContainer=$(".div-operaciones-container");a.divOperacionesContainer.show();a.divOperacionDetalles=$(".div-operacion-detalles");a.divOperacionDetalles.hide();a.lblOperacionDetallesTitle=$(".lbl-title-operacion-detalles");a.gridOperacionDetalles=$(".grid-operacion-detalles");a.btnVolver=$(".btn-operacion-detalles-volver");a.lblTitle=$(".label-title");a.txtDate=$(".date-picker");a.btnRefresh=$(".btn-refresh");a.initGrid();a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.MesaMercadoByma")})};a.initControls=function(){a.btnRefresh.click(function(){a.loadGrid()});a.txtDate.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(b){a.loadGrid()}}});a.btnVolver.click(function(){if(a.gridOperacionDetalles&&a.gridOperacionDetalles.swidget()){a.gridOperacionDetalles.swidget().destroy()}a.divOperacionDetalles.hide();a.divOperacionesContainer.show();a.operacionDetalles=null;$("html, body").animate({scrollTop:0},1000)})};a.initGrid=function(){var b=[{width:"7%",field:"Mercado",title:"Mercado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"4%",field:"horaMercado",title:"Hora Mercado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatStringDateTime},{width:"7%",field:"OperacionesLordOperacionOrigen",title:"Operación Origen",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"7%",field:"OperacionesLordNumeroOperacion",title:"Número Operación",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedIntegerNumber},{width:"4%",field:"OperacionesLordTipoOperacion",title:"OperacionesLordTipoOperacion",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"7%",field:"FechaConcertacion",title:"Fecha Concertación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"7%",field:"FechaLiquidacion",title:"Fecha Liquidación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"7%",field:"MonedaOperacion",title:"Moneda Operación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"7%",field:"TipoOperacion",title:"Tipo Operación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"8%",field:"CodigoEspecie",title:"Código Especie",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"8%",field:"Cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedIntegerNumber},{width:"8%",field:"Precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatPrice},{width:"8%",field:"Monto",title:"Monto",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatPrice},{width:"7%",field:"UsuarioMercado",title:"Usuario Mercado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"4%",field:"Cruzada",title:"Cruzada",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:40,field:"Options",title:" ",headerAttributes:Core.Functions.grid.getCellOddClass(),filterable:false,columnTemplate:function(d,f,e){if(f.EnESCO){var c=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(d);c.on("click",function(){a.operacionDetalles=f;a.showOperacionDetalles()})}}}];a.divOperaciones.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Mercado BYMA",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["Mercado","horaMercado","OperacionesLordOperacionOrigen","OperacionesLordNumeroOperacion","OperacionesLordTipoOperacion","FechaConcertacion","FechaLiquidacion","MonedaOperacion","TipoOperacion","CodigoEspecie","Cantidad","Precio","Monto","UsuarioMercado","Cruzada"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Mercado BYMA"}}},sorting:{multiple:true},columns:b})};a.loadGrid=function(){a.lblTitle.text("Al "+Core.Functions.Date.getDisplayDate(a.txtDate.swidget().value()));var b;b="Fecha="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDate.swidget().value()));b+="&idSistemaOrigenMercado=1";var c=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divOperaciones.parent(),secureRequest:true,requestUrl:"mercado/bymamae",requestType:"GET",requestData:b});c.onSuccess=function(d){var f=a.window.scrollTop();var e=a.divOperaciones.swidget().initialOptions;e.dataSource.data=d.operaciones;e.dataSource.sort=a.divOperaciones.swidget().dataSource.sort;e.exportOptions.excel.dataSource.data=d.operaciones;e.exportOptions.excel.readDataSource=true;a.divOperaciones.swidget().refresh(e);a.window.scrollTop(f)};c.request()};a.showOperacionDetalles=function(){if(a.operacionDetalles){a.lblOperacionDetallesTitle.text("Detalles Operación ID Externo: "+a.operacionDetalles.idExterno);a.initGridOperacionDetalles();a.loadGridOperacionDetalles()}};a.loadGridOperacionDetalles=function(){var b=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"mercado/bymamae/detalle?Fecha="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDate.swidget().value()))+"&idSistemaOrigenMercado=1&idExterno="+a.operacionDetalles.idExterno,requestType:"GET"});b.onSuccess=function(e){var c=e.detalle==null?[]:e.detalle;var d=a.gridOperacionDetalles.swidget().initialOptions;d.dataSource.data=c;a.gridOperacionDetalles.swidget().refresh(d);a.divOperacionDetalles.show();a.divOperacionesContainer.hide();a.loaded=true};b.request()};a.initGridOperacionDetalles=function(){a.gridOperacionDetalles.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:[{width:"20%",field:"NumMinuta",title:"Número Minuta",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedIntegerNumber},{width:"20%",field:"NumBoletoMAE",title:"Número Boleto MAE",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedIntegerNumber},{width:"40%",field:"Descripcion",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"20%",field:"CodCtaCorriente",title:"Código Cuenta Corriente",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedIntegerNumber}]})}};Core.Business.MesaMercadoMae=new function(){var a=this;a.id="mesaMercadoMae";a.divOperacionesContainer=null;a.divOperaciones=null;a.divOperacionDetalles=null;a.lblOperacionDetallesTitle=null;a.gridOperacionDetalles=null;a.btnVolver=null;a.lblTitle=null;a.txtDate=null;a.pageOptions=null;a.btnRefresh=null;a.operacionDetalles=null;a.window=$(window);a.init=function(b,c){Core.loadPage("mesa-mercado-mae.html",function(){document.title="Mercado MAE";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divOperaciones=$(".div-operaciones");a.divOperacionesContainer=$(".div-operaciones-container");a.divOperacionesContainer.show();a.divOperacionDetalles=$(".div-operacion-detalles");a.divOperacionDetalles.hide();a.lblOperacionDetallesTitle=$(".lbl-title-operacion-detalles");a.gridOperacionDetalles=$(".grid-operacion-detalles");a.btnVolver=$(".btn-operacion-detalles-volver");a.lblTitle=$(".label-title");a.txtDate=$(".date-picker");a.btnRefresh=$(".btn-refresh");a.initGrid();a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.MesaMercadoMae")})};a.initControls=function(){a.btnRefresh.click(function(){a.loadGrid()});a.txtDate.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(b){a.loadGrid()}}});a.btnVolver.click(function(){if(a.gridOperacionDetalles&&a.gridOperacionDetalles.swidget()){a.gridOperacionDetalles.swidget().destroy()}a.divOperacionDetalles.hide();a.divOperacionesContainer.show();a.operacionDetalles=null;$("html, body").animate({scrollTop:0},1000)})};a.initGrid=function(){var b=[{width:"7%",field:"Mercado",title:"Mercado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"5%",field:"horaMercado",title:"Hora Mercado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatStringDateTime},{width:"9%",field:"SwpropSecuenciam",title:"Secuencia",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"7%",field:"SwpropNroBoleto",title:"Nro Boleto",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedIntegerNumber},{width:"7%",field:"FechaConcertacion",title:"Fecha Concertación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"7%",field:"FechaLiquidacion",title:"Fecha Liquidación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"7%",field:"MonedaOperacion",title:"Moneda Operación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"7%",field:"TipoOperacion",title:"Tipo Operación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"8%",field:"CodigoEspecie",title:"Código Especie",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"8%",field:"Cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedIntegerNumber},{width:"8%",field:"Precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatPrice},{width:"8%",field:"Monto",title:"Monto",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatPrice},{width:"7%",field:"UsuarioMercado",title:"Usuario Mercado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"5%",field:"Cruzada",title:"Cruzada",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:40,field:"Options",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),filterable:false,columnTemplate:function(d,f,e){if(f.EnESCO){var c=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(d);c.on("click",function(){a.operacionDetalles=f;a.showOperacionDetalles()})}}}];a.divOperaciones.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Mercado MAE",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["Mercado","horaMercado","SwpropSecuenciam","SwpropNroBoleto","FechaConcertacion","FechaLiquidacion","MonedaOperacion","TipoOperacion","CodigoEspecie","Cantidad","Precio","Monto","UsuarioMercado","Cruzada"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Mercado MAE"}}},sorting:{multiple:true},columns:b})};a.loadGrid=function(){a.lblTitle.text("Al "+Core.Functions.Date.getDisplayDate(a.txtDate.swidget().value()));var b;b="Fecha="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDate.swidget().value()));b+="&idSistemaOrigenMercado=2";var c=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divOperaciones.parent(),secureRequest:true,requestUrl:"mercado/bymamae",requestType:"GET",requestData:b});c.onSuccess=function(d){var f=a.window.scrollTop();var e=a.divOperaciones.swidget().initialOptions;e.dataSource.data=d.operaciones;e.dataSource.sort=a.divOperaciones.swidget().dataSource.sort;e.exportOptions.excel.dataSource.data=d.operaciones;e.exportOptions.excel.readDataSource=true;a.divOperaciones.swidget().refresh(e);a.window.scrollTop(f)};c.request()};a.showOperacionDetalles=function(){if(a.operacionDetalles){a.lblOperacionDetallesTitle.text("Detalles Operación ID Externo: "+a.operacionDetalles.idExterno);a.initGridOperacionDetalles();a.loadGridOperacionDetalles()}};a.loadGridOperacionDetalles=function(){var b=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"mercado/bymamae/detalle?Fecha="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDate.swidget().value()))+"&idSistemaOrigenMercado=2&idExterno="+a.operacionDetalles.idExterno,requestType:"GET"});b.onSuccess=function(e){var c=e.detalle==null?[]:e.detalle;var d=a.gridOperacionDetalles.swidget().initialOptions;d.dataSource.data=c;a.gridOperacionDetalles.swidget().refresh(d);a.divOperacionDetalles.show();a.divOperacionesContainer.hide();a.loaded=true};b.request()};a.initGridOperacionDetalles=function(){a.gridOperacionDetalles.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:[{width:"20%",field:"NumMinuta",title:"Número Minuta",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedIntegerNumber},{width:"20%",field:"NumBoletoMAE",title:"Número Boleto MAE",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedIntegerNumber},{width:"40%",field:"Descripcion",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"20%",field:"CodCtaCorriente",title:"Código Cuenta Corriente",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedIntegerNumber}]})}};Core.Business.MesaMinutasPendientes=new function(){var a=this;var b=30000;a.id="mesaMinutasPendientes";a.divMesaMinutas=null;a.lblTitle=null;a.txtDateFrom=null;a.txtDateTo=null;a.txtFilter=null;a.chkMesaPendientes=null;a.timeout=null;a.loaded=false;a.timerId=null;a.stopTimmer=false;a.btnBolsa=null;a.txtFilter=null;a.ddlEquipo=null;a.timeout=null;a.btnRefresh=null;a.managerOperacion=null;a.window=$(window);a.init=function(c,d){Core.loadPage("mesa-minutas-pendientes.html",function(){document.title="Mesa Minutas";a.divMesaMinutas=$(".div-mesa-minutas");a.lblTitle=$(".label-title");a.txtFilter=$(".textbox-filter");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.ddlEquipo=$(".dropdown-equipo");a.btnBolsa=$(".btn-bolsa");a.btnRefresh=$(".btn-refresh");a.chkMesaPendientes=$(".checkbox-mesa-pendientes");a.initGrid();a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,c,d,function(){a.loaded=false;a.loadControls()},"Core.Business.MesaMinutasPendientes");a.timerId=window.setInterval(function(){if(a.loaded&&!a.stopTimmer){a.loadGrid()}},b);Core.Objects.Context.Timers.push(a.timerId)})};a.initControls=function(){a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var c=a.divMesaMinutas.swidget().dataSource;if(value){c.filter={or:[{path:"usuarioingreso",filter:"contains",value:value},{path:"descripcion",filter:"contains",value:value},{path:"moneda",filter:"contains",value:value},{path:"especie",filter:"contains",value:value},{path:"corredor",filter:"contains",value:value}]}}else{c.filter=null}c.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.MesaMinutasPendientes.txtFilter");a.btnBolsa.click(function(){var c={};c.intencionalidadDefault=Core.Enums.eMesaIntencionalidad.Paridad;c.onSave=function(){a.loaded=false;a.loadGrid();a.btnBolsa.click()};c.onDestroy=function(){a.managerOperacion=null};c.overlayElement=a.btnBolsa;if(a.managerOperacion!=null){Core.Objects.Context.Dialogs.remove(a.managerOperacion);a.managerOperacion.destroy()}a.managerOperacion=new Core.Controls.ManagerMinuta(c);Core.Objects.Context.Dialogs.push(a.managerOperacion);a.managerOperacion.show()});a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loaded=false;a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loaded=false;a.loadGrid()}}});a.btnRefresh.on("click",function(){a.loaded=false;a.loadGrid()});a.chkMesaPendientes.on("change",function(){a.loaded=false;a.loadGrid()})};a.initGrid=function(){a.divMesaMinutas.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:[{field:"id",title:"ID",width:"4%",headerAttributes:Core.Functions.grid.getCellOddClass()},{field:"fechaohora",title:"Fecha",width:"8%",headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"fechaLiquidacion",title:"Liquidación",width:"8%",headerAttributes:Core.Functions.grid.getCellOddClass()},{field:"usuarioingreso",title:"Solicita",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"mercado",title:"Mercado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getCellOddClass()},{field:"numcomitente",title:"Comitente",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"7%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getCellEvenClass()},{title:"Descr.",width:"6%",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(c,d,e){if(d.descripcion){var f=(d.length>140)?(d.descripcion.substr(0,140)+"..."):(d.descripcion);c.html('<button type="button" title="'+f+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-search"></span></button>');c.addClass("link-cell");c.on("click",function(){var g=new Core.Controls.Dialog("Descripción",(d.descripcion)?d.descripcion:"",{displayButtons:{close:true,accept:false}});g.show()})}}},{field:"operacion",title:"Tipo",width:"8%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"moneda",title:"Moneda",width:"8%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{field:"especie",title:"Ticker",width:"8%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatPrice},{field:"precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatPrice},{field:"monto",title:"Monto",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatPrice},{field:"plazo",title:"Plazo",width:"8%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{title:"Precio Ref.",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(c,d,e){c.text(Core.Functions.grid.formatPrice(d.precioReferencia));c.addClass("link-cell");c.on("click",function(){a.stopTimmer=true;c.text("");var f=$('<input id="txt-update-precio-referencia" type="text";" />').appendTo(c);f.shieldNumericTextBox({cls:"numeric-input-right",min:0,step:1e-06,max:999999999,spinners:false,value:d.precioReferencia,events:{change:function(g){var h=new Core.Ajax.ServerRequest({overlayElemet:a.divMesaMinutas.parent(),secureRequest:true,requestUrl:"minutas",requestType:"PUT",requestData:{minuta:{id:d.id,precioReferencia:g.value}}});h.onSuccess=function(j){var i=new Core.Controls.Dialog("Mensaje","El precio de referencia ha sido modificado correctamente.",{displayButtons:{close:true,accept:false}});i.show()};h.request()},blur:function(){a.loaded=false;a.loadGrid();a.stopTimmer=false}}}).swidget().focus()})}},{field:"diferenciaPrecios",title:"Diferencia",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{title:"Obs.",width:"5%",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(c,d,e){if(d.observacion){var f=(d.length>140)?(d.observacion.substr(0,140)+"..."):(d.observacion);c.html('<button type="button" title="'+f+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');c.addClass("link-cell");c.on("click",function(){var g=new Core.Controls.Dialog("Observaciones",(d.observacion)?d.observacion:"",{displayButtons:{close:true,accept:false}});g.show()})}}},{field:"usuariooperador",title:"Operador",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"estado",title:"Estado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getCellOddClass()},{field:"escruce",title:"Cruce",width:"6%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatStringBoolean},{field:"corredor",title:"Corredor",width:"8%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{field:"comision",title:"Comisión",width:"7%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatStringBoolean},{field:"",title:" ",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:180,headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(i,j,k){i.parent().css("background-color","rgba("+a.hexToRgb(j.color)+((k%2==0)?", 0.6":", 1 ")+")");if(j.botonVerDetalle){var e=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(i);e.on("click",function(){new Core.Business.MesaMinutasPendientes.Detalle({minuta:j,readOnly:true}).show()})}if(j.botonActualizar){var f=$('<button type="button" title="Editar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(i);f.on("click",function(){new Core.Business.MesaMinutasPendientes.Detalle({minuta:j,readOnly:false,onSave:function(){a.loadGrid()}}).show()})}if(j.botonAprobar){var g=$('<button style="background-color:green; border-color:green;" type="button" title="Validar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-ok"></span></button>').appendTo(i);g.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea validar el precio de la minuta con ID: "+j.id+"?",{onAccepted:function(){var l={idMinuta:j.id,NuevoEstado:j.NuevoEstadoAprobacion};var m=new Core.Ajax.ServerRequest({overlayElemet:g,secureRequest:true,requestUrl:"minutas/nuevoestado",requestType:"POST",requestData:l});m.onSuccess=function(o){var n=new Core.Controls.Dialog("Mensaje",((o.Descripcion)?o.Descripcion:"Minuta: "+j.id+" actualizada OK."),{displayButtons:{close:true,accept:false}});n.show();a.loadGrid()};m.request()}}).show()})}if(j.botonRechazar){var c=$('<button style="background-color:red; border-color:red;" type="button" title="Anular" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(i);c.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea anular el precio de la minuta con ID: "+j.id+"?",{onAccepted:function(){var l={idMinuta:j.id,NuevoEstado:j.NuevoEstadoRechazo};var m=new Core.Ajax.ServerRequest({overlayElemet:c,secureRequest:true,requestUrl:"minutas/nuevoestado",requestType:"POST",requestData:l});m.onSuccess=function(o){var n=new Core.Controls.Dialog("Mensaje",((o.Descripcion)?o.Descripcion:"Minuta: "+j.id+" actualizada OK."),{displayButtons:{close:true,accept:false}});n.show();a.loadGrid()};m.request()}}).show()})}if(j.botonAprobarActualizar){var h=$('<button style="background-color:green; border-color:green;" type="button" title="Validar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-ok"></span></button>').appendTo(i);h.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea validar el precio de la minuta con ID: "+j.id+"?",{onAccepted:function(){var l={id:j.id,estado:j.NuevoEstadoAprobacionActualizar};var m=new Core.Ajax.ServerRequest({overlayElemet:h,secureRequest:true,requestUrl:"minutas",requestType:"PUT",requestData:l});m.onSuccess=function(o){var n=new Core.Controls.Dialog("Mensaje",((o.Descripcion)?o.Descripcion:"Minuta: "+j.id+" actualizada OK."),{displayButtons:{close:true,accept:false}});n.show();a.loadGrid()};m.request()}}).show()})}if(j.botonRechazarActualizar){var d=$('<button style="background-color:red; border-color:red;" type="button" title="Anular" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(i);d.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea anular el precio de la minuta con ID: "+j.id+"?",{onAccepted:function(){var l={id:j.id,estado:j.NuevoEstadoRechazoActualizar};var m=new Core.Ajax.ServerRequest({overlayElemet:d,secureRequest:true,requestUrl:"minutas",requestType:"PUT",requestData:l});m.onSuccess=function(o){var n=new Core.Controls.Dialog("Mensaje",((o.Descripcion)?o.Descripcion:"Minuta: "+j.id+" actualizada OK."),{displayButtons:{close:true,accept:false}});n.show();a.loadGrid()};m.request()}}).show()})}}}],toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Minutas",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["id","fechaohora","fechaLiquidacion","usuarioingreso","mercado","numcomitente","descripcion","operacion","moneda","especie","cantidad","precio","monto","plazo","precioReferencia","diferenciaPrecios","observacion","usuariooperador","estado","escruce","corredor","comision"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Minutas"}}}})};a.loadControls=function(){var c=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"equipos/2",requestType:"GET"});c.onSuccess=function(d){a.ddlEquipo.shieldDropDown({dataSource:{data:d.equipos},valueTemplate:"{idEquipo}",textTemplate:"{Equipo}",width:250,events:{select:function(e){a.loaded=false;a.loadGrid()}}});a.loadGrid()};c.request()};a.loadGrid=function(){a.lblTitle.text("Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var c="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));c+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));var d=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,overlayElement:a.divMesaMinutas.parent(),secureRequest:true,requestUrl:"minutas/pendientes/"+a.ddlEquipo.swidget().selectedItem().idEquipo,requestType:"GET",requestData:c});d.onSuccess=function(f){if(a.chkMesaPendientes[0].checked){f.data=$.grep(f.data,function(i,h){return i.pendientesMesa==1})}f.data.sort(function(h,i){if(h.idOrdenamiento<i.idOrdenamiento){return -1}else{if(h.idOrdenamiento>i.idOrdenamiento){return 1}else{return 0}}});var g=a.window.scrollTop();var e=a.divMesaMinutas.swidget().initialOptions;e.dataSource.data=f.data;e.dataSource.group=a.divMesaMinutas.swidget().dataSource.group;e.exportOptions.excel.dataSource.data=f.data;e.exportOptions.excel.readDataSource=true;a.divMesaMinutas.swidget().refresh(e);a.window.scrollTop(g);a.loaded=true;a.txtFilter.keydown()};d.request()};a.hexToRgb=function(d){d=d.replace("#","");var f=parseInt(d.substring(0,2),16);var e=parseInt(d.substring(2,4),16);var c=parseInt(d.substring(4,6),16);var h=f+","+e+","+c;return h}};Core.Business.MesaMinutasPendientes.Detalle=function(b){var a=this;a.divModal=$(".div-detalle-minuta");a.lblTitle=null;a.lblFechaAlta=null;a.lblIngreso=null;a.lblAsesor=null;a.lblOperador=null;a.lblUltimaActualizacion=null;a.lblEstado=null;a.lblMercado=null;a.lblComitente=null;a.lblMoneda=null;a.lblFechaConcertacion=null;a.divFechaLiquidacion=null;a.lblFechaLiquidacion=null;a.lblDescripcionComitente=null;a.lblTipo=null;a.divTicker=null;a.lblTicker=null;a.divPlazo=null;a.lblPlazo=null;a.divCantidad=null;a.lblCantidad=null;a.divPrecioReferencia=null;a.txtPrecioReferencia=null;a.divPrecio=null;a.lblPrecio=null;a.lblMonto=null;a.divCorredor=null;a.ddlCorredor=null;a.chkComision=null;a.divComision=null;a.divCruce=null;a.chkCruce=null;a.divIdExterno=null;a.txtIdExterno=null;a.divCantidadDias=null;a.lblCantidadDias=null;a.divTasa=null;a.lblTasa=null;a.txtObservaciones=null;a.minuta=null;a.readOnly=true;a.onSave=function(){};$.extend(true,a,b);a.show=function(){var c=new Core.Ajax.ServerRequest({allowCache:true,overlayElement:a.overlayElement,showOverlay:true,requestUrl:"corredores",requestType:"GET"});c.onSuccess=function(d){a.lblTitle=a.divModal.find(".title");a.lblTitle.text("Detalles Minuta: "+a.minuta.id);a.lblFechaAlta=a.divModal.find(".label-minuta-fecha-alta");a.lblIngreso=a.divModal.find(".label-minuta-ingreso");a.lblAsesor=a.divModal.find(".label-minuta-asesor");a.lblOperador=a.divModal.find(".label-minuta-operador");a.lblUltimaActualizacion=a.divModal.find(".label-minuta-ultima-actualizacion");a.lblEstado=a.divModal.find(".label-minuta-estado");a.lblMercado=a.divModal.find(".label-minuta-mercado");a.lblComitente=a.divModal.find(".label-minuta-comitente");a.lblMoneda=a.divModal.find(".label-minuta-moneda");a.lblFechaConcertacion=a.divModal.find(".label-minuta-fecha-concertacion");a.divFechaLiquidacion=a.divModal.find(".div-minuta-fecha-liquidacion");a.lblFechaLiquidacion=a.divModal.find(".label-minuta-fecha-liquidacion");a.lblDescripcionComitente=a.divModal.find(".label-minuta-descripcion-comitente");a.lblTipo=a.divModal.find(".label-minuta-tipo");a.divTicker=a.divModal.find(".div-minuta-ticker");a.lblTicker=a.divModal.find(".label-minuta-ticker");a.divPlazo=a.divModal.find(".div-minuta-plazo");a.lblPlazo=a.divModal.find(".label-minuta-plazo");a.divCantidad=a.divModal.find(".div-minuta-cantidad");a.lblCantidad=a.divModal.find(".label-minuta-cantidad");a.divPrecio=a.divModal.find(".div-minuta-precio");a.lblPrecio=a.divModal.find(".label-minuta-precio");a.divPrecioReferencia=a.divModal.find(".div-minuta-precio-referencia");a.txtPrecioReferencia=a.divModal.find(".textbox-minuta-precio-referencia");a.lblMonto=a.divModal.find(".label-minuta-monto");a.divCorredor=a.divModal.find(".div-minuta-corredor");a.ddlCorredor=a.divModal.find(".dropdown-minuta-corredor");a.divComision=a.divModal.find(".div-minuta-comision");a.chkComision=a.divModal.find(".checkbox-minuta-comision");a.divCruce=a.divModal.find(".div-minuta-cruce");a.chkCruce=a.divModal.find(".checkbox-minuta-cruce");a.divIdExterno=a.divModal.find(".div-minuta-id-externo");a.txtIdExterno=a.divModal.find(".textbox-minuta-id-externo");a.divCantidadDias=a.divModal.find(".div-minuta-cantidad-dias");a.lblCantidadDias=a.divModal.find(".label-minuta-cantidad-dias");a.divTasa=a.divModal.find(".div-minuta-tasa");a.lblTasa=a.divModal.find(".label-minuta-tasa");a.txtObservaciones=a.divModal.find(".textbox-minuta-observaciones");a.lblFechaAlta.text((a.minuta.fechaAlta)?a.minuta.fechaAlta:"");a.lblIngreso.text((a.minuta.usuarioingreso)?a.minuta.usuarioingreso:"");a.lblAsesor.text((a.minuta.usuarioasesor)?a.minuta.usuarioasesor:"");a.lblOperador.text((a.minuta.usuariooperador)?a.minuta.usuariooperador:"");a.lblUltimaActualizacion.text((a.minuta.fechaultimaactualizacion)?a.minuta.fechaultimaactualizacion:"");a.lblEstado.text((a.minuta.estado)?a.minuta.estado:"");a.lblMercado.text((a.minuta.mercado)?a.minuta.mercado:"");a.lblComitente.text((a.minuta.numcomitente)?Core.Functions.grid.formatIntegerNumber(a.minuta.numcomitente):"");a.lblMoneda.text((a.minuta.moneda)?a.minuta.moneda:"");a.lblFechaConcertacion.text((a.minuta.fechaohora)?a.minuta.fechaohora:"");a.lblFechaLiquidacion.text((a.minuta.fechaLiquidacion)?a.minuta.fechaLiquidacion:"");a.lblDescripcionComitente.text((a.minuta.descripcioncomitente)?a.minuta.descripcioncomitente:"");a.lblTipo.text((a.minuta.operacion)?a.minuta.operacion:"");a.lblTicker.text((a.minuta.especie)?a.minuta.especie:"");a.lblPlazo.text((a.minuta.plazo)?a.minuta.plazo:"");a.lblCantidad.text((a.minuta.cantidad)?Core.Functions.grid.formatPrice(a.minuta.cantidad):"");new Core.Controls.DecimalPicker(a.txtPrecioReferencia,{maxDecimalDigitCount:10,showThousandsSeparator:true,defaultValue:(a.minuta.precioReferencia)?a.minuta.precioReferencia:""});a.txtPrecioReferencia.removeAttr("disabled");if(a.readOnly){a.txtPrecioReferencia.attr("disabled","disabled")}a.lblPrecio.text((a.minuta.precio)?Core.Functions.grid.formatPrice(a.minuta.precio):"");a.lblMonto.text((a.minuta.monto)?Core.Functions.grid.formatPrice(a.minuta.monto):"");a.lblTasa.text((a.minuta.TasaPrestamo)?Core.Functions.grid.formatPrice(a.minuta.TasaPrestamo):"");a.lblCantidadDias.text((a.minuta.CantidadDiasPrestamo)?Core.Functions.grid.formatIntegerNumber(a.minuta.CantidadDiasPrestamo):"");d.corredores.unshift({idCorredor:0,Descripcion:"Sin Corredor"});a.ddlCorredor.shieldDropDown({dataSource:{data:d.corredores},textTemplate:"{Descripcion}",valueTemplate:"{idCorredor}",value:(a.minuta&&a.minuta.idcorredor!=null)?a.minuta.idcorredor.toString():"",enabled:!a.readOnly,events:{select:function(e){a.setControlsByCorredor()}}});a.chkComision.shieldCheckBox({label:"",enabled:!a.readOnly});a.chkComision.swidget().checked(((a.minuta&&a.minuta.comision!=null)?(a.minuta.comision==1):true));a.chkCruce.shieldCheckBox({label:"",enabled:!a.readOnly});a.chkCruce.swidget().checked(((a.minuta&&a.minuta.escruce!=null)?(a.minuta.escruce==1):true));a.txtIdExterno.shieldTextBox({enabled:!a.readOnly,value:(a.minuta&&a.minuta.codMercadoExterno!=null)?a.minuta.codMercadoExterno:""});a.txtObservaciones.shieldTextBox({enabled:!a.readOnly,value:(a.minuta&&a.minuta.observacion!=null)?a.minuta.observacion:""});a.setControlsByMercado();a.setControlsByCorredor();a.btnConfirmar=a.divModal.find(".btn-confirmar");a.btnConfirmar.show();if(a.readOnly){a.btnConfirmar.hide()}a.btnConfirmar.unbind("click");a.btnConfirmar.click(function(){var e={id:a.minuta.id,idcorredor:((a.ddlCorredor.swidget().selectedItem())?a.ddlCorredor.swidget().selectedItem().idCorredor:0),comision:((a.ddlCorredor.swidget().selectedItem()&&a.ddlCorredor.swidget().selectedItem().idCorredor&&a.chkComision.swidget().checked())?1:0),codMercadoExterno:a.txtIdExterno.val(),observacion:a.txtObservaciones.val(),escruce:(a.chkCruce.swidget().checked())?1:0};if(a.txtPrecioReferencia.val()){e.precioReferencia=Core.Functions.Decimal.parseFloat(a.txtPrecioReferencia.val())}var f=new Core.Ajax.ServerRequest({overlayElement:a.btnConfirmar,showOverlay:true,requestUrl:"minutas",requestType:"PUT",requestData:e});f.onSuccess=function(g){a.divModal.modal("hide");a.onSave()};f.request()});a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.divModal.modal({show:true})};c.request()};a.setControlsByCorredor=function(){if(a.ddlCorredor.swidget().selectedItem()&&a.ddlCorredor.swidget().selectedItem().idCorredor!=0){a.divComision.show()}else{a.divComision.hide()}};a.setControlsByMercado=function(){a.divFechaLiquidacion.show();a.divTicker.show();a.divPlazo.show();a.divCantidad.show();a.divPrecio.show();a.divPrecioReferencia.show();a.divCorredor.show();a.divComision.show();a.divCruce.show();a.divIdExterno.show();a.divTasa.hide();a.divCantidadDias.hide();if(a.minuta.idMercado==Core.Enums.eMinutaMercado.Privado){a.divCorredor.hide();a.divComision.hide();a.divCruce.hide();a.divIdExterno.hide()}if(a.minuta.idMercado==Core.Enums.eMinutaMercado.PrestamoEfectivo){a.divTasa.show();a.divCantidadDias.show();a.divFechaLiquidacion.hide();a.divTicker.hide();a.divPlazo.hide();a.divCantidad.hide();a.divPrecio.hide();a.divPrecioReferencia.hide();a.divCorredor.hide();a.divComision.hide();a.divCruce.hide();a.divIdExterno.hide()}};a.destroy=function(){a.ddlCorredor.swidget().destroy();a.chkCruce.swidget().destroy();a.chkComision.swidget().destroy();a.txtIdExterno.swidget().destroy();a.txtObservaciones.swidget().destroy()}};Core.Business.MesaMinutasResumen=new function(){var a=this;a.id="mesaMinutasResumen";a.pageOptions=null;a.divResumenMinutas=null;a.lblTitle=null;a.txtDateFrom=null;a.txtDateTo=null;a.btnNueva=null;a.init=function(b,c){Core.loadPage("mesa-minutas-resumen.html",function(){document.title="Resumen Minutas";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divResumenMinutas=$(".div-resumen-minutas");a.lblTitle=$(".label-title");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.btnNueva=$(".btn-nueva-minuta");a.btnNueva.on("click",function(){Core.Business.MesaNuevaMinutas.init(b,c)});a.initDatePickers();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.MesaMinutasResumen")})};a.initDatePickers=function(){a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(b){a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(b){a.loadGrid()}}})};a.initGrid=function(){var b=[];b.push({field:"fechaAlta",title:"Fecha Alta",width:"7%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"usuarioIngreso",title:"Usuario Ingreso",width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"usuarioOperador",title:"Operador",width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"numComitente",title:"Comitente",width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"descripcionComitente",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"20%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"operacion",title:"Tipo de Operación",width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"mercado",title:"Mercado",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"plazo",title:"Plazo",width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"moneda",title:"Moneda",width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"especie",title:"Especie",width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumber});b.push({field:"precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNuleablePrice});b.push({field:"precioReferencia",title:"Precio Referencia",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNuleablePrice});if(!Core.Objects.Context.Configuration.idAplicacion){b.push({field:"Precio2",title:"Precio Productor",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNuleablePrice})}b.push({field:"estado",title:"Estado",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"idordencambio",title:"Orden",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({field:"numsecienciacambio",title:"Secuencia",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({title:" ",width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(e,f,g){var c=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(e);c.on("click",function(){var h=new Core.Ajax.ServerRequest({requestUrl:"minutas/detalle/"+f.idMinuta,requestType:"GET"});h.onSuccess=function(o){var p="<table class='table table-striped'>";p+="<thead><tr><th>Fecha</th><th>Tipo Acción</th><th>Operador</th><th>Contexto</th></tr></thead>";p+="<tbody>";for(var m=0;m<o.detalle.length;m++){p+="<tr>";p+="<td>"+o.detalle[m].fecha+"</td>";p+="<td>"+o.detalle[m].tipo+"</td>";p+="<td>"+o.detalle[m].nombre+"</td>";var k=o.detalle[m].contexto.split("||");p+="<td>";for(var n=0;n<k.length;n++){p+=k[n]+((n<k.length-1)?"<br/>":"")}p+="</td>"}p+="</tbody>";p+="</table>";var l=new Core.Controls.Dialog("Detalles",p,{displayButtons:{close:true,accept:false}});l.show()};h.request()});if(a.pageOptions.actualizarMinutasPrecioProductor&&f.actualizarPrecio2){var d=$('<button type="button" title="Modificar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(e);d.on("click",function(){new Core.Controls.Prompt("Precio de Referencia Productor","Ingrese el nuevo Precio de Referencia Productor",{defaultValue:f.Precio2,allowEmptyText:true,onAccepted:function(i){var h=(i!="")?Core.Functions.Decimal.parseFloat(i):null;var j={data:{id:f.idMinuta,PrecioProductor:h}};var k=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"minutas/precioproductor",requestType:"PUT",requestData:j});k.onSuccess=function(l){a.loadGrid()};k.request()}}).show()})}}});a.divResumenMinutas.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Resumen Minutas",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["fechaAlta","fechaLiquidacion","usuarioIngreso","usuarioOperador","numComitente","descripcionComitente","operacion","mercado","plazo","moneda","especie","cantidad","precio","precioReferencia","estado","observaciones","idordencambio","numsecienciacambio"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"resumen-minutas"}}},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},grouping:{showGroupHeader:true,allowDragToGroup:true,message:"Arrastre un encabezado de columna para agrupar por esa columna"},columns:b})};a.loadGrid=function(){a.lblTitle.text("Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var b;b="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));b+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));var c=new Core.Ajax.ServerRequest({overlayElement:a.divResumenMinutas.parent(),secureRequest:true,requestUrl:"minutas/resumen",requestType:"GET",requestData:b});c.onSuccess=function(d){var e=a.divResumenMinutas.swidget().initialOptions;e.dataSource.data=d;e.dataSource.schema={data:"minutas"};e.dataSource.group=[{field:"estado",order:"asc"}];e.exportOptions.excel.dataSource.data=d;e.exportOptions.excel.dataSource.schema={data:"minutas"};e.exportOptions.excel.readDataSource=true;a.divResumenMinutas.swidget().refresh(e)};c.request()}};Core.Business.MesaNuevaMinutas=new function(){var a=this;a.decimalCount=8;a.pageOptions=null;a.id="insertarMinutaMesa";a.txtBuscarCuentas=null;a.btnBuscarCuentas=null;a.lblComitente=null;a.txtDate=null;a.ddlMercado=null;a.ddlAccounts=null;a.ddlTipoOperacion=null;a.ddlEspecie=null;a.ddlPlazo=null;a.ddlMoneda=null;a.txtCantidadNominales=null;a.divPrecio=null;a.divPrecioReferencia=null;a.txtPrecio=null;a.txtPrecioReferencia=null;a.lblTotalOperacion=null;a.lblUltimoPrecio=null;a.lblVariacion=null;a.lblMejorOfertaCompra=null;a.lblMejorOfertaVenta=null;a.txtObservaciones=null;a.ddlCorredores=null;a.divAplicaComisionesCorredor=null;a.chkAplicaComisionesCorredor=null;a.btnSend=null;a.init=function(b,c){Core.loadPage("mesa-nueva-minuta.html",function(){document.title="Minutas";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadTabs,"Core.Business.MesaNuevaMinutas")})};a.initControls=function(){a.txtBuscarCuentas=$(".text-buscar-cuentas");a.txtBuscarCuentas.shieldTextBox({});a.btnBuscarCuentas=$(".button-buscar-cuentas");a.btnBuscarCuentas.on("click",function(){a.setAccounts()});a.lblComitente=$(".label-comitente");a.txtDate=$(".date-picker-date");a.txtDate.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),});a.ddlMercado=$(".dropdown-mercado");a.ddlMercado.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{idMercado}",value:(Core.Objects.Context.Parameters.ConfigMinutasMercadoDefault)?Core.Objects.Context.Parameters.ConfigMinutasMercadoDefault.toString():Core.Enums.eMinutaMercado.Merval.toString()});a.ddlAccounts=$(".dropdown-minutas-accounts");a.ddlAccounts.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idCuenta}",textTemplate:"{idCuenta} | {Descripcion} (Comitente: {NumComitente})",enabled:true,autoComplete:{enabled:true,filter:{and:[{path:"Descripcion",filter:"contains",value:""}]}},events:{select:function(c){a.lblComitente.text("Comitente Nº "+c.item.NumComitente+" | "+c.item.Descripcion)},focus:function(c){var d=a.ddlAccounts.swidget().initialOptions;d.value="";a.ddlAccounts.swidget().refresh(d);a.ddlAccounts.swidget().focus()}}});a.ddlTipoOperacion=$(".dropdown-tipo-operacion");a.ddlTipoOperacion.shieldDropDown({dataSource:{data:[{value:Core.Enums.eMinutaTipoOperacion.Compra,text:"Compra"},{value:Core.Enums.eMinutaTipoOperacion.Venta,text:"Venta"}]},textTemplate:"{text}",valueTemplate:"{value}"});a.ddlMoneda=$(".dropdown-moneda");a.ddlMoneda.shieldDropDown({dataSource:{data:[Core.Enums.Currency.Pesos,Core.Enums.Currency.Dolares,Core.Enums.Currency.DolaresCable]},textTemplate:"{Descripcion}",valueTemplate:"{idMoneda}",events:{select:function(c){a.setLabelsByEspecie()}}});a.ddlEspecie=$(".dropdown-especie");a.ddlEspecie.shieldComboBox({dataSource:{data:[]},valueTemplate:"{Ticker}",textTemplate:"{DisplayTicker} | {Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}},events:{change:function(c){a.setLabelsByEspecie()},focus:function(c){var d=a.ddlEspecie.swidget().initialOptions;d.value="";a.ddlEspecie.swidget().refresh(d);a.ddlEspecie.swidget().focus()}}});a.ddlPlazo=$(".dropdown-plazo");a.ddlPlazo.shieldDropDown({dataSource:{data:[{value:Core.Enums.ePlazo.CI,text:"CI"},{value:Core.Enums.ePlazo.D24,text:"24 hs."},{value:Core.Enums.ePlazo.D48,text:"48 hs."}]},textTemplate:"{text}",valueTemplate:"{value}",value:((a.pageOptions&&a.pageOptions.plazoDefault)?a.pageOptions.plazoDefault.toString():"")});a.txtCantidadNominales=$(".textbox-cantidad-nominales");new Core.Controls.DecimalPicker(a.txtCantidadNominales,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onChange:a.setTotalOperacion});a.divPrecio=$(".div-precio");a.txtPrecio=$(".textbox-precio");new Core.Controls.DecimalPicker(a.txtPrecio,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onChange:function(){b.setValue(a.txtPrecio.val());a.setTotalOperacion()}});a.divPrecioReferencia=$(".div-precio-referencia");a.txtPrecioReferencia=$(".textbox-precio-referencia");var b=new Core.Controls.DecimalPicker(a.txtPrecioReferencia,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onChange:a.setTotalOperacion});a.txtPrecioReferencia.attr("disabled","disabled");a.lblTotalOperacion=$(".label-total-operacion");a.lblUltimoPrecio=$(".label-ultimo-precio");a.lblVariacion=$(".label-variacion");a.lblMejorOfertaCompra=$(".label-mejor-oferta-compra");a.lblMejorOfertaVenta=$(".label-mejor-oferta-venta");a.divAplicaComisionesCorredor=$(".div-aplica-comisiones-corredor");a.divAplicaComisionesCorredor.hide();a.chkAplicaComisionesCorredor=$(".checkbox-aplica-comisiones-corredor");a.chkAplicaComisionesCorredor[0].checked=true;a.ddlCorredores=$(".dropdown-corredores");a.ddlCorredores.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{idCorredor}",value:"",events:{select:function(c){if(a.ddlCorredores.swidget().selectedItem()&&a.ddlCorredores.swidget().selectedItem().idCorredor!=0){a.divAplicaComisionesCorredor.show()}else{a.divAplicaComisionesCorredor.hide()}}}});a.txtObservaciones=$(".text-observaciones");a.txtObservaciones.shieldTextBox({});a.btnSend=$(".btn-send");a.btnSend.click(function(){a.validData(a.send)})};a.loadTabs=function(){a.setMercados();a.setCorredores();a.setEspecies()};a.setMercados=function(){var b=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"mercados",requestType:"GET",requestData:{idAplicacion:6,idFuncionalidad:1}});b.onSuccess=function(d){var c=a.ddlMercado.swidget().initialOptions;c.dataSource.data=d.mercados;a.ddlMercado.swidget().refresh(c)};b.request()};a.setCorredores=function(){var b=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"corredores",requestType:"GET"});b.onSuccess=function(d){d.corredores.unshift({idCorredor:0,Descripcion:"Sin Corredor"});var c=a.ddlCorredores.swidget().initialOptions;c.dataSource.data=d.corredores;a.ddlCorredores.swidget().refresh(c)};b.request()};a.setAccounts=function(){if(a.txtBuscarCuentas.val()){var b=new Core.Ajax.ServerRequest({overlayElement:a.btnBuscarCuentas,showOverlay:true,secureRequest:true,requestUrl:"cuentas/numdescripcion/"+a.txtBuscarCuentas.val(),requestType:"GET"});b.onSuccess=function(d){var c=a.ddlAccounts.swidget().initialOptions;c.dataSource.data=d.cuentas;a.ddlAccounts.swidget().refresh(c)};b.request()}};a.setEspecies=function(d){var b={};b.panel=Core.Enums.ePanel.BonosFull;var c=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,allowCache:true,secureRequest:true,requestUrl:"especies",requestType:"GET",requestData:b});c.onSuccess=function(g){var e=g.especies==null?[]:g.especies;e=$.grep(e,function(i,h){return i.idMoneda==Core.Enums.Currency.Pesos.idMoneda});var f=a.ddlEspecie.swidget().initialOptions;f.dataSource.data=e;a.ddlEspecie.swidget().refresh(f);a.setLabelsByEspecie()};c.request()};a.setTotalOperacion=function(){if(a.txtCantidadNominales.val()!=""&&a.txtPrecio.val()!=""){a.lblTotalOperacion.text(Core.Functions.grid.formatNumber((parseFloat(a.txtCantidadNominales.val())*parseFloat(a.txtPrecio.val())).toFixed(6)))}};a.setLabelsByEspecie=function(){var c=function(f,h){var e="field-var";if(h!=null&&h.length>1){var g=h.substr(0,1);if(g=="+"){e="field-varpositiva"}if(g=="-"){e="field-varnegativa"}}f.removeClass("field-var field-varpositiva field-varnegativa").addClass(e)};var b={};b.ticker=a.ddlEspecie.swidget().value();b.plazo=a.ddlPlazo.swidget().value();b.idMoneda=a.ddlMoneda.swidget().value();if(a.ddlEspecie.swidget().value()){var d=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"cotizacioninstrumento",requestType:"GET",requestData:b});d.onSuccess=function(e){a.lblUltimoPrecio.text(e.Cotizacion.UltimoPrecio?Core.Functions.grid.formatPrice(e.Cotizacion.UltimoPrecio):"No disponible");a.lblVariacion.text(e.Cotizacion.Variacion?e.Cotizacion.Variacion:"No disponible");c(a.lblVariacion,e.Cotizacion.Variacion);a.lblMejorOfertaCompra.text(e.Cotizacion.MejorOfertaCompra?e.Cotizacion.MejorOfertaCompra:"No disponible");a.lblMejorOfertaVenta.text(e.Cotizacion.MejorOfertaVenta?e.Cotizacion.MejorOfertaVenta:"No disponible")};d.request()}else{a.lblUltimoPrecio.text("");a.lblVariacion.text("");a.lblMejorOfertaCompra.text("");a.lblMejorOfertaVenta.text("")}};a.validData=function(d){var e={value:true};var b={idCuenta:Core.Functions.Validations.getValidatedDropDownValue(a.ddlAccounts,e),FechaConcertacion:Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtDate,e)),idMercado:Core.Functions.Validations.getValidatedDropDownValue(a.ddlMercado,e),idTipoOperacion:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,e),ticker:Core.Functions.Validations.getValidatedSwidgetValue(a.ddlEspecie,e),Plazo:Core.Functions.Validations.getValidatedDropDownValue(a.ddlPlazo,e),idMoneda:Core.Functions.Validations.getValidatedSwidgetValue(a.ddlMoneda),Cantidad:Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidadNominales,e),Precio:Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecio,e),PrecioReferencia:a.txtPrecioReferencia.val()?Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecioReferencia,e):0,Monto:parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecio,e))*parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidadNominales,e)),Observaciones:a.txtObservaciones.val(),Urgente:0,esCruce:0,CodMercadoExterno:"",corredor:((a.ddlCorredores.swidget().selectedItem())?a.ddlCorredores.swidget().selectedItem().Descripcion:""),idcorredor:((a.ddlCorredores.swidget().selectedItem())?a.ddlCorredores.swidget().selectedItem().idCorredor:0),comision:((a.ddlCorredores.swidget().selectedItem()&&a.ddlCorredores.swidget().selectedItem().idCorredor&&a.chkAplicaComisionesCorredor[0].checked)?1:0)};if(!e.value){return}var c="";if(b.Precio>80){c+="<p>El Precio es muy elevado. Recuerde que los precios se cargan UNITARIOS.</p>"}if(Math.abs(b.Precio-b.PrecioReferencia)>Math.abs(b.Precio/2)){c+="<p>Se ingresó un Precio y un Precio de Referencia muy distintos.</p>"}if(b.PrecioReferencia<=0){c+="<p>Se ingresó un Precio de Referencia en Cero.</p>"}if(b.idTipoOperacion==Core.Enums.eMinutaTipoOperacion.Compra){if(parseFloat(b.Precio)<parseFloat(b.PrecioReferencia)){c+="<p>Operación de COMPRA con un Precio menor al Precio de Referencia. Esto generará comisiones negativas.</p>"}}if(b.idTipoOperacion==Core.Enums.eMinutaTipoOperacion.Venta){if(parseFloat(b.Precio)>parseFloat(b.PrecioReferencia)){c+="<p>Operación de VENTA con un Precio mayor al Precio de Referencia. Esto generará comisiones negativas.</p>"}}if(b.Precio>0&&(Math.abs(b.Precio-b.PrecioReferencia)/b.Precio)>0.017){c+="<p>Operación con una comisión mayor al 1.7%.</p>"}if(c!=""){c+="<p>¿Esta seguro que desea continuar?</p>";new Core.Controls.Confirmation("Alerta",c,{onAccepted:d}).show()}else{d()}};a.send=function(){var d={value:true};var b={data:{idCuenta:Core.Functions.Validations.getValidatedDropDownValue(a.ddlAccounts,d),FechaConcertacion:Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtDate,d)),idMercado:Core.Functions.Validations.getValidatedDropDownValue(a.ddlMercado,d),idTipoOperacion:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,d),ticker:Core.Functions.Validations.getValidatedSwidgetValue(a.ddlEspecie,d),Plazo:Core.Functions.Validations.getValidatedDropDownValue(a.ddlPlazo,d),idMoneda:Core.Functions.Validations.getValidatedSwidgetValue(a.ddlMoneda),Cantidad:Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidadNominales,d),Precio:Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecio,d),PrecioReferencia:a.txtPrecioReferencia.val()?Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecioReferencia,d):0,Monto:parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecio,d))*parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidadNominales,d)),Observaciones:a.txtObservaciones.val(),Urgente:0,esCruce:0,CodMercadoExterno:"",corredor:((a.ddlCorredores.swidget().selectedItem())?a.ddlCorredores.swidget().selectedItem().Descripcion:""),idcorredor:((a.ddlCorredores.swidget().selectedItem())?a.ddlCorredores.swidget().selectedItem().idCorredor:0),comision:((a.ddlCorredores.swidget().selectedItem()&&a.ddlCorredores.swidget().selectedItem().idCorredor&&a.chkAplicaComisionesCorredor[0].checked)?1:0)}};var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"minutas/insertar",requestType:"POST",requestData:b});c.onSuccess=function(f){var e=new Core.Controls.Dialog("Mensaje","Minuta ingresada correctamente. Número: "+f.idMinuta,{displayButtons:{close:true,accept:false}});e.show()};c.request()}};Core.Business.MesaOperacionesCanje=new function(){var a=this;a.id="mesaInsertarOperacionCanje";a.btnNuevaOperacion=null;a.divOperacionesCanje=null;a.divTotalesContable=null;a.lblTotalCable=null;a.lblPorcentaje=null;a.lblTotalMep=null;a.lblTotalContable=null;a.lblTotalContableSemanaAnterior=null;a.lblTotalContableSemanaActual=null;a.btnContableDetalle=null;a.timeoutFilterFast=null;a.txtFilterFast=null;a.lblTitle=null;a.txtDateFrom=null;a.txtDateTo=null;var b=30000;a.timerId=null;a.window=$(window);a.loaded=false;a.managerOperacion=null;a.init=function(c,d){Core.loadPage("mesa-operaciones-canje.html",function(){document.title="Operaciones Canje";a.divOperacionesCanje=$(".div-operaciones-canje");a.divTotalesContable=$(".div-totales-contable");a.lblTotalCable=$(".label-total-cable");a.lblPorcentaje=$(".label-porcentaje");a.lblTotalMep=$(".label-total-mep");a.lblTotalContable=$(".label-total-contable");a.lblTotalContableSemanaAnterior=$(".label-total-contable-semana-anterior");a.lblTotalContableSemanaActual=$(".label-total-contable-semana-actual");a.btnContableDetalle=$(".btn-contable-detalle");a.btnNuevaOperacion=$(".btn-nueva-operacion");a.lblTitle=$(".label-title");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.txtFilterFast=$(".textbox-filter-fast");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,c,d,a.loadGrid,"Core.Business.MesaOperacionesCanje");a.timerId=window.setInterval(function(){a.loadGrid()},b);Core.Objects.Context.Timers.push(a.timerId)})};a.loadGrid=function(){var c;c="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));c+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));var d=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"operacionescanje",requestType:"GET",requestData:c});d.onSuccess=function(e){if(e.montoscontablescnv[0]){a.lblTotalContable.html(Core.Functions.grid.formatNumberWithColor((e.montoscontablescnv[0].MontoTotal)?e.montoscontablescnv[0].MontoTotal:0));a.lblTotalContableSemanaAnterior.html(Core.Functions.grid.formatNumberWithColor((e.montoscontablescnv[0].MontoSemanaAnterior)?e.montoscontablescnv[0].MontoSemanaAnterior:0));a.lblTotalContableSemanaActual.html(Core.Functions.grid.formatNumberWithColor((e.montoscontablescnv[0].MontoSemanaActual)?e.montoscontablescnv[0].MontoSemanaActual:0));a.divTotalesContable.show()}else{a.divTotalesContable.hide()}var h=0;var i=0;e.operaciones.forEach(function(k,j){if(k.FechaLiquidacion){k.FechaLiquidacion=k.FechaLiquidacion+" 00:00:00.000"}k.FechaOperacion=k.FechaOperacion+" 00:00:00.000";k.CableConSigno=(k.TipoOperacion=="Venta")?(k.Cable*-1):k.Cable;h+=k.CableConSigno;k.MepConSigno=(k.TipoOperacion=="Compra")?(k.Mep*-1):k.Mep;i+=k.MepConSigno});a.lblTotalCable.html(Core.Functions.grid.formatNumberWithColor(h));a.lblPorcentaje.html(Core.Functions.grid.formatNumberWithColor(Core.Functions.Decimal.parseFloat(h!=0?(i/h):0)));a.lblTotalMep.html(Core.Functions.grid.formatNumberWithColor(i));var g=a.window.scrollTop();var f=a.divOperacionesCanje.swidget().initialOptions;f.dataSource.data=e.operaciones;f.dataSource.sort=a.divOperacionesCanje.swidget().dataSource.sort;f.exportOptions.excel.dataSource.data=e.operaciones;f.exportOptions.excel.readDataSource=true;a.divOperacionesCanje.swidget().refresh(f);a.txtFilterFast.keydown();a.window.scrollTop(g);a.loaded=true};d.request()};a.initControls=function(){a.divOperacionesCanje.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:100,pageLinksCount:10},columns:[{width:"5%",field:"idOperacionCanje",title:"ID",headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"8%",field:"FechaOperacion",title:"Concertación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatStringDate},{width:"4%",field:"Plazo",title:"Plazo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"8%",field:"FechaLiquidacion",title:"Liquidación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatStringDate},{width:"4%",field:"ParkingDescripcion",title:"Contable Cable",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"4%",field:"Cuenta",title:"Cuenta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"4%",field:"TipoOperacion",title:"Operación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{title:"Cable",field:"CableConSigno",filterable:true,width:"9%",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(c,g,f){var d="";if(g.TipoOperacion=="Venta"){d="red"}var e="<span class='"+d+"'>"+Core.Functions.grid.formatNumber(g.Cable)+"</span>";c.html(e);c.css("text-align","right");c.css("padding-right","5px")}},{width:"9%",field:"Precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatPrice},{title:"Mep",field:"MepConSigno",filterable:true,width:"9%",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(c,g,f){var d="";if(g.TipoOperacion=="Compra"){d="red"}var e="<span class='"+d+"'>"+Core.Functions.grid.formatNumber(g.Mep)+"</span>";c.html(e);c.css("text-align","right");c.css("padding-right","5px")}},{width:"8%",field:"UsernameAsesor",title:"Asesor",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"10%",field:"Observaciones",title:"Observaciones",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{title:"Adv.",field:"advertencia",filterable:false,width:"3%",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(c,e,d){if(e.advertencia&&e.advertencia!=""){var f=(e.advertencia.length>140)?(e.advertencia.substr(0,140)+"..."):(e.advertencia);btnAdvertencia=$('<button type="button" title="'+f+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-exclamation-sign"></span></button>').appendTo(c);btnAdvertencia.addClass("link-cell");btnAdvertencia.on("click",function(){var g=new Core.Controls.Dialog("Advertencia",(e.advertencia)?e.advertencia:"",{displayButtons:{close:true,accept:false}});g.show()})}}},{width:"5%",field:"UsuarioCreacion",title:"Alta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"5%",field:"UsuarioOperador",title:"Operador",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:90,field:"Options",title:" ",headerAttributes:Core.Functions.grid.getCellOddClass(),filterable:false,columnTemplate:function(e,g,f){var d=$('<button type="button" title="Modificar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(e);d.on("click",function(){if(a.managerOperacion!=null){Core.Objects.Context.Dialogs.remove(a.managerOperacion);a.managerOperacion.destroy()}a.managerOperacion=new Core.Controls.ManagerOperacionCanje({operacion:g,overlayElement:d,onSave:function(){a.loaded=false;a.loadGrid()},onDestroy:function(){a.managerOperacion=null}});a.managerOperacion.show();Core.Objects.Context.Dialogs.push(a.managerOperacion)});var c=$('<button type="button" title="Eliminar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(e);c.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar la operación con ID: "+g.idOperacionCanje+"?",{onAccepted:function(){var h={};h.data={};h.data.idOperacionCanje=g.idOperacionCanje;h.data.Borrado=1;var i=new Core.Ajax.ServerRequest({overlayElemet:c,requestUrl:"operacionescanje",requestType:"PUT",requestData:h});i.onSuccess=function(j){a.loaded=false;a.loadGrid()};i.request()}}).show()})}}],toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Operaciones",columnFields:["idOperacionCanje","FechaOperacion","Plazo","FechaLiquidacion","ParkingDescripcion","Cuenta","TipoOperacion","CableConSigno","Precio","MepConSigno","Observaciones","UsernameAsesor","advertencia","UsuarioCreacion","UsuarioOperador"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Operaciones"}}}});a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),events:{change:function(c){a.loaded=false;a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),events:{change:function(c){a.loaded=false;a.loadGrid()}}});a.txtFilterFast.on("keydown",function(){clearTimeout(a.timeoutFilterFast);a.timeoutFilterFast=setTimeout(function(){value=a.txtFilterFast.val();var d=[{path:"idOperacionCanje",filter:"contains",value:value},{path:"FechaOperacion",filter:"contains",value:value},{path:"Plazo",filter:"contains",value:value},{path:"FechaLiquidacion",filter:"contains",value:value},{path:"ParkingDescripcion",filter:"contains",value:value},{path:"Cuenta",filter:"contains",value:value},{path:"TipoOperacion",filter:"contains",value:value},{path:"Contraparte",filter:"contains",value:value},{path:"Cable",filter:"contains",value:value},{path:"Precio",filter:"contains",value:value},{path:"Mep",filter:"contains",value:value},{path:"UsuarioOperador",filter:"contains",value:value},{path:"UsuarioCreacion",filter:"contains",value:value},{path:"UsernameAsesor",filter:"contains",value:value},{path:"Observaciones",filter:"contains",value:value}];var c=a.divOperacionesCanje.swidget().dataSource;if(value){c.filter={or:d}}else{c.filter=null}c.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilterFast,"Core.Business.MesaOperacionesCanje.txtFilterFast");a.btnNuevaOperacion.click(function(){var c={};c.onSave=function(){a.loaded=false;a.loadGrid();a.btnNuevaOperacion.click()};c.opcionesDefault=Core.Enums.eMesaOperacionOpcionesDefault.Nueva;c.overlayElement=a.btnNuevaOperacion;c.onDestroy=function(){a.managerOperacion=null};if(a.managerOperacion!=null){Core.Objects.Context.Dialogs.remove(a.managerOperacion);a.managerOperacion.destroy()}a.managerOperacion=new Core.Controls.ManagerOperacionCanje(c);Core.Objects.Context.Dialogs.push(a.managerOperacion);a.managerOperacion.show()});a.btnContableDetalle.click(function(){new Core.Business.MesaOperacionesUSD.ContableDetalles({fecha:Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value())}).show()})}};Core.Business.MesaOperacionesCruzadas=new function(){var a=this;a.id="mesaOperacionesCruzadas";a.divOperaciones=null;a.lblTitle=null;a.txtDate=null;a.chkDetalle=null;a.txtFilter=null;a.btnRefresh=null;a.timeout=null;a.init=function(b,c){Core.loadPage("mesa-operaciones-cruzadas.html",function(){document.title="Operaciones Cruzadas";a.divOperaciones=$(".div-operaciones");a.lblTitle=$(".label-title");a.txtDate=$(".date-picker");a.chkDetalle=$(".checkbox-detalle");a.txtFilter=$(".textbox-filter");a.btnRefresh=$(".btn-refresh");a.btnRefresh.on("click",function(){a.loadGrid()});a.initControls();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.MesaOperacionesCruzadas")})};a.initControls=function(){a.txtDate.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(b){a.loadGrid()}}});a.chkDetalle.on("change",function(){a.loadGrid()});a.chkDetalle[0].checked=false;a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var b=a.divOperaciones.swidget().dataSource;if(value){var c=[];c.push({path:"Ticker",filter:"contains",value:value});c.push({path:"Equipo",filter:"contains",value:value});c.push({path:"idOperacionCambio",filter:"contains",value:value});if(a.chkDetalle[0].checked){c.push({path:"idOperacionPlat",filter:"contains",value:value});c.push({path:"idOperacionMercadoPlat",filter:"contains",value:value});c.push({path:"NumMinuta",filter:"contains",value:value});c.push({path:"NumMinutaExt",filter:"contains",value:value});c.push({path:"BoletoMAE",filter:"contains",value:value})}b.filter={or:c}}else{b.filter=null}b.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.MesaOperacionesCruzadas.txtFilter")};a.initGrid=function(){a.divOperaciones.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:[],toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Operaciones Cruzadas",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:[],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Operaciones Cruzadas"}}}})};a.loadGrid=function(){a.lblTitle.text("Al "+Core.Functions.Date.getDisplayDate(a.txtDate.swidget().value()));var b;b="Fecha="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDate.swidget().value()));b+="&detalle="+((a.chkDetalle[0].checked)?"1":"0");var c=new Core.Ajax.ServerRequest({overlayElement:a.divOperaciones.parent(),secureRequest:true,requestUrl:"operacionescruzadas",requestType:"GET",requestData:b});c.onSuccess=function(f){var d=[];var e=[];d.push({field:"EstadoOperacionCruzada",title:"Estado",width:"6%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});e.push("EstadoOperacionCruzada");d.push({field:"FechaOperacion",title:"Fecha Operación",width:"6%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});e.push("FechaOperacion");d.push({field:"Sociedad",title:"Sociedad",width:"6%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});e.push("Sociedad");d.push({field:"MonedaOperacion",title:"Moneda",width:"6%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});e.push("MonedaOperacion");d.push({field:"TipoOperacion",title:"Tipo Operación",width:"6%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});e.push("TipoOperacion");d.push({field:"Ticker",title:"Ticker",width:"6%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});e.push("Ticker");d.push({title:"Nominales",field:"Nominales",width:"6%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),columnTemplate:function(h,i,k){var j="";if(i.TipoOperacion=="Venta"){j="red"}h.html("<span class='"+j+"'>"+Core.Functions.grid.formatUndefinedIntegerNumber(i.Nominales)+"</span>")}});e.push("Nominales");d.push({title:"Monto",field:"Monto",width:"6%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),columnTemplate:function(h,i,k){var j="";if(i.TipoOperacion=="Compra"){j="red"}h.html("<span class='"+j+"'>"+Core.Functions.grid.formatUndefinedIntegerNumber(i.Monto)+"</span>")}});e.push("Monto");d.push({field:"Equipo",title:"Equipo",width:"6%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});e.push("Equipo");d.push({field:"desMonedaInstrumento",title:"Moneda Instrumento",width:"6%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});e.push("desMonedaInstrumento");d.push({field:"idOperacionCambio",title:"ID Operación Cambio",width:"6%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});e.push("idOperacionCambio");if(a.chkDetalle[0].checked){d.push({field:"idOperacionPlat",title:"ID Operación Plat",width:"6%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});e.push("idOperacionPlat");d.push({field:"idOperacionMercadoPlat",title:"ID Operación Mercado Plat",width:"6%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});e.push("idOperacionMercadoPlat");d.push({field:"NumMinuta",title:"Núm. Minuta",width:"6%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});e.push("NumMinuta");d.push({field:"NumMinutaExt",title:"Núm. Minuta Ext.",width:"6%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});e.push("NumMinutaExt");d.push({field:"BoletoMAE",title:"Boleto MAE",width:"6%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});e.push("BoletoMAE")}d.push({field:"Origen",title:"Origen",width:"6%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});e.push("Origen");d.push({title:" ",width:"3%",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),columnTemplate:function(i,k,j){if(k.color){i.parent().css("background-color","rgba("+a.hexToRgb(k.color)+((j%2==0)?", 0.6":", 1 ")+")")}if(k.idEstadoOperacionCruzada==2){var h=$('<button type="button" title="Tipo Cambio" class="btn-sm balanz-button"><span class="glyphicon glyphicon-usd"></span></button>').appendTo(i);h.on("click",function(){new Core.Business.MesaOperacionesCruzadas.TipoCambio({operacion:k,detalle:a.chkDetalle[0].checked,fecha:Core.Functions.Date.getDateAsString(a.txtDate.swidget().value()),onSuccess:function(){a.loadGrid()}}).show()})}}});var g=a.divOperaciones.swidget().initialOptions;g.dataSource.data=f.operaciones;g.exportOptions.excel.dataSource.data=f.operaciones;g.exportOptions.excel.readDataSource=true;g.exportOptions.excel.columnFields=e;g.columns=d;a.divOperaciones.swidget().refresh(g);a.txtFilter.keydown()};c.request()};a.hexToRgb=function(d){d=d.replace("#","");var f=parseInt(d.substring(0,2),16);var e=parseInt(d.substring(2,4),16);var c=parseInt(d.substring(4,6),16);var h=f+","+e+","+c;return h}};Core.Business.MesaOperacionesCruzadas.TipoCambio=function(b){var a=this;a.divModal=$(".div-operaciones-cruzadas-tipo-cambio");a.txtTipoCambio=null;a.operacion=null;a.detalle=null;a.fecha=null;a.onSuccess=function(){};$.extend(true,a,b);a.show=function(){a.txtTipoCambio=a.divModal.find(".textbox-tipo-cambio");new Core.Controls.DecimalPicker(a.txtTipoCambio,{maxDecimalDigitCount:10,showThousandsSeparator:""});a.divModal.find(".btn-confirmar-tipo-cambio").unbind("click");a.divModal.find(".btn-confirmar-tipo-cambio").click(function(){Core.Functions.Validations.toggleValidation(a.txtTipoCambio,false);var e=Core.Functions.Decimal.parseFloat(a.txtTipoCambio.val());if(e){var c={data:{}};c.data.idSociedad=a.operacion.idSociedad;c.data.TipoCambio=e;c.data.Fecha=a.fecha;c.data.idMonedaOperacion=a.operacion.idMonedaOperacion;c.data.idNegocio=a.operacion.idNegocio;c.data.idInstrumento=a.operacion.idInstrumento;c.data.idDerivado=a.operacion.idDerivado;c.data.Ticker=a.operacion.Ticker;c.data.idMonedaInstrumento=a.operacion.idMonedaInstrumento;if(a.detalle){c.data.idCtaCorrienteExterno=a.operacion.idCtaCorrienteExterno;c.data.idExterno=a.operacion.idExterno;c.data.idTipoExterno=a.operacion.idTipoExterno}var d=new Core.Ajax.ServerRequest({requestType:"POST",requestUrl:"operacionescruzadas/relacion",requestData:c});d.onSuccess=function(f){a.onSuccess();a.divModal.modal("hide")};d.request()}else{Core.Functions.Validations.toggleValidation(a.txtTipoCambio,true)}});a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.divModal.on("shown.bs.modal",function(){a.txtTipoCambio.focus()});a.divModal.modal({show:true})};a.destroy=function(){}};Core.Business.MesaOperacionesMercado=new function(){var a=this;a.id="mesaOperacionesMercado";a.lblTitle=null;a.txtDateFrom=null;a.txtDateTo=null;a.divOperacionesContainer=null;a.divOperaciones=null;a.divOperacionDetalles=null;a.lblOperacionDetallesTitle=null;a.gridOperacionDetalles=null;a.btnVolver=null;a.ddlEquipo=null;a.txtFilter=null;a.timeoutFilterFast=null;a.window=$(window);var b=30000;a.timerId=null;a.loaded=false;a.originalData=null;a.operacionDetalles=null;a.init=function(c,d){Core.loadPage("mesa-operaciones-mercado.html",function(){document.title="Operaciones Mercado";a.divOperaciones=$(".div-operaciones-mercado");a.divOperacionesContainer=$(".div-operaciones-mercado-container");a.divOperacionesContainer.show();a.divOperacionDetalles=$(".div-operacion-mercado-detalles");a.divOperacionDetalles.hide();a.lblOperacionDetallesTitle=$(".lbl-title-operacion-mercado-detalles");a.gridOperacionDetalles=$(".grid-operacion-mercado-detalles");a.btnVolver=$(".btn-operacion-mercado-detalles-volver");a.lblTitle=$(".label-title");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.txtFilter=$(".textbox-filter");a.ddlEquipo=$(".dropdown-filtro-equipo");a.originalData=null;a.initDatePickers();a.initFilters();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,c,d,a.loadControls,"Core.Business.MesaOperacionesMercado");a.timerId=window.setInterval(function(){a.loadGrid()},b);Core.Objects.Context.Timers.push(a.timerId)})};a.initFilters=function(){a.txtFilter.on("keydown",function(){clearTimeout(a.timeoutFilterFast);a.timeoutFilterFast=setTimeout(function(){value=a.txtFilter.val();var d=[{path:"Ticker",filter:"contains",value:value},{path:"FechaOperacion",filter:"contains",value:value},{path:"FechaLiquidacion",filter:"contains",value:value},{path:"Estado",filter:"contains",value:value},{path:"Vehiculo",filter:"contains",value:value},{path:"TipoOperacion",filter:"contains",value:value},{path:"Contraparte",filter:"contains",value:value},{path:"Ticker",filter:"contains",value:value},{path:"Cantidad",filter:"contains",value:value},{path:"Precio",filter:"contains",value:value},{path:"Moneda",filter:"contains",value:value},{path:"Monto",filter:"contains",value:value},{path:"UsuarioCreacion",filter:"contains",value:value}];var c=a.divOperaciones.swidget().dataSource;if(value){c.filter={or:d}}else{c.filter=null}c.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.MesaOperacionesMercado.txtFilter");a.ddlEquipo.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idFiltroMiEquipo}",textTemplate:"{Equipo}",width:"80%",value:"",events:{select:function(c){a.loaded=false;a.loadGrid()}}})};a.initDatePickers=function(){a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),events:{change:function(c){a.loaded=false;a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),events:{change:function(c){a.loaded=false;a.loadGrid()}}})};a.initGrid=function(){function c(d){if(d==1){return"Si"}else{return""}}a.divOperaciones.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:100,pageLinksCount:10},columns:[{width:"5%",title:"Especie",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(d,f,e){d.html(f.Ticker);d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(f.color)+((e%2==0)?", 0.6":", 1 ")+")")}},{width:"5%",field:"FechaOperacion",title:"Concertación",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(d,f,e){d.html(f.FechaOperacion);d.css("text-align","left");d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(f.color)+((e%2==0)?", 0.6":", 1 ")+")")}},{width:"5%",field:"Vehiculo",title:"Cuenta",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(d,f,e){d.html(f.Vehiculo);d.css("text-align","left");d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(f.color)+((e%2==0)?", 0.6":", 1 ")+")")}},{width:"5%",field:"TipoOperacion",title:"Operación",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(d,f,e){d.html(f.TipoOperacion);d.css("text-align","left");d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(f.color)+((e%2==0)?", 0.6":", 1 ")+")")}},{title:"Cantidad",field:"Cantidad",filterable:true,width:"9%",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(d,h,g){var e="";if(h.TipoOperacion=="Venta"){e="red"}var f="<span class='"+e+"'>"+Core.Functions.grid.formatNumber(h.Cantidad)+"</span>";d.html(f);d.css("text-align","right");d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(h.color)+((g%2==0)?", 0.6":", 1 ")+")")}},{width:"9%",field:"Precio",title:"Precio",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(d,f,e){d.html(Core.Functions.grid.formatPrice(f.Precio));d.css("text-align","right");d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(f.color)+((e%2==0)?", 0.6":", 1 ")+")")}},{width:"8%",field:"Moneda",title:"Moneda",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(d,f,e){d.html(f.Moneda);d.css("text-align","left");d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(f.color)+((e%2==0)?", 0.6":", 1 ")+")")}},{title:"Monto",field:"Monto",filterable:true,width:"9%",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(d,h,g){var e="";if(h.TipoOperacion=="Compra"){e="red"}var f="<span class='"+e+"'>"+Core.Functions.grid.formatNumber(h.Monto)+"</span>";d.html(f);d.css("text-align","right");d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(h.color)+((g%2==0)?", 0.6":", 1 ")+")")}},{width:"10%",field:"Observaciones",title:"Observaciones",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(d,f,e){d.html(f.Observaciones);d.css("text-align","left");d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(f.color)+((e%2==0)?", 0.6":", 1 ")+")")}},{width:"5%",field:"UsuarioCreacion",title:"Alta",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(d,f,e){d.html(f.UsuarioCreacion);d.css("text-align","left");d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(f.color)+((e%2==0)?", 0.6":", 1 ")+")")}},{width:"5%",field:"UsuarioOperador",title:"Operador",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(d,f,e){d.html(f.UsuarioOperador);d.css("text-align","left");d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(f.color)+((e%2==0)?", 0.6":", 1 ")+")")}},{width:"5%",field:"Origen",title:"Origen",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(d,f,e){d.html(f.Origen);d.css("text-align","left");d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(f.color)+((e%2==0)?", 0.6":", 1 ")+")")}},{width:"5%",field:"EnESCO",title:"ESCO",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(d,f,e){d.html(c(f.EnESCO));d.css("text-align","left");d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(f.color)+((e%2==0)?", 0.6":", 1 ")+")")}},{width:"5%",field:"ConTipoCambio",title:"ID (USD)",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(d,f,e){if(f.ConTipoCambio){d.html(f.idOperacionUSD)}else{d.html("")}d.css("text-align","right");d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(f.color)+((e%2==0)?", 0.6":", 1 ")+")")}},{width:"5%",field:"ConTipoCambio",title:"TC Asignado",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(d,f,e){if(f.ConTipoCambio){d.html(Core.Functions.grid.formatPrice(f.TCAsignado))}else{d.html("")}d.css("text-align","right");d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(f.color)+((e%2==0)?", 0.6":", 1 ")+")")}},{width:80,field:"Options",title:" ",headerAttributes:Core.Functions.grid.getCellOddClass(),filterable:false,columnTemplate:function(f,h,g){f.css("background-color","rgba("+a.hexToRgb(h.color)+((g%2==0)?", 0.6":", 1 ")+")");if(h.BotonUSD){var e=$('<button type="button" title="USD" class="btn-sm balanz-button"><span class="glyphicon glyphicon-usd"></span></button>').appendTo(f);e.on("click",function(){var i={data:{}};i.data.idSistemaOrigenMercado=h.idSistemaOrigenMercado;i.data.idMoneda=h.idMoneda;i.data.operadorMercado=(h.UsuarioCreacion)?h.UsuarioCreacion:"";i.data.fecha=a.getDate(h.FechaOperacion);i.data.ticker=h.Ticker;i.data.idIntencionalidad=Core.Enums.eMesaIntencionalidad.USD;a.executeUpdate(i,e,"operacionesmesaagrupacionmercado",h.solicitaridMonedaUser)})}var d=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(f);d.on("click",function(){a.operacionDetalles=h;a.showOperacionDetalles()})}}],toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Operaciones",columnFields:["idOperacion","FechaOperacion","FechaLiquidacion","Estado","Vehiculo","TipoOperacion","Cantidad","Precio","Moneda","Monto","Observaciones","UsuarioCreacion","UsuarioOperador"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Operaciones"}}}});a.btnVolver.click(function(){if(a.gridOperacionDetalles&&a.gridOperacionDetalles.swidget()){a.gridOperacionDetalles.swidget().destroy()}a.divOperacionDetalles.hide();a.divOperacionesContainer.show();a.operacionDetalles=null;$("html, body").animate({scrollTop:0},1000)})};a.hexToRgb=function(d){d=d.replace("#","");var f=parseInt(d.substring(0,2),16);var e=parseInt(d.substring(2,4),16);var c=parseInt(d.substring(4,6),16);var h=f+","+e+","+c;return h};a.loadControls=function(){var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"filtromiequipo",requestType:"GET"});c.onSuccess=function(d){var e=a.ddlEquipo.swidget().initialOptions;e.dataSource.data=d.valores;a.ddlEquipo.swidget().refresh(e);a.loadGrid()};c.request()};a.loadGrid=function(){var c;c="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));c+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));c+="&idFiltroMiEquipo="+encodeURIComponent(a.ddlEquipo.swidget().selectedItem().idFiltroMiEquipo);var d=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"operacionesmesamercado",requestType:"GET",requestData:c});d.onSuccess=function(e){if(a.originalData==null||a.isDataModified(e.operaciones)){a.originalData=e.operaciones;var g=a.window.scrollTop();var f=a.divOperaciones.swidget().initialOptions;f.dataSource.data=e.operaciones;f.dataSource.sort=a.divOperaciones.swidget().dataSource.sort;f.dataSource.group=a.divOperaciones.swidget().dataSource.group;f.exportOptions.excel.dataSource.data=e.operaciones;f.exportOptions.excel.readDataSource=true;a.divOperaciones.swidget().refresh(f);a.txtFilter.keydown();a.loaded=true;a.window.scrollTop(g)}};d.request()};a.executeUpdate=function(d,c,f,e){new Core.Business.MesaOperacionesMercado.Parametros({solicitarMoneda:e,onSelected:function(g,h){if(d.data){if(g){d.data.idMonedaUser=g}d.data.TipoCambio=h}else{if(g){d.idMonedaUser=g}d.TipoCambio=h}a.execute(d,c,f)}}).show()};a.execute=function(d,c,f){var e=new Core.Ajax.ServerRequest({overlayElement:c,showOverlay:true,secureRequest:true,requestUrl:f,requestType:"PUT",requestData:d});e.onSuccess=function(g){a.loaded=false;if(a.operacionDetalles){a.loadGridOperacionDetalles()}else{a.loadGrid()}};e.request()};a.getDate=function(c){return c.substr(6,4)+c.substr(3,2)+c.substr(0,2)};a.isDataModified=function(e){if(a.originalData.length!=e.length){return true}for(var c=0;c<a.originalData.length;c++){var d=a.originalData[c];var f=$.grep(e,function(h,g){return h.Ticker==d.Ticker&&h.UsuarioCreacion==d.UsuarioCreacion&&h.Origen==d.Origen})[0];if(!f){return true}if(a.isOperacionModified(d,f)){return true}}return false};a.isOperacionModified=function(c,d){if(c.Ticker!=d.Ticker||c.FechaOperacion!=d.FechaOperacion||c.Vehiculo!=d.Vehiculo||c.TipoOperacion!=d.TipoOperacion||c.Cantidad!=d.Cantidad||c.Precio!=d.Precio||c.Moneda!=d.Moneda||c.Monto!=d.Monto||c.Observaciones!=d.Observaciones||c.UsuarioCreacion!=d.UsuarioCreacion||c.UsuarioOperador!=d.UsuarioOperador||c.Origen!=d.Origen){return true}return false};a.showOperacionDetalles=function(){if(a.operacionDetalles){a.lblOperacionDetallesTitle.text("Detalles Operacion ID: "+a.operacionDetalles.idOperacion);a.initGridOperacionDetalles();a.loadGridOperacionDetalles()}};a.loadGridOperacionDetalles=function(){var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"operacionesmesamercado/detalle?idSistemaOrigenMercado="+a.operacionDetalles.idSistemaOrigenMercado+"&CodigoEspecie="+a.operacionDetalles.Ticker+"&idMoneda="+a.operacionDetalles.idMoneda+"&idPersonaAsesor="+a.operacionDetalles.idPersonaAsesor+"&FechaOperacion="+a.getDate(a.operacionDetalles.FechaOperacion)+"&EnESCO="+a.operacionDetalles.EnESCO+"&ConTipoCambio="+a.operacionDetalles.ConTipoCambio,requestType:"GET"});c.onSuccess=function(f){var d=f.detalle==null?[]:f.detalle;var e=a.gridOperacionDetalles.swidget().initialOptions;e.dataSource.data=d;a.gridOperacionDetalles.swidget().refresh(e);a.divOperacionDetalles.show();a.divOperacionesContainer.hide();a.loaded=true};c.request()};a.initGridOperacionDetalles=function(c){a.gridOperacionDetalles.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:[{width:"5%",field:"idOperacion",title:"ID Plataforma",headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"5%",field:"idMercado",title:"ID Mercado",headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"5%",field:"Origen",title:"Origen",headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"6%",field:"FechaOperacion",title:"Concertación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"6%",field:"FechaLiquidacion",title:"Liquidación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"5%",field:"Vehiculo",title:"Cuenta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"5%",field:"TipoOperacion",title:"Operación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{title:"Cantidad",field:"Cantidad",filterable:true,width:"9%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(d,e,g){var f="";if(e.TipoOperacion=="Venta"){f="red"}d.html("<span class='"+f+"'>"+Core.Functions.grid.formatPrice(e.Cantidad)+"</span>")}},{width:"8%",field:"Ticker",title:"Especie",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"9%",field:"Precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatPrice},{title:"Monto",field:"Monto",filterable:true,width:"9%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(d,e,g){var f="";if(e.TipoOperacion=="Compra"){f="red"}d.html("<span class='"+f+"'>"+Core.Functions.grid.formatPrice(e.Monto)+"</span>")}},{width:"7%",field:"Moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"5%",field:"UsuarioCreacion",title:"Alta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"5%",field:"ConTipoCambio",title:"ID (USD)",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(d,f,e){if(f.ConTipoCambio){d.html(Core.Functions.grid.formatUndefinedString(f.idOperacionUSD))}else{d.html("")}d.css("text-align","right");d.css("padding-right","5px")}},{width:"5%",field:"ConTipoCambio",title:"TC Asignado",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(d,f,e){if(f.ConTipoCambio){d.html(Core.Functions.grid.formatPrice(f.TCAsignado))}else{d.html("")}d.css("text-align","right");d.css("padding-right","5px")}},{width:"5%",field:"idMinuta",title:"ID Minuta",headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"4%",field:"Options",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),filterable:false,columnTemplate:function(e,g,f){if(g.BotonUSD){var d=$('<button type="button" title="USD" class="btn-sm balanz-button"><span class="glyphicon glyphicon-usd"></span></button>').appendTo(e);d.on("click",function(){var h={};h.idSistemaOrigenMercado=g.idSistemaOrigenMercado;h.operacionesLordOperacionOrigen=g.operacionesLordOperacionOrigen;h.operacionesLordNumeroOperacion=g.operacionesLordNumeroOperacion;h.operacionesLordTipoOperacion=g.operacionesLordTipoOperacion;h.swpropSecuenciam=g.swpropSecuenciam;h.idIntencionalidad=Core.Enums.eMesaIntencionalidad.USD;a.executeUpdate(h,d,"operacionesmesamercado",g.solicitaridMonedaUser)})}}}]})}};Core.Business.MesaOperacionesMercado.Parametros=function(b){var a=this;a.divModal=$(".div-mesa-operaciones-mercado-parametros");a.divMoneda=null;a.ddlMoneda=null;a.txtTipoCambio=null;a.btnConfirmar=null;a.onSelected=function(c){};a.solicitarMoneda=null;$.extend(true,a,b);a.show=function(){a.txtTipoCambio=a.divModal.find(".textbox-tipo-cambio");new Core.Controls.DecimalPicker(a.txtTipoCambio,{maxDecimalDigitCount:10,showThousandsSeparator:""});a.divMoneda=a.divModal.find(".div-moneda");a.ddlMoneda=a.divModal.find(".dropdown-moneda");a.btnConfirmar=a.divModal.find(".btn-confirmar");a.ddlMoneda.shieldDropDown({dataSource:{data:[Core.Enums.Currency.DolaresCable,Core.Enums.Currency.Euros,Core.Enums.Currency.Dolares,Core.Enums.Currency.Pesos]},valueTemplate:"{idMoneda}",textTemplate:"{Descripcion}",value:Core.Enums.Currency.DolaresCable.idMoneda.toString()});a.divMoneda.hide();if(a.solicitarMoneda){a.divMoneda.show()}a.btnConfirmar.unbind("click");a.btnConfirmar.click(function(){Core.Functions.Validations.toggleValidation(a.ddlMoneda,false);Core.Functions.Validations.toggleValidation(a.txtTipoCambio,false);var c=Core.Functions.Decimal.parseFloat(a.txtTipoCambio.val());if(a.solicitarMoneda&&!a.ddlMoneda.swidget().selectedItem()){Core.Functions.Validations.toggleValidation(a.ddlMoneda,true);return}if(!c){Core.Functions.Validations.toggleValidation(a.txtTipoCambio,true);return}a.divModal.modal("hide");a.onSelected(((a.solicitarMoneda)?a.ddlMoneda.swidget().selectedItem().idMoneda:null),c)});a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.ddlMoneda.swidget().destroy()});a.divModal.modal({show:true})}};Core.Business.MesaOperacionesParidad=new function(){var a=this;a.id="mesaInsertarOperacion";a.eTipoVista={MisOperaciones:1,Equipo:2,Todas:3};a.decimalCount=10;a.btnNuevoDetalle=null;a.divOperacionesParidad=null;a.ddlTipoVista=null;a.divFiltersTitle=null;a.divFilters=null;a.btnFilters=null;a.divFilterFast=null;a.timeoutFilterFast=null;a.txtFilterFast=null;a.txtFilterIdFrom=null;a.txtFilterIdTo=null;a.txtFilterConcertacionFrom=null;a.txtFilterConcertacionTo=null;a.txtFilterLiquidacionFrom=null;a.txtFilterLiquidacionTo=null;a.ddlFilterEstado=null;a.ddlFilterCuenta=null;a.ddlFilterOperacion=null;a.txtFilterEspecie=null;a.txtFilterCantidadFrom=null;a.txtFilterCantidadTo=null;a.txtFilterPrecioFrom=null;a.txtFilterPrecioTo=null;a.txtFilterMontoFrom=null;a.txtFilterMontoTo=null;a.txtFilterOperador=null;a.ddlFilterMoneda=null;a.lblTitle=null;a.txtDateFrom=null;a.txtDateTo=null;a.originalData=null;a.operacionesOptions=null;var b=15000;a.timerId=null;a.window=$(window);a.loaded=false;a.managerOperacion=null;a.init=function(c,d){Core.loadPage("mesa-operaciones-paridad.html",function(){document.title="Operaciones";a.operacionesOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu("mesaPosicion",Core.Objects.Context.Profiles[d]);a.ddlTipoVista=$(".dropdown-tipo-vista");a.divOperacionesParidad=$(".div-operaciones-paridad");a.btnNuevoDetalle=$(".btn-nuevo-detalle");a.lblTitle=$(".label-title");a.txtDateFromContainer=$(".date-picker-from-container");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.divFilterFast=$(".div-textbox-filter-fast");a.txtFilterFast=$(".textbox-filter-fast");a.btnFilters=$(".btn-filters");a.divFiltersTitle=$(".div-filters-title");a.divFilters=$(".div-filters");a.txtFilterIdFrom=$(".textbox-filter-id-from");a.txtFilterIdTo=$(".textbox-filter-id-to");a.txtFilterConcertacionFrom=$(".date-filter-concertacion-from");a.txtFilterConcertacionTo=$(".date-filter-concertacion-to");a.txtFilterLiquidacionFrom=$(".date-filter-liquidacion-from");a.txtFilterLiquidacionTo=$(".date-filter-liquidacion-to");a.ddlFilterEstado=$(".dropdown-filter-estado");a.ddlFilterCuenta=$(".dropdown-filter-cuenta");a.ddlFilterOperacion=$(".dropdown-filter-operacion");a.txtFilterEspecie=$(".textbox-filter-especie");a.txtFilterCantidadFrom=$(".textbox-filter-cantidad-from");a.txtFilterCantidadTo=$(".textbox-filter-cantidad-to");a.txtFilterPrecioFrom=$(".textbox-filter-precio-from");a.txtFilterPrecioTo=$(".textbox-filter-precio-to");a.txtFilterMontoFrom=$(".textbox-filter-monto-from");a.txtFilterMontoTo=$(".textbox-filter-monto-to");a.txtFilterOperador=$(".textbox-filter-operador");a.ddlFilterMoneda=$(".dropdown-filter-moneda");a.btnTabOperacionesNormales=$(".btn-operaciones-normales");a.btnTabParidad=$(".btn-operaciones-paridad");a.btnTabOrigenOperaciones=$(".btn-origen-operaciones");a.initDatePickers();a.initFilters();a.initControls();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,c,d,a.loadGrids,"Core.Business.MesaOperacionesParidad");a.timerId=window.setInterval(function(){a.loadGrids()},b);Core.Objects.Context.Timers.push(a.timerId)})};a.initFilters=function(){a.txtFilterFast.on("keydown",function(){clearTimeout(a.timeoutFilterFast);a.timeoutFilterFast=setTimeout(function(){value=a.txtFilterFast.val();var d=[{path:"idOperacion",filter:"contains",value:value},{path:"FechaOperacion",filter:"contains",value:value},{path:"FechaLiquidacion",filter:"contains",value:value},{path:"Estado",filter:"contains",value:value},{path:"Vehiculo",filter:"contains",value:value},{path:"TipoOperacion",filter:"contains",value:value},{path:"Contraparte",filter:"contains",value:value},{path:"Ticker",filter:"contains",value:value},{path:"Cantidad",filter:"contains",value:value},{path:"Precio",filter:"contains",value:value},{path:"Moneda",filter:"contains",value:value},{path:"Monto",filter:"contains",value:value},{path:"UsuarioOperador",filter:"contains",value:value},{path:"UsuarioCreacion",filter:"contains",value:value},{path:"intencionalidadDes",filter:"contains",value:value}];var c=a.divOperacionesParidad.swidget().dataSource;if(value){c.filter={or:d}}else{c.filter=null}c.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilterFast,"Core.Business.MesaOperacionesParidad.txtFilterFast");a.btnFilters.attr("title","Ir a Búsqueda avanzada");a.btnFilters.click(function(){a.clearFilters();a.btnFilters.removeClass("glyphicon-menu-down");a.btnFilters.removeClass("glyphicon-menu-up");if(a.divFilters.is(":visible")){a.btnFilters.addClass("glyphicon-menu-down");a.divFilters.hide();a.divFiltersTitle.hide();a.divFilterFast.show();a.btnFilters.attr("title","Ir a Búsqueda Avanzada")}else{a.btnFilters.attr("title","Cerrar Búsqueda Avanzada");a.divFilterFast.hide();a.divFilters.show();a.divFiltersTitle.show();a.btnFilters.addClass("glyphicon-menu-up")}});a.txtFilterConcertacionFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],events:{change:function(c){a.executeFilters()}}});a.txtFilterConcertacionTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],events:{change:function(c){a.executeFilters()}}});a.txtFilterLiquidacionFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],events:{change:function(c){a.executeFilters()}}});a.txtFilterLiquidacionTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],events:{change:function(c){a.executeFilters()}}});a.ddlFilterCuenta.shieldDropDown({dataSource:{data:[{value:"",text:"(Seleccione)"},{value:"BCI",text:"BCI"},{value:"INT",text:"INT"},{value:"BCV",text:"BCV"}]},textTemplate:"{text}",valueTemplate:"{value}",value:"",events:{select:function(c){a.executeFilters()}}});a.ddlFilterEstado.shieldDropDown({dataSource:{data:[{value:"",text:"(Seleccione)"},{value:Core.Enums.eEstadoOperacion.Pendiente,text:"Pendiente"},{value:Core.Enums.eEstadoOperacion.Verificada,text:"Verificada"},{value:Core.Enums.eEstadoOperacion.Liquidada,text:"Liquidada"},{value:Core.Enums.eEstadoOperacion.Cancelada,text:"Cancelada"}]},textTemplate:"{text}",valueTemplate:"{value}",value:"",events:{select:function(c){a.executeFilters()}}});a.ddlFilterOperacion.shieldDropDown({dataSource:{data:[{value:"",text:"(Seleccione)"},{value:Core.Enums.eMesaTipoOperacion.Compra,text:"Compra"},{value:Core.Enums.eMesaTipoOperacion.Venta,text:"Venta"},{value:Core.Enums.eMesaTipoOperacion.Ajuste,text:"Ajuste"}]},textTemplate:"{text}",valueTemplate:"{value}",value:"",events:{select:function(c){a.executeFilters()}}});a.ddlFilterMoneda.shieldDropDown({dataSource:{data:[{idMoneda:"",Descripcion:"(Seleccione)"},Core.Enums.Currency.Pesos,Core.Enums.Currency.Dolares,Core.Enums.Currency.DolaresCable]},textTemplate:"{Descripcion}",valueTemplate:"{idMoneda}",value:"",events:{select:function(c){a.executeFilters()}}});a.txtFilterEspecie.on("keydown",function(){a.executeFilters()});Core.Functions.Persistence.setTextBox(a.txtFilterEspecie,"Core.Business.MesaOperacionesParidad.txtFilterEspecie");a.txtFilterOperador.on("keydown",function(){a.executeFilters()});Core.Functions.Persistence.setTextBox(a.txtFilterOperador,"Core.Business.MesaOperacionesParidad.txtFilterOperador");new Core.Controls.DecimalPicker(a.txtFilterIdFrom,{maxDecimalDigitCount:0,showThousandsSeparator:"",onKeyUp:function(){a.executeFilters()},defaultValue:""});new Core.Controls.DecimalPicker(a.txtFilterIdTo,{maxDecimalDigitCount:0,showThousandsSeparator:"",onKeyUp:function(){a.executeFilters()},defaultValue:""});new Core.Controls.DecimalPicker(a.txtFilterCantidadFrom,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){a.executeFilters()},defaultValue:""});new Core.Controls.DecimalPicker(a.txtFilterCantidadTo,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){a.executeFilters()},defaultValue:""});new Core.Controls.DecimalPicker(a.txtFilterMontoFrom,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){a.executeFilters()},defaultValue:""});new Core.Controls.DecimalPicker(a.txtFilterMontoTo,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){a.executeFilters()},defaultValue:""});new Core.Controls.DecimalPicker(a.txtFilterPrecioFrom,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){a.executeFilters()},defaultValue:""});new Core.Controls.DecimalPicker(a.txtFilterPrecioTo,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){a.executeFilters()},defaultValue:""});a.divFilters.hide();a.divFiltersTitle.hide();a.divFilterFast.show()};a.initDatePickers=function(){if(a.operacionesOptions.mesaSoloFechaDesde){a.txtDateFromContainer.hide()}else{a.txtDateFromContainer.show()}a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),events:{change:function(c){a.loaded=false;a.loadGrids()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),events:{change:function(c){a.loaded=false;a.loadGrids()}}})};a.initGrid=function(){var c={dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:100,pageLinksCount:10},columns:[{width:"5%",field:"idOperacion",title:"ID",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(d,f,e){d.html(Core.Functions.grid.formatNuleableIntegerNumber(f.idOperacion));d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(f.color)+((e%2==0)?", 0.6":", 1 ")+")")}},{width:"5%",field:"FechaOperacion",title:"Concertación",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(d,f,e){d.html(Core.Functions.grid.formatStringDate(f.FechaOperacion));d.css("text-align","left");d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(f.color)+((e%2==0)?", 0.6":", 1 ")+")")}},{width:"5%",field:"FechaLiquidacion",title:"Liquidación",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(d,f,e){d.html(Core.Functions.grid.formatStringDate(f.FechaLiquidacion));d.css("text-align","left");d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(f.color)+((e%2==0)?", 0.6":", 1 ")+")")}},{width:"5%",field:"Estado",title:"Estado",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(d,f,e){d.html(f.Estado);d.css("text-align","left");d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(f.color)+((e%2==0)?", 0.6":", 1 ")+")")}},{width:"5%",field:"Vehiculo",title:"Cuenta",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(d,f,e){d.html(f.Vehiculo);d.css("text-align","left");d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(f.color)+((e%2==0)?", 0.6":", 1 ")+")")}},{width:"5%",field:"TipoOperacion",title:"Operación",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(d,f,e){d.html(f.TipoOperacion);d.css("text-align","left");d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(f.color)+((e%2==0)?", 0.6":", 1 ")+")")}},{width:"10%",field:"OrigenOperacion",title:"Origen",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(d,f,e){d.html(f.OrigenOperacion);d.css("text-align","left");d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(f.color)+((e%2==0)?", 0.6":", 1 ")+")")}},{width:"12%",field:"Contraparte",title:"Contraparte",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(d,f,e){d.html(f.Contraparte);d.css("text-align","left");d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(f.color)+((e%2==0)?", 0.6":", 1 ")+")")}},{width:"8%",field:"Ticker",title:"Especie",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(d,f,e){d.html(f.Ticker);d.css("text-align","left");d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(f.color)+((e%2==0)?", 0.6":", 1 ")+")")}},{title:"Cantidad",field:"Cantidad",filterable:true,width:"9%",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(d,e,g){var f="";if(e.TipoOperacion=="Venta"){f="red"}d.html("<span class='"+f+"'>"+Core.Functions.grid.formatNumber(e.Cantidad)+"</span>");d.css("text-align","right");d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(e.color)+((g%2==0)?", 0.6":", 1 ")+")")}},{width:"9%",field:"PrecioReal",title:"Precio",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(d,f,e){d.html(Core.Functions.grid.formatPrice(f.PrecioReal));d.css("text-align","right");d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(f.color)+((e%2==0)?", 0.6":", 1 ")+")")}},{width:"8%",field:"Moneda",title:"Moneda",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(d,f,e){d.html(f.Moneda);d.css("text-align","left");d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(f.color)+((e%2==0)?", 0.6":", 1 ")+")")}},{title:"Monto",field:"Monto",filterable:true,width:"9%",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(d,e,g){var f="";if(e.TipoOperacion=="Compra"){f="red"}d.html("<span class='"+f+"'>"+Core.Functions.grid.formatNumber(e.Monto)+"</span>");d.css("text-align","right");d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(e.color)+((g%2==0)?", 0.6":", 1 ")+")")}},{title:"Obs.",field:"Observaciones",filterable:false,width:"8%",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(e,f,g){e.css("background-color","rgba("+a.hexToRgb(f.color)+((g%2==0)?", 0.6":", 1 ")+")");if(f.Observaciones&&f.Observaciones!=""){var i=(f.Observaciones.length>140)?(f.Observaciones.substr(0,140)+"..."):(f.Observaciones);var d=$('<button type="button" title="'+i+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>').appendTo(e);d.addClass("link-cell");d.on("click",function(){var j=new Core.Controls.Dialog("Observaciones",(f.Observaciones)?f.Observaciones:"",{displayButtons:{close:true,accept:false}});j.show()})}if(f.AdvertenciaFechaLiquidacion&&f.AdvertenciaFechaLiquidacion!=""){var h=(f.AdvertenciaFechaLiquidacion.length>140)?(f.AdvertenciaFechaLiquidacion.substr(0,140)+"..."):(f.AdvertenciaFechaLiquidacion);btnAdvertenciaFechaLiquidacion=$('<button type="button" title="'+h+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-exclamation-sign"></span></button>').appendTo(e);btnAdvertenciaFechaLiquidacion.addClass("link-cell");btnAdvertenciaFechaLiquidacion.on("click",function(){var j=new Core.Controls.Dialog("Advertencia",(f.AdvertenciaFechaLiquidacion)?f.AdvertenciaFechaLiquidacion:"",{displayButtons:{close:true,accept:false}});j.show()})}}},{width:"8%",field:"tipoCambio",title:"Tipo Cambio",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(d,f,e){d.html(Core.Functions.grid.formatPrice(f.tipoCambio));d.css("text-align","right");d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(f.color)+((e%2==0)?", 0.6":", 1 ")+")")}},{width:"5%",field:"UsuarioCreacion",title:"Alta",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(d,f,e){d.html(f.UsuarioCreacion);d.css("text-align","left");d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(f.color)+((e%2==0)?", 0.6":", 1 ")+")")}},{width:"5%",field:"UsuarioOperador",title:"Operador",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(d,f,e){d.html(f.UsuarioOperador);d.css("text-align","left");d.css("padding-right","5px");d.css("background-color","rgba("+a.hexToRgb(f.color)+((e%2==0)?", 0.6":", 1 ")+")")}},{width:"18%",field:"Options",title:" ",headerAttributes:Core.Functions.grid.getCellOddClass(),filterable:false,columnTemplate:function(j,l,k){j.css("background-color","rgba("+a.hexToRgb(l.color)+((k%2==0)?", 0.6":", 1 ")+")");if(l.botonEdicion){var f=$('<button type="button" title="Modificar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(j);f.on("click",function(){if(a.managerOperacion!=null){Core.Objects.Context.Dialogs.remove(a.managerOperacion);a.managerOperacion.destroy()}a.managerOperacion=new Core.Controls.ManagerOperacion({operacion:l,overlayElement:f,pantallaOrigen:Core.Enums.eManagerOperacionPantallaOrigen.OperacionesParidad,origen:(l.idOrigenOperacion==Core.Enums.eMesaOperacionOrigen.CompraVentaBono)?Core.Enums.eMesaOperacionOrigen.Operacion:l.idOrigenOperacion,onSave:function(){a.loaded=false;a.loadGrids()},onDestroy:function(){a.managerOperacion=null}});a.managerOperacion.show();Core.Objects.Context.Dialogs.push(a.managerOperacion)})}if(l.botonEliminacion){var d=$('<button type="button" title="Eliminar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(j);d.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar la operación"+((l.idOperacion>0)?(" con ID: "+l.idOperacion):"")+"?",{onAccepted:function(){var m={};m.data={};m.data.id=l.idOperacion;if(m.data.id==-1){m.data.SecuenciaAgrupacionIntencionalidad=l.SecuenciaAgrupacionIntencionalidad}m.data.Borrado=1;m.data.idTipoOperacionTraders=l.idTipoOperacionTraders;var n=new Core.Ajax.ServerRequest({overlayElemet:d,requestUrl:"operacionestraders",requestType:"PUT",requestData:m});n.onSuccess=function(o){a.loaded=false;a.loadGrids()};n.request()}}).show()})}if(l.botonUSD){var i=$('<button type="button" title="USD" class="btn-sm balanz-button"><span class="glyphicon glyphicon-usd"></span></button>').appendTo(j);i.on("click",function(){var m={};m.id=l.idOperacion;m.idIntencionalidad=Core.Enums.eMesaIntencionalidad.USD;m.idTipoOperacionTraders=l.idTipoOperacionTraders;m.Borrado=0;a.executeUpdate(m,i,"operacionestraders")})}if(l.botonParidad){var h=$('<button type="button" title="Paridad" class="btn-sm balanz-button"><span class="glyphicon glyphicon-sort"></span></button>').appendTo(j);h.on("click",function(){var m={};m.id=l.idOperacion;m.idIntencionalidad=Core.Enums.eMesaIntencionalidad.Paridad;m.idTipoOperacionTraders=l.idTipoOperacionTraders;m.Borrado=0;a.executeUpdate(m,i,"operacionestraders")})}if(l.botonUSDParidad){var g=$('<button type="button" title="Parcial" class="btn-sm balanz-button"><span class="glyphicon glyphicon-adjust"></span></button>').appendTo(j);g.on("click",function(){var m={};m.id=l.idOperacion;m.idIntencionalidad=Core.Enums.eMesaIntencionalidad.USDParidad;m.idTipoOperacionTraders=l.idTipoOperacionTraders;m.Borrado=0;new Core.Controls.Prompt("Nominales Paridad","Ingrese los nominales de paridad",{placeholder:"Especie: "+l.Ticker+" Cantidad: "+Core.Functions.grid.formatPrice(l.Cantidad),onAccepted:function(o){var n=Core.Functions.Decimal.parseFloat(o);if(n>0&&n<l.Cantidad){m.nominalesParidad=n;a.executeUpdate(m,g,"operacionestraders")}else{new Core.Controls.Dialog("Aviso","Los nominales de paridad deben ser mayores a 0 y menores a la cantidad.",{displayButtons:{close:true,accept:false}}).show()}}}).show()})}if(l.verDetalleAgrupacion){var e=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(j);e.on("click",function(){new Core.Business.MesaOperacionesParidad.Detalle({operacion:l,overlayElement:e}).show()})}}}],toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Operaciones",columnFields:["idOperacion","FechaOperacion","FechaLiquidacion","Estado","Vehiculo","TipoOperacion","OrigenOperacion","Contraparte","Ticker","Nominales","PrecioReal","Moneda","Total","Observaciones","tipoCambio","UsuarioCreacion","UsuarioOperador","montoAfectacionParidad"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Operaciones"}}}};a.divOperacionesParidad.shieldGrid(c)};a.hexToRgb=function(d){d=d.replace("#","");var f=parseInt(d.substring(0,2),16);var e=parseInt(d.substring(2,4),16);var c=parseInt(d.substring(4,6),16);var h=f+","+e+","+c;return h};a.executeUpdate=function(d,c,f){var e=new Core.Ajax.ServerRequest({overlayElement:c,showOverlay:true,secureRequest:true,requestUrl:f,requestType:"PUT",requestData:d});e.onSuccess=function(g){a.loaded=false;a.loadGrids()};e.request()};a.loadGrids=function(){var c;c="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString((a.operacionesOptions.mesaSoloFechaDesde?a.txtDateTo.swidget().value():a.txtDateFrom.swidget().value())));c+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));c+="&tipoVista="+a.ddlTipoVista.swidget().selectedItem().value;var d=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"operacionesmesaparidad",requestType:"GET",requestData:c});d.onSuccess=function(e){e.operaciones.forEach(function(g,f){if(g.FechaLiquidacion){g.FechaLiquidacion=g.FechaLiquidacion+" 00:00:00.000"}g.FechaOperacion=g.FechaOperacion+" 00:00:00.000";g.Nominales=(g.TipoOperacion=="Venta")?(g.Cantidad*-1):g.Cantidad;g.Total=(g.TipoOperacion=="Compra")?(g.Monto*-1):g.Monto});a.originalData=e.operaciones;a.executeFilters();a.loaded=true};d.request()};a.executeFilters=function(){var e=a.window.scrollTop();var c=$.grep(a.originalData,function(g,f){return true});if(a.txtFilterIdFrom.val()){c=$.grep(c,function(g,f){return g.idOperacion>=a.txtFilterIdFrom.val()})}if(a.txtFilterIdTo.val()){c=$.grep(c,function(g,f){return g.idOperacion<=a.txtFilterIdTo.val()})}if(a.txtFilterPrecioFrom.val()){c=$.grep(c,function(g,f){return g.PrecioReal>=a.txtFilterPrecioFrom.val()})}if(a.txtFilterPrecioTo.val()){c=$.grep(c,function(g,f){return g.PrecioReal<=a.txtFilterPrecioTo.val()})}if(a.txtFilterMontoFrom.val()){c=$.grep(c,function(g,f){return g.Monto>=a.txtFilterMontoFrom.val()})}if(a.txtFilterMontoTo.val()){c=$.grep(c,function(g,f){return g.Monto<=a.txtFilterMontoTo.val()})}if(a.txtFilterCantidadFrom.val()){c=$.grep(c,function(g,f){return g.Cantidad>=a.txtFilterCantidadFrom.val()})}if(a.txtFilterCantidadTo.val()){c=$.grep(c,function(g,f){return g.Cantidad<=a.txtFilterCantidadTo.val()})}if(a.txtFilterOperador.val()){c=$.grep(c,function(g,f){return g.UsuarioOperador.toLowerCase().indexOf(a.txtFilterOperador.val().toLowerCase())==0})}if(a.txtFilterEspecie.val()){c=$.grep(c,function(g,f){return g.Ticker.toLowerCase().indexOf(a.txtFilterEspecie.val().toLowerCase())==0})}if(a.ddlFilterCuenta.swidget().selectedItem().value){c=$.grep(c,function(g,f){return g.Vehiculo==a.ddlFilterCuenta.swidget().selectedItem().value})}if(a.ddlFilterOperacion.swidget().selectedItem().value){c=$.grep(c,function(g,f){return g.idTipoOperacion==a.ddlFilterOperacion.swidget().selectedItem().value})}if(a.ddlFilterMoneda.swidget().selectedItem().idMoneda){c=$.grep(c,function(g,f){return g.idMoneda==a.ddlFilterMoneda.swidget().selectedItem().idMoneda})}if(a.ddlFilterEstado.swidget().selectedItem().value){c=$.grep(c,function(g,f){return g.idEstadoOperacion==a.ddlFilterEstado.swidget().selectedItem().value})}if(a.txtFilterConcertacionFrom.swidget().value()){c=$.grep(c,function(g,f){return a.getDate(g.FechaOperacion)>=Core.Functions.Date.getDateAsString(a.txtFilterConcertacionFrom.swidget().value())})}if(a.txtFilterConcertacionTo.swidget().value()){c=$.grep(c,function(g,f){return a.getDate(g.FechaOperacion)<=Core.Functions.Date.getDateAsString(a.txtFilterConcertacionTo.swidget().value())})}if(a.txtFilterLiquidacionFrom.swidget().value()){c=$.grep(c,function(g,f){return g.FechaLiquidacion&&a.getDate(g.FechaLiquidacion)>=Core.Functions.Date.getDateAsString(a.txtFilterLiquidacionFrom.swidget().value())})}if(a.txtFilterLiquidacionTo.swidget().value()){c=$.grep(c,function(g,f){return g.FechaLiquidacion&&a.getDate(g.FechaLiquidacion)<=Core.Functions.Date.getDateAsString(a.txtFilterLiquidacionTo.swidget().value())})}var d=a.divOperacionesParidad.swidget().initialOptions;d.dataSource.data=c;d.dataSource.sort=a.divOperacionesParidad.swidget().dataSource.sort;d.dataSource.group=a.divOperacionesParidad.swidget().dataSource.group;d.exportOptions.excel.dataSource.data=a.originalData;d.exportOptions.excel.readDataSource=true;a.divOperacionesParidad.swidget().refresh(d);if(!a.divFilters.is(":visible")){a.txtFilterFast.keydown()}a.window.scrollTop(e)};a.clearFilters=function(){a.txtFilterFast.val("");a.txtFilterIdFrom.val("");a.txtFilterIdTo.val("");a.txtFilterPrecioFrom.val("");a.txtFilterPrecioTo.val("");a.txtFilterMontoFrom.val("");a.txtFilterMontoTo.val("");a.txtFilterCantidadFrom.val("");a.txtFilterCantidadTo.val("");a.txtFilterOperador.val("");a.txtFilterEspecie.val("");a.ddlFilterCuenta.swidget().value("");a.ddlFilterOperacion.swidget().value("");a.ddlFilterMoneda.swidget().value("");a.ddlFilterEstado.swidget().value("");a.txtFilterConcertacionFrom.swidget().value("");a.txtFilterConcertacionTo.swidget().value("");a.txtFilterLiquidacionFrom.swidget().value("");a.txtFilterLiquidacionTo.swidget().value("");var c=a.divOperacionesParidad.swidget().initialOptions;c.dataSource.data=a.originalData;c.dataSource.sort=a.divOperacionesParidad.swidget().dataSource.sort;c.dataSource.group=a.divOperacionesParidad.swidget().dataSource.group;a.divOperacionesParidad.swidget().refresh(c)};a.getDate=function(c){return c.substr(0,4)+c.substr(5,2)+c.substr(8,2)};a.resetFilters=function(){a.clearFilters();a.divFilters.hide();a.divFiltersTitle.hide();a.divFilterFast.show();a.btnFilters.removeClass("glyphicon-menu-down");a.btnFilters.removeClass("glyphicon-menu-up");a.btnFilters.addClass("glyphicon-menu-down");a.btnFilters.attr("title","Ir a Búsqueda Avanzada")};a.initControls=function(){a.ddlTipoVista.shieldDropDown({dataSource:{data:[{text:"Mis Operaciones",value:a.eTipoVista.MisOperaciones},{text:"Equipo",value:a.eTipoVista.Equipo},{text:"Todas",value:a.eTipoVista.Todas}]},valueTemplate:"{value}",textTemplate:"{text}",value:a.eTipoVista.MisOperaciones.toString(),events:{select:function(c){a.loaded=false;a.loadGrids()}}});a.btnNuevoDetalle.click(function(){var c={};c.pantallaOrigen=Core.Enums.eManagerOperacionPantallaOrigen.OperacionesParidad;c.origen=Core.Enums.eMesaOperacionOrigen.Operacion;c.intencionalidadDefault=Core.Enums.eMesaIntencionalidad.Paridad;c.onSave=function(){a.loaded=false;a.loadGrids();a.btnNuevoDetalle.click()};c.onDestroy=function(){a.managerOperacion=null};c.overlayElement=a.btnNuevoDetalle;if(a.managerOperacion!=null){Core.Objects.Context.Dialogs.remove(a.managerOperacion);a.managerOperacion.destroy()}a.managerOperacion=new Core.Controls.ManagerOperacion(c);Core.Objects.Context.Dialogs.push(a.managerOperacion);a.managerOperacion.show()})}};Core.Business.MesaOperacionesParidad.Detalle=function(b){var a=this;a.divModalDetalle=$(".div-mesa-operaciones-paridad-detalle");a.operacion=null;a.overlayElement=null;a.divDetalle=null;$.extend(true,a,b);a.show=function(){var c=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,requestUrl:"operacionesmesaparidad/secuencia",requestType:"GET",requestData:{SecuenciaAgrupacionIntencionalidad:a.operacion.SecuenciaAgrupacionIntencionalidad}});c.onSuccess=function(e){a.divDetalleOperacion=a.divModalDetalle.find(".div-detalle-operacion");var d={dataSource:{data:e.operaciones},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:100,pageLinksCount:10},columns:[{width:"5%",field:"idOperacion",title:"ID",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(f,h,g){f.html(Core.Functions.grid.formatNuleableIntegerNumber(h.idOperacion));f.css("padding-right","5px")}},{width:"8%",field:"FechaOperacion",title:"Concertación",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(f,h,g){f.html(Core.Functions.grid.formatStringDate(h.FechaOperacion));f.css("text-align","left");f.css("padding-right","5px")}},{width:"7%",field:"FechaLiquidacion",title:"Liquidación",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(f,h,g){f.html(Core.Functions.grid.formatStringDate(h.FechaLiquidacion));f.css("text-align","left");f.css("padding-right","5px")}},{width:"5%",field:"Estado",title:"Estado",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(f,h,g){f.html(h.Estado);f.css("text-align","left");f.css("padding-right","5px")}},{width:"5%",field:"Vehiculo",title:"Cuenta",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(f,h,g){f.html(h.Vehiculo);f.css("text-align","left");f.css("padding-right","5px")}},{width:"6%",field:"TipoOperacion",title:"Operación",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(f,h,g){f.html(h.TipoOperacion);f.css("text-align","left");f.css("padding-right","5px")}},{width:"6%",field:"Ticker",title:"Especie",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(f,h,g){f.html(h.Ticker);f.css("text-align","left");f.css("padding-right","5px")}},{title:"Cantidad",field:"Cantidad",filterable:true,width:"7%",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(f,g,i){var h="";if(g.TipoOperacion=="Venta"){h="red"}f.html("<span class='"+h+"'>"+Core.Functions.grid.formatNumber(g.Cantidad)+"</span>");f.css("text-align","right");f.css("padding-right","5px")}},{width:"9%",field:"PrecioReal",title:"Precio",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(f,h,g){f.html(Core.Functions.grid.formatPrice(h.PrecioReal));f.css("text-align","right");f.css("padding-right","5px")}},{width:"6%",field:"Moneda",title:"Moneda",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(f,h,g){f.html(h.Moneda);f.css("text-align","left");f.css("padding-right","5px")}},{title:"Monto",field:"Monto",filterable:true,width:"7%",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(f,g,i){var h="";if(g.TipoOperacion=="Compra"){h="red"}f.html("<span class='"+h+"'>"+Core.Functions.grid.formatNumber(g.Monto)+"</span>");f.css("text-align","right");f.css("padding-right","5px")}},{width:"9%",field:"intencionalidadDes",title:"Intencionalidad",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(f,h,g){f.html(h.intencionalidadDes);f.css("text-align","left");f.css("padding-right","5px")}},{width:"5%",field:"UsuarioCreacion",title:"Alta",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(f,h,g){f.html(h.UsuarioCreacion);f.css("text-align","left");f.css("padding-right","5px")}},{width:"6%",field:"UsuarioOperador",title:"Operador",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(f,h,g){f.html(h.UsuarioOperador);f.css("text-align","left");f.css("padding-right","5px")}}],toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:e.operaciones},readDataSource:true,author:"Balanz Capital Valores S.A.",fileName:"Detalle",columnFields:["idOperacion","FechaOperacion","FechaLiquidacion","Estado","Vehiculo","TipoOperacion","Ticker","Nominales","PrecioReal","Moneda","Total","intencionalidadDes","UsuarioCreacion","UsuarioOperador","montoAfectacionParidad"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Detalle"}}}};a.divDetalleOperacion.shieldGrid(d);a.divModalDetalle.unbind("hidden.bs.modal");a.divModalDetalle.on("hidden.bs.modal",function(){a.divDetalleOperacion.swidget().destroy()});a.divModalDetalle.modal({show:true})};c.request()}};Core.Business.MesaOperacionesUSD=new function(){var a=this;a.id="mesaInsertarOperacion";a.eTipoVista={MisOperaciones:1,Equipo:2,Todas:3};a.decimalCount=10;a.divOperaciones=null;a.divOperacionDetalles=null;a.btnNuevaOperacionNueva=null;a.divOperacionesUsd=null;a.divTotalesUsd=null;a.lblTotalesDia=null;a.lblTotalesCable=null;a.lblTotalesMep=null;a.lblTotalesNeto=null;a.lblTotalesPrecioPromedioCable=null;a.lblTotalesPrecioPromedioMep=null;a.lblTotalesPrecioPromedioNeto=null;a.txtPrecioPromedioMonitor=null;a.divTotalesContable=null;a.lblTotalContable=null;a.lblTotalContableSemanaAnterior=null;a.lblTotalContableSemanaActual=null;a.btnContableDetalle=null;a.divTipoVista=null;a.ddlTipoVista=null;a.timeoutFilterFast=null;a.divFilterFast=null;a.txtFilterFast=null;a.lblTitle=null;a.txtDateFrom=null;a.txtDateTo=null;a.operacionesOptions=null;var b=30000;a.timerId=null;a.window=$(window);a.loaded=false;a.managerOperacion=null;a.operacionDetalles=null;a.init=function(c,d){Core.loadPage("mesa-operaciones-usd.html",function(){document.title="Operaciones USD";a.operacionesOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu("mesaPosicion",Core.Objects.Context.Profiles[d]);a.divOperaciones=$(".div-operaciones");a.divOperaciones.show();a.divOperacionDetalles=$(".div-operacion-detalles");a.divOperacionDetalles.hide();a.divCalculadoraContado=$(".div-calculadora-contado");a.divCalculadoraContado.hide();a.divTipoVista=$(".div-tipo-vista");a.ddlTipoVista=$(".dropdown-tipo-vista");a.divOperacionesUsd=$(".div-operaciones-usd");a.divTotalesUsd=$(".div-totales-usd");a.lblTotalesDia=$(".label-totales-dia");a.lblTotalesCable=$(".label-totales-cable");a.lblTotalesMep=$(".label-totales-mep");a.lblTotalesNeto=$(".label-totales-neto");a.lblTotalesPrecioPromedioCable=$(".label-totales-precio-promedio-cable");a.lblTotalesPrecioPromedioMep=$(".label-totales-precio-promedio-mep");a.lblTotalesPrecioPromedioNeto=$(".label-totales-precio-promedio-neto");a.txtPrecioPromedioMonitor=$(".textbox-precio-promedio-monitor");a.divTotalesContable=$(".div-totales-contable");a.lblTotalContable=$(".label-total-contable");a.lblTotalContableSemanaAnterior=$(".label-total-contable-semana-anterior");a.lblTotalContableSemanaActual=$(".label-total-contable-semana-actual");a.btnContableDetalle=$(".btn-contable-detalle");a.btnNuevaOperacionNueva=$(".btn-nueva-operacion-nueva");a.lblTitle=$(".label-title");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.divFilterFast=$(".div-filter-fast");a.txtFilterFast=$(".textbox-filter-fast");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,c,d,a.loadGrids,"Core.Business.MesaOperacionesUSD");a.timerId=window.setInterval(function(){if(!a.operacionDetalles){a.loadGrids()}},b);Core.Objects.Context.Timers.push(a.timerId)})};a.loadGrids=function(){var c;c="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));c+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));c+="&tipoVista="+a.ddlTipoVista.swidget().selectedItem().value;var d=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"operacionesmesausddet",requestType:"GET",requestData:c});d.onSuccess=function(e){a.lblTotalContable.html(Core.Functions.grid.formatNumberWithColor((e.montoContableTotal)?e.montoContableTotal:0));a.lblTotalContableSemanaAnterior.html(Core.Functions.grid.formatNumberWithColor((e.montoContableSemanaAnterior)?e.montoContableSemanaAnterior:0));a.lblTotalContableSemanaActual.html(Core.Functions.grid.formatNumberWithColor((e.montoContableSemanaActual)?e.montoContableSemanaActual:0));if(e.operadodeldia&&e.operadodeldia.length>0){a.divTotalesUsd.show();a.lblTotalesDia.text(e.operadodeldia[0].Fecha);a.lblTotalesCable.html(Core.Functions.grid.formatNumberWithColor((e.operadodeldia[0].OperadoCable)?e.operadodeldia[0].OperadoCable:0));a.lblTotalesMep.html(Core.Functions.grid.formatNumberWithColor((e.operadodeldia[0].OperadoMep)?e.operadodeldia[0].OperadoMep:0));a.lblTotalesNeto.html(Core.Functions.grid.formatNumberWithColor((e.operadodeldia[0].OperadoNeto)?e.operadodeldia[0].OperadoNeto:0));a.lblTotalesPrecioPromedioCable.html(Core.Functions.grid.formatNumberWithColor((e.operadodeldia[0].PPCable)?e.operadodeldia[0].PPCable:0));a.lblTotalesPrecioPromedioMep.html(Core.Functions.grid.formatNumberWithColor((e.operadodeldia[0].PPMep)?e.operadodeldia[0].PPMep:0));a.lblTotalesPrecioPromedioNeto.html(Core.Functions.grid.formatNumberWithColor((e.operadodeldia[0].PPNeto)?e.operadodeldia[0].PPNeto:0));a.txtPrecioPromedioMonitor.val((e.operadodeldia[0].PrecioMonitor)?e.operadodeldia[0].PrecioMonitor:"")}else{a.divTotalesUsd.hide()}e.operaciones.forEach(function(i,h){if(i.FechaLiquidacion){i.FechaLiquidacion=i.FechaLiquidacion+" 00:00:00.000"}i.FechaOperacion=i.FechaOperacion+" 00:00:00.000";i.Nominales=(i.TipoOperacion=="Venta")?(i.Cantidad*-1):i.Cantidad;i.Total=(i.TipoOperacion=="Compra")?(i.Monto*-1):i.Monto});var g=a.window.scrollTop();var f=a.divOperacionesUsd.swidget().initialOptions;f.dataSource.data=e.operaciones;f.dataSource.sort=a.divOperacionesUsd.swidget().dataSource.sort;f.exportOptions.excel.dataSource.data=e.operaciones;f.exportOptions.excel.readDataSource=true;a.divOperacionesUsd.swidget().refresh(f);a.txtFilterFast.keydown();a.window.scrollTop(g);a.loaded=true};d.request()};a.hexToRgb=function(d){d=d.replace("#","");var f=parseInt(d.substring(0,2),16);var e=parseInt(d.substring(2,4),16);var c=parseInt(d.substring(4,6),16);var h=f+","+e+","+c;return h};a.initControls=function(){a.divOperacionesUsd.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:100,pageLinksCount:10},columns:[{width:"5%",field:"idOperacion",title:"ID",headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"8%",field:"FechaOperacion",title:"Concertación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatStringDate},{width:"4%",field:"Plazo",title:"Plazo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"8%",field:"FechaLiquidacion",title:"Liquidación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatStringDate},{width:"4%",field:"ParkingDescripcion",title:"Contable Cable",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"4%",field:"Vehiculo",title:"Cuenta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"4%",field:"TipoOperacion",title:"Operación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{title:"Cantidad",field:"Cantidad",filterable:true,width:"9%",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(c,g,f){var d="";if(g.TipoOperacion=="Venta"){d="red"}var e="<span class='"+d+"'>"+Core.Functions.grid.formatNumber(g.Cantidad)+"</span>";c.html(e);c.css("text-align","right");c.css("padding-right","5px")}},{width:"9%",field:"Precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatPrice},{width:"6%",field:"Moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{title:"Monto",field:"Monto",filterable:true,width:"9%",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(c,g,f){var d="";if(g.TipoOperacion=="Compra"){d="red"}var e="<span class='"+d+"'>"+Core.Functions.grid.formatNumber(g.Monto)+"</span>";c.html(e);c.css("text-align","right");c.css("padding-right","5px")}},{width:"8%",field:"UsernameAsesor",title:"Asesor",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"10%",field:"Observaciones",title:"Observaciones",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{title:"Adv.",field:"advertencia",filterable:false,width:"3%",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(c,e,d){if(e.advertencia&&e.advertencia!=""){var f=(e.advertencia.length>140)?(e.advertencia.substr(0,140)+"..."):(e.advertencia);btnAdvertencia=$('<button type="button" title="'+f+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-exclamation-sign"></span></button>').appendTo(c);btnAdvertencia.addClass("link-cell");btnAdvertencia.on("click",function(){var g=new Core.Controls.Dialog("Advertencia",(e.advertencia)?e.advertencia:"",{displayButtons:{close:true,accept:false}});g.show()})}}},{width:"5%",field:"UsuarioCreacion",title:"Alta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"5%",field:"UsuarioOperador",title:"Operador",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"4%",field:"TickerHija",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"12%",field:"Options",title:" ",headerAttributes:Core.Functions.grid.getCellOddClass(),filterable:false,columnTemplate:function(i,k,j){i.parent().css("background-color","rgba("+a.hexToRgb(k.color)+((j%2==0)?", 0.6":", 1 ")+")");var h=$('<button type="button" title="Modificar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(i);h.on("click",function(){if(a.managerOperacion!=null){Core.Objects.Context.Dialogs.remove(a.managerOperacion);a.managerOperacion.destroy()}a.managerOperacion=new Core.Controls.ManagerOperacionUSD({operacion:k,overlayElement:h,pantallaOrigen:Core.Enums.eManagerOperacionPantallaOrigen.OperacionesUSD,onSave:function(){a.loaded=false;a.loadGrids()},onDestroy:function(){a.managerOperacion=null}});a.managerOperacion.show();Core.Objects.Context.Dialogs.push(a.managerOperacion)});var f=$('<button type="button" title="Eliminar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(i);f.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar la operación con ID: "+k.idOperacion+"?",{onAccepted:function(){var l={};l.data={};l.data.id=k.idOperacion;l.data.Borrado=1;var m=new Core.Ajax.ServerRequest({overlayElemet:f,requestUrl:"operacionesmonedas",requestType:"PUT",requestData:l});m.onSuccess=function(n){a.loaded=false;a.loadGrids()};m.request()}}).show()});if(k.botonContadosInsertarMinutas){var e=$('<button type="button" title="Calculadora de Contado" class="btn-sm balanz-button"><span class="glyphicon glyphicon-refresh"></span></button>').appendTo(i);e.on("click",function(){if(a.managerOperacion!=null){Core.Objects.Context.Dialogs.remove(a.managerOperacion);a.managerOperacion.destroy();a.managerOperacion=null}new Core.Business.MesaOperacionesUSD.CalculadoraContado({overlayElement:e,operacion:k,onSave:function(){a.loaded=false;a.loadGrids()},onLoad:function(){a.operacionDetalles=k;a.divCalculadoraContado.show();a.divOperacionDetalles.hide();a.divOperaciones.hide();$("html, body").animate({scrollTop:0},1000)},onClosed:function(){a.operacionDetalles=null;a.divCalculadoraContado.hide();a.divOperacionDetalles.hide();a.divOperaciones.show();$("html, body").animate({scrollTop:0},1000)},container:a.divCalculadoraContado}).show()})}if(k.botonAgregarDetalle){var d=$('<button type="button" title="Agregar Detalle" class="btn-sm balanz-button"><span class="glyphicon glyphicon-plus"></span></button>').appendTo(i);d.on("click",function(){if(a.managerOperacion!=null){Core.Objects.Context.Dialogs.remove(a.managerOperacion);a.managerOperacion.destroy()}a.managerOperacion=new Core.Controls.ManagerOperacion({overlayElement:a.btnAddDetail,pantallaOrigen:Core.Enums.eManagerOperacionPantallaOrigen.OperacionesUSD,origen:Core.Enums.eMesaOperacionOrigen.Operacion,onSave:function(){a.loaded=false;a.loadGrids()},operacionPadre:k,idPuntaDetalle:1,onDestroy:function(){a.managerOperacion=null}});a.managerOperacion.show();Core.Objects.Context.Dialogs.push(a.managerOperacion)})}if(k.botonDetalleOrigen){var g=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(i);g.on("click",function(){if(a.managerOperacion!=null){Core.Objects.Context.Dialogs.remove(a.managerOperacion);a.managerOperacion.destroy();a.managerOperacion=null}new Core.Business.MesaOperacionesUSD.DetallesOperacion({overlayElement:g,operacion:k,onLoad:function(){a.operacionDetalles=k;a.divCalculadoraContado.hide();a.divOperacionDetalles.show();a.divOperaciones.hide();$("html, body").animate({scrollTop:0},1000)},onClosed:function(){a.operacionDetalles=null;a.divCalculadoraContado.hide();a.divOperacionDetalles.hide();a.divOperaciones.show();$("html, body").animate({scrollTop:0},1000);a.loaded=false;a.loadGrids()},container:a.divOperacionDetalles}).show()})}if(k.botonRecalcularMaestro){var c=$('<button type="button" style="background-color:green; border-color:green; title="Recalcular Operación de Cambio" class="btn-sm balanz-button"><span class="glyphicon glyphicon-ok"></span></button>').appendTo(i);c.on("click",function(){var l={};l.data={};l.data.id=k.idOperacion;var m=new Core.Ajax.ServerRequest({overlayElemet:c,requestUrl:"operacionesmonedas/recalcular",requestType:"PUT",requestData:l});m.onSuccess=function(n){a.loaded=false;a.loadGrids()};m.request()})}}}],toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Operaciones",columnFields:["idOperacion","FechaOperacion","Plazo","FechaLiquidacion","ParkingDescripcion","Estado","Vehiculo","TipoOperacion","Nominales","Precio","Moneda","Total","Observaciones","UsernameAsesor","UsuarioCreacion","UsuarioOperador","TickerHija"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Operaciones"}}}});a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),events:{change:function(c){a.loaded=false;a.loadGrids()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),events:{change:function(c){a.loaded=false;a.loadGrids()}}});a.txtFilterFast.on("keydown",function(){clearTimeout(a.timeoutFilterFast);a.timeoutFilterFast=setTimeout(function(){value=a.txtFilterFast.val();var d=[{path:"idOperacion",filter:"contains",value:value},{path:"FechaOperacion",filter:"contains",value:value},{path:"Plazo",filter:"contains",value:value},{path:"FechaLiquidacion",filter:"contains",value:value},{path:"ParkingDescripcion",filter:"contains",value:value},{path:"Estado",filter:"contains",value:value},{path:"Vehiculo",filter:"contains",value:value},{path:"TipoOperacion",filter:"contains",value:value},{path:"Contraparte",filter:"contains",value:value},{path:"Ticker",filter:"contains",value:value},{path:"Cantidad",filter:"contains",value:value},{path:"Precio",filter:"contains",value:value},{path:"Moneda",filter:"contains",value:value},{path:"Monto",filter:"contains",value:value},{path:"UsuarioOperador",filter:"contains",value:value},{path:"UsuarioCreacion",filter:"contains",value:value},{path:"UsernameAsesor",filter:"contains",value:value},{path:"Observaciones",filter:"contains",value:value}];var c=a.divOperacionesUsd.swidget().dataSource;if(value){c.filter={or:d}}else{c.filter=null}c.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilterFast,"Core.Business.MesaOperacionesUSD.txtFilterFast");a.ddlTipoVista.shieldDropDown({dataSource:{data:[{text:"Mis Operaciones",value:a.eTipoVista.MisOperaciones},{text:"Equipo",value:a.eTipoVista.Equipo},{text:"Todas",value:a.eTipoVista.Todas}]},valueTemplate:"{value}",textTemplate:"{text}",value:a.eTipoVista.Todas.toString(),events:{select:function(c){a.loaded=false;a.loadGrids()}}});a.btnNuevaOperacionNueva.click(function(){var c={};c.onSave=function(){a.loaded=false;a.loadGrids();a.btnNuevaOperacionNueva.click()};c.opcionesDefault=Core.Enums.eMesaOperacionOpcionesDefault.Nueva;c.overlayElement=a.btnNuevaOperacionNueva;c.pantallaOrigen=Core.Enums.eManagerOperacionPantallaOrigen.OperacionesUSD;c.onDestroy=function(){a.managerOperacion=null};if(a.managerOperacion!=null){Core.Objects.Context.Dialogs.remove(a.managerOperacion);a.managerOperacion.destroy()}a.managerOperacion=new Core.Controls.ManagerOperacionUSD(c);Core.Objects.Context.Dialogs.push(a.managerOperacion);a.managerOperacion.show()});new Core.Controls.DecimalPicker(a.txtPrecioPromedioMonitor,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:"",onChange:function(){if(a.txtPrecioPromedioMonitor.val()){var c=new Core.Ajax.ServerRequest({overlayElement:a.txtPrecioPromedioMonitor,showOverlay:true,requestUrl:"preciomonitor?preciomonitor="+Core.Functions.Decimal.parseFloat(a.txtPrecioPromedioMonitor.val()),requestType:"POST"});c.onSuccess=function(d){};c.request()}}});a.btnContableDetalle.click(function(){new Core.Business.MesaOperacionesUSD.ContableDetalles({fecha:Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value())}).show()})}};Core.Business.MesaOperacionesUSD.DetallesOperacion=function(b){var a=this;a.container=null;a.onLoad=function(){};a.onClosed=function(){};a.overlayElement=null;a.operacion=null;a.managerOperacion=null;$.extend(true,a,b);a.show=function(){a.managerOperacion=null;a.lblOperacionDetallesTitle=a.container.find(".lbl-title-operacion-detalles");a.lblOperacionDetallesTitle.text("Detalles Operacion ID: "+a.operacion.idOperacion);a.gridOperacionDetalles=a.container.find(".grid-operacion-detalles");a.gridOperacionDetalles.shieldGrid({dataSource:{data:[],aggregate:[{field:"Cantidad",aggregate:"sum"}]},selection:false,rowHover:false,columns:[{width:"5%",field:"idOperacion",title:"ID",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedIntegerNumber},{width:"7%",field:"FechaConcertacion",title:"Concertación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"7%",field:"FechaLiquidacion",title:"Liquidación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"7%",field:"estado",title:"Estado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"7%",field:"Cuenta",title:"Cuenta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"7%",field:"TipoOperacion",title:"Operación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"7%",field:"Contraparte",title:"Contraparte",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{title:"Cantidad",field:"Cantidad",width:"7%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(c,d,f){var e="";if(d.TipoOperacion=="Venta"){e="red"}c.html("<span class='"+e+"'>"+Core.Functions.grid.formatPrice(d.Cantidad)+"</span>");c.css("text-align","right");c.css("padding-right","5px")}},{width:"7%",field:"Ticker",title:"Especie",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"7%",field:"Precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatPrice},{title:"Monto",field:"Monto",filterable:true,width:"7%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(c,d,f){var e="";if(d.TipoOperacion=="Compra"){e="red"}c.html("<span class='"+e+"'>"+Core.Functions.grid.formatPrice(d.Monto)+"</span>");c.css("text-align","right");c.css("padding-right","5px")}},{width:"7%",field:"Moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"7%",field:"userCreacionPlataforma",title:"Alta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"7%",field:"userModificacionPlataforma",title:"Operador",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:80,field:"Options",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),filterable:false,columnTemplate:function(e,g,f){if(g.botonEdicion&&g.idOrigenOperacion!=Core.Enums.eMesaOperacionOrigen.Taco){var d=$('<button type="button" title="Modificar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(e);d.on("click",function(){if(a.managerOperacion!=null){Core.Objects.Context.Dialogs.remove(a.managerOperacion);a.managerOperacion.destroy()}a.managerOperacion=new Core.Controls.ManagerOperacion({operacion:g,overlayElement:d,pantallaOrigen:Core.Enums.eManagerOperacionPantallaOrigen.OperacionesUSD,origen:(g.idOrigenOperacion==Core.Enums.eMesaOperacionOrigen.CompraVentaBono)?Core.Enums.eMesaOperacionOrigen.Operacion:g.idOrigenOperacion,onSave:function(){a.loadGridOperacionDetalles()},onDestroy:function(){a.managerOperacion=null}});a.managerOperacion.show();Core.Objects.Context.Dialogs.push(a.managerOperacion)})}if(g.botonEliminacion){var c=$('<button type="button" title="Eliminar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(e);c.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar la operación con ID: "+g.idOperacion+"?",{onAccepted:function(){var h={};h.data={};h.data.id=g.idOperacion;h.data.Borrado=1;h.data.idTipoOperacionTraders=g.idTipoOperacionTraders;var i=new Core.Ajax.ServerRequest({overlayElemet:c,requestUrl:"operacionestraders",requestType:"PUT",requestData:h});i.onSuccess=function(j){a.loadGridOperacionDetalles()};i.request()}}).show()})}}}],toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Operaciones UDS Detalles",columnFields:["idOperacion","FechaConcertacion","FechaLiquidacion","estado","Cuenta","TipoOperacion","Contraparte","Cantidad","Ticker","Precio","Monto","Moneda","userCreacionPlataforma","userModificacionPlataforma"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Operaciones UDS Detalles"}}}});a.btnVolver=a.container.find(".btn-operacion-detalles-volver");a.btnVolver.unbind("click");a.btnVolver.on("click",function(){a.destroy()});a.loadGridOperacionDetalles(a.onLoad)};a.loadGridOperacionDetalles=function(c){var d=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"reporte/detoperacionesusd?FechaOperacion="+a.operacion.FechaOperacion.replaceAll("-","").substr(0,10)+"&Observaciones="+a.operacion.Observaciones+"&UsuarioOperador="+a.operacion.UsuarioOperador+"&idMoneda="+a.operacion.idMoneda+"&idOperacion="+a.operacion.idOperacion,requestType:"GET"});d.onSuccess=function(g){var h=0;var i=0;var e=g.detalle==null?[]:g.detalle;e.forEach(function(k,j){h+=k.CantidadNetaDolares;i+=k.MontoNetoPesos});var f=a.gridOperacionDetalles.swidget().initialOptions;f.dataSource.data=e;f.exportOptions.excel.dataSource.data=e;f.exportOptions.excel.readDataSource=true;a.gridOperacionDetalles.swidget().refresh(f);if(c){c()}};d.request()};a.executeUpdate=function(d,c,f){var e=new Core.Ajax.ServerRequest({overlayElement:c,showOverlay:true,secureRequest:true,requestUrl:f,requestType:"PUT",requestData:d});e.onSuccess=function(g){a.loadGridOperacionDetalles()};e.request()};a.destroy=function(){if(a.managerOperacion!=null){Core.Objects.Context.Dialogs.remove(a.managerOperacion);a.managerOperacion.destroy()}a.gridOperacionDetalles.swidget().destroy();a.onClosed()}};Core.Business.MesaOperacionesUSD.CalculadoraContado=function(b){var a=this;a.container=null;a.onSave=function(){};a.onLoad=function(){};a.onClosed=function(){};a.overlayElement=null;a.operacion=null;$.extend(true,a,b);a.decimalCountCantidad=2;a.decimalCountTipoCambio=4;a.decimalCountMae=8;a.decimalCountMerval=5;a.items=[];a.cuentasBalanz=[];a.especies=[];a.comitenteSeleccionado=null;a.asesorSeleccionado=null;a.show=function(){var c=new Core.Ajax.ServerRequest({allowCache:true,overlayElement:a.overlayElement,showOverlay:true,secureRequest:true,requestUrl:"minutas/version2/cuentasbalanz",requestType:"GET"});c.onSuccess=function(d){var e=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,showOverlay:true,secureRequest:true,requestUrl:"especies",requestType:"GET",requestData:{panel:Core.Enums.ePanel.Bonos}});e.onSuccess=function(f){a.cuentasBalanz=d.cuentas?d.cuentas:[];a.especies=f.especies?f.especies:[];a.lblIdOperacion=a.container.find(".lbl-id-operacion");a.lblIdOperacion.text((a.operacion&&a.operacion.idOperacion)?a.operacion.idOperacion:"No definido");a.lblTipoOperacion=a.container.find(".lbl-tipo-operacion");a.lblTipoOperacion.text((a.operacion&&a.operacion.TipoOperacion)?a.operacion.TipoOperacion:"No definido");a.lblMoneda=a.container.find(".lbl-moneda");a.lblMoneda.text((a.operacion&&a.operacion.Moneda)?a.operacion.Moneda:"No definido");a.ddlPlazo=a.container.find(".dropdown-plazo");a.ddlPlazo.shieldDropDown({dataSource:{data:[{idPlazo:Core.Enums.ePlazo.CI,Descripcion:"CI"},{idPlazo:Core.Enums.ePlazo.D24,Descripcion:"24 hs."},{idPlazo:Core.Enums.ePlazo.D48,Descripcion:"48 hs."}]},valueTemplate:"{idPlazo}",textTemplate:"{Descripcion}",value:((a.operacion&&a.operacion.idPlazo!=null)?a.operacion.idPlazo.toString():""),events:{select:function(g){a.items.forEach(function(i,h){a.clearControlesItem(i,true)})}}});Core.Functions.Validations.toggleValidation(a.ddlPlazo,false);a.lblCantidad=a.container.find(".lbl-cantidad");a.lblCantidad.text((a.operacion&&a.operacion.Cantidad)?Core.Functions.grid.formatNumberWithDecimals(a.operacion.Cantidad):"No definido");a.lblCantidadFinal=a.container.find(".lbl-cantidad-final");a.lblCantidadFinal.text(Core.Functions.grid.formatNumberWithDecimals(0));a.txtComitente=a.container.find(".textbox-comitente");new Core.Controls.DecimalPicker(a.txtComitente,{maxDecimalDigitCount:0,showThousandsSeparator:false,defaultValue:((a.operacion&&a.operacion.NumComitenteCliente)?a.operacion.NumComitenteCliente:""),onKeyUp:function(){a.searchAccount()}});Core.Functions.Validations.toggleValidation(a.txtComitente,false);a.btnBuscarComitente=a.container.find(".button-buscar-comitente");a.btnBuscarComitente.unbind("click");a.btnBuscarComitente.on("click",function(){new Core.Controls.MinutaBuscarCuenta({onSelected:function(g){a.comitenteSeleccionado=g;a.lblDescripcionComitente.text(a.comitenteSeleccionado.Descripcion);a.txtComitente.val(a.comitenteSeleccionado.NumComitente)}}).show()});a.lblDescripcionComitente=a.container.find(".lbl-descripcion-comitente");a.lblDescripcionComitente.text("Comitente no encontrado");if(a.txtComitente.val()){a.searchAccount()}a.txtAsesor=a.container.find(".textbox-asesor");a.txtAsesor.val(((a.operacion&&a.operacion.UsernameAsesor)?a.operacion.UsernameAsesor:""));a.txtAsesor.unbind("keyup");a.txtAsesor.on("keyup",function(g){a.searchAsesor()});Core.Functions.Validations.toggleValidation(a.txtAsesor,false);a.btnBuscarAsesores=a.container.find(".button-buscar-asesores");a.btnBuscarAsesores.unbind("click");a.btnBuscarAsesores.on("click",function(){new Core.Controls.MinutaBuscarAsesor({onSelected:function(g){a.asesorSeleccionado=g;a.lblDescripcionAsesor.text(a.asesorSeleccionado.NombreCompleto+" / "+a.asesorSeleccionado.Unidad);a.txtAsesor.val(a.asesorSeleccionado.Username)}}).show()});a.lblDescripcionAsesor=a.container.find(".lbl-descripcion-asesor");a.lblDescripcionAsesor.text("Asesor no encontrado");if(a.txtAsesor.val()){a.searchAsesor()}a.lblTipoCambioReferencia=a.container.find(".lbl-tipo-cambio-referencia");a.lblTipoCambioReferencia.text((a.operacion&&a.operacion.Precio)?Core.Functions.grid.formatNumberWithDecimals(a.operacion.Precio):"No definido");a.lblTipoCambioReferenciaFinal=a.container.find(".lbl-tipo-cambio-referencia-final");a.lblTipoCambioReferenciaFinal.text(Core.Functions.grid.formatNumberWithDecimals(0));a.txtTipoCambioCliente=a.container.find(".textbox-tipo-cambio-cliente");new Core.Controls.DecimalPicker(a.txtTipoCambioCliente,{maxDecimalDigitCount:a.decimalCountTipoCambio,showThousandsSeparator:true,defaultValue:"",onKeyUp:function(){a.items.forEach(function(h,g){var i=Core.Functions.Decimal.parseFloat(h.txtPrecioDolares.val());var j=Core.Functions.Decimal.parseFloat(a.txtTipoCambioCliente.val());h.controlPrecioClientePesos.setValue(Core.Functions.Decimal.parseFloat((i*j).toFixed((h.ddlMercado.swidget().selectedItem()?h.ddlMercado.swidget().selectedItem().decimalCount:a.decimalCountMae))));h.controlPrecioClientePesos.onKeyUp()})}});Core.Functions.Validations.toggleValidation(a.txtTipoCambioCliente,false);a.lblTipoCambioClienteFinal=a.container.find(".lbl-tipo-cambio-cliente-final");a.lblTipoCambioClienteFinal.text(Core.Functions.grid.formatNumberWithDecimals(0));a.btnNuevoItem=a.container.find(".btn-nuevo-item");a.btnNuevoItem.unbind("click");a.btnNuevoItem.on("click",function(){a.addNewItem()});a.divItems=a.container.find(".div-items");a.divItems.empty();a.btnConfirmar=a.container.find(".btn-confirmar");a.btnConfirmar.unbind("click");a.btnConfirmar.on("click",function(){Core.Functions.Validations.toggleValidation(a.ddlPlazo,false);Core.Functions.Validations.toggleValidation(a.txtTipoCambioCliente,false);Core.Functions.Validations.toggleValidation(a.txtComitente,false);Core.Functions.Validations.toggleValidation(a.txtAsesor,false);a.items.forEach(function(k,j){Core.Functions.Validations.toggleValidation(k.ddlMercado,false);Core.Functions.Validations.toggleValidation(k.ddlTicker,false);Core.Functions.Validations.toggleValidation(k.txtNominales,false);Core.Functions.Validations.toggleValidation(k.txtPrecioDolares,false);Core.Functions.Validations.toggleValidation(k.txtPrecioReferenciaPesos,false);Core.Functions.Validations.toggleValidation(k.txtPrecioClientePesos,false);Core.Functions.Validations.toggleValidation(k.ddlCuentaIda,false);Core.Functions.Validations.toggleValidation(k.ddlCuentaVuelta,false);Core.Functions.Validations.toggleValidation(k.txtFechaConcertacion,false)});var i={value:true};var g={data:{}};g.data.idOperacion=a.operacion.idOperacion;g.data.idPlazo=Core.Functions.Validations.getValidatedDropDownValue(a.ddlPlazo,i);g.data.PrecioCliente=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtTipoCambioCliente,i));if(a.asesorSeleccionado){g.data.idPersonaAsesor=a.asesorSeleccionado.idPersonaAsesor}else{Core.Functions.Validations.toggleValidation(a.txtAsesor,true);i.value=false}if(a.comitenteSeleccionado){g.data.idCuentaCliente=a.comitenteSeleccionado.idCuenta;g.data.NumComitente=a.comitenteSeleccionado.NumComitente}g.data.Items=[];a.items.forEach(function(k,j){g.data.Items.push({Ticker:Core.Functions.Validations.getValidatedSwidgetValue(k.ddlTicker,i),idMercado:Core.Functions.Validations.getValidatedDropDownValue(k.ddlMercado,i),Cantidad:Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(k.txtNominales,i)),PrecioBonoDolares:Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(k.txtPrecioDolares,i)),PrecioReferenciaPesos:Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(k.txtPrecioReferenciaPesos,i)),PrecioClientePesos:Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(k.txtPrecioClientePesos,i)),CuentaIda:Core.Functions.Validations.getValidatedDropDownValue(k.ddlCuentaIda,i),CuentaVuelta:Core.Functions.Validations.getValidatedDropDownValue(k.ddlCuentaVuelta,i),FechaConcertacion:Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(k.txtFechaConcertacion,i))})});if(i.value){var h=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.btnConfirmar,secureRequest:true,requestUrl:"minutas/version2/contados/detalles",requestType:"POST",requestData:g});h.onSuccess=function(j){new Core.Controls.Dialog("Aviso","La carga de contados se ha realizado exitosamente.",{displayButtons:{close:true,accept:false}}).show();a.onSave();a.destroy()};h.request()}});a.btnVolver=a.container.find(".btn-volver");a.btnVolver.unbind("click");a.btnVolver.on("click",function(){a.destroy()});a.onLoad()};e.request()};c.request()};a.addNewItem=function(){var c={};c.divItem=$("<tr></tr>").appendTo(a.divItems);c.divMercado=$("<td></td>").appendTo(c.divItem);c.divContainerMercado=$('<div class="control-group form-group" style="margin: 5px 5px 5px 0px;"></div>').appendTo(c.divMercado);c.ddlMercado=$('<select class="form-control"></select>').appendTo(c.divContainerMercado);c.ddlMercado.shieldDropDown({dataSource:{data:[{idMercado:Core.Enums.eMinutaMercado.Merval,Descripcion:"Merval",decimalCount:a.decimalCountMerval},{idMercado:Core.Enums.eMinutaMercado.Mae,Descripcion:"MAE",decimalCount:a.decimalCountMae}]},valueTemplate:"{idMercado}",textTemplate:"{Descripcion}",value:"",events:{select:function(d){c.controlPrecioDolares.setMaxDecimalDigitCount((c.ddlMercado.swidget().selectedItem()?c.ddlMercado.swidget().selectedItem().decimalCount:a.decimalCountMae));c.controlPrecioReferenciaPesos.setMaxDecimalDigitCount((c.ddlMercado.swidget().selectedItem()?c.ddlMercado.swidget().selectedItem().decimalCount:a.decimalCountMae));c.controlPrecioClientePesos.setMaxDecimalDigitCount((c.ddlMercado.swidget().selectedItem()?c.ddlMercado.swidget().selectedItem().decimalCount:a.decimalCountMae));a.clearControlesItem(c,true)}}});Core.Functions.Validations.toggleValidation(c.ddlMercado,false);c.divTicker=$("<td></td>").appendTo(c.divItem);c.divContainerTicker=$('<div class="control-group form-group" style="margin: 5px 5px 5px 0px;"></div>').appendTo(c.divTicker);c.ddlTicker=$('<select class="form-control"></select>').appendTo(c.divContainerTicker);c.ddlTicker.shieldComboBox({dataSource:{data:a.especies},valueTemplate:"{Ticker}",textTemplate:"{DisplayTicker} | {Descripcion}",value:"",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}},events:{change:function(d){a.setControlesByTicket(c)},focus:function(d){var f=c.ddlTicker.swidget().initialOptions;f.value="";c.ddlTicker.swidget().refresh(f);c.ddlTicker.swidget().focus()}}});Core.Functions.Validations.toggleValidation(c.ddlTicker,false);c.divPrecioDolares=$("<td></td>").appendTo(c.divItem);c.divContainerPrecioDolares=$('<div class="control-group form-group" style="margin: 5px 0px 5px 0px;"></div>').appendTo(c.divPrecioDolares);c.txtPrecioDolares=$('<input type="text" class="form-control" />').appendTo(c.divContainerPrecioDolares);c.controlPrecioDolares=new Core.Controls.DecimalPicker(c.txtPrecioDolares,{maxDecimalDigitCount:(c.ddlMercado.swidget().selectedItem()?c.ddlMercado.swidget().selectedItem().decimalCount:a.decimalCountMae),showThousandsSeparator:true,defaultValue:"",onKeyUp:function(){var f=Core.Functions.Decimal.parseFloat(c.txtPrecioDolares.val());var h=(a.operacion&&a.operacion.Precio)?Core.Functions.Decimal.parseFloat(a.operacion.Precio):0;var g=Core.Functions.Decimal.parseFloat(a.txtTipoCambioCliente.val());c.controlPrecioReferenciaPesos.setValue(Core.Functions.Decimal.parseFloat((f*h).toFixed((c.ddlMercado.swidget().selectedItem()?c.ddlMercado.swidget().selectedItem().decimalCount:a.decimalCountMae))));c.controlPrecioReferenciaPesos.onKeyUp();c.controlPrecioClientePesos.setValue(Core.Functions.Decimal.parseFloat((f*g).toFixed((c.ddlMercado.swidget().selectedItem()?c.ddlMercado.swidget().selectedItem().decimalCount:a.decimalCountMae))));c.controlPrecioClientePesos.onKeyUp();var d=((a.operacion&&a.operacion.Cantidad)?Core.Functions.Decimal.parseFloat(a.operacion.Cantidad):0);a.items.forEach(function(k,l){if(c!=k){var j=Core.Functions.Decimal.parseFloat(k.txtNominales.val());var m=Core.Functions.Decimal.parseFloat(k.txtPrecioDolares.val());d-=Core.Functions.Decimal.parseFloat((j*m).toFixed(a.decimalCountCantidad))}});var e=f?Math.floor(d/f):0;c.controlNominales.setValue(e);c.controlNominales.onKeyUp()}});Core.Functions.Validations.toggleValidation(c.txtPrecioDolares,false);c.divNominales=$("<td></td>").appendTo(c.divItem);c.divContainerNominales=$('<div class="control-group form-group" style="margin: 5px 0px 5px 0px;"></div>').appendTo(c.divNominales);c.txtNominales=$('<input type="text" class="form-control" />').appendTo(c.divContainerNominales);c.controlNominales=new Core.Controls.DecimalPicker(c.txtNominales,{maxDecimalDigitCount:0,showThousandsSeparator:false,defaultValue:"",onKeyUp:function(){var e=Core.Functions.Decimal.parseFloat(c.txtPrecioDolares.val());var d=Core.Functions.Decimal.parseFloat(c.txtNominales.val());var f=Core.Functions.Decimal.parseFloat((e*d).toFixed(a.decimalCountCantidad));c.lblTotalUSD.text("USD: "+Core.Functions.grid.formatNumberWithDecimals(f));a.setTotalCantidad();a.setTipoCambioReferenciaFinal();a.setTipoCambioClienteFinal()}});Core.Functions.Validations.toggleValidation(c.txtNominales,false);c.divPrecioReferenciaPesos=$("<td></td>").appendTo(c.divItem);c.divContainerPrecioReferenciaPesos=$('<div class="control-group form-group" style="margin: 5px 0px 5px 0px;"></div>').appendTo(c.divPrecioReferenciaPesos);c.txtPrecioReferenciaPesos=$('<input type="text" class="form-control" />').appendTo(c.divContainerPrecioReferenciaPesos);c.controlPrecioReferenciaPesos=new Core.Controls.DecimalPicker(c.txtPrecioReferenciaPesos,{maxDecimalDigitCount:(c.ddlMercado.swidget().selectedItem()?c.ddlMercado.swidget().selectedItem().decimalCount:a.decimalCountMae),showThousandsSeparator:true,defaultValue:"",onKeyUp:function(){var d=Core.Functions.Decimal.parseFloat(c.txtPrecioDolares.val());var e=Core.Functions.Decimal.parseFloat(c.txtPrecioReferenciaPesos.val());var f=d?Core.Functions.Decimal.parseFloat((e/d).toFixed(a.decimalCountTipoCambio)):0;c.lblTipoCambioReferencia.text("TC Ref: "+Core.Functions.grid.formatNumberWithDecimals(f));a.setTipoCambioReferenciaFinal()}});Core.Functions.Validations.toggleValidation(c.txtPrecioReferenciaPesos,false);c.divPrecioClientePesos=$("<td></td>").appendTo(c.divItem);c.divContainerPrecioClientePesos=$('<div class="control-group form-group" style="margin: 5px 0px 5px 0px;"></div>').appendTo(c.divPrecioClientePesos);c.txtPrecioClientePesos=$('<input type="text" class="form-control" />').appendTo(c.divContainerPrecioClientePesos);c.controlPrecioClientePesos=new Core.Controls.DecimalPicker(c.txtPrecioClientePesos,{maxDecimalDigitCount:(c.ddlMercado.swidget().selectedItem()?c.ddlMercado.swidget().selectedItem().decimalCount:a.decimalCountMae),showThousandsSeparator:true,defaultValue:"",onKeyUp:function(){var e=Core.Functions.Decimal.parseFloat(c.txtPrecioDolares.val());var d=Core.Functions.Decimal.parseFloat(c.txtPrecioClientePesos.val());var f=e?Core.Functions.Decimal.parseFloat((d/e).toFixed(a.decimalCountTipoCambio)):0;c.lblTipoCambioCliente.text("TC Cli: "+Core.Functions.grid.formatNumberWithDecimals(f));a.setTipoCambioClienteFinal()}});Core.Functions.Validations.toggleValidation(c.txtPrecioClientePesos,false);c.divCuentaIda=$("<td></td>").appendTo(c.divItem);c.divContainerCuentaIda=$('<div class="control-group form-group" style="margin: 5px 5px 5px 0px;"></div>').appendTo(c.divCuentaIda);c.ddlCuentaIda=$('<select class="form-control"></select>').appendTo(c.divContainerCuentaIda);c.ddlCuentaIda.shieldComboBox({dataSource:{data:a.cuentasBalanz},valueTemplate:"{idCuentaBalanz}",textTemplate:"{CuentaBalanz}",value:"",autoComplete:{enabled:true,filter:{or:[{path:"CuentaBalanz",filter:"contains",value:""}]}},events:{focus:function(d){var f=c.ddlCuentaIda.swidget().initialOptions;f.value="";c.ddlCuentaIda.swidget().refresh(f);c.ddlCuentaIda.swidget().focus()}}});Core.Functions.Validations.toggleValidation(c.ddlCuentaIda,false);c.divCuentaVuelta=$("<td></td>").appendTo(c.divItem);c.divContainerCuentaVuelta=$('<div class="control-group form-group" style="margin: 5px 5px 5px 0px;"></div>').appendTo(c.divCuentaVuelta);c.ddlCuentaVuelta=$('<select class="form-control"></select>').appendTo(c.divContainerCuentaVuelta);c.ddlCuentaVuelta.shieldComboBox({dataSource:{data:a.cuentasBalanz},valueTemplate:"{idCuentaBalanz}",textTemplate:"{CuentaBalanz}",value:"",autoComplete:{enabled:true,filter:{or:[{path:"CuentaBalanz",filter:"contains",value:""}]}},events:{focus:function(d){var f=c.ddlCuentaVuelta.swidget().initialOptions;f.value="";c.ddlCuentaVuelta.swidget().refresh(f);c.ddlCuentaVuelta.swidget().focus()}}});Core.Functions.Validations.toggleValidation(c.ddlCuentaVuelta,false);c.divFechaConcertacion=$("<td></td>").appendTo(c.divItem);c.divContainerFechaConcertacion=$('<div class="control-group form-group" style="margin: 5px 5px 5px 0px;"></div>').appendTo(c.divFechaConcertacion);c.txtFechaConcertacion=$('<select class="form-control"></select>').appendTo(c.divContainerFechaConcertacion);c.txtFechaConcertacion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date()});Core.Functions.Validations.toggleValidation(c.txtFechaConcertacion,false);c.divResumen=$("<td></td>").appendTo(c.divItem);c.lblTotalUSD=$("<p>USD: "+Core.Functions.grid.formatNumberWithDecimals(0)+"</p>").appendTo(c.divResumen);c.lblTipoCambioReferencia=$("<p>TC Ref: "+Core.Functions.grid.formatNumberWithDecimals(0)+"</p>").appendTo(c.divResumen);c.lblTipoCambioCliente=$("<p>TC Cli: "+Core.Functions.grid.formatNumberWithDecimals(0)+"</p>").appendTo(c.divResumen);c.divAcciones=$("<td></td>").appendTo(c.divItem);c.btnEliminar=$('<button type="button" title="Eliminar item" class="btn-sm balanz-button right"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(c.divAcciones);c.btnEliminar.click(function(){c.divItem.hide();a.items.remove(c);a.setTotalCantidad();a.setTipoCambioReferenciaFinal();a.setTipoCambioClienteFinal()});a.items.push(c)};a.searchAccount=function(){if(a.txtComitente.val()){var c=new Core.Ajax.ServerRequest({showOverlay:false,secureRequest:true,requestUrl:"cuentas/numdescripcion/"+Core.Enums.eVehiculo.BCV+"/"+a.txtComitente.val(),requestType:"GET"});c.onSuccess=function(d){if(d.cuentas.length==1){a.comitenteSeleccionado=d.cuentas[0];a.lblDescripcionComitente.text(a.comitenteSeleccionado.Descripcion)}else{a.comitenteSeleccionado=null;a.lblDescripcionComitente.text("Comitente no encontrado")}};c.request()}else{a.comitenteSeleccionado=null;a.lblDescripcionComitente.text("Comitente no encontrado")}};a.searchAsesor=function(){if(a.txtAsesor.val()&&a.txtAsesor.val().length>=4){var c=new Core.Ajax.ServerRequest({showOverlay:false,secureRequest:true,requestUrl:"minutas/version2/asesores/"+a.txtAsesor.val(),requestType:"GET"});c.onSuccess=function(e){var d=null;e.asesores.forEach(function(g,f){if(g.Username==a.txtAsesor.val()){d=g}});if(d){a.asesorSeleccionado=d;a.lblDescripcionAsesor.text(a.asesorSeleccionado.NombreCompleto+" / "+a.asesorSeleccionado.Unidad)}else{a.asesorSeleccionado=null;a.lblDescripcionAsesor.text("Asesor no encontrado")}};c.request()}else{a.asesorSeleccionado=null;a.lblDescripcionAsesor.text("Asesor no encontrado")}};a.setControlesByTicket=function(c){a.clearControlesItem(c,false);if(c.ddlTicker.swidget().value()&&a.ddlPlazo.swidget().selectedItem()&&c.ddlMercado.swidget().selectedItem()){var d=new Core.Ajax.ServerRequest({showOverlay:false,secureRequest:true,requestUrl:"minutas/version2/lastprice/"+(c.ddlTicker.swidget().selectedItem()?c.ddlTicker.swidget().selectedItem().DisplayTicker:c.ddlTicker.swidget().value())+"/"+a.ddlPlazo.swidget().selectedItem().idPlazo+"/"+a.operacion.idMoneda+"/"+c.ddlMercado.swidget().selectedItem().idMercado,requestType:"GET"});d.onSuccess=function(f){var e=Core.Functions.Decimal.parseFloat(f.UltimoPrecioDecimal).toFixed((c.ddlMercado.swidget().selectedItem()?c.ddlMercado.swidget().selectedItem().decimalCount:a.decimalCountMae));c.controlPrecioDolares.setValue(e);c.controlPrecioDolares.onKeyUp()};d.request()}};a.setTotalCantidad=function(){var c=0;a.items.forEach(function(f,e){var d=Core.Functions.Decimal.parseFloat(f.txtNominales.val());var g=Core.Functions.Decimal.parseFloat(f.txtPrecioDolares.val());c+=Core.Functions.Decimal.parseFloat((d*g).toFixed(a.decimalCountCantidad))});a.lblCantidadFinal.text(Core.Functions.grid.formatNumberWithDecimals(Core.Functions.Decimal.parseFloat(c.toFixed(a.decimalCountCantidad))))};a.setTipoCambioReferenciaFinal=function(){var e=0;var d=0;a.items.forEach(function(h,g){var f=Core.Functions.Decimal.parseFloat(h.txtNominales.val());var i=Core.Functions.Decimal.parseFloat(h.txtPrecioDolares.val());var j=Core.Functions.Decimal.parseFloat(h.txtPrecioReferenciaPesos.val());e+=Core.Functions.Decimal.parseFloat((f*j).toFixed(a.decimalCountTipoCambio));d+=Core.Functions.Decimal.parseFloat((f*i).toFixed(a.decimalCountTipoCambio))});var c=d?Core.Functions.Decimal.parseFloat((e/d).toFixed(a.decimalCountTipoCambio)):0;a.lblTipoCambioReferenciaFinal.text(Core.Functions.grid.formatNumberWithDecimals(c))};a.setTipoCambioClienteFinal=function(){var e=0;var d=0;a.items.forEach(function(h,g){var f=Core.Functions.Decimal.parseFloat(h.txtNominales.val());var j=Core.Functions.Decimal.parseFloat(h.txtPrecioDolares.val());var i=Core.Functions.Decimal.parseFloat(h.txtPrecioClientePesos.val());e+=Core.Functions.Decimal.parseFloat((f*i).toFixed(a.decimalCountTipoCambio));d+=Core.Functions.Decimal.parseFloat((f*j).toFixed(a.decimalCountTipoCambio))});var c=d?Core.Functions.Decimal.parseFloat((e/d).toFixed(a.decimalCountTipoCambio)):0;a.lblTipoCambioClienteFinal.text(Core.Functions.grid.formatNumberWithDecimals(c))};a.clearControlesItem=function(d,c){if(c){d.ddlTicker.swidget().value("")}d.txtNominales.val("");d.txtPrecioDolares.val("");d.txtPrecioReferenciaPesos.val("");d.txtPrecioClientePesos.val("");d.ddlCuentaIda.swidget().value("");d.ddlCuentaVuelta.swidget().value("");d.txtFechaConcertacion.swidget().value(new Date());d.lblTotalUSD.text("USD: "+Core.Functions.grid.formatNumberWithDecimals(0));d.lblTipoCambioReferencia.text("TC Ref: "+Core.Functions.grid.formatNumberWithDecimals(0));d.lblTipoCambioCliente.text("TC Cli: "+Core.Functions.grid.formatNumberWithDecimals(0));a.setTotalCantidad();a.setTipoCambioReferenciaFinal();a.setTipoCambioClienteFinal()};a.destroy=function(){a.ddlPlazo.swidget().destroy();a.onClosed()}};Core.Business.MesaOperacionesUSD.ContableDetalles=function(b){var a=this;a.divModal=$(".div-modal-contable-detalles");a.fecha=null;$.extend(true,a,b);a.show=function(){var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"operacionesmonedas/cnvcable/detalles/"+a.fecha,requestType:"GET"});c.onSuccess=function(d){a.gridDetalles=a.divModal.find(".grid-detalles");a.gridDetalles.shieldGrid({dataSource:{data:d.detalles?d.detalles:[],aggregate:[{field:"Monto",aggregate:"sum"},{field:"MontoSemanaAnterior",aggregate:"sum"},{field:"MontoSemanaActual",aggregate:"sum"}]},selection:false,rowHover:false,columns:[{width:"5%",field:"idOperacionMoneda",title:"ID",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatIntegerNumber},{width:"8%",field:"FechaConcertacion",title:"Concertación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatStringDate},{width:"7%",field:"PlazoDescripcion",title:"Plazo",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"8%",field:"FechaLiquidacion",title:"Liquidación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatStringDate},{width:"8%",field:"FechaContableDolar",title:"Contable Dólar",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatStringDate},{width:"7%",field:"ParkingDescripcion",title:"Contable Cable",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"7%",field:"TipoOperacionDescripcion",title:"Tipo Operación",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{footerTemplate:"<div style='text-align: right;'>{sum:n2}</div>",width:"10%",field:"Monto",title:"Monto",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNumberWithDecimals},{footerTemplate:"<div style='text-align: right;'>{sum:n2}</div>",width:"10%",field:"MontoSemanaAnterior",title:"Monto Semana Anterior",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNumberWithDecimals},{footerTemplate:"<div style='text-align: right;'>{sum:n2}</div>",width:"10%",field:"MontoSemanaActual",title:"Monto Semana Actual",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNumberWithDecimals},{width:"20%",field:"Observaciones",title:"Obs",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString}],toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{readDataSource:true,dataSource:{data:d.detalles?d.detalles:[]},author:"Balanz Capital Valores S.A.",fileName:"Detalles Contable",columnFields:["idOperacionMoneda","FechaConcertacion","PlazoDescripcion","FechaLiquidacion","FechaContableDolar","ParkingDescripcion","TipoOperacionDescripcion","Monto","MontoSemanaAnterior","MontoSemanaActual","Observaciones"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Detalles Contable"}}}});a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.divModal.modal({show:true})};c.request()};a.destroy=function(){a.gridDetalles.swidget().destroy()}};Core.Business.MesaParamsSubidaBajada=new function(){var a=this;a.id="mesaConfParamsSubidaBajada";a.decimalCount=10;a.txtUtilidadMercado=null;a.txtMargenINT=null;a.txtMargenBCI=null;a.btnActualizar=null;a.divAlert=null;a.divRecalculoFotos=null;a.btnRecalculoFotos=null;a.pageOptions=null;a.window=$(window);a.init=function(b,c){Core.loadPage("mesa-parametros-subida-bajada.html",function(){document.title="Parámetros de Subida y Bajada";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.txtUtilidadMercado=$(".textbox-utilidad-mercado");a.txtMargenINT=$(".textbox-margen-int");a.txtMargenBCI=$(".textbox-margen-bci");a.btnActualizar=$(".btn-actualizar");a.divRecalculoFotos=$(".div-recalculo-fotos");a.btnRecalculoFotos=$(".btn-recalculo-fotos");a.divAlert=$(".div-alert");a.divAlert.slideUp();a.divRecalculoFotos.hide();if(a.pageOptions&&a.pageOptions.RecalcularFotosBoton){a.divRecalculoFotos.show()}a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadControls,"Core.Business.MesaParamsSubidaBajada")})};a.initControls=function(){new Core.Controls.DecimalPicker(a.txtUtilidadMercado,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:""});new Core.Controls.DecimalPicker(a.txtMargenBCI,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:""});new Core.Controls.DecimalPicker(a.txtMargenINT,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:""});a.btnActualizar.on("click",function(){a.divAlert.slideUp();var b="";if(!a.txtUtilidadMercado.val()||Core.Functions.Decimal.parseFloat(a.txtUtilidadMercado.val())<0||Core.Functions.Decimal.parseFloat(a.txtUtilidadMercado.val())>100){b+="Utilidad Mercado"}if(!a.txtMargenBCI.val()||Core.Functions.Decimal.parseFloat(a.txtMargenBCI.val())<0||Core.Functions.Decimal.parseFloat(a.txtMargenBCI.val())>100){b+=(b!="")?", Margen BCI":"Margen BCI"}if(!a.txtMargenINT.val()||Core.Functions.Decimal.parseFloat(a.txtMargenINT.val())<0||Core.Functions.Decimal.parseFloat(a.txtMargenINT.val())>100){b+=(b!="")?", Margen INT":"Margen INT"}if(b==""){var c={data:{}};c.data.utilidadMerc=a.txtUtilidadMercado.val();c.data.margenFGT=a.txtMargenINT.val();c.data.margenBCI=a.txtMargenBCI.val();var d=new Core.Ajax.ServerRequest({overlayElement:a.btnActualizar,showOverlay:true,secureRequest:true,requestUrl:"subidasbajadas/config",requestType:"PUT",requestData:c});d.onSuccess=function(e){};d.request()}else{a.divAlert.text("Los montos ingresados deben ser valores entre 0 y 100. ( "+b+" ).");a.divAlert.slideDown()}});a.btnRecalculoFotos.on("click",function(){var b=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"recalcularfotos",requestType:"GET"});b.onSuccess=function(c){if(c.mensaje){var d=new Core.Controls.Dialog("Aviso",c.mensaje,{displayButtons:{close:true,accept:false}});d.show()}};b.request()})};a.loadControls=function(){var b=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"subidasbajadas/config",requestType:"GET"});b.onSuccess=function(c){a.txtUtilidadMercado.val(c.parametros[0].utilidadMerc);a.txtMargenINT.val(c.parametros[0].margenFGT);a.txtMargenBCI.val(c.parametros[0].margenBCI)};b.request()}};Core.Business.PosicionConsolidadaMesa=new function(){var a=this;var c="1";var b="2";a.id="posicionConsolidadaMesa";a.header=null;a.txtDateFrom=null;a.divTenenciaBcv=null;a.divTenenciaInt=null;a.divTenenciaBci=null;a.gridTenenciaBcv=null;a.gridTenenciaInt=null;a.gridTenenciaBci=null;a.btnDetalles=null;a.txtFilterTenenciaBcv=null;a.txtFilterTenenciaInt=null;a.txtFilterTenenciaBci=null;a.timeoutTenenciaBcv=null;a.timeoutTenenciaInt=null;a.timeoutTenenciaBci=null;a.headerLabels={divTotalDolaresCable:null,lblTotalDolaresCable:null,divTotalDolaresMep:null,lblTotalDolaresMep:null,divTotalDolares:null,lblTotalDolares:null};a.btnRefresh=null;a.window=$(window);a.init=function(d,e){Core.loadPage("mesa-posicion-consolidada.html",function(){a.idDefaultAccount=d;a.idDefaultProfile=e;document.title="Posición Consolidada";a.headerLabels.divTotalDolaresMep=$(".div-total-dolares-mep");a.headerLabels.divTotalDolaresCable=$(".div-total-dolares-cable");a.headerLabels.divTotalDolares=$(".div-total-dolares");a.headerLabels.lblTotalDolaresMep=$(".lbl-total-dolares-mep");a.headerLabels.lblTotalDolaresCable=$(".lbl-total-dolares-cable");a.headerLabels.lblTotalDolares=$(".lbl-total-dolares");a.txtDateFrom=$(".date-picker-from");a.btnDetalles=$(".btn-detalles");a.btnRefresh=$(".btn-refresh");a.divTenenciaBcv=$(".div-tenencia-bcv");a.gridTenenciaBcv=$(".grid-tenencia-bcv");a.divTenenciaInt=$(".div-tenencia-int");a.gridTenenciaInt=$(".grid-tenencia-int");a.divTenenciaBci=$(".div-tenencia-bci");a.gridTenenciaBci=$(".grid-tenencia-bci");a.txtFilterTenenciaBcv=$(".textbox-tenencia-bcv");a.txtFilterTenenciaInt=$(".textbox-tenencia-int");a.txtFilterTenenciaBci=$(".textbox-tenencia-bci");a.initDatePicker();a.initCharts();a.initButtons();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,d,e,function(){a.loadCharts()},"Core.Business.PosicionConsolidadaMesa")})};a.initButtons=function(){a.btnRefresh.click(function(){a.loadCharts()});a.btnDetalles.click(function(){function d(g){return g.DeudaAClientesCI!=0||g.DeudaAClientes24!=0||g.DeudaAClientes48!=0||g.DeudaAClientesFuturo!=0}function e(g){return g.DeudaDeClientesCI!=0||g.DeudaDeClientes24!=0||g.DeudaDeClientes48!=0||g.DeudaDeClientesFuturo!=0}var f=new Core.Ajax.ServerRequest({showOverlay:true,requestUrl:"deudaconsolidada",requestType:"GET",requestData:{Fecha:Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value())}});f.onSuccess=function(k){var h="";if(k.deuda.length>0){h+="<h4>Deuda con los clientes</h4>";h+="<table class='table table-striped'>";h+="<thead><tr><td align='center'><strong>Pesos</strong></td><td align='center'><strong>Dólares Cable</strong></td><td align='center'><strong>Dólares Mep</strong></td></tr></thead>";h+="<tbody>";h+="<tr>";h+="<td align='center'>"+Core.Functions.grid.formatNumber(k.deuda[0].TotalDeudaPesos)+"</td>";h+="<td align='center'>"+Core.Functions.grid.formatNumber(k.deuda[0].TotalDeudaCable)+"</td>";h+="<td align='center'>"+Core.Functions.grid.formatNumber(k.deuda[0].TotalDeudaMEP)+"</td>";h+="</tr>";h+="</tbody>";h+="</table>";h+="<table class='table table-striped'>";h+="<thead><tr><th>Descripción</th><th>Inmediato</th><th>24 hs</th><th>48 hs</th><th>Futuro</th></tr></thead>";h+="<tbody>";for(var j=0;j<k.deuda.length;j++){if(d(k.deuda[j])){h+="<tr>";h+="<td>"+k.deuda[j].Descripcion+"</td>";h+="<td>"+Core.Functions.grid.formatNumber(k.deuda[j].DeudaAClientesCI)+"</td>";h+="<td>"+Core.Functions.grid.formatNumber(k.deuda[j].DeudaAClientes24)+"</td>";h+="<td>"+Core.Functions.grid.formatNumber(k.deuda[j].DeudaAClientes48)+"</td>";h+="<td>"+Core.Functions.grid.formatNumber(k.deuda[j].DeudaAClientesFuturo)+"</td>";h+="</tr>"}}h+="</tbody>";h+="</table>";h+="<h4>Deuda de clientes</h4>";h+="<table class='table table-striped'>";h+="<thead><tr><td align='center'><strong>Pesos</strong></td><td align='center'><strong>Dólares Cable</strong></td><td align='center'><strong>Dólares Mep</strong></td></tr></thead>";h+="<tbody>";h+="<tr>";h+="<td align='center'>"+Core.Functions.grid.formatNumber(k.deuda[0].TotalDeudaDeClientesPesos)+"</td>";h+="<td align='center'>"+Core.Functions.grid.formatNumber(k.deuda[0].TotalDeudaDeClientesCable)+"</td>";h+="<td align='center'>"+Core.Functions.grid.formatNumber(k.deuda[0].TotalDeudaDeClientesMEP)+"</td>";h+="</tr>";h+="</tbody>";h+="</table>";h+="<table class='table table-striped'>";h+="<thead><tr><th>Descripción</th><th>Inmediato</th><th>24 hs</th><th>48 hs</th><th>Futuro</th></tr></thead>";h+="<tbody>";for(var j=0;j<k.deuda.length;j++){if(e(k.deuda[j])){h+="<tr>";h+="<td>"+k.deuda[j].Descripcion+"</td>";h+="<td>"+Core.Functions.grid.formatNumber(k.deuda[j].DeudaDeClientesCI)+"</td>";h+="<td>"+Core.Functions.grid.formatNumber(k.deuda[j].DeudaDeClientes24)+"</td>";h+="<td>"+Core.Functions.grid.formatNumber(k.deuda[j].DeudaDeClientes48)+"</td>";h+="<td>"+Core.Functions.grid.formatNumber(k.deuda[j].DeudaDeClientesFuturo)+"</td>";h+="</tr>"}}h+="</tbody>";h+="</table>"}var g=new Core.Controls.Dialog("Posición con los clientes",h,{displayButtons:{close:true,accept:false}});g.show()};f.request()})};a.initDatePicker=function(){a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(d){a.loadCharts()}}})};a.initCharts=function(){var e=[];e.push({width:"30%",field:"ticker",title:"Instrumento",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length)});e.push({width:"14%",field:"disponibleCI",title:"Posición Liquidada",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatNumberWithColor});e.push({width:"14%",field:"disponibleCIPendiente",title:"Pendiente Inmediato",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatNumberWithColor});e.push({width:"14%",field:"disponible24",title:"Pendiente 24 horas",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatNumberWithColor});e.push({width:"14%",field:"disponible48",title:"Pendiente 48 horas",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatNumberWithColor});e.push({width:"14%",field:"disponibleFuturo",title:"Posición Finish",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatNumberWithColor});e.push({field:"",title:" ",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"4%",headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),columnTemplate:function(h,j,i){if(j.habilitarDetalle){var g=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(h);g.on("click",function(){new Core.Controls.MesaDetalleMontoAcumulado({overlayElement:g,requestData:{FechaFin:Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()),idCuenta:j.idCuenta,idNegocio:j.idNegocio,idInstrumento:j.idInstrumento,idDerivado:j.idDerivado}}).show()})}}});a.gridTenenciaBcv.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},noRecordsText:"No hay información de Tenencia BCV",columns:e,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Tenencia BCV",columnFields:["ticker","disponibleCI","disponibleCIPendiente","disponible24","disponible48","disponibleFuturo"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Tenencia BCV"}}}});var f=[];f.push({width:"30%",field:"ticker",title:"Instrumento",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(f.length)});f.push({width:"14%",field:"disponibleCI",title:"Posición Liquidada",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(f.length),format:Core.Functions.grid.formatNumberWithColor});f.push({width:"14%",field:"disponibleCIPendiente",title:"Pendiente Inmediato",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(f.length),format:Core.Functions.grid.formatNumberWithColor});f.push({width:"14%",field:"disponible24",title:"Pendiente 24 horas",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(f.length),format:Core.Functions.grid.formatNumberWithColor});f.push({width:"14%",field:"disponible48",title:"Pendiente 48 horas",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(f.length),format:Core.Functions.grid.formatNumberWithColor});f.push({width:"14%",field:"disponibleFuturo",title:"Posición Finish",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(f.length),format:Core.Functions.grid.formatNumberWithColor});f.push({field:"",title:" ",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"4%",headerAttributes:Core.Functions.grid.getHeaderAttribute(f.length),columnTemplate:function(h,j,i){if(j.habilitarDetalle){var g=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(h);g.on("click",function(){new Core.Controls.MesaDetalleMontoAcumulado({overlayElement:g,requestData:{FechaFin:Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()),idCuenta:j.idCuenta,idNegocio:j.idNegocio,idInstrumento:j.idInstrumento,idDerivado:j.idDerivado}}).show()})}}});a.gridTenenciaInt.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},noRecordsText:"No hay información de Tenencia INT",columns:f,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Tenencia INT",columnFields:["ticker","disponibleCI","disponibleCIPendiente","disponible24","disponible48","disponibleFuturo"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Tenencia INT"}}}});var d=[];d.push({width:"30%",field:"ticker",title:"Instrumento",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});d.push({width:"14%",field:"disponibleCI",title:"Posición Liquidada",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatNumberWithColor});d.push({width:"14%",field:"disponibleCIPendiente",title:"Pendiente Inmediato",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatNumberWithColor});d.push({width:"14%",field:"disponible24",title:"Pendiente 24 horas",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatNumberWithColor});d.push({width:"14%",field:"disponible48",title:"Pendiente 48 horas",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatNumberWithColor});d.push({width:"14%",field:"disponibleFuturo",title:"Posición Finish",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatNumberWithColor});d.push({field:"",title:" ",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"4%",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),columnTemplate:function(h,j,i){if(j.habilitarDetalle){var g=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(h);g.on("click",function(){new Core.Controls.MesaDetalleMontoAcumulado({overlayElement:g,requestData:{FechaFin:Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()),idCuenta:j.idCuenta,idNegocio:j.idNegocio,idInstrumento:j.idInstrumento,idDerivado:j.idDerivado}}).show()})}}});a.gridTenenciaBci.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},noRecordsText:"No hay información de Tenencia BCI",columns:d,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Tenencia BCI",columnFields:["ticker","disponibleCI","disponibleCIPendiente","disponible24","disponible48","disponibleFuturo"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Tenencia BCI"}}}});a.txtFilterTenenciaBcv.on("keydown",function(){clearTimeout(a.timeoutTenenciaBcv);a.timeoutTenenciaBcv=setTimeout(function(){value=a.txtFilterTenenciaBcv.val();var g=a.gridTenenciaBcv.swidget().dataSource;if(value){g.filter={or:[{path:"ticker",filter:"contains",value:value}]}}else{g.filter=null}g.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilterTenenciaBcv,"Core.Business.PosicionConsolidadaMesa.txtFilterTenenciaBcv");a.txtFilterTenenciaInt.on("keydown",function(){clearTimeout(a.timeoutTenenciaInt);a.timeoutTenenciaInt=setTimeout(function(){value=a.txtFilterTenenciaInt.val();var g=a.gridTenenciaInt.swidget().dataSource;if(value){g.filter={or:[{path:"ticker",filter:"contains",value:value}]}}else{g.filter=null}g.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilterTenenciaInt,"Core.Business.PosicionConsolidadaMesa.txtFilterTenenciaInt");a.txtFilterTenenciaBci.on("keydown",function(){clearTimeout(a.timeoutTenenciaBci);a.timeoutTenenciaBci=setTimeout(function(){value=a.txtFilterTenenciaBci.val();var g=a.gridTenenciaBci.swidget().dataSource;if(value){g.filter={or:[{path:"ticker",filter:"contains",value:value}]}}else{g.filter=null}g.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilterTenenciaBci,"Core.Business.PosicionConsolidadaMesa.txtFilterTenenciaBci")};a.loadCharts=function(){var d=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"estadodecuenta",requestType:"GET",requestData:{Fecha:Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value())}});d.onSuccess=function(e){a.loadChart(a.gridTenenciaBcv,e.tenenciaBA);a.txtFilterTenenciaBcv.keydown();a.loadChart(a.gridTenenciaInt,e.tenenciaFGT);a.txtFilterTenenciaInt.keydown();a.loadChart(a.gridTenenciaBci,e.tenenciaINV);a.txtFilterTenenciaBci.keydown();a.headerLabels.lblTotalDolaresCable.text("U$D "+Core.Functions.grid.formatIntegerNumber((!e.tenenciaActual[0].totalDolaresCable)?0:e.tenenciaActual[0].totalDolaresCable));a.headerLabels.lblTotalDolaresMep.text("U$D "+Core.Functions.grid.formatIntegerNumber((!e.tenenciaActual[0].totalDolares)?0:e.tenenciaActual[0].totalDolares));a.headerLabels.lblTotalDolares.text("U$D "+Core.Functions.grid.formatIntegerNumber((!e.tenenciaActual[0].total)?0:e.tenenciaActual[0].total))};d.request()};a.loadChart=function(d,e){var g=a.window.scrollTop();var h=d.swidget();if(h){var f=h.initialOptions;f.dataSource.data=e;f.exportOptions.excel.dataSource.data=e;f.exportOptions.excel.readDataSource=true;h.refresh(f);a.window.scrollTop(g)}}};Core.Business.MesaReporteBonos=new function(){var a=this;a.id="mesaReporteBonos";a.divContainerReporteBonos=null;a.divContainerDetalle=null;a.lblTitle=null;a.divReporteBonos=null;a.txtFecha=null;a.ddlEquipo=null;a.ddlVista=null;a.btnRefresh=null;a.txtFilter=null;a.timeout=null;a.data=[];a.window=$(window);a.init=function(b,c){Core.loadPage("mesa-reporte-bonos.html",function(){document.title="Reporte Bonos";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divContainerReporteBonos=$(".div-container-reporte-bonos");a.divContainerReporteBonos.show();a.divContainerDetalle=$(".div-container-detalle");a.divContainerDetalle.hide();a.divReporteBonos=a.divContainerReporteBonos.find(".div-reporte-bonos");a.lblTitle=a.divContainerReporteBonos.find(".label-title");a.txtFecha=a.divContainerReporteBonos.find(".date-picker-fecha");a.ddlEquipo=a.divContainerReporteBonos.find(".dropdown-equipo");a.ddlVista=a.divContainerReporteBonos.find(".dropdown-vista");a.btnRefresh=a.divContainerReporteBonos.find(".btn-refresh");a.txtFilter=a.divContainerReporteBonos.find(".textbox-filter");a.data=[];a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadControls()},"Core.Business.MesaReporteBonos")})};a.initControls=function(){a.txtFecha.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date()});Core.Functions.Validations.toggleValidation(a.txtFecha,false);a.ddlEquipo.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idEquipo}",textTemplate:"{Equipo}",value:""});Core.Functions.Validations.toggleValidation(a.ddlEquipo,false);a.ddlVista.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idVista}",textTemplate:"{Descripcion}",value:""});Core.Functions.Validations.toggleValidation(a.ddlVista,false);a.btnRefresh.on("click",function(){a.loadGrid()});a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var c=a.divReporteBonos.swidget().dataSource;if(value){c.filter={or:[{path:"Ticker",filter:"contains",value:value}]}}else{c.filter=null}c.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.MesaReporteBonos.txtFilter");var b=[];b.push({field:"Ticker",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Equipo",title:"Equipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Arg",title:"ARG",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedNumberWithColor});b.push({field:"Bci",title:"BCI",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedNumberWithColor});b.push({field:"Int",title:"INT",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedNumberWithColor});b.push({field:"Uk",title:"UK",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedNumberWithColor});b.push({field:"PosicionFinal",title:"Posición Final",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedNumberWithColor});b.push({width:40,title:" ",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,e,f){var c=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(d);c.on("click",function(){new Core.Business.MesaReporteBonos.Detalle({ticker:e.Ticker,dataTicker:$.grep(a.data,function(h,g){return h.Ticker==e.Ticker}),onLoad:function(){a.divContainerReporteBonos.hide();a.divContainerDetalle.show();$("html, body").animate({scrollTop:0},1000)},onClosed:function(){a.divContainerReporteBonos.show();a.divContainerDetalle.hide();$("html, body").animate({scrollTop:0},1000)},container:a.divContainerDetalle}).show()})}});a.divReporteBonos.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:b,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Reporte Bonos",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["Ticker","Equipo","Arg","Bci","Int","Uk","PosicionFinal"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Reporte Bonos"}}}})};a.loadControls=function(){var b=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"bonos/vistas",requestType:"GET"});b.onSuccess=function(c){var d=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"equipos/1",requestType:"GET"});d.onSuccess=function(e){var g=a.ddlVista.swidget().initialOptions;g.dataSource.data=c.vistas?c.vistas:[];a.ddlVista.swidget().refresh(g);var f=a.ddlEquipo.swidget().initialOptions;f.dataSource.data=e.equipos?e.equipos:[];a.ddlEquipo.swidget().refresh(f);a.loadGrid()};d.request()};b.request()};a.loadGrid=function(){var c={value:true};Core.Functions.Validations.toggleValidation(a.txtFecha,false);Core.Functions.Validations.getValidatedSwidgetValue(a.txtFecha,c);Core.Functions.Validations.toggleValidation(a.ddlEquipo,false);Core.Functions.Validations.getValidatedDropDownValue(a.ddlEquipo,c);Core.Functions.Validations.toggleValidation(a.ddlVista,false);Core.Functions.Validations.getValidatedDropDownValue(a.ddlVista,c);if(c.value){a.lblTitle.text("Al "+Core.Functions.Date.getDisplayDate(a.txtFecha.swidget().value())+" | Equipo: "+a.ddlEquipo.swidget().selectedItem().Equipo+" | Vista: "+a.ddlVista.swidget().selectedItem().Descripcion);var b=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:("reporte/bonos/"+Core.Functions.Date.getDateAsString(a.txtFecha.swidget().value())+"/"+a.ddlVista.swidget().value()+"/"+a.ddlEquipo.swidget().value()),requestType:"GET"});b.onSuccess=function(d){a.refreshGrid(d.posicion)};b.request()}else{a.lblTitle.text("");a.refreshGrid([])}};a.refreshGrid=function(b){a.data=b?b:[];var c=[];$.each(a.data,function(f,g){var e=$.grep(c,function(h,j){return h.Ticker==g.Ticker})[0];if(!e){e={Ticker:g.Ticker,Equipo:g.Equipo,Arg:0,Bci:0,Int:0,Uk:0,PosicionFinal:0,Pesos:0,Dolares:0};c.push(e)}e.Arg+=g.NominalesEnArgentina;e.Bci+=g.NominalesEnPanama;e.Int+=g.NominalesEnLondres;e.Uk+=g.NominalesEnUK;e.PosicionFinal+=g.TotalNominales;e.Pesos+=g.TotalEnPesos;e.Dolares+=g.TotalEnDolares});var d=a.divReporteBonos.swidget().initialOptions;d.dataSource.data=c;d.exportOptions.excel.dataSource.data=c;d.exportOptions.excel.readDataSource=true;a.divReporteBonos.swidget().refresh(d);a.txtFilter.keydown()}};Core.Business.MesaReporteBonos.Detalle=function(b){var a=this;a.container=null;a.lblTitle=null;a.divDetalle=null;a.btnVolver=null;a.onLoad=function(){};a.onClosed=function(){};a.ticker="";a.dataTicker=[];$.extend(true,a,b);a.show=function(){a.lblTitle=a.container.find(".lbl-detalle-title");a.lblTitle.text("Detalles "+a.ticker);a.divDetalle=a.container.find(".div-detalle");var c=[];c.push({field:"Ticker",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({field:"Equipo",title:"Equipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({field:"DescripcionCuentaMesa",title:"Cuenta Mesa",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({field:"NominalesEnArgentina",title:"ARG",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedNumberWithColor});c.push({field:"NominalesEnPanama",title:"BCI",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedNumberWithColor});c.push({field:"NominalesEnLondres",title:"INT",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedNumberWithColor});c.push({field:"NominalesEnUK",title:"UK",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedNumberWithColor});c.push({field:"TotalNominales",title:"Posición Final",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedNumberWithColor});a.divDetalle.shieldGrid({dataSource:{data:a.dataTicker},selection:false,rowHover:false,sorting:{multiple:true},columns:c,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:("Reporte Bonos - Detalle "+a.ticker),dataSource:{data:a.dataTicker},readDataSource:true,author:"Balanz Capital Valores S.A.",columnFields:["Ticker","Equipo","NominalesEnArgentina","NominalesEnPanama","NominalesEnLondres","NominalesEnUK","TotalNominales"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:("Reporte Bonos - Detalle "+a.ticker)}}}});a.btnVolver=a.container.find(".btn-detalle-volver");a.btnVolver.unbind("click");a.btnVolver.on("click",function(){a.destroy()});a.onLoad()};a.destroy=function(){a.divDetalle.swidget().destroy();a.onClosed()}};Core.Business.MesaReporteDetalleFoto=new function(){var a=this;a.id="mesaLiquidacion";a.eNegocio={Monedas:0,Instrumentos:1,Conceptos:4,CuentasContables:5};a.ddlCuenta=null;a.ddlInstrumento=null;a.ddlNegocio=null;a.divDerivado=null;a.ddlDerivado=null;a.divOperaciones=null;a.txtFilterOperaciones=null;a.timeoutOperaciones=null;a.btnConsultar=null;a.window=$(window);a.managerOperacion=null;a.idDefaultAccount=null;a.idDefaultProfile=null;a.init=function(b,c){Core.loadPage("mesa-reporte-detalles-conceptos.html",function(){document.title="Reporte Detalles Conceptos";a.idDefaultAccount=b;a.idDefaultProfile=c;a.divOperaciones=$(".div-operaciones");a.txtFilterOperaciones=$(".textbox-filter-operaciones");a.ddlCuenta=$(".dropdown-cuenta");a.ddlInstrumento=$(".dropdown-instrumento");a.ddlNegocio=$(".dropdown-negocio");a.ddlDerivado=$(".dropdown-derivado");a.divDerivado=$(".div-derivado");a.btnConsultar=$(".btn-consultar");a.initGrid();a.initControls();a.initFilter();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,a.idDefaultAccount,a.idDefaultProfile,function(){},"Core.Business.MesaReporteDetalleFoto")})};a.initControls=function(){a.btnConsultar.on("click",function(){a.loadGrid()});a.ddlCuenta.shieldDropDown({dataSource:{data:[{value:0,text:"(Seleccione)"},{value:Core.Enums.eVehiculo.INT,text:"INT"},{value:Core.Enums.eVehiculo.BCV,text:"BCV"},{value:Core.Enums.eVehiculo.BCI,text:"BCI"}]},textTemplate:"{text}",valueTemplate:"{value}",value:"0",width:"75%",events:{select:function(b){a.loadInstrumentos();a.loadNegocios();a.checkInputs()}}});a.ddlNegocio.shieldDropDown({dataSource:{data:[{idNegocio:-1,Descripcion:"(Seleccione)"}]},textTemplate:"{Descripcion}",valueTemplate:"{idNegocio}",value:"-1",width:"80%",events:{select:function(b){a.loadInstrumentos();a.divDerivado.hide();if(a.ddlNegocio.swidget().selectedItem().idNegocio==a.eNegocio.Conceptos){a.divDerivado.show()}a.checkInputs()}}});a.ddlInstrumento.shieldDropDown({dataSource:{data:[{idInstrumento:0,Instrumento:"(Seleccione)"}]},textTemplate:"{Instrumento}",valueTemplate:"{idInstrumento}",value:"0",width:"83%",events:{select:function(b){a.checkInputs()}}});a.ddlDerivado.shieldDropDown({dataSource:{data:[{idMoneda:0,Descripcion:"(Seleccione)"},Core.Enums.Currency.Dolares,Core.Enums.Currency.DolaresCable]},textTemplate:"{Descripcion}",valueTemplate:"{idMoneda}",value:"0",width:"66%",events:{select:function(b){a.checkInputs()}}});a.divDerivado.hide();a.btnConsultar.hide()};a.initGrid=function(){a.divOperaciones.shieldGrid({dataSource:{data:[],aggregate:[{field:"CantidadFoto",aggregate:"sum"}]},selection:false,noRecordsText:"No hay operaciones para informar",rowHover:false,paging:{pageSize:100,pageLinksCount:10},sorting:{multiple:true},columns:[{width:"5%",field:"idOperacion",title:"ID",headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"8%",field:"FechaFoto",title:"Fecha Foto",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatStringDate},{title:"Cantidad Foto",field:"CantidadFoto",width:"10%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(b,c,e){var d="";if(c.CantidadFoto<0){d="red"}b.html("<span class='"+d+"'>"+Core.Functions.grid.formatPrice(c.CantidadFoto)+"</span>")},footerTemplate:"<div style='text-align: right;'>{sum:n2}</div>",},{width:"7%",field:"FechaOperacion",title:"Concertación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatStringDate},{width:"7%",field:"FechaLiquidacion",title:"Liquidación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatStringDate},{width:"5%",field:"Vehiculo",title:"Cuenta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"6%",field:"TipoOperacion",title:"Operación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"8%",field:"Contraparte",title:"Contraparte",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"8%",field:"Ticker",title:"Especie",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{title:"Cantidad",field:"Cantidad",width:"10%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(b,c,e){var d="";if(c.TipoOperacion=="Venta"){d="red"}b.html(Core.Functions.grid.formatPrice(c.Cantidad))}},{width:"10%",field:"Precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatPrice},{width:"8%",field:"Moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{title:"Monto",field:"Monto",width:"10%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(b,c,d){b.html(Core.Functions.grid.formatPrice(c.Monto))}},{width:"6%",field:"Estado",title:"Estado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"5%",field:"UsuarioCreacion",title:"Alta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"5%",field:"UsuarioOperador",title:"Operador",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()}],toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Reporte  Detalles Conceptos",columnFields:["idOperacion","FechaFoto","CantidadFoto","FechaOperacion","FechaLiquidacion","Vehiculo","TipoOperacion","Contraparte","Ticker","Cantidad","Precio","Moneda","Monto","Estado","UsuarioCreacion","UsuarioOperador"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Reporte Detalles Conceptos"}}}})};a.initFilter=function(){a.txtFilterOperaciones.on("keydown",function(){clearTimeout(a.timeoutOperaciones);a.timeoutOperaciones=setTimeout(function(){value=a.txtFilterOperaciones.val();var b=a.divOperaciones.swidget().dataSource;if(value){b.filter={or:[{path:"idOperacion",filter:"contains",value:value},{path:"Ticker",filter:"contains",value:value},{path:"Vehiculo",filter:"contains",value:value},{path:"Contraparte",filter:"contains",value:value},{path:"Moneda",filter:"contains",value:value},{path:"UsuarioOperador",filter:"contains",value:value},{path:"UsuarioCreacion",filter:"contains",value:value},{path:"TipoOperacion",filter:"contains",value:value},{path:"Cantidad",filter:"contains",value:value},{path:"Precio",filter:"contains",value:value},{path:"Monto",filter:"contains",value:value}]}}else{b.filter=null}b.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilterOperaciones,"Core.Business.MesaReporteDetalleFoto.txtFilterOperaciones")};a.loadInstrumentos=function(){if(a.ddlCuenta.swidget().selectedItem()&&a.ddlCuenta.swidget().selectedItem().value!=0&&a.ddlNegocio.swidget().selectedItem()&&a.ddlNegocio.swidget().selectedItem().idNegocio!=-1){var c;c="idCuenta="+a.ddlCuenta.swidget().selectedItem().value;c+="&idNegocio="+a.ddlNegocio.swidget().selectedItem().idNegocio;var d=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"instrumentosdetallables",requestType:"GET",requestData:c});d.onSuccess=function(e){e.instrumentos.unshift({idInstrumento:0,Instrumento:"(Seleccione)"});var f=a.ddlInstrumento.swidget().initialOptions;f.dataSource.data=e.instrumentos;a.ddlInstrumento.swidget().refresh(f)};d.request()}else{var b=a.ddlInstrumento.swidget().initialOptions;b.dataSource.data=[{idInstrumento:0,Instrumento:"(Seleccione)"}];a.ddlInstrumento.swidget().refresh(b)}};a.loadNegocios=function(){if(a.ddlCuenta.swidget().selectedItem()&&a.ddlCuenta.swidget().selectedItem().value!=0){var c;c="idCuenta="+a.ddlCuenta.swidget().selectedItem().value;var d=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"negociosdetallables",requestType:"GET",requestData:c});d.onSuccess=function(e){e.negocios.unshift({idNegocio:-1,Descripcion:"(Seleccione)"});var f=a.ddlNegocio.swidget().initialOptions;f.dataSource.data=e.negocios;a.ddlNegocio.swidget().refresh(f)};d.request()}else{var b=a.ddlNegocio.swidget().initialOptions;b.dataSource.data=[{idNegocio:-1,Descripcion:"(Seleccione)"}];a.ddlNegocio.swidget().refresh(b)}};a.checkInputs=function(){var b=true;if(a.ddlCuenta.swidget().selectedItem().value==0){b=false}if(a.ddlNegocio.swidget().selectedItem().idNegocio==-1){b=false}if(a.ddlInstrumento.swidget().selectedItem().idInstrumento==0){b=false}if(a.ddlNegocio.swidget().selectedItem().idNegocio==a.eNegocio.Conceptos&&a.ddlDerivado.swidget().selectedItem().idMoneda==0){b=false}if(b){a.btnConsultar.show()}else{a.btnConsultar.hide()}};a.loadGrid=function(){var b;b="idCuenta="+a.ddlCuenta.swidget().selectedItem().value;b+="&idNegocio="+a.ddlNegocio.swidget().selectedItem().idNegocio;b+="&idInstrumento="+a.ddlInstrumento.swidget().selectedItem().idInstrumento;if(a.ddlNegocio.swidget().selectedItem().idNegocio==a.eNegocio.Conceptos){b+="&idDerivado="+a.ddlDerivado.swidget().selectedItem().idMoneda}else{b+="&idDerivado="+((a.ddlNegocio.swidget().selectedItem().idNegocio==a.eNegocio.Monedas)?"0":"1")}var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"detalleconcepto",requestType:"GET",requestData:b});c.onSuccess=function(d){d.operaciones.forEach(function(i,h){if(i.FechaLiquidacion){i.FechaLiquidacion=i.FechaLiquidacion+" 00:00:00.000"}i.FechaOperacion=i.FechaOperacion+" 00:00:00.000"});var g=a.window.scrollTop();var e=a.divOperaciones.swidget().initialOptions;e.dataSource.data=d.operaciones;e.dataSource.sort=a.divOperaciones.swidget().dataSource.sort;var f=a.divOperaciones.swidget().pager.page();e.exportOptions.excel.dataSource.data=d.operaciones;e.exportOptions.excel.readDataSource=true;a.divOperaciones.swidget().refresh(e);a.txtFilterOperaciones.keydown();if(f>1){a.divOperaciones.swidget().pager.page(f)}a.window.scrollTop(g)};c.request()}};Core.Business.MesaReporteFechaValor=new function(){var a=this;var b=60000;a.id="mesaReporteFechaValor";a.txtDate=null;a.divOperaciones=null;a.loaded=false;a.timerId=null;a.window=$(window);a.idDefaultAccount=null;a.idDefaultProfile=null;a.init=function(c,d){Core.loadPage("mesa-reporte-fecha-valor.html",function(){document.title="Reporte Fecha Valor";a.idDefaultAccount=c;a.idDefaultProfile=d;a.txtDate=$(".date-picker-reporte");a.divOperaciones=$(".div-operaciones-fecha-valor");a.initDatePicker();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,a.idDefaultAccount,a.idDefaultProfile,function(){a.loadGrid()},"Core.Business.MesaReporteFechaValor");a.timerId=window.setInterval(function(){a.loadGrid()},b);Core.Objects.Context.Timers.push(a.timerId)})};a.initDatePicker=function(){a.txtDate.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),events:{change:function(c){a.loaded=false;a.loadGrid()}}})};a.initGrid=function(){a.divOperaciones.shieldGrid({dataSource:{data:[],group:[{field:"Vehiculo",order:"asc"}]},selection:false,noRecordsText:"No hay operaciones para informar",rowHover:false,paging:{pageSize:100,pageLinksCount:10},grouping:{showGroupHeader:true,allowDragToGroup:true,message:"Arrastre un encabezado de columna para agrupar por esa columna"},sorting:{multiple:true},columns:[{width:"6%",field:"UsuarioCreacion",title:"Usuario Creación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"10%",field:"FechaCarga",title:"Fecha Carga",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"6%",field:"UsuarioOperador",title:"Usuario Operador",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"10%",field:"FechaModificacion",title:"Fecha Modificación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"5%",field:"idOperacion",title:"ID",headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"8%",field:"FechaConcertacion",title:"Concertación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"8%",field:"FechaLiquidacionPactada",title:"Liquidación Pactada",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"8%",field:"FechaLiquidacionEfectiva",title:"Liquidacion Efectiva",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"5%",field:"Vehiculo",title:"Cuenta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"6%",field:"TipoOperacion",title:"Operación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"8%",field:"Contraparte",title:"Contraparte",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"7%",field:"Ticker",title:"Especie",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"10%",field:"Isin",title:"Isin",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{title:"Cantidad",field:"Cantidad",width:"7%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(c,d,f){var e="";if(d.TipoOperacion=="Venta"){e="red"}c.html("<span class='"+e+"'>"+Core.Functions.grid.formatPrice(d.Cantidad)+"</span>")}},{width:"7%",field:"Precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatPrice},{width:"7%",field:"Moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{title:"Monto",field:"Monto",width:"7%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(c,d,f){var e="";if(d.TipoOperacion=="Compra"){e="red"}c.html("<span class='"+e+"'>"+Core.Functions.grid.formatPrice(d.Monto)+"</span>")}},{title:"Obs.",width:"4%",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(d,e,f){if(e.Observaciones&&e.Observaciones!=""){var h=(e.Observaciones.length>140)?(e.Observaciones.substr(0,140)+"..."):(e.Observaciones);var c=$('<button type="button" title="'+h+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>').appendTo(d);c.addClass("link-cell");c.on("click",function(){var i=new Core.Controls.Dialog("Observaciones",(e.Observaciones)?e.Observaciones:"",{displayButtons:{close:true,accept:false}});i.show()})}if(e.AdvertenciaFechaLiquidacion&&e.AdvertenciaFechaLiquidacion!=""){var g=(e.AdvertenciaFechaLiquidacion.length>140)?(e.AdvertenciaFechaLiquidacion.substr(0,140)+"..."):(e.AdvertenciaFechaLiquidacion);btnAdvertenciaFechaLiquidacion=$('<button type="button" title="'+g+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-exclamation-sign"></span></button>').appendTo(d);btnAdvertenciaFechaLiquidacion.addClass("link-cell");btnAdvertenciaFechaLiquidacion.on("click",function(){var i=new Core.Controls.Dialog("Advertencia",(e.AdvertenciaFechaLiquidacion)?e.AdvertenciaFechaLiquidacion:"",{displayButtons:{close:true,accept:false}});i.show()})}}},{width:"8%",field:"Estado",title:"Estado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"4%",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(d,e,f){if(Core.Objects.Context.Profiles[a.idDefaultProfile].opciones&&Core.Objects.Context.Profiles[a.idDefaultProfile].opciones.mesaDetalleCambios){var c=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-resize-full"></span></button>').appendTo(d);c.on("click",function(){a.loadDetails(e.idOperacion,c)})}}}],toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"ReporteFechaValor",columnFields:["idOperacion","FechaOperacion","FechaLiquidacion","Vehiculo","TipoOperacion","Contraparte","Ticker","Isin","Cantidad","Precio","Moneda","Monto","Observaciones","UsuarioCreacion","UsuarioOperador"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Reporte Fecha Valor"}}}})};a.loadGrid=function(){var c;c="FechaPosicion="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDate.swidget().value()));var d=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"reporte/operacionesfechavalor",requestType:"GET",requestData:c});d.onSuccess=function(e){var h=a.window.scrollTop();var f=a.divOperaciones.swidget().initialOptions;f.dataSource.data=e.operaciones;f.dataSource.sort=a.divOperaciones.swidget().dataSource.sort;f.dataSource.group=a.divOperaciones.swidget().dataSource.group;var g=a.divOperaciones.swidget().pager.page();f.exportOptions.excel.dataSource.data=e.operaciones;f.exportOptions.excel.readDataSource=true;a.divOperaciones.swidget().refresh(f);if(g>1){a.divOperaciones.swidget().pager.page(g)}a.window.scrollTop(h);a.loaded=true};d.request()};a.loadDetails=function(c,d){var e=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:d,requestUrl:"operaciones/detallecambios/"+c,requestType:"GET"});e.onSuccess=function(h){var j="<table class='table table-striped'>";j+="<thead><tr><th style='width:33%;'>Fecha</th><th style='width:33%;'>Estado Inicial</th><th style='width:33%;'>Estado Final</th></tr></thead>";j+="<tbody>";for(var g=0;g<h.detalleCambiosEstados.length;g++){j+="<tr>";j+="<td>"+h.detalleCambiosEstados[g].fecha.substr(0,16)+" ("+h.detalleCambiosEstados[g].usuario+")</td>";j+="<td>"+h.detalleCambiosEstados[g].estadodesde+"</td>";j+="<td>"+h.detalleCambiosEstados[g].estadohasta+"</td></tr>"}j+="</tbody>";j+="</table>";j+="<table class='table table-striped'>";j+="<thead><tr><th style='width:20%;'>Fecha</th><th style='width:20%;'>Tipo Accion</th><th style='width:60%;'>Contexto</th></tr></thead>";j+="<tbody>";for(var g=0;g<h.detalleCampos.length;g++){j+="<tr>";j+="<td>"+h.detalleCampos[g].fecha.substr(0,16)+"<br />("+h.detalleCampos[g].usuario+")</td>";j+="<td>"+h.detalleCampos[g].tipo+"</td>";j+="<td>"+h.detalleCampos[g].contexto.substr(2,h.detalleCampos[g].contexto.length-2).replace(/\|\|/g,", ");+"</td></tr>"}j+="</tbody>";j+="</table>";var f=new Core.Controls.Dialog("Detalles",j,{displayButtons:{close:true,accept:false}});f.show()};e.request()}};Core.Business.ReporteParidadNominales=new function(){var a=this;a.id="reporteParidadNominales";a.txtFilter=null;a.timeoutFilter=null;a.divParidadNominales=null;a.lblTitle=null;a.txtDate=null;a.btnRefresh=null;a.window=$(window);a.init=function(b,c){Core.loadPage("mesa-reporte-paridad-nominales.html",function(){document.title="Reporte Paridad Nominales";a.divParidadNominales=$(".div-paridad-nominales");a.txtFilter=$(".textbox-filter");a.lblTitle=$(".label-title");a.txtDate=$(".date-picker");a.btnRefresh=$(".btn-refresh");a.initDatePicker();a.initFilter();a.initGrid();a.initButtons();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.ReporteParidadNominales")})};a.initButtons=function(){a.btnRefresh.click(function(){a.loadGrid()})};a.initDatePicker=function(){a.txtDate.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(b){a.loadGrid()}}})};a.initFilter=function(){a.txtFilter.on("keydown",function(){clearTimeout(a.timeoutFilter);a.timeoutFilter=setTimeout(function(){value=a.txtFilter.val();var b=a.divParidadNominales.swidget().dataSource;if(value){b.filter={or:[{path:"Ticker",filter:"contains",value:value}]}}else{b.filter=null}b.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.ReporteParidadNominales.txtFilter")};a.initGrid=function(){a.divParidadNominales.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Repoerte Nominales Paridad",columnFields:["Ticker","NominalesParidad"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Detalles Nominales Paridad"}}},columns:[{width:"45%",field:"Ticker",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"45%",field:"NominalesParidad",title:"Nominales Paridad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNumberWithColor},{width:"10%",field:"bcv",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(c,e,d){var b=$('<button type="button" title="Detalles" class="btn-sm balanz-button" style="margin-left:8px;"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(c);b.on("click",function(){new Core.Business.ReporteParidadNominales.Detalles({overlayElement:b,requestData:{Fecha:encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDate.swidget().value())),idNegocio:e.idNegocio,idInstrumento:e.idInstrumento,idDerivado:e.idDerivado,ticker:e.Ticker}}).show()})}}]})};a.loadGrid=function(){a.lblTitle.text("Al "+Core.Functions.Date.getDisplayDate(a.txtDate.swidget().value()));var b;b="Fecha="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDate.swidget().value()));var c=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divParidadNominales.parent(),secureRequest:true,requestUrl:"reporte/posicionparidadnominales",requestType:"GET",requestData:b});c.onSuccess=function(d){var f=a.window.scrollTop();var e=a.divParidadNominales.swidget().initialOptions;e.dataSource.data=d.posicion;e.exportOptions.excel.dataSource.data=d.posicion;e.exportOptions.excel.readDataSource=true;a.divParidadNominales.swidget().refresh(e);a.txtFilter.keydown();a.window.scrollTop(f)};c.request()}};Core.Business.ReporteParidadNominales.Detalles=function(b){var a=this;a.divDetalleParidadNominales=$(".div-modal-detalles-nominales-paridad");a.overlayElement=null;a.requestData={};a.divDetalles=null;a.lblTitle=null;$.extend(true,a,b);a.show=function(){a.divDetalles=a.divDetalleParidadNominales.find(".div-detalles");a.lblTitle=a.divDetalleParidadNominales.find(".lbl-title");a.lblTitle.text("Detalles Ticker "+a.requestData.ticker);if(!a.divDetalles.swidget()){a.initGrid()}a.loadGrid()};a.initGrid=function(){a.divDetalles.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:[{field:"Fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{field:"NominalesTotales",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNumberWithColor},{field:"NominalesIntencionalidadCambioUSDCruzadas",title:"Nominales USD",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNumberWithColor},{field:"NominalesParidad",title:"Nominales Paridad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNumberWithColor}],toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Detalles Nominales Paridad "+a.requestData.ticker,columnFields:["Fecha","NominalesTotales","NominalesIntencionalidadCambioUSDCruzadas","NominalesParidad"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Detalles Nominales Paridad "+a.requestData.ticker}}}})};a.loadGrid=function(){var c=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,showOverlay:true,secureRequest:true,requestUrl:"reporte/posicionparidadnominalesdetalle",requestType:"GET",requestData:a.requestData});c.onSuccess=function(f){var d=f.posicion==null?[]:f.posicion;var e=a.divDetalles.swidget().initialOptions;e.dataSource.data=d;e.exportOptions.excel.dataSource.data=d;e.exportOptions.excel.readDataSource=true;a.divDetalles.swidget().refresh(e);a.divDetalleParidadNominales.modal({show:true})};c.request()};a.destroy=function(){}};Core.Business.MesaReporteParking=new function(){var a=this;a.id="mesaReporteParking";a.divReporteParking=null;a.lblTitle=null;a.txtFecha=null;a.txtCantidadDias=null;a.ddlEquipo=null;a.btnRefresh=null;a.txtFilter=null;a.timeout=null;a.window=$(window);a.init=function(b,c){Core.loadPage("mesa-reporte-parking.html",function(){document.title="Reporte Parking";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divReporteParking=$(".div-reporte-parking");a.lblTitle=$(".label-title");a.txtFecha=$(".date-picker-fecha");a.txtCantidadDias=$(".textbox-cantidad-dias");a.ddlEquipo=$(".dropdown-equipo");a.btnRefresh=$(".btn-refresh");a.txtFilter=$(".textbox-filter");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadControls()},"Core.Business.MesaReporteParking")})};a.initControls=function(){a.txtFecha.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date()});Core.Functions.Validations.toggleValidation(a.txtFecha,false);a.txtCantidadDias.shieldNumericTextBox({min:0,max:99999,step:1,value:3});Core.Functions.Validations.toggleValidation(a.txtCantidadDias,false);a.ddlEquipo.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idEquipo}",textTemplate:"{Equipo}"});Core.Functions.Validations.toggleValidation(a.ddlEquipo,false);a.btnRefresh.on("click",function(){a.loadGrid()});a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var c=a.divReporteParking.swidget().dataSource;if(value){c.filter={or:[{path:"idCuenta",filter:"contains",value:value},{path:"DescripcionCuenta",filter:"contains",value:value},{path:"Ticker",filter:"contains",value:value},{path:"Parking",filter:"contains",value:value}]}}else{c.filter=null}c.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.MesaReporteParking.txtFilter");var b=[];b.push({field:"idCuenta",title:"ID Cuenta",width:"20%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({field:"DescripcionCuenta",title:"Descripción Cuenta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"30%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Ticker",title:"Ticker",width:"30%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Parking",title:"Parking",width:"20%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});a.divReporteParking.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:b,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Reporte Parking",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["idCuenta","DescripcionCuenta","Ticker","Parking"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Reporte Parking"}}}})};a.loadControls=function(){var b=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"equipos/1",requestType:"GET"});b.onSuccess=function(c){var d=a.ddlEquipo.swidget().initialOptions;d.dataSource.data=c.equipos;a.ddlEquipo.swidget().refresh(d)};b.request()};a.loadGrid=function(){var c={value:true};Core.Functions.Validations.toggleValidation(a.txtFecha,false);Core.Functions.Validations.toggleValidation(a.txtCantidadDias,false);Core.Functions.Validations.toggleValidation(a.ddlEquipo,false);Core.Functions.Validations.getValidatedSwidgetValue(a.txtFecha,c);Core.Functions.Validations.getValidatedSwidgetValue(a.txtCantidadDias,c);Core.Functions.Validations.getValidatedDropDownValue(a.ddlEquipo,c);if(c.value){a.lblTitle.text("Al "+Core.Functions.Date.getDisplayDate(a.txtFecha.swidget().value())+" | Cantidad de Días: "+a.txtCantidadDias.swidget().value()+" | Equipo: "+a.ddlEquipo.swidget().selectedItem().Equipo);var b=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:("reporte/parking/"+Core.Functions.Date.getDateAsString(a.txtFecha.swidget().value())+"/1/"+a.txtCantidadDias.swidget().value()+"/"+a.ddlEquipo.swidget().value()),requestType:"GET"});b.onSuccess=function(d){a.refreshGrid(d.posicion)};b.request()}else{a.lblTitle.text("");a.refreshGrid([])}};a.refreshGrid=function(b){var c=a.divReporteParking.swidget().initialOptions;c.dataSource.data=b?b:[];c.exportOptions.excel.dataSource.data=b?b:[];c.exportOptions.excel.readDataSource=true;a.divReporteParking.swidget().refresh(c);a.txtFilter.keydown()}};Core.Business.MesaReportePLDiario=new function(){var a=this;a.id="mesaReportePLDiario";a.btnRefresh=null;a.btnBack=null;a.lblFilterDescription=null;a.chkPorEquipo=null;a.chkPorTicker=null;a.txtFilter=null;a.timeout=null;a.divContainerReportePorEquipo=null;a.divReportePorEquipo=null;a.divContainerReportePorTicker=null;a.divReportePorTicker=null;a.divContainerReportePorEstrategia=null;a.divReportePorEstrategia=null;a.divContainerReporteDetalle=null;a.divReportePorDetalle=null;a.lblTitle=null;a.txtDate=null;a.equipoElegido=null;a.estrategiaElegida=null;a.tickerElegido=null;a.data=[];a.init=function(b,c){Core.loadPage("mesa-reporte-pl-diario.html",function(){document.title="Reporte PL Diario";a.btnRefresh=$(".btn-refresh");a.btnBack=$(".btn-volver");a.lblFilterDescription=$(".lbl-filter-description");a.chkPorEquipo=$(".checkbox-ver-por-equipo");a.chkPorTicker=$(".checkbox-ver-por-ticker");a.txtFilter=$(".textbox-filter");a.divContainerReportePorEquipo=$(".div-container-reporte-por-equipo");a.divReportePorEquipo=$(".div-reporte-por-equipo");a.divContainerReportePorEquipo.hide();a.divContainerReportePorTicker=$(".div-container-reporte-por-ticker");a.divReportePorTicker=$(".div-reporte-por-ticker");a.divContainerReportePorTicker.hide();a.divContainerReportePorEstrategia=$(".div-container-reporte-por-estrategia");a.divReportePorEstrategia=$(".div-reporte-por-estrategia");a.divContainerReportePorEstrategia.hide();a.divContainerReporteDetalle=$(".div-container-reporte-detalle");a.divReportePorDetalle=$(".div-reporte-detalle");a.divContainerReporteDetalle.hide();a.lblTitle=$(".label-title");a.txtDate=$(".date-picker-date");a.initControls();a.initGrids();a.equipoElegido=null;a.estrategiaElegida=null;a.tickerElegido=null;a.data=[];a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrids,"Core.Business.MesaReportePLDiario")})};a.initControls=function(){a.lblFilterDescription.html("");a.txtDate.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),min:new Date(2019,11,1),events:{change:function(b){a.loadGrids()}}});a.btnRefresh.on("click",function(){a.loadGrids()});a.btnBack.on("click",function(){if(a.tickerElegido){a.loadVistaPorTicker()}else{if(a.equipoElegido){if(a.estrategiaElegida){a.loadVistaPorEstrategia(a.equipoElegido)}else{a.loadVistaPorEquipo()}}else{if(a.chkPorTicker[0].checked){a.loadVistaPorTicker()}else{a.loadVistaPorEquipo()}}}});a.chkPorEquipo[0].checked=true;a.chkPorEquipo.on("change",function(){a.loadVistaPorEquipo()});a.chkPorTicker[0].checked=false;a.chkPorTicker.on("change",function(){a.loadVistaPorTicker()});a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var b=null;var c=[];if((a.equipoElegido&&a.estrategiaElegida)||a.tickerElegido){b=a.divReportePorDetalle.swidget().dataSource;c.push({path:"Equipo",filter:"contains",value:value});c.push({path:"Estrategia",filter:"contains",value:value});c.push({path:"Ticker",filter:"contains",value:value});c.push({path:"DescripcionESCO",filter:"contains",value:value});c.push({path:"Cuentas",filter:"contains",value:value});c.push({path:"CodCtaCorriente",filter:"contains",value:value})}else{if(a.equipoElegido){b=a.divReportePorEstrategia.swidget().dataSource;c.push({path:"Equipo",filter:"contains",value:value});c.push({path:"Estrategia",filter:"contains",value:value})}else{if(a.chkPorTicker[0].checked){b=a.divReportePorTicker.swidget().dataSource;c.push({path:"Ticker",filter:"contains",value:value})}else{b=a.divReportePorEquipo.swidget().dataSource;c.push({path:"Equipo",filter:"contains",value:value})}}}if(value){b.filter={or:[c]}}else{b.filter=null}b.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.MesaReportePLDiario.txtFilter")};a.initGrids=function(){var b=[];b.push({field:"Equipo",title:"Equipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(e,g,f){e.html("<a>"+g.Equipo+"</a>");e.addClass("link-cell");e.on("click",function(){a.loadVistaPorEstrategia(g.Equipo)})}});b.push({field:"PLTotalDolares",title:"Total Dólares",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});b.push({field:"PLTotalPesos",title:"Total Pesos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});b.push({field:"PLMesaDolares",title:"Mesa Dólares",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});b.push({field:"PLMesaPesos",title:"Mesa Pesos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});b.push({field:"PLComercialDolares",title:"Comercial Dólares",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});b.push({field:"PLComercialPesos",title:"Comercial Pesos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});a.divReportePorEquipo.shieldGrid({dataSource:{data:[],aggregate:[{field:"PLTotalPesos",aggregate:"sum"},{field:"PLComercialPesos",aggregate:"sum"},{field:"PLMesaPesos",aggregate:"sum"},{field:"PLTotalDolares",aggregate:"sum"},{field:"PLComercialDolares",aggregate:"sum"},{field:"PLMesaDolares",aggregate:"sum"}]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"ReportePLDiario",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["Fecha","idEquipo","Equipo","Estrategia","PLTotalPesos","PLComercialPesos","PLMesaPesos","PLTotalDolares","PLComercialDolares","PLMesaDolares","Ticker","Precio","PrecioApertura","PrecioCierre","DifPrecios","ResultadoOperacion","Cantidad","DescripcionESCO","idOperacion","idMinuta","idMonedaInstrumento","MonInstrumento","idMonedaOperacion","OpCruzada","idNegocio","idInstrumento","idDerivado","Tipo","idCuenta","Cuentas","Marca","CodCtaCorriente"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"ReportePLDiario"}}},selection:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},rowHover:false,columns:b});var c=[];c.push({field:"Equipo",title:"Equipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"Estrategia",title:"Estrategia",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),columnTemplate:function(e,g,f){e.html("<a>"+g.Estrategia+"</a>");e.addClass("link-cell");e.on("click",function(){a.loadVistaDetalle(null,g.Equipo,g.Estrategia)})}});c.push({field:"PLTotalDolares",title:"Total Dólares",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});c.push({field:"PLTotalPesos",title:"Total Pesos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});c.push({field:"PLMesaDolares",title:"Mesa Dólares",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});c.push({field:"PLMesaPesos",title:"Mesa Pesos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});c.push({field:"PLComercialDolares",title:"Comercial Dólares",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});c.push({field:"PLComercialPesos",title:"Comercial Pesos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});a.divReportePorEstrategia.shieldGrid({dataSource:{data:[],aggregate:[{field:"PLTotalPesos",aggregate:"sum"},{field:"PLComercialPesos",aggregate:"sum"},{field:"PLMesaPesos",aggregate:"sum"},{field:"PLTotalDolares",aggregate:"sum"},{field:"PLComercialDolares",aggregate:"sum"},{field:"PLMesaDolares",aggregate:"sum"}]},selection:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},rowHover:false,columns:c});var d=[];d.push({field:"Ticker",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),columnTemplate:function(e,g,f){e.html("<a>"+g.Ticker+"</a>");e.addClass("link-cell");e.on("click",function(){a.loadVistaDetalle(g.Ticker,null,null)})}});d.push({field:"PLTotalDolares",title:"Total Dólares",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});d.push({field:"PLTotalPesos",title:"Total Pesos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});d.push({field:"PLMesaDolares",title:"Mesa Dólares",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});d.push({field:"PLMesaPesos",title:"Mesa Pesos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});d.push({field:"PLComercialDolares",title:"Comercial Dólares",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});d.push({field:"PLComercialPesos",title:"Comercial Pesos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});a.divReportePorTicker.shieldGrid({dataSource:{data:[],aggregate:[{field:"PLTotalPesos",aggregate:"sum"},{field:"PLComercialPesos",aggregate:"sum"},{field:"PLMesaPesos",aggregate:"sum"},{field:"PLTotalDolares",aggregate:"sum"},{field:"PLComercialDolares",aggregate:"sum"},{field:"PLMesaDolares",aggregate:"sum"}]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"ReportePLDiario",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["Fecha","idEquipo","Equipo","Estrategia","PLTotalPesos","PLComercialPesos","PLMesaPesos","PLTotalDolares","PLComercialDolares","PLMesaDolares","Ticker","Precio","PrecioApertura","PrecioCierre","DifPrecios","ResultadoOperacion","Cantidad","DescripcionESCO","idOperacion","idMinuta","idMonedaInstrumento","MonInstrumento","idMonedaOperacion","OpCruzada","idNegocio","idInstrumento","idDerivado","Tipo","idCuenta","Cuentas","Marca","CodCtaCorriente"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"ReportePLDiario"}}},selection:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},rowHover:false,columns:d});a.divReportePorDetalle.shieldGrid({dataSource:{data:[],aggregate:[{field:"PLTotalPesos",aggregate:"sum"},{field:"PLComercialPesos",aggregate:"sum"},{field:"PLMesaPesos",aggregate:"sum"},{field:"PLTotalDolares",aggregate:"sum"},{field:"PLComercialDolares",aggregate:"sum"},{field:"PLMesaDolares",aggregate:"sum"}]},selection:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},rowHover:false,columns:[]})};a.loadGrids=function(){a.lblTitle.text("Al "+Core.Functions.Date.getDisplayDate(a.txtDate.swidget().value()));var b;b="Fecha="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDate.swidget().value()));var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"pl/diario",requestType:"GET",requestData:b});c.onSuccess=function(d){a.data=d.detalles;if(a.chkPorTicker[0].checked){if(a.tickerElegido){a.loadVistaDetalle(a.tickerElegido,null,null)}else{a.loadVistaPorTicker()}}else{if(a.chkPorEquipo[0].checked){if(a.equipoElegido&&a.estrategiaElegida){a.loadVistaDetalle(null,a.equipoElegido,a.estrategiaElegida)}else{if(a.equipoElegido){a.loadVistaPorEstrategia(a.equipoElegido)}else{a.loadVistaPorEquipo()}}}}};c.request()};a.loadVistaPorEquipo=function(){a.equipoElegido=null;a.estrategiaElegida=null;a.tickerElegido=null;a.lblFilterDescription.html("");a.txtFilter.val("");a.btnBack.hide();a.divContainerReporteDetalle.hide();a.divContainerReportePorEquipo.show();a.divContainerReportePorEstrategia.hide();a.divContainerReportePorTicker.hide();a.refreshGrid(a.divReportePorEquipo,a.groupFor(a.data,"Equipo"))};a.loadVistaPorTicker=function(){a.equipoElegido=null;a.estrategiaElegida=null;a.tickerElegido=null;a.lblFilterDescription.html("");a.txtFilter.val("");a.btnBack.hide();a.divContainerReporteDetalle.hide();a.divContainerReportePorEquipo.hide();a.divContainerReportePorEstrategia.hide();a.divContainerReportePorTicker.show();a.refreshGrid(a.divReportePorTicker,a.groupFor(a.data,"Ticker"))};a.loadVistaPorEstrategia=function(d){a.estrategiaElegida=null;a.tickerElegido=null;a.equipoElegido=d;a.lblFilterDescription.html("");var b=$("<a>Equipo: </a>").appendTo(a.lblFilterDescription);b.on("click",function(){a.loadVistaPorEquipo()});$("<label>"+a.equipoElegido+"</label>").appendTo(a.lblFilterDescription);a.btnBack.show();a.txtFilter.val("");a.divContainerReporteDetalle.hide();a.divContainerReportePorEquipo.hide();a.divContainerReportePorEstrategia.show();a.divContainerReportePorTicker.hide();var c=$.grep(a.data,function(f,e){return f.Equipo==a.equipoElegido});a.refreshGrid(a.divReportePorEstrategia,a.groupFor(c,"Estrategia"))};a.groupFor=function(b,c){var d=[];b.forEach(function(g,e){var f=-1;d.forEach(function(h,j){if(h[c]==g[c]){f=j}});if(f>=0){d[f].PLTotalPesos+=g.PLTotalPesos;d[f].PLComercialPesos+=g.PLComercialPesos;d[f].PLMesaPesos+=g.PLMesaPesos;d[f].PLTotalDolares+=g.PLTotalDolares;d[f].PLComercialDolares+=g.PLComercialDolares;d[f].PLMesaDolares+=g.PLMesaDolares}else{d.push({Equipo:g.Equipo,Estrategia:g.Estrategia,Ticker:g.Ticker,PLTotalPesos:g.PLTotalPesos,PLComercialPesos:g.PLComercialPesos,PLMesaPesos:g.PLMesaPesos,PLTotalDolares:g.PLTotalDolares,PLComercialDolares:g.PLComercialDolares,PLMesaDolares:g.PLMesaDolares})}});return d};a.loadVistaDetalle=function(i,g,h){a.equipoElegido=g;a.estrategiaElegida=h;a.tickerElegido=i;a.divContainerReporteDetalle.show();a.divContainerReportePorEquipo.hide();a.divContainerReportePorEstrategia.hide();a.divContainerReportePorTicker.hide();a.btnBack.show();a.txtFilter.val("");var f=$.grep(a.data,function(k,j){return true});a.lblFilterDescription.html("");if(a.equipoElegido){f=$.grep(f,function(k,j){return k.Equipo==a.equipoElegido});var b=$("<a>Equipo: </a>").appendTo(a.lblFilterDescription);b.on("click",function(){a.loadVistaPorEquipo()});$("<label>"+a.equipoElegido+"</label>").appendTo(a.lblFilterDescription)}if(a.estrategiaElegida){f=$.grep(f,function(k,j){return k.Estrategia==a.estrategiaElegida});$("<label>&nbsp;>>&nbsp;</label>").appendTo(a.lblFilterDescription);var c=$("<a>Estrategia: </a>").appendTo(a.lblFilterDescription);c.on("click",function(){a.loadVistaPorEstrategia(a.equipoElegido)});$("<label>"+a.estrategiaElegida+"</label>").appendTo(a.lblFilterDescription)}if(a.tickerElegido){f=$.grep(f,function(k,j){return k.Ticker==a.tickerElegido});var d=$("<a>Ticker: </a>").appendTo(a.lblFilterDescription);d.on("click",function(){a.loadVistaPorTicker()});$("<label>"+a.tickerElegido+"</label>").appendTo(a.lblFilterDescription)}var e=[];if(a.chkPorTicker[0].checked){e.push({width:"5%",field:"Estrategia",title:"Estrategia",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length)})}e.push({width:"5%",field:"PLTotalDolares",title:"Total Dólares",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(j,l,k){j.html(Core.Functions.grid.formatNumberWithColor(l.sum));j.css("text-align","right");j.css("padding-right","5px")}});e.push({width:"5%",field:"PLTotalPesos",title:"Total Pesos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(j,l,k){j.html(Core.Functions.grid.formatNumberWithColor(l.sum));j.css("text-align","right");j.css("padding-right","5px")}});e.push({width:"5%",field:"PLMesaDolares",title:"Mesa Dólares",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(j,l,k){j.html(Core.Functions.grid.formatNumberWithColor(l.sum));j.css("text-align","right");j.css("padding-right","5px")}});e.push({width:"5%",field:"PLMesaPesos",title:"Mesa Pesos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(j,l,k){j.html(Core.Functions.grid.formatNumberWithColor(l.sum));j.css("text-align","right");j.css("padding-right","5px")}});e.push({width:"5%",field:"PLComercialDolares",title:"Comercial Dólares",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(j,l,k){j.html(Core.Functions.grid.formatNumberWithColor(l.sum));j.css("text-align","right");j.css("padding-right","5px")}});e.push({width:"5%",field:"PLComercialPesos",title:"Comercial Pesos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(j,l,k){j.html(Core.Functions.grid.formatNumberWithColor(l.sum));j.css("text-align","right");j.css("padding-right","5px")}});if(a.chkPorEquipo[0].checked){e.push({width:"5%",field:"Ticker",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length)})}e.push({width:"5%",field:"Precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatPrice});e.push({width:"5%",field:"PrecioApertura",title:"Precio Apertura",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatPrice});e.push({width:"5%",field:"PrecioCierre",title:"Precio Cierre",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatPrice});e.push({width:"5%",field:"DifPrecios",title:"Diferencia Precios",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatPrice});e.push({width:"5%",field:"Cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatNumber});e.push({width:"30%",field:"DescripcionESCO",title:"Descripción ESCO",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length)});e.push({width:"5%",field:"idOperacion",title:"ID Operación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length)});e.push({width:"5%",field:"idMinuta",title:"ID Minuta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length)});e.push({width:"5%",field:"Cuentas",title:"Cuentas",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length)});a.refreshGrid(a.divReportePorDetalle,f,e)};a.refreshGrid=function(d,c,b){var e=d.swidget().initialOptions;e.dataSource.data=c;if(b){e.columns=b}if(e.exportOptions){e.exportOptions.excel.dataSource.data=a.data;e.exportOptions.excel.readDataSource=true}d.swidget().refresh(e);a.txtFilter.keydown()}};Core.Business.MesaReportePLMensual=new function(){var a=this;a.id="mesaReportePLMensual";a.btnRefresh=null;a.btnBack=null;a.ddlMes=null;a.lblFilterDescription=null;a.divContainerReportePorFecha=null;a.divReportePorFecha=null;a.divContainerReportePorEquipo=null;a.divReportePorEquipo=null;a.divContainerReporteDetalle=null;a.divReportePorDetalle=null;a.lblTitle=null;a.fechaElegida=null;a.equipoElegido=null;a.data=[];a.init=function(b,c){Core.loadPage("mesa-reporte-pl-mensual.html",function(){document.title="Reporte PL Mensual";a.ddlMes=$(".dropdown-mes");a.btnRefresh=$(".btn-refresh");a.btnBack=$(".btn-volver");a.lblFilterDescription=$(".lbl-filter-description");a.divContainerReportePorFecha=$(".div-container-reporte-por-fecha");a.divReportePorFecha=$(".div-reporte-por-fecha");a.divContainerReportePorFecha.hide();a.divContainerReportePorEquipo=$(".div-container-reporte-por-equipo");a.divReportePorEquipo=$(".div-reporte-por-equipo");a.divContainerReportePorEquipo.hide();a.divContainerReporteDetalle=$(".div-container-reporte-detalle");a.divReportePorDetalle=$(".div-reporte-detalle");a.divContainerReporteDetalle.hide();a.lblTitle=$(".label-title");a.initControls();a.initGrids();a.equipoElegido=null;a.estrategiaElegida=null;a.data=[];a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrids,"Core.Business.MesaReportePLMensual")})};a.initControls=function(){a.lblFilterDescription.html("");a.btnRefresh.on("click",function(){a.loadGrids()});a.btnBack.on("click",function(){if(a.fechaElegida){if(a.equipoElegido){a.loadVistaPorEquipo(a.fechaElegida)}else{a.loadVistaPorFecha()}}else{a.loadVistaPorFecha()}});var c=[];var f=new Date(2019,11,1);var b=new Date();function e(g){g=g+1;if(g<10){return("0"+g)}else{return g}}while(f.getTime()<b.getTime()){c.push({text:(e(f.getMonth())+"-"+f.getFullYear()),value:(f.getFullYear()+""+e(f.getMonth()))});f.setMonth(f.getMonth()+1)}var d=(b.getFullYear()+""+e(b.getMonth()));a.ddlMes.shieldDropDown({dataSource:{data:c},textTemplate:"{text}",valueTemplate:"{value}",events:{select:function(g){a.loadGrids()}},value:d})};a.initGrids=function(){var d=[];d.push({field:"Fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),columnTemplate:function(e,g,f){e.html("<a>"+Core.Functions.grid.formatStringDate(g.Fecha)+"</a>");e.addClass("link-cell");e.on("click",function(){a.loadVistaPorEquipo(g.Fecha)})}});d.push({field:"PLTotalDolares",title:"Total Dólares",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});d.push({field:"PLTotalPesos",title:"Total Pesos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});d.push({field:"PLMesaDolares",title:"Mesa Dólares",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});d.push({field:"PLMesaPesos",title:"Mesa Pesos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});d.push({field:"PLComercialDolares",title:"Comercial Dólares",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});d.push({field:"PLComercialPesos",title:"Comercial Pesos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});a.divReportePorFecha.shieldGrid({dataSource:{data:[],aggregate:[{field:"PLTotalPesos",aggregate:"sum"},{field:"PLComercialPesos",aggregate:"sum"},{field:"PLMesaPesos",aggregate:"sum"},{field:"PLTotalDolares",aggregate:"sum"},{field:"PLComercialDolares",aggregate:"sum"},{field:"PLMesaDolares",aggregate:"sum"}]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"ReportePLMensual",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["Fecha","idEquipo","Equipo","Estrategia","PLTotalDolares","PLMesaDolares","PLComercialDolares","PLTotalPesos","PLMesaPesos","PLComercialPesos"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"ReportePLMensual"}}},selection:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},rowHover:false,columns:d});var c=[];c.push({field:"Fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatStringDate});c.push({field:"Equipo",title:"Equipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),columnTemplate:function(e,g,f){e.html("<a>"+g.Equipo+"</a>");e.addClass("link-cell");e.on("click",function(){a.loadVistaDetalle(g.Fecha,g.Equipo)})}});c.push({field:"PLTotalDolares",title:"Total Dólares",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});c.push({field:"PLTotalPesos",title:"Total Pesos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});c.push({field:"PLMesaDolares",title:"Mesa Dólares",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});c.push({field:"PLMesaPesos",title:"Mesa Pesos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});c.push({field:"PLComercialDolares",title:"Comercial Dólares",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});c.push({field:"PLComercialPesos",title:"Comercial Pesos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});a.divReportePorEquipo.shieldGrid({dataSource:{data:[],aggregate:[{field:"PLTotalPesos",aggregate:"sum"},{field:"PLComercialPesos",aggregate:"sum"},{field:"PLMesaPesos",aggregate:"sum"},{field:"PLTotalDolares",aggregate:"sum"},{field:"PLComercialDolares",aggregate:"sum"},{field:"PLMesaDolares",aggregate:"sum"}]},selection:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},rowHover:false,columns:c});var b=[];b.push({field:"Fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatStringDate});b.push({field:"Equipo",title:"Equipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Estrategia",title:"Estrategia",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"PLTotalDolares",title:"Total Dólares",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});b.push({field:"PLTotalPesos",title:"Total Pesos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});b.push({field:"PLMesaDolares",title:"Mesa Dólares",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});b.push({field:"PLMesaPesos",title:"Mesa Pesos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});b.push({field:"PLComercialDolares",title:"Comercial Dólares",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});b.push({field:"PLComercialPesos",title:"Comercial Pesos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor,footerTemplate:function(e,g,f){e.html(Core.Functions.grid.formatNumberWithColor(g.sum));e.css("text-align","right");e.css("padding-right","5px")}});a.divReportePorDetalle.shieldGrid({dataSource:{data:[],aggregate:[{field:"PLTotalPesos",aggregate:"sum"},{field:"PLComercialPesos",aggregate:"sum"},{field:"PLMesaPesos",aggregate:"sum"},{field:"PLTotalDolares",aggregate:"sum"},{field:"PLComercialDolares",aggregate:"sum"},{field:"PLMesaDolares",aggregate:"sum"}]},selection:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},rowHover:false,columns:b})};a.loadGrids=function(){a.lblTitle.text(a.ddlMes.swidget().text());var b;b="Fecha="+a.ddlMes.swidget().value()+"01";var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"pl/mensual",requestType:"GET",requestData:b});c.onSuccess=function(d){a.data=d.detalles;if(a.fechaElegida&&a.equipoElegido){a.loadVistaDetalle(a.fechaElegida,a.equipoElegido)}else{if(a.fechaElegida){a.loadVistaPorEquipo(a.fechaElegida)}else{a.loadVistaPorFecha()}}};c.request()};a.loadVistaPorFecha=function(){a.equipoElegido=null;a.fechaElegida=null;a.lblFilterDescription.html("");a.btnBack.hide();a.divContainerReporteDetalle.hide();a.divContainerReportePorFecha.show();a.divContainerReportePorEquipo.hide();a.refreshGrid(a.divReportePorFecha,a.groupFor(a.data,"Fecha"))};a.loadVistaPorEquipo=function(d){a.fechaElegida=d;a.equipoElegido=null;a.lblFilterDescription.html("");var b=$("<a>Fecha: </a>").appendTo(a.lblFilterDescription);b.on("click",function(){a.loadVistaPorFecha()});$("<label>"+Core.Functions.grid.formatStringDate(a.fechaElegida)+"</label>").appendTo(a.lblFilterDescription);a.btnBack.show();a.divContainerReporteDetalle.hide();a.divContainerReportePorFecha.hide();a.divContainerReportePorEquipo.show();var c=$.grep(a.data,function(f,e){return f.Fecha==a.fechaElegida});a.refreshGrid(a.divReportePorEquipo,a.groupFor(c,"Equipo"))};a.groupFor=function(b,c){var d=[];b.forEach(function(g,e){var f=-1;d.forEach(function(h,j){if(h[c]==g[c]){f=j}});if(f>=0){d[f].PLTotalPesos+=g.PLTotalPesos;d[f].PLComercialPesos+=g.PLComercialPesos;d[f].PLMesaPesos+=g.PLMesaPesos;d[f].PLTotalDolares+=g.PLTotalDolares;d[f].PLComercialDolares+=g.PLComercialDolares;d[f].PLMesaDolares+=g.PLMesaDolares}else{d.push({Fecha:g.Fecha,Equipo:g.Equipo,PLTotalPesos:g.PLTotalPesos,PLComercialPesos:g.PLComercialPesos,PLMesaPesos:g.PLMesaPesos,PLTotalDolares:g.PLTotalDolares,PLComercialDolares:g.PLComercialDolares,PLMesaDolares:g.PLMesaDolares})}});return d};a.loadVistaDetalle=function(f,e){a.fechaElegida=f;a.equipoElegido=e;a.divContainerReporteDetalle.show();a.divContainerReportePorFecha.hide();a.divContainerReportePorEquipo.hide();a.btnBack.show();a.lblFilterDescription.html("");var d=$.grep(a.data,function(h,g){return true});if(a.fechaElegida){d=$.grep(d,function(h,g){return h.Fecha==a.fechaElegida});var c=$("<a>Fecha: </a>").appendTo(a.lblFilterDescription);c.on("click",function(){a.loadVistaPorFecha()});$("<label>"+Core.Functions.grid.formatStringDate(a.fechaElegida)+"</label>").appendTo(a.lblFilterDescription)}if(a.equipoElegido){d=$.grep(d,function(h,g){return h.Equipo==a.equipoElegido});$("<label>&nbsp;>>&nbsp;</label>").appendTo(a.lblFilterDescription);var b=$("<a>Equipo: </a>").appendTo(a.lblFilterDescription);b.on("click",function(){a.loadVistaPorEquipo(a.fechaElegida)});$("<label>"+a.equipoElegido+"</label>").appendTo(a.lblFilterDescription)}a.refreshGrid(a.divReportePorDetalle,d)};a.refreshGrid=function(c,b){var d=c.swidget().initialOptions;d.dataSource.data=b;if(d.exportOptions){d.exportOptions.excel.dataSource.data=a.data;d.exportOptions.excel.readDataSource=true}c.swidget().refresh(d)}};Core.Business.MesaReportePosicion=new function(){var a=this;a.id="mesaReportePosicion";a.txtFilter=null;a.timeoutFilter=null;a.divPosicion=null;a.lblTitle=null;a.txtDate=null;a.pageOptions=null;a.btnRefresh=null;a.btnDescargar=null;a.chkVerIntencionalidad=null;a.ddlEquipo=null;a.window=$(window);a.init=function(b,c){Core.loadPage("mesa-reporte-posicion.html",function(){document.title="Posición Final de Bonos";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divPosicion=$(".div-posicion-final-bonos");a.txtFilter=$(".textbox-filter");a.lblTitle=$(".label-title");a.txtDate=$(".date-picker");a.btnRefresh=$(".btn-refresh");a.btnDescargar=$(".btn-descargar");a.chkVerIntencionalidad=$(".checkbox-ver-intencionalidad");a.ddlEquipo=$(".dropdown-equipo");a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.initControls,"Core.Business.MesaReportePosicion")})};a.initControls=function(){var b=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"equipos/1",requestType:"GET"});b.onSuccess=function(c){a.ddlEquipo.shieldDropDown({dataSource:{data:c.equipos},valueTemplate:"{idEquipo}",textTemplate:"{Equipo}",width:250,events:{select:function(d){a.loadGrid()}}});a.btnRefresh.click(function(){a.loadGrid()});a.btnDescargar.click(function(){function e(m){var l=new Blob([m.response],{type:m.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(l);return}var f=window.URL.createObjectURL(l);var k=document.createElement("a");k.href=f;var h=m.getResponseHeader("Content-Disposition").split("; ");var g="filename=reporte.pdf";for(var j=0;j<h.length;j++){if(h[j].indexOf("filename")>=0){g=h[j]}}k.download=g.split("=")[1];k.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(f)}var d=new XMLHttpRequest();d.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"descargar/9/"+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDate.swidget().value()))+"?idEquipo="+ +a.ddlEquipo.swidget().selectedItem().idEquipo,true);d.responseType="blob";d.setRequestHeader("Authorization",Core.Objects.Context.Token);d.onload=function(f){if(d.status==200){e(d)}else{var g=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga del reporte.</p>",{displayButtons:{close:true,accept:false}});g.show()}};d.send()});a.chkVerIntencionalidad.on("change",function(){if(a.divPosicion.swidget()){a.divPosicion.swidget().destroy()}a.initGrid();a.loadGrid()});a.txtDate.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(d){a.loadGrid()}}});a.txtFilter.on("keydown",function(){clearTimeout(a.timeoutFilter);a.timeoutFilter=setTimeout(function(){value=a.txtFilter.val();var d=a.divPosicion.swidget().dataSource;if(value){d.filter={or:[{path:"especie",filter:"contains",value:value}]}}else{d.filter=null}d.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.MesaReportePosicion.txtFilter");a.loadGrid()};b.request()};a.initGrid=function(){var b=[{width:"20%",field:"especie",title:"Especie",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"20%",field:"Equipo",title:"Equipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"20%",field:"SubTipoBono",title:"Sub-Tipo Bono",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"20%",field:"bcvcajaval",title:"BCV Caja de Valores",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNumberWithColor},{width:"20%",field:"bcv",title:"BCV (Plataforma)",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNumberWithColor},{width:50,field:"bcv",title:" ",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(d,f,e){if(f.bcv){var c=$('<button type="button" title="Detalles" class="btn-sm balanz-button" style="margin-left:8px;"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(d);c.on("click",function(){new Core.Controls.MesaDetalleMontoAcumulado({overlayElement:c,requestData:{FechaFin:Core.Functions.Date.getDateAsString(a.txtDate.swidget().value()),idCuenta:Core.Enums.eVehiculo.BCV,idNegocio:f.idNegocio,idInstrumento:f.idInstrumento,idDerivado:f.idDerivado,ticker:f.TickerOriginal}}).show()})}}},{width:"20%",field:"bcveuroclear",title:"BCV Euroclear",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNumberWithColor},{width:"20%",field:"fgt",title:"INT",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNumberWithColor},{width:50,field:"fgt",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(d,f,e){if(f.fgt){var c=$('<button type="button" title="Detalles" class="btn-sm balanz-button" style="margin-left:8px;"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(d);c.on("click",function(){new Core.Controls.MesaDetalleMontoAcumulado({overlayElement:c,requestData:{FechaFin:Core.Functions.Date.getDateAsString(a.txtDate.swidget().value()),idCuenta:Core.Enums.eVehiculo.INT,idNegocio:f.idNegocio,idInstrumento:f.idInstrumento,idDerivado:f.idDerivado,ticker:f.TickerOriginal}}).show()})}}},{width:"20%",field:"bci",title:"BCI",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNumberWithColor},{width:50,field:"bci",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(d,f,e){if(f.bci){var c=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(d);c.on("click",function(){new Core.Controls.MesaDetalleMontoAcumulado({overlayElement:c,requestData:{FechaFin:Core.Functions.Date.getDateAsString(a.txtDate.swidget().value()),idCuenta:Core.Enums.eVehiculo.BCI,idNegocio:f.idNegocio,idInstrumento:f.idInstrumento,idDerivado:f.idDerivado,ticker:f.TickerOriginal}}).show()})}}},{width:"20%",field:"garantias",title:"Garantías",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNumberWithColor},{width:"20%",field:"ajustes",title:"Ajustes",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNumberWithColor},{width:"20%",field:"posicionfinish",title:"Posición Final",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNumberWithColor},{width:"20%",field:"operado",title:"Operado",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNumberWithColor}];if(a.chkVerIntencionalidad[0].checked){b.push({width:"20%",field:"precioDolares",title:"Precio USD",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNumberWithColor});b.push({footerTemplate:"<div style='text-align: right;'>{sum:n2}</div>",width:"20%",field:"valorizadoDolares",title:"Dólares",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNumberWithColor});b.push({width:"20%",field:"nominalesParidad",title:"Nominales Paridad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNumberWithColor});b.push({width:"20%",field:"nominalesUSD",title:"Nominales USD",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNumberWithColor});b.push({footerTemplate:"<div style='text-align: right;'>{sum:n2}</div>",width:"20%",field:"paridadValorizada",title:"Monto Paridad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNumberWithColor});b.push({footerTemplate:"<div style='text-align: right;'>{sum:n2}</div>",width:"20%",field:"usdValorizada",title:"Monto USD",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNumberWithColor})}else{b.push({width:"20%",field:"precioPesos",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNumberWithColor});b.push({footerTemplate:"<div style='text-align: right;'>{sum:n2}</div>",width:"20%",field:"valorizadoPesos",title:"Pesos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNumberWithColor})}a.divPosicion.shieldGrid({dataSource:{data:[],aggregate:[{field:"valorizadoDolares",aggregate:"sum"},{field:"paridadValorizada",aggregate:"sum"},{field:"usdValorizada",aggregate:"sum"},{field:"valorizadoPesos",aggregate:"sum"}]},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:100,pageLinksCount:10},columns:b,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Posición Final de Bonos",columnFields:["especie","Equipo","SubTipoBono","bcvcajaval","bcv","bcveuroclear","fgt","bci","garantias","ajustes","posicionfinish","operado","precioPesos","valorizadoPesos","precioDolares","valorizadoDolares","nominalesParidad","nominalesUSD","paridadValorizada","usdValorizada"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Posición Final de Bonos"}}}})};a.loadGrid=function(){a.lblTitle.text("Al "+Core.Functions.Date.getDisplayDate(a.txtDate.swidget().value()));var b;b="Fecha="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDate.swidget().value()));b+="&idEquipo="+a.ddlEquipo.swidget().selectedItem().idEquipo;var c=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divPosicion.parent(),secureRequest:true,requestUrl:"reporte/posicionfinish",requestType:"GET",requestData:b});c.onSuccess=function(d){var f=a.window.scrollTop();var e=a.divPosicion.swidget().initialOptions;e.dataSource.data=d.posicion;e.dataSource.sort=a.divPosicion.swidget().dataSource.sort;e.dataSource.group=a.divPosicion.swidget().dataSource.group;e.exportOptions.excel.dataSource.data=d.posicion;e.exportOptions.excel.readDataSource=true;a.divPosicion.swidget().refresh(e);a.txtFilter.keydown();a.window.scrollTop(f)};c.request()}};Core.Business.MesaRepPosBackofficeCableMep=new function(){var a=this;a.id="mesaRepPosBackofficeCableMep";a.divPosicion=null;a.lblTitle=null;a.txtDate=null;a.btnRefresh=null;a.window=$(window);a.init=function(b,c){Core.loadPage("mesa-reporte-posicion-backoffice.html",function(){document.title="Posición en Dólares Cable / Mep";a.divPosicion=$(".div-posicion-backoffice");a.lblTitle=$(".label-title");a.txtDate=$(".date-picker");a.btnRefresh=$(".btn-refresh");a.initDatePicker();a.initGrid();a.initButtons();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.MesaRepPosBackofficeCableMep")})};a.initButtons=function(){a.btnRefresh.click(function(){a.loadGrid()})};a.initDatePicker=function(){a.txtDate.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(b){a.loadGrid()}}})};a.initGrid=function(){a.divPosicion.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:false,columns:[{width:"10%",field:"Cuenta",title:"Cuenta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(b,c,d){if(c.color!=""){b.html("<strong style='font- size: 14px;'>"+c.Cuenta+"</strong>");b.parent().css("background-color",c.color)}else{b.html(c.Cuenta)}}},{width:"30%",field:"Concepto",title:"Concepto",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(b,c,d){if(c.color!=""){b.html("<strong style='font-size: 14px;'>"+c.Concepto+"</strong>");b.parent().css("background-color",c.color)}else{b.html(c.Concepto)}}},{width:"15%",field:"BCI",title:"BCI",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(b,c,d){if(c.color!=""){b.html("<strong>"+Core.Functions.grid.formatNumberTotalWithColor(c.BCI)+"</strong>");b.parent().css("background-color",c.color)}else{b.html(Core.Functions.grid.formatNumberWithColor(c.BCI))}}},{width:"15%",field:"FGT",title:"INT",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(b,c,d){if(c.color!=""){b.html("<strong>"+Core.Functions.grid.formatNumberTotalWithColor(c.FGT)+"</strong>");b.parent().css("background-color",c.color)}else{b.html(Core.Functions.grid.formatNumberWithColor(c.FGT))}}},{width:"15%",field:"BCVMep",title:"BCV Mep",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(b,c,d){if(c.color!=""){b.html("<strong>"+Core.Functions.grid.formatNumberTotalWithColor(c.BCVMep)+"</strong>");b.parent().css("background-color",c.color)}else{b.html(Core.Functions.grid.formatNumberWithColor(c.BCVMep))}}},{width:"15%",field:"BCVCable",title:"BCV Cable",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(b,c,d){if(c.color!=""){b.html("<strong>"+Core.Functions.grid.formatNumberTotalWithColor(c.BCVCable)+"</strong>");b.parent().css("background-color",c.color)}else{b.html(Core.Functions.grid.formatNumberWithColor(c.BCVCable))}}}],toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Posición BackOffice",columnFields:["Cuenta","Concepto","BCI","FGT","BCVMep","BCVCable"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Posición BackOffice"}}}})};a.loadGrid=function(){a.lblTitle.text("Al "+Core.Functions.Date.getDisplayDate(a.txtDate.swidget().value()));var b;b="Fecha="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDate.swidget().value()));var c=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divPosicion.parent(),secureRequest:true,requestUrl:"reporte/posicionbackofficecablemep",requestType:"GET",requestData:b});c.onSuccess=function(d){var f=a.window.scrollTop();var e=a.divPosicion.swidget().initialOptions;e.dataSource.data=d.posicion;e.dataSource.sort=a.divPosicion.swidget().dataSource.sort;e.dataSource.group=a.divPosicion.swidget().dataSource.group;e.exportOptions.excel.dataSource.data=d.posicion;e.exportOptions.excel.readDataSource=true;a.divPosicion.swidget().refresh(e);a.window.scrollTop(f)};c.request()}};Core.Business.MesaReportePosicionBonos=new function(){var a=this;a.id="mesaReportePosicionBonos";a.txtFilter=null;a.timeoutFilter=null;a.divPosicion=null;a.lblTitle=null;a.txtDate=null;a.pageOptions=null;a.btnRefresh=null;a.btnDescargar=null;a.chkVerResumen=null;a.ddlEquipo=null;a.window=$(window);a.init=function(b,c){Core.loadPage("mesa-reporte-posicion-bonos.html",function(){document.title="Posición Final de Bonos";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divPosicion=$(".div-posicion-final-bonos");a.txtFilter=$(".textbox-filter");a.lblTitle=$(".label-title");a.txtDate=$(".date-picker");a.btnRefresh=$(".btn-refresh");a.btnDescargar=$(".btn-descargar");a.chkVerResumen=$(".checkbox-ver-resumido");a.ddlEquipo=$(".dropdown-equipo");a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.initControls,"Core.Business.MesaReportePosicionBonos")})};a.initControls=function(){var b=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"equipos/1",requestType:"GET"});b.onSuccess=function(c){a.ddlEquipo.shieldDropDown({dataSource:{data:c.equipos},valueTemplate:"{idEquipo}",textTemplate:"{Equipo}",width:250,events:{select:function(d){a.loadGrid()}}});a.btnRefresh.click(function(){a.loadGrid()});a.btnDescargar.click(function(){function e(m){var l=new Blob([m.response],{type:m.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(l);return}var f=window.URL.createObjectURL(l);var k=document.createElement("a");k.href=f;var h=m.getResponseHeader("Content-Disposition").split("; ");var g="filename=reporte.pdf";for(var j=0;j<h.length;j++){if(h[j].indexOf("filename")>=0){g=h[j]}}k.download=g.split("=")[1];k.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(f)}var d=new XMLHttpRequest();d.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"descargar/9/"+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDate.swidget().value()))+"?idEquipo="+ +a.ddlEquipo.swidget().selectedItem().idEquipo,true);d.responseType="blob";d.setRequestHeader("Authorization",Core.Objects.Context.Token);d.onload=function(f){if(d.status==200){e(d)}else{var g=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga del reporte.</p>",{displayButtons:{close:true,accept:false}});g.show()}};d.send()});a.chkVerResumen[0].checked=false;a.chkVerResumen.on("change",function(){if(a.divPosicion.swidget()){a.divPosicion.swidget().destroy()}a.initGrid();a.loadGrid()});a.txtDate.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(d){a.loadGrid()}}});a.txtFilter.on("keydown",function(){clearTimeout(a.timeoutFilter);a.timeoutFilter=setTimeout(function(){value=a.txtFilter.val();var d=a.divPosicion.swidget().dataSource;if(value){d.filter={or:[{path:"especie",filter:"contains",value:value}]}}else{d.filter=null}d.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.MesaReportePosicionBonos.txtFilter");a.loadGrid()};b.request()};a.initGrid=function(){var b=[];var c=[];b.push({width:"20%",field:"especie",title:"Especie",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});c.push("especie");if(a.chkVerResumen[0].checked){b.push({width:"20%",field:"resumenBCVPlataforma",headerTemplate:"<div title='Operaciones de la Cuenta BCV que aún no se han importado en ESCO VBolsa Argentina'>BCV Plataforma</div>",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,f,e){d.html(Core.Functions.grid.formatNumberWithColor(f.resumenBCVPlataforma));if(f.resumenBCVPlataforma){d.addClass("link-cell");d.on("click",function(){new Core.Business.MesaReportePosicionBonos.DetalleConcepto({title:"BCV Plataforma",requestData:{idCuenta:1,idNegocio:f.idNegocio,idInstrumento:f.idInstrumento,idDerivado:f.idDerivado,fecha:Core.Functions.Date.getDateAsString(a.txtDate.swidget().value())}}).show()})}}});c.push("resumenBCVPlataforma");b.push({width:"20%",field:"resumenBCVVB",headerTemplate:"<div title='Sumatoria de todas las columnas de BCV que vienen de VBolsa ESCO'>BCV VBolsa</div>",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor});c.push("resumenBCVVB");b.push({width:"20%",field:"resumenBCIPlataforma",headerTemplate:"<div title='Operaciones de la Cuenta BCI que aún no se han importado en ESCO VBolsa Panamá'>BCI Plataforma</div>",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,f,e){d.html(Core.Functions.grid.formatNumberWithColor(f.resumenBCIPlataforma));if(f.resumenBCIPlataforma){d.addClass("link-cell");d.on("click",function(){new Core.Business.MesaReportePosicionBonos.DetalleConcepto({title:"BCI Plataforma",requestData:{idCuenta:2,idNegocio:f.idNegocio,idInstrumento:f.idInstrumento,idDerivado:f.idDerivado,fecha:Core.Functions.Date.getDateAsString(a.txtDate.swidget().value())}}).show()})}}});c.push("resumenBCIPlataforma");b.push({width:"20%",field:"resumenBCIVB",headerTemplate:"<div title='95900 + BCI 5000 (Exterior). Posición en ESCO. Tanto el VBolsa ARG (95900) como VBolsa Panamá. Cuidando de no duplicar posiciones. '>BCI VBolsa</div>",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor});c.push("resumenBCIVB");b.push({width:"20%",field:"resumenFGTPlataforma",headerTemplate:"<div title='Todas las Operaciones históricas para la cuenta INT registradas en Plataforma'>INT Plataforma</div>",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,f,e){d.html(Core.Functions.grid.formatNumberWithColor(f.resumenFGTPlataforma));if(f.resumenFGTPlataforma){d.addClass("link-cell");d.on("click",function(){new Core.Business.MesaReportePosicionBonos.DetalleConcepto({title:"INT Plataforma",requestData:{idCuenta:3,idNegocio:f.idNegocio,idInstrumento:f.idInstrumento,idDerivado:f.idDerivado,fecha:Core.Functions.Date.getDateAsString(a.txtDate.swidget().value())}}).show()})}}});c.push("resumenFGTPlataforma");b.push({width:"20%",field:"posicionfinish",title:"Posición Final",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor});c.push("posicionfinish")}else{b.push({width:"20%",field:"Equipo",title:"Equipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});c.push("Equipo");b.push({width:"20%",field:"bcv",headerTemplate:"<div title='Operaciones de la Cuenta BCV que aún no se han importado en ESCO VBolsa Argentina'>BCV Plataforma</div>",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,f,e){d.html(Core.Functions.grid.formatNumberWithColor(f.bcv));if(f.bcv){d.addClass("link-cell");d.on("click",function(){new Core.Business.MesaReportePosicionBonos.DetalleConcepto({title:"BCV Plataforma",requestData:{idCuenta:1,idNegocio:f.idNegocio,idInstrumento:f.idInstrumento,idDerivado:f.idDerivado,fecha:Core.Functions.Date.getDateAsString(a.txtDate.swidget().value())}}).show()})}}});c.push("bcv");b.push({width:"20%",field:"ajustes",title:"BCV Ajustes",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,f,e){d.html(Core.Functions.grid.formatNumberWithColor(f.ajustes));if(f.ajustes){d.addClass("link-cell");d.on("click",function(){new Core.Business.MesaReportePosicionBonos.DetalleConcepto({title:"BCV Ajustes",requestData:{idCuenta:1,idNegocio:8,idInstrumento:f.idInstrumento,idDerivado:f.idDerivado,fecha:Core.Functions.Date.getDateAsString(a.txtDate.swidget().value())}}).show()})}}});c.push("ajustes");b.push({width:"20%",field:"bcvcajaval5000",title:"C Valores 5.000",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor});c.push("bcvcajaval5000");b.push({width:"20%",field:"bcveuroclear",title:"BCV Euroclear",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor});c.push("bcveuroclear");b.push({width:"20%",field:"bcvotrosdepositarios",title:"BCV Otros Depositarios",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor});c.push("bcvotrosdepositarios");b.push({width:"20%",field:"garantias",title:"BCV Garantías (6000 y 6001)",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor});c.push("garantias");b.push({width:"20%",field:"bcvcajaval95900",title:"95.900",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor});c.push("bcvcajaval95900");b.push({width:"20%",field:"bci",headerTemplate:"<div title='Operaciones de la Cuenta BCI que aún no se han importado en ESCO VBolsa Panamá'>BCI Plataforma</div>",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,f,e){d.html(Core.Functions.grid.formatNumberWithColor(f.bci));if(f.bci){d.addClass("link-cell");d.on("click",function(){new Core.Business.MesaReportePosicionBonos.DetalleConcepto({title:"BCI Plataforma",requestData:{idCuenta:2,idNegocio:f.idNegocio,idInstrumento:f.idInstrumento,idDerivado:f.idDerivado,fecha:Core.Functions.Date.getDateAsString(a.txtDate.swidget().value())}}).show()})}}});c.push("bci");b.push({width:"20%",field:"bci5000Exterior",headerTemplate:"<div title='Posición de la 5000 de VBolsa Panamá que no se encuentra registrada en la 95900 Arg'>BCI 5000 (Exterior)</div>",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor});c.push("bci5000Exterior");b.push({width:"20%",field:"fgt",headerTemplate:"<div title='Todas las Operaciones históricas para la cuenta INT registradas en Plataforma'>INT Plataforma</div>",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,f,e){d.html(Core.Functions.grid.formatNumberWithColor(f.fgt));if(f.fgt){d.addClass("link-cell");d.on("click",function(){new Core.Business.MesaReportePosicionBonos.DetalleConcepto({title:"INT Plataforma",requestData:{idCuenta:3,idNegocio:f.idNegocio,idInstrumento:f.idInstrumento,idDerivado:f.idDerivado,fecha:Core.Functions.Date.getDateAsString(a.txtDate.swidget().value())}}).show()})}}});c.push("fgt");b.push({width:"20%",field:"posicionfinish",title:"Posición Final",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor});c.push("posicionfinish");b.push({width:"20%",field:"operado",title:"Operado",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor});c.push("operado")}b.push({width:"20%",field:"precioPesos",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor});c.push("precioPesos");b.push({footerTemplate:"<div style='text-align: right;'>{sum:n2}</div>",width:"20%",field:"valorizadoPesos",title:"Pesos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor});c.push("valorizadoPesos");c.push("precioDolares");c.push("valorizadoDolares");a.divPosicion.shieldGrid({dataSource:{data:[],aggregate:[{field:"valorizadoDolares",aggregate:"sum"},{field:"paridadValorizada",aggregate:"sum"},{field:"usdValorizada",aggregate:"sum"},{field:"valorizadoPesos",aggregate:"sum"}]},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:100,pageLinksCount:10},columns:b,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Posición Final de Bonos",columnFields:c,header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Posición Final de Bonos"}}}})};a.loadGrid=function(){a.lblTitle.text("Al "+Core.Functions.Date.getDisplayDate(a.txtDate.swidget().value()));var b;b="Fecha="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDate.swidget().value()));b+="&idEquipo="+a.ddlEquipo.swidget().selectedItem().idEquipo;var c=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divPosicion.parent(),secureRequest:true,requestUrl:"reporte/posicionfinish",requestType:"GET",requestData:b});c.onSuccess=function(d){var f=a.window.scrollTop();var e=a.divPosicion.swidget().initialOptions;e.dataSource.data=d.posicion;e.dataSource.sort=a.divPosicion.swidget().dataSource.sort;e.dataSource.group=a.divPosicion.swidget().dataSource.group;e.exportOptions.excel.dataSource.data=d.posicion;e.exportOptions.excel.readDataSource=true;a.divPosicion.swidget().refresh(e);a.txtFilter.keydown();a.window.scrollTop(f)};c.request()}};Core.Business.MesaReportePosicionBonos.DetalleConcepto=function(b){var a=this;a.divModal=$(".div-modal-detalles-concepto");a.title="";a.requestData={};$.extend(true,a,b);a.divDetalles=null;a.show=function(){a.divDetalles=a.divModal.find(".div-detalles-concepto");a.lblTitle=a.divModal.find(".label-title");a.lblTitle.text(a.title);if(!a.divDetalles.swidget()){a.initGrid()}a.loadGrid();a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.divModal.modal({show:true})};a.initGrid=function(){a.divDetalles.shieldGrid({dataSource:{data:[],aggregate:[{field:"CantidadFoto",aggregate:"sum"}]},selection:false,noRecordsText:"No hay operaciones para informar",rowHover:false,paging:{pageSize:100,pageLinksCount:10},sorting:{multiple:true},columns:[{width:"5%",field:"idOperacion",title:"ID",headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"8%",field:"FechaFoto",title:"Fecha Foto",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatStringDate},{title:"Cantidad Foto",field:"CantidadFoto",width:"10%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(c,d,f){var e="";if(d.CantidadFoto<0){e="red"}c.html("<span class='"+e+"'>"+Core.Functions.grid.formatPrice(d.CantidadFoto)+"</span>")},footerTemplate:"<div style='text-align: right;'>{sum:n2}</div>"},{width:"7%",field:"FechaOperacion",title:"Concertación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatStringDate},{width:"7%",field:"FechaLiquidacion",title:"Liquidación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatStringDate},{width:"5%",field:"Vehiculo",title:"Cuenta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"6%",field:"TipoOperacion",title:"Operación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"8%",field:"Contraparte",title:"Contraparte",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"8%",field:"Ticker",title:"Especie",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{title:"Cantidad",field:"Cantidad",width:"10%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(c,d,f){var e="";if(d.TipoOperacion=="Venta"){e="red"}c.html(Core.Functions.grid.formatPrice(d.Cantidad))}},{width:"10%",field:"Precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatPrice},{width:"8%",field:"Moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{title:"Monto",field:"Monto",width:"10%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(c,d,e){c.html(Core.Functions.grid.formatPrice(d.Monto))}},{width:"6%",field:"Estado",title:"Estado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"5%",field:"UsuarioCreacion",title:"Alta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"5%",field:"UsuarioOperador",title:"Operador",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()}],toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Reporte  Detalles Conceptos",columnFields:["idOperacion","FechaFoto","CantidadFoto","FechaOperacion","FechaLiquidacion","Vehiculo","TipoOperacion","Contraparte","Ticker","Cantidad","Precio","Moneda","Monto","Estado","UsuarioCreacion","UsuarioOperador"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Reporte Detalles Conceptos"}}}})};a.loadGrid=function(){var c=new Core.Ajax.ServerRequest({overlayElement:a.divModal.find(".modal-content"),showOverlay:true,secureRequest:true,requestUrl:"detalleconcepto",requestType:"GET",requestData:a.requestData});c.onSuccess=function(e){var d=a.divDetalles.swidget().initialOptions;d.dataSource.data=e.operaciones;d.exportOptions.excel.dataSource.data=e.operaciones;d.exportOptions.excel.readDataSource=true;a.divDetalles.swidget().refresh(d)};c.request()};a.destroy=function(){a.divDetalles.swidget().destroy()}};Core.Business.MesaReportePosicionBonos2=new function(){var a=this;a.id="mesaReportePosicionBonos2";a.txtFilter=null;a.timeoutFilter=null;a.divPosicion=null;a.lblTitle=null;a.txtDate=null;a.pageOptions=null;a.btnRefresh=null;a.btnDescargar=null;a.chkVerResumen=null;a.ddlEquipo=null;a.window=$(window);a.init=function(b,c){Core.loadPage("mesa-reporte-posicion-bonos-2.html",function(){document.title="Posición Final de Bonos";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divPosicion=$(".div-posicion-final-bonos");a.txtFilter=$(".textbox-filter");a.lblTitle=$(".label-title");a.txtDate=$(".date-picker");a.btnRefresh=$(".btn-refresh");a.btnDescargar=$(".btn-descargar");a.chkVerResumen=$(".checkbox-ver-resumido");a.ddlEquipo=$(".dropdown-equipo");a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.initControls,"Core.Business.MesaReportePosicionBonos2")})};a.initControls=function(){var b=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"equipos/1",requestType:"GET"});b.onSuccess=function(c){a.ddlEquipo.shieldDropDown({dataSource:{data:c.equipos},valueTemplate:"{idEquipo}",textTemplate:"{Equipo}",width:250,events:{select:function(d){a.loadGrid()}}});a.btnRefresh.click(function(){a.loadGrid()});a.btnDescargar.click(function(){function e(m){var l=new Blob([m.response],{type:m.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(l);return}var f=window.URL.createObjectURL(l);var k=document.createElement("a");k.href=f;var h=m.getResponseHeader("Content-Disposition").split("; ");var g="filename=reporte.pdf";for(var j=0;j<h.length;j++){if(h[j].indexOf("filename")>=0){g=h[j]}}k.download=g.split("=")[1];k.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(f)}var d=new XMLHttpRequest();d.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"descargar/9/"+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDate.swidget().value()))+"?idEquipo="+ +a.ddlEquipo.swidget().selectedItem().idEquipo,true);d.responseType="blob";d.setRequestHeader("Authorization",Core.Objects.Context.Token);d.onload=function(f){if(d.status==200){e(d)}else{var g=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga del reporte.</p>",{displayButtons:{close:true,accept:false}});g.show()}};d.send()});a.chkVerResumen[0].checked=false;a.chkVerResumen.on("change",function(){if(a.divPosicion.swidget()){a.divPosicion.swidget().destroy()}a.initGrid();a.loadGrid()});a.txtDate.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(d){a.loadGrid()}}});a.txtFilter.on("keydown",function(){clearTimeout(a.timeoutFilter);a.timeoutFilter=setTimeout(function(){value=a.txtFilter.val();var d=a.divPosicion.swidget().dataSource;if(value){d.filter={or:[{path:"especie",filter:"contains",value:value}]}}else{d.filter=null}d.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.MesaReportePosicionBonos2.txtFilter");a.loadGrid()};b.request()};a.initGrid=function(){var b=[];var c=[];b.push({width:"20%",field:"especie",title:"Especie",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});c.push("especie");if(a.chkVerResumen[0].checked){b.push({width:"20%",field:"resumenBCVPlataforma",title:"BCV Plataforma",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor});c.push("resumenBCVPlataforma");b.push({width:"20%",field:"resumenBCVVB",title:"BCV VBolsa",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor});c.push("resumenBCVVB");b.push({width:"20%",field:"resumenBCIPlataforma",title:"BCI Plataforma",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,f,e){d.html(Core.Functions.grid.formatNumberWithColor(f.resumenBCIPlataforma));if(f.resumenBCIPlataforma){d.addClass("link-cell");d.on("click",function(){new Core.Business.MesaReportePosicionBonos2.DetalleConcepto({title:"BCI Plataforma",requestData:{idCuenta:2,idNegocio:f.idNegocio,idInstrumento:f.idInstrumento,idDerivado:f.idDerivado,fecha:Core.Functions.Date.getDateAsString(a.txtDate.swidget().value())}}).show()})}}});c.push("resumenBCIPlataforma");b.push({width:"20%",field:"resumenBCIVB",title:"BCI VBolsa",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor});c.push("resumenBCIVB");b.push({width:"20%",field:"resumenFGTPlataforma",title:"INT Plataforma",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,f,e){d.html(Core.Functions.grid.formatNumberWithColor(f.resumenFGTPlataforma));if(f.resumenFGTPlataforma){d.addClass("link-cell");d.on("click",function(){new Core.Business.MesaReportePosicionBonos2.DetalleConcepto({title:"INT Plataforma",requestData:{idCuenta:3,idNegocio:f.idNegocio,idInstrumento:f.idInstrumento,idDerivado:f.idDerivado,fecha:Core.Functions.Date.getDateAsString(a.txtDate.swidget().value())}}).show()})}}});c.push("resumenFGTPlataforma");b.push({width:"20%",field:"resumenUKPlataforma",title:"UK",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor});c.push("resumenUKPlataforma");b.push({width:"20%",field:"posicionfinish",title:"Posición Final",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor});c.push("posicionfinish")}else{b.push({width:"20%",field:"Equipo",title:"Equipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});c.push("Equipo");b.push({width:"20%",field:"bcv",title:"BCV Plataforma",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,f,e){d.html(Core.Functions.grid.formatNumberWithColor(f.bcv));if(f.bcv){d.addClass("link-cell");d.on("click",function(){new Core.Business.MesaReportePosicionBonos2.DetalleConcepto({title:"BCV Plataforma",requestData:{idCuenta:1,idNegocio:f.idNegocio,idInstrumento:f.idInstrumento,idDerivado:f.idDerivado}}).show()})}}});c.push("bcv");b.push({width:"20%",field:"ajustes",title:"BCV Ajustes",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,f,e){d.html(Core.Functions.grid.formatNumberWithColor(f.ajustes));if(f.ajustes){d.addClass("link-cell");d.on("click",function(){new Core.Business.MesaReportePosicionBonos2.DetalleConcepto({title:"BCV Ajustes",requestData:{idCuenta:1,idNegocio:8,idInstrumento:f.idInstrumento,idDerivado:f.idDerivado}}).show()})}}});c.push("ajustes");b.push({width:"20%",field:"bcvcajaval5000",title:"C Valores 5.000",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor});c.push("bcvcajaval5000");b.push({width:"20%",field:"bcveuroclear",title:"BCV Euroclear",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor});c.push("bcveuroclear");b.push({width:"20%",field:"bcvotrosdepositarios",title:"BCV Otros Depositarios",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor});c.push("bcvotrosdepositarios");b.push({width:"20%",field:"garantias",title:"BCV Garantías",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,f,e){d.html(Core.Functions.grid.formatNumberWithColor(f.garantias));if(f.garantias){d.addClass("link-cell");d.on("click",function(){new Core.Business.MesaReportePosicionBonos2.DetalleGarantias({title:"BCV Garantías",requestData:{Fecha:Core.Functions.Date.getDateAsString(a.txtDate.swidget().value()),idNegocio:f.idNegocio,idInstrumento:f.idInstrumento,idDerivado:f.idDerivado}}).show()})}}});c.push("garantias");b.push({width:"20%",field:"bcvcajaval95900",title:"C Valores 95.900",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor});c.push("bcvcajaval95900");b.push({width:"20%",field:"plataformaExterior",title:"BCI+INT Plataforma",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor});c.push("plataformaExterior");b.push({width:"20%",field:"posicionfinish",title:"Posición Final",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor});c.push("posicionfinish");b.push({width:"20%",field:"operado",title:"Operado",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor});c.push("operado")}b.push({width:"20%",field:"precioPesos",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor});c.push("precioPesos");b.push({footerTemplate:"<div style='text-align: right;'>{sum:n2}</div>",width:"20%",field:"valorizadoPesos",title:"Pesos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumberWithColor});c.push("valorizadoPesos");c.push("precioDolares");c.push("valorizadoDolares");a.divPosicion.shieldGrid({dataSource:{data:[],aggregate:[{field:"valorizadoDolares",aggregate:"sum"},{field:"paridadValorizada",aggregate:"sum"},{field:"usdValorizada",aggregate:"sum"},{field:"valorizadoPesos",aggregate:"sum"}]},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:100,pageLinksCount:10},columns:b,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Posición Final de Bonos",columnFields:c,header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Posición Final de Bonos"}}}})};a.loadGrid=function(){a.lblTitle.text("Al "+Core.Functions.Date.getDisplayDate(a.txtDate.swidget().value()));var b;b="Fecha="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDate.swidget().value()));b+="&idEquipo="+a.ddlEquipo.swidget().selectedItem().idEquipo;var c=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divPosicion.parent(),secureRequest:true,requestUrl:"reporte/posicionfinish2",requestType:"GET",requestData:b});c.onSuccess=function(d){var f=a.window.scrollTop();var e=a.divPosicion.swidget().initialOptions;e.dataSource.data=d.posicion;e.dataSource.sort=a.divPosicion.swidget().dataSource.sort;e.dataSource.group=a.divPosicion.swidget().dataSource.group;e.exportOptions.excel.dataSource.data=d.posicion;e.exportOptions.excel.readDataSource=true;a.divPosicion.swidget().refresh(e);a.txtFilter.keydown();a.window.scrollTop(f)};c.request()}};Core.Business.MesaReportePosicionBonos2.DetalleGarantias=function(b){var a=this;a.divModal=$(".div-modal-detalles-concepto");a.requestData={};a.title="";$.extend(true,a,b);a.lblTitle=null;a.divDetalles=null;a.show=function(){a.divDetalles=a.divModal.find(".div-detalles-concepto");a.lblTitle=a.divModal.find(".label-title");a.lblTitle.text(a.title);if(!a.divDetalles.swidget()){a.initGrid()}a.loadGrid();a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.divModal.modal({show:true})};a.initGrid=function(){a.divDetalles.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:[{field:"Especie",title:"Especie",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"Garantias5000",title:"Garantías 5.000",headerAttributes:Core.Functions.grid.getCellOddClass(),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatNumberWithColor},{field:"Garantias95900",title:"Garantías 95.900",headerAttributes:Core.Functions.grid.getCellEvenClass(),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatNumberWithColor},{field:"Garantias40112",title:"Garantías 40.112",headerAttributes:Core.Functions.grid.getCellOddClass(),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatNumberWithColor},{field:"Garantias20875",title:"Garantías 20.875",headerAttributes:Core.Functions.grid.getCellEvenClass(),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatNumberWithColor},{field:"Garantias20023",title:"Garantías 20.023",headerAttributes:Core.Functions.grid.getCellOddClass(),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatNumberWithColor}]})};a.loadGrid=function(){var c=new Core.Ajax.ServerRequest({overlayElement:a.divModal.find(".modal-content"),showOverlay:true,secureRequest:true,requestUrl:"reporte/posiciongarantiasdetalle",requestType:"GET",requestData:a.requestData});c.onSuccess=function(f){var d=f.garantias==null?[]:f.garantias;var e=a.divDetalles.swidget().initialOptions;e.dataSource.data=d;a.divDetalles.swidget().refresh(e)};c.request()};a.destroy=function(){a.divDetalles.swidget().destroy()}};Core.Business.MesaReportePosicionBonos2.DetalleConcepto=function(b){var a=this;a.divModal=$(".div-modal-detalles-concepto");a.title="";a.requestData={};$.extend(true,a,b);a.divDetalles=null;a.show=function(){a.divDetalles=a.divModal.find(".div-detalles-concepto");a.lblTitle=a.divModal.find(".label-title");a.lblTitle.text(a.title);if(!a.divDetalles.swidget()){a.initGrid()}a.loadGrid();a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.divModal.modal({show:true})};a.initGrid=function(){a.divDetalles.shieldGrid({dataSource:{data:[],aggregate:[{field:"CantidadFoto",aggregate:"sum"}]},selection:false,noRecordsText:"No hay operaciones para informar",rowHover:false,paging:{pageSize:100,pageLinksCount:10},sorting:{multiple:true},columns:[{width:"5%",field:"idOperacion",title:"ID",headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"8%",field:"FechaFoto",title:"Fecha Foto",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatStringDate},{title:"Cantidad Foto",field:"CantidadFoto",width:"10%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(c,d,f){var e="";if(d.CantidadFoto<0){e="red"}c.html("<span class='"+e+"'>"+Core.Functions.grid.formatPrice(d.CantidadFoto)+"</span>")},footerTemplate:"<div style='text-align: right;'>{sum:n2}</div>"},{width:"7%",field:"FechaOperacion",title:"Concertación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatStringDate},{width:"7%",field:"FechaLiquidacion",title:"Liquidación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatStringDate},{width:"5%",field:"Vehiculo",title:"Cuenta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"6%",field:"TipoOperacion",title:"Operación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"8%",field:"Contraparte",title:"Contraparte",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"8%",field:"Ticker",title:"Especie",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{title:"Cantidad",field:"Cantidad",width:"10%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(c,d,f){var e="";if(d.TipoOperacion=="Venta"){e="red"}c.html(Core.Functions.grid.formatPrice(d.Cantidad))}},{width:"10%",field:"Precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatPrice},{width:"8%",field:"Moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{title:"Monto",field:"Monto",width:"10%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(c,d,e){c.html(Core.Functions.grid.formatPrice(d.Monto))}},{width:"6%",field:"Estado",title:"Estado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"5%",field:"UsuarioCreacion",title:"Alta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"5%",field:"UsuarioOperador",title:"Operador",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()}],toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Reporte  Detalles Conceptos",columnFields:["idOperacion","FechaFoto","CantidadFoto","FechaOperacion","FechaLiquidacion","Vehiculo","TipoOperacion","Contraparte","Ticker","Cantidad","Precio","Moneda","Monto","Estado","UsuarioCreacion","UsuarioOperador"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Reporte Detalles Conceptos"}}}})};a.loadGrid=function(){var c=new Core.Ajax.ServerRequest({overlayElement:a.divModal.find(".modal-content"),showOverlay:true,secureRequest:true,requestUrl:"detalleconcepto",requestType:"GET",requestData:a.requestData});c.onSuccess=function(e){var d=a.divDetalles.swidget().initialOptions;d.dataSource.data=e.operaciones;d.exportOptions.excel.dataSource.data=e.operaciones;d.exportOptions.excel.readDataSource=true;a.divDetalles.swidget().refresh(d)};c.request()};a.destroy=function(){a.divDetalles.swidget().destroy()}};Core.Business.MesaRepPosCableMep=new function(){var a=this;a.id="mesaReportePosicionCableMep";a.divPosicion=null;a.lblTitle=null;a.txtDate=null;a.pageOptions=null;a.btnRefresh=null;a.window=$(window);a.init=function(b,c){Core.loadPage("mesa-reporte-posicion-cable-mep.html",function(){document.title="Posición en Dólares Cable / Mep";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divPosicion=$(".div-posicion-final-bonos");a.lblTitle=$(".label-title");a.txtDate=$(".date-picker");a.btnRefresh=$(".btn-refresh");a.initDatePicker();a.initGrid();a.initButtons();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.MesaRepPosCableMep")})};a.initButtons=function(){a.btnRefresh.click(function(){a.loadGrid()})};a.initDatePicker=function(){a.txtDate.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(b){a.loadGrid()}}})};a.initGrid=function(){a.divPosicion.shieldGrid({dataSource:{data:[],group:[{field:"General",order:"asc",aggregate:[{field:"Cable",aggregate:"sum",type:Number},{field:"Mep",aggregate:"sum",type:Number},{field:"Total",aggregate:"sum",type:Number}]},{field:"GrupoDescripcion",order:"asc",aggregate:[{field:"Cable",aggregate:"sum",type:Number},{field:"Mep",aggregate:"sum",type:Number},{field:"Total",aggregate:"sum",type:Number}]}]},grouping:{showGroupHeader:false,allowDragToGroup:false},selection:false,rowHover:false,columns:[{width:"10%",field:"Abreviatura",title:"Cuenta",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(b,e,d){var c=["0,0,0","190,248,162","233,248,162","248,220,162","248,177,162","162,244,248","209,259,253","18,249,85","248,255,35"];b.text(e.Abreviatura);b.css("text-align","left");b.css("padding-left","5px");b.css("background-color",(e.Grupo>8)?"rgba(0,0,0,0)":("rgba("+c[(e.Grupo%9)]+((d%2==0)?", 0.6":", 1 ")+")"))}},{width:"20%",field:"Concepto",title:"Concepto",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(b,e,d){var c=["0,0,0","190,248,162","233,248,162","248,220,162","248,177,162","162,244,248","209,259,253","18,249,85","248,255,35"];b.text(e.Concepto);b.css("text-align","left");b.css("padding-left","5px");b.css("background-color",(e.Grupo>8)?"rgba(0,0,0,0)":("rgba("+c[(e.Grupo%9)]+((d%2==0)?", 0.6":", 1 ")+")"))}},{width:"17%",field:"Cable",title:"Cable",headerAttributes:Core.Functions.grid.getCellOddClass(),groupFooterTemplate:function(b,d,c){b.html(Core.Functions.grid.formatUndefinedNumberWithColor(d.sum));b.css("text-align","right");b.css("padding-right","5px");if(d.sum<0){b.css("color","red")}},columnTemplate:function(b,e,d){var c=["0,0,0","190,248,162","233,248,162","248,220,162","248,177,162","162,244,248","209,259,253","18,249,85","248,255,35"];b.html(Core.Functions.grid.formatUndefinedNumberWithColor(e.Cable));b.css("text-align","right");b.css("padding-right","5px");b.css("background-color",(e.Grupo>8)?"rgba(0,0,0,0)":("rgba("+c[(e.Grupo%9)]+((d%2==0)?", 0.6":", 1 ")+")"))}},{width:"17%",field:"Mep",title:"Mep",headerAttributes:Core.Functions.grid.getCellEvenClass(),groupFooterTemplate:function(b,d,c){b.html(Core.Functions.grid.formatUndefinedNumberWithColor(d.sum));b.css("text-align","right");b.css("padding-right","5px");if(d.sum<0){b.css("color","red")}},columnTemplate:function(b,e,d){var c=["0,0,0","190,248,162","233,248,162","248,220,162","248,177,162","162,244,248","209,259,253","18,249,85","248,255,35"];b.html(Core.Functions.grid.formatUndefinedNumberWithColor(e.Mep));b.css("text-align","right");b.css("padding-right","5px");b.css("background-color",(e.Grupo>8)?"rgba(0,0,0,0)":("rgba("+c[(e.Grupo%9)]+((d%2==0)?", 0.6":", 1 ")+")"))}},{width:"17%",field:"Total",title:"Total",headerAttributes:Core.Functions.grid.getCellOddClass(),groupFooterTemplate:function(b,d,c){b.html(Core.Functions.grid.formatUndefinedNumberWithColor(d.sum));b.css("text-align","right");b.css("padding-right","5px");if(d.sum<0){b.css("color","red")}},columnTemplate:function(b,e,d){var c=["0,0,0","190,248,162","233,248,162","248,220,162","248,177,162","162,244,248","209,259,253","18,249,85","248,255,35"];b.html(Core.Functions.grid.formatUndefinedNumberWithColor(e.Total));b.css("text-align","right");b.css("padding-right","5px");b.css("background-color",(e.Grupo>8)?"rgba(0,0,0,0)":("rgba("+c[(e.Grupo%9)]+((d%2==0)?", 0.6":", 1 ")+")"))}},{field:"",title:" ",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"4%",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(c,f,e){var d=["0,0,0","190,248,162","233,248,162","248,220,162","248,177,162","162,244,248","209,259,253","18,249,85","248,255,35"];c.css("background-color",(f.Grupo>8)?"rgba(0,0,0,0)":("rgba("+d[(f.Grupo%9)]+((e%2==0)?", 0.6":", 1 ")+")"));if(f.HabilitarDetalle){var b=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(c);b.on("click",function(){new Core.Controls.MesaDetalleMontoAcumulado({overlayElement:b,requestData:{FechaFin:Core.Functions.Date.getDateAsString(a.txtDate.swidget().value()),idCuenta:f.idCuenta,idNegocio:f.idNegocio,idInstrumento:f.idInstrumento,idDerivado:f.DerivadoDefault}}).show()})}}}],toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Posición en Dólares Cable / Mep",columnFields:["Abreviatura","Concepto","Cable","Mep"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Posición en Dólares Cable / Mep"}}}})};a.loadGrid=function(){a.lblTitle.text("Al "+Core.Functions.Date.getDisplayDate(a.txtDate.swidget().value()));var b;b="Fecha="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDate.swidget().value()));var c=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divPosicion.parent(),secureRequest:true,requestUrl:"reporte/posicioncablemep",requestType:"GET",requestData:b});c.onSuccess=function(d){var f=a.window.scrollTop();var e=a.divPosicion.swidget().initialOptions;e.dataSource.data=d.posicion;e.dataSource.sort=a.divPosicion.swidget().dataSource.sort;e.dataSource.group=a.divPosicion.swidget().dataSource.group;e.exportOptions.excel.dataSource.data=d.posicion;e.exportOptions.excel.readDataSource=true;a.divPosicion.swidget().refresh(e);a.window.scrollTop(f)};c.request()}};Core.Business.MesaReporteUSD=new function(){var a=this;a.id="mesaReporteUSD";a.divPosicion=null;a.lblTitle=null;a.txtDate=null;a.pageOptions=null;a.btnRefresh=null;a.originalData=null;a.window=$(window);a.init=function(b,c){Core.loadPage("mesa-reporte-posicion-usd.html",function(){document.title="Posición en Dólares";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divPosicion=$(".div-posicion-final-bonos");a.lblTitle=$(".label-title");a.txtDate=$(".date-picker");a.btnRefresh=$(".btn-refresh");a.initDatePicker();a.initGrid();a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadGrid()},"Core.Business.MesaReporteUSD")})};a.initControls=function(){a.btnRefresh.on("click",function(){a.loadGrid()})};a.initDatePicker=function(){var b=new Date(2018,0,3);a.txtDate.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),min:b,max:new Date(),events:{change:function(c){a.loadGrid()}}})};a.initGrid=function(){a.divPosicion.shieldGrid({dataSource:{data:[],aggregate:[{field:"Cable",aggregate:"sum"},{field:"Mep",aggregate:"sum"},{field:"TotalCM",aggregate:"sum"}]},selection:false,rowHover:false,columns:[{footerTemplate:"<div style='text-align: left;'>Total</div>",width:"20%",field:"MesName",title:"Mes",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"4%",field:"bcv",title:" ",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(c,e,d){var b=$('<button type="button" title="Detalles" class="btn-sm balanz-button" style="margin-left:8px;"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(c);b.on("click",function(){new Core.Business.MesaReporteUSD.Detalles({overlayElement:b,requestData:{Ano:e.AnoConcertacion,Mes:e.MesConcertacion}}).show()})}},{footerTemplate:function(b,c,e){var f=0;if(a.divPosicion.swidget()){f=a.originalData.montoAcumuladoCable;for(var d=0;d<a.divPosicion.swidget().dataSource.data.length;d++){f+=a.divPosicion.swidget().dataSource.data[d].Cable}}b.html("<div style='text-align: right;'>"+Core.Functions.grid.formatNumber(f)+"</div>")},field:"Cable",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"15%",title:"Cable",headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNumberWithColor},{footerTemplate:function(b,c,e){var f=0;if(a.divPosicion.swidget()){f=a.originalData.montoAcumuladoMep;for(var d=0;d<a.divPosicion.swidget().dataSource.data.length;d++){f+=a.divPosicion.swidget().dataSource.data[d].Mep}}b.html("<div style='text-align: right;'>"+Core.Functions.grid.formatNumber(f)+"</div>")},field:"Mep",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"15%",title:"Mep",headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNumberWithColor},{field:"PPCable",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"15%",title:"PPCable",headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNumberWithColor},{field:"PPMep",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"15%",title:"PPMep",headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNumberWithColor},{footerTemplate:function(b,c,e){var f=0;if(a.divPosicion.swidget()){f=a.originalData.montoAcumuladoMep+a.originalData.montoAcumuladoCable;for(var d=0;d<a.divPosicion.swidget().dataSource.data.length;d++){f+=a.divPosicion.swidget().dataSource.data[d].TotalCM}}b.html("<div style='text-align: right;'>"+Core.Functions.grid.formatNumber(f)+"</div>")},field:"TotalCM",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"15%",title:"Total C+M",headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNumberWithColor}]})};a.loadGrid=function(){a.lblTitle.text("Al "+Core.Functions.Date.getDisplayDate(a.txtDate.swidget().value()));var b;b="Fecha="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDate.swidget().value()));var c=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divPosicion.parent(),secureRequest:true,requestUrl:"reporte/mensualusd",requestType:"GET",requestData:b});c.onSuccess=function(d){a.originalData=d;var f=a.window.scrollTop();var e=a.divPosicion.swidget().initialOptions;e.dataSource.data=a.originalData.posicion;e.dataSource.sort=a.divPosicion.swidget().dataSource.sort;a.divPosicion.swidget().refresh(e);a.window.scrollTop(f)};c.request()}};Core.Business.MesaReporteUSD.Detalles=function(b){var a=this;a.divDetalleReporteUsd=$(".div-modal-detalles-reporte-usd");a.overlayElement=null;a.requestData={};a.divDetalles=null;a.lblTitle=null;$.extend(true,a,b);a.show=function(){a.divDetalles=a.divDetalleReporteUsd.find(".div-detalles");a.lblTitle=a.divDetalleReporteUsd.find(".lbl-title");a.lblTitle.text("Detalles "+((a.requestData.Mes<10)?"0":"")+a.requestData.Mes+"/"+a.requestData.Ano);if(!a.divDetalles.swidget()){a.initGrid()}a.loadGrid()};a.initGrid=function(){a.divDetalles.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:[{width:"10%",field:"Fecha",title:"Fecha",headerAttributes:Core.Functions.grid.getCellEvenClass(),attributes:Core.Functions.grid.getLeftAlignedColumnClass()},{field:"OperadoCable",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"11%",title:"Operado Cable",headerAttributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNumberWithColor},{field:"OperadoMep",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"11%",title:"Operado Mep",headerAttributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNumberWithColor},{field:"OperadoNeto",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"11%",title:"Operado Neto",headerAttributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNumberWithColor},{field:"PPCable",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"11%",title:"PP Cable",headerAttributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNumberWithColor},{field:"PPMep",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"11%",title:"PP Mep",headerAttributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNumberWithColor},{field:"PPNeto",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"11%",title:"PP Neto",headerAttributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNumberWithColor},{field:"MontoCable",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"12%",title:"Monto Cable",headerAttributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNumberWithColor},{field:"MontoMep",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"12%",title:"Monto Mep",headerAttributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNumberWithColor}],toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Detalles",columnFields:["Fecha","OperadoCable","OperadoMep","OperadoNeto","PPCable","PPMep","PPNeto","MontoCable","MontoMep"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Detalles"}}}})};a.loadGrid=function(){var c=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,showOverlay:true,secureRequest:true,requestUrl:"reporte/mensualusddetalle",requestType:"GET",requestData:a.requestData});c.onSuccess=function(f){var d=f.posicion==null?[]:f.posicion;var e=a.divDetalles.swidget().initialOptions;e.dataSource.data=d;e.exportOptions.excel.dataSource.data=d;e.exportOptions.excel.readDataSource=true;a.divDetalles.swidget().refresh(e);a.divDetalleReporteUsd.modal({show:true})};c.request()};a.destroy=function(){}};Core.Business.MesaReporteTickersPendientes=new function(){var a=this;a.id="mesaLiquidacion";a.divOperaciones=null;a.txtFilterOperaciones=null;a.timeoutOperaciones=null;a.loaded=false;a.window=$(window);a.managerOperacion=null;a.idDefaultAccount=null;a.idDefaultProfile=null;a.init=function(b,c){Core.loadPage("mesa-reporte-tickers-pendientes.html",function(){document.title="Reporte Tickers Pendientes";a.idDefaultAccount=b;a.idDefaultProfile=c;a.divOperaciones=$(".div-operaciones");a.txtFilterOperaciones=$(".textbox-filter-operaciones");a.initGrid();a.initFilter();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,a.idDefaultAccount,a.idDefaultProfile,function(){a.loadGrid();a.loaded=true},"Core.Business.MesaReporteTickersPendientes")})};a.initGrid=function(){a.divOperaciones.shieldGrid({dataSource:{data:[]},selection:false,noRecordsText:"No hay operaciones para informar",rowHover:false,paging:{pageSize:100,pageLinksCount:10},sorting:{multiple:true},columns:[{width:"5%",field:"idOperacion",title:"ID",headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"5%",field:"FechaOperacion",title:"Concertación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatStringDate},{width:"5%",field:"FechaLiquidacion",title:"Liquidación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatStringDate},{width:"5%",field:"Vehiculo",title:"Cuenta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"6%",field:"TipoOperacion",title:"Operación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"8%",field:"Contraparte",title:"Contraparte",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"8%",field:"Ticker",title:"Especie",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{title:"Cantidad",field:"Cantidad",width:"10%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(b,c,e){var d="";if(c.TipoOperacion=="Venta"){d="red"}b.html("<span class='"+d+"'>"+Core.Functions.grid.formatPrice(c.Cantidad)+"</span>")}},{width:"10%",field:"Precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatPrice},{width:"8%",field:"Moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{title:"Monto",field:"Monto",width:"10%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(b,c,e){var d="";if(c.TipoOperacion=="Compra"){d="red"}b.html("<span class='"+d+"'>"+Core.Functions.grid.formatPrice(c.Monto)+"</span>")}},{title:"Obs.",width:"8%",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(c,d,e){if(d.Observaciones&&d.Observaciones!=""){var g=(d.Observaciones.length>140)?(d.Observaciones.substr(0,140)+"..."):(d.Observaciones);var b=$('<button type="button" title="'+g+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>').appendTo(c);b.addClass("link-cell");b.on("click",function(){var h=new Core.Controls.Dialog("Observaciones",(d.Observaciones)?d.Observaciones:"",{displayButtons:{close:true,accept:false}});h.show()})}if(d.AdvertenciaFechaLiquidacion&&d.AdvertenciaFechaLiquidacion!=""){var f=(d.AdvertenciaFechaLiquidacion.length>140)?(d.AdvertenciaFechaLiquidacion.substr(0,140)+"..."):(d.AdvertenciaFechaLiquidacion);btnAdvertenciaFechaLiquidacion=$('<button type="button" title="'+f+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-exclamation-sign"></span></button>').appendTo(c);btnAdvertenciaFechaLiquidacion.addClass("link-cell");btnAdvertenciaFechaLiquidacion.on("click",function(){var h=new Core.Controls.Dialog("Advertencia",(d.AdvertenciaFechaLiquidacion)?d.AdvertenciaFechaLiquidacion:"",{displayButtons:{close:true,accept:false}});h.show()})}}},{width:"8%",field:"Estado",title:"Estado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"5%",field:"UsuarioCreacion",title:"Alta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"5%",field:"UsuarioOperador",title:"Operador",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"4%",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(c,d,e){var b=$('<button type="button" title="Modificar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(c);b.on("click",function(){if(a.managerOperacion!=null){Core.Objects.Context.Dialogs.remove(a.managerOperacion);a.managerOperacion.destroy()}a.managerOperacion=new Core.Controls.ManagerOperacion({operacion:d,pantallaOrigen:Core.Enums.eManagerOperacionPantallaOrigen.Liquidacion,origen:(d.idOrigenOperacion==Core.Enums.eMesaOperacionOrigen.CompraVentaBono)?Core.Enums.eMesaOperacionOrigen.Operacion:d.idOrigenOperacion,onSave:function(){a.loaded=false;a.loadGrid()},onDestroy:function(){a.managerOperacion=null},overlayElement:b});Core.Objects.Context.Dialogs.push(a.managerOperacion);a.managerOperacion.show()})}}],toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Reporte Tickers Pendientes",columnFields:["idOperacion","FechaOperacion","FechaLiquidacion","Vehiculo","TipoOperacion","Contraparte","Ticker","Cantidad","Precio","Moneda","Monto","Observaciones","UsuarioCreacion","UsuarioOperador"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Reporte Tickers Pendientes"}}}})};a.initFilter=function(){a.txtFilterOperaciones.on("keydown",function(){clearTimeout(a.timeoutOperaciones);a.timeoutOperaciones=setTimeout(function(){value=a.txtFilterOperaciones.val();var b=a.divOperaciones.swidget().dataSource;if(value){b.filter={or:[{path:"idOperacion",filter:"contains",value:value},{path:"Ticker",filter:"contains",value:value},{path:"Vehiculo",filter:"contains",value:value},{path:"Contraparte",filter:"contains",value:value},{path:"Moneda",filter:"contains",value:value},{path:"UsuarioOperador",filter:"contains",value:value},{path:"UsuarioCreacion",filter:"contains",value:value},{path:"TipoOperacion",filter:"contains",value:value},{path:"Cantidad",filter:"contains",value:value},{path:"Precio",filter:"contains",value:value},{path:"Monto",filter:"contains",value:value}]}}else{b.filter=null}b.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilterOperaciones,"Core.Business.MesaReporteTickersPendientes.txtFilterOperaciones")};a.loadGrid=function(){var b=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"operacionestickerspendientes",requestType:"GET"});b.onSuccess=function(c){c.operaciones.forEach(function(h,g){if(h.FechaLiquidacion){h.FechaLiquidacion=h.FechaLiquidacion+" 00:00:00.000"}h.FechaOperacion=h.FechaOperacion+" 00:00:00.000"});var f=a.window.scrollTop();var d=a.divOperaciones.swidget().initialOptions;d.dataSource.data=c.operaciones;d.dataSource.sort=a.divOperaciones.swidget().dataSource.sort;var e=a.divOperaciones.swidget().pager.page();d.exportOptions.excel.dataSource.data=c.operaciones;d.exportOptions.excel.readDataSource=true;a.divOperaciones.swidget().refresh(d);a.txtFilterOperaciones.keydown();if(e>1){a.divOperaciones.swidget().pager.page(e)}a.window.scrollTop(f);a.loaded=true};b.request()}};Core.Business.MesaExportarValidacion=new function(){var a=this;a.id="mesaExportarValidacion";a.divOperaciones=null;a.timerId=null;a.loaded=false;a.btnRefresh=null;a.window=$(window);a.init=function(b,c){Core.loadPage("mesa-reporte-validar.html",function(){a.divOperaciones=$(".div-operaciones");a.btnRefresh=$(".btn-refresh");a.btnRefresh.on("click",function(){a.loadGrid()});a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.MesaExportarValidacion")})};a.initGrid=function(){a.divOperaciones.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Mesa Valicación",columnFields:["idOperacionPlataforma","balanceo","idOperacionPadre","NumRegistro","Estado","ConcertacionExportacion","AltaPlataforma","NumMinuta","CodMinutaAsig","NumBoleto","ComitenteExportacion","ComitenteEsco","CantidadExportacion","CantidadEsco","CantidadPlataforma"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Mesa Valicación"}}},selection:false,rowHover:false,columns:[{width:"8%",field:"idOperacionPlataforma",title:"id Operación (Plataforma)",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatIntegerNumber},{width:"8%",field:"balanceo",title:"Balanceo (Plataforma)",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"8%",field:"idOperacionPadre",title:"id Operación Padre (Plataforma)",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedIntegerNumber},{width:"8%",field:"NumRegistro",title:"Número Registro (Plataforma / ESCO)",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatIntegerNumber},{width:"8%",field:"Estado",title:"Estado (Plataforma)",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"8%",field:"ConcertacionExportacion",title:"Concertación (Plataforma)",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(b,d,c){b.text(d.ConcertacionExportacion);if(d.color){b.html('<span class="red">'+d.ConcertacionExportacion+"</span>")}}},{width:"8%",field:"AltaPlataforma",title:"Alta (Plataforma)",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(b,d,c){b.text(d.AltaPlataforma);if(d.color){b.html('<span class="red">'+d.AltaPlataforma+"</span>")}}},{width:"8%",field:"NumMinuta",title:"Número Minuta (ESCO)",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedIntegerNumber},{width:"8%",field:"CodMinutaAsig",title:"Cod Minuta Asig (ESCO)",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedIntegerNumber},{width:"8%",field:"NumBoleto",title:"Número Boleto (ESCO)",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedIntegerNumber},{width:"8%",field:"ComitenteExportacion",title:"Comitente (Plataforma)",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatIntegerNumber},{width:"8%",field:"ComitenteEsco",title:"Comitente (ESCO)",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedIntegerNumber},{width:"8%",field:"CantidadExportacion",title:"Cantidad Exportación (Plataforma)",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatIntegerNumber},{width:"8%",field:"CantidadEsco",title:"Cantidad (ESCO)",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedIntegerNumber},{width:"8%",field:"CantidadPlataforma",title:"Cantidad (Plataforma)",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(b,d,c){b.html(Core.Functions.grid.formatIntegerNumber(d.CantidadPlataforma));if(d.color){b.parent().css("background-color","rgba("+a.hexToRgb(d.color)+((c%2==0)?", 0.6":", 1 ")+")")}}}]})};a.hexToRgb=function(d){d=d.replace("#","");var f=parseInt(d.substring(0,2),16);var e=parseInt(d.substring(2,4),16);var c=parseInt(d.substring(4,6),16);var h=f+","+e+","+c;return h};a.loadGrid=function(){var b=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divOperaciones.parent(),secureRequest:true,requestUrl:"reporte/validacionexportar",requestType:"GET"});b.onSuccess=function(c){var e=a.window.scrollTop();var d=a.divOperaciones.swidget().initialOptions;d.dataSource.data=c;d.dataSource.schema={data:"operaciones"};d.exportOptions.excel.dataSource.data=c;d.exportOptions.excel.dataSource.schema={data:"operaciones"};d.exportOptions.excel.readDataSource=true;a.divOperaciones.swidget().refresh(d);a.loaded=true;a.window.scrollTop(e)};b.request()}};Core.Business.Minutas=new function(){var a=this;a.decimalCount=8;a.pageOptions=null;a.id="insertarMinuta";a.lblComitente=null;a.txtDate=null;a.divControlsMinuta=null;a.lblDisponible=null;a.divMercado=null;a.ddlMercado=null;a.divCruce=null;a.chkCruce=null;a.divTitularesCuenta=null;a.ddlTitularesCuenta=null;a.btnClonarMinuta=null;a.divAccounts=null;a.lblSelectedAccount=null;a.btnBuscarCuenta=null;a.divAsesores=null;a.ddlAsesores=null;a.divTipoOperacion=null;a.ddlTipoOperacion=null;a.divEspecie=null;a.ddlEspecie=null;a.divPlazo=null;a.ddlPlazo=null;a.divMoneda=null;a.ddlMoneda=null;a.divMontoPrestamo=null;a.txtMontoPrestamo=null;a.divDiasPrestamo=null;a.txtDiasPrestamo=null;a.divTasaPrestamo=null;a.txtTasaPrestamo=null;a.divCantidadNominales=null;a.txtCantidadNominales=null;a.divPrecio=null;a.divPrecioReferencia=null;a.divPrecioReferenciaProductor=null;a.txtPrecio=null;a.divPredefinirPrecioReferencia=null;a.chkPredefinirPrecioReferencia=null;a.txtPrecioReferencia=null;a.txtPrecioReferenciaProductor=null;a.divTotalOperacion=null;a.lblTotalOperacion=null;a.divUltimoPrecio=null;a.lblUltimoPrecio=null;a.divVariacion=null;a.lblVariacion=null;a.divMejorOfertaCompra=null;a.lblMejorOfertaCompra=null;a.divMejorOfertaVenta=null;a.lblMejorOfertaVenta=null;a.divObservaciones=null;a.txtObservaciones=null;a.divUrgente=null;a.chkUrgente=null;a.btnSend=null;a.datosCuentaSeleccionada=null;a.titularesCuenta=[];a.init=function(b,c){Core.loadPage("minutas.html",function(){document.title="Minutas";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.initControls();a.selectedAccount=$.grep(Core.Objects.Accounts?Core.Objects.Accounts:[],function(e,d){return e.idCuenta==b})[0];a.divControlsMinuta=$(".div-minuta-controls");a.divControlsMinuta.hide();if(a.selectedAccount){a.divControlsMinuta.show()}a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadTabs,"Core.Business.Minutas")})};a.initControls=function(){a.lblComitente=$(".label-comitente");a.txtDate=$(".date-picker-date");a.txtDate.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),});a.lblDisponible=$(".label-disponible");a.divMercado=$(".div-mercado");a.ddlMercado=$(".dropdown-mercado");a.ddlMercado.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{idMercado}",value:(Core.Objects.Context.Parameters.ConfigMinutasMercadoDefault)?Core.Objects.Context.Parameters.ConfigMinutasMercadoDefault.toString():Core.Enums.eMinutaMercado.Merval.toString(),events:{select:function(b){a.setControlsByMercado();a.setPrecios();a.setEspecieByTipoOperacion(a.ddlTipoOperacion.swidget().value())}}});a.divCruce=$(".div-cruce");a.chkCruce=$(".checkbox-cruce");a.divTitularesCuenta=$(".div-titulares-cuenta");a.ddlTitularesCuenta=$(".dropdown-titulares-cuenta");a.ddlTitularesCuenta.shieldDropDown({dataSource:{data:[]},textTemplate:"{Persona}",valueTemplate:"{idPersona}"});a.btnClonarMinuta=$(".button-clonar-minuta");a.btnClonarMinuta.click(function(){a.clonarMinuta()});a.divAccounts=$(".div-minutas-accounts");a.lblSelectedAccount=$(".label-minutas-selected-account");a.btnBuscarCuenta=$(".button-buscar-cuentas");a.btnBuscarCuenta.on("click",function(){new Core.Business.Minutas.BuscarCuentas({onSelected:function(b){a.selectedAccount=b;a.divControlsMinuta.hide();if(a.selectedAccount){a.divControlsMinuta.show()}a.loadTabs()}}).show()});a.divAsesores=$(".div-minutas-asesores");a.ddlAsesores=$(".dropdown-minutas-asesores");a.ddlAsesores.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idPersonaAsesor}",textTemplate:"{Nombre}",enabled:true,autoComplete:{enabled:true,filter:{and:[{path:"Nombre",filter:"contains",value:""}]}},events:{focus:function(b){var c=a.ddlAsesores.swidget().initialOptions;c.value="";a.ddlAsesores.swidget().refresh(c);a.ddlAsesores.swidget().focus()}}});a.divTipoOperacion=$(".div-tipo-operacion");a.ddlTipoOperacion=$(".dropdown-tipo-operacion");a.ddlTipoOperacion.shieldDropDown({dataSource:{data:[{value:Core.Enums.eMinutaTipoOperacion.Compra,text:"Compra"},{value:Core.Enums.eMinutaTipoOperacion.Venta,text:"Venta"}]},textTemplate:"{text}",valueTemplate:"{value}",events:{select:function(b){a.setEspecieByTipoOperacion(b.item.value)}}});a.divMoneda=$(".div-moneda");a.ddlMoneda=$(".dropdown-moneda");a.ddlMoneda.shieldDropDown({dataSource:{data:[Core.Enums.Currency.Pesos,Core.Enums.Currency.Dolares,Core.Enums.Currency.DolaresCable]},textTemplate:"{Descripcion}",valueTemplate:"{idMoneda}",events:{select:function(b){a.setLabelsByEspecie();a.setPrecioReferencia()}}});a.divMontoPrestamo=$(".div-monto-prestamo");a.txtMontoPrestamo=$(".textbox-monto-prestamo");new Core.Controls.DecimalPicker(a.txtMontoPrestamo,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:""});a.divDiasPrestamo=$(".div-dias-prestamo");a.txtDiasPrestamo=$(".textbox-dias-prestamo");new Core.Controls.DecimalPicker(a.txtDiasPrestamo,{maxDecimalDigitCount:0,showThousandsSeparator:""});a.divTasaPrestamo=$(".div-tasa-prestamo");a.txtTasaPrestamo=$(".textbox-tasa-prestamo");new Core.Controls.DecimalPicker(a.txtTasaPrestamo,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:""});a.divEspecie=$(".div-especie");a.ddlEspecie=$(".dropdown-especie");a.ddlEspecie.shieldComboBox({dataSource:{data:[]},valueTemplate:"{Ticker}",textTemplate:"{DisplayTicker} | {Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}},events:{change:function(b){a.setLabelsByEspecie();a.setPrecioReferencia()},focus:function(b){var c=a.ddlEspecie.swidget().initialOptions;c.value="";a.ddlEspecie.swidget().refresh(c);a.ddlEspecie.swidget().focus()}}});a.divPlazo=$(".div-plazo");a.ddlPlazo=$(".dropdown-plazo");a.ddlPlazo.shieldDropDown({dataSource:{data:[{value:Core.Enums.ePlazo.CI,text:"CI"},{value:Core.Enums.ePlazo.D24,text:"24 hs."},{value:Core.Enums.ePlazo.D48,text:"48 hs."}]},textTemplate:"{text}",valueTemplate:"{value}",value:((a.pageOptions&&a.pageOptions.plazoDefault)?a.pageOptions.plazoDefault.toString():""),events:{select:function(b){a.setDisponible(b.item.value);a.setEspecieByTipoOperacion(a.ddlTipoOperacion.swidget().value())}}});a.divCantidadNominales=$(".div-cantidad-nominales");a.txtCantidadNominales=$(".textbox-cantidad-nominales");new Core.Controls.DecimalPicker(a.txtCantidadNominales,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onChange:a.setTotalOperacion});a.divPrecio=$(".div-precio");a.txtPrecio=$(".textbox-precio");new Core.Controls.DecimalPicker(a.txtPrecio,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onChange:a.setTotalOperacion});a.divPredefinirPrecioReferencia=$(".div-predefinir-precio-referencia");a.chkPredefinirPrecioReferencia=$(".checkbox-predefinir-precio-referencia");a.chkPredefinirPrecioReferencia.on("change",function(){a.txtPrecioReferencia.removeAttr("disabled");if(a.chkPredefinirPrecioReferencia[0].checked){a.txtPrecioReferencia.attr("disabled","disabled");a.setPrecioReferencia()}});a.divPrecioReferencia=$(".div-precio-referencia");a.txtPrecioReferencia=$(".textbox-precio-referencia");new Core.Controls.DecimalPicker(a.txtPrecioReferencia,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onChange:a.setTotalOperacion});a.divPrecioReferenciaProductor=$(".div-precio-referencia-productor");a.txtPrecioReferenciaProductor=$(".textbox-precio-referencia-productor");new Core.Controls.DecimalPicker(a.txtPrecioReferenciaProductor,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onChange:a.setTotalOperacion});a.divTotalOperacion=$(".div-total-operacion");a.lblTotalOperacion=$(".label-total-operacion");a.divUltimoPrecio=$(".div-ultimo-precio");a.lblUltimoPrecio=$(".label-ultimo-precio");a.divVariacion=$(".div-variacion");a.lblVariacion=$(".label-variacion");a.divMejorOfertaCompra=$(".div-mejor-oferta-compra");a.lblMejorOfertaCompra=$(".label-mejor-oferta-compra");a.divMejorOfertaVenta=$(".div-mejor-oferta-venta");a.lblMejorOfertaVenta=$(".label-mejor-oferta-venta");a.divObservaciones=$(".div-observaciones");a.txtObservaciones=$(".text-observaciones");a.txtObservaciones.shieldTextBox({});a.divUrgente=$(".div-urgente");a.chkUrgente=$(".checkbox-urgente");a.btnSend=$(".btn-send");a.btnSend.click(function(){a.validData(a.send)})};a.loadTabs=function(){if(a.selectedAccount){var b=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"datoscuenta/"+encodeURIComponent(a.selectedAccount.idCuenta),requestType:"GET"});b.onSuccess=function(c){a.datosCuentaSeleccionada=c;a.lblComitente.text("Comitente Nº "+a.datosCuentaSeleccionada.DatosCuenta.NumComitente+" | "+a.datosCuentaSeleccionada.DatosCuenta.DescripcionBolsa);a.setDisponible((a.ddlPlazo.swidget().selectedItem())?a.ddlPlazo.swidget().value():Core.Enums.ePlazo.D48);a.setAccounts();a.setMercados();a.setAsesores()};b.request()}};a.setPrecios=function(){a.divPrecio.removeClass("col-lg-2 col-md-2 col-lg-3 col-md-3");a.divPrecioReferencia.removeClass("col-lg-2 col-md-2 col-lg-3 col-md-3");a.divPrecioReferenciaProductor.removeClass("col-lg-2 col-md-2 col-lg-3 col-md-3");if(a.datosCuentaSeleccionada.DatosCuenta.idProductor!="1"&&a.ddlMercado.swidget().selectedItem().idMercado!=Core.Enums.eMinutaMercado.Privado&&a.ddlMercado.swidget().selectedItem().idMercado!=Core.Enums.eMinutaMercado.PrestamoEfectivo){a.divPrecio.addClass("col-lg-2 col-md-2");a.divPrecioReferencia.addClass("col-lg-2 col-md-2");a.divPrecioReferenciaProductor.addClass("col-lg-2 col-md-2");a.divPrecioReferenciaProductor.show()}else{a.divPrecio.addClass("col-lg-3 col-md-3");a.divPrecioReferencia.addClass("col-lg-3 col-md-3");a.divPrecioReferenciaProductor.hide()}};a.setDisponible=function(c){if(a.selectedAccount){var b=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"liquidez/"+encodeURIComponent(a.selectedAccount.idCuenta),requestType:"GET",requestData:{Fecha:Core.Functions.Date.getDateAsString(new Date())}});b.onSuccess=function(e){var d=e.liquidez;if(c==Core.Enums.ePlazo.CI){a.lblDisponible.text("Disponible: $"+d[0].DInm+" | USD "+d[1].DInm+((d[2])?(" | USD Cable "+d[2].DInm):""))}if(c==Core.Enums.ePlazo.D24){a.lblDisponible.text("Disponible: $"+d[0].D24+" | USD "+d[1].D24+((d[2])?(" | USD Cable "+d[2].D24):""))}if(c==Core.Enums.ePlazo.D48){a.lblDisponible.text("Disponible: $"+d[0].D48+" | USD "+d[1].D48+((d[2])?(" | USD Cable "+d[2].D48):""))}if(c==Core.Enums.ePlazo.D72){a.lblDisponible.text("Disponible: $"+d[0].D72+" | USD "+d[1].D72+((d[2])?(" | USD Cable "+d[2].D72):""))}};b.request()}};a.setMercados=function(c){var b=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"mercados",requestType:"GET",requestData:{idAplicacion:0,idFuncionalidad:1}});b.onSuccess=function(e){var d=a.ddlMercado.swidget().initialOptions;d.dataSource.data=e.mercados;d.value=((a.ddlMercado.swidget().value())?a.ddlMercado.swidget().value().toString():(Core.Objects.Context.Parameters.ConfigMinutasMercadoDefault)?Core.Objects.Context.Parameters.ConfigMinutasMercadoDefault.toString():Core.Enums.eMinutaMercado.Merval.toString());a.ddlMercado.swidget().refresh(d);a.setControlsByMercado();a.setPrecios();a.setEspecieByTipoOperacion((a.ddlTipoOperacion.swidget().selectedItem())?a.ddlTipoOperacion.swidget().value():Core.Enums.eMinutaTipoOperacion.Compra)};b.request()};a.setAsesores=function(c){var b=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"asesores/unidaddenegocios",requestType:"GET"});b.onSuccess=function(e){var d=a.ddlAsesores.swidget().initialOptions;d.dataSource.data=e.asesores;a.ddlAsesores.swidget().refresh(d)};b.request()};a.setControlsByMercado=function(){var b=[Core.Enums.Currency.Pesos,Core.Enums.Currency.Dolares,Core.Enums.Currency.DolaresCable];if(a.ddlMercado.swidget().value()==Core.Enums.eMinutaMercado.Cambio){var b=[Core.Enums.Currency.Pesos]}var c=a.ddlMoneda.swidget().initialOptions;if(a.ddlMercado.swidget().value()==Core.Enums.eMinutaMercado.Privado){c.value=Core.Enums.Currency.DolaresCable.idMoneda.toString()}else{c.value=""}c.dataSource.data=b;a.ddlMoneda.swidget().refresh(c);if(a.ddlMercado.swidget().value()==Core.Enums.eMinutaMercado.Merval||a.ddlMercado.swidget().value()==Core.Enums.eMinutaMercado.Mae){a.divCruce.show()}else{a.divCruce.hide();a.chkCruce[0].checked=false}a.divTitularesCuenta.hide();a.divPredefinirPrecioReferencia.hide();a.divPrecioReferencia.removeClass("col-lg-2 col-md-2");a.divPrecioReferencia.addClass("col-lg-3 col-md-3");a.txtPrecioReferencia.removeAttr("disabled");if(a.ddlMercado.swidget().value()==Core.Enums.eMinutaMercado.Cambio){a.loadTitularesCuenta();a.divPrecioReferencia.removeClass("col-lg-3 col-md-3");a.divPrecioReferencia.addClass("col-lg-2 col-md-2");a.divPredefinirPrecioReferencia.show();a.chkPredefinirPrecioReferencia[0].checked=true;a.txtPrecioReferencia.attr("disabled","disabled")}a.divAccounts.show();a.divTipoOperacion.show();a.divPlazo.show();a.divEspecie.show();a.divCantidadNominales.show();a.divPrecio.show();a.divPrecioReferencia.show();a.divPrecioReferenciaProductor.show();a.divTotalOperacion.show();a.divUltimoPrecio.show();a.divMejorOfertaCompra.show();a.divMejorOfertaVenta.show();a.divVariacion.show();a.divMontoPrestamo.hide();a.divDiasPrestamo.hide();a.divTasaPrestamo.hide();a.divAsesores.hide();if(a.ddlMercado.swidget().value()==Core.Enums.eMinutaMercado.PrestamoEfectivo){a.divAccounts.hide();a.divTipoOperacion.hide();a.divPlazo.hide();a.divEspecie.hide();a.divCantidadNominales.hide();a.divPrecio.hide();a.divPrecioReferencia.hide();a.divPrecioReferenciaProductor.hide();a.divTotalOperacion.hide();a.divUltimoPrecio.hide();a.divMejorOfertaCompra.hide();a.divMejorOfertaVenta.hide();a.divVariacion.hide();a.divAsesores.show();a.divMontoPrestamo.show();a.divDiasPrestamo.show();a.divTasaPrestamo.show()}};a.setPrecioReferencia=function(){if(a.ddlMercado.swidget().value()==Core.Enums.eMinutaMercado.Cambio&&a.chkPredefinirPrecioReferencia[0].checked){if(a.ddlTipoOperacion.swidget().selectedItem()&&a.ddlEspecie.swidget().selectedItem()&&a.ddlPlazo.swidget().selectedItem()&&a.ddlMoneda.swidget().selectedItem()){var b=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"cambio/precioreferencia/"+a.ddlTipoOperacion.swidget().selectedItem().value+"/"+a.ddlEspecie.swidget().selectedItem().idMonedaInstrumento+"/"+a.ddlPlazo.swidget().selectedItem().value+"/"+a.ddlMoneda.swidget().selectedItem().idMoneda,requestType:"GET"});b.onSuccess=function(c){if(c.data!=null){a.txtPrecioReferencia.val(c.data[0].precioReferencia)}else{a.txtPrecioReferencia.val("")}};b.request()}else{a.txtPrecioReferencia.val("")}}};a.loadTitularesCuenta=function(){if(a.selectedAccount){var b=new Core.Ajax.ServerRequest({showOverlay:false,secureRequest:true,requestUrl:"personas/titulares/"+a.selectedAccount.idCuenta,requestType:"GET"});b.onSuccess=function(d){a.titularesCuenta=d.titulares;if(d.titulares.length>1){var c=a.ddlTitularesCuenta.swidget().initialOptions;c.dataSource.data=d.titulares;a.ddlTitularesCuenta.swidget().refresh(c);a.divTitularesCuenta.show()}else{a.divTitularesCuenta.hide()}};b.request()}};a.setEspecieByTipoOperacion=function(e,d){var b={};if(e==Core.Enums.eMinutaTipoOperacion.Venta){b.idCuenta=encodeURIComponent(a.selectedAccount.idCuenta);b.plazo=a.ddlPlazo.swidget().value()}b.panel=((a.ddlMercado.swidget().value()&&a.ddlMercado.swidget().value()==Core.Enums.eMinutaMercado.Cambio)?Core.Enums.ePanel.Cambio:Core.Enums.ePanel.Bonos);var c=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,allowCache:e==Core.Enums.eMinutaTipoOperacion.Compra,secureRequest:true,requestUrl:"especies",requestType:"GET",requestData:b});c.onSuccess=function(g){var f=g.especies==null?[]:g.especies;f=$.grep(f,function(i,h){return i.idMoneda==Core.Enums.Currency.Pesos.idMoneda});if(d&&($.grep(f,function(i,h){return i.Ticker==d}).length==0)){f.push({Ticker:d,DisplayTicker:d,Descripcion:"",Cantidad:""})}a.loadEspecies(e,f);if(d){a.ddlEspecie.swidget().value(d)}a.setPrecioReferencia();a.setLabelsByEspecie()};c.request()};a.loadEspecies=function(d,b){var c=a.ddlEspecie.swidget().initialOptions;c.dataSource.data=b;if(d==Core.Enums.eMinutaTipoOperacion.Venta&&a.ddlMercado.swidget().value()&&a.ddlMercado.swidget().value()!=Core.Enums.eMinutaMercado.Cambio){c.textTemplate="{DisplayTicker} ({Cantidad}) | {Descripcion}"}else{c.textTemplate="{DisplayTicker} | {Descripcion}"}a.ddlEspecie.swidget().refresh(c)};a.setTotalOperacion=function(){if(a.txtCantidadNominales.val()!=""&&a.txtPrecio.val()!=""){a.lblTotalOperacion.text(Core.Functions.grid.formatNumber((parseFloat(a.txtCantidadNominales.val())*parseFloat(a.txtPrecio.val())).toFixed(6)))}};a.setLabelsByEspecie=function(){var c=function(f,h){var e="field-var";if(h!=null&&h.length>1){var g=h.substr(0,1);if(g=="+"){e="field-varpositiva"}if(g=="-"){e="field-varnegativa"}}f.removeClass("field-var field-varpositiva field-varnegativa").addClass(e)};var b={};b.plazo=a.ddlPlazo.swidget().value();b.idMoneda=a.ddlMoneda.swidget().value();if(a.ddlEspecie.swidget().value()){if(a.ddlMercado.swidget().value()==Core.Enums.eMinutaMercado.Cambio){var d=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"cotizacionmoneda/"+a.ddlEspecie.swidget().selectedItem().idMonedaInstrumento,requestType:"GET"});d.onSuccess=function(e){a.lblUltimoPrecio.text("No disponible");a.lblVariacion.text("No disponible");c(a.lblVariacion,null);a.lblMejorOfertaCompra.text(e.Cotizacion.PrecioCompra!=null?e.Cotizacion.PrecioCompra:"No disponible");a.lblMejorOfertaVenta.text(e.Cotizacion.PrecioVenta!=null?e.Cotizacion.PrecioVenta:"No disponible")};d.request()}else{b.ticker=a.ddlEspecie.swidget().value();var d=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"cotizacioninstrumento",requestType:"GET",requestData:b});d.onSuccess=function(e){a.lblUltimoPrecio.text(e.Cotizacion.UltimoPrecio!=null?Core.Functions.grid.formatPrice(e.Cotizacion.UltimoPrecio):"No disponible");a.lblVariacion.text(e.Cotizacion.Variacion!=null?e.Cotizacion.Variacion:"No disponible");c(a.lblVariacion,e.Cotizacion.Variacion);a.lblMejorOfertaCompra.text(e.Cotizacion.MejorOfertaCompra!=null?e.Cotizacion.MejorOfertaCompra:"No disponible");a.lblMejorOfertaVenta.text(e.Cotizacion.MejorOfertaVenta!=null?e.Cotizacion.MejorOfertaVenta:"No disponible")};d.request()}}else{a.lblUltimoPrecio.text("");a.lblVariacion.text("");a.lblMejorOfertaCompra.text("");a.lblMejorOfertaVenta.text("")}};a.setAccounts=function(){Core.Objects.Accounts=Core.Objects.Accounts?Core.Objects.Accounts:[];if(a.selectedAccount){a.lblSelectedAccount.text(a.selectedAccount.idCuenta+" | "+a.selectedAccount.Descripcion+" (Comitente: "+a.selectedAccount.NumComitente+")")}if(a.ddlMercado.swidget().value()==Core.Enums.eMinutaMercado.Cambio){a.loadTitularesCuenta()}};a.validData=function(d){var e={value:true};var b={FechaConcertacion:Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtDate,e)),idMercado:Core.Functions.Validations.getValidatedDropDownValue(a.ddlMercado,e),idMoneda:Core.Functions.Validations.getValidatedSwidgetValue(a.ddlMoneda),Observaciones:a.txtObservaciones.val(),Urgente:a.chkUrgente[0].checked?1:0,esCruce:a.chkCruce[0].checked?1:0};if(a.ddlMercado.swidget().value()==Core.Enums.eMinutaMercado.PrestamoEfectivo){b.Monto=Core.Functions.Validations.getValidatedNumericInputValue(a.txtMontoPrestamo,e);b.CantidadDiasPrestamo=Core.Functions.Validations.getValidatedNumericInputValue(a.txtDiasPrestamo,e);b.TasaPrestamo=Core.Functions.Validations.getValidatedNumericInputValue(a.txtTasaPrestamo,e);if(a.ddlAsesores.swidget().selectedItem()){b.idPersonaAsesor=a.ddlAsesores.swidget().selectedItem().idPersonaAsesor}}else{b.idCuenta=a.selectedAccount.idCuenta;b.idTipoOperacion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,e);b.ticker=Core.Functions.Validations.getValidatedSwidgetValue(a.ddlEspecie,e);b.Plazo=Core.Functions.Validations.getValidatedDropDownValue(a.ddlPlazo,e);b.Cantidad=Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidadNominales,e);b.Precio=Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecio,e);if(a.ddlMercado.swidget().value()==Core.Enums.eMinutaMercado.Cambio&&a.chkPredefinirPrecioReferencia[0].checked){b.PrecioReferencia=Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecioReferencia,e)}else{b.PrecioReferencia=a.txtPrecioReferencia.val()?Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecioReferencia,e):0}b.Monto=parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecio,e))*parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidadNominales,e));b.CodMercadoExterno=""}if(a.datosCuentaSeleccionada.DatosCuenta.idProductor!="1"&&a.ddlMercado.swidget().selectedItem().idMercado!=Core.Enums.eMinutaMercado.Privado&&a.ddlMercado.swidget().selectedItem().idMercado!=Core.Enums.eMinutaMercado.PrestamoEfectivo){b.PrecioProductor=a.txtPrecioReferenciaProductor.val()?Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecioReferenciaProductor,e):null}if(a.ddlMercado.swidget().selectedItem().idMercado==Core.Enums.eMinutaMercado.Cambio&&a.titularesCuenta.length>1){b.idPersonaTitular=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTitularesCuenta,e)}if(!e.value){return}var c="";if(b.Precio>80){c+="<p>El Precio es muy elevado. Recuerde que los precios se cargan UNITARIOS.</p>"}if(Math.abs(b.Precio-b.PrecioReferencia)>Math.abs(b.Precio/2)){c+="<p>Se ingresó un Precio y un Precio de Referencia muy distintos.</p>"}if(b.PrecioReferencia<=0){c+="<p>Se ingresó un Precio de Referencia en Cero.</p>"}if(b.PrecioProductor&&b.PrecioProductor<=0){c+="<p>Se ingresó un Precio de Referencia Productor en Cero.</p>"}if(b.idTipoOperacion==Core.Enums.eMinutaTipoOperacion.Compra){if(parseFloat(b.Precio)<parseFloat(b.PrecioReferencia)){c+="<p>Operación de COMPRA con un Precio menor al Precio de Referencia. Esto generará comisiones negativas.</p>"}else{if(b.PrecioProductor&&(parseFloat(b.PrecioProductor)>parseFloat(b.Precio)||parseFloat(b.PrecioProductor)<parseFloat(b.PrecioReferencia))){c+="<p>El Precio de Referencia Productor debe estar comprendido entre el Precio de Referencia y el Precio</p>"}}}if(b.idTipoOperacion==Core.Enums.eMinutaTipoOperacion.Venta){if(parseFloat(b.Precio)>parseFloat(b.PrecioReferencia)){c+="<p>Operación de VENTA con un Precio mayor al Precio de Referencia. Esto generará comisiones negativas.</p>"}else{if(b.PrecioProductor&&(parseFloat(b.PrecioProductor)<parseFloat(b.Precio)||parseFloat(b.PrecioProductor)>parseFloat(b.PrecioReferencia))){c+="<p>El Precio de Referencia Productor debe estar comprendido entre el Precio y el Precio de Referencia</p>"}}}if(b.Precio>0&&(Math.abs(b.Precio-b.PrecioReferencia)/b.Precio)>0.017){c+="<p>Operación con una comisión mayor al 1.7%.</p>"}if(c!=""){c+="<p>¿Esta seguro que desea continuar?</p>";new Core.Controls.Confirmation("Alerta",c,{onAccepted:d}).show()}else{d()}};a.send=function(){var e={value:true};var b={data:{FechaConcertacion:Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtDate,e)),idMercado:Core.Functions.Validations.getValidatedDropDownValue(a.ddlMercado,e),idMoneda:Core.Functions.Validations.getValidatedSwidgetValue(a.ddlMoneda),Observaciones:a.txtObservaciones.val(),Urgente:a.chkUrgente[0].checked?1:0,esCruce:a.chkCruce[0].checked?1:0}};if(a.ddlMercado.swidget().value()==Core.Enums.eMinutaMercado.Cambio){b.data.esPrecioCambioRefMesa=a.chkPredefinirPrecioReferencia[0].checked?1:0}if(a.ddlMercado.swidget().value()==Core.Enums.eMinutaMercado.PrestamoEfectivo){b.data.Monto=Core.Functions.Validations.getValidatedNumericInputValue(a.txtMontoPrestamo,e);b.data.CantidadDiasPrestamo=Core.Functions.Validations.getValidatedNumericInputValue(a.txtDiasPrestamo,e);b.data.TasaPrestamo=Core.Functions.Validations.getValidatedNumericInputValue(a.txtTasaPrestamo,e);if(a.ddlAsesores.swidget().selectedItem()){b.data.idPersonaAsesor=a.ddlAsesores.swidget().selectedItem().idPersonaAsesor}}else{b.data.idCuenta=a.selectedAccount.idCuenta;b.data.idTipoOperacion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,e);b.data.ticker=Core.Functions.Validations.getValidatedSwidgetValue(a.ddlEspecie,e);b.data.Plazo=Core.Functions.Validations.getValidatedDropDownValue(a.ddlPlazo,e);b.data.Cantidad=Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidadNominales,e);b.data.Precio=Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecio,e);if(a.ddlMercado.swidget().value()==Core.Enums.eMinutaMercado.Cambio&&a.chkPredefinirPrecioReferencia[0].checked){b.data.PrecioReferencia=Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecioReferencia,e)}else{b.data.PrecioReferencia=a.txtPrecioReferencia.val()?Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecioReferencia,e):0}b.data.Monto=parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecio,e))*parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidadNominales,e));b.data.CodMercadoExterno=""}if(a.datosCuentaSeleccionada.DatosCuenta.idProductor!="1"&&a.ddlMercado.swidget().selectedItem().idMercado!=Core.Enums.eMinutaMercado.Privado&&a.ddlMercado.swidget().selectedItem().idMercado!=Core.Enums.eMinutaMercado.PrestamoEfectivo){b.data.PrecioProductor=a.txtPrecioReferenciaProductor.val()?Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecioReferenciaProductor,e):null}if(a.ddlMercado.swidget().selectedItem().idMercado==Core.Enums.eMinutaMercado.Cambio&&a.titularesCuenta.length>1){b.data.idPersonaTitular=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTitularesCuenta,e)}var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"minutas/insertar",requestType:"POST",requestData:b});c.onSuccess=function(g){var f=new Core.Controls.Dialog("Mensaje","Minuta ingresada correctamente. Número: "+g.idMinuta,{displayButtons:{close:true,accept:false}});f.show();a.clearFields()};c.onError=function(g){if(g.responseJSON.CodigoError==-2002&&a.chkPredefinirPrecioReferencia[0].checked){a.setPrecioReferencia()}var i=(g.responseJSON&&g.responseJSON.Descripcion)?"Mensaje":"Error de conexión";var f=(g.responseJSON&&g.responseJSON.Descripcion)?g.responseJSON.Descripcion:"Algunos componentes de la página no se cargaron correctamente. Por favor intente mas tarde...";var h=new Core.Controls.Dialog(i,"<p>"+f+"</p>",{displayButtons:{close:true,accept:false}});h.show()};c.request();var b={};b.Nombre="ConfigMinutasMercadoDefault";b.Valor=a.ddlMercado.swidget().value();var d=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"parametrospersona",requestType:"POST",requestData:b});d.onSuccess=function(f){Core.Objects.Context.Parameters.ConfigMinutasMercadoDefault=a.ddlMercado.swidget().value();if(!Core.Functions.Validations.isBlockedStorage()&&Core.Functions.Persistence.getStorage()){Core.Functions.Persistence.getStorage().setItem("CoreContext",LZString.compressToUTF16(JSON.stringify(Core.Objects.Context)))}};d.request()};a.clonarMinuta=function(){new Core.Business.Minutas.Clonar({onSelected:function(b){a.ddlTipoOperacion.swidget().value(b.idTipoOperacion.toString());a.ddlPlazo.swidget().value(b.Plazo.toString());a.setDisponible(a.ddlPlazo.swidget().value());a.ddlMoneda.swidget().value(b.idMoneda.toString());a.setEspecieByTipoOperacion(a.ddlTipoOperacion.swidget().value(),b.Ticker);a.txtCantidadNominales.val(b.Cantidad);a.txtPrecio.val(b.Precio);a.txtPrecioReferencia.val(b.PrecioReferencia);a.txtPrecioReferenciaProductor.val(((b.Precio2)?b.Precio2:""));a.txtMontoPrestamo.val(((b.Monto)?b.Monto:""));a.txtDiasPrestamo.val(((b.CantidadDiasPrestamo)?b.CantidadDiasPrestamo:""));a.txtTasaPrestamo.val(((b.TasaPrestamo)?b.TasaPrestamo:""));a.setTotalOperacion()}}).show()};a.clearFields=function(){a.ddlEspecie.swidget().refresh();a.lblUltimoPrecio.text("");a.lblVariacion.text("");a.lblMejorOfertaCompra.text("");a.lblMejorOfertaVenta.text("");a.txtCantidadNominales.val("");a.txtMontoPrestamo.val("");a.txtDiasPrestamo.val("");a.txtTasaPrestamo.val("");a.txtPrecio.val("");a.txtPrecioReferencia.val("");a.txtPrecioReferenciaProductor.val("");a.txtObservaciones.val("");a.chkUrgente[0].checked=false;a.chkCruce[0].checked=false;a.lblTotalOperacion.text("")}};Core.Business.Minutas.Clonar=function(b){var a=this;a.divModal=$(".modal-clonar-minuta");a.divGridMinutas=null;a.onSelected=function(){};$.extend(true,a,b);a.show=function(){a.divGridMinutas=$(".div-minutas");if(!a.divGridMinutas.swidget()){a.initGrid()}a.loadGrid()};a.initGrid=function(){a.divGridMinutas.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:[{field:"Descripcion",width:"50%",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{field:"Ticker",width:"15%",title:"Ticker",headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"Cantidad",width:"25%",title:"Cantidad",headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNumber},{field:"",title:" ",width:"10%",headerAttributes:Core.Functions.grid.getCellEvenClass(),buttons:[{caption:"Clonar",cls:"",commandName:"Clonar",click:function(d){var c=a.divGridMinutas.swidget().dataItem(d);a.onSelected(c);a.divModal.modal("hide")}}]}]})};a.loadGrid=function(){var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"minutas/recientes",requestType:"GET"});c.onSuccess=function(f){var d=f.minutas==null?[]:f.minutas;var e=a.divGridMinutas.swidget().initialOptions;e.dataSource.data=d;a.divGridMinutas.swidget().refresh(e);a.divModal.modal({show:true})};c.request()};a.destroy=function(){}};Core.Business.Minutas.BuscarCuentas=function(c){var b=this;var a=13;b.divModal=$(".modal-buscar-cuentas");b.divGridCuentas=null;b.btnBuscar=null;b.onSelected=function(){};$.extend(true,b,c);b.show=function(){b.btnBuscar=b.divModal.find(".button-buscar");b.divGridCuentas=b.divModal.find(".div-cuentas-options");b.txtFilter=b.divModal.find(".textbox-filter-cuentas");b.txtFilter.val("");b.initControls();b.divModal.unbind("hidden.bs.modal");b.divModal.on("hidden.bs.modal",function(){b.destroy()});b.divModal.modal({show:true})};b.initControls=function(){b.divGridCuentas.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:[{field:"idCuenta",width:"15%",title:"Id Cuenta",headerAttributes:Core.Functions.grid.getCellOddClass()},{field:"NumComitente",width:"15%",title:"Comitente",headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"NumCuotapartista",width:"15%",title:"Cuotapartista",headerAttributes:Core.Functions.grid.getCellOddClass()},{field:"Descripcion",width:"45%",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"",title:" ",width:"10%",headerAttributes:Core.Functions.grid.getCellOddClass(),buttons:[{caption:"Seleccionar",cls:"",commandName:"Seleccionar",click:function(e){var d=b.divGridCuentas.swidget().dataItem(e);b.divModal.modal("hide");b.onSelected(d)}}]}],paging:{pageSize:30,pageLinksCount:10}});b.txtFilter.unbind("keyup");b.txtFilter.on("keyup",function(d){if(d.keyCode==a){b.loadGrid()}});b.btnBuscar.unbind("click");b.btnBuscar.on("click",function(){b.loadGrid()})};b.loadGrid=function(){var d=b.divGridCuentas.swidget().initialOptions;d.dataSource.data=[];b.divGridCuentas.swidget().refresh(d);if(b.txtFilter.val()&&b.txtFilter.val().length>=3){var e=new Core.Ajax.ServerRequest({overlayElement:b.divModal.find(".modal-body"),secureRequest:true,requestUrl:"cuentas/"+encodeURIComponent(Core.Objects.Context.IdPersona)+"?search="+b.txtFilter.val(),requestType:"GET"});e.onSuccess=function(g){Core.Objects.Accounts=g.cuentas;var f=b.divGridCuentas.swidget().initialOptions;f.dataSource.data=Core.Objects.Accounts;b.divGridCuentas.swidget().refresh(f)};e.request()}};b.destroy=function(){b.divGridCuentas.swidget().destroy()}};Core.Business.MinutasContadosObtener=new function(){var a=this;a.id="minutasContadosObtener";a.window=$(window);a.init=function(b,c){Core.loadPage("minutas-contados-obtener.html",function(){document.title="Minutas Contados Obtener";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divContainerMinutas=$(".div-container-minutas");a.divContainerMinutas.show();a.divContainerDetalleMinuta=$(".div-container-detalle-minuta");a.divContainerDetalleMinuta.hide();a.divMinutas=$(".div-minutas");a.lblTitle=$(".label-title");a.txtFilter=$(".textbox-filter");a.txtDate=$(".date-picker-date");a.ddlTicker=$(".dropdown-ticker");a.ddlPlazo=$(".dropdown-plazo");a.ddlMoneda=$(".dropdown-moneda");a.ddlOperador=$(".dropdown-operador");a.btnRefresh=$(".btn-refresh");a.divEstados=$(".div-estados");a.divMercados=$(".div-mercados");a.divColores=$(".div-colores");a.estadosActivos={};a.mercadosActivos={};a.coloresActivos={};a.originalData=[];a.window=$(window);a.initGrid();a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadGrid()},"Core.Business.MinutasContadosObtener")})};a.initControls=function(){a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var b=a.divMinutas.swidget().dataSource;if(value){b.filter={or:[{path:"idMinuta",filter:"contains",value:value},{path:"UsuarioIngreso",filter:"contains",value:value},{path:"Descripcion",filter:"contains",value:value},{path:"Moneda",filter:"contains",value:value},{path:"Especie",filter:"contains",value:value},{path:"Corredor",filter:"contains",value:value},{path:"Ticker",filter:"contains",value:value},{path:"UsuarioOperador",filter:"contains",value:value},{path:"NumComitente",filter:"contains",value:value},{path:"NumCtaContadoVuelta",filter:"contains",value:value},{path:"NumCtaBalanz",filter:"contains",value:value},]}}else{b.filter=null}b.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.MinutasContadosObtener.txtFilter");a.txtDate.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),events:{change:function(b){a.loadGrid()}}});a.ddlTicker.shieldDropDown({dataSource:{data:[]},valueTemplate:"{Descripcion}",textTemplate:"{Descripcion}",events:{select:function(b){a.refreshGrid()}}});a.ddlMoneda.shieldDropDown({dataSource:{data:[]},valueTemplate:"{Descripcion}",textTemplate:"{Descripcion}",events:{select:function(b){a.refreshGrid()}}});a.ddlOperador.shieldDropDown({dataSource:{data:[]},valueTemplate:"{Descripcion}",textTemplate:"{Descripcion}",events:{select:function(b){a.refreshGrid()}}});a.ddlPlazo.shieldDropDown({dataSource:{data:[]},valueTemplate:"{Plazo}",textTemplate:"{Plazo}",events:{select:function(b){a.refreshGrid()}}});a.btnRefresh.on("click",function(){a.loadGrid()})};a.initGrid=function(){var b=[];b.push({field:"idMinuta",title:"ID",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"FechaOHora",title:"Fecha Carga",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"FechaLiquidacion",title:"Liquidación",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"UsuarioIngreso",title:"Solicita",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass()});b.push({field:"Mercado",title:"Mercado",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass()});b.push({field:"NumComitente",title:"Comitente",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),columnTemplate:function(c,d,e){c.html('<span title="'+Core.Functions.grid.formatUndefinedString(d.DescComitente)+'">'+Core.Functions.grid.formatUndefinedString(d.NumComitente)+"</span>")}});b.push({field:"NumCtaContadoVuelta",title:"Cuenta Contado Vuelta",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),columnTemplate:function(c,d,e){c.html('<span title="'+Core.Functions.grid.formatUndefinedString(d.DescCtaContadoVuelta)+'">'+Core.Functions.grid.formatUndefinedString(d.NumCtaContadoVuelta)+"</span>")}});b.push({field:"NumCtaBalanz",title:"Cuenta Balanz",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),columnTemplate:function(c,d,e){c.html('<span title="'+Core.Functions.grid.formatUndefinedString(d.DescCtaBalanz)+'">'+Core.Functions.grid.formatUndefinedString(d.NumCtaBalanz)+"</span>")}});b.push({field:"Operacion",title:"Tipo",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass()});b.push({field:"Moneda",title:"Moneda",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass()});b.push({field:"Ticker",title:"Ticker",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass()});b.push({field:"Cantidad",title:"Cantidad",width:"7%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatPrice});b.push({field:"Precio",title:"Precio",width:"7%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatPrice});b.push({field:"Monto",title:"Monto",width:"7%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatPrice});b.push({field:"Plazo",title:"Plazo",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass()});b.push({field:"Observaciones",title:"Observaciones",width:"7%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass()});b.push({field:"UsuarioOperador",title:"Operador",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass()});b.push({field:"Estado",title:"Estado",width:"7%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),columnTemplate:function(c,d,e){c.html('<span title="'+d.Estado+'">'+d.Estado+"</span>")}});b.push({field:"",title:" ",width:40,headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,e,f){d.parent().css("background-color","rgba("+Core.Functions.grid.hexToRgb(e.Color)+((f%2==0)?", 0.6":", 1 ")+")");var c=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-resize-full"></span></button>').appendTo(d);c.on("click",function(){new Core.Business.MinutasContadosObtener.Detalle({minuta:e,overlayElement:c,onLoad:function(){a.divContainerDetalleMinuta.show();a.divContainerMinutas.hide();$("html, body").animate({scrollTop:0},1000)},onClosed:function(){a.divContainerDetalleMinuta.hide();a.divContainerMinutas.show();$("html, body").animate({scrollTop:0},1000)},container:a.divContainerDetalleMinuta}).show()})}});a.divMinutas.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:b,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Minutas",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["idMinuta","FechaOHora","FechaLiquidacion","UsuarioIngreso","Mercado","NumComitente","DescComitente","NumCtaContadoVuelta","DescCtaContadoVuelta","NumCtaBalanz","DescCtaBalanz","Operacion","Moneda","Ticker","Cantidad","Precio","Monto","Plazo","Observaciones","UsuarioOperador","Estado"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Minutas Contados"}}}})};a.loadGrid=function(){a.lblTitle.text("Al "+Core.Functions.Date.getDisplayDate(a.txtDate.swidget().value()));var b=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divMinutas.parent(),secureRequest:true,requestUrl:"minutas/contados/"+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDate.swidget().value())),requestType:"GET"});b.onSuccess=function(j){a.originalData=j.minutas;var d=[];var i=[];var c=[];var n=[{Ticker:"Todos",Descripcion:"Todos"}];var m=[{Plazo:"Todos",Descripcion:"Todos"}];var l=[{UsuarioOperador:"Todos",Descripcion:"Todos"}];var k=[{Moneda:"Todos",Descripcion:"Todos"}];$.each(a.originalData,function(o,p){if(!($.grep(n,function(r,q){return r.Ticker==p.Ticker})[0])){n.push({Ticker:p.Ticker,Descripcion:p.Ticker})}if(!($.grep(m,function(r,q){return r.Plazo==p.Plazo})[0])){m.push({Plazo:p.Plazo,Descripcion:p.Plazo})}if(!($.grep(l,function(r,q){return r.UsuarioOperador==p.UsuarioOperador})[0])){l.push({UsuarioOperador:p.UsuarioOperador,Descripcion:(p.UsuarioOperador?p.UsuarioOperador:"No definido")})}if(!($.grep(k,function(r,q){return r.Moneda==p.Moneda})[0])){k.push({Moneda:p.Moneda,Descripcion:p.Moneda})}if(d.indexOf(p.Estado)<0){d.push(p.Estado)}if(i.indexOf(p.Mercado)<0){i.push(p.Mercado)}if(!($.grep(c,function(q,r){return q.Color==p.Color})[0])){c.push({Color:p.Color,LeyendaColor:p.LeyendaColor})}});a.divEstados.empty();$.each(d,function(p,r){var o=$.grep(a.originalData,function(t,s){return t.Estado==r}).length;var q=$("<label style='background-color: "+((a.estadosActivos[r]==false)?"transparent":"lightblue")+"; margin: 8px 6px 8px 0; padding: 4px 5px; border: 1px solid #ccc; font-weight: normal;' activo='"+((a.estadosActivos[r]==false)?"false":"true")+"' valor='"+r+"'>"+r+": <strong style='color: #333;'>"+o+"</strong></label>").appendTo(a.divEstados);if(a.estadosActivos[r]==null){a.estadosActivos[r]=true}q.on("click",function(){Core.Functions.DynamicFilter.setFilter(q,"lightblue","transparent",a.estadosActivos);a.refreshGrid()})});a.divMercados.empty();$.each(i,function(p,r){var o=$.grep(a.originalData,function(t,s){return t.Mercado==r}).length;var q=$("<label style='background-color: "+((a.mercadosActivos[r]==false)?"transparent":"lightblue")+"; margin: 8px 6px 8px 0; padding: 4px 5px; border: 1px solid #ccc; font-weight: normal;' activo='"+((a.mercadosActivos[r]==false)?"false":"true")+"' valor='"+r+"'>"+r+": <strong style='color: #333;'>"+o+"</strong></label>").appendTo(a.divMercados);if(a.mercadosActivos[r]==null){a.mercadosActivos[r]=true}q.on("click",function(){Core.Functions.DynamicFilter.setFilter(q,"lightblue","transparent",a.mercadosActivos);a.refreshGrid()})});a.divColores.empty();c.forEach(function(q,p){var o=$.grep(a.originalData,function(t,s){return t.Color==q.Color}).length;var r=$('<label valor="'+q.Color+'" activo="'+((a.coloresActivos[q.Color]==false)?"false":"true")+'" style="font-weight: normal; color: #2d2d2d !important; border-radius:4px; margin: 8px 6px 8px 0; border: 4px solid '+(q.Color?q.Color:"transparent")+"; background-color:"+((a.coloresActivos[q.Color]==false)?"#c4c4c4":q.Color)+';">'+q.LeyendaColor+': <strong style="color: #333;">'+o+"</strong></label>").appendTo(a.divColores);if(a.coloresActivos[q.Color]==null){a.coloresActivos[q.Color]=true}r.on("click",function(){Core.Functions.DynamicFilter.setFilter(r,q.Color,"#c4c4c4",a.coloresActivos);a.refreshGrid()})});var h=a.ddlTicker.swidget().initialOptions;h.dataSource.data=n;h.value=a.ddlTicker.swidget().value()?a.ddlTicker.swidget().value():"Todos";a.ddlTicker.swidget().refresh(h);var g=a.ddlPlazo.swidget().initialOptions;g.dataSource.data=m;g.value=a.ddlPlazo.swidget().value()?a.ddlPlazo.swidget().value():"Todos";a.ddlPlazo.swidget().refresh(g);var e=a.ddlMoneda.swidget().initialOptions;e.dataSource.data=k;e.value=a.ddlMoneda.swidget().value()?a.ddlMoneda.swidget().value():"Todos";a.ddlMoneda.swidget().refresh(e);var f=a.ddlOperador.swidget().initialOptions;f.dataSource.data=l;f.value=a.ddlOperador.swidget().value()?a.ddlOperador.swidget().value():"Todos";a.ddlOperador.swidget().refresh(f);a.refreshGrid()};b.request()};a.refreshGrid=function(){var d=Core.Functions.DynamicFilter.getActiveFilters(a.estadosActivos);var f=Core.Functions.DynamicFilter.getActiveFilters(a.mercadosActivos);var b=Core.Functions.DynamicFilter.getActiveFilters(a.coloresActivos);var c=$.grep(a.originalData,function(j,h){return d.indexOf(j.Estado)>=0&&f.indexOf(j.Mercado)>=0&&b.indexOf(j.Color)>=0});if(a.ddlTicker.swidget().selectedItem()&&a.ddlTicker.swidget().selectedItem().Ticker!="Todos"){c=$.grep(c,function(j,h){return j.Ticker==a.ddlTicker.swidget().selectedItem().Ticker})}if(a.ddlPlazo.swidget().selectedItem()&&a.ddlPlazo.swidget().selectedItem().Plazo!="Todos"){c=$.grep(c,function(j,h){return j.Plazo==a.ddlPlazo.swidget().selectedItem().Plazo})}if(a.ddlMoneda.swidget().selectedItem()&&a.ddlMoneda.swidget().selectedItem().Moneda!="Todos"){c=$.grep(c,function(j,h){return j.Moneda==a.ddlMoneda.swidget().selectedItem().Moneda})}if(a.ddlOperador.swidget().selectedItem()&&a.ddlOperador.swidget().selectedItem().UsuarioOperador!="Todos"){c=$.grep(c,function(j,h){return j.UsuarioOperador==a.ddlOperador.swidget().selectedItem().UsuarioOperador})}var g=a.window.scrollTop();var e=a.divMinutas.swidget().initialOptions;e.dataSource.data=c;e.exportOptions.excel.dataSource.data=c;e.exportOptions.excel.readDataSource=true;a.divMinutas.swidget().refresh(e);a.window.scrollTop(g);a.txtFilter.keydown()}};Core.Business.MinutasContadosObtener.Detalle=function(b){var a=this;a.container=null;a.minuta=null;a.onLoad=function(){};a.onClosed=function(){};a.overlayElement=null;$.extend(true,a,b);a.show=function(){var c=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,showOverlay:true,requestUrl:"minutas/version2/mensajes/"+a.minuta.idMinuta,requestType:"GET"});c.onSuccess=function(d){a.lblTitle=a.container.find(".title");a.lblTitle.text("Detalles Minuta: "+a.minuta.idMinuta);a.divAlertLock=a.container.find(".div-minuta-alert-lock");a.divAlertLock.empty();a.divAlertLock.hide();if(d&&d.AlertaLock&&d.AlertaLock.length){$('<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"><p><strong>Alert Lock</strong></p></div>').appendTo(a.divAlertLock);d.AlertaLock.forEach(function(f,e){$('<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"><p style="font-size:18px; color:'+(f.Color?f.Color:"")+' !important;"><i style="margin-right:5px;" class="fa fa-exclamation-circle" aria-hidden="true"></i>'+f.Alerta+"</p></div>").appendTo(a.divAlertLock)});a.divAlertLock.show()}a.divAdvertencias=a.container.find(".div-minuta-advertencias");a.divAdvertencias.empty();a.divAdvertencias.hide();if(d&&d.Mensajes&&d.Mensajes.length){$('<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"><p><strong>Advertencias</strong></p></div>').appendTo(a.divAdvertencias);d.Mensajes.forEach(function(f,e){$('<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"><p>'+f.Mensaje+"</p></div>").appendTo(a.divAdvertencias)});a.divAdvertencias.show()}a.lblFechaCarga=a.container.find(".label-minuta-fecha-carga");a.lblFechaCarga.text((a.minuta.FechaOHora)?a.minuta.FechaOHora:"");a.lblIngreso=a.container.find(".label-minuta-ingreso");a.lblIngreso.text((a.minuta.UsuarioIngreso)?a.minuta.UsuarioIngreso:"");a.lblAsesor=a.container.find(".label-minuta-asesor");a.lblAsesor.text((a.minuta.UsuarioAsesor)?a.minuta.UsuarioAsesor:"");a.lblOperador=a.container.find(".label-minuta-operador");a.lblOperador.text((a.minuta.UsuarioOperador)?a.minuta.UsuarioOperador:"");a.lblUltimaActualizacion=a.container.find(".label-minuta-ultima-actualizacion");a.lblUltimaActualizacion.text((a.minuta.FechaUltimaActualizacion)?a.minuta.FechaUltimaActualizacion:"");a.lblEstado=a.container.find(".label-minuta-estado");a.lblEstado.text((a.minuta.Estado)?a.minuta.Estado:"");a.lblMercado=a.container.find(".label-minuta-mercado");a.lblMercado.text((a.minuta.Mercado)?a.minuta.Mercado:"");a.lblMoneda=a.container.find(".label-minuta-moneda");a.lblMoneda.text((a.minuta.Moneda)?a.minuta.Moneda:"");a.lblFechaConcertacion=a.container.find(".label-minuta-fecha-concertacion");a.lblFechaConcertacion.text((a.minuta.FechaConcertacion)?a.minuta.FechaConcertacion:"");a.divFechaLiquidacion=a.container.find(".div-minuta-fecha-liquidacion");a.lblFechaLiquidacion=a.container.find(".label-minuta-fecha-liquidacion");a.lblFechaLiquidacion.text((a.minuta.FechaLiquidacion)?a.minuta.FechaLiquidacion:"");a.divCuenta=a.container.find(".div-minuta-cuenta");a.lblComitente=a.container.find(".label-minuta-comitente");a.lblComitente.text((a.minuta.NumComitente)?Core.Functions.grid.formatIntegerNumber(a.minuta.NumComitente):"No ingresado");a.lblDescripcionComitente=a.container.find(".label-minuta-descripcion-comitente");a.lblDescripcionComitente.text((a.minuta.DescComitente)?a.minuta.DescComitente:"No ingresado");a.divDescripcionAsesor=a.container.find(".div-minuta-descripcion-asesor");a.lblDescripcionAsesor=a.container.find(".label-minuta-descripcion-asesor");a.lblDescripcionAsesor.text((a.minuta.AsesorDescripcion)?a.minuta.AsesorDescripcion:"");a.divConAsesor=a.container.find(".div-minuta-con-asesor");a.lblConAsesor=a.container.find(".label-minuta-con-asesor");a.lblConAsesor.text((a.minuta.ConAsesor==1)?"SI":"NO");a.lblTipoOperacion=a.container.find(".label-minuta-tipo-operacion");a.lblTipoOperacion.text((a.minuta.Operacion)?a.minuta.Operacion:"");a.divTicker=a.container.find(".div-minuta-ticker");a.lblTicker=a.container.find(".label-minuta-ticker");a.lblTicker.text((a.minuta.Ticker)?a.minuta.Ticker:"");a.divPlazo=a.container.find(".div-minuta-plazo");a.lblPlazo=a.container.find(".label-minuta-plazo");a.lblPlazo.text((a.minuta.Plazo)?a.minuta.Plazo:"");a.divCantidad=a.container.find(".div-minuta-cantidad");a.lblCantidad=a.container.find(".label-minuta-cantidad");a.lblCantidad.text(Core.Functions.grid.formatNumberWithDecimals((a.minuta.Cantidad)?a.minuta.Cantidad:""));a.divPrecio=a.container.find(".div-minuta-precio");a.lblPrecio=a.container.find(".label-minuta-precio");a.lblPrecio.text(Core.Functions.grid.formatNumberWithDecimals((a.minuta.Precio)?a.minuta.Precio:""));a.divPrecioReferencia=a.container.find(".div-minuta-precio-referencia");a.lblPrecioReferencia=a.container.find(".label-minuta-precio-referencia");a.lblPrecioReferencia.text(Core.Functions.grid.formatNumberWithDecimals((a.minuta.PrecioReferencia)?a.minuta.PrecioReferencia:""));a.divPrecioProductor=a.container.find(".div-minuta-precio-productor");a.lblPrecioProductor=a.container.find(".label-minuta-precio-productor");a.lblPrecioProductor.text(Core.Functions.grid.formatNumberWithDecimals((a.minuta.PrecioProductor)?a.minuta.PrecioProductor:""));a.lblMonto=a.container.find(".label-minuta-monto");a.lblMonto.text(Core.Functions.grid.formatNumberWithDecimals((a.minuta.Monto)?a.minuta.Monto:""));a.divCorredor=a.container.find(".div-minuta-corredor");a.lblCorredor=a.container.find(".label-minuta-corredor");a.lblCorredor.text((a.minuta.Corredor)?a.minuta.Corredor:"Sin Corredor");a.divComision=a.container.find(".div-minuta-comision");a.lblComision=a.container.find(".label-minuta-comision");a.lblComision.text((a.minuta.Comision==1)?"SI":"NO");a.divCruce=a.container.find(".div-minuta-cruce");a.lblCruce=a.container.find(".label-minuta-cruce");a.lblCruce.text((a.minuta.EsCruce==1)?"SI":"NO");a.divIdExterno=a.container.find(".div-minuta-id-externo");a.lblIdExterno=a.container.find(".label-minuta-id-externo");a.lblIdExterno.text((a.minuta.CodMercadoExterno)?a.minuta.CodMercadoExterno:"");a.divCantidadDias=a.container.find(".div-minuta-cantidad-dias");a.lblCantidadDias=a.container.find(".label-minuta-cantidad-dias");a.lblCantidadDias.text(Core.Functions.grid.formatIntegerNumber((a.minuta.CantidadDiasPrestamo)?a.minuta.CantidadDiasPrestamo:""));a.divTasa=a.container.find(".div-minuta-tasa");a.lblTasa=a.container.find(".label-minuta-tasa");a.lblTasa.text(Core.Functions.grid.formatNumberWithDecimals((a.minuta.TasaPrestamo)?a.minuta.TasaPrestamo:""));a.lblCuentaBalanz=a.container.find(".label-minuta-cuenta-balanz");a.lblCuentaBalanz.text((a.minuta.DescCtaBalanz)?a.minuta.DescCtaBalanz:"No definido");a.lblContado=a.container.find(".label-minuta-contado");a.lblContado.text((a.minuta.esContado==1)?"SI":"NO");a.divCuentaVueltaContado=a.container.find(".div-minuta-cuenta-vuelta-contado");a.lblCuentaVueltaContado=a.container.find(".label-minuta-cuenta-vuelta-contado");a.lblCuentaVueltaContado.text((a.minuta.DescCtaContadoVuelta)?a.minuta.DescCtaContadoVuelta:"No definido");a.lblObservaciones=a.container.find(".label-minuta-observaciones");a.lblObservaciones.text((a.minuta.Observaciones)?a.minuta.Observaciones:"");a.btnVolver=a.container.find(".btn-detalle-minuta-volver");a.btnVolver.unbind("click");a.btnVolver.on("click",function(){a.onClosed()});a.setControls();a.onLoad()};c.request()};a.setControls=function(){a.divFechaLiquidacion.show();a.divTicker.show();a.divPlazo.show();a.divCantidad.show();a.divPrecio.show();a.divPrecioReferencia.show();a.divCorredor.show();a.divCruce.show();a.divIdExterno.show();a.divTasa.hide();a.divCantidadDias.hide();a.divPrecioProductor.hide();a.divCuenta.show();if(a.minuta.idMercado==Core.Enums.eMinutaMercado.Privado){a.divCorredor.hide();a.divCruce.hide();a.divIdExterno.hide()}if(a.minuta.idMercado==Core.Enums.eMinutaMercado.PrestamoEfectivo){a.divCuenta.hide();a.divTasa.show();a.divCantidadDias.show();a.divFechaLiquidacion.hide();a.divTicker.hide();a.divPlazo.hide();a.divCantidad.hide();a.divPrecio.hide();a.divPrecioReferencia.hide();a.divCorredor.hide();a.divCruce.hide();a.divIdExterno.hide()}a.divConAsesor.hide();a.divDescripcionAsesor.hide();if(a.minuta.ConAsesor!=null){a.divConAsesor.show();if(a.minuta.ConAsesor==1){a.divDescripcionAsesor.show()}}a.divCuentaVueltaContado.hide();if(a.minuta.esContado){a.divCuentaVueltaContado.show()}a.divComision.hide();if(a.minuta.idCorredor){a.divComision.show()}}};Core.Business.MinutasInternacional=new function(){var a=this;a.eTipoContraparte={Agente:1,Comitente:2};a.eTipoInstrumento={Bono:0,Accion:1};a.decimalCount=8;a.pageOptions=null;a.id="insertarMinutaInternacional";a.txtFechaConcertacion=null;a.txtFechaLiquidacion=null;a.ddlCuenta=null;a.ddlTipoContraparte=null;a.divControlsComitente=null;a.divAgente=null;a.ddlAgente=null;a.txtComitente=null;a.lblDescripcionComitente=null;a.ddlEspecie=null;a.txtCantidad=null;a.txtPrecio=null;a.txtMonto=null;a.chkInstrumentosAccion=null;a.chkInstrumentosBono=null;a.chkCruce=null;a.txtPrecioReferencia=null;a.txtObservaciones=null;a.ddlMoneda=null;a.ddlTipoOperacion=null;a.divAlert=null;a.btnSend=null;a.btnBuscarCuentas=null;a.selectedAccount=null;a.init=function(b,c){Core.loadPage("minutas-internacional.html",function(){document.title="Minutas Internacional";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadTabs,"Core.Business.MinutasInternacional")})};a.initControls=function(){a.txtFechaConcertacion=$(".date-fecha-concertacion");a.txtFechaConcertacion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),});a.txtFechaLiquidacion=$(".date-fecha-liquidacion");a.txtFechaLiquidacion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date()});a.ddlCuenta=$(".dropdown-cuenta");a.ddlCuenta.shieldDropDown({dataSource:{data:[{value:Core.Enums.eVehiculo.BCI,text:"BCI"}]},valueTemplate:"{value}",textTemplate:"{text}",value:Core.Enums.eVehiculo.BCI.toString(),enabled:false});a.divControlsComitente=$(".div-controls-comitente");a.divAgente=$(".div-agente");a.divAgente.hide();a.ddlAgente=$(".dropdown-agente");a.ddlAgente.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idAgente}",textTemplate:"{Agente}"});a.ddlTipoContraparte=$(".dropdown-tipo-contraparte");a.ddlTipoContraparte.shieldDropDown({dataSource:{data:[{value:a.eTipoContraparte.Agente,text:"Agente"},{value:a.eTipoContraparte.Comitente,text:"Comitente"}]},valueTemplate:"{value}",textTemplate:"{text}",value:a.eTipoContraparte.Comitente.toString(),events:{select:function(b){a.setControlsByTipoContraparte()}}});a.txtComitente=$(".textbox-comitente");new Core.Controls.DecimalPicker(a.txtComitente,{maxDecimalDigitCount:0,showThousandsSeparator:"",defaultValue:(a.minuta&&a.minuta.Broker!=null)?a.minuta.Broker:"",onKeyUp:function(){a.searchAccount()}});Core.Functions.Validations.toggleValidation(a.txtComitente,false);a.lblDescripcionComitente=$(".lbl-descripcion-comitente");a.btnBuscarCuentas=$(".button-buscar-cuentas");a.btnBuscarCuentas.unbind("click");a.btnBuscarCuentas.click(function(){new Core.Business.MinutasInternacional.SearchAccount({onSelected:function(b){a.btnSend.show();a.selectedAccount=b;a.lblDescripcionComitente.text(a.selectedAccount.Descripcion);a.txtComitente.val(a.selectedAccount.NumComitente)}}).show()});a.ddlEspecie=$(".dropdown-especie");a.ddlEspecie.shieldComboBox({dataSource:{data:[]},valueTemplate:"{Ticker}",textTemplate:"{DisplayTicker} | {Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}},events:{focus:function(b){var c=a.ddlEspecie.swidget().initialOptions;c.value="";a.ddlEspecie.swidget().refresh(c);a.ddlEspecie.swidget().focus()}}});a.txtCantidad=$(".textbox-cantidad");new Core.Controls.DecimalPicker(a.txtCantidad,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onChange:a.setMonto});a.txtMonto=$(".textbox-monto");new Core.Controls.DecimalPicker(a.txtMonto,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onChange:a.setPrecio});a.txtPrecio=$(".textbox-precio");new Core.Controls.DecimalPicker(a.txtPrecio,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onChange:a.setMonto});a.chkInstrumentosAccion=$(".chk-instrumento-accion");a.chkInstrumentosAccion.shieldRadioButton({label:"Acción",checked:false,events:{click:function(b){a.setMonto()}}});a.chkInstrumentosBono=$(".chk-instrumento-bono");a.chkInstrumentosBono.shieldRadioButton({label:"Bono",checked:true,events:{click:function(b){a.setMonto()}}});a.chkCruce=$(".checkbox-es-cruce");a.chkCruce.shieldCheckBox({checked:false});a.txtPrecioReferencia=$(".textbox-precio-referencia");new Core.Controls.DecimalPicker(a.txtPrecioReferencia,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:""});a.txtObservaciones=$(".text-observaciones");a.txtObservaciones.shieldTextBox({});a.ddlMoneda=$(".dropdown-moneda");a.ddlMoneda.shieldDropDown({dataSource:{data:[Core.Enums.Currency.Pesos,Core.Enums.Currency.Dolares,Core.Enums.Currency.DolaresCable]},textTemplate:"{Descripcion}",valueTemplate:"{idMoneda}",value:Core.Enums.Currency.DolaresCable.idMoneda.toString()});a.ddlTipoOperacion=$(".dropdown-tipo-operacion");a.ddlTipoOperacion.shieldDropDown({dataSource:{data:[{value:Core.Enums.eMinutaTipoOperacion.Compra,text:"Compra"},{value:Core.Enums.eMinutaTipoOperacion.Venta,text:"Venta"}]},textTemplate:"{text}",valueTemplate:"{value}"});a.btnSend=$(".btn-send");a.btnSend.click(function(){a.validData(a.send)});a.divAlert=$(".div-alert-minuta");a.divAlert.slideUp()};a.setControlsByTipoContraparte=function(){if(a.ddlTipoContraparte.swidget().selectedItem().value==a.eTipoContraparte.Comitente){a.divControlsComitente.show();a.divAgente.hide();a.txtComitente.val("");a.searchAccount()}else{var b=new Core.Ajax.ServerRequest({allowCache:true,showOverlay:true,secureRequest:true,requestUrl:"agentes/"+Core.Enums.eVehiculo.BCI,requestType:"GET"});b.onSuccess=function(e){var c=e.agentes==null?[]:e.agentes;var d=a.ddlAgente.swidget().initialOptions;d.dataSource.data=c;a.ddlAgente.swidget().refresh(d);a.divControlsComitente.hide();a.divAgente.show();a.txtComitente.val("");a.searchAccount();a.btnSend.show()};b.request()}};a.loadTabs=function(){a.setControlsByTipoContraparte();a.searchAccount();a.getEspecies()};a.searchAccount=function(){if(a.txtComitente.val()){var b=new Core.Ajax.ServerRequest({showOverlay:false,secureRequest:true,requestUrl:"cuentas/numdescripcion/"+Core.Enums.eVehiculo.BCI+"/"+a.txtComitente.val(),requestType:"GET"});b.onSuccess=function(c){if(c.cuentas.length==1){a.btnSend.show();a.selectedAccount=c.cuentas[0];a.lblDescripcionComitente.text(a.selectedAccount.Descripcion)}else{a.btnSend.hide();a.selectedAccount=null;a.lblDescripcionComitente.text("Comitente no encontrado")}};b.request()}else{a.btnSend.hide();a.selectedAccount=null;a.lblDescripcionComitente.text("Comitente no encontrado")}};a.getEspecies=function(){var b={};b.panel=Core.Enums.ePanel.BonosFull;var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"especies",requestType:"GET",requestData:b});c.onSuccess=function(f){var d=f.especies==null?[]:f.especies;var e=a.ddlEspecie.swidget().initialOptions;e.dataSource.data=d;a.ddlEspecie.swidget().refresh(e)};c.request()};a.setMonto=function(){var b=a.txtMonto.val();if(a.txtCantidad.val()&&a.txtPrecio.val()){if(a.chkInstrumentosAccion.swidget().checked()){b=(Core.Functions.Decimal.parseFloat(a.txtCantidad.val())*Core.Functions.Decimal.parseFloat(a.txtPrecio.val()))}if(a.chkInstrumentosBono.swidget().checked()){b=(Core.Functions.Decimal.parseFloat(a.txtCantidad.val())*Core.Functions.Decimal.parseFloat(a.txtPrecio.val()))/100}}a.txtMonto.val(b);a.txtMonto.blur()};a.setPrecio=function(){var b=a.txtPrecio.val();if(a.txtCantidad.val()&&a.txtMonto.val()){if(a.chkInstrumentosAccion.swidget().checked()){b=(Core.Functions.Decimal.parseFloat(a.txtMonto.val())/Core.Functions.Decimal.parseFloat(a.txtCantidad.val()))}if(a.chkInstrumentosBono.swidget().checked()){b=(Core.Functions.Decimal.parseFloat(a.txtMonto.val())*100/Core.Functions.Decimal.parseFloat(a.txtCantidad.val()))}}a.txtPrecio.val(b);a.txtPrecio.blur()};a.getSelectedInstrumento=function(b){if(a.chkInstrumentosAccion.swidget().checked()){return a.eTipoInstrumento.Accion}else{if(a.chkInstrumentosBono.swidget().checked()){return a.eTipoInstrumento.Bono}else{b.value=false;a.divAlert.text("Debe seleccionar un tipo de instrumento.");a.divAlert.slideDown()}}};a.validData=function(d){a.divAlert.slideUp();var e={value:true};var b={idMercado:7,FechaConcertacion:Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaConcertacion,e)),FechaLiquidacionMesa:Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaLiquidacion,e)),idCuentaMesa:Core.Functions.Validations.getValidatedDropDownValue(a.ddlCuenta,e),idTipoBroker:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoContraparte,e),ticker:Core.Functions.Validations.getValidatedSwidgetValue(a.ddlEspecie,e),Cantidad:Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidad,e),TipoInstrumentoMesa:a.getSelectedInstrumento(e),esCruce:a.chkCruce.swidget().checked()?1:0,Precio:Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecio,e),Monto:Core.Functions.Validations.getValidatedNumericInputValue(a.txtMonto,e),PrecioReferencia:a.txtPrecioReferencia.val()?Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecioReferencia,e):0,Observaciones:a.txtObservaciones.val(),idTipoOperacion:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,e),idMoneda:Core.Functions.Validations.getValidatedSwidgetValue(a.ddlMoneda)};if(b.idTipoBroker==a.eTipoContraparte.Comitente){b.Broker=((a.selectedAccount)?a.selectedAccount.NumComitente:0);b.idBroker=((a.selectedAccount)?a.selectedAccount.CodComitente:0);b.idCuenta=((a.selectedAccount)?a.selectedAccount.idCuenta:0)}else{b.Broker=((a.ddlAgente.swidget().selectedItem())?a.ddlAgente.swidget().selectedItem().Agente:0);b.idBroker=Core.Functions.Validations.getValidatedDropDownValue(a.ddlAgente,e);b.idCuenta=0}if(!e.value){return}var c="";if(Math.abs(b.Precio-b.PrecioReferencia)>Math.abs(b.Precio/2)){c+="<p>Se ingresó un Precio y un Precio de Referencia muy distintos.</p>"}if(b.PrecioReferencia<=0){c+="<p>Se ingresó un Precio de Referencia en Cero.</p>"}if(b.idTipoOperacion==Core.Enums.eMinutaTipoOperacion.Venta){if(parseFloat(b.Precio)<parseFloat(b.PrecioReferencia)){c+="<p>Operación de VENTA con un Precio menor al Precio de Referencia. Esto generará comisiones negativas.</p>"}}if(b.idTipoOperacion==Core.Enums.eMinutaTipoOperacion.Compra){if(parseFloat(b.Precio)>parseFloat(b.PrecioReferencia)){c+="<p>Operación de COMPRA con un Precio mayor al Precio de Referencia. Esto generará comisiones negativas.</p>"}}if(b.Precio>0&&(Math.abs(b.Precio-b.PrecioReferencia)/b.Precio)>0.017){c+="<p>Operación con una comisión mayor al 1.7%.</p>"}if(c!=""){c+="<p>¿Esta seguro que desea continuar?</p>";new Core.Controls.Confirmation("Alerta",c,{onAccepted:d}).show()}else{d()}};a.send=function(){var d={value:true};var b={data:{idMercado:7,FechaConcertacion:Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaConcertacion,d)),FechaLiquidacionMesa:Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaLiquidacion,d)),idCuentaMesa:Core.Functions.Validations.getValidatedDropDownValue(a.ddlCuenta,d),idTipoBroker:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoContraparte,d),ticker:Core.Functions.Validations.getValidatedSwidgetValue(a.ddlEspecie,d),Cantidad:Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidad,d),TipoInstrumentoMesa:a.getSelectedInstrumento(d),esCruce:a.chkCruce.swidget().checked()?1:0,Precio:Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecio,d),Monto:Core.Functions.Validations.getValidatedNumericInputValue(a.txtMonto,d),PrecioReferencia:a.txtPrecioReferencia.val()?Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecioReferencia,d):0,Observaciones:a.txtObservaciones.val(),idTipoOperacion:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,d),idMoneda:Core.Functions.Validations.getValidatedSwidgetValue(a.ddlMoneda)}};if(b.data.idTipoBroker==a.eTipoContraparte.Comitente){b.data.Broker=((a.selectedAccount)?a.selectedAccount.NumComitente:0);b.data.idBroker=((a.selectedAccount)?a.selectedAccount.CodComitente:0);b.data.idCuenta=((a.selectedAccount)?a.selectedAccount.idCuenta:0)}else{b.data.Broker=((a.ddlAgente.swidget().selectedItem())?a.ddlAgente.swidget().selectedItem().Agente:0);b.data.idBroker=Core.Functions.Validations.getValidatedDropDownValue(a.ddlAgente,d);b.data.idCuenta=0}var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"minutas/insertar",requestType:"POST",requestData:b});c.onSuccess=function(f){var e=new Core.Controls.Dialog("Mensaje","Minuta ingresada correctamente. Número: "+f.idMinuta,{displayButtons:{close:true,accept:false}});e.show();a.clearFields()};c.request()};a.clearFields=function(){a.ddlMoneda.swidget().refresh();a.ddlTipoOperacion.swidget().refresh();a.ddlAgente.swidget().refresh();a.txtObservaciones.val("");a.txtPrecioReferencia.val("");a.txtMonto.val("");a.txtPrecio.val("");a.txtCantidad.val("");a.ddlEspecie.swidget().refresh();a.ddlTipoContraparte.swidget().refresh();a.ddlCuenta.swidget().refresh();a.txtFechaConcertacion.swidget().refresh();a.txtFechaLiquidacion.swidget().refresh();a.txtComitente.val("");a.searchAccount();a.setControlsByTipoContraparte()}};Core.Business.MinutasInternacional.SearchAccount=function(b){var a=this;a.divModal=$(".modal-buscar-cuentas");a.divGridCuentas=null;a.onSelected=function(){};$.extend(true,a,b);a.show=function(){a.divGridCuentas=a.divModal.find(".div-cuentas");a.txtFilter=a.divModal.find(".textbox-filter-cuentas");a.initControls();a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.txtFilter.swidget().focus(true);a.divModal.modal({show:true})};a.initControls=function(){a.divGridCuentas.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:[{field:"NumComitente",width:"20%",title:"Comitente",headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"Descripcion",width:"70%",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{field:"",title:" ",width:"10%",headerAttributes:Core.Functions.grid.getCellEvenClass(),buttons:[{caption:"Seleccionar",cls:"",commandName:"Seleccionar",click:function(d){var c=a.divGridCuentas.swidget().dataItem(d);a.onSelected(c);a.divModal.modal("hide")}}]}]});a.txtFilter.shieldTextBox({value:"",events:{blur:function(){a.loadGrid()}}})};a.loadGrid=function(){if(a.txtFilter.val()){var c=new Core.Ajax.ServerRequest({showOverlay:false,secureRequest:true,requestUrl:"comitentes/numdescripcion/"+Core.Enums.eVehiculo.BCI+"/"+a.txtFilter.val(),requestType:"GET"});c.onSuccess=function(f){var d=f.cuentas==null?[]:f.cuentas;var e=a.divGridCuentas.swidget().initialOptions;e.dataSource.data=d;a.divGridCuentas.swidget().refresh(e)};c.request()}};a.destroy=function(){a.divGridCuentas.swidget().destroy();a.txtFilter.swidget().destroy()}};Core.Business.MinutasVersion2NuevaInternacional=new function(){var a=this;a.eTipoContraparte={Agente:1,Comitente:2};a.eTipoInstrumento={Bono:0,Accion:1};a.decimalCount=8;a.pageOptions=null;a.id="minutasVersion2NuevaInternacional";a.txtFechaConcertacion=null;a.txtFechaLiquidacion=null;a.ddlCuenta=null;a.ddlTipoContraparte=null;a.divControlsComitente=null;a.divAgente=null;a.ddlAgente=null;a.txtComitente=null;a.lblDescripcionComitente=null;a.ddlEspecie=null;a.txtCantidad=null;a.txtPrecio=null;a.txtMonto=null;a.chkInstrumentosAccion=null;a.chkInstrumentosBono=null;a.chkCruce=null;a.txtPrecioReferencia=null;a.ddlCuentaBalanz=null;a.txtObservaciones=null;a.ddlMoneda=null;a.ddlTipoOperacion=null;a.divAlert=null;a.btnSend=null;a.btnBuscarCuentas=null;a.selectedAccount=null;a.init=function(b,c){Core.loadPage("minutas-internacional-version-2-nueva.html",function(){document.title="Minutas Internacional";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadControls,"Core.Business.MinutasVersion2NuevaInternacional")})};a.initControls=function(){a.txtFechaConcertacion=$(".date-fecha-concertacion");a.txtFechaConcertacion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),});a.txtFechaLiquidacion=$(".date-fecha-liquidacion");a.txtFechaLiquidacion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date()});a.ddlCuenta=$(".dropdown-cuenta");a.ddlCuenta.shieldDropDown({dataSource:{data:[{value:Core.Enums.eVehiculo.BCI,text:"BCI"},{value:Core.Enums.eVehiculo.UK,text:"UK"}]},valueTemplate:"{value}",textTemplate:"{text}",value:Core.Enums.eVehiculo.BCI.toString(),events:{select:function(b){a.setControlsByCuenta()}}});a.divControlsComitente=$(".div-controls-comitente");a.divAgente=$(".div-agente");a.divAgente.hide();a.ddlAgente=$(".dropdown-agente");a.ddlAgente.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idAgente}",textTemplate:"{Agente}"});a.ddlTipoContraparte=$(".dropdown-tipo-contraparte");a.ddlTipoContraparte.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idTipoContraparte}",textTemplate:"{TipoContraparte}",value:a.eTipoContraparte.Comitente.toString(),events:{select:function(b){a.setControlsByTipoContraparte()}}});a.txtComitente=$(".textbox-comitente");new Core.Controls.DecimalPicker(a.txtComitente,{maxDecimalDigitCount:0,showThousandsSeparator:"",defaultValue:(a.minuta&&a.minuta.Broker!=null)?a.minuta.Broker:"",onKeyUp:function(){a.searchAccount()}});Core.Functions.Validations.toggleValidation(a.txtComitente,false);a.lblDescripcionComitente=$(".lbl-descripcion-comitente");a.btnBuscarCuentas=$(".button-buscar-cuentas");a.btnBuscarCuentas.unbind("click");a.btnBuscarCuentas.click(function(){new Core.Controls.MinutaBuscarCuenta({requestUrl:("comitentes/numdescripcion/"+a.ddlCuenta.swidget().value()+"/{filter}"),onSelected:function(b){a.btnSend.show();a.selectedAccount=b;a.lblDescripcionComitente.text(a.selectedAccount.Descripcion);a.txtComitente.val(a.selectedAccount.NumComitente)}}).show()});a.ddlEspecie=$(".dropdown-especie");a.ddlEspecie.shieldComboBox({dataSource:{data:[]},valueTemplate:"{Ticker}",textTemplate:"{DisplayTicker} | {Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}},events:{focus:function(b){var c=a.ddlEspecie.swidget().initialOptions;c.value="";a.ddlEspecie.swidget().refresh(c);a.ddlEspecie.swidget().focus()}}});a.txtCantidad=$(".textbox-cantidad");new Core.Controls.DecimalPicker(a.txtCantidad,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onChange:a.setMonto});a.txtMonto=$(".textbox-monto");new Core.Controls.DecimalPicker(a.txtMonto,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onChange:a.setPrecio});a.txtPrecio=$(".textbox-precio");new Core.Controls.DecimalPicker(a.txtPrecio,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onChange:a.setMonto});a.chkInstrumentosAccion=$(".chk-instrumento-accion");a.chkInstrumentosAccion.shieldRadioButton({label:"Acción",checked:false,events:{click:function(b){a.setMonto()}}});a.chkInstrumentosBono=$(".chk-instrumento-bono");a.chkInstrumentosBono.shieldRadioButton({label:"Bono",checked:true,events:{click:function(b){a.setMonto()}}});a.chkCruce=$(".checkbox-es-cruce");a.chkCruce.shieldCheckBox({checked:false});a.txtPrecioReferencia=$(".textbox-precio-referencia");new Core.Controls.DecimalPicker(a.txtPrecioReferencia,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:""});a.ddlCuentaBalanz=$(".dropdown-cuenta-balanz");a.ddlCuentaBalanz.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idCuentaBalanz}",textTemplate:"{CuentaBalanz}",value:"",autoComplete:{enabled:true,filter:{or:[{path:"CuentaBalanz",filter:"contains",value:""}]}},events:{focus:function(b){var c=a.ddlCuentaBalanz.swidget().initialOptions;c.value="";a.ddlCuentaBalanz.swidget().refresh(c);a.ddlCuentaBalanz.swidget().focus()}}});a.txtObservaciones=$(".text-observaciones");a.txtObservaciones.shieldTextBox({});a.ddlMoneda=$(".dropdown-moneda");a.ddlMoneda.shieldDropDown({dataSource:{data:[Core.Enums.Currency.Pesos,Core.Enums.Currency.Dolares,Core.Enums.Currency.DolaresCable]},textTemplate:"{Descripcion}",valueTemplate:"{idMoneda}",value:Core.Enums.Currency.DolaresCable.idMoneda.toString()});a.ddlTipoOperacion=$(".dropdown-tipo-operacion");a.ddlTipoOperacion.shieldDropDown({dataSource:{data:[{value:Core.Enums.eMinutaTipoOperacion.Compra,text:"Compra"},{value:Core.Enums.eMinutaTipoOperacion.Venta,text:"Venta"}]},textTemplate:"{text}",valueTemplate:"{value}"});a.btnSend=$(".btn-send");a.btnSend.click(function(){a.validData(a.send)});a.divAlert=$(".div-alert-minuta");a.divAlert.slideUp()};a.loadControls=function(){var b={};b.panel=((a.pageOptions&&a.pageOptions.minutasVersion2EspeciesPanelInternacional)?a.pageOptions.minutasVersion2EspeciesPanelInternacional:Core.Enums.ePanel.BonosFull);var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"especies",requestType:"GET",requestData:b});c.onSuccess=function(d){var e=new Core.Ajax.ServerRequest({allowCache:true,showOverlay:true,secureRequest:true,requestUrl:"minutas/version2/cuentasbalanz",requestType:"GET"});e.onSuccess=function(i){var g=d.especies==null?[]:d.especies;var h=a.ddlEspecie.swidget().initialOptions;h.dataSource.data=g;a.ddlEspecie.swidget().refresh(h);var f=i.cuentas==null?[]:i.cuentas;var h=a.ddlCuentaBalanz.swidget().initialOptions;h.dataSource.data=f;a.ddlCuentaBalanz.swidget().refresh(h);a.setControlsByCuenta()};e.request()};c.request()};a.setControlsByCuenta=function(){var b=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"tiposcontrapartes/"+a.ddlCuenta.swidget().value(),requestType:"GET"});b.onSuccess=function(d){var c=a.ddlTipoContraparte.swidget().initialOptions;c.dataSource.data=d.tiposcontrapartes?d.tiposcontrapartes:[];a.ddlTipoContraparte.swidget().refresh(c);a.setControlsByTipoContraparte()};b.request()};a.setControlsByTipoContraparte=function(){if(a.ddlTipoContraparte.swidget().value()==a.eTipoContraparte.Comitente){a.divControlsComitente.show();a.divAgente.hide();a.txtComitente.val("");a.searchAccount()}else{var b=new Core.Ajax.ServerRequest({allowCache:true,showOverlay:true,secureRequest:true,requestUrl:"agentes/"+a.ddlCuenta.swidget().value(),requestType:"GET"});b.onSuccess=function(e){var c=e.agentes?e.agentes:[];var d=a.ddlAgente.swidget().initialOptions;d.dataSource.data=c;a.ddlAgente.swidget().refresh(d);a.divControlsComitente.hide();a.divAgente.show();a.txtComitente.val("");a.searchAccount();a.btnSend.show()};b.request()}};a.searchAccount=function(){if(a.txtComitente.val()){var b=new Core.Ajax.ServerRequest({showOverlay:false,secureRequest:true,requestUrl:"cuentas/numdescripcion/"+a.ddlCuenta.swidget().value()+"/"+a.txtComitente.val(),requestType:"GET"});b.onSuccess=function(c){if(c.cuentas.length==1){a.btnSend.show();a.selectedAccount=c.cuentas[0];a.lblDescripcionComitente.text(a.selectedAccount.Descripcion)}else{a.btnSend.hide();a.selectedAccount=null;a.lblDescripcionComitente.text("Comitente no encontrado")}};b.request()}else{a.btnSend.hide();a.selectedAccount=null;a.lblDescripcionComitente.text("Comitente no encontrado")}};a.setMonto=function(){var b=a.txtMonto.val();if(a.txtCantidad.val()&&a.txtPrecio.val()){if(a.chkInstrumentosAccion.swidget().checked()){b=(Core.Functions.Decimal.parseFloat(a.txtCantidad.val())*Core.Functions.Decimal.parseFloat(a.txtPrecio.val()))}if(a.chkInstrumentosBono.swidget().checked()){b=(Core.Functions.Decimal.parseFloat(a.txtCantidad.val())*Core.Functions.Decimal.parseFloat(a.txtPrecio.val()))/100}}a.txtMonto.val(b);a.txtMonto.blur()};a.setPrecio=function(){var b=a.txtPrecio.val();if(a.txtCantidad.val()&&a.txtMonto.val()){if(a.chkInstrumentosAccion.swidget().checked()){b=(Core.Functions.Decimal.parseFloat(a.txtMonto.val())/Core.Functions.Decimal.parseFloat(a.txtCantidad.val()))}if(a.chkInstrumentosBono.swidget().checked()){b=(Core.Functions.Decimal.parseFloat(a.txtMonto.val())*100/Core.Functions.Decimal.parseFloat(a.txtCantidad.val()))}}a.txtPrecio.val(b);a.txtPrecio.blur()};a.getSelectedInstrumento=function(b){if(a.chkInstrumentosAccion.swidget().checked()){return a.eTipoInstrumento.Accion}else{if(a.chkInstrumentosBono.swidget().checked()){return a.eTipoInstrumento.Bono}else{b.value=false;a.divAlert.text("Debe seleccionar un tipo de instrumento.");a.divAlert.slideDown()}}};a.validData=function(c){a.divAlert.slideUp();var d={value:true};var b={idMercado:7,FechaConcertacion:Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaConcertacion,d)),FechaLiquidacionMesa:Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaLiquidacion,d)),idCuentaMesa:Core.Functions.Validations.getValidatedDropDownValue(a.ddlCuenta,d),idTipoBroker:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoContraparte,d),Ticker:Core.Functions.Validations.getValidatedSwidgetValue(a.ddlEspecie,d),Cantidad:Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidad,d),TipoInstrumentoMesa:a.getSelectedInstrumento(d),esCruce:a.chkCruce.swidget().checked()?1:0,Precio:Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecio,d),Monto:Core.Functions.Validations.getValidatedNumericInputValue(a.txtMonto,d),PrecioReferencia:a.txtPrecioReferencia.val()?Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecioReferencia,d):0,Observaciones:a.txtObservaciones.val(),idTipoOperacion:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,d),idMoneda:Core.Functions.Validations.getValidatedSwidgetValue(a.ddlMoneda)};if(a.ddlCuentaBalanz.swidget().selectedItem()){b.idCuentaBalanz=a.ddlCuentaBalanz.swidget().selectedItem().idCuentaBalanz}if(b.idTipoBroker==a.eTipoContraparte.Comitente){b.Broker=((a.selectedAccount)?a.selectedAccount.NumComitente:0);b.idBroker=((a.selectedAccount)?a.selectedAccount.CodComitente:0);b.idCuenta=((a.selectedAccount)?a.selectedAccount.idCuenta:0)}else{b.Broker=((a.ddlAgente.swidget().selectedItem())?a.ddlAgente.swidget().selectedItem().Agente:0);b.idBroker=Core.Functions.Validations.getValidatedDropDownValue(a.ddlAgente,d);b.idCuenta=0}if(!d.value){return}c()};a.send=function(){var d={value:true};var b={data:{idMercado:7,FechaConcertacion:Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaConcertacion,d)),FechaLiquidacionMesa:Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaLiquidacion,d)),idCuentaMesa:Core.Functions.Validations.getValidatedDropDownValue(a.ddlCuenta,d),idTipoBroker:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoContraparte,d),Ticker:Core.Functions.Validations.getValidatedSwidgetValue(a.ddlEspecie,d),Cantidad:Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidad,d),TipoInstrumentoMesa:a.getSelectedInstrumento(d),esCruce:a.chkCruce.swidget().checked()?1:0,Precio:Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecio,d),Monto:Core.Functions.Validations.getValidatedNumericInputValue(a.txtMonto,d),PrecioReferencia:a.txtPrecioReferencia.val()?Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecioReferencia,d):0,Observaciones:a.txtObservaciones.val(),idTipoOperacion:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,d),idMoneda:Core.Functions.Validations.getValidatedSwidgetValue(a.ddlMoneda)}};if(a.ddlCuentaBalanz.swidget().selectedItem()){b.data.idCuentaBalanz=a.ddlCuentaBalanz.swidget().selectedItem().idCuentaBalanz}if(b.data.idTipoBroker==a.eTipoContraparte.Comitente){b.data.Broker=((a.selectedAccount)?a.selectedAccount.NumComitente:0);b.data.idBroker=((a.selectedAccount)?a.selectedAccount.CodComitente:0);b.data.idCuenta=((a.selectedAccount)?a.selectedAccount.idCuenta:0)}else{b.data.Broker=((a.ddlAgente.swidget().selectedItem())?a.ddlAgente.swidget().selectedItem().Agente:0);b.data.idBroker=Core.Functions.Validations.getValidatedDropDownValue(a.ddlAgente,d);b.data.idCuenta=0}var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"minutas/version2/insertarsolicitud",requestType:"POST",requestData:b});c.onSuccess=function(e){new Core.Controls.MinutaConfirmacion({data:e,onConfirm:function(){a.clearFields()}}).show()};c.request()};a.clearFields=function(){a.ddlMoneda.swidget().refresh();a.ddlTipoOperacion.swidget().refresh();a.ddlAgente.swidget().refresh();a.txtObservaciones.val("");a.txtPrecioReferencia.val("");a.txtMonto.val("");a.txtPrecio.val("");a.txtCantidad.val("");a.ddlEspecie.swidget().refresh();a.ddlTipoContraparte.swidget().refresh();a.ddlCuenta.swidget().refresh();a.txtFechaConcertacion.swidget().refresh();a.txtFechaLiquidacion.swidget().refresh();a.txtComitente.val("");a.ddlCuentaBalanz.swidget().refresh();a.chkCruce.swidget().checked(false);a.setControlsByCuenta()}};Core.Business.MinutasVersion2Gestion=new function(){var a=this;a.id="minutasVersion2Gestion";a.divContainerMinutas=null;a.divContainerDetalleMinuta=null;a.divContainerNueva=null;a.divMinutas=null;a.lblTitle=null;a.txtDateFrom=null;a.txtDateTo=null;a.txtFilter=null;a.chkPendientes=null;a.timeout=null;a.loaded=false;a.timerId=null;a.stopTimmer=false;a.btnNueva=null;a.btnAprobacionMasiva=null;a.divEquipo=null;a.ddlEquipo=null;a.ddlTicker=null;a.ddlPlazo=null;a.ddlMoneda=null;a.ddlCruce=null;a.divOperador=null;a.ddlOperador=null;a.divEstados=null;a.divMercados=null;a.divColores=null;a.timeout=null;a.btnRefresh=null;a.originalData=[];a.pageOptions=null;a.estadosActivos={};a.mercadosActivos={};a.coloresActivos={};a.window=$(window);a.init=function(b,c){Core.loadPage("minutas-version-2-gestion.html",function(){document.title="Minutas";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divContainerMinutas=$(".div-container-minutas");a.divContainerMinutas.show();a.divContainerDetalleMinuta=$(".div-container-detalle-minuta");a.divContainerDetalleMinuta.hide();a.divContainerNueva=$(".div-container-nueva");a.divContainerNueva.hide();a.divMinutas=$(".div-minutas");a.lblTitle=$(".label-title");a.txtFilter=$(".textbox-filter");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.divEquipo=$(".div-equipo");a.ddlEquipo=$(".dropdown-equipo");a.ddlTicker=$(".dropdown-ticker");a.ddlPlazo=$(".dropdown-plazo");a.ddlMoneda=$(".dropdown-moneda");a.ddlCruce=$(".dropdown-cruce");a.divOperador=$(".div-operador");a.ddlOperador=$(".dropdown-operador");a.divOperador.show();if(Core.Objects.Context.Configuration.idAplicacion==6){a.divOperador.hide()}a.btnNueva=$(".btn-nueva");a.btnRefresh=$(".btn-refresh");a.divAprobacionMasiva=$(".div-aprobacion-masiva");a.btnAprobacionMasiva=$(".btn-aprobacion-masiva");a.chkPendientes=$(".checkbox-pendientes");a.divEstados=$(".div-estados");a.divMercados=$(".div-mercados");a.divColores=$(".div-colores");a.initGrid();a.initControls();a.estadosActivos={};a.mercadosActivos={};a.coloresActivos={};a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loaded=false;a.loadControls()},"Core.Business.MinutasVersion2Gestion");var d=(Core.Objects.Context.Configuration.idAplicacion==0?900000:60000);a.timerId=window.setInterval(function(){if(a.loaded&&!a.stopTimmer){a.loadGrid()}},d);Core.Objects.Context.Timers.push(a.timerId)})};a.initControls=function(){a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var b=a.divMinutas.swidget().dataSource;if(value){b.filter={or:[{path:"idMinuta",filter:"contains",value:value},{path:"UsuarioIngreso",filter:"contains",value:value},{path:"Descripcion",filter:"contains",value:value},{path:"Moneda",filter:"contains",value:value},{path:"Especie",filter:"contains",value:value},{path:"Corredor",filter:"contains",value:value},{path:"Ticker",filter:"contains",value:value},{path:"UsuarioOperador",filter:"contains",value:value},{path:"NumComitente",filter:"contains",value:value}]}}else{b.filter=null}b.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.MinutasVersion2Gestion.txtFilter");a.btnNueva.click(function(){new Core.Business.MinutasVersion2Gestion.Nueva({onSave:function(){a.loaded=false;a.loadGrid()},onLoad:function(){a.divContainerMinutas.hide();a.divContainerNueva.show();$("html, body").animate({scrollTop:0},1000)},onClosed:function(){a.divContainerMinutas.show();a.divContainerNueva.hide();$("html, body").animate({scrollTop:0},1000)},intencionalidadDefault:Core.Enums.eMesaIntencionalidad.Paridad,overlayElement:a.btnNueva,container:a.divContainerNueva,pageOptions:a.pageOptions}).show()});a.btnNueva.hide();if(a.pageOptions&&a.pageOptions.minutasVersion2InsertarMesa==1){a.btnNueva.show()}a.btnAprobacionMasiva.click(function(){new Core.Business.MinutasVersion2Gestion.AprobacionMasiva({onSuccess:function(){a.loaded=false;a.loadGrid()},minutas:a.divMinutas.swidget().dataSource.data}).show()});a.divAprobacionMasiva.hide();if(Core.Objects.Context.Configuration.idAplicacion==6&&a.pageOptions&&a.pageOptions.minutasVersion2AvanceMasivoMesa==1){a.divAprobacionMasiva.show()}a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(b){a.loaded=false;a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(b){a.loaded=false;a.loadGrid()}}});a.ddlEquipo.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idEquipo}",textTemplate:"{Equipo}",width:200,events:{select:function(b){a.loaded=false;a.loadGrid()}}});a.ddlTicker.shieldDropDown({dataSource:{data:[]},valueTemplate:"{Descripcion}",textTemplate:"{Descripcion}",events:{select:function(b){a.refreshGrid()}}});a.ddlMoneda.shieldDropDown({dataSource:{data:[]},valueTemplate:"{Descripcion}",textTemplate:"{Descripcion}",events:{select:function(b){a.refreshGrid()}}});a.ddlCruce.shieldDropDown({dataSource:{data:[]},valueTemplate:"{Descripcion}",textTemplate:"{Descripcion}",events:{select:function(b){a.refreshGrid()}}});a.ddlOperador.shieldDropDown({dataSource:{data:[]},valueTemplate:"{Descripcion}",textTemplate:"{Descripcion}",events:{select:function(b){a.refreshGrid()}}});a.ddlPlazo.shieldDropDown({dataSource:{data:[]},valueTemplate:"{Plazo}",textTemplate:"{Plazo}",events:{select:function(b){a.refreshGrid()}}});a.btnRefresh.on("click",function(){a.loaded=false;a.loadGrid()});a.chkPendientes.on("change",function(){a.loaded=false;a.loadGrid()})};a.initGrid=function(){var b=[];b.push({field:"idMinuta",title:"ID",width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"FechaOHora",title:"Fecha Carga",width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"FechaLiquidacion",title:"Liquidación",width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"UsuarioIngreso",title:"Solicita",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Mercado",title:"Mercado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"NumComitente",title:"Comitente",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"8%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});if(Core.Objects.Context.Configuration.idAplicacion!=6){b.push({title:"Descr.",width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,d,e){if(d.Descripcion){var f=(d.length>140)?(d.Descripcion.substr(0,140)+"..."):(d.Descripcion);c.html('<button type="button" title="'+f+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-search"></span></button>');c.addClass("link-cell");c.on("click",function(){var g=new Core.Controls.Dialog("Descripción",(d.Descripcion)?d.Descripcion:"",{displayButtons:{close:true,accept:false}});g.show()})}}})}b.push({field:"Operacion",title:"Tipo",width:"8%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Moneda",title:"Moneda",width:"8%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Ticker",title:"Ticker",width:"8%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatPrice});b.push({field:"Precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatPrice});b.push({field:"Monto",title:"Monto",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"15%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatPrice});b.push({field:"Plazo",title:"Plazo",width:"5%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});if(Core.Objects.Context.Configuration.idAplicacion!=3){b.push({title:"Precio Ref.",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,d,e){c.text(Core.Functions.grid.formatPrice(d.PrecioReferencia));c.addClass("link-cell");c.on("click",function(){a.stopTimmer=true;c.text("");var f=$('<input id="txt-update-precio-referencia" type="text";" />').appendTo(c);f.shieldNumericTextBox({cls:"numeric-input-right",min:0,step:1e-06,max:999999999,spinners:false,value:d.PrecioReferencia,events:{change:function(g){var h=new Core.Ajax.ServerRequest({overlayElemet:a.divMinutas.parent(),secureRequest:true,requestUrl:"minutas",requestType:"PUT",requestData:{minuta:{id:d.idMinuta,precioReferencia:g.value}}});h.onSuccess=function(j){var i=new Core.Controls.Dialog("Mensaje","El precio de referencia ha sido modificado correctamente.",{displayButtons:{close:true,accept:false}});i.show()};h.request()},blur:function(){a.loaded=false;a.loadGrid();a.stopTimmer=false}}}).swidget().focus()})}});b.push({field:"DiferenciaPrecios",title:"Diferencia",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});if(Core.Objects.Context.Configuration.idAplicacion!=6){b.push({title:"Obs.",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,d,e){if(d.Observaciones){var f=(d.length>140)?(d.Observaciones.substr(0,140)+"..."):(d.Observaciones);c.html('<button type="button" title="'+f+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');c.addClass("link-cell");c.on("click",function(){var g=new Core.Controls.Dialog("Observaciones",(d.Observaciones)?d.Observaciones:"",{displayButtons:{close:true,accept:false}});g.show()})}}})}}else{b.push({field:"Observaciones",title:"Observaciones",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"15%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)})}if(Core.Objects.Context.Configuration.idAplicacion!=6){b.push({field:"UsuarioOperador",title:"Operador",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)})}b.push({field:"Estado",title:"Estado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,d,e){c.html('<span title="'+d.Estado+'">'+d.Estado+"</span>")}});if(Core.Objects.Context.Configuration.idAplicacion!=3){b.push({field:"EsCruce",title:"Cruce",width:"5%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatBoolean});b.push({title:"Corre",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,d,f){if((d.Corredor&&d.Corredor!="")||(d.Comision&&d.Comision!="")){var e=d.Corredor!=""?("Corredor: "+d.Corredor+"<br />"):"";e+=d.Comision!=""?("Comisión: "+Core.Functions.grid.formatStringBoolean(d.Comision)):"";c.html('<button type="button" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');c.addClass("link-cell");c.on("click",function(){var g=new Core.Controls.Dialog("Corre",e,{displayButtons:{close:true,accept:false}});g.show()})}}})}if(Core.Objects.Context.Configuration.idAplicacion==6||Core.Objects.Context.Configuration.idAplicacion==3){b.push({field:"NumCuentaBalanz",title:"Cuenta Balanz",width:"8%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)})}b.push({field:"",title:" ",width:200,headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(r,s,t){r.parent().css("background-color","rgba("+a.hexToRgb(s.Color)+((t%2==0)?", 0.6":", 1 ")+")");if(s.BotonVerDetalle){var k=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-resize-full"></span></button>').appendTo(r);k.on("click",function(){new Core.Business.MinutasVersion2Gestion.Actualizar({minuta:s,readOnly:true,onLoad:function(){a.stopTimmer=true;a.divContainerDetalleMinuta.show();a.divContainerMinutas.hide();$("html, body").animate({scrollTop:0},1000)},onClosed:function(){a.stopTimmer=false;a.divContainerDetalleMinuta.hide();a.divContainerMinutas.show();$("html, body").animate({scrollTop:0},1000)},container:a.divContainerDetalleMinuta}).show()})}if(s.BotonVerAuditoria){var j=$('<button type="button" title="Auditoría" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(r);j.on("click",function(){var u=new Core.Ajax.ServerRequest({overlayElement:j,requestUrl:"minutas/version2/auditoria/"+s.idMinuta,requestType:"GET"});u.onSuccess=function(z){var x="";if(z.transiciones&&z.transiciones.length){x+="<label>Transiciones</label>";x+="<table class='table table-striped'>";x+="<thead><tr><th>Fecha</th><th>Estado Desde</th><th>Estado Hasta</th><th>Operador</th></tr></thead>";x+="<tbody>";for(var y=0;y<z.transiciones.length;y++){x+="<tr>";x+="<td>"+z.transiciones[y].Fecha.substr(0,19)+"</td>";x+="<td>"+z.transiciones[y].EstadoDesde+"</td>";x+="<td>"+z.transiciones[y].EstadoHasta+"</td>";x+="<td>"+z.transiciones[y].Nombre+"</td>";x+="</tr>"}x+="</tbody>";x+="</table>"}if(z.logcambios&&z.logcambios.length){x+="<label>Log Cambios</label>";for(var y=0;y<z.logcambios.length;y++){x+="<table class='table table-striped'>";x+="<thead><tr><th>Fecha</th><th>Tipo Acción</th><th>Operador</th></tr></thead>";x+="<tbody>";x+="<tr>";x+="<td>"+z.logcambios[y].Fecha.substr(0,19)+"</td>";x+="<td>"+z.logcambios[y].Tipo+"</td>";x+="<td>"+z.logcambios[y].Nombre+"</td>";x+="</tr>";x+="</tbody>";x+="</table>";var w=z.logcambios[y].Contexto?z.logcambios[y].Contexto.split("||"):[];if(w.length){x+="<table class='table table-striped'>";x+="<thead><tr><th>Contexto</th><th></th><th></th></tr></thead>";x+="<tbody>";var v=0;while(v<=w.length){x+="<tr>";x+=("<td>"+(w[v]?w[v]:"")+"</td>");v++;x+=("<td>"+(w[v]?w[v]:"")+"</td>");v++;x+=("<td>"+(w[v]?w[v]:"")+"</td>");v++;x+="</tr>"}x+="</tbody>";x+="</table>"}}}new Core.Controls.Dialog(("Detalles de Minuta "+s.idMinuta),x?x:"No se encontraron detalles.",{displayButtons:{close:true,accept:false}}).show()};u.request()})}if(s.BotonActualizarEnEstadoInicial){var c=$('<button type="button" title="Actualizar Estado Inicial" class="btn-sm balanz-button"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(r);c.on("click",function(){new Core.Business.MinutasVersion2Gestion.Actualizar({minuta:s,actualizarEstadoInicial:true,requestUrl:"minutas/version2/actualizarenestadoinicial",onSave:function(){a.loaded=false;a.loadGrid()},onLoad:function(){a.stopTimmer=true;a.divContainerDetalleMinuta.show();a.divContainerMinutas.hide();$("html, body").animate({scrollTop:0},1000)},onClosed:function(){a.stopTimmer=false;a.divContainerDetalleMinuta.hide();a.divContainerMinutas.show();$("html, body").animate({scrollTop:0},1000)},container:a.divContainerDetalleMinuta}).show()})}if(s.BotonRechazarEnEstadoInicial){var m=$('<button type="button" title="Rechazar Estado Inicial" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(r);m.on("click",function(){a.rechazarMinuta(s,"minutas/version2/actualizarenestadoinicial",m)})}if(Core.Objects.Context.Configuration.idAplicacion==0){if(s.BotonActualizarRolAsesor&&!s.BotonActualizarEnEstadoInicial){var d=$('<button type="button" title="Actualizar Asesor" class="btn-sm balanz-button"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(r);d.on("click",function(){new Core.Business.MinutasVersion2Gestion.Actualizar({minuta:s,actualizarEstadoInicial:false,requestUrl:"minutas/version2/actualizarrolasesor",onSave:function(){a.loaded=false;a.loadGrid()},onLoad:function(){a.stopTimmer=true;a.divContainerDetalleMinuta.show();a.divContainerMinutas.hide();$("html, body").animate({scrollTop:0},1000)},onClosed:function(){a.stopTimmer=false;a.divContainerDetalleMinuta.hide();a.divContainerMinutas.show();$("html, body").animate({scrollTop:0},1000)},container:a.divContainerDetalleMinuta}).show()})}if(s.BotonAprobarRolAsesor){var g=$('<button type="button" title="Aprobar Asesor" class="btn-sm balanz-button"><span class="glyphicon glyphicon-ok"></span></button>').appendTo(r);g.on("click",function(){a.aprobarMinuta(s,"minutas/version2/actualizarrolasesor",g)})}if(s.BotonRechazarRolAsesor&&!s.BotonRechazarEnEstadoInicial){var n=$('<button type="button" title="Rechazar Asesor" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(r);n.on("click",function(){a.rechazarMinuta(s,"minutas/version2/actualizarrolasesor",n)})}}if(Core.Objects.Context.Configuration.idAplicacion==3){if(s.BotonActualizarRolBackoffice&&!s.BotonActualizarEnEstadoInicial){var e=$('<button type="button" title="Actualizar Backoffice" class="btn-sm balanz-button"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(r);e.on("click",function(){new Core.Business.MinutasVersion2Gestion.Actualizar({minuta:s,actualizarEstadoInicial:false,requestUrl:"minutas/version2/actualizarrolbackoffice",onSave:function(){a.loaded=false;a.loadGrid()},onLoad:function(){a.stopTimmer=true;a.divContainerDetalleMinuta.show();a.divContainerMinutas.hide();$("html, body").animate({scrollTop:0},1000)},onClosed:function(){a.stopTimmer=false;a.divContainerDetalleMinuta.hide();a.divContainerMinutas.show();$("html, body").animate({scrollTop:0},1000)},container:a.divContainerDetalleMinuta}).show()})}if(s.BotonAprobarRolBackoffice){var h=$('<button type="button" title="Aprobar Backoffice" class="btn-sm balanz-button"><span class="glyphicon glyphicon-ok"></span></button>').appendTo(r);h.on("click",function(){a.aprobarMinuta(s,"minutas/version2/actualizarrolbackoffice",h)})}if(s.BotonRechazarRolBackoffice&&!s.BotonRechazarEnEstadoInicial){var o=$('<button type="button" title="Rechazar Backoffice" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(r);o.on("click",function(){a.rechazarMinuta(s,"minutas/version2/actualizarrolbackoffice",o)})}if(s.BotonInsertarDMARolBackoffice){var l=$('<button type="button" title="Insertar DMA Backoffice" class="btn-sm balanz-button"><span class="glyphicon glyphicon-share"></span></button>').appendTo(r);l.on("click",function(){var u=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:l,secureRequest:true,requestUrl:"minutas/version2/insertar/ordenesdma",requestType:"POST",requestData:{idMinuta:s.idMinuta}});u.onSuccess=function(w){var v=(w&&w.Descripcion)?w.Descripcion:"Minuta actualizada correctamente.";new Core.Controls.Dialog(("Minuta: "+w.idMinuta),v,{displayButtons:{close:true,accept:false}}).show();a.loaded=false;a.loadGrid()};u.request()})}if(s.BotonVerDetalleDMARolBackoffice){var q=$('<button type="button" title="Detalle DMA Backoffice" class="btn-sm balanz-button"><span class="glyphicon glyphicon-zoom-in"></span></button>').appendTo(r);q.on("click",function(){var u=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:q,secureRequest:true,requestUrl:"minutas/version2/ordenesdma/detalle/"+s.idMinuta,requestType:"GET"});u.onSuccess=function(x){var y="";if(x.Ordenes){y+="<table class='table table-striped'>";y+="<thead><tr><th>Nombre</th><th>Valor</th></tr></thead>";y+="<tbody>";for(var w=0;w<x.Ordenes.length;w++){if(x.Ordenes[w].Nombre&&x.Ordenes[w].Valor){y+="<tr>";y+="<td>"+x.Ordenes[w].Nombre.replaceAll(";"," ")+"</td>";y+="<td>"+x.Ordenes[w].Valor.replaceAll(";"," ")+"</td>";y+="</tr>"}}y+="</tbody>";y+="</table>"}if(x.Transiciones){y+="<label>Transiciones</label>";if(x.Transiciones.length>0){y+="<table class='table table-striped'>";y+="<thead><tr><th>Fecha</th><th>Estado Desde</th><th>Estado Hasta</th><th>Tiempo</th></tr></thead>";y+="<tbody>";for(var w=0;w<x.Transiciones.length;w++){if(x.Transiciones[w].Fecha&&x.Transiciones[w].EstadoDesde&&x.Transiciones[w].EstadoHasta&&x.Transiciones[w].Tiempo!=null){y+="<tr>";y+="<td>"+x.Transiciones[w].Fecha.replaceAll(";"," ")+"</td>";y+="<td>"+x.Transiciones[w].EstadoDesde.replaceAll(";"," ")+"</td>";y+="<td>"+x.Transiciones[w].EstadoHasta.replaceAll(";"," ")+"</td>";y+="<td class='text-right'>"+Core.Functions.grid.formatIntegerNumber(x.Transiciones[w].Tiempo)+"</td>";y+="</tr>"}}y+="</tbody>";y+="</table>"}else{y+="<p>Sin registros.</p><br/>"}}if(x.Operaciones){y+="<label>Operaciones</label>";if(x.Operaciones.length>0){y+="<table class='table table-striped'>";y+="<thead><tr><th>Nro Operación</th><th>Cantidad Operada</th><th>Precio</th><th>Contraparte</th><th>Fecha Operación</th><th>Estado</th></tr></thead>";y+="<tbody>";for(var w=0;w<x.Operaciones.length;w++){if(x.Operaciones[w].NroOperacion&&x.Operaciones[w].CantidadOperada!=null&&x.Operaciones[w].Precio!=null&&x.Operaciones[w].Contraparte!=null&&x.Operaciones[w].FechaOperacion&&x.Operaciones[w].Estado){y+="<tr>";y+="<td class='text-right'>"+x.Operaciones[w].NroOperacion+"</td>";y+="<td class='text-right'>"+x.Operaciones[w].CantidadOperada+"</td>";y+="<td class='text-right'>"+x.Operaciones[w].Precio+"</td>";y+="<td class='text-right'>"+x.Operaciones[w].Contraparte+"</td>";y+="<td>"+x.Operaciones[w].FechaOperacion.replaceAll(";"," ")+"</td>";y+="<td>"+x.Operaciones[w].Estado.replaceAll(";"," ")+"</td>";y+="</tr>"}}y+="</tbody>";y+="</table>"}else{y+="<p>Sin registros.</p><br/>"}}var v=new Core.Controls.Dialog("Detalles de Minuta: "+s.idMinuta,y,{displayButtons:{close:true,accept:false}});v.show()};u.request()})}}if(Core.Objects.Context.Configuration.idAplicacion==6){if(s.BotonActualizarRolMesa&&!s.BotonActualizarEnEstadoInicial){var f=$('<button type="button" title="Actualizar Mesa" class="btn-sm balanz-button"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(r);f.on("click",function(){new Core.Business.MinutasVersion2Gestion.Actualizar({minuta:s,actualizarEstadoInicial:false,requestUrl:"minutas/version2/actualizarrolmesa",onSave:function(){a.loaded=false;a.loadGrid()},onLoad:function(){a.stopTimmer=true;a.divContainerDetalleMinuta.show();a.divContainerMinutas.hide();$("html, body").animate({scrollTop:0},1000)},onClosed:function(){a.stopTimmer=false;a.divContainerDetalleMinuta.hide();a.divContainerMinutas.show();$("html, body").animate({scrollTop:0},1000)},container:a.divContainerDetalleMinuta}).show()})}if(s.BotonAprobarRolMesa){var i=$('<button type="button" title="Aprobar Mesa" class="btn-sm balanz-button"><span class="glyphicon glyphicon-ok"></span></button>').appendTo(r);i.on("click",function(){a.aprobarMinuta(s,"minutas/version2/actualizarrolmesa",i)})}if(s.BotonRechazarRolMesa&&!s.BotonRechazarEnEstadoInicial){var p=$('<button type="button" title="Rechazar Mesa" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(r);p.on("click",function(){a.rechazarMinuta(s,"minutas/version2/actualizarrolmesa",p)})}}}});a.divMinutas.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:b,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Minutas",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["idMinuta","FechaOHora","FechaLiquidacion","UsuarioIngreso","Mercado","NumComitente","Descripcion","Operacion","Moneda","Ticker","Cantidad","Precio","Monto","Plazo","PrecioReferencia","DiferenciaPrecios","Observaciones","UsuarioOperador","Estado","EsCruce","Corredor","Comision"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Minutas"}}}})};a.loadControls=function(){if(Core.Objects.Context.Configuration.idAplicacion==6){var b=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"equipos/2",requestType:"GET"});b.onSuccess=function(c){var d=a.ddlEquipo.swidget().initialOptions;d.dataSource.data=c.equipos;a.ddlEquipo.swidget().refresh(d);a.loadGrid()};b.request()}else{a.divEquipo.hide();a.loadGrid()}};a.loadGrid=function(){a.lblTitle.text("Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var b="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));b+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));var c=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,overlayElement:a.divMinutas.parent(),secureRequest:true,requestUrl:"minutas/version2/gestion/"+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()))+"/"+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()))+"/"+(a.chkPendientes[0].checked?"1":"0")+"/"+(a.ddlEquipo.swidget().selectedItem()?a.ddlEquipo.swidget().selectedItem().idEquipo:0),requestType:"GET",requestData:b});c.onSuccess=function(m){a.originalData=m.minutas;var f=[];var l=[];var d=[];var q=[{Ticker:"Todos",Descripcion:"Todos"}];var p=[{Plazo:"Todos",Descripcion:"Todos"}];var o=[{UsuarioOperador:"Todos",Descripcion:"Todos"}];var n=[{Moneda:"Todos",Descripcion:"Todos"}];var e=[{EsCruce:"Todos",Descripcion:"Todos"}];$.each(a.originalData,function(r,s){if(!($.grep(q,function(v,u){return v.Ticker==s.Ticker})[0])){q.push({Ticker:s.Ticker,Descripcion:s.Ticker})}if(!($.grep(p,function(u,t){return u.Plazo==s.Plazo})[0])){p.push({Plazo:s.Plazo,Descripcion:s.Plazo})}if(!($.grep(o,function(u,t){return u.UsuarioOperador==s.UsuarioOperador})[0])){o.push({UsuarioOperador:s.UsuarioOperador,Descripcion:(s.UsuarioOperador?s.UsuarioOperador:"No definido")})}if(!($.grep(n,function(u,t){return u.Moneda==s.Moneda})[0])){n.push({Moneda:s.Moneda,Descripcion:s.Moneda})}if(!($.grep(e,function(t,u){return t.EsCruce==s.EsCruce})[0])){e.push({EsCruce:s.EsCruce,Descripcion:Core.Functions.grid.formatBoolean(s.EsCruce)})}if(f.indexOf(s.Estado)<0){f.push(s.Estado)}if(l.indexOf(s.Mercado)<0){l.push(s.Mercado)}if(!($.grep(d,function(t,u){return t.LeyendaColor==s.LeyendaColor})[0])){d.push({Color:s.Color,LeyendaColor:s.LeyendaColor})}});a.divEstados.empty();$.each(f,function(s,u){var r=$.grep(a.originalData,function(w,v){return w.Estado==u}).length;var t=$("<label class='lblEstadoContador' style='background-color:"+((a.estadosActivos[u]==false)?"transparent":"lightblue")+"; margin: 8px 6px 8px 0; padding: 4px 5px; border: 1px solid #ccc;  font-weight: normal;' activo='"+((a.estadosActivos[u]==false)?"false":"true")+"' estado='"+u+"'>"+u+": <strong style='color: #333;'>"+r+"</strong></label>").appendTo(a.divEstados);if(a.estadosActivos[u]==null){a.estadosActivos[u]=true}t.on("click",function(){a.setEstado(t)})});a.divMercados.empty();$.each(l,function(s,u){var r=$.grep(a.originalData,function(w,v){return w.Mercado==u}).length;var t=$("<label class='lblMercadoContador' style='background-color: "+((a.mercadosActivos[u]==false)?"transparent":"lightblue")+"; margin: 8px 6px 8px 0; padding: 4px 5px; border: 1px solid #ccc;  font-weight: normal;' activo='"+((a.mercadosActivos[u]==false)?"false":"true")+"' mercado='"+u+"'>"+u+": <strong style='color: #333;'>"+r+"</strong></label>").appendTo(a.divMercados);if(a.mercadosActivos[u]==null){a.mercadosActivos[u]=true}t.on("click",function(){a.setMercado(t)})});a.divColores.empty();d.forEach(function(t,s){var r=$.grep(a.originalData,function(w,v){return w.Color==t.Color}).length;var u=$('<label class="lblColorContador" color="'+t.Color+'" activo="'+((a.coloresActivos[t.Color]==false)?"false":"true")+'" style="color: #2d2d2d !important; border-radius:4px; margin-right:3px; border: 4px solid '+(t.Color?t.Color:"transparent")+"; background-color:"+((a.coloresActivos[t.Color]==false)?"#c4c4c4":t.Color)+';">'+t.LeyendaColor+': <strong style="color: #333;">'+r+"</strong></label>").appendTo(a.divColores);if(a.coloresActivos[t.Color]==null){a.coloresActivos[t.Color]=true}u.on("click",function(){a.setColor(u)})});var k=a.ddlTicker.swidget().initialOptions;k.dataSource.data=q;k.value=a.ddlTicker.swidget().value()?a.ddlTicker.swidget().value():"Todos";a.ddlTicker.swidget().refresh(k);var j=a.ddlPlazo.swidget().initialOptions;j.dataSource.data=p;j.value=a.ddlPlazo.swidget().value()?a.ddlPlazo.swidget().value():"Todos";a.ddlPlazo.swidget().refresh(j);var h=a.ddlMoneda.swidget().initialOptions;h.dataSource.data=n;h.value=a.ddlMoneda.swidget().value()?a.ddlMoneda.swidget().value():"Todos";a.ddlMoneda.swidget().refresh(h);var g=a.ddlCruce.swidget().initialOptions;g.dataSource.data=e;g.value=a.ddlCruce.swidget().value()?a.ddlCruce.swidget().value():"Todos";a.ddlCruce.swidget().refresh(g);var i=a.ddlOperador.swidget().initialOptions;i.dataSource.data=o;i.value=a.ddlOperador.swidget().value()?a.ddlOperador.swidget().value():"Todos";a.ddlOperador.swidget().refresh(i);a.refreshGrid()};c.request()};a.hexToRgb=function(d){d=d.replace("#","");var f=parseInt(d.substring(0,2),16);var e=parseInt(d.substring(2,4),16);var c=parseInt(d.substring(4,6),16);var h=f+","+e+","+c;return h};a.setEstado=function(b){if(b.attr("activo")=="true"){b.css("background-color","transparent");b.attr("activo","false");a.estadosActivos[b.attr("estado")]=false}else{b.css("background-color","lightblue");b.attr("activo","true");a.estadosActivos[b.attr("estado")]=true}a.refreshGrid()};a.setMercado=function(b){if(b.attr("activo")=="true"){b.css("background-color","transparent");b.attr("activo","false");a.mercadosActivos[b.attr("mercado")]=false}else{b.css("background-color","lightblue");b.attr("activo","true");a.mercadosActivos[b.attr("mercado")]=true}a.refreshGrid()};a.setColor=function(b){if(b.attr("activo")=="true"){b.css("background-color","#c4c4c4");b.attr("activo","false");a.coloresActivos[b.attr("color")]=false}else{b.css("background-color",b.attr("color"));b.attr("activo","true");a.coloresActivos[b.attr("color")]=true}a.refreshGrid()};a.refreshGrid=function(){var c=$.grep(a.originalData,function(k,j){return true});var g=$(".lblEstadoContador");for(var d=0;d<g.length;d++){var f=$(g[d]);if(f.attr("activo")=="false"){c=$.grep(c,function(k,j){return k.Estado!=f.attr("estado")})}}var g=$(".lblMercadoContador");for(var d=0;d<g.length;d++){var f=$(g[d]);if(f.attr("activo")=="false"){c=$.grep(c,function(k,j){return k.Mercado!=f.attr("mercado")})}}var b=$(".lblColorContador");for(var d=0;d<b.length;d++){var f=$(b[d]);if(f.attr("activo")=="false"){c=$.grep(c,function(k,j){return k.Color!=f.attr("color")})}}if(a.ddlTicker.swidget().selectedItem()&&a.ddlTicker.swidget().selectedItem().Ticker!="Todos"){c=$.grep(c,function(k,j){return k.Ticker==a.ddlTicker.swidget().selectedItem().Ticker})}if(a.ddlPlazo.swidget().selectedItem()&&a.ddlPlazo.swidget().selectedItem().Plazo!="Todos"){c=$.grep(c,function(k,j){return k.Plazo==a.ddlPlazo.swidget().selectedItem().Plazo})}if(a.ddlMoneda.swidget().selectedItem()&&a.ddlMoneda.swidget().selectedItem().Moneda!="Todos"){c=$.grep(c,function(k,j){return k.Moneda==a.ddlMoneda.swidget().selectedItem().Moneda})}if(a.ddlCruce.swidget().selectedItem()&&a.ddlCruce.swidget().selectedItem().EsCruce!="Todos"){c=$.grep(c,function(k,j){return k.EsCruce==a.ddlCruce.swidget().selectedItem().EsCruce})}if(a.ddlOperador.swidget().selectedItem()&&a.ddlOperador.swidget().selectedItem().UsuarioOperador!="Todos"){c=$.grep(c,function(k,j){return k.UsuarioOperador==a.ddlOperador.swidget().selectedItem().UsuarioOperador})}var h=a.window.scrollTop();var e=a.divMinutas.swidget().initialOptions;e.dataSource.data=c;e.dataSource.group=a.divMinutas.swidget().dataSource.group;e.exportOptions.excel.dataSource.data=c;e.exportOptions.excel.readDataSource=true;a.divMinutas.swidget().refresh(e);a.window.scrollTop(h);a.loaded=true;a.txtFilter.keydown()};a.rechazarMinuta=function(b,d,c){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea rechazar la minuta con ID: "+b.idMinuta+"?",{onAccepted:function(){var e={idMinuta:b.idMinuta,ContinuarFlujoFeliz:0,VersionActual:b.VersionActual};var f=new Core.Ajax.ServerRequest({overlayElement:c,secureRequest:true,requestUrl:d,requestType:"PUT",requestData:e});f.onSuccess=function(h){var g=new Core.Controls.Dialog("Mensaje",((h.Descripcion)?h.Descripcion:"Minuta: "+b.idMinuta+" actualizada OK."),{displayButtons:{close:true,accept:false}});g.show();a.loaded=false;a.loadGrid()};f.request()}}).show()};a.aprobarMinuta=function(b,e,c){var d={idMinuta:b.idMinuta,ContinuarFlujoFeliz:1,VersionActual:b.VersionActual};var f=new Core.Ajax.ServerRequest({overlayElement:c,secureRequest:true,requestUrl:e,requestType:"PUT",requestData:d});f.onSuccess=function(g){a.loaded=false;a.loadGrid()};f.request()}};Core.Business.MinutasVersion2Gestion.Actualizar=function(b){var a=this;a.container=null;a.lblTitle=null;a.divAdvertencias=null;a.lblFechaCarga=null;a.lblIngreso=null;a.lblAsesor=null;a.lblOperador=null;a.lblUltimaActualizacion=null;a.lblEstado=null;a.lblMercado=null;a.divCuenta=null;a.lblComitente=null;a.ddlMoneda=null;a.divControlMoneda=null;a.lblMoneda=null;a.divLabelMoneda=null;a.lblFechaConcertacion=null;a.divFechaLiquidacion=null;a.lblFechaLiquidacion=null;a.lblDescripcionComitente=null;a.lblConAsesor=null;a.lblDescripcionAsesor=null;a.ddlTipoOperacion=null;a.divControlTipoOperacion=null;a.lblTipoOperacion=null;a.divLabelTipoOperacion=null;a.divTicker=null;a.lblTicker=null;a.divPlazo=null;a.ddlPlazo=null;a.divControlPlazo=null;a.lblPlazo=null;a.divLabelPlazo=null;a.divCantidad=null;a.divControlCantidad=null;a.txtCantidad=null;a.divLabelCantidad=null;a.lblCantidad=null;a.divPrecioReferencia=null;a.divControlPrecioReferencia=null;a.txtPrecioReferencia=null;a.divLabelPrecioReferencia=null;a.lblPrecioReferencia=null;a.divPrecioProductor=null;a.divControlPrecioProductor=null;a.txtPrecioProductor=null;a.divLabelPrecioProductor=null;a.lblPrecioProductor=null;a.divPrecio=null;a.divControlPrecio=null;a.txtPrecio=null;a.divLabelPrecio=null;a.lblPrecio=null;a.divMonto=null;a.divControlMonto=null;a.txtMonto=null;a.divLabelMonto=null;a.lblMonto=null;a.divCorredor=null;a.ddlCorredor=null;a.divControlCorredor=null;a.lblCorredor=null;a.divLabelCorredor=null;a.chkComision=null;a.divComision=null;a.divControlComision=null;a.lblComision=null;a.divLabelComision=null;a.divCruce=null;a.chkCruce=null;a.divControlCruce=null;a.lblCruce=null;a.divLabelCruce=null;a.divIdExterno=null;a.txtIdExterno=null;a.divControlIdExterno=null;a.lblIdExterno=null;a.divLabelIdExterno=null;a.divCantidadDias=null;a.divControlCantidadDias=null;a.txtCantidadDias=null;a.divLabelCantidadDias=null;a.lblCantidadDias=null;a.divTasa=null;a.divControlTasa=null;a.txtTasa=null;a.divLabelTasa=null;a.lblTasa=null;a.ddlCuentaBalanz=null;a.divControlCuentaBalanz=null;a.lblCuentaBalanz=null;a.divContado=null;a.chkContado=null;a.divControlContado=null;a.lblContado=null;a.divLabelContado=null;a.divLabelCuentaBalanz=null;a.divCuentaVueltaContado=null;a.lblCuentaVueltaContado=null;a.btnBuscarCuentaVueltaContado=null;a.txtObservaciones=null;a.divControlCruce=null;a.lblCruce=null;a.divLabelCruce=null;a.divIdOperacionMesa=null;a.lblIdOperacionMesa=null;a.divIdContraparte=null;a.lblIdContraparte=null;a.divDescripcionContraparte=null;a.lblDescripcionContraparte=null;a.minuta=null;a.readOnly=false;a.actualizarEstadoInicial=true;a.onSave=function(){};a.onLoad=function(){};a.onClosed=function(){};a.requestUrl=null;a.selectedAccount=null;a.dataSelectedAccount=null;a.obtenerPreciosData=null;a.selectedCuentaVueltaContado=null;$.extend(true,a,b);a.show=function(){var c=new Core.Ajax.ServerRequest({allowCache:true,overlayElement:a.overlayElement,showOverlay:true,requestUrl:"minutas/version2/corredores",requestType:"GET"});c.onSuccess=function(d){var e=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,showOverlay:true,requestUrl:"minutas/version2/mensajes/"+a.minuta.idMinuta,requestType:"GET"});e.onSuccess=function(f){var g=new Core.Ajax.ServerRequest({allowCache:true,overlayElement:a.overlayElement,showOverlay:true,secureRequest:true,requestUrl:"minutas/version2/cuentasbalanz",requestType:"GET"});g.onSuccess=function(h){a.lblTitle=a.container.find(".title");a.lblTitle.text("Detalles Minuta: "+a.minuta.idMinuta);a.divAlertLock=a.container.find(".div-minuta-alert-lock");a.divAlertLock.empty();a.divAlertLock.hide();if(f&&f.AlertaLock&&f.AlertaLock.length){$('<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"><p><strong>Alert Lock</strong></p></div>').appendTo(a.divAlertLock);f.AlertaLock.forEach(function(k,j){$('<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"><p style="font-size:18px; color:'+(k.Color?k.Color:"")+' !important;"><i style="margin-right:5px;" class="fa fa-exclamation-circle" aria-hidden="true"></i>'+k.Alerta+"</p></div>").appendTo(a.divAlertLock)});a.divAlertLock.show()}a.divAdvertencias=a.container.find(".div-minuta-advertencias");a.divAdvertencias.empty();a.divAdvertencias.hide();if(f&&f.Mensajes&&f.Mensajes.length){$('<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"><p><strong>Advertencias</strong></p></div>').appendTo(a.divAdvertencias);f.Mensajes.forEach(function(k,j){$('<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"><p>'+k.Mensaje+"</p></div>").appendTo(a.divAdvertencias)});a.divAdvertencias.show()}a.lblFechaCarga=a.container.find(".label-minuta-fecha-carga");a.lblIngreso=a.container.find(".label-minuta-ingreso");a.lblAsesor=a.container.find(".label-minuta-asesor");a.lblOperador=a.container.find(".label-minuta-operador");a.lblUltimaActualizacion=a.container.find(".label-minuta-ultima-actualizacion");a.lblEstado=a.container.find(".label-minuta-estado");a.lblMercado=a.container.find(".label-minuta-mercado");a.divCuenta=a.container.find(".div-minuta-cuenta");a.lblComitente=a.container.find(".label-minuta-comitente");a.ddlMoneda=a.container.find(".dropdown-minuta-moneda");a.divControlMoneda=a.container.find(".div-control-moneda");a.lblMoneda=a.container.find(".label-minuta-moneda");a.divLabelMoneda=a.container.find(".div-label-moneda");a.lblFechaConcertacion=a.container.find(".label-minuta-fecha-concertacion");a.divFechaLiquidacion=a.container.find(".div-minuta-fecha-liquidacion");a.lblFechaLiquidacion=a.container.find(".label-minuta-fecha-liquidacion");a.lblDescripcionComitente=a.container.find(".label-minuta-descripcion-comitente");a.divDescripcionAsesor=a.container.find(".div-minuta-descripcion-asesor");a.lblDescripcionAsesor=a.container.find(".label-minuta-descripcion-asesor");a.divConAsesor=a.container.find(".div-minuta-con-asesor");a.lblConAsesor=a.container.find(".label-minuta-con-asesor");a.ddlTipoOperacion=a.container.find(".dropdown-minuta-tipo-operacion");a.divControlTipoOperacion=a.container.find(".div-control-tipo-operacion");a.lblTipoOperacion=a.container.find(".label-minuta-tipo-operacion");a.divLabelTipoOperacion=a.container.find(".div-label-tipo-operacion");a.divTicker=a.container.find(".div-minuta-ticker");a.lblTicker=a.container.find(".label-minuta-ticker");a.divPlazo=a.container.find(".div-minuta-plazo");a.ddlPlazo=a.container.find(".dropdown-minuta-plazo");a.divControlPlazo=a.container.find(".div-control-plazo");a.lblPlazo=a.container.find(".label-minuta-plazo");a.divLabelPlazo=a.container.find(".div-label-plazo");a.divCantidad=a.container.find(".div-minuta-cantidad");a.txtCantidad=a.container.find(".textbox-minuta-cantidad");a.divControlCantidad=a.container.find(".div-control-cantidad");a.lblCantidad=a.container.find(".label-minuta-cantidad");a.divLabelCantidad=a.container.find(".div-label-cantidad");a.divPrecio=a.container.find(".div-minuta-precio");a.txtPrecio=a.container.find(".textbox-minuta-precio");a.divControlPrecio=a.container.find(".div-control-precio");a.lblPrecio=a.container.find(".label-minuta-precio");a.divLabelPrecio=a.container.find(".div-label-precio");a.divPrecioReferencia=a.container.find(".div-minuta-precio-referencia");a.txtPrecioReferencia=a.container.find(".textbox-minuta-precio-referencia");a.divControlPrecioReferencia=a.container.find(".div-control-precio-referencia");a.lblPrecioReferencia=a.container.find(".label-minuta-precio-referencia");a.divLabelPrecioReferencia=a.container.find(".div-label-precio-referencia");a.divPrecioProductor=a.container.find(".div-minuta-precio-productor");a.txtPrecioProductor=a.container.find(".textbox-minuta-precio-productor");a.divControlPrecioProductor=a.container.find(".div-control-precio-productor");a.lblPrecioProductor=a.container.find(".label-minuta-precio-productor");a.divLabelPrecioProductor=a.container.find(".div-label-precio-productor");a.divMonto=a.container.find(".div-minuta-monto");a.txtMonto=a.container.find(".textbox-minuta-monto");a.divControlMonto=a.container.find(".div-control-monto");a.lblMonto=a.container.find(".label-minuta-monto");a.divLabelMonto=a.container.find(".div-label-monto");a.divCorredor=a.container.find(".div-minuta-corredor");a.ddlCorredor=a.container.find(".dropdown-minuta-corredor");a.divControlCorredor=a.container.find(".div-control-corredor");a.lblCorredor=a.container.find(".label-minuta-corredor");a.divLabelCorredor=a.container.find(".div-label-corredor");a.divComision=a.container.find(".div-minuta-comision");a.chkComision=a.container.find(".checkbox-minuta-comision");a.divControlComision=a.container.find(".div-control-comision");a.lblComision=a.container.find(".label-minuta-comision");a.divLabelComision=a.container.find(".div-label-comision");a.divCruce=a.container.find(".div-minuta-cruce");a.chkCruce=a.container.find(".checkbox-minuta-cruce");a.divControlCruce=a.container.find(".div-control-cruce");a.lblCruce=a.container.find(".label-minuta-cruce");a.divLabelCruce=a.container.find(".div-label-cruce");a.divIdExterno=a.container.find(".div-minuta-id-externo");a.txtIdExterno=a.container.find(".textbox-minuta-id-externo");a.divControlIdExterno=a.container.find(".div-control-id-externo");a.lblIdExterno=a.container.find(".label-minuta-id-externo");a.divLabelIdExterno=a.container.find(".div-label-id-externo");a.divCantidadDias=a.container.find(".div-minuta-cantidad-dias");a.txtCantidadDias=a.container.find(".textbox-minuta-cantidad-dias");a.divControlCantidadDias=a.container.find(".div-control-cantidad-dias");a.lblCantidadDias=a.container.find(".label-minuta-cantidad-dias");a.divLabelCantidadDias=a.container.find(".div-label-cantidad-dias");a.divIdOperacionMesa=a.container.find(".div-minuta-id-operacion-mesa");a.lblIdOperacionMesa=a.container.find(".label-minuta-id-operacion-mesa");a.divIdContraparte=a.container.find(".div-minuta-id-contraparte");a.lblIdContraparte=a.container.find(".label-minuta-id-contraparte");a.divDescripcionContraparte=a.container.find(".div-minuta-descripcion-contraparte");a.lblDescripcionContraparte=a.container.find(".label-minuta-descripcion-contraparte");new Core.Controls.DecimalPicker(a.txtCantidadDias,{maxDecimalDigitCount:0,showThousandsSeparator:"",defaultValue:(a.minuta.CantidadDiasPrestamo)?a.minuta.CantidadDiasPrestamo:""});a.lblCantidadDias.text(Core.Functions.grid.formatIntegerNumber((a.minuta.CantidadDiasPrestamo)?a.minuta.CantidadDiasPrestamo:""));a.setActiveDiv(a.divControlCantidadDias,a.divLabelCantidadDias,(!a.readOnly&&a.actualizarEstadoInicial&&a.minuta.idMercado==Core.Enums.eMinutaMercado.PrestamoEfectivo));a.divTasa=a.container.find(".div-minuta-tasa");a.txtTasa=a.container.find(".textbox-minuta-tasa");a.divControlTasa=a.container.find(".div-control-tasa");a.lblTasa=a.container.find(".label-minuta-tasa");a.divLabelTasa=a.container.find(".div-label-tasa");new Core.Controls.DecimalPicker(a.txtTasa,{maxDecimalDigitCount:10,showThousandsSeparator:true,defaultValue:(a.minuta.TasaPrestamo)?a.minuta.TasaPrestamo:""});a.lblTasa.text(Core.Functions.grid.formatNumberWithDecimals((a.minuta.TasaPrestamo)?a.minuta.TasaPrestamo:""));a.setActiveDiv(a.divControlTasa,a.divLabelTasa,(!a.readOnly&&a.actualizarEstadoInicial&&a.minuta.idMercado==Core.Enums.eMinutaMercado.PrestamoEfectivo));a.ddlCuentaBalanz=a.container.find(".dropdown-minuta-cuenta-balanz");a.divControlCuentaBalanz=a.container.find(".div-control-cuenta-balanz");a.lblCuentaBalanz=a.container.find(".label-minuta-cuenta-balanz");a.divLabelCuentaBalanz=a.container.find(".div-label-cuenta-balanz");a.divContado=a.container.find(".div-minuta-contado");a.chkContado=a.container.find(".checkbox-minuta-contado");a.divControlContado=a.container.find(".div-control-contado");a.lblContado=a.container.find(".label-minuta-contado");a.divLabelContado=a.container.find(".div-label-contado");a.divCuentaVueltaContado=a.container.find(".div-minuta-cuenta-vuelta-contado");a.lblCuentaVueltaContado=a.container.find(".label-minuta-cuenta-vuelta-contado");a.btnBuscarCuentaVueltaContado=a.container.find(".button-buscar-cuenta-vuelta-contado");a.txtObservaciones=a.container.find(".textbox-minuta-observaciones");a.divControlObservaciones=a.container.find(".div-control-observaciones");a.lblObservaciones=a.container.find(".label-minuta-observaciones");a.divLabelObservaciones=a.container.find(".div-label-observaciones");a.lblFechaCarga.text((a.minuta.FechaOHora)?a.minuta.FechaOHora:"");a.lblIngreso.text((a.minuta.UsuarioIngreso)?a.minuta.UsuarioIngreso:"");a.lblAsesor.text((a.minuta.UsuarioAsesor)?a.minuta.UsuarioAsesor:"");a.lblOperador.text((a.minuta.UsuarioOperador)?a.minuta.UsuarioOperador:"");a.lblUltimaActualizacion.text((a.minuta.FechaUltimaActualizacion)?a.minuta.FechaUltimaActualizacion:"");a.lblEstado.text((a.minuta.Estado)?a.minuta.Estado:"");a.lblMercado.text((a.minuta.Mercado)?a.minuta.Mercado:"");a.lblComitente.text((a.minuta.NumComitente)?Core.Functions.grid.formatIntegerNumber(a.minuta.NumComitente):"No ingresado");a.ddlMoneda.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{idMoneda}",enabled:!a.readOnly&&a.actualizarEstadoInicial,value:(a.minuta&&a.minuta.idMoneda!=null)?a.minuta.idMoneda.toString():""});a.lblMoneda.text((a.minuta.Moneda)?a.minuta.Moneda:"");a.setActiveDiv(a.divControlMoneda,a.divLabelMoneda,(!a.readOnly&&a.actualizarEstadoInicial));a.lblFechaConcertacion.text((a.minuta.FechaConcertacion)?a.minuta.FechaConcertacion:"");a.lblFechaLiquidacion.text((a.minuta.FechaLiquidacion)?a.minuta.FechaLiquidacion:"");a.lblDescripcionComitente.text((a.minuta.DescripcionComitente)?a.minuta.DescripcionComitente:"No ingresado");a.lblDescripcionAsesor.text((a.minuta.AsesorDescripcion)?a.minuta.AsesorDescripcion:"");a.lblConAsesor.text((a.minuta.ConAsesor==1)?"SI":"NO");a.ddlTipoOperacion.shieldDropDown({dataSource:{data:[{value:Core.Enums.eMinutaTipoOperacion.Compra,text:"Compra"},{value:Core.Enums.eMinutaTipoOperacion.Venta,text:"Venta"}]},textTemplate:"{text}",valueTemplate:"{value}",value:(a.minuta&&a.minuta.idTipoOperacion!=null)?a.minuta.idTipoOperacion.toString():"",enabled:!a.readOnly&&a.actualizarEstadoInicial});a.lblTipoOperacion.text((a.minuta.Operacion)?a.minuta.Operacion:"");a.setActiveDiv(a.divControlTipoOperacion,a.divLabelTipoOperacion,(!a.readOnly&&a.actualizarEstadoInicial));a.lblTicker.text((a.minuta.Ticker)?a.minuta.Ticker:"");a.ddlPlazo.shieldDropDown({dataSource:{data:[{value:Core.Enums.ePlazo.CI,text:"CI"},{value:Core.Enums.ePlazo.D24,text:"24 hs."},{value:Core.Enums.ePlazo.D48,text:"48 hs."}]},textTemplate:"{text}",valueTemplate:"{value}",value:(a.minuta&&a.minuta.idPlazo!=null)?a.minuta.idPlazo.toString():"",enabled:!a.readOnly&&a.actualizarEstadoInicial});a.lblPlazo.text((a.minuta.Plazo)?a.minuta.Plazo:"");a.setActiveDiv(a.divControlPlazo,a.divLabelPlazo,(!a.readOnly&&a.actualizarEstadoInicial));new Core.Controls.DecimalPicker(a.txtCantidad,{maxDecimalDigitCount:10,showThousandsSeparator:true,defaultValue:(a.minuta.Cantidad)?a.minuta.Cantidad:"",onChange:function(){a.setTotalOperacion()}});a.lblCantidad.text(Core.Functions.grid.formatNumberWithDecimals((a.minuta.Cantidad)?a.minuta.Cantidad:""));a.setActiveDiv(a.divControlCantidad,a.divLabelCantidad,(!a.readOnly&&a.actualizarEstadoInicial));new Core.Controls.DecimalPicker(a.txtPrecioReferencia,{maxDecimalDigitCount:10,showThousandsSeparator:true,defaultValue:(a.minuta.PrecioReferencia)?a.minuta.PrecioReferencia:""});a.lblPrecioReferencia.text(Core.Functions.grid.formatNumberWithDecimals((a.minuta.PrecioReferencia)?a.minuta.PrecioReferencia:""));a.setActiveDiv(a.divControlPrecioReferencia,a.divLabelPrecioReferencia,(!a.readOnly&&(a.actualizarEstadoInicial||Core.Objects.Context.Configuration.idAplicacion==6)));new Core.Controls.DecimalPicker(a.txtPrecioProductor,{maxDecimalDigitCount:10,showThousandsSeparator:true,defaultValue:(a.minuta.PrecioProductor)?a.minuta.PrecioProductor:""});a.lblPrecioProductor.text(Core.Functions.grid.formatNumberWithDecimals((a.minuta.PrecioProductor)?a.minuta.PrecioProductor:""));a.setActiveDiv(a.divControlPrecioProductor,a.divLabelPrecioProductor,(!a.readOnly&&Core.Objects.Context.Configuration.idAplicacion==0));new Core.Controls.DecimalPicker(a.txtPrecio,{maxDecimalDigitCount:10,showThousandsSeparator:true,defaultValue:(a.minuta.Precio)?a.minuta.Precio:"",onChange:function(){a.setTotalOperacion()}});a.lblPrecio.text(Core.Functions.grid.formatNumberWithDecimals((a.minuta.Precio)?a.minuta.Precio:""));a.setActiveDiv(a.divControlPrecio,a.divLabelPrecio,(!a.readOnly&&a.actualizarEstadoInicial));new Core.Controls.DecimalPicker(a.txtMonto,{maxDecimalDigitCount:10,showThousandsSeparator:true,defaultValue:(a.minuta.Monto)?a.minuta.Monto:""});a.lblMonto.text(Core.Functions.grid.formatNumberWithDecimals((a.minuta.Monto)?a.minuta.Monto:""));a.setActiveDiv(a.divControlMonto,a.divLabelMonto,(!a.readOnly&&a.actualizarEstadoInicial&&a.minuta.idMercado==Core.Enums.eMinutaMercado.PrestamoEfectivo));d.corredores.unshift({idCorredor:0,Descripcion:"Sin Corredor"});a.ddlCorredor.shieldDropDown({dataSource:{data:d.corredores},textTemplate:"{Descripcion}",valueTemplate:"{idCorredor}",value:(a.minuta&&a.minuta.idCorredor!=null)?a.minuta.idCorredor.toString():"",enabled:(!a.readOnly&&(a.actualizarEstadoInicial||Core.Objects.Context.Configuration.idAplicacion==6)),events:{select:function(i){a.setControlsByCorredor()}}});a.lblCorredor.text((a.minuta.Corredor)?a.minuta.Corredor:"Sin Corredor");a.setActiveDiv(a.divControlCorredor,a.divLabelCorredor,(!a.readOnly&&(a.actualizarEstadoInicial||Core.Objects.Context.Configuration.idAplicacion==6)));a.chkComision.shieldCheckBox({label:""});a.chkComision.swidget().checked(((a.minuta&&a.minuta.Comision!=null)?(a.minuta.Comision==1):true));a.chkComision.swidget().enabled((!a.readOnly&&(a.actualizarEstadoInicial||Core.Objects.Context.Configuration.idAplicacion==6)));a.lblComision.text((a.minuta.Comision==1)?"SI":"NO");a.setActiveDiv(a.divControlComision,a.divLabelComision,(!a.readOnly&&(a.actualizarEstadoInicial||Core.Objects.Context.Configuration.idAplicacion==6)));a.chkCruce.shieldCheckBox({label:""});a.chkCruce.swidget().checked(((a.minuta&&a.minuta.EsCruce!=null)?(a.minuta.EsCruce==1):true));a.chkCruce.swidget().enabled((!a.readOnly&&(a.actualizarEstadoInicial||Core.Objects.Context.Configuration.idAplicacion==6)));a.lblCruce.text((a.minuta.EsCruce==1)?"SI":"NO");a.setActiveDiv(a.divControlCruce,a.divLabelCruce,(!a.readOnly&&(a.actualizarEstadoInicial||Core.Objects.Context.Configuration.idAplicacion==6)));a.txtIdExterno.shieldTextBox({});a.txtIdExterno.swidget().value((a.minuta&&a.minuta.CodMercadoExterno!=null)?a.minuta.CodMercadoExterno:"");a.txtIdExterno.swidget().enabled((!a.readOnly&&(!a.actualizarEstadoInicial&&Core.Objects.Context.Configuration.idAplicacion==3)));a.lblIdExterno.text((a.minuta.CodMercadoExterno)?a.minuta.CodMercadoExterno:"");a.setActiveDiv(a.divControlIdExterno,a.divLabelIdExterno,(!a.readOnly&&(!a.actualizarEstadoInicial&&Core.Objects.Context.Configuration.idAplicacion==3)));a.ddlCuentaBalanz.shieldComboBox({dataSource:{data:h.cuentas},valueTemplate:"{idCuentaBalanz}",textTemplate:"{CuentaBalanz}",value:(a.minuta&&a.minuta.idCuentaBalanz!=null)?a.minuta.idCuentaBalanz.toString():"",autoComplete:{enabled:true,filter:{or:[{path:"CuentaBalanz",filter:"contains",value:""}]}},events:{focus:function(i){var j=a.ddlCuentaBalanz.swidget().initialOptions;j.value="";a.ddlCuentaBalanz.swidget().refresh(j);a.ddlCuentaBalanz.swidget().focus()}}});a.lblCuentaBalanz.text((a.minuta.CuentaBalanz)?a.minuta.CuentaBalanz:"No definido");a.setActiveDiv(a.divControlCuentaBalanz,a.divLabelCuentaBalanz,(!a.readOnly&&(a.actualizarEstadoInicial||Core.Objects.Context.Configuration.idAplicacion==0||Core.Objects.Context.Configuration.idAplicacion==6)));a.chkContado.shieldCheckBox({label:"",events:{click:function(i){a.setCuentaVueltaContado()}}});a.chkContado.swidget().checked(((a.minuta&&a.minuta.esContado!=null)?(a.minuta.esContado==1):true));a.chkContado.swidget().enabled(!a.readOnly);a.lblContado.text((a.minuta.esContado==1)?"SI":"NO");a.setActiveDiv(a.divControlContado,a.divLabelContado,!a.readOnly);a.lblCuentaVueltaContado.text((a.minuta.CuentaContadoVuelta)?a.minuta.CuentaContadoVuelta:"No definido");a.btnBuscarCuentaVueltaContado.unbind("click");a.btnBuscarCuentaVueltaContado.on("click",function(){new Core.Controls.MinutaBuscarCuenta({onSelected:function(i){a.selectedCuentaVueltaContado=i;a.lblCuentaVueltaContado.text(a.selectedCuentaVueltaContado.idCuenta+" | "+a.selectedCuentaVueltaContado.Descripcion)}}).show()});a.txtObservaciones.shieldTextBox({});a.txtObservaciones.swidget().value((a.minuta&&a.minuta.Observaciones!=null)?a.minuta.Observaciones:"");a.txtObservaciones.swidget().enabled((!a.readOnly&&(a.minuta&&!a.minuta.MinutaFinalizada)));a.lblObservaciones.text((a.minuta.Observaciones)?a.minuta.Observaciones:"");a.setActiveDiv(a.divControlObservaciones,a.divLabelObservaciones,(!a.readOnly&&(a.minuta&&!a.minuta.MinutaFinalizada)));a.lblIdOperacionMesa.text((a.minuta.idOperacionMesa)?a.minuta.idOperacionMesa:"");a.lblIdContraparte.text((a.minuta.idContraparte)?a.minuta.idContraparte:"");a.lblDescripcionContraparte.text((a.minuta.DescripcionContraparte)?a.minuta.DescripcionContraparte:"");a.btnConfirmar=a.container.find(".btn-confirmar");a.btnConfirmar.unbind("click");a.btnConfirmar.click(function(){a.save(a.btnConfirmar,function(){a.onSave();a.destroy()},false)});a.btnConfirmarYAvanzar=a.container.find(".btn-confirmar-avanzar");a.btnConfirmarYAvanzar.unbind("click");a.btnConfirmarYAvanzar.click(function(){a.save(a.btnConfirmarYAvanzar,function(){a.onSave();a.destroy()},true)});a.btnAnular=a.container.find(".btn-anular");a.btnAnular.unbind("click");a.btnAnular.click(function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea rechazar la minuta con ID: "+a.minuta.idMinuta+"?",{onAccepted:function(){var i={idMinuta:a.minuta.idMinuta,ContinuarFlujoFeliz:0,VersionActual:a.minuta.VersionActual};var j=new Core.Ajax.ServerRequest({overlayElemet:a.btnAnular,secureRequest:true,requestUrl:a.requestUrl,requestType:"PUT",requestData:i});j.onSuccess=function(k){a.onSave();a.destroy()};j.request()}}).show()});a.btnVolver=a.container.find(".btn-detalle-minuta-volver");a.btnVolver.unbind("click");a.btnVolver.on("click",function(){a.destroy()});a.btnConfirmarYAvanzar.show();a.btnAnular.show();a.btnConfirmar.show();a.btnBuscarCuentaVueltaContado.show();if(a.actualizarEstadoInicial){a.btnConfirmarYAvanzar.hide();a.btnAnular.hide()}if(a.readOnly){a.btnConfirmarYAvanzar.hide();a.btnAnular.hide();a.btnConfirmar.hide();a.btnBuscarCuentaVueltaContado.hide()}a.btnBuscarCuenta=a.container.find(".button-buscar-cuentas");a.btnBuscarCuenta.unbind("click");a.btnBuscarCuenta.click(function(){new Core.Controls.MinutaBuscarCuenta({onSelected:function(i){a.selectedAccount=i;a.lblComitente.text((a.selectedAccount&&a.selectedAccount.NumComitente)?Core.Functions.grid.formatIntegerNumber(a.selectedAccount.NumComitente):"");a.lblDescripcionComitente.text((a.selectedAccount&&a.selectedAccount.Descripcion)?a.selectedAccount.Descripcion:"");a.getDataAccount()}}).show()});a.btnBuscarCuenta.hide();if(!a.readOnly&&(a.actualizarEstadoInicial||Core.Objects.Context.Configuration.idAplicacion==0)){a.btnBuscarCuenta.show()}a.getDataAccount();a.onLoad()};g.request()};e.request()};c.request()};a.getDataAccount=function(){a.dataSelectedAccount=null;if(Core.Objects.Context.Configuration.idAplicacion==0&&(a.selectedAccount||a.minuta.idCuenta)){var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"datoscuenta/"+encodeURIComponent(a.selectedAccount?a.selectedAccount.idCuenta:a.minuta.idCuenta),requestType:"GET"});c.onSuccess=function(d){a.dataSelectedAccount=d;a.setControls()};c.request()}else{a.setControls()}};a.setTotalOperacion=function(){var c=0;if(a.txtCantidad.val()!=""&&a.txtPrecio.val()!=""){c=(Core.Functions.Decimal.parseFloat(a.txtCantidad.val())*Core.Functions.Decimal.parseFloat(a.txtPrecio.val())).toFixed(6)}a.txtMonto.val(c);a.txtMonto.blur()};a.save=function(f,e,c){var g={idMinuta:a.minuta.idMinuta,VersionActual:a.minuta.VersionActual,};if(c){g.ContinuarFlujoFeliz=1}if(a.actualizarEstadoInicial){g.idTipoOperacion=((a.ddlTipoOperacion.swidget().selectedItem())?a.ddlTipoOperacion.swidget().selectedItem().value:0);g.idPlazo=((a.ddlPlazo.swidget().selectedItem())?a.ddlPlazo.swidget().selectedItem().value:0);g.idMoneda=((a.ddlMoneda.swidget().selectedItem())?a.ddlMoneda.swidget().selectedItem().idMoneda:0);g.Cantidad=Core.Functions.Decimal.parseFloat(a.txtCantidad.val());g.Precio=Core.Functions.Decimal.parseFloat(a.txtPrecio.val());g.Monto=Core.Functions.Decimal.parseFloat(a.txtMonto.val());if(a.minuta.idMercado==Core.Enums.eMinutaMercado.PrestamoEfectivo){g.TasaPrestamo=Core.Functions.Decimal.parseFloat(a.txtTasa.val());g.CantidadDiasPrestamo=Core.Functions.Decimal.parseFloat(a.txtCantidadDias.val())}}if(a.actualizarEstadoInicial||Core.Objects.Context.Configuration.idAplicacion==0||Core.Objects.Context.Configuration.idAplicacion==6){g.idCuentaBalanz=((a.ddlCuentaBalanz.swidget().selectedItem())?a.ddlCuentaBalanz.swidget().selectedItem().idCuentaBalanz:0)}if(a.actualizarEstadoInicial||Core.Objects.Context.Configuration.idAplicacion==6){g.PrecioReferencia=Core.Functions.Decimal.parseFloat(a.txtPrecioReferencia.val());g.idCorredor=((a.ddlCorredor.swidget().selectedItem())?a.ddlCorredor.swidget().selectedItem().idCorredor:0);g.EsCruce=(a.chkCruce.swidget().checked())?1:0;g.Comision=(g.idCorredor&&a.chkComision.swidget().checked())?1:0}if(a.actualizarEstadoInicial||Core.Objects.Context.Configuration.idAplicacion==3){g.CodMercadoExterno=a.txtIdExterno.val()}if(a.actualizarEstadoInicial||Core.Objects.Context.Configuration.idAplicacion==0){g.NumComitente=a.selectedAccount?a.selectedAccount.NumComitente:a.minuta.NumComitente}if(a.minuta.idMercado!=Core.Enums.eMinutaMercado.Privado&&a.minuta.idMercado!=Core.Enums.eMinutaMercado.PrestamoEfectivo&&a.dataSelectedAccount&&a.dataSelectedAccount.DatosCuenta&&a.dataSelectedAccount.DatosCuenta.idProductor!="1"){g.PrecioProductor=Core.Functions.Decimal.parseFloat(a.txtPrecioProductor.val())}g.esContado=(a.chkContado.swidget().checked())?1:0;if(a.chkContado.swidget().checked()){g.idCuentaContadoVuelta=a.selectedCuentaVueltaContado?a.selectedCuentaVueltaContado.idCuenta:a.minuta.idCuentaContadoVuelta}if(a.minuta&&!a.minuta.MinutaFinalizada){g.Observaciones=a.txtObservaciones.val()}if(g.esContado&&!g.idCuentaContadoVuelta){var d=new Core.Controls.Dialog("Aviso","Debe seleccionar una cuenta vuelta contado.",{displayButtons:{close:true,accept:false}});d.show();return}var h=new Core.Ajax.ServerRequest({overlayElement:f,showOverlay:true,requestUrl:a.requestUrl,requestType:"PUT",requestData:g});h.onSuccess=function(i){e()};h.request()};a.setCuentaVueltaContado=function(){a.divCuentaVueltaContado.hide();if(a.chkContado.swidget().checked()){a.divCuentaVueltaContado.show()}};a.setControlsByCorredor=function(){if(a.ddlCorredor.swidget().selectedItem()&&a.ddlCorredor.swidget().selectedItem().idCorredor!=0){a.setActiveDiv(a.divControlComision,a.divLabelComision,(!a.readOnly&&(a.actualizarEstadoInicial||Core.Objects.Context.Configuration.idAplicacion==6)))}else{a.divComision.hide()}};a.setControls=function(){a.divFechaLiquidacion.show();a.divTicker.show();a.setActiveDiv(a.divControlPlazo,a.divLabelPlazo,(!a.readOnly&&a.actualizarEstadoInicial));a.setActiveDiv(a.divControlCantidad,a.divLabelCantidad,(!a.readOnly&&a.actualizarEstadoInicial));a.setActiveDiv(a.divControlPrecio,a.divLabelPrecio,(!a.readOnly&&a.actualizarEstadoInicial));a.setActiveDiv(a.divControlPrecioReferencia,a.divLabelPrecioReferencia,(!a.readOnly&&(a.actualizarEstadoInicial||Core.Objects.Context.Configuration.idAplicacion==6)));a.setActiveDiv(a.divControlCorredor,a.divLabelCorredor,(!a.readOnly&&(a.actualizarEstadoInicial||Core.Objects.Context.Configuration.idAplicacion==6)));a.setActiveDiv(a.divControlComision,a.divLabelComision,(!a.readOnly&&(a.actualizarEstadoInicial||Core.Objects.Context.Configuration.idAplicacion==6)));a.setActiveDiv(a.divControlCruce,a.divLabelCruce,(!a.readOnly&&(a.actualizarEstadoInicial||Core.Objects.Context.Configuration.idAplicacion==6)));a.setActiveDiv(a.divControlIdExterno,a.divLabelIdExterno,(!a.readOnly&&(!a.actualizarEstadoInicial&&Core.Objects.Context.Configuration.idAplicacion==3)));a.divTasa.hide();a.divCantidadDias.hide();a.divPrecioProductor.hide();a.divCuenta.show();var d=[Core.Enums.Currency.Pesos,Core.Enums.Currency.Dolares,Core.Enums.Currency.DolaresCable];if(a.minuta.idMercado==Core.Enums.eMinutaMercado.Privado){a.divCorredor.hide();a.divComision.hide();a.divCruce.hide();a.divIdExterno.hide()}if(a.minuta.idMercado==Core.Enums.eMinutaMercado.PrestamoEfectivo){a.divCuenta.hide();a.setActiveDiv(a.divControlTasa,a.divLabelTasa,(!a.readOnly&&a.actualizarEstadoInicial&&a.minuta.idMercado==Core.Enums.eMinutaMercado.PrestamoEfectivo));a.setActiveDiv(a.divControlCantidadDias,a.divLabelCantidadDias,(!a.readOnly&&a.actualizarEstadoInicial&&a.minuta.idMercado==Core.Enums.eMinutaMercado.PrestamoEfectivo));a.divFechaLiquidacion.hide();a.divTicker.hide();a.divPlazo.hide();a.divCantidad.hide();a.divPrecio.hide();a.divPrecioReferencia.hide();a.divCorredor.hide();a.divComision.hide();a.divCruce.hide();a.divIdExterno.hide()}if(a.minuta.idMercado!=Core.Enums.eMinutaMercado.Privado&&a.minuta.idMercado!=Core.Enums.eMinutaMercado.PrestamoEfectivo&&a.dataSelectedAccount&&a.dataSelectedAccount.DatosCuenta&&a.dataSelectedAccount.DatosCuenta.idProductor!="1"){a.setActiveDiv(a.divControlPrecioProductor,a.divLabelPrecioProductor,(!a.readOnly&&Core.Objects.Context.Configuration.idAplicacion==0))}if(a.minuta.idMercado==Core.Enums.eMinutaMercado.Cambio){d=[Core.Enums.Currency.Pesos]}var c=a.ddlMoneda.swidget().initialOptions;c.dataSource.data=d;a.ddlMoneda.swidget().refresh(c);a.divConAsesor.hide();a.divDescripcionAsesor.hide();if(a.minuta.ConAsesor!=null){a.divConAsesor.show();if(a.minuta.ConAsesor==1){a.divDescripcionAsesor.show()}}a.divIdOperacionMesa.hide();if(a.minuta.idOperacionMesa>0){a.divIdOperacionMesa.show()}a.divIdContraparte.hide();if(a.minuta.idContraparte>0){a.divIdContraparte.show()}a.divDescripcionContraparte.hide();if(a.minuta.DescripcionContraparte){a.divDescripcionContraparte.show()}a.setCuentaVueltaContado();a.setControlsByCorredor();a.setTotalOperacion()};a.setActiveDiv=function(c,d,e){c.hide();d.hide();if(e){c.show()}else{d.show()}};a.destroy=function(){a.ddlMoneda.swidget().destroy();a.ddlTipoOperacion.swidget().destroy();a.ddlPlazo.swidget().destroy();a.ddlCorredor.swidget().destroy();a.ddlCuentaBalanz.swidget().destroy();a.chkComision.swidget().destroy();a.chkCruce.swidget().destroy();a.chkContado.swidget().destroy();a.txtIdExterno.swidget().destroy();a.txtObservaciones.swidget().destroy();a.onClosed()}};Core.Business.MinutasVersion2Gestion.Nueva=function(b){var a=this;a.eTipoInstrumento={Bono:0,Accion:1};a.eMercado={Merval:1,Mae:2};a.eTipoContraparte={Agente:1,Comitente:2};a.container=null;a.decimalCount=10;a.txtDateConcertacion=null;a.ddlPlazo=null;a.ddlTipoContraparte=null;a.chkConAsesor=null;a.divAsesor=null;a.divComitente=null;a.txtComitente=null;a.txtAsesor=null;a.lblDescripcionComitente=null;a.lblDescripcionAsesor=null;a.selectedAccount=null;a.selectedAsesor=null;a.lblMonto=null;a.ddlCuenta=null;a.ddlTipoOperacion=null;a.ddlTicker=null;a.txtCantidad=null;a.txtPrecio=null;a.chkInstrumentosAccion=null;a.chkInstrumentosBono=null;a.ddlMoneda=null;a.txtObservaciones=null;a.ddlCuentaBalanz=null;a.ddlMercado=null;a.ddlCorredores=null;a.divAplicaComisionesCorredor=null;a.chkAplicaComisionesCorredor=null;a.onSave=function(){};a.onLoad=function(){};a.onClosed=function(){};a.overlayElement=null;a.btnConfirmar=null;a.btnBuscarCuentas=null;a.btnBuscarAsesores=null;a.btnVolver=null;a.currentMonto=null;a.pageOptions=null;$.extend(true,a,b);a.show=function(){var c={};c.panel=((a.pageOptions&&a.pageOptions.minutasVersion2EspeciesPanel)?a.pageOptions.minutasVersion2EspeciesPanel:Core.Enums.ePanel.BonosFull);var d=new Core.Ajax.ServerRequest({allowCache:true,overlayElement:a.overlayElement,showOverlay:true,requestUrl:"especies",requestType:"GET",requestData:c});d.onSuccess=function(e){var f=new Core.Ajax.ServerRequest({allowCache:true,overlayElement:a.overlayElement,showOverlay:true,requestUrl:"minutas/version2/corredores",requestType:"GET"});f.onSuccess=function(g){var h=new Core.Ajax.ServerRequest({allowCache:true,overlayElement:a.overlayElement,showOverlay:true,secureRequest:true,requestUrl:"minutas/version2/cuentasbalanz",requestType:"GET"});h.onSuccess=function(m){a.txtDateConcertacion=a.container.find(".date-picker-minuta-fecha-minuta");a.txtComitente=a.container.find(".textbox-minuta-comitente");a.txtAsesor=a.container.find(".textbox-minuta-asesor");a.lblDescripcionComitente=a.container.find(".lbl-minuta-descripcion-comitente");a.lblDescripcionComitente.text("Comitente no encontrado");a.lblDescripcionAsesor=a.container.find(".lbl-minuta-descripcion-asesor");a.lblDescripcionAsesor.text("Asesor no encontrado");a.ddlTipoContraparte=a.container.find(".dropdown-minuta-tipo-contraparte");a.ddlCuenta=a.container.find(".dropdown-minuta-vehiculo");a.ddlTipoOperacion=a.container.find(".dropdown-minuta-tipo-operacion");a.ddlTicker=a.container.find(".dropdown-minuta-especie");a.txtCantidad=a.container.find(".textbox-minuta-cantidad");a.txtPrecio=a.container.find(".textbox-minuta-precio");a.txtPrecioReferencia=a.container.find(".textbox-minuta-precio-referencia");a.chkInstrumentosBono=a.container.find(".chk-minuta-instrumento-bono");a.chkInstrumentosAccion=a.container.find(".chk-minuta-instrumento-accion");a.lblMonto=a.container.find(".label-minuta-monto");a.lblUltimoPrecio=a.container.find(".label-minuta-ultimo-precio");a.ddlMoneda=a.container.find(".dropdown-minuta-moneda");a.txtObservaciones=a.container.find(".textbox-minuta-observaciones");a.ddlCuentaBalanz=a.container.find(".dropdown-minuta-cuenta-balanz");a.ddlMercado=a.container.find(".dropdown-minuta-mercado");a.ddlPlazo=a.container.find(".dropdown-minuta-plazo");a.ddlCorredores=a.container.find(".dropdown-minuta-corredores");a.divAplicaComisionesCorredor=a.container.find(".div-minuta-aplica-comisiones-corredor");a.chkAplicaComisionesCorredor=a.container.find(".checkbox-minuta-aplica-comisiones-corredor");a.chkConAsesor=a.container.find(".checkbox-minuta-con-asesor");a.divAsesor=a.container.find(".div-minuta-asesor");a.divComitente=a.container.find(".div-minuta-comitente");a.btnConfirmar=a.container.find(".btn-nueva-confirmar");a.btnBuscarCuentas=a.container.find(".button-buscar-cuentas");a.btnBuscarAsesores=a.container.find(".button-buscar-asesores");a.btnVolver=a.container.find(".btn-nueva-volver");var l={format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date()};a.txtDateConcertacion.shieldDatePicker(l);Core.Functions.Validations.toggleValidation(a.txtDateConcertacion,false);a.ddlTipoContraparte.shieldDropDown({dataSource:{data:[{value:a.eTipoContraparte.Comitente,text:"Comitente"}]},valueTemplate:"{value}",textTemplate:"{text}",value:a.eTipoContraparte.Comitente.toString(),enabled:false});Core.Functions.Validations.toggleValidation(a.ddlTipoContraparte,false);new Core.Controls.DecimalPicker(a.txtComitente,{maxDecimalDigitCount:0,showThousandsSeparator:"",defaultValue:"",onKeyUp:function(){a.searchAccount()}});Core.Functions.Validations.toggleValidation(a.txtComitente,false);a.txtAsesor.val("");a.txtAsesor.unbind("keyup");a.txtAsesor.on("keyup",function(n){a.searchAsesor()});Core.Functions.Validations.toggleValidation(a.txtAsesor,false);a.ddlCuenta.shieldDropDown({dataSource:{data:[{value:Core.Enums.eVehiculo.BCV,text:"BCV"}]},valueTemplate:"{value}",textTemplate:"{text}",value:"",enabled:false});Core.Functions.Validations.toggleValidation(a.ddlCuenta,false);a.ddlTipoOperacion.shieldDropDown({dataSource:{data:[{value:Core.Enums.eMesaTipoOperacion.Compra,text:"Compra"},{value:Core.Enums.eMesaTipoOperacion.Venta,text:"Venta"}]},valueTemplate:"{value}",textTemplate:"{text}",value:""});Core.Functions.Validations.toggleValidation(a.ddlTipoOperacion,false);a.ddlTicker.shieldComboBox({dataSource:{data:[]},valueTemplate:"{Ticker}",textTemplate:"{DisplayTicker} | {Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}},events:{change:function(n){a.setLastPrice()},focus:function(n){var o=a.ddlTicker.swidget().initialOptions;o.value="";a.ddlTicker.swidget().refresh(o);a.ddlTicker.swidget().focus()}}});var i=a.ddlTicker.swidget().initialOptions;i.dataSource.data=e.especies;a.ddlTicker.swidget().refresh(i);Core.Functions.Validations.toggleValidation(a.ddlTicker,false);a.ddlMoneda.shieldDropDown({dataSource:{data:[Core.Enums.Currency.Pesos,Core.Enums.Currency.Dolares,Core.Enums.Currency.DolaresCable]},valueTemplate:"{idMoneda}",textTemplate:"{Descripcion}",value:"",events:{select:function(n){a.setLastPrice()}}});Core.Functions.Validations.toggleValidation(a.ddlMoneda,false);a.ddlCuentaBalanz.shieldComboBox({dataSource:{data:m.cuentas},valueTemplate:"{idCuentaBalanz}",textTemplate:"{CuentaBalanz}",value:"",autoComplete:{enabled:true,filter:{or:[{path:"CuentaBalanz",filter:"contains",value:""}]}},events:{focus:function(n){var o=a.ddlCuentaBalanz.swidget().initialOptions;o.value="";a.ddlCuentaBalanz.swidget().refresh(o);a.ddlCuentaBalanz.swidget().focus()}}});Core.Functions.Validations.toggleValidation(a.ddlCuentaBalanz,false);a.txtObservaciones.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtObservaciones,false);new Core.Controls.DecimalPicker(a.txtPrecio,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:"",onKeyUp:function(){a.txtPrecioReferencia.val(a.txtPrecio.val());a.txtPrecioReferencia.blur();a.setMonto()}});Core.Functions.Validations.toggleValidation(a.txtPrecio,false);new Core.Controls.DecimalPicker(a.txtPrecioReferencia,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:""});Core.Functions.Validations.toggleValidation(a.txtPrecioReferencia,false);a.lblMonto.text("");a.currentMonto=null;a.lblUltimoPrecio.html("No encontrado");new Core.Controls.DecimalPicker(a.txtCantidad,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:"",onKeyUp:function(){a.setMonto()}});Core.Functions.Validations.toggleValidation(a.txtCantidad,false);if(!a.chkInstrumentosAccion.swidget()){a.chkInstrumentosAccion.shieldRadioButton({label:"Acción",events:{click:function(n){a.setMonto()}}})}var j=a.chkInstrumentosAccion.swidget().initialOptions;j.checked=false;a.chkInstrumentosAccion.swidget().refresh(j);a.chkInstrumentosAccion.swidget().visible(true);if(!a.chkInstrumentosBono.swidget()){a.chkInstrumentosBono.shieldRadioButton({label:"Bono",events:{click:function(n){a.setMonto()}}})}var k=a.chkInstrumentosBono.swidget().initialOptions;k.checked=true;a.chkInstrumentosBono.swidget().refresh(k);a.chkInstrumentosBono.swidget().visible(true);a.ddlMercado.shieldDropDown({dataSource:{data:[{value:a.eMercado.Merval,text:"Merval"},{value:a.eMercado.Mae,text:"Mae"}]},valueTemplate:"{value}",textTemplate:"{text}",value:"",events:{select:function(n){a.setLastPrice()}}});Core.Functions.Validations.toggleValidation(a.ddlMercado,false);a.ddlPlazo.shieldDropDown({dataSource:{data:[{value:Core.Enums.ePlazo.CI,text:"CI"},{value:Core.Enums.ePlazo.D24,text:"24 hs."},{value:Core.Enums.ePlazo.D48,text:"48 hs."}]},valueTemplate:"{value}",textTemplate:"{text}",value:"",events:{select:function(n){a.setLastPrice()}}});Core.Functions.Validations.toggleValidation(a.ddlPlazo,false);g.corredores.unshift({idCorredor:0,Descripcion:"Sin Corredor"});a.ddlCorredores.shieldDropDown({dataSource:{data:g.corredores},textTemplate:"{Descripcion}",valueTemplate:"{idCorredor}",value:"",events:{select:function(n){a.setControlsByCorredor()}}});a.setControlsByCorredor();Core.Functions.Validations.toggleValidation(a.ddlCorredores,false);a.chkAplicaComisionesCorredor.shieldCheckBox({label:"Aplica Comisiones Corredor"});a.chkAplicaComisionesCorredor.swidget().checked(true);Core.Functions.Validations.toggleValidation(a.chkAplicaComisionesCorredor,false);a.btnBuscarCuentas.unbind("click");a.btnBuscarCuentas.click(function(){new Core.Controls.MinutaBuscarCuenta({onSelected:function(n){a.selectedAccount=n;a.lblDescripcionComitente.text(a.selectedAccount.Descripcion);a.txtComitente.val(a.selectedAccount.NumComitente)}}).show()});a.btnBuscarAsesores.unbind("click");a.btnBuscarAsesores.click(function(){new Core.Controls.MinutaBuscarAsesor({onSelected:function(n){a.selectedAsesor=n;a.lblDescripcionAsesor.text(a.selectedAsesor.NombreCompleto+" / "+a.selectedAsesor.Unidad);a.txtAsesor.val(a.selectedAsesor.Username)}}).show()});a.chkConAsesor.shieldCheckBox({label:"Con Asesor",events:{click:function(n){a.setControlsByConAsesor()}}});a.chkConAsesor.swidget().checked(false);a.setControlsByConAsesor();a.setLastPrice();Core.Functions.Validations.toggleValidation(a.chkConAsesor,false);a.btnConfirmar.unbind("click");a.btnConfirmar.click(function(){Core.Functions.Validations.toggleValidation(a.txtDateConcertacion,false);Core.Functions.Validations.toggleValidation(a.ddlTipoContraparte,false);Core.Functions.Validations.toggleValidation(a.txtComitente,false);Core.Functions.Validations.toggleValidation(a.txtAsesor,false);Core.Functions.Validations.toggleValidation(a.ddlTicker,false);Core.Functions.Validations.toggleValidation(a.txtCantidad,false);Core.Functions.Validations.toggleValidation(a.txtPrecio,false);Core.Functions.Validations.toggleValidation(a.txtPrecioReferencia,false);Core.Functions.Validations.toggleValidation(a.ddlCuenta,false);Core.Functions.Validations.toggleValidation(a.ddlMercado,false);Core.Functions.Validations.toggleValidation(a.ddlPlazo,false);Core.Functions.Validations.toggleValidation(a.ddlTipoOperacion,false);Core.Functions.Validations.toggleValidation(a.ddlMoneda,false);Core.Functions.Validations.toggleValidation(a.ddlCuentaBalanz,false);Core.Functions.Validations.toggleValidation(a.txtObservaciones,false);Core.Functions.Validations.toggleValidation(a.ddlCorredores,false);Core.Functions.Validations.toggleValidation(a.chkAplicaComisionesCorredor,false);var n=a.getRequestData();if(n==null){return}var o=new Core.Ajax.ServerRequest({overlayElement:a.btnConfirmar,showOverlay:true,requestUrl:"minutas/version2/insertarsolicitud",requestType:"POST",requestData:n});o.onSuccess=function(p){new Core.Controls.MinutaConfirmacion({data:p,onConfirm:function(){a.destroy();if(a.onSave){a.onSave()}}}).show()};o.request()});a.txtDateConcertacion.swidget().focus();a.btnVolver=a.container.find(".btn-nueva-volver");a.btnVolver.unbind("click");a.btnVolver.on("click",function(){a.destroy()});a.onLoad()};h.request()};f.request()};d.request()};a.searchAccount=function(){if(a.txtComitente.val()){var c=new Core.Ajax.ServerRequest({showOverlay:false,secureRequest:true,requestUrl:"cuentas/numdescripcion/"+Core.Enums.eVehiculo.BCV+"/"+a.txtComitente.val(),requestType:"GET"});c.onSuccess=function(d){if(d.cuentas.length==1){a.selectedAccount=d.cuentas[0];a.lblDescripcionComitente.text(a.selectedAccount.Descripcion)}else{a.selectedAccount=null;a.lblDescripcionComitente.text("Comitente no encontrado")}};c.request()}else{a.selectedAccount=null;a.lblDescripcionComitente.text("Comitente no encontrado")}};a.searchAsesor=function(){if(a.txtAsesor.val()&&a.txtAsesor.val().length>=4){var c=new Core.Ajax.ServerRequest({showOverlay:false,secureRequest:true,requestUrl:"minutas/version2/asesores/"+a.txtAsesor.val(),requestType:"GET"});c.onSuccess=function(e){var d=null;e.asesores.forEach(function(g,f){if(g.Username==a.txtAsesor.val()){d=g}});if(d){a.selectedAsesor=d;a.lblDescripcionAsesor.text(a.selectedAsesor.NombreCompleto+" / "+a.selectedAsesor.Unidad)}else{a.selectedAsesor=null;a.lblDescripcionAsesor.text("Asesor no encontrado")}};c.request()}else{a.selectedAsesor=null;a.lblDescripcionAsesor.text("Asesor no encontrado")}};a.setControlsByCorredor=function(){if(a.ddlCorredores.swidget().selectedItem()&&a.ddlCorredores.swidget().selectedItem().idCorredor!=0){a.divAplicaComisionesCorredor.show()}else{a.divAplicaComisionesCorredor.hide()}};a.setControlsByConAsesor=function(){if(a.chkConAsesor.swidget().checked()){a.divAsesor.show();a.divComitente.hide()}else{a.divAsesor.hide();a.divComitente.show()}};a.getRequestData=function(){var d={value:true};var c={data:{ConAsesor:(a.chkConAsesor.swidget().checked()?1:0),idCuentaMesa:Core.Functions.Validations.getValidatedDropDownValue(a.ddlCuenta),FechaConcertacion:Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtDateConcertacion,d)),idMercado:Core.Functions.Validations.getValidatedDropDownValue(a.ddlMercado,d),idTipoOperacion:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,d),Ticker:Core.Functions.Validations.getValidatedSwidgetValue(a.ddlTicker,d),Plazo:Core.Functions.Validations.getValidatedDropDownValue(a.ddlPlazo,d),idMoneda:Core.Functions.Validations.getValidatedDropDownValue(a.ddlMoneda,d),Cantidad:Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidad,d)),Precio:Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecio,d)),PrecioReferencia:Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecioReferencia,d)),Monto:a.currentMonto?a.currentMonto:0,Observaciones:a.txtObservaciones.val(),Urgente:0,esCruce:0,CodMercadoExterno:"",TipoInstrumentoMesa:a.getSelectedInstrumento(d),idTipoBroker:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoContraparte),corredor:((a.ddlCorredores.swidget().selectedItem())?a.ddlCorredores.swidget().selectedItem().Descripcion:""),idCorredor:((a.ddlCorredores.swidget().selectedItem())?a.ddlCorredores.swidget().selectedItem().idCorredor:0),comision:((a.ddlCorredores.swidget().selectedItem()&&a.ddlCorredores.swidget().selectedItem().idCorredor&&a.chkAplicaComisionesCorredor[0].checked)?1:0)}};if(a.ddlCuentaBalanz.swidget().selectedItem()){c.data.idCuentaBalanz=a.ddlCuentaBalanz.swidget().selectedItem().idCuentaBalanz}if(a.chkConAsesor.swidget().checked()){if(a.selectedAsesor){c.data.idPersonaAsesor=a.selectedAsesor.idPersonaAsesor}else{d.value=false;new Core.Controls.Dialog("Aviso","Debe seleccionar un asesor.",{displayButtons:{close:true,accept:false}}).show()}}else{if(a.selectedAccount){c.data.idCuenta=a.selectedAccount.idCuenta;c.data.Broker=a.selectedAccount.NumComitente;c.data.idBroker=a.selectedAccount.CodComitente}else{d.value=false;new Core.Controls.Dialog("Aviso","Debe seleccionar un comitente.",{displayButtons:{close:true,accept:false}}).show()}}if(d.value){return c}else{return null}};a.getSelectedInstrumento=function(c){if(a.chkInstrumentosAccion.swidget().checked()){return a.eTipoInstrumento.Accion}else{if(a.chkInstrumentosBono.swidget().checked()){return a.eTipoInstrumento.Bono}else{c.value=false;new Core.Controls.Dialog("Aviso","Debe seleccionar un tipo de instrumento.",{displayButtons:{close:true,accept:false}}).show()}}};a.setMonto=function(){a.currentMonto=null;if(a.chkInstrumentosAccion.swidget().checked()){if(a.txtCantidad.val()&&a.txtPrecio.val()){a.currentMonto=(Core.Functions.Decimal.parseFloat(a.txtCantidad.val())*Core.Functions.Decimal.parseFloat(a.txtPrecio.val()))}}if(a.chkInstrumentosBono.swidget().checked()){if(a.txtCantidad.val()&&a.txtPrecio.val()){a.currentMonto=(Core.Functions.Decimal.parseFloat(a.txtCantidad.val())*Core.Functions.Decimal.parseFloat(a.txtPrecio.val()))/100}}a.lblMonto.text((a.currentMonto?Core.Functions.grid.formatNumber(a.currentMonto.toFixed(6)):""))};a.setLastPrice=function(){if(a.ddlTicker.swidget().value()&&a.ddlPlazo.swidget().selectedItem()&&a.ddlMoneda.swidget().selectedItem()&&a.ddlMercado.swidget().selectedItem()){var c=new Core.Ajax.ServerRequest({showOverlay:false,secureRequest:true,requestUrl:"minutas/version2/lastprice/"+(a.ddlTicker.swidget().selectedItem()?a.ddlTicker.swidget().selectedItem().DisplayTicker:a.ddlTicker.swidget().value())+"/"+a.ddlPlazo.swidget().selectedItem().value+"/"+a.ddlMoneda.swidget().selectedItem().idMoneda+"/"+a.ddlMercado.swidget().selectedItem().value,requestType:"GET"});c.onSuccess=function(d){a.lblUltimoPrecio.html((d&&d.UltimoPrecio!=null)?('<label style="margin-right: 10px;">'+d.UltimoPrecio+"</label> "+d.Fecha):"No encontrado")};c.request()}else{a.lblUltimoPrecio.html("No encontrado")}};a.destroy=function(){a.txtDateConcertacion.swidget().destroy();a.ddlTipoContraparte.swidget().destroy();a.ddlTicker.swidget().destroy();a.ddlCuentaBalanz.swidget().destroy();a.txtObservaciones.swidget().destroy();a.ddlMoneda.swidget().destroy();a.ddlMercado.swidget().destroy();a.ddlPlazo.swidget().destroy();a.ddlCuenta.swidget().destroy();a.ddlTipoOperacion.swidget().destroy();a.ddlCorredores.swidget().destroy();a.chkAplicaComisionesCorredor.swidget().destroy();a.chkConAsesor.swidget().destroy();a.onClosed()}};Core.Business.MinutasVersion2Gestion.AprobacionMasiva=function(b){var a=this;a.divModal=$(".div-modal-aprobacion-masiva");a.divMinutas=null;a.onSuccess=function(){};a.minutas=[];a.minutasAprobar=0;a.minutasFinalizadas=0;a.minutasError=[];$.extend(true,a,b);a.show=function(){a.divMinutas=a.divModal.find(".div-minutas-aprobacion-masiva");a.divMinutas.empty();a.minutas.forEach(function(e,d){e.chk=null;if(e.BotonAprobarRolMesa){var c=$("<tr></tr>").appendTo(a.divMinutas);var f=$("<td></td>").appendTo(c);e.chk=$('<input type="checkbox" checked />').appendTo(f);$("<td>"+e.idMinuta+"</td>").appendTo(c);$("<td>"+e.FechaLiquidacion+"</td>").appendTo(c);$("<td>"+e.UsuarioIngreso+"</td>").appendTo(c);$("<td>"+e.Mercado+"</td>").appendTo(c);$('<td class="text-right">'+e.NumComitente+"</td>").appendTo(c);$("<td>"+e.Operacion+"</td>").appendTo(c);$("<td>"+e.Moneda+"</td>").appendTo(c);$("<td>"+e.Ticker+"</td>").appendTo(c);$('<td class="text-right">'+Core.Functions.grid.formatPrice(e.Cantidad)+"</td>").appendTo(c);$('<td class="text-right">'+Core.Functions.grid.formatPrice(e.Precio)+"</td>").appendTo(c);$('<td class="text-right">'+Core.Functions.grid.formatPrice(e.Monto)+"</td>").appendTo(c);$("<td>"+e.NumCuentaBalanz+"</td>").appendTo(c)}});a.btnConfirmar=a.divModal.find(".btn-confirmar-aprobacion-masiva");a.btnConfirmar.unbind("click");a.btnConfirmar.on("click",function(){a.minutasAprobar=$.grep(a.minutas,function(d,c){return d.chk&&d.chk[0].checked}).length;a.minutasFinalizadas=0;if(a.minutasAprobar>0){a.overlay=new Core.Controls.Overlay(a.btnConfirmar,{});a.minutas.forEach(function(d,c){if(d.chk&&d.chk[0].checked){var e={idMinuta:d.idMinuta,ContinuarFlujoFeliz:1,VersionActual:d.VersionActual};var f=new Core.Ajax.ServerRequest({showOverlay:false,secureRequest:true,requestUrl:"minutas/version2/actualizarrolmesa",requestType:"PUT",requestData:e});f.onComplete=function(g){a.minutasFinalizadas++;a.checkFinished()};f.onSuccess=function(){};f.onError=function(g){var h=(g.responseJSON&&g.responseJSON.Descripcion)?g.responseJSON.Descripcion:"Algunos componentes de la página no se cargaron correctamente. Por favor intente mas tarde...";a.minutasError.push({idMinuta:d.idMinuta,Error:h})};f.request()}})}else{a.divModal.modal("hide")}});a.checkFinished=function(){if(a.minutasAprobar==a.minutasFinalizadas){a.divModal.on("hidden.bs.modal",function(){a.overlay.destroy();a.onSuccess();var d="La aprobación masiva de minutas ha sido completada.";if(a.minutasError.length){d+="<br/>Algunas minutas han fallado:<br/>";d+="<table class='table table-striped'>";d+="<thead><tr><th>ID Minuta</th><th>Descripción</th></tr></thead>";d+="<tbody>";for(var c=0;c<a.minutasError.length;c++){d+="<tr>";d+="<td>"+a.minutasError[c].idMinuta+"</td>";d+="<td>"+a.minutasError[c].Error+"</td>";d+="</tr>"}d+="</tbody></table>"}new Core.Controls.Dialog("Aviso",d,{displayButtons:{close:true,accept:false}}).show()});a.divModal.modal("hide")}};a.divModal.unbind("hidden.bs.modal");a.divModal.modal({show:true})}};Core.Business.MinutasVersion2Nueva=new function(){var a=this;a.decimalCount=8;a.pageOptions=null;a.id="minutasVersion2Nueva";a.lblComitente=null;a.txtDate=null;a.lblDisponible=null;a.divMercado=null;a.ddlMercado=null;a.divTipoMinutaEspecial=null;a.chkTipoMinutaEspecialPorCuenta=null;a.chkTipoMinutaEspecialPorAsesor=null;a.divCruce=null;a.chkCruce=null;a.divTitularesCuenta=null;a.ddlTitularesCuenta=null;a.btnClonarMinuta=null;a.divCuentas=null;a.lblCuentaSeleccionada=null;a.btnBuscarCuenta=null;a.divAsesores=null;a.ddlAsesores=null;a.divTipoOperacion=null;a.ddlTipoOperacion=null;a.divEspecie=null;a.ddlEspecie=null;a.divPlazo=null;a.ddlPlazo=null;a.divMoneda=null;a.ddlMoneda=null;a.divMonto=null;a.txtMonto=null;a.divDiasPrestamo=null;a.txtDiasPrestamo=null;a.divTasaPrestamo=null;a.txtTasaPrestamo=null;a.divCantidadNominales=null;a.txtCantidadNominales=null;a.divPrecio=null;a.divPrecioReferencia=null;a.divPrecioReferenciaProductor=null;a.txtPrecio=null;a.divPredefinirPrecioReferencia=null;a.chkPredefinirPrecioReferencia=null;a.txtPrecioReferencia=null;a.txtPrecioReferenciaProductor=null;a.divTotalOperacion=null;a.lblTotalOperacion=null;a.divUltimoPrecio=null;a.lblUltimoPrecio=null;a.divVariacion=null;a.lblVariacion=null;a.divMejorOfertaCompra=null;a.lblMejorOfertaCompra=null;a.divMejorOfertaVenta=null;a.lblMejorOfertaVenta=null;a.divCuentaBalanz=null;a.ddlCuentaBalanz=null;a.divContado=null;a.chkContado=null;a.divCuentaVueltaContado=null;a.lblCuentaVueltaContado=null;a.btnBuscarCuentaVueltaContado=null;a.divObservaciones=null;a.txtObservaciones=null;a.btnSend=null;a.datosCuentaSeleccionada=null;a.titularesCuenta=[];a.init=function(b,c){Core.loadPage("minutas-version-2-nueva.html",function(){document.title="Minutas";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.initControls();a.cuentaSeleccionada=$.grep(Core.Objects.Accounts?Core.Objects.Accounts:[],function(e,d){return e.idCuenta==b})[0];a.selectedCuentaVueltaContado=null;Core.Objects.Accounts=Core.Objects.Accounts?Core.Objects.Accounts:[];a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadControls,"Core.Business.MinutasVersion2Nueva")})};a.initControls=function(){a.lblComitente=$(".label-comitente");a.lblComitente.hide();a.txtDate=$(".date-picker-date");a.txtDate.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),});a.divDisponible=$(".div-disponible");a.lblDisponible=$(".label-disponible");a.divDisponible.hide();a.divMercado=$(".div-mercado");a.ddlMercado=$(".dropdown-mercado");a.ddlMercado.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{idMercado}",value:(Core.Objects.Context.Parameters.ConfigMinutasMercadoDefault)?Core.Objects.Context.Parameters.ConfigMinutasMercadoDefault.toString():Core.Enums.eMinutaMercado.Merval.toString(),events:{select:function(b){a.setControlsByMercado()}}});a.divTipoMinutaEspecial=$(".div-tipo-minuta-especial");a.chkTipoMinutaEspecialPorCuenta=$(".chk-tipo-minuta-especial-por-cuenta");a.chkTipoMinutaEspecialPorCuenta.shieldRadioButton({label:"Por cuenta",checked:false,events:{click:function(b){a.setControlsByTipoMinutaEspecial()}}});a.chkTipoMinutaEspecialPorAsesor=$(".chk-tipo-minuta-especial-por-asesor");a.chkTipoMinutaEspecialPorAsesor.shieldRadioButton({label:"Por asesor",checked:false,events:{click:function(b){a.setControlsByTipoMinutaEspecial()}}});a.divCruce=$(".div-cruce");a.chkCruce=$(".checkbox-cruce");a.divTitularesCuenta=$(".div-titulares-cuenta");a.ddlTitularesCuenta=$(".dropdown-titulares-cuenta");a.ddlTitularesCuenta.shieldDropDown({dataSource:{data:[]},textTemplate:"{Persona}",valueTemplate:"{idPersona}"});a.btnClonarMinuta=$(".button-clonar-minuta");a.btnClonarMinuta.click(function(){a.clonarMinuta()});a.divCuentas=$(".div-minutas-cuentas");a.lblCuentaSeleccionada=$(".label-minutas-cuenta-seleccionada");a.lblCuentaSeleccionada.hide();a.btnBuscarCuenta=$(".button-buscar-cuentas");a.btnBuscarCuenta.on("click",function(){new Core.Controls.MinutaBuscarCuenta({onSelected:function(b){a.cuentaSeleccionada=b;a.setControlsByCuenta()}}).show()});a.divAsesores=$(".div-minutas-asesores");a.ddlAsesores=$(".dropdown-minutas-asesores");a.ddlAsesores.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idPersonaAsesor}",textTemplate:"{Nombre}",enabled:true,autoComplete:{enabled:true,filter:{and:[{path:"Nombre",filter:"contains",value:""}]}},events:{focus:function(b){var c=a.ddlAsesores.swidget().initialOptions;c.value="";a.ddlAsesores.swidget().refresh(c);a.ddlAsesores.swidget().focus()}}});a.divTipoOperacion=$(".div-tipo-operacion");a.ddlTipoOperacion=$(".dropdown-tipo-operacion");a.ddlTipoOperacion.shieldDropDown({dataSource:{data:[{value:Core.Enums.eMinutaTipoOperacion.Compra,text:"Compra"},{value:Core.Enums.eMinutaTipoOperacion.Venta,text:"Venta"}]},textTemplate:"{text}",valueTemplate:"{value}",events:{select:function(b){a.setEspecieByTipoOperacion()}}});a.divMoneda=$(".div-moneda");a.ddlMoneda=$(".dropdown-moneda");a.ddlMoneda.shieldDropDown({dataSource:{data:[Core.Enums.Currency.Pesos,Core.Enums.Currency.Dolares,Core.Enums.Currency.DolaresCable]},textTemplate:"{Descripcion}",valueTemplate:"{idMoneda}",events:{select:function(b){a.setLabelsByEspecie();a.setPrecioReferencia()}}});a.divMonto=$(".div-monto");a.txtMonto=$(".textbox-monto");new Core.Controls.DecimalPicker(a.txtMonto,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:""});a.divDiasPrestamo=$(".div-dias-prestamo");a.txtDiasPrestamo=$(".textbox-dias-prestamo");new Core.Controls.DecimalPicker(a.txtDiasPrestamo,{maxDecimalDigitCount:0,showThousandsSeparator:""});a.divTasaPrestamo=$(".div-tasa-prestamo");a.txtTasaPrestamo=$(".textbox-tasa-prestamo");new Core.Controls.DecimalPicker(a.txtTasaPrestamo,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:""});a.divEspecie=$(".div-especie");a.ddlEspecie=$(".dropdown-especie");a.ddlEspecie.shieldComboBox({dataSource:{data:[]},valueTemplate:"{Ticker}",textTemplate:"{DisplayTicker} | {Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}},events:{change:function(b){a.setLabelsByEspecie();a.setPrecioReferencia()},focus:function(b){var c=a.ddlEspecie.swidget().initialOptions;c.value="";a.ddlEspecie.swidget().refresh(c);a.ddlEspecie.swidget().focus()}}});a.divPlazo=$(".div-plazo");a.ddlPlazo=$(".dropdown-plazo");a.ddlPlazo.shieldDropDown({dataSource:{data:[{value:Core.Enums.ePlazo.CI,text:"CI"},{value:Core.Enums.ePlazo.D24,text:"24 hs."},{value:Core.Enums.ePlazo.D48,text:"48 hs."}]},textTemplate:"{text}",valueTemplate:"{value}",value:((a.pageOptions&&a.pageOptions.plazoDefault)?a.pageOptions.plazoDefault.toString():""),events:{select:function(b){a.setDisponible();a.setEspecieByTipoOperacion()}}});a.divCantidadNominales=$(".div-cantidad-nominales");a.txtCantidadNominales=$(".textbox-cantidad-nominales");new Core.Controls.DecimalPicker(a.txtCantidadNominales,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onChange:a.setTotalOperacion});a.divPrecio=$(".div-precio");a.txtPrecio=$(".textbox-precio");new Core.Controls.DecimalPicker(a.txtPrecio,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onChange:a.setTotalOperacion});a.divPredefinirPrecioReferencia=$(".div-predefinir-precio-referencia");a.chkPredefinirPrecioReferencia=$(".checkbox-predefinir-precio-referencia");a.chkPredefinirPrecioReferencia.on("change",function(){a.txtPrecioReferencia.removeAttr("disabled");if(a.chkPredefinirPrecioReferencia[0].checked){a.txtPrecioReferencia.attr("disabled","disabled");a.setPrecioReferencia()}});a.divPrecioReferencia=$(".div-precio-referencia");a.txtPrecioReferencia=$(".textbox-precio-referencia");new Core.Controls.DecimalPicker(a.txtPrecioReferencia,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:""});a.divPrecioReferenciaProductor=$(".div-precio-referencia-productor");a.txtPrecioReferenciaProductor=$(".textbox-precio-referencia-productor");new Core.Controls.DecimalPicker(a.txtPrecioReferenciaProductor,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:""});a.divTotalOperacion=$(".div-total-operacion");a.lblTotalOperacion=$(".label-total-operacion");a.divUltimoPrecio=$(".div-ultimo-precio");a.lblUltimoPrecio=$(".label-ultimo-precio");a.divVariacion=$(".div-variacion");a.lblVariacion=$(".label-variacion");a.divMejorOfertaCompra=$(".div-mejor-oferta-compra");a.lblMejorOfertaCompra=$(".label-mejor-oferta-compra");a.divMejorOfertaVenta=$(".div-mejor-oferta-venta");a.lblMejorOfertaVenta=$(".label-mejor-oferta-venta");a.divObservaciones=$(".div-observaciones");a.txtObservaciones=$(".text-observaciones");a.txtObservaciones.shieldTextBox({});a.divCuentaBalanz=$(".div-cuenta-balanz");a.ddlCuentaBalanz=$(".dropdown-cuenta-balanz");a.ddlCuentaBalanz.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idCuentaBalanz}",textTemplate:"{CuentaBalanz}",value:"",autoComplete:{enabled:true,filter:{or:[{path:"CuentaBalanz",filter:"contains",value:""}]}},events:{focus:function(b){var c=a.ddlCuentaBalanz.swidget().initialOptions;c.value="";a.ddlCuentaBalanz.swidget().refresh(c);a.ddlCuentaBalanz.swidget().focus()}}});a.divContado=$(".div-contado");a.chkContado=$(".checkbox-contado");a.chkContado.on("change",function(){a.setCuentaVueltaContado()});a.divCuentaVueltaContado=$(".div-cuenta-vuelta-contado");a.divCuentaVueltaContado.hide();a.lblCuentaVueltaContado=$(".label-cuenta-vuelta-contado");a.btnCuentaVueltaContado=$(".button-buscar-cuenta-vuelta-contado");a.btnCuentaVueltaContado.on("click",function(){new Core.Controls.MinutaBuscarCuenta({onSelected:function(b){a.selectedCuentaVueltaContado=b;a.lblCuentaVueltaContado.text((a.selectedCuentaVueltaContado?(a.selectedCuentaVueltaContado.idCuenta+" | "+a.selectedCuentaVueltaContado.Descripcion+" (Comitente: "+a.selectedCuentaVueltaContado.NumComitente+")"):"Seleccione una cuenta"))}}).show()});a.btnSend=$(".btn-send");a.btnSend.click(function(){var e={value:true};var b={data:{FechaConcertacion:Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtDate,e)),idMercado:Core.Functions.Validations.getValidatedDropDownValue(a.ddlMercado,e),idMoneda:Core.Functions.Validations.getValidatedSwidgetValue(a.ddlMoneda),Observaciones:a.txtObservaciones.val(),}};if(a.chkTipoMinutaEspecialPorCuenta.swidget().checked()){if(a.cuentaSeleccionada){b.data.idCuenta=a.cuentaSeleccionada.idCuenta}else{new Core.Controls.Dialog("Aviso","Debe seleccionar una cuenta",{displayButtons:{close:true,accept:false}}).show();e.value=false}}else{b.data.idPersonaAsesor=Core.Functions.Validations.getValidatedDropDownValue(a.ddlAsesores,e)}if(a.ddlMercado.swidget().value()!=Core.Enums.eMinutaMercado.Facturas){b.EsCruce=a.chkCruce[0].checked?1:0;b.esContado=a.chkContado[0].checked?1:0;if(a.ddlCuentaBalanz.swidget().selectedItem()){b.data.idCuentaBalanz=a.ddlCuentaBalanz.swidget().selectedItem().idCuentaBalanz}if(a.chkContado[0].checked){if(a.cuentaSeleccionada){b.data.idCuentaContadoVuelta=a.selectedCuentaVueltaContado.idCuenta}else{new Core.Controls.Dialog("Aviso","Debe seleccionar una cuenta vuelta contado",{displayButtons:{close:true,accept:false}}).show();e.value=false}}}if(a.ddlMercado.swidget().value()==Core.Enums.eMinutaMercado.Cambio){b.data.esPrecioCambioRefMesa=a.chkPredefinirPrecioReferencia[0].checked?1:0;if(a.titularesCuenta.length>1){b.data.idPersonaTitular=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTitularesCuenta,e)}}if(a.ddlMercado.swidget().value()==Core.Enums.eMinutaMercado.PrestamoEfectivo){b.data.Monto=Core.Functions.Validations.getValidatedNumericInputValue(a.txtMonto,e);b.data.CantidadDiasPrestamo=Core.Functions.Validations.getValidatedNumericInputValue(a.txtDiasPrestamo,e);b.data.TasaPrestamo=Core.Functions.Validations.getValidatedNumericInputValue(a.txtTasaPrestamo,e)}else{if(a.ddlMercado.swidget().value()==Core.Enums.eMinutaMercado.Facturas){b.data.Monto=Core.Functions.Validations.getValidatedNumericInputValue(a.txtMonto,e)}else{b.data.idTipoOperacion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,e);b.data.Ticker=Core.Functions.Validations.getValidatedSwidgetValue(a.ddlEspecie,e);b.data.Plazo=Core.Functions.Validations.getValidatedDropDownValue(a.ddlPlazo,e);b.data.Cantidad=Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidadNominales,e);b.data.Precio=Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecio,e);if(a.ddlMercado.swidget().value()==Core.Enums.eMinutaMercado.Cambio&&a.chkPredefinirPrecioReferencia[0].checked){b.data.PrecioReferencia=Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecioReferencia,e)}else{b.data.PrecioReferencia=a.txtPrecioReferencia.val()?Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecioReferencia,e):0}b.data.Monto=parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecio,e))*parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidadNominales,e));b.data.CodMercadoExterno=""}}if(a.chkTipoMinutaEspecialPorCuenta.swidget().checked()&&a.datosCuentaSeleccionada&&a.datosCuentaSeleccionada.DatosCuenta.idProductor!="1"&&a.ddlMercado.swidget().selectedItem().idMercado!=Core.Enums.eMinutaMercado.Privado&&a.ddlMercado.swidget().selectedItem().idMercado!=Core.Enums.eMinutaMercado.PrestamoEfectivo&&a.ddlMercado.swidget().selectedItem().idMercado!=Core.Enums.eMinutaMercado.Facturas){b.data.PrecioProductor=a.txtPrecioReferenciaProductor.val()?Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecioReferenciaProductor,e):null}if(e.value){var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"minutas/version2/insertarsolicitud",requestType:"POST",requestData:b});c.onSuccess=function(f){new Core.Controls.MinutaConfirmacion({data:f,onConfirm:function(){a.clearFields()}}).show()};c.onError=function(g){if(g.responseJSON.CodigoError==-2002&&a.chkPredefinirPrecioReferencia[0].checked){a.setPrecioReferencia()}var i=(g.responseJSON&&g.responseJSON.Descripcion)?"Mensaje":"Error de conexión";var f=(g.responseJSON&&g.responseJSON.Descripcion)?g.responseJSON.Descripcion:"Algunos componentes de la página no se cargaron correctamente. Por favor intente mas tarde...";var h=new Core.Controls.Dialog(i,"<p>"+f+"</p>",{displayButtons:{close:true,accept:false}});h.show()};c.request();var b={};b.Nombre="ConfigMinutasMercadoDefault";b.Valor=a.ddlMercado.swidget().value();var d=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"parametrospersona",requestType:"POST",requestData:b});d.onSuccess=function(f){Core.Objects.Context.Parameters.ConfigMinutasMercadoDefault=a.ddlMercado.swidget().value();if(!Core.Functions.Validations.isBlockedStorage()&&Core.Functions.Persistence.getStorage()){Core.Functions.Persistence.getStorage().setItem("CoreContext",LZString.compressToUTF16(JSON.stringify(Core.Objects.Context)))}};d.request()}})};a.loadControls=function(){var b=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"minutas/version2/mercados",requestType:"GET",requestData:{idAplicacion:0,idFuncionalidad:1}});b.onSuccess=function(d){var c=a.ddlMercado.swidget().initialOptions;c.dataSource.data=d.mercados?d.mercados:[];c.value=((a.ddlMercado.swidget().value())?a.ddlMercado.swidget().value().toString():(Core.Objects.Context.Parameters.ConfigMinutasMercadoDefault)?Core.Objects.Context.Parameters.ConfigMinutasMercadoDefault.toString():Core.Enums.eMinutaMercado.Merval.toString());a.ddlMercado.swidget().refresh(c);var e=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"asesores/unidaddenegocios",requestType:"GET"});e.onSuccess=function(g){var f=a.ddlAsesores.swidget().initialOptions;f.dataSource.data=g.asesores?g.asesores:[];a.ddlAsesores.swidget().refresh(f);var h=new Core.Ajax.ServerRequest({allowCache:true,showOverlay:true,secureRequest:true,requestUrl:"minutas/version2/cuentasbalanz",requestType:"GET"});h.onSuccess=function(k){var i=k.cuentas==null?[]:k.cuentas;var j=a.ddlCuentaBalanz.swidget().initialOptions;j.dataSource.data=i;a.ddlCuentaBalanz.swidget().refresh(j);a.setControlsByMercado()};h.request()};e.request()};b.request()};a.setControlsByMercado=function(c){a.chkTipoMinutaEspecialPorAsesor.swidget().checked(a.ddlMercado.swidget().selectedItem().MinutaConAsesor);a.chkTipoMinutaEspecialPorCuenta.swidget().checked(a.ddlMercado.swidget().selectedItem().MinutaConCuenta);a.divTipoMinutaEspecial.hide();if(a.ddlMercado.swidget().selectedItem().MinutaConAsesor&&a.ddlMercado.swidget().selectedItem().MinutaConCuenta){a.divTipoMinutaEspecial.show()}a.setControlsByTipoMinutaEspecial(c);var b=[Core.Enums.Currency.Pesos,Core.Enums.Currency.Dolares,Core.Enums.Currency.DolaresCable];if(a.ddlMercado.swidget().value()==Core.Enums.eMinutaMercado.Cambio){var b=[Core.Enums.Currency.Pesos]}var d=a.ddlMoneda.swidget().initialOptions;if(a.ddlMercado.swidget().value()==Core.Enums.eMinutaMercado.Privado){d.value=Core.Enums.Currency.DolaresCable.idMoneda.toString()}else{d.value=""}d.dataSource.data=b;a.ddlMoneda.swidget().refresh(d);if(a.ddlMercado.swidget().value()==Core.Enums.eMinutaMercado.Merval||a.ddlMercado.swidget().value()==Core.Enums.eMinutaMercado.Mae){a.divCruce.show()}else{a.divCruce.hide();a.chkCruce[0].checked=false}a.divTitularesCuenta.hide();a.divPredefinirPrecioReferencia.hide();a.divPrecioReferencia.removeClass("col-lg-2 col-md-2");a.divPrecioReferencia.addClass("col-lg-3 col-md-3");a.txtPrecioReferencia.removeAttr("disabled");a.divTipoOperacion.show();a.divPlazo.show();a.divEspecie.show();a.divCantidadNominales.show();a.divPrecio.show();a.divPrecioReferencia.show();a.divTotalOperacion.show();a.divUltimoPrecio.show();a.divMejorOfertaCompra.hide();a.divMejorOfertaVenta.hide();a.divVariacion.hide();a.divMonto.hide();a.divDiasPrestamo.hide();a.divTasaPrestamo.hide();a.divCuentaBalanz.show();a.divContado.show();a.setCuentaVueltaContado();if(a.ddlMercado.swidget().value()==Core.Enums.eMinutaMercado.PrestamoEfectivo){a.divTipoOperacion.hide();a.divPlazo.hide();a.divEspecie.hide();a.divCantidadNominales.hide();a.divPrecio.hide();a.divPrecioReferencia.hide();a.divTotalOperacion.hide();a.divUltimoPrecio.hide();a.divMonto.show();a.divDiasPrestamo.show();a.divTasaPrestamo.show()}if(a.ddlMercado.swidget().value()==Core.Enums.eMinutaMercado.Cambio){a.divMejorOfertaCompra.show();a.divMejorOfertaVenta.show();a.divVariacion.show();a.divPrecioReferencia.removeClass("col-lg-3 col-md-3");a.divPrecioReferencia.addClass("col-lg-2 col-md-2");a.divPredefinirPrecioReferencia.show();a.chkPredefinirPrecioReferencia[0].checked=true;a.txtPrecioReferencia.attr("disabled","disabled")}if(a.ddlMercado.swidget().value()==Core.Enums.eMinutaMercado.Facturas){a.divTipoOperacion.hide();a.divPlazo.hide();a.divEspecie.hide();a.divMonto.show();a.divCantidadNominales.hide();a.divPrecio.hide();a.divPrecioReferencia.hide();a.divTotalOperacion.hide();a.divUltimoPrecio.hide();a.divCuentaBalanz.hide();a.divContado.hide();a.divCuentaVueltaContado.hide()}};a.setControlsByTipoMinutaEspecial=function(b){a.divCuentas.hide();a.lblComitente.hide();a.lblCuentaSeleccionada.hide();a.divDisponible.hide();a.divAsesores.hide();if(a.chkTipoMinutaEspecialPorCuenta.swidget().checked()){a.divCuentas.show();a.setControlsByCuenta(b)}else{a.divAsesores.show();a.setPrecioReferenciaProductor();a.setEspecieByTipoOperacion(b)}};a.setControlsByCuenta=function(b){if(a.cuentaSeleccionada){var c=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"datoscuenta/"+encodeURIComponent(a.cuentaSeleccionada.idCuenta),requestType:"GET"});c.onSuccess=function(d){a.datosCuentaSeleccionada=d;a.lblComitente.text("Comitente Nº "+a.datosCuentaSeleccionada.DatosCuenta.NumComitente+" | "+a.datosCuentaSeleccionada.DatosCuenta.DescripcionBolsa);a.lblComitente.show();a.lblCuentaSeleccionada.text(a.cuentaSeleccionada.idCuenta+" | "+a.cuentaSeleccionada.Descripcion+" (Comitente: "+a.cuentaSeleccionada.NumComitente+")");a.lblCuentaSeleccionada.show();a.setDisponible();if(a.ddlMercado.swidget().value()==Core.Enums.eMinutaMercado.Cambio){a.loadTitularesCuenta()}a.setPrecioReferenciaProductor();a.setEspecieByTipoOperacion(b)};c.request()}else{a.setPrecioReferenciaProductor();a.setEspecieByTipoOperacion(b)}};a.setDisponible=function(){if(a.chkTipoMinutaEspecialPorCuenta.swidget().checked()&&a.cuentaSeleccionada){var b=(a.ddlPlazo.swidget().selectedItem()?a.ddlPlazo.swidget().value():Core.Enums.ePlazo.D48);var c=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"liquidez/"+encodeURIComponent(a.cuentaSeleccionada.idCuenta),requestType:"GET",requestData:{Fecha:Core.Functions.Date.getDateAsString(new Date())}});c.onSuccess=function(e){a.divDisponible.show();var d=e.liquidez;if(b==Core.Enums.ePlazo.CI){a.lblDisponible.text("Disponible: $"+d[0].DInm+" | USD "+d[1].DInm+((d[2])?(" | USD Cable "+d[2].DInm):""))}if(b==Core.Enums.ePlazo.D24){a.lblDisponible.text("Disponible: $"+d[0].D24+" | USD "+d[1].D24+((d[2])?(" | USD Cable "+d[2].D24):""))}if(b==Core.Enums.ePlazo.D48){a.lblDisponible.text("Disponible: $"+d[0].D48+" | USD "+d[1].D48+((d[2])?(" | USD Cable "+d[2].D48):""))}if(b==Core.Enums.ePlazo.D72){a.lblDisponible.text("Disponible: $"+d[0].D72+" | USD "+d[1].D72+((d[2])?(" | USD Cable "+d[2].D72):""))}};c.request()}};a.loadTitularesCuenta=function(){a.divTitularesCuenta.hide();if(a.chkTipoMinutaEspecialPorCuenta.swidget().checked()&&a.cuentaSeleccionada){var b=new Core.Ajax.ServerRequest({showOverlay:false,secureRequest:true,requestUrl:"personas/titulares/"+a.cuentaSeleccionada.idCuenta,requestType:"GET"});b.onSuccess=function(d){a.titularesCuenta=d.titulares;if(d.titulares.length>1){var c=a.ddlTitularesCuenta.swidget().initialOptions;c.dataSource.data=d.titulares;a.ddlTitularesCuenta.swidget().refresh(c);a.divTitularesCuenta.show()}};b.request()}};a.setPrecioReferencia=function(){if(a.ddlMercado.swidget().value()==Core.Enums.eMinutaMercado.Cambio&&a.chkPredefinirPrecioReferencia[0].checked){if(a.ddlTipoOperacion.swidget().selectedItem()&&a.ddlEspecie.swidget().selectedItem()&&a.ddlPlazo.swidget().selectedItem()&&a.ddlMoneda.swidget().selectedItem()){var b=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"cambio/precioreferencia/"+a.ddlTipoOperacion.swidget().selectedItem().value+"/"+a.ddlEspecie.swidget().selectedItem().idMonedaInstrumento+"/"+a.ddlPlazo.swidget().selectedItem().value+"/"+a.ddlMoneda.swidget().selectedItem().idMoneda,requestType:"GET"});b.onSuccess=function(c){if(c.data!=null){a.txtPrecioReferencia.val(c.data[0].precioReferencia)}else{a.txtPrecioReferencia.val("")}};b.request()}else{a.txtPrecioReferencia.val("")}}};a.setPrecioReferenciaProductor=function(){a.divPrecio.removeClass("col-lg-2 col-md-2 col-lg-3 col-md-3");a.divCantidadNominales.addClass("col-lg-3 col-md-3");a.divCantidadNominales.removeClass("col-lg-2 col-md-2");if(a.chkTipoMinutaEspecialPorCuenta.swidget().checked()&&a.datosCuentaSeleccionada&&a.datosCuentaSeleccionada.DatosCuenta.idProductor!="1"&&a.ddlMercado.swidget().selectedItem().idMercado!=Core.Enums.eMinutaMercado.Privado&&a.ddlMercado.swidget().selectedItem().idMercado!=Core.Enums.eMinutaMercado.PrestamoEfectivo&&a.ddlMercado.swidget().selectedItem().idMercado!=Core.Enums.eMinutaMercado.Facturas){a.divPrecio.addClass("col-lg-2 col-md-2");a.divPrecioReferencia.removeClass("col-lg-2 col-md-2 col-lg-3 col-md-3");a.divPrecioReferencia.addClass("col-lg-2 col-md-2");a.divPrecioReferenciaProductor.show();if(a.ddlMercado.swidget().selectedItem().idMercado==Core.Enums.eMinutaMercado.Cambio){a.divCantidadNominales.removeClass("col-lg-3 col-md-3");a.divCantidadNominales.addClass("col-lg-2 col-md-2")}}else{a.divPrecio.addClass("col-lg-3 col-md-3");a.divPrecioReferenciaProductor.hide()}};a.setEspecieByTipoOperacion=function(b){var c={};if(a.ddlTipoOperacion.swidget().value()==Core.Enums.eMinutaTipoOperacion.Venta&&a.chkTipoMinutaEspecialPorCuenta.swidget().checked()&&a.cuentaSeleccionada){c.idCuenta=encodeURIComponent(a.cuentaSeleccionada.idCuenta);c.plazo=a.ddlPlazo.swidget().value()}c.panel=((a.pageOptions&&a.pageOptions.minutasVersion2EspeciesPanelAsesores)?a.pageOptions.minutasVersion2EspeciesPanelAsesores:Core.Enums.ePanel.Bonos);if(a.ddlMercado.swidget().value()==Core.Enums.eMinutaMercado.Cambio){c.panel=Core.Enums.ePanel.Cambio}var d=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,allowCache:a.ddlTipoOperacion.swidget().value()==Core.Enums.eMinutaTipoOperacion.Compra,secureRequest:true,requestUrl:"especies",requestType:"GET",requestData:c});d.onSuccess=function(g){var e=g.especies==null?[]:g.especies;e=$.grep(e,function(i,h){return i.idMoneda==Core.Enums.Currency.Pesos.idMoneda});if(b&&($.grep(e,function(i,h){return i.Ticker==b}).length==0)){e.push({Ticker:b,DisplayTicker:b,Descripcion:"",Cantidad:""})}var f=a.ddlEspecie.swidget().initialOptions;f.dataSource.data=e;if(a.ddlTipoOperacion.swidget().value()==Core.Enums.eMinutaTipoOperacion.Venta&&a.ddlMercado.swidget().value()&&a.ddlMercado.swidget().value()!=Core.Enums.eMinutaMercado.Cambio){f.textTemplate="{DisplayTicker} ({Cantidad}) | {Descripcion}"}else{f.textTemplate="{DisplayTicker} | {Descripcion}"}a.ddlEspecie.swidget().refresh(f);if(b){a.ddlEspecie.swidget().value(b)}a.setPrecioReferencia();a.setLabelsByEspecie()};d.request()};a.setLabelsByEspecie=function(){var b=function(e,g){var d="field-var";if(g!=null&&g.length>1){var f=g.substr(0,1);if(f=="+"){d="field-varpositiva"}if(f=="-"){d="field-varnegativa"}}e.removeClass("field-var field-varpositiva field-varnegativa").addClass(d)};a.lblUltimoPrecio.html("");a.lblVariacion.text("");a.lblMejorOfertaCompra.text("");a.lblMejorOfertaVenta.text("");if(a.ddlMercado.swidget().value()==Core.Enums.eMinutaMercado.Cambio){if(a.ddlEspecie.swidget().selectedItem()){var c=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"cotizacionmoneda/"+a.ddlEspecie.swidget().selectedItem().idMonedaInstrumento,requestType:"GET"});c.onSuccess=function(d){a.lblUltimoPrecio.html("No disponible");a.lblVariacion.text("No disponible");b(a.lblVariacion,null);a.lblMejorOfertaCompra.text(d.Cotizacion.PrecioCompra!=null?d.Cotizacion.PrecioCompra:"No disponible");a.lblMejorOfertaVenta.text(d.Cotizacion.PrecioVenta!=null?d.Cotizacion.PrecioVenta:"No disponible")};c.request()}}else{if(a.ddlMercado.swidget().value()!=Core.Enums.eMinutaMercado.PrestamoEfectivo){if(a.ddlEspecie.swidget().value()&&a.ddlPlazo.swidget().selectedItem()&&a.ddlMoneda.swidget().selectedItem()&&a.ddlMercado.swidget().selectedItem()){var c=new Core.Ajax.ServerRequest({showOverlay:false,secureRequest:true,requestUrl:"minutas/version2/lastprice/"+(a.ddlEspecie.swidget().selectedItem()?a.ddlEspecie.swidget().selectedItem().DisplayTicker:a.ddlEspecie.swidget().value())+"/"+a.ddlPlazo.swidget().selectedItem().value+"/"+a.ddlMoneda.swidget().selectedItem().idMoneda+"/"+a.ddlMercado.swidget().selectedItem().idMercado,requestType:"GET"});c.onSuccess=function(d){a.lblUltimoPrecio.html((d&&d.UltimoPrecio!=null)?('<label style="margin-right: 10px;">'+d.UltimoPrecio+"</label> "+d.Fecha):"No encontrado")};c.request()}}}};a.setCuentaVueltaContado=function(){a.divCuentaVueltaContado.hide();if(a.chkContado[0].checked){a.divCuentaVueltaContado.show()}};a.setTotalOperacion=function(){if(a.txtCantidadNominales.val()!=""&&a.txtPrecio.val()!=""){a.lblTotalOperacion.text(Core.Functions.grid.formatNumber((parseFloat(a.txtCantidadNominales.val())*parseFloat(a.txtPrecio.val())).toFixed(6)))}};a.clonarMinuta=function(){new Core.Business.MinutasVersion2Nueva.Clonar({onSelected:function(b){a.ddlTipoOperacion.swidget().value(((b.idTipoOperacion)?b.idTipoOperacion.toString():""));a.ddlPlazo.swidget().value(((b.Plazo)?b.Plazo.toString():""));a.ddlMoneda.swidget().value(((b.idMoneda)?b.idMoneda.toString():""));a.txtCantidadNominales.val(((b.Cantidad)?b.Cantidad:""));a.txtPrecio.val(((b.Precio)?b.Precio:""));a.txtPrecioReferencia.val(((b.PrecioReferencia)?b.PrecioReferencia:""));a.txtPrecioReferenciaProductor.val(((b.Precio2)?b.Precio2:""));a.txtMonto.val(((b.Monto)?b.Monto:""));a.txtDiasPrestamo.val(((b.CantidadDiasPrestamo)?b.CantidadDiasPrestamo:""));a.txtTasaPrestamo.val(((b.TasaPrestamo)?b.TasaPrestamo:""));a.ddlCuentaBalanz.swidget().value(((b.idCuentaBalanz)?b.idCuentaBalanz.toString():""));a.chkCruce[0].checked=(b.esCruce==1);a.ddlMercado.swidget().value(((b.idMercado)?b.idMercado.toString():""));a.setTotalOperacion();a.setControlsByMercado(b.Ticker)}}).show()};a.clearFields=function(){a.ddlEspecie.swidget().refresh();a.lblUltimoPrecio.text("");a.lblVariacion.text("");a.lblMejorOfertaCompra.text("");a.lblMejorOfertaVenta.text("");a.txtCantidadNominales.val("");a.txtMonto.val("");a.txtDiasPrestamo.val("");a.txtTasaPrestamo.val("");a.txtPrecio.val("");a.txtPrecioReferencia.val("");a.txtPrecioReferenciaProductor.val("");a.txtObservaciones.val("");a.ddlCuentaBalanz.swidget().refresh();a.chkCruce[0].checked=false;a.chkContado[0].checked=false;a.divCuentaVueltaContado.hide();a.selectedCuentaVueltaContado=null;a.lblCuentaVueltaContado.text("Seleccione una cuenta");a.lblTotalOperacion.text("")}};Core.Business.MinutasVersion2Nueva.Clonar=function(b){var a=this;a.divModal=$(".modal-clonar-minuta");a.divGridMinutas=null;a.onSelected=function(){};$.extend(true,a,b);a.show=function(){a.divGridMinutas=$(".div-minutas");if(!a.divGridMinutas.swidget()){a.initGrid()}a.loadGrid()};a.initGrid=function(){a.divGridMinutas.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:[{field:"Mercado",width:"10%",title:"Mercado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{field:"Descripcion",width:"50%",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{field:"Ticker",width:"10%",title:"Ticker",headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{field:"Cantidad",width:"10%",title:"Cantidad",headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedNumber},{field:"Monto",width:"10%",title:"Monto",headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedNumber},{field:"",title:" ",width:"10%",headerAttributes:Core.Functions.grid.getCellEvenClass(),buttons:[{caption:"Clonar",cls:"",commandName:"Clonar",click:function(d){var c=a.divGridMinutas.swidget().dataItem(d);a.onSelected(c);a.divModal.modal("hide")}}]}]})};a.loadGrid=function(){var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"minutas/recientes",requestType:"GET"});c.onSuccess=function(f){var d=f.minutas==null?[]:f.minutas;var e=a.divGridMinutas.swidget().initialOptions;e.dataSource.data=d;a.divGridMinutas.swidget().refresh(e);a.divModal.modal({show:true})};c.request()};a.destroy=function(){}};Core.Business.MinutasVersion2Resumen=new function(){var a=this;a.id="minutasVersion2Resumen";a.pageOptions=null;a.divResumenMinutas=null;a.txtFilter=null;a.lblTitle=null;a.txtDateFrom=null;a.txtDateTo=null;a.ddlTicker=null;a.ddlPlazo=null;a.ddlMoneda=null;a.ddlOperador=null;a.ddlCruce=null;a.originalData=[];a.timeout=null;a.init=function(b,c){Core.loadPage("minutas-version-2-resumen.html",function(){document.title="Resumen Minutas";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divResumenMinutas=$(".div-resumen-minutas");a.txtFilter=$(".textbox-filter");a.lblTitle=$(".label-title");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.ddlTicker=$(".dropdown-ticker");a.ddlPlazo=$(".dropdown-plazo");a.ddlMoneda=$(".dropdown-moneda");a.ddlOperador=$(".dropdown-operador");a.ddlCruce=$(".dropdown-cruce");a.initControls();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.MinutasVersion2Resumen")})};a.initControls=function(){a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var b=a.divResumenMinutas.swidget().dataSource;if(value){b.filter={or:[{path:"UsuarioIngreso",filter:"contains",value:value},{path:"NumComitente",filter:"contains",value:value},{path:"DescripcionComitente",filter:"contains",value:value},{path:"Moneda",filter:"contains",value:value},{path:"Especie",filter:"contains",value:value},{path:"Ticker",filter:"contains",value:value},{path:"UsuarioOperador",filter:"contains",value:value}]}}else{b.filter=null}b.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.MinutasVersion2Resumen.txtFilter");a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(b){a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(b){a.loadGrid()}}});a.ddlTicker.shieldDropDown({dataSource:{data:[]},valueTemplate:"{Descripcion}",textTemplate:"{Descripcion}",events:{select:function(b){a.refreshGrid()}}});a.ddlMoneda.shieldDropDown({dataSource:{data:[]},valueTemplate:"{Descripcion}",textTemplate:"{Descripcion}",events:{select:function(b){a.refreshGrid()}}});a.ddlOperador.shieldDropDown({dataSource:{data:[]},valueTemplate:"{Descripcion}",textTemplate:"{Descripcion}",events:{select:function(b){a.refreshGrid()}}});a.ddlPlazo.shieldDropDown({dataSource:{data:[]},valueTemplate:"{Plazo}",textTemplate:"{Plazo}",events:{select:function(b){a.refreshGrid()}}});a.ddlCruce.shieldDropDown({dataSource:{data:[]},valueTemplate:"{Descripcion}",textTemplate:"{Descripcion}",events:{select:function(b){a.refreshGrid()}}})};a.initGrid=function(){var b=[];b.push({field:"FechaCarga",title:"Fecha Carga",width:"7%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"UsuarioIngreso",title:"Usuario Ingreso",width:"6%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"UsuarioOperador",title:"Operador",width:"6%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"NumComitente",title:"Comitente",width:"6%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"DescripcionComitente",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"20%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Operacion",title:"Tipo de Operación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Mercado",title:"Mercado",width:"5%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Plazo",title:"Plazo",width:"6%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Moneda",title:"Moneda",width:"6%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Ticker",title:"Especie",width:"6%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedNumber});b.push({field:"Precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNuleablePrice});b.push({field:"PrecioReferencia",title:"Precio Referencia",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,d,e){if(a.pageOptions.minutasVersion2ActualizarEnEstadoFinal&&d.PermitirActualizarEnEstadoFinal){c.html("<a>"+Core.Functions.grid.formatNuleablePrice(d.PrecioReferencia)+"</a>");c.addClass("link-cell");c.on("click",function(){new Core.Business.MinutasVersion2Resumen.ActualizarPrecioReferencia({minuta:d,onSuccess:function(){a.loadGrid()}}).show()})}else{c.html("<span>"+Core.Functions.grid.formatNuleablePrice(d.PrecioReferencia)+"</span>")}}});b.push({field:"Monto",title:"Monto",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNuleablePrice});if(!Core.Objects.Context.Configuration.idAplicacion){b.push({field:"Precio2",title:"Precio Productor",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNuleablePrice})}b.push({field:"Estado",title:"Estado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,d,e){c.html('<span title="'+d.Estado+'">'+d.Estado+"</span>")}});b.push({field:"EsCruce",title:"Cruce",width:"5%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatBoolean});b.push({field:"NumCuentaBalanz",title:"Cuenta Balanz",width:"8%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({title:" ",width:90,headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),columnTemplate:function(e,f,g){var d=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(e);d.on("click",function(){var h=new Core.Ajax.ServerRequest({requestUrl:"minutas/version2/auditoria/"+f.idMinuta,requestType:"GET"});h.onSuccess=function(n){var l="";if(n.transiciones&&n.transiciones.length){l+="<label>Transiciones</label>";l+="<table class='table table-striped'>";l+="<thead><tr><th>Fecha</th><th>Estado Desde</th><th>Estado Hasta</th><th>Operador</th></tr></thead>";l+="<tbody>";for(var m=0;m<n.transiciones.length;m++){l+="<tr>";l+="<td>"+n.transiciones[m].Fecha.substr(0,19)+"</td>";l+="<td>"+n.transiciones[m].EstadoDesde+"</td>";l+="<td>"+n.transiciones[m].EstadoHasta+"</td>";l+="<td>"+n.transiciones[m].Nombre+"</td>";l+="</tr>"}l+="</tbody>";l+="</table>"}if(n.logcambios&&n.logcambios.length){l+="<label>Log Cambios</label>";for(var m=0;m<n.logcambios.length;m++){l+="<table class='table table-striped'>";l+="<thead><tr><th>Fecha</th><th>Tipo Acción</th><th>Operador</th></tr></thead>";l+="<tbody>";l+="<tr>";l+="<td>"+n.logcambios[m].Fecha.substr(0,19)+"</td>";l+="<td>"+n.logcambios[m].Tipo+"</td>";l+="<td>"+n.logcambios[m].Nombre+"</td>";l+="</tr>";l+="</tbody>";l+="</table>";var k=n.logcambios[m].Contexto?n.logcambios[m].Contexto.split("||"):[];if(k.length){l+="<table class='table table-striped'>";l+="<thead><tr><th>Contexto</th><th></th><th></th></tr></thead>";l+="<tbody>";var j=0;while(j<=k.length){l+="<tr>";l+=("<td>"+(k[j]?k[j]:"")+"</td>");j++;l+=("<td>"+(k[j]?k[j]:"")+"</td>");j++;l+=("<td>"+(k[j]?k[j]:"")+"</td>");j++;l+="</tr>"}l+="</tbody>";l+="</table>"}}}new Core.Controls.Dialog(("Detalles de Minuta "+f.idMinuta),l?l:"No se encontraron detalles.",{displayButtons:{close:true,accept:false}}).show()};h.request()});if(f.PermitirAnular){var c=$('<button type="button" title="Rechazar Mesa" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(e);c.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea rechazar la minuta con ID: "+f.idMinuta+"?",{onAccepted:function(){var h={idMinuta:f.idMinuta,ContinuarFlujoFeliz:0,VersionActual:f.VersionActual};var i=new Core.Ajax.ServerRequest({overlayElement:c,secureRequest:true,requestUrl:"minutas/version2/actualizarrolbackoffice",requestType:"PUT",requestData:h});i.onSuccess=function(j){new Core.Controls.Dialog("Mensaje",((j.Descripcion)?j.Descripcion:"Minuta: "+f.idMinuta+" actualizada OK."),{displayButtons:{close:true,accept:false}}).show();a.loadGrid()};i.request()}}).show()})}}});a.divResumenMinutas.shieldGrid({dataSource:{data:[],group:[{field:"Estado",order:"asc"}]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Resumen Minutas",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["FechaCarga","FechaLiquidacion","UsuarioIngreso","UsuarioOperador","NumComitente","DescripcionComitente","Operacion","Mercado","Plazo","Moneda","Ticker","Cantidad","Precio","PrecioReferencia","Monto","Estado","Observaciones","idOrdenCambio","NumSecuenciaCambio"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"resumen-minutas"}}},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},grouping:{showGroupHeader:true,allowDragToGroup:true,message:"Arrastre un encabezado de columna para agrupar por esa columna"},columns:b})};a.loadGrid=function(){a.lblTitle.text("Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var b=new Core.Ajax.ServerRequest({overlayElement:a.divResumenMinutas.parent(),secureRequest:true,requestUrl:"minutas/version2/resumen/"+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()))+"/"+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value())),requestType:"GET"});b.onSuccess=function(d){a.originalData=d.minutas;var m=[{Ticker:"Todos",Descripcion:"Todos"}];var l=[{Plazo:"Todos",Descripcion:"Todos"}];var k=[{UsuarioOperador:"Todos",Descripcion:"Todos"}];var j=[{Moneda:"Todos",Descripcion:"Todos"}];var c=[{EsCruce:"Todos",Descripcion:"Todos"}];$.each(a.originalData,function(n,o){if(!($.grep(m,function(q,p){return q.Ticker==o.Ticker})[0])){m.push({Ticker:o.Ticker,Descripcion:o.Ticker})}if(!($.grep(l,function(r,q){return r.Plazo==o.Plazo})[0])){l.push({Plazo:o.Plazo,Descripcion:o.Plazo})}if(!($.grep(k,function(q,p){return q.UsuarioOperador==o.UsuarioOperador})[0])){k.push({UsuarioOperador:o.UsuarioOperador,Descripcion:(o.UsuarioOperador?o.UsuarioOperador:"No definido")})}if(!($.grep(j,function(q,p){return q.Moneda==o.Moneda})[0])){j.push({Moneda:o.Moneda,Descripcion:o.Moneda})}if(!($.grep(c,function(p,q){return p.EsCruce==o.EsCruce})[0])){c.push({EsCruce:o.EsCruce,Descripcion:Core.Functions.grid.formatBoolean(o.EsCruce)})}});var i=a.ddlTicker.swidget().initialOptions;i.dataSource.data=m;i.value=a.ddlTicker.swidget().value()?a.ddlTicker.swidget().value():"Todos";a.ddlTicker.swidget().refresh(i);var h=a.ddlPlazo.swidget().initialOptions;h.dataSource.data=l;h.value=a.ddlPlazo.swidget().value()?a.ddlPlazo.swidget().value():"Todos";a.ddlPlazo.swidget().refresh(h);var f=a.ddlMoneda.swidget().initialOptions;f.dataSource.data=j;f.value=a.ddlMoneda.swidget().value()?a.ddlMoneda.swidget().value():"Todos";a.ddlMoneda.swidget().refresh(f);var g=a.ddlOperador.swidget().initialOptions;g.dataSource.data=k;g.value=a.ddlOperador.swidget().value()?a.ddlOperador.swidget().value():"Todos";a.ddlOperador.swidget().refresh(g);var e=a.ddlCruce.swidget().initialOptions;e.dataSource.data=c;e.value=a.ddlCruce.swidget().value()?a.ddlCruce.swidget().value():"Todos";a.ddlCruce.swidget().refresh(e);a.refreshGrid()};b.request()};a.refreshGrid=function(){var b=$.grep(a.originalData,function(e,d){return true});if(a.ddlTicker.swidget().selectedItem()&&a.ddlTicker.swidget().selectedItem().Ticker!="Todos"){b=$.grep(b,function(e,d){return e.Ticker==a.ddlTicker.swidget().selectedItem().Ticker})}if(a.ddlPlazo.swidget().selectedItem()&&a.ddlPlazo.swidget().selectedItem().Plazo!="Todos"){b=$.grep(b,function(e,d){return e.Plazo==a.ddlPlazo.swidget().selectedItem().Plazo})}if(a.ddlMoneda.swidget().selectedItem()&&a.ddlMoneda.swidget().selectedItem().Moneda!="Todos"){b=$.grep(b,function(e,d){return e.Moneda==a.ddlMoneda.swidget().selectedItem().Moneda})}if(a.ddlOperador.swidget().selectedItem()&&a.ddlOperador.swidget().selectedItem().UsuarioOperador!="Todos"){b=$.grep(b,function(e,d){return e.UsuarioOperador==a.ddlOperador.swidget().selectedItem().UsuarioOperador})}if(a.ddlCruce.swidget().selectedItem()&&a.ddlCruce.swidget().selectedItem().EsCruce!="Todos"){b=$.grep(b,function(e,d){return e.EsCruce==a.ddlCruce.swidget().selectedItem().EsCruce})}var c=a.divResumenMinutas.swidget().initialOptions;c.dataSource.data=b;c.dataSource.group=a.divResumenMinutas.swidget().dataSource.group;c.exportOptions.excel.dataSource.data=b;c.exportOptions.excel.readDataSource=true;a.divResumenMinutas.swidget().refresh(c);a.txtFilter.keydown()}};Core.Business.MinutasVersion2Resumen.ActualizarPrecioReferencia=function(b){var a=this;a.divModal=$(".div-actualizar-precio-referencia");a.lblTitle=null;a.txtPrecioReferencia=null;a.minuta=null;a.onSuccess=function(){};$.extend(true,a,b);a.show=function(){a.lblTitle=a.divModal.find(".title");a.lblTitle.text("Actualizar Precio Referencia - Minuta: "+a.minuta.idMinuta);a.txtPrecioReferencia=a.divModal.find(".textbox-precio-referencia");new Core.Controls.DecimalPicker(a.txtPrecioReferencia,{maxDecimalDigitCount:6,showThousandsSeparator:true,defaultValue:(a.minuta.PrecioReferencia)?a.minuta.PrecioReferencia:""});Core.Functions.Validations.toggleValidation(a.txtPrecioReferencia,false);a.btnConfirmar=a.divModal.find(".btn-confirmar");a.btnConfirmar.unbind("click");a.btnConfirmar.click(function(){Core.Functions.Validations.toggleValidation(a.txtPrecioReferencia,false);var e={value:true};var c={idMinuta:a.minuta.idMinuta,VersionActual:a.minuta.VersionActual};c.PrecioReferencia=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecioReferencia,e));if(e.value){var d=new Core.Ajax.ServerRequest({overlayElement:a.btnConfirmar,showOverlay:true,secureRequest:true,requestUrl:"minutas/version2/actualizarenestadofinal",requestType:"PUT",requestData:c});d.onSuccess=function(f){a.onSuccess();a.divModal.modal("hide")};d.request()}});a.divModal.on("shown.bs.modal",function(){a.txtPrecioReferencia.focus()});a.divModal.modal({show:true})}};Core.Business.Movimientos=new function(){var a=this;a.id="movimientos";a.divMovimientos=null;a.lblTitle=null;a.divContainerMovimientosDolarBCRA=null;a.divMovimientosDolarBCRA=null;a.lblTitleDolarBCRA=null;a.txtDateFrom=null;a.txtDateTo=null;a.txtFilter=null;a.timeout=null;a.timeoutDolarBCRA=null;a.init=function(b,c){Core.loadPage("movimientos.html",function(){document.title="Movimientos";a.optionsDolarBcra=Core.Functions.Context.Profiles.getPageOptionsByMenu("monedas",Core.Objects.Context.Profiles[c]);a.divMovimientos=$(".div-movimientos");a.lblTitle=$(".label-title");a.divContainerMovimientosDolarBCRA=$(".div-container-movimientos-dolar-bcra");a.divMovimientosDolarBCRA=$(".div-movimientos-dolar-bcra");a.lblTitleDolarBCRA=$(".label-title-dolar-bcra");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.txtFilter=$(".textbox-filter");a.txtFilterDolarBCRA=$(".textbox-filter-dolar-bcra");a.initDatePickers();a.initGrid();a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var d=a.divMovimientos.swidget().dataSource;if(value){d.filter={or:[{path:"tipo",filter:"contains",value:value},{path:"descripcion",filter:"contains",value:value},{path:"ticker",filter:"contains",value:value},{path:"cantidad",filter:"contains",value:value}]}}else{d.filter=null}d.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.Movimientos.txtFilter");a.txtFilterDolarBCRA.on("keydown",function(){clearTimeout(a.timeoutDolarBCRA);a.timeoutDolarBCRA=setTimeout(function(){value=a.txtFilterDolarBCRA.val();var d=a.divMovimientosDolarBCRA.swidget().dataSource;if(value){d.filter={or:[{path:"tipo",filter:"contains",value:value},{path:"descripcion",filter:"contains",value:value},{path:"ticker",filter:"contains",value:value},{path:"cantidad",filter:"contains",value:value}]}}else{d.filter=null}d.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilterDolarBCRA,"Core.Business.Movimientos.txtFilterDolarBCRA");a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,b,c,a.loadGrid,"Core.Business.Movimientos")})};a.initDatePickers=function(){var b=new Date();b.setDate(b.getDate()-31);a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:b,max:new Date(),events:{change:function(c){a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loadGrid()}}})};a.initGrid=function(){var b=[{field:"Concertacion",title:"Concertacion",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"tipo",title:"Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getCellOddClass()},{field:"descripcion",title:"Descripcion",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"30%",headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"ticker",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getCellOddClass()},{field:"cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatPrice},{field:"Liquidacion",title:"Liquidacion",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getCellOddClass()},{field:"importe",title:"Importe",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNumber},{width:"5%",title:" ",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(c,d,e){if(d.reporte&&d.reporte!=""&&d.codigo&&d.codigo!=""){c.html('<button type="button" title="Descargar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');c.addClass("link-cell");c.on("click",function(){function g(o){var n=new Blob([o.response],{type:o.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(n);return}var h=window.URL.createObjectURL(n);var m=document.createElement("a");m.href=h;var k=o.getResponseHeader("Content-Disposition").split("; ");var j="filename=file.pdf";for(var l=0;l<k.length;l++){if(k[l].indexOf("filename")>=0){j=k[l]}}m.download=j.split("=")[1];m.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(h)}var f=new XMLHttpRequest();f.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"descargar/"+d.reporte+"/"+d.codigo,true);f.responseType="blob";f.setRequestHeader("Authorization",Core.Objects.Context.Token);f.onload=function(h){if(f.status==200){g(f)}else{var i=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga del comprobante.</p>",{displayButtons:{close:true,accept:false}});i.show()}};f.send()})}}}];a.divMovimientos.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Movimientos",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["Concertacion","tipo","descripcion","ticker","cantidad","precio","Liquidacion","moneda","importe"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Movimientos"}}},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},grouping:{showGroupHeader:true,allowDragToGroup:true,message:"Arrastre un encabezado de columna para agrupar por esa columna"},columns:b});a.divMovimientosDolarBCRA.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Movimientos Dólar Balanz",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["Concertacion","tipo","descripcion","ticker","cantidad","precio","Liquidacion","moneda","importe"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Movimientos Dólar Balanz"}}},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},grouping:{showGroupHeader:true,allowDragToGroup:true,message:"Arrastre un encabezado de columna para agrupar por esa columna"},columns:b})};a.loadGrid=function(){a.lblTitle.text("Movimientos - Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));a.lblTitleDolarBCRA.text("Movimientos dólar balanz - Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var b;b="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));b+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"movimientos/"+encodeURIComponent(a.header.selectedIdAccount),requestType:"GET",requestData:b});c.onSuccess=function(d){var e=a.divMovimientos.swidget().initialOptions;e.dataSource.data=d.movimiento;e.dataSource.group=[{field:"tipo",order:"asc"}];e.exportOptions.excel.dataSource.data=d.movimiento;e.exportOptions.excel.readDataSource=true;a.divMovimientos.swidget().refresh(e);a.txtFilter.keydown();a.divContainerMovimientosDolarBCRA.hide();if(d.movimientoDolarBalanz&&d.movimientoDolarBalanz.length&&a.optionsDolarBcra&&a.optionsDolarBcra.monedasBalanzCambio){var e=a.divMovimientosDolarBCRA.swidget().initialOptions;e.dataSource.data=d.movimientoDolarBalanz?d.movimientoDolarBalanz:[];e.dataSource.group=[{field:"tipo",order:"asc"}];e.exportOptions.excel.dataSource.data=d.movimientoDolarBalanz?d.movimientoDolarBalanz:[];e.exportOptions.excel.readDataSource=true;a.divMovimientosDolarBCRA.swidget().refresh(e);a.txtFilterDolarBCRA.keydown();a.divContainerMovimientosDolarBCRA.show()}};c.request()}};Core.Business.Login=new function(){var me=this;var KEY_CODE_ENTER=13;me.showOpenAccount=true;me.showUserPassRecovery=true;me.showFirstEntry=true;me.txtUserName=null;me.txtPassword=null;me.divLoginAlert=null;me.btnUserPassRecovery=null;me.btnFirstEntry=null;me.divMain=null;me.divOpenAccount=null;me.userData=null;me.init=function(){if(!Core.Functions.Validations.isBlockedStorage()&&Core.Functions.Persistence.getStorage()){var coreContext=LZString.decompressFromUTF16(Core.Functions.Persistence.getStorage().getItem("CoreContext"));if(coreContext){Core.Objects.Context=JSON.parse(coreContext);var coreAccounts=LZString.decompressFromUTF16(Core.Functions.Persistence.getStorage().getItem("CoreAccounts"));if(coreAccounts){Core.Objects.Accounts=JSON.parse(coreAccounts)}else{Core.Objects.Accounts=null}me.initWebSocket();var pathname=window.location.pathname.split("/")[1].replaceAll("/","");pathname=((Core.Functions.Context.whiteList.indexOf(pathname)<0)?"":pathname);if(Core.Objects.Context.Configuration&&Core.Objects.Context.Configuration.location&&Core.Objects.Context.Configuration.location.origin==window.location.origin&&Core.Functions.Context.getPathname().replaceAll("/","")==pathname){if(Core.Objects.Context.Configuration.idAplicacion==1){me.initChat()}var defaultIndexProfile=0;me.redirectToInitialPage(Core.Objects.Context.Profiles[defaultIndexProfile],Core.Objects.Context.Configuration.lastIdAccount,defaultIndexProfile);return}}}Core.loadPage("new-login.html",function(){document.title="Balanz Capital - Login";me.divUserName=$(".div-username");me.txtUserName=$(".login-username");me.divPassword=$(".div-password");me.divPassword.hide();me.txtPassword=$(".login-password");me.divLoginAlert=$(".login-alert");me.btnUserPassRecovery=$(".btn-user-recovery");me.divOpenAccount=$(".div-open-account");if(me.showOpenAccount){me.divOpenAccount.show()}else{me.divOpenAccount.hide()}if(me.showUserPassRecovery){me.btnUserPassRecovery.show()}else{me.btnUserPassRecovery.hide()}me.btnFirstEntry=$(".btn-first-entry");if(me.showFirstEntry){me.btnFirstEntry.show()}else{me.btnFirstEntry.hide()}me.divMain=$(".panel-info");new Core.Controls.CapslockWarning(me.txtPassword);me.txtUserName.focus();me.txtUserName.on("focus",function(){Core.Functions.Validations.toggleValidation(me.txtUserName,false)});me.txtPassword.on("focus",function(){Core.Functions.Validations.toggleValidation(me.txtPassword,false)});me.txtUserName.on("keyup",function(e){if(e.keyCode==KEY_CODE_ENTER){me.authenticate()}else{me.divPassword.hide()}});me.txtPassword.on("keyup",function(e){if(e.keyCode==KEY_CODE_ENTER){me.authenticate()}});Core.Objects.Context={Token:"",User:"",TokenSecret:"",Asesor:null,IdSession:0,IdPersona:0,Nombre:"",LastLogin:"",FiscalIdentifier:"",DocumentType:"",DocumentNumber:"",Email:"",Phone:"",Mobile:"",Avatar:"",TieneC4D:0,Parameters:[],Profiles:[],Timers:[],Dialogs:[],Watchlists:[],Configuration:null,TestInversor:null,Notifications:[],Banners:[]};Core.Objects.Accounts=[];if(Core.Functions.QueryString.getParameterByName("user")!=""&&Core.Functions.QueryString.getParameterByName("nonce")!=""){var requestData={};requestData.user=Core.Functions.QueryString.getParameterByName("user");requestData.nonce=Core.Functions.QueryString.getParameterByName("nonce");me.login(requestData)}})};var keyIsNull=function(value){return typeof value=="object"&&"@nil" in value};me.initWebSocket=function(){Core.Objects.Context.WebSocket=new WebSocket(Core.Debug?"wss://devusers.balanz.com/websocket":(((window.location.protocol==="https:")?"wss://":"ws://")+window.location.host+"/websocket"));Core.Objects.Context.WebSocket.onclose=function(ev){if(Core.Objects.Context.WebSocket){setTimeout(function(){if(Core.Objects.Context.WebSocket){me.initWebSocket()}},((ev.code==1006)?1800000:20000))}}};me.saveContext=function(){if(Core.Functions.Validations.isBlockedStorage()||!Core.Functions.Persistence.getStorage()){return}Core.Functions.Persistence.getStorage().setItem("CoreContext",LZString.compressToUTF16(JSON.stringify(Core.Objects.Context)))};me.authenticate=function(){if(Core.Functions.Validations.isBlockedStorage()||!Core.Functions.Persistence.getStorage()){var modal=new Core.Controls.Dialog("Aviso","<p>Estimado Cliente,<br/>La aplicación no puede validar correctamente sus credenciales si Ud. ingresa con navegación privada; deshabilite esta opción e inténtelo nuevamente.<br/>Gracias</p>",{displayButtons:{close:true,accept:false}});modal.show();return}var user=me.txtUserName.val();if(!user||!user.length){Core.Functions.Validations.toggleValidation(me.txtUserName,true);return}me.divLoginAlert.slideUp();if(me.divPassword.is(":visible")){var password=me.txtPassword.val();if(!password||!password.length){Core.Functions.Validations.toggleValidation(me.txtPassword,true);return}var requestData={user:user,pass:password};if(me.userData){requestData.nonce=me.userData.nonce}me.login(requestData)}else{var sr=new Core.Ajax.ServerRequest({overlayElement:me.divMain,secureRequest:false,requestUrl:"auth/init",requestType:"POST",requestData:{data:{user:user,source:"WebV1"}}});sr.onSuccess=function(responseObject){me.userData=responseObject;if(me.userData&&me.userData.URLAuth&&me.userData.tipoAutenticacion==Core.Enums.eTipoAutenticacion.Microsoft){window.location.href=me.userData.URLAuth}else{me.divPassword.show();me.txtPassword.val("");me.txtPassword.focus()}};sr.onError=function(e){if(e.status==401){me.divLoginAlert.text(e.responseJSON.Descripcion);me.divLoginAlert.slideDown();Core.Functions.Validations.toggleValidation(me.txtPassword,true)}else{var title=(e.responseJSON&&e.responseJSON.Descripcion)?"Mensaje":"Error de conexión";var description=(e.responseJSON&&e.responseJSON.Descripcion)?"<p>"+e.responseJSON.Descripcion+"</p>":"<p>En estos momentos el sistema no esta disponible. Por favor intente mas tarde...</p>";var modal=new Core.Controls.Dialog(title,description,{displayButtons:{close:true,accept:false}});modal.show()}};sr.request()}};me.redictToPage=function(responseLogin){var defaultIndexProfile=0;if(responseLogin.Terminos){var divTerminosyCondiciones=$(".terminos-y-condiciones-modal");var chkAccept=divTerminosyCondiciones.find(".checkbox-accept");divTerminosyCondiciones.find(".terminos-y-condiciones-link").attr("href",responseLogin.Terminos.urlTyC);divTerminosyCondiciones.find(".btn-accept").unbind("click");divTerminosyCondiciones.find(".btn-accept").click(function(){if(chkAccept[0].checked){divTerminosyCondiciones.modal("hide");var sr=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"terminos/aceptartyc",requestType:"POST",requestData:{idPersona:responseLogin.idPersona,idTerminoYCondicion:responseLogin.Terminos.idTerminoYCondicion}});sr.onSuccess=function(responseTerminos){divTerminosyCondiciones.on("hidden.bs.modal",function(){me.initWebSocket();me.redirectToInitialPage(Core.Objects.Context.Profiles[defaultIndexProfile],0,defaultIndexProfile)})};sr.request()}});divTerminosyCondiciones.modal({show:true})}else{me.initWebSocket();me.redirectToInitialPage(Core.Objects.Context.Profiles[defaultIndexProfile],0,defaultIndexProfile)}};me.redirectToInitialPage=function(option,idDefaultAccount,defaultIndexProfile){var forward=null;var parameters=window.location.search.replace("?","").split("&");var json={};parameters.forEach(function(o,i){var parameterName=o.split("=")[0];var parameterValue=o.split("=")[1];if(parameterName!="forward"){json[parameterName]=decodeURIComponent(parameterValue)}else{forward=parameterValue}});var pageForward=((forward)?Core.Functions.Context.Profiles.searchPageByPath(forward,Core.Objects.Context.Profiles[defaultIndexProfile]):null);if(pageForward){eval(pageForward.namespace+".init("+idDefaultAccount+", "+defaultIndexProfile+", "+JSON.stringify(json)+");")}else{if(option.menu!=null&&option.menu.length>0){me.redirectToInitialPage(option.menu[0],idDefaultAccount,defaultIndexProfile)}else{eval(option.namespace+".init("+idDefaultAccount+", "+defaultIndexProfile+");")}}};me.initChat=function(){var balanzChat=$(".balanz-chat-widget-element");if(balanzChat.length==0&&Core.Objects.Context.Profiles[0]&&Core.Objects.Context.Profiles[0].opciones&&Core.Objects.Context.Profiles[0].opciones.mostrarChatWeb&&(window.location.hostname=="clientes.balanz.com"||window.location.hostname=="dev.balanz.com")){$('<script type="text/javascript" src="https://widgets.balanz.com/components/'+(window.location.hostname=="clientes.balanz.com"?"":"desa/")+'chat-clientes/latest/balanz-chat-widget-element.js"></script>').appendTo($("html"));balanzChat=$('<balanz-chat-widget-element class="balanz-chat-widget-element"></balanz-chat-widget-element>').appendTo($("html"));balanzChat.attr("token",Core.Objects.Context.Token);balanzChat.attr("person",Core.Objects.Context.IdPersona);balanzChat.attr("name",Core.Objects.Context.Nombre);balanzChat.attr("compacto",true);balanzChat.attr("showchatweb",true);balanzChat.attr("showchatwhatsapp",Core.Objects.Context.Profiles[0].opciones.mostrarChatWhatsapp?true:false)}};me.login=function(requestData){requestData.source="WebV1";var sr=new Core.Ajax.ServerRequest({overlayElement:me.divMain,secureRequest:false,requestUrl:"auth/login",requestType:"POST",requestData:{data:requestData}});sr.onSuccess=function(responseObject){if(keyIsNull(responseObject.idSesion)){me.divLoginAlert.text("Su usuario ó su clave no coinciden.");me.divLoginAlert.slideDown();Core.Functions.Validations.toggleValidation(me.txtPassword,true);return}Core.Objects.Context.Token=responseObject.AccessToken;Core.Objects.Context.User=requestData.user;Core.Objects.Context.Asesor=responseObject.Asesor;Core.Objects.Context.IdSession=responseObject.idSesion;Core.Objects.Context.IdPersona=responseObject.idPersona;Core.Objects.Context.Nombre=responseObject.Nombre;Core.Objects.Context.LastLogin=responseObject.UltimoLogin;Core.Objects.Context.FiscalIdentifier=responseObject.CUIL;Core.Objects.Context.DocumentType=responseObject.TipoDocumento;Core.Objects.Context.DocumentNumber=responseObject.Documento;Core.Objects.Context.Email=responseObject.email;Core.Objects.Context.Phone=responseObject.TelefonoFijo;Core.Objects.Context.Mobile=responseObject.TelefonoMovil;Core.Objects.Context.Avatar=responseObject.Avatar;Core.Objects.Context.TieneC4D=responseObject.tieneC4D;Core.Objects.Context.Parameters=responseObject.Parametros;Core.Objects.Context.Configuration=Core.Objects.Configuration;Core.Objects.Context.Configuration.idAplicacion=responseObject.idAplicacion;Core.Objects.Context.Configuration.idProductor=responseObject.idProductor;Core.Objects.Context.Configuration.location=window.location;Core.Objects.Context.Configuration.lastIdAccount=0;Core.Objects.Context.Profiles=Core.Functions.Context.Profiles.extendParametersByUserLevel(responseObject.Permisos);Core.Objects.Context.Timers=[];Core.Objects.Context.Watchlists=null;Core.Objects.Context.TestInversor=null;Core.Objects.Context.Notifications=[];Core.Objects.Context.Banners=[];Core.Objects.Context.CommonParameters=null;Core.Objects.Accounts=null;me.saveContext();var srCommonParameters=new Core.Ajax.ServerRequest({overlayElement:me.divMain,secureRequest:true,requestUrl:"comun/parametrosnegocio",requestType:"GET"});srCommonParameters.onSuccess=function(responseCommonParameters){Core.Objects.Context.CommonParameters=responseCommonParameters;if(responseCommonParameters.Monedas){for(var key in Core.Enums.Currency){var moneda=$.grep(responseCommonParameters.Monedas,function(obj,index){return obj.idMoneda==Core.Enums.Currency[key].idMoneda})[0];if(moneda){Core.Enums.Currency[key]=moneda}}}getBanners()};srCommonParameters.onError=function(e){Core.Objects.Context.CommonParameters=null;getBanners()};srCommonParameters.request();function getBanners(){var srBanners=new Core.Ajax.ServerRequest({overlayElement:me.divMain,secureRequest:true,requestUrl:"banners",requestType:"GET"});srBanners.onSuccess=function(responseBanners){Core.Objects.Context.Banners=responseBanners.banners;goon()};srBanners.onError=function(e){Core.Objects.Context.Banners=[];goon()};srBanners.request()}function goon(){if(Core.Objects.Context.Configuration.idAplicacion==1){dataLayer.push({event:"login",method:"email"});me.initChat();var srTestInversor=new Core.Ajax.ServerRequest({overlayElement:me.divMain,secureRequest:true,requestUrl:"testinversor",requestType:"GET"});srTestInversor.onSuccess=function(responseTest){Core.Objects.Context.TestInversor=responseTest;me.saveContext();me.redictToPage(responseObject)};srTestInversor.onError=function(e){Core.Objects.Context.TestInversor=null;me.saveContext();me.redictToPage(responseObject)};srTestInversor.request()}else{me.saveContext();me.redictToPage(responseObject)}}};sr.onError=function(e){me.divPassword.hide();me.txtUserName.focus();if(e.status==401){me.divLoginAlert.text(e.responseJSON.Descripcion);me.divLoginAlert.slideDown();Core.Functions.Validations.toggleValidation(me.txtPassword,true)}else{var title=(e.responseJSON&&e.responseJSON.Descripcion)?"Mensaje":"Error de conexión";var description=(e.responseJSON&&e.responseJSON.Descripcion)?"<p>"+e.responseJSON.Descripcion+"</p>":"<p>En estos momentos el sistema no esta disponible. Por favor intente mas tarde...</p>";var modal=new Core.Controls.Dialog(title,description,{displayButtons:{close:true,accept:false}});modal.show()}};sr.request()}};Core.Business.Notificaciones=new function(){var a=this;a.id="notificaciones";a.idDefaultAccount=null;a.idDefaultProfile=null;a.divNotificaciones=null;a.init=function(b,c){Core.loadPage("notificaciones.html",function(){document.title="Notificaciones";a.idDefaultAccount=b;a.idDefaultProfile=c;a.divNotificaciones=$(".div-notificaciones");a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.getNotifications()},"Core.Business.Notificaciones")})};a.getNotifications=function(){var b=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"notificaciones?historico=1",requestType:"GET"});b.onSuccess=function(c){a.notifications=c.notificaciones;a.loadNotifications()};b.request()};a.loadNotifications=function(){var b="";b+=a.notifications.map(function(d,c){return"<div class='feed-element notification-item' id-notification='"+d.idnotificacion+"'><div class='style-scope ytd-notification-renderer float-left "+((d.estado)?"visto":"new m-new")+"'></div><a class='float-left'><img class='rounded-circle' src='"+d.icono+"'></a><div class='media-body'><small class='float-right'>"+Core.Functions.Date.getElapsedTime(new Date(d.fecha))+"</small>"+d.texto+"<br/><small class='text-muted'>"+d.fecha.substr(0,16).replace("T"," ")+"</small></div></div>"}).join("");a.divNotificaciones.html(b);a.divNotificaciones.off("click");a.divNotificaciones.on("click",".notification-item",function(){var c=$(this).attr("id-notification");var d=$.grep(a.notifications,function(f,e){return f.idnotificacion==c})[0];if(d){if(d.auto&&!d.estado){a.deleteNotification(d,a.executeNotification)}else{a.executeNotification(d)}}})};a.deleteNotification=function(b,c){var d=new Core.Ajax.ServerRequest({showOverlay:false,secureRequest:true,requestUrl:"notificaciones/"+encodeURIComponent(b.idnotificacion),requestType:"POST"});d.onSuccess=function(){Core.Objects.Context.Notifications=$.grep(Core.Objects.Context.Notifications,function(f,e){return f.idnotificacion!=b.idnotificacion});if(!Core.Functions.Validations.isBlockedStorage()&&Core.Functions.Persistence.getStorage()){Core.Functions.Persistence.getStorage().setItem("CoreContext",LZString.compressToUTF16(JSON.stringify(Core.Objects.Context)))}a.notifications.forEach(function(f,e){if(f.idnotificacion==b.idnotificacion){f.estado=1}});if(c){c(b)}};d.request()};a.executeNotification=function(b){Core.Functions.Notification.execute(b,a.idDefaultAccount,a.idDefaultProfile,function(){a.loadNotifications();a.header.loadDdlNotifications(false)})}};Core.Business.ObligacionesNegociables=new function(){var a=this;a.id="cot_obligacionesnegociables";a.optionsCotizaciones=null;a.divObligacionesNegociables=null;a.txtFilterObligacionesNegociables=null;a.timeoutObligacionesNegociables=null;a.divChksMonedas=null;a.lblChkPesos=null;a.chkPesos=null;a.lblChkDolaresMep=null;a.chkDolaresMep=null;a.lblChkDolaresCable=null;a.chkDolaresCable=null;a.divPlazo=null;a.ddlPlazo=null;a.maxToken=0;a.lastData=null;a.window=$(window);a.timerId=null;a.timerIdForceRefresh=null;a.loaded=false;a.refresh=false;a.forceRefresh=false;a.init=function(b,c){Core.loadPage("obligaciones-negociables.html",function(){document.title="ObligacionesNegociables";a.loaded=false;a.refresh=false;a.forceRefresh=false;a.optionsCotizaciones=Core.Functions.Context.Profiles.getPageOptionsByMenu("cotizaciones",Core.Objects.Context.Profiles[c]);a.maxToken=0;a.lastData=null;a.divObligacionesNegociables=$(".div-obligaciones-negociables");a.txtFilterObligacionesNegociables=$(".textbox-obligaciones-negociables-filter");a.divChksMonedas=$(".div-chks-monedas");a.divChksMonedas.hide();a.lblChkPesos=$(".lbl-checkbox-pesos");a.chkPesos=$(".checkbox-pesos");a.chkPesos[0].checked=true;a.lblChkDolaresMep=$(".lbl-checkbox-dolares-mep");a.chkDolaresMep=$(".checkbox-dolares-mep");a.chkDolaresMep[0].checked=true;a.lblChkDolaresCable=$(".lbl-checkbox-dolares-cable");a.chkDolaresCable=$(".checkbox-dolares-cable");a.chkDolaresCable[0].checked=true;a.divPlazo=$(".div-plazo");a.ddlPlazo=$(".dropdown-plazo");a.divPlazo.hide();Core.Functions.grid.Cotizaciones.initGrid(a.divObligacionesNegociables,true,true,false,Core.Objects.Context.Profiles[c].opciones.maxWatchlists,null,null,a.optionsCotizaciones.cot_profundidad,Core.Enums.ePanel.ONs,b,c);a.ddlPlazo.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",events:{select:function(d){a.setTab()}},width:150});a.chkPesos.on("change",function(){a.setTab()});a.chkDolaresMep.on("change",function(){a.setTab()});a.chkDolaresCable.on("change",function(){a.setTab()});Core.Functions.grid.Cotizaciones.initFilter(a.divObligacionesNegociables,a.txtFilterObligacionesNegociables,a.timeoutObligacionesNegociables,a.window);a.ddlInstrumentSearch=$(".dropdown-instrument-search");Core.Functions.grid.Cotizaciones.initInstrumentSearch(a.ddlInstrumentSearch,b,c);a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){Core.Functions.grid.Cotizaciones.loadInstrumentSearch(b,a.ddlInstrumentSearch,function(){a.setTab()})},"Core.Business.ObligacionesNegociables")})};a.setTab=function(){Core.Functions.grid.Cotizaciones.details=[];a.maxToken=0;a.lastData=null;a.refresh=false;a.forceRefresh=false;if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:0,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(b){}}window.clearInterval(a.timerId);Core.Objects.Context.Timers.remove(a.timerId);window.clearInterval(a.timerIdForceRefresh);Core.Objects.Context.Timers.remove(a.timerIdForceRefresh);Core.Functions.grid.Cotizaciones.loadGrid(a.divObligacionesNegociables,null,"obligacionesnegociables",a.lastData,a.maxToken,null,null,function(c,b){return(!a.loaded||(c.plazo==a.ddlPlazo.swidget().selectedItem().value&&a.filterMoneda(c.mo)))},function(e,f){a.lastData=e;a.maxToken=f;if(!a.loaded){var h=[];var g=[];a.lastData.forEach(function(j,i){if(h.indexOf(j.plazo)==-1){h.push(j.plazo)}if(g.indexOf(j.mo)==-1){g.push(j.mo)}});var b=[];h.forEach(function(j,i){b.push({value:j,text:j})});var c=a.ddlPlazo.swidget().initialOptions;c.dataSource.data=b;a.ddlPlazo.swidget().refresh(c);a.ddlPlazo.swidget().selected(h.length-1,true);if(h.length>1){a.divPlazo.show()}if(g.length>1){a.divChksMonedas.show();if(g.indexOf("Pesos")==-1){a.chkPesos.hide();a.lblChkPesos.hide()}if(g.indexOf("Dolar MEP")==-1){a.chkDolaresMep.hide();a.lblChkDolaresMep.hide()}if(g.indexOf("Dolar Cable")==-1){a.chkDolaresCable.hide();a.lblChkDolaresCable.hide()}}a.loaded=true;var d=a.divObligacionesNegociables.swidget().initialOptions;d.dataSource.data=$.grep(a.lastData,function(j,i){return(j.plazo==a.ddlPlazo.val()&&a.filterMoneda(j.mo))});a.divObligacionesNegociables.swidget().refresh(d)}},a.optionsCotizaciones.cot_profundidad);a.timerId=window.setInterval(function(){if(a.loaded&&(a.refresh||a.forceRefresh)){Core.Functions.grid.Cotizaciones.loadGrid(a.divObligacionesNegociables,null,"obligacionesnegociables",a.lastData,a.maxToken,null,null,function(c,b){return(c.plazo==a.ddlPlazo.swidget().selectedItem().value&&a.filterMoneda(c.mo))},function(b,c){a.lastData=b;a.maxToken=c},a.optionsCotizaciones.cot_profundidad);a.forceRefresh=false}a.refresh=true},Core.Functions.grid.Cotizaciones.REFRESH_TIME);Core.Objects.Context.Timers.push(a.timerId);a.timerIdForceRefresh=window.setInterval(function(){a.forceRefresh=true},600000);Core.Objects.Context.Timers.push(a.timerIdForceRefresh);if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:Core.Enums.ePanel.ONs,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(c){if(a.loaded){var b={cotizaciones:[]};b.cotizaciones.push(JSON.parse(c.data));Core.Functions.grid.Cotizaciones.refreshGrid(b,a.divObligacionesNegociables,null,a.lastData,a.maxToken,null,null,function(e,d){return(e.plazo==a.ddlPlazo.swidget().selectedItem().value&&a.filterMoneda(e.mo))},function(d,e){a.lastData=d;a.maxToken=e;a.refresh=false},a.optionsCotizaciones.cot_profundidad)}}}};a.filterMoneda=function(b){return(b=="Pesos"&&(!a.divChksMonedas.is(":visible")||(a.chkPesos[0].checked)))||(b=="Dolar MEP"&&(!a.divChksMonedas.is(":visible")||(a.chkDolaresMep[0].checked)))||(b=="Dolar Cable"&&(!a.divChksMonedas.is(":visible")||(a.chkDolaresCable[0].checked)))}};Core.Business.ObtenerBoletosBCI=new function(){var a=this;a.id="mesaBoletosBCI";a.lblTitle=null;a.txtDateFrom=null;a.txtDateTo=null;a.chkIncluirExportados=null;a.chkIncluirIgnorados=null;a.btnRefresh=null;a.divBoletosBCI=null;a.originalData=null;a.init=function(b,c){Core.loadPage("obtener-boletos-bci.html",function(){document.title="Boletos BCI";a.divBoletosBCI=$(".div-boletos-bci");a.lblTitle=$(".label-title");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.chkIncluirExportados=$(".checkbox-incluir-exportados");a.chkIncluirIgnorados=$(".checkbox-incluir-ignorados");a.btnRefresh=$(".btn-refresh");a.originalData=null;a.initControls();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.ObtenerBoletosBCI")})};a.initControls=function(){a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),events:{change:function(b){a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),events:{change:function(b){a.loadGrid()}}});a.chkIncluirExportados[0].checked=false;a.chkIncluirExportados.on("change",function(){a.refreshGrid()});a.chkIncluirIgnorados[0].checked=false;a.chkIncluirIgnorados.on("change",function(){a.refreshGrid()});a.btnRefresh.on("click",function(){a.loadGrid()})};a.initGrid=function(){var b=[];b.push({width:"6%",field:"cantidad",title:"Cantidad",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({width:"8%",field:"isin",title:"Isin",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({width:"4%",field:"abrev",title:"Abrev",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({width:"4%",field:"moneda",title:"Moneda",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({width:"5%",field:"concert",title:"Concert",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({width:"5%",field:"liq",title:"Liq",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({width:"6%",field:"precio",title:"Precio",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatPrice});b.push({width:"6%",field:"tipoDeOp",title:"Tipo de Op",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({width:"3%",field:"EsMAE",title:"MAE",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({width:"3%",field:"agente",title:"Agente",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({width:"3%",field:"hora",title:"Hora",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({width:"4%",field:"tipoDeLiq",title:"Tipo de Liq",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({width:"4%",field:"esDescubierto",title:"Descubierto",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({width:"4%",field:"comitente",title:"Comitente",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({width:"5%",field:"liquidaPor",title:"Liquida Por",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({width:"4%",field:"cuentaEnDep",title:"Cuenta en Dep",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({width:"7%",field:"NetoPesos",title:"Neto Pesos",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatPrice});b.push({width:"7%",field:"NetoDolares",title:"Neto Dolares",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatPrice});b.push({width:"4%",field:"NumBoleto",title:"Núm Boleto",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({width:"4%",field:"EnVBPanama",title:"VB Pan",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({width:"4%",field:"NumMinutaPanama",title:"Minuta",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({width:"4%",field:"ignorados",title:"Ignorado",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});b.push({title:" ",width:40,headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,f,e){if(f.color){d.parent().css("background-color","rgba("+a.hexToRgb(f.color)+((e%2==0)?", 0.6":", 1 ")+")")}if(f.EnVBPanama=="NO"){var c=$('<button type="button" title="'+((f.ignorados=="SI")?"Activar":"Ignorar")+'" class="btn-sm balanz-button"><span class="glyphicon '+((f.ignorados=="SI")?"glyphicon-ok":"glyphicon-remove")+'"></span></button>').appendTo(d);c.on("click",function(){var g={idTipoExportacion:f.idTipoExportacion,CodCtaCorriente:f.CodCtaCorriente,CodComitente:f.CodComitente,NumBoleto:f.NumBoleto};if(f.ignorados=="SI"){g.eliminar=1}var h=new Core.Ajax.ServerRequest({overlayElement:c,secureRequest:true,requestUrl:"ignorarexportacion",requestType:"POST",requestData:g});h.onSuccess=function(){a.loadGrid()};h.request()})}}});a.divBoletosBCI.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:100,pageLinksCount:10},columns:b,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Boletos BCI",columnFields:["cantidad","isin","abrev","moneda","concert","liq","precio","tipoDeOp","EsMAE","agente","hora","tipoDeLiq","esDescubierto","comitente","liquidaPor","cuentaEnDep","NetoPesos","NetoDolares","NumBoleto","EnVBPanama","NumMinutaPanama"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Boletos BCI"}}}})};a.loadGrid=function(){var b;b="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));b+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"exportar/boletosbci",requestType:"GET",requestData:b});c.onSuccess=function(d){a.originalData=d.boletos;a.refreshGrid()};c.request()};a.refreshGrid=function(){var b=$.grep(a.originalData,function(e,d){return true});if(!a.chkIncluirExportados[0].checked){b=$.grep(b,function(e,d){return e.EnVBPanama=="NO"})}if(!a.chkIncluirIgnorados[0].checked){b=$.grep(b,function(e,d){return e.ignorados=="NO"})}var c=a.divBoletosBCI.swidget().initialOptions;c.dataSource.data=b;c.exportOptions.excel.dataSource.data=b;c.exportOptions.excel.readDataSource=true;a.divBoletosBCI.swidget().refresh(c)};a.hexToRgb=function(d){d=d.replace("#","");var f=parseInt(d.substring(0,2),16);var e=parseInt(d.substring(2,4),16);var c=parseInt(d.substring(4,6),16);var h=f+","+e+","+c;return h}};Core.Business.Opciones=new function(){var a=this;a.id="cot_opciones";a.optionsCotizaciones=null;a.divOpciones=null;a.txtFilterOpciones=null;a.divPlazo=null;a.ddlPlazo=null;a.timeoutOpciones=null;a.maxToken=0;a.lastData=null;a.idDefaultAccount=null;a.idDefaultProfile=null;a.timerId=null;a.timerIdForceRefresh=null;a.loaded=false;a.refresh=false;a.forceRefresh=false;a.window=$(window);a.init=function(b,c){Core.loadPage("opciones.html",function(){document.title="Opciones";a.idDefaultAccount=b;a.idDefaultProfile=c;a.loaded=false;a.refresh=false;a.forceRefresh=false;a.optionsCotizaciones=Core.Functions.Context.Profiles.getPageOptionsByMenu("cotizaciones",Core.Objects.Context.Profiles[c]);a.maxToken=0;a.lastData=null;a.divOpciones=$(".div-opciones");a.txtFilterOpciones=$(".textbox-opciones-filter");a.divPlazo=$(".div-plazo");a.divPlazo.hide();a.ddlPlazo=$(".dropdown-plazo");Core.Functions.grid.Cotizaciones.initGrid(a.divOpciones,true,true,false,Core.Objects.Context.Profiles[c].opciones.maxWatchlists,null,null,a.optionsCotizaciones.cot_profundidad,Core.Enums.ePanel.Opciones,a.idDefaultAccount,a.idDefaultProfile);a.ddlPlazo.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",events:{select:function(d){a.setTab()}},width:150});Core.Functions.grid.Cotizaciones.initFilter(a.divOpciones,a.txtFilterOpciones,a.timeoutOpciones,a.window);a.ddlInstrumentSearch=$(".dropdown-instrument-search");Core.Functions.grid.Cotizaciones.initInstrumentSearch(a.ddlInstrumentSearch,b,c);a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){Core.Functions.grid.Cotizaciones.loadInstrumentSearch(b,a.ddlInstrumentSearch,function(){a.setTab()})},"Core.Business.Opciones")})};a.setTab=function(){Core.Functions.grid.Cotizaciones.details=[];a.maxToken=0;a.lastData=null;a.refresh=false;a.forceRefresh=false;if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:0,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(b){}}window.clearInterval(a.timerId);Core.Objects.Context.Timers.remove(a.timerId);window.clearInterval(a.timerIdForceRefresh);Core.Objects.Context.Timers.remove(a.timerIdForceRefresh);Core.Functions.grid.Cotizaciones.loadGrid(a.divOpciones,null,"opciones",a.lastData,a.maxToken,null,null,function(c,b){return(!a.loaded||c.plazo==a.ddlPlazo.swidget().selectedItem().value)},function(e,f){a.lastData=e;a.maxToken=f;if(!a.loaded){var g=[];a.lastData.forEach(function(i,h){if(g.indexOf(i.plazo)==-1){g.push(i.plazo)}});var b=[];g.forEach(function(i,h){b.push({value:i,text:i})});var c=a.ddlPlazo.swidget().initialOptions;c.dataSource.data=b;a.ddlPlazo.swidget().refresh(c);a.ddlPlazo.swidget().selected(g.length-1,true);if(g.length>1){a.divPlazo.show()}a.loaded=true;var d=a.divOpciones.swidget().initialOptions;d.dataSource.data=$.grep(a.lastData,function(i,h){return i.plazo==a.ddlPlazo.val()});a.divOpciones.swidget().refresh(d)}},a.optionsCotizaciones.cot_profundidad);a.timerId=window.setInterval(function(){if(a.loaded&&(a.refresh||a.forceRefresh)){Core.Functions.grid.Cotizaciones.loadGrid(a.divOpciones,null,"opciones",a.lastData,a.maxToken,null,null,function(c,b){return c.plazo==a.ddlPlazo.swidget().selectedItem().value},function(b,c){a.lastData=b;a.maxToken=c},a.optionsCotizaciones.cot_profundidad);a.forceRefresh=false}a.refresh=true},Core.Functions.grid.Cotizaciones.REFRESH_TIME);Core.Objects.Context.Timers.push(a.timerId);a.timerIdForceRefresh=window.setInterval(function(){a.forceRefresh=true},600000);Core.Objects.Context.Timers.push(a.timerIdForceRefresh);if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:Core.Enums.ePanel.Opciones,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(c){if(a.loaded){var b={cotizaciones:[]};b.cotizaciones.push(JSON.parse(c.data));Core.Functions.grid.Cotizaciones.refreshGrid(b,a.divOpciones,null,a.lastData,a.maxToken,null,null,function(e,d){return e.plazo==a.ddlPlazo.swidget().selectedItem().value},function(d,e){a.lastData=d;a.maxToken=e;a.refresh=false},a.optionsCotizaciones.cot_profundidad)}}}}};Core.Business.OpenManagerAltaCuenta=new function(){var a=this;a.id="openManagerAltaCuenta";a.idDefaultAccount=null;a.idDefaultProfile=null;a.container=null;a.containerAltaCuenta=null;a.init=function(b,c,d){Core.loadPage("open-manager-alta-cuenta.html",function(){document.title="Legajo";a.idDefaultAccount=b;a.idDefaultProfile=c;$(".default-modal").modal("hide");a.containerAltaCuenta=$(".div-container-alta-cuenta");a.containerAltaCuenta.hide();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.containerAltaCuenta.show();var e=new Core.Controls.ManagerAltaCuenta({idAperturaCuenta:d.idAperturaCuenta,readOnly:true,container:a.containerAltaCuenta,idDefaultAccount:a.idDefaultAccount,idDefaultProfile:a.idDefaultProfile,namespaceActivo:"OpenManagerAltaCuenta"}).show()},"Core.Business.OpenManagerAltaCuenta")})}};Core.Business.OperatoriaConEntidades=new function(){var a=this;a.id="homeOperatoriaConEntidades";a.divOperatoria=null;a.lblTitle=null;a.txtDateFrom=null;a.txtDateTo=null;a.txtFilter=null;a.pageOptions=null;a.timeout=null;a.init=function(b,c){Core.loadPage("operatoria-con-entidades.html",function(){document.title="Operatorias con Entidades";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divOperatoria=$(".div-operatoria");a.lblTitle=$(".label-title");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.txtFilter=$(".textbox-filter");a.initDatePickers();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.OperatoriaConEntidades")})};a.initDatePickers=function(){var b=new Date();b.setDate(1);a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:b,max:new Date(),events:{change:function(c){a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loadGrid()}}})};a.initGrid=function(){var b=[];b.push({field:"Fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatStringDate});b.push({field:"Especie",title:"Especie",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Accion",title:"Acción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Plazo",title:"Plazo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNuleablePrice});b.push({field:"Precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNuleablePrice});b.push({field:"Valorizacion",title:"Valorización",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNuleablePrice});b.push({field:"Entidad",title:"Entidad",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});a.divOperatoria.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],paging:{pageSize:100,pageLinksCount:10},exportOptions:{excel:{fileName:"Operatoria con Entidades",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["Fecha","Especie","Accion","Plazo","Moneda","Cantidad","Precio","Valorizacion","Entidad"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Operatoria con Entidades"}}},selection:false,rowHover:false,sorting:{multiple:true},columns:b});a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var c=a.divOperatoria.swidget().dataSource;if(value){c.filter={or:[{path:"Fecha",filter:"contains",value:value},{path:"Especie",filter:"contains",value:value},{path:"Accion",filter:"contains",value:value},{path:"Plazo",filter:"contains",value:value},{path:"Moneda",filter:"contains",value:value},{path:"Cantidad",filter:"contains",value:value},{path:"Precio",filter:"contains",value:value},{path:"Valorizacion",filter:"contains",value:value},{path:"Entidad",filter:"contains",value:value}]}}else{c.filter=null}c.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.OperatoriaConEntidades.txtFilter")};a.loadGrid=function(){if(a.txtDateFrom.swidget().value()&&a.txtDateTo.swidget().value()){a.lblTitle.text("Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var c=new Core.Ajax.ServerRequest({overlayElement:a.divOperatoria.parent(),secureRequest:true,requestUrl:"reporteBCRA/OperacionesConEntidades/"+a.formatDateAsString(a.txtDateFrom.swidget().value())+"/"+a.formatDateAsString(a.txtDateTo.swidget().value()),requestType:"GET"});c.onSuccess=function(d){var e=a.divOperatoria.swidget().initialOptions;e.dataSource.data=d;e.dataSource.schema={data:"operaciones"};e.exportOptions.excel.dataSource.data=d;e.exportOptions.excel.dataSource.schema={data:"operaciones"};e.exportOptions.excel.readDataSource=true;a.divOperatoria.swidget().refresh(e);a.txtFilter.keydown()};c.request()}else{var b=new Core.Controls.Dialog("Aviso","Las fechas ingresadas no son válidas.",{displayButtons:{close:true,accept:false}});b.show()}};a.formatDateAsString=function(b){if(!b){return""}return b.getFullYear().toString()+"-"+Core.Functions.Date.getTwoCharsNumber(b.getMonth()+1)+"-"+Core.Functions.Date.getTwoCharsNumber(b.getDate())}};Core.Business.ACDIOrdenes=new function(){var a=this;a.id="acdiOrdenes";a.divOrdenes=null;a.lblTitle=null;a.txtDateFrom=null;a.txtDateTo=null;a.btnRefresh=null;a.btnPreseleccionar=null;a.btnGenerarLotes=null;a.txtFilter=null;a.chkIncluirFinalizadas=null;a.ddlLote=null;a.divEstados=null;a.divContadoresDetalle=null;a.originalData=[];a.eLoteFiltro={Todos:0,SinLote:1,ConLote:2};a.pageOptions=null;a.timeout=null;a.init=function(b,c){Core.loadPage("ordenes-acdi.html",function(){document.title="Ordenes ACDI";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divOrdenes=$(".div-ordenes");a.lblTitle=$(".label-title");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.txtFilter=$(".textbox-filter");a.chkIncluirFinalizadas=$(".checkbox-incluir-finalizadas");a.ddlLote=$(".dropdown-filtro-lote");a.btnRefresh=$(".btn-refresh");a.btnPreseleccionar=$(".btn-preseleccionar");a.btnGenerarLotes=$(".btn-generar-lotes");a.divEstados=$(".div-estados");a.divContadoresDetalle=$(".div-detalle-contadores");a.initControls();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.ACDIOrdenes")})};a.initControls=function(){var b=new Date();b.setDate(b.getDate()-1);a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:b,max:new Date(),events:{change:function(c){a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loadGrid()}}});a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var c=a.divOrdenes.swidget().dataSource;if(value){c.filter={or:[{path:"idOrden",filter:"contains",value:value},{path:"Estado",filter:"contains",value:value},{path:"Fecha",filter:"contains",value:value},{path:"Hora",filter:"contains",value:value},{path:"TipoOperacion",filter:"contains",value:value},{path:"Comitente",filter:"contains",value:value},{path:"Ticker",filter:"contains",value:value},{path:"Moneda",filter:"contains",value:value},{path:"Monto",filter:"contains",value:value},{path:"Cantidad",filter:"contains",value:value},{path:"Ingreso",filter:"contains",value:value},{path:"idLote",filter:"contains",value:value},{path:"CantidadOperada",filter:"contains",value:value},{path:"PrecioOperado",filter:"contains",value:value},{path:"MontoOperado",filter:"contains",value:value}]}}else{c.filter=null}c.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.ACDIOrdenes.txtFilter");a.chkIncluirFinalizadas.on("change",function(){a.refreshGrid()});a.chkIncluirFinalizadas[0].checked=false;a.ddlLote.shieldDropDown({dataSource:{data:[{text:"Todos",value:a.eLoteFiltro.Todos},{text:"Con Lote",value:a.eLoteFiltro.ConLote},{text:"SinLote",value:a.eLoteFiltro.SinLote}]},textTemplate:"{text}",valueTemplate:"{value}",events:{select:function(c){a.refreshGrid()}},value:a.eLoteFiltro.Todos.toString(),width:"100px"});a.btnRefresh.on("click",function(){a.loadGrid()});a.btnPreseleccionar.on("click",function(){var c=new Core.Ajax.ServerRequest({overlayElement:a.btnPreseleccionar,secureRequest:true,requestUrl:"acdi/ordenes/flag/preseleccion",requestType:"PUT"});c.onSuccess=function(d){a.loadGrid()};c.request()});a.btnGenerarLotes.on("click",function(){var c=new Core.Ajax.ServerRequest({overlayElement:a.btnGenerarLotes,secureRequest:true,requestUrl:"acdi/lotes/generar",requestType:"POST"});c.onSuccess=function(d){a.loadGrid()};c.request()})};a.initGrid=function(){var b=[];b.push({field:"idOrden",title:"ID Orden",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({field:"Estado",title:"Estado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Hora",title:"Hora",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"TipoOperacion",title:"Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Comitente",title:"Comitente",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({field:"Ticker",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Monto",title:"Monto",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNuleablePrice});b.push({field:"Cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({field:"Ingreso",title:"Ingreso",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({title:"Obs.",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,d,e){if(d.Observaciones){var f=(d.length>140)?(d.Observaciones.substr(0,140)+"..."):(d.Observaciones);c.html('<button type="button" title="'+f+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');c.addClass("link-cell");c.on("click",function(){var g=new Core.Controls.Dialog("Observaciones",(d.Observaciones)?d.Observaciones:"",{displayButtons:{close:true,accept:false}});g.show()})}}});b.push({field:"idLote",title:"ID Lote",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({field:"CantidadOperada",title:"Cantidad Operada",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({field:"PrecioOperado",title:"Precio Operado",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNuleablePrice});b.push({field:"MontoOperado",title:"Monto Operado",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNuleablePrice});b.push({width:50,field:"",title:" ",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,d,f){c.parent().css("background-color","rgba("+a.hexToRgb(d.color)+((f%2==0)?", 0.6":", 1 ")+")");var e=$('<input type="checkbox" '+((d.idCheck==3)?"disabled":"")+"/>").appendTo(c);e[0].checked=(d.idCheck==1||d.idCheck==3);e.on("change",function(){var g=new Core.Ajax.ServerRequest({overlayElement:a.divOrdenes.parent(),secureRequest:true,requestUrl:"acdi/ordenes/flag/seleccion?idCuenta="+d.idCuenta+"&idOrden="+d.idOrden+"&idCheck="+(e[0].checked?1:2),requestType:"PUT"});g.onSuccess=function(h){a.loadGrid()};g.request()})}});a.divOrdenes.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],paging:{pageSize:100,pageLinksCount:10},exportOptions:{excel:{fileName:"Ordenes ACDI",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["FechaCarga","HoraCarga","Comitente","Cuenta","FechaAcreditacion","Moneda","Importe","NumeroRecibo","Asesor","UsuarioAlta","Equipo","UnidadDeNegocio"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Ordenes ACDI"}}},selection:false,rowHover:false,sorting:{multiple:true},columns:b})};a.loadGrid=function(){a.lblTitle.text("Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var b;b="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));b+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));var c=new Core.Ajax.ServerRequest({overlayElement:a.divOrdenes.parent(),secureRequest:true,requestUrl:"acdi/ordenes",requestType:"GET",requestData:b});c.onSuccess=function(e){a.originalData=e;var f=[];a.divEstados.empty();$.each(a.originalData.ordenes,function(h,i){if(f.indexOf(i.Estado)<0){f.push(i.Estado)}});$.each(f,function(i,k){var h=$.grep(a.originalData.ordenes,function(m,l){return m.Estado==k}).length;var j=$("<label class='lblEstadoContador' style='background-color: lightblue; margin: 8px 6px 8px 0; padding: 4px 5px; border: 1px solid #ccc;  font-weight: normal;' activo='true' estado='"+k+"'>"+k+": <strong style='color: #333;'>"+h+"</strong></label>").appendTo(a.divEstados);j.on("click",function(){a.setEstado(j)})});a.divContadoresDetalle.empty();var d=[];a.originalData.ordenes.forEach(function(i,h){if(d.indexOf(i.color)==-1){d.push(i.color)}});var g='<label style="width:75px;" class="text-center">Total: '+a.originalData.ordenes.length+"</label>";d.forEach(function(j,i){var h=$.grep(a.originalData.ordenes,function(l,k){return l.color==j});g+='<label class="text-center" style="width:75px; background-color:'+j+';">'+h.length+"</label>"});a.divContadoresDetalle.html(g);a.refreshGrid()};c.request()};a.setEstado=function(b){if(b.attr("activo")=="true"){b.css("background-color","transparent");b.attr("activo","false")}else{b.css("background-color","lightblue");b.attr("activo","true")}a.refreshGrid()};a.refreshGrid=function(){var b=$.grep(a.originalData.ordenes,function(h,g){return true});if(!a.chkIncluirFinalizadas[0].checked){b=$.grep(b,function(h,g){return !h.Finalizada})}if(a.ddlLote.swidget().value()!=a.eLoteFiltro.Todos){if(a.ddlLote.swidget().value()==a.eLoteFiltro.SinLote){b=$.grep(b,function(h,g){return !h.idLote})}else{b=$.grep(b,function(h,g){return h.idLote>0})}}var f=$(".lblEstadoContador");for(var c=0;c<f.length;c++){var e=$(f[c]);if(e.attr("activo")=="false"){b=$.grep(b,function(h,g){return h.Estado!=e.attr("estado")})}}var d=a.divOrdenes.swidget().initialOptions;d.dataSource.data=b;d.exportOptions.excel.dataSource.data=b;d.exportOptions.excel.readDataSource=true;a.divOrdenes.swidget().refresh(d);a.txtFilter.keydown()};a.hexToRgb=function(d){d=d.replace("#","");var f=parseInt(d.substring(0,2),16);var e=parseInt(d.substring(2,4),16);var c=parseInt(d.substring(4,6),16);var h=f+","+e+","+c;return h}};Core.Business.Packs=new function(){var a=this;a.id="packscotizaciones";a.idDefaultAccount=null;a.idDefaultProfile=null;a.pageOptions=null;a.divMain=null;a.divPacks=null;a.maxToken=0;a.loaded=false;a.packList=[];a.init=function(b,c){Core.loadPage("packs.html",function(){document.title="Packs";a.idDefaultAccount=b;a.idDefaultProfile=c;a.loaded=false;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.maxToken=0;a.divMain=$(".div-main");a.divCategoryTabList=$(".div-category-tab-list");a.btnAllCategories=$(".btn-all-categories");a.divPacks=$(".div-packs");a.packList=[];a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadPacks()},"Core.Business.Packs")})};a.initControls=function(){a.btnAllCategories.on("click",function(){a.loadPacksByCategory()})};a.loadPacks=function(){var b=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,overlayElement:a.divMain,secureRequest:true,requestUrl:"cotizaciones/panel/"+Core.Enums.ePanel.Packs+"?token="+a.maxToken,requestType:"GET"});b.onSuccess=function(d){a.packList=d.cotizaciones?d.cotizaciones:[];var c=[];a.packList.forEach(function(g,f){if(!$.grep(c,function(h,j){return h==g.categoria})[0]){var e=$('<li><a data-toggle="tab" aria-expanded="false">'+g.categoria+"</a></li>").appendTo(a.divCategoryTabList);e.on("click",function(){a.loadPacksByCategory(g.categoria)});c.push(g.categoria)}});a.packList.forEach(function(m,l){m.divPack=$('<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 pad0 mt-2"></div>').appendTo(a.divPacks);var f=$('<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 box-descripcion"></div>').appendTo(m.divPack);var j=$('<div class="col-lg-3 col-md-4 col-sm-12 col-xs-12"></div>').appendTo(f);$('<img class="img-proyecto" src="'+Core.Functions.grid.formatUndefinedString(m.URLImagen)+'" />').appendTo(j);var g=$('<div class="col-lg-9 col-md-8 col-sm-12 col-xs-12 disp-link-pack"></div>').appendTo(f);$('<div class="item-label-pack"><h4><div '+(m.colorCategoria?('style="background-color:'+m.colorCategoria+';" '):"")+'class="label label-pack">'+Core.Functions.grid.formatUndefinedString(m.categoria)+"</div></h4></div>").appendTo(g);var k=$('<div class="item1"></div>').appendTo(g);$('<h2 class="font-blue">'+Core.Functions.grid.formatUndefinedString(m.titulo)+"</h2>").appendTo(k);var h=$('<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 pad0"></div>').appendTo(k);$('<p class="txt-intro">'+Core.Functions.grid.formatUndefinedString(m.descripcion)+"</p>").appendTo(h);var i=$('<div class="item2"></div>').appendTo(g);var e=$('<button class="btn btn-primary">Invertí</button>').appendTo(i);e.on("click",function(){Core.Business.DetallePack.init(a.idDefaultAccount,a.idDefaultProfile,{ticker:m.ticker})})})};b.request()};a.loadPacksByCategory=function(b){a.packList.forEach(function(d,c){d.divPack.hide();if(!b||d.categoria==b){d.divPack.show()}})}};Core.Business.PasswordRecovery=new function(){var b=this;var a=13;b.lblTitle=null;b.txtPassword1=null;b.txtPassword2=null;b.txtUser=null;b.btnSend=null;b.divLoginAlert=null;b.divMain=null;b.init=function(c){Core.loadPage("password-recovery.html",function(){document.title="Balanz Capital - Recuperar clave";b.txtPassword1=$(".textbox-password1");b.txtPassword2=$(".textbox-password2");b.txtPassword1.password_strength();new Core.Controls.CapslockWarning(b.txtPassword2);Core.Functions.changePassword.setPasswordsControl(b.txtPassword1,b.txtPassword2);b.txtUser=$(".textbox-user");b.txtPassword2.on("keyup",function(d){if(d.keyCode==a){b.recoverPassword()}});b.btnSend=$("#btn-send");b.divLoginAlert=$(".login-alert");b.divMain=$(".panel-body");b.txtUser.focus();b.btnSend.click(function(){b.recoverPassword()})})};b.recoverPassword=function(){var d=b.txtUser.val();Core.Functions.Validations.toggleValidation(b.txtPassword1,false);Core.Functions.Validations.toggleValidation(b.txtPassword2,false);b.divLoginAlert.slideUp();Core.Functions.Validations.toggleValidation(b.txtUser,false);if(!Core.Functions.changePassword.isValidPasswords(b.txtPassword1,b.txtPassword2,b.divLoginAlert)){return}if(!d||!d.length){Core.Functions.Validations.toggleValidation(b.txtUser,true);return}var c=new Core.Ajax.ServerRequest({overlayElement:b.divMain,secureRequest:false,requestUrl:"cambiarclave",requestType:"POST",requestData:{data:{user:b.txtUser.val(),passActual:null,passNueva:b.txtPassword1.val(),nonce:Core.Functions.QueryString.getParameterByName("recuperarclave")}}});c.onSuccess=function(f){var e=new Core.Controls.Dialog("Recuperación de clave","<p>"+f.Descripcion+"</p>",{displayButtons:{close:true,accept:false},onClosed:function(){Core.Business.Logout.clearSession();window.location.href=window.location.origin+Core.Functions.Context.getPathname()}});e.show();Core.Functions.Validations.toggleValidation(b.txtPassword1,false);Core.Functions.Validations.toggleValidation(b.txtPassword2,false);Core.Functions.Validations.toggleValidation(b.txtUser,false);b.txtPassword1.val("");b.txtPassword2.val("");b.txtUser.val("")};c.onError=function(f){b.divLoginAlert.text("No se pudo cambiar la clave. Sus datos son incorrectos ó el link no es válido.");b.divLoginAlert.slideDown();Core.Functions.Validations.toggleValidation(b.txtPassword1,true);Core.Functions.Validations.toggleValidation(b.txtPassword2,true)};c.request()}};Core.Business.ComposicionBCACC=new function(){var a=this;var b=60000;a.loaded=false;a.id="portfolioComposicionBCACC";a.divComposicionAccionesArgentinas=null;a.timerId=null;a.window=$(window);a.init=function(c,d){Core.loadPage("portfolio-composicion-acciones-argentinas.html",function(){a.divComposicionAccionesArgentinas=$(".div-composicion-acciones-argentinas");a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,c,d,a.loadGrid,"Core.Business.ComposicionBCACC");a.timerId=window.setInterval(function(){a.loadGrid()},b);Core.Objects.Context.Timers.push(a.timerId)})};a.initGrid=function(){a.divComposicionAccionesArgentinas.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:[{width:"7%",field:"Merval",title:"Merv",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(c,e,d){c.text(e.Merval);if(!e.Ticker){c.css("font-weight","bold")}c.css("font-size","20px")}},{width:"12%",field:"Ticker",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(c,e,d){c.text(e.Ticker);if(!e.Ticker){c.css("font-weight","bold")}c.css("font-size","20px")}},{width:"9%",field:"PondMerval",title:"% Merval",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(c,e,d){c.text(Core.Functions.grid.formatNullNumber(e.PondMerval));if(!e.Ticker){c.css("font-weight","bold")}c.css("font-size","20px")}},{width:"9%",field:"PondFCI",title:"% FCI",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(c,e,d){c.text(Core.Functions.grid.formatNullNumber(e.PondFCI));if(!e.Ticker){c.css("font-weight","bold")}c.css("font-size","20px")}},{width:"9%",field:"PondDif",title:"% Dif",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(c,e,d){c.text(Core.Functions.grid.formatNullNumber(e.PondDif));if(!e.Ticker){c.css("font-weight","bold")}c.css("font-size","20px")}},{width:"9%",field:"Cierre",title:"Cierre",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(c,e,d){c.text(Core.Functions.grid.formatNullNumber(e.Cierre));if(!e.Ticker){c.css("font-weight","bold")}c.css("font-size","20px")}},{width:"9%",field:"Precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(c,e,d){c.text(Core.Functions.grid.formatNullNumber(e.Precio));if(!e.Ticker){c.css("font-weight","bold")}c.css("font-size","20px")}},{width:"9%",field:"VarPx",title:"% VarPx",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(c,e,d){c.text(Core.Functions.grid.formatNullNumber(e.VarPx));c.css("background-color",a.calcularColor(e.VarPx,3));if(!e.Ticker){c.css("font-weight","bold")}c.css("font-size","20px")}},{width:"9%",field:"VarMerval",title:"% VarMerval",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(c,e,d){c.text(Core.Functions.grid.formatNullNumber(e.VarMerval));c.css("background-color",a.calcularColor(e.VarMerval,(!e.Ticker)?3:0.3));if(!e.Ticker){c.css("font-weight","bold")}c.css("font-size","20px")}},{width:"9%",field:"VarFCI",title:"% VarFCI",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(c,e,d){c.text(Core.Functions.grid.formatNullNumber(e.VarFCI));c.css("background-color",a.calcularColor(e.VarFCI,(!e.Ticker)?3:0.3));if(!e.Ticker){c.css("font-weight","bold")}c.css("font-size","20px")}},{width:"9%",field:"DifMerv",title:"% DifMerv",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(c,e,d){c.text(Core.Functions.grid.formatNullNumber(e.DifMerv));c.css("background-color",a.calcularColor(e.DifMerv,0.3));if(!e.Ticker){c.css("font-weight","bold")}c.css("font-size","20px")}}]})};a.loadGrid=function(){var c=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,overlayElement:a.divComposicionAccionesArgentinas.parent(),secureRequest:true,requestUrl:"analisis/composicionaccionesargentinas",requestType:"GET"});c.onSuccess=function(d){var i=0;var h=0;var k=0;var j=0;var g=0;d.data.forEach(function(m,l){i+=m.PondMerval;h+=m.PondFCI;k+=m.VarMerval;j+=m.VarFCI;g+=m.DifMerv});d.data.unshift({Merval:"",Ticker:"",PondMerval:i.toFixed(2),PondFCI:h.toFixed(2),PondDif:null,Cierre:null,Precio:null,VarPx:null,VarMerval:k.toFixed(2),VarFCI:j.toFixed(2),DifMerv:g.toFixed(2)});var f=a.window.scrollTop();var e=a.divComposicionAccionesArgentinas.swidget().initialOptions;e.dataSource.data=d;e.dataSource.schema={data:"data"};a.divComposicionAccionesArgentinas.swidget().refresh(e);a.loaded=true;a.window.scrollTop(f)};c.request()};a.calcularColor=function(e,d){var c;if(Math.abs(e)>=d){c=0}else{c=Math.round(255-(Math.abs(e)/d)*255)}if(e==0){return""}else{if(e>0){return"rgba("+c+",255,"+c+", 1)"}else{if(e<0){return"rgba(255,"+c+","+c+", 1)"}}}}};Core.Business.TasaImplicitaFuturo=new function(){var a=this;var b=60000;a.id="tasaImplicitaFuturo";a.divTasaImplicitaFuturo=null;a.divDolarSpot=null;a.txtDolarSpot=null;a.pageOptions=null;a.timerId=null;a.loaded=false;a.window=$(window);a.init=function(c,d){Core.loadPage("portfolio-tasa-implicita-futuro.html",function(){document.title="Tasa Implícita";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[d]);a.divTasaImplicitaFuturo=$(".div-tasa-implicita-futuro");a.divDolarSpot=$(".div-dolar-spot");a.txtDolarSpot=$(".textbox-dolar-spot");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,c,d,a.loadGrid,"Core.Business.TasaImplicitaFuturo");a.timerId=window.setInterval(function(){a.loadGrid()},b);Core.Objects.Context.Timers.push(a.timerId)})};a.initControls=function(){new Core.Controls.DecimalPicker(a.txtDolarSpot,{maxDecimalDigitCount:10,showThousandsSeparator:true,defaultValue:"",onChange:function(){a.loadGrid()}});a.divDolarSpot.hide();if(a.pageOptions.tasaImplicitaFuturoCustomizarDolar){a.divDolarSpot.show()}function d(e){return"<span style='color:blue; font-size:20px;'><strong>"+e+"</strong></span>"}function c(f){var e=f.substr(0,1);if(e=="-"){return"<span class='red' style='font-size:20px;'>"+f+"</span>"}return"<span class='green' style='font-size:20px;'>"+f+"</span>"}a.divTasaImplicitaFuturo.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:[{width:"8%",field:"Instrumento",title:"Instrumento",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,g,f){e.text(g.Instrumento);e.css("font-size","20px")}},{width:"7%",field:"Spot",title:"Spot",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(e,g,f){e.text(g.Spot);e.css("font-size","20px")}},{width:"7%",field:"Bid",title:"Bid",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,g,f){e.text(g.Bid);e.css("font-size","20px")}},{width:"6%",field:"tnaBid",title:"tnaBid",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(e,g,f){e.html(d(g.tnaBid));e.css("font-size","20px")}},{width:"7%",field:"Ask",title:"Ask",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,g,f){e.text(g.Ask);e.css("font-size","20px")}},{width:"6%",field:"tnaAsk",title:"tnaAsk",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(e,g,f){e.html(d(g.tnaAsk));e.css("font-size","20px")}},{width:"7%",field:"Last",title:"Last",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,g,f){e.text(g.Last);e.css("font-size","20px")}},{width:"6%",field:"tnaLast",title:"tnaLast",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(e,g,f){e.html(d(g.tnaLast));e.css("font-size","20px")}},{width:"7%",field:"Spot",title:"SpotCL",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,g,f){e.text(g.SpotClosing);e.css("font-size","20px")}},{width:"7%",field:"SpotClosing",title:"Closing",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(e,g,f){e.text(g.Closing);e.css("font-size","20px")}},{width:"6%",field:"tnaClosing",title:"tnaCL",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,g,f){e.html(d(g.tnaClosing));e.css("font-size","20px")}},{width:"6%",field:"varSpot",title:"varSpot",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(e,g,f){e.text(g.varSpot);e.css("font-size","20px")}},{width:"6%",field:"varCL",title:"varCL",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,g,f){e.html(c(g.varCL));e.css("font-size","20px")}},{width:"6%",field:"vartna",title:"vartna",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(e,g,f){e.html(c(g.vartna));e.css("font-weight","bold");e.css("font-size","20px")}},{width:"6%",field:"dias",title:"dias",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,g,f){e.html(Core.Functions.grid.formatIntegerNumber(g.dias));e.css("font-size","20px")}}]})};a.loadGrid=function(){requestData={};if(a.pageOptions.tasaImplicitaFuturoCustomizarDolar&&a.txtDolarSpot.val()){requestData.DolarSpot=Core.Functions.Decimal.parseFloat(a.txtDolarSpot.val())}if(a.pageOptions.tasaImplicitaFuturoIncluirMerval!=null){requestData.IncluirMerval=a.pageOptions.tasaImplicitaFuturoIncluirMerval}if(a.pageOptions.tasaImplicitaFuturoIncluirRofex!=null){requestData.IncluirRofex=a.pageOptions.tasaImplicitaFuturoIncluirRofex}if(a.pageOptions.tasaImplicitaFuturoIncluirDolar!=null){requestData.IncluirDolar=a.pageOptions.tasaImplicitaFuturoIncluirDolar}var c=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,overlayElement:a.divTasaImplicitaFuturo.parent(),secureRequest:true,requestUrl:"analisis/tasaimplicitafuturo",requestType:"GET",requestData:requestData});c.onSuccess=function(d){var f=a.window.scrollTop();var e=a.divTasaImplicitaFuturo.swidget().initialOptions;e.dataSource.data=d;e.dataSource.schema={data:"data"};a.divTasaImplicitaFuturo.swidget().refresh(e);a.loaded=true;a.window.scrollTop(f)};c.request()}};Core.Business.VolumenAtipico=new function(){var a=this;var b=60000;a.id="portfolioVolumenAtipico";a.divVolumenAtipico=null;a.timerId=null;a.txtFilter=null;a.titleVolumenAcumulado=null;a.divVolumenAcumulado=null;a.titleVolumenIntradiario=null;a.divVolumenIntradiario=null;a.titlePrecioOperado=null;a.divPrecioOperado=null;a.titleVariacionPrecioIntradiario=null;a.divVariacionPrecioIntradiario=null;a.timeoutFilter=null;a.lastTicker=null;a.loaded=false;a.window=$(window);a.init=function(c,d){Core.loadPage("portfolio-volumen-atipico.html",function(){google.charts.load("current",{packages:["corechart","bar","line"]});a.divVolumenAtipico=$(".div-volumen-atipico");a.txtFilter=$(".textbox-filter");a.titleVolumenAcumulado=$(".title-volumen-acumulado");a.divVolumenAcumulado=$(".div-volumen-acumulado");a.titleVolumenIntradiario=$(".title-volumen-intradiario");a.divVolumenIntradiario=$(".div-volumen-intradiario");a.titlePrecioOperado=$(".title-precio-operado");a.divPrecioOperado=$(".div-precio-operado");a.titleVariacionPrecioIntradiario=$(".title-variacion-precio-intradiario");a.divVariacionPrecioIntradiario=$(".div-variacion-precio-intradiario");a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,c,d,a.loadGrid,"Core.Business.VolumenAtipico");a.timerId=window.setInterval(function(){a.loadGrid();if(a.lastTicker!=null){a.loadCharts(a.lastTicker)}},b);Core.Objects.Context.Timers.push(a.timerId)})};a.initGrid=function(){function d(f){if(f==-1){return""}if(f==null){return""}f=f/1000;f+="";var g=f.split(".");var h=g[0];var e=/(\d+)(\d{3})/;while(e.test(h)){h=h.replace(e,"$1,$2")}return h}function c(e){return"<span style='color:orange;'><strong>"+Core.Functions.grid.formatPrice(e)+"</strong></span>"}a.divVolumenAtipico.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:22,pageLinksCount:3},columns:[{width:"20%",field:"porcentaje",title:"%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:c},{width:"20%",field:"ticker_solo",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"20%",field:"precioultimo",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatPrice},{width:"20%",field:"precio_var",title:"Var",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatColorBySign},{width:"20%",field:"totaloperadomonto",title:"$ (x1,000)",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:d},{width:50,title:" ",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(f,g,h){var e=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-chevron-right"></span></button>').appendTo(f);e.on("click",function(){a.lastTicker=g.ticker_solo;a.loaded=false;a.loadCharts(g.ticker_solo)})}}]});a.txtFilter.on("keydown",function(){clearTimeout(a.timeoutFilter);a.timeoutFilter=setTimeout(function(){value=a.txtFilter.val();var e=a.divVolumenAtipico.swidget().dataSource;if(value){e.filter={or:[{path:"ticker_solo",filter:"contains",value:value}]}}else{e.filter=null}e.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.VolumenAtipico.txtFilter")};a.loadGrid=function(){var c=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,overlayElement:a.divVolumenAtipico.parent(),secureRequest:true,requestUrl:"analisis/volumenatipico",requestType:"GET"});c.onSuccess=function(d){var f=a.window.scrollTop();var e=a.divVolumenAtipico.swidget().initialOptions;e.dataSource.data=d;e.dataSource.schema={data:"data"};a.divVolumenAtipico.swidget().refresh(e);a.txtFilter.keydown();a.loaded=true;a.window.scrollTop(f)};c.request()};a.loadCharts=function(e){var c={};c.ticker=e;var d=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,overlayElement:a.divVolumenAtipico.parent(),secureRequest:true,requestUrl:"analisis/volumenatipico/acumulado",requestType:"GET",requestData:c});d.onSuccess=function(f){var g={};g.ticker=e;var h=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,overlayElement:a.divVolumenAtipico.parent(),secureRequest:true,requestUrl:"analisis/volumenatipico/diferencial",requestType:"GET",requestData:g});h.onSuccess=function(j){a.titleVolumenAcumulado.text("Volumen Acumulado "+e);a.titleVolumenIntradiario.text("Volumen Intradiario "+e);a.titleVariacionPrecioIntradiario.text("Variación Precio Intradiario "+e);a.titlePrecioOperado.text("Precio Operado "+e);var m=new google.visualization.DataTable();m.addColumn("string","Hora");m.addColumn("number","Hist Perc50");m.addColumn("number","Actual");m.addRows(f.data.length);f.data.forEach(function(s,r){f.data.forEach(function(u,t){m.setCell(t,0,u.momento_str);m.setCell(t,1,u.acum_cant_50);m.setCell(t,2,u.cantidad_hoy_acum)})});var o={title:"Volumen Acumulado "+e,subtitle:"en cantidad nominales",curveType:"function",legend:{position:"bottom"}};var i=new google.visualization.LineChart(a.divVolumenAcumulado[0]);i.draw(m,o);var n=new google.visualization.DataTable();n.addColumn("string","Time");n.addColumn("number","Historico");n.addColumn("number","VolumenNominales");n.addRows(j.data.length);j.data.forEach(function(s,r){j.data.forEach(function(u,t){var v=String(u.momento).substr(0,5);n.setCell(t,0,v);n.setCell(t,1,u.operadovsn_hist);n.setCell(t,2,u.operadovsn)})});var l=new google.visualization.DataTable();l.addColumn("string","Time");l.addColumn("number","Precio");l.addRows(j.intradiario.length);j.intradiario.forEach(function(s,r){j.intradiario.forEach(function(v,u){var t=String(v.horaconcertacion).split(" ")[1].substr(0,5);l.setCell(u,0,t);l.setCell(u,1,v.precioultimo)})});var p={title:"Volumen Intradiario "+e,curveType:"bar",hAxis:{title:"Hora de Dia",format:"h:mm",viewWindow:{min:[11,0,0],max:[17,0,0]}},legend:{position:"bottom"}};var i=new google.visualization.ColumnChart(a.divVolumenIntradiario[0]);i.draw(n,p);optionsVariacionPrecioIntradiario={title:"Variacion Precio Intradiario "+e,curveType:"bar",legend:{position:"bottom"}};i=new google.visualization.LineChart(a.divVariacionPrecioIntradiario[0]);i.draw(l,optionsVariacionPrecioIntradiario);var k=new google.visualization.DataTable();k.addColumn("number","Precio");k.addColumn("number","11hs");k.addColumn("number","12hs");k.addColumn("number","13hs");k.addColumn("number","14hs");k.addColumn("number","15hs");k.addColumn("number","16hs");k.addRows(j.precioxvol.length);j.precioxvol.forEach(function(s,r){k.setCell(r,0,s.precio);k.setCell(r,1,s.totaloperadovsn11);k.setCell(r,2,s.totaloperadovsn12);k.setCell(r,3,s.totaloperadovsn13);k.setCell(r,4,s.totaloperadovsn14);k.setCell(r,5,s.totaloperadovsn15);k.setCell(r,6,s.totaloperadovsn16)});var q=0;j.precio.forEach(function(s,r){q=s.ponderado});optionsPrecioOperado={title:"Precio Operado "+e+"(Precio Ponderado "+q+")",colors:["#DAF7A6","#FFC300","#FF5733","#C70039","#900C3F","#900C3F"],curveType:"function",legend:{position:"bottom"},isStacked:true};i=new google.visualization.BarChart(a.divPrecioOperado[0]);i.draw(k,optionsPrecioOperado);a.loaded=true};h.request()};d.request()}};Core.Business.eGrillaTenencia={Pesos:1,Dolares:2};Core.Business.PosicionConsolidada=new function(){var me=this;var REFRESH_TIME=60000;me.id="posicionConsolidada";me.pageOptions=null;me.header=null;me.btnDetalles=null;me.divReporte=null;me.btnReporte=null;me.txtDateFrom=null;me.gridLiquidez=null;me.divTenenciaPesos=null;me.divTenenciaDolares=null;me.gridTenenciaPesos=null;me.gridTenenciaDolares=null;me.gridOrdenes=null;me.divOrdenesPrecargadas=null;me.gridOrdenesPrecargadas=null;me.lblCantidadPrecargas=null;me.divOrdenesDolarBCRA=null;me.gridOrdenesDolarBCRA=null;me.divCotizacionMonedas=null;me.btnCuentasBancariasBalanz=null;me.btnRetirarDinero=null;me.Monedas=null;me.Tenencias=null;me.Ordenes=null;me.OrdenesPrecargadas=null;me.OrdenesDolarBCRA=null;me.TenenciaActual=null;me.TenenciaAnterior=null;me.divChartDistribucion=null;me.chartDistribucion=null;me.chartMonedas=null;me.divChartMonedas=null;me.divLiquidezProyectada=null;me.cotizacionesDolar=null;me.divContainerCotizacionesDolar=null;me.divSeleccionMoneda=null;me.ddlSeleccionMoneda=null;me.loaded=false;me.headerLabels={divTotal:null,lblTotal:null,divInstrumentos:null,tblInstrumentos:null,divMonedas:null,tblMonedas:null,divDisponible:null,tblDisponible:null};me.colorByCurrency={Pesos:"#8FE0FF","Dólares":"#528566","Dólares Cable":"#b3e6ca"};me.colorByInstrument={Pesos:"#8FE0FF","Dólares":"#528566","Dólares Cable":"#b3e6ca","Fondos T+1":"#cdcdca","Renta Fija":"#8675B2","Fondos Renta Mixta":"#2424a8",Acciones:"#B6041C","Fondos Acciones":"#ff1a66","Fondos Renta Fija":"#1b1b7e","Fondos Comunes de Inversion":"#2454a8"};me.timerId=null;me.init=function(idDefaultAccount,idDefaultProfile,initialParameters){Core.loadPage("posicion-consolidada.html",function(){me.idDefaultAccount=idDefaultAccount;me.idDefaultProfile=idDefaultProfile;document.title="Posición Consolidada";me.loaded=false;if(initialParameters&&initialParameters.idCuenta){me.idDefaultAccount=initialParameters.idCuenta}me.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(me.id,Core.Objects.Context.Profiles[idDefaultProfile]);me.optionsDolarBcra=Core.Functions.Context.Profiles.getPageOptionsByMenu("monedas",Core.Objects.Context.Profiles[idDefaultProfile]);me.headerLabels.divTotal=$(".div-total");me.headerLabels.lblTotal=$(".total-value");me.headerLabels.divInstrumentos=$(".div-instrumentos");me.headerLabels.tblInstrumentos=$(".tbl-instrumentos");me.headerLabels.divMonedas=$(".div-monedas");me.headerLabels.tblMonedas=$(".tbl-monedas");me.headerLabels.divDisponible=$(".div-disponible");me.headerLabels.tblDisponible=$(".tbl-disponible");me.txtDateFrom=$(".date-picker-from");me.btnDetalles=$(".btn-detalles-disponible");me.divReporte=$(".div-report");me.btnReporte=$(".btn-report");me.gridLiquidez=$(".grid-liquidez");me.divTenenciaPesos=$(".div-tenencia-pesos");me.gridTenenciaPesos=$(".grid-tenencia-pesos");me.divTenenciaDolares=$(".div-tenencia-dolares");me.gridTenenciaDolares=$(".grid-tenencia-dolares");me.gridOrdenes=$(".grid-ordenes");me.divOrdenesPrecargadas=$(".div-ordenes-precargadas");me.gridOrdenesPrecargadas=$(".grid-ordenes-precargadas");me.lblCantidadPrecargas=$(".lbl-cantidad-precargas");me.divOrdenesDolarBCRA=$(".div-ordenes-dolar-bcra");me.gridOrdenesDolarBCRA=$(".grid-ordenes-dolar-bcra");me.divChartDistribucion=$(".div-chart-distribuccion");me.divChartMonedas=$(".div-chart-monedas");me.divCotizacionMonedas=$(".div-cotizacion-monedas");me.btnCuentasBancariasBalanz=$(".btn-cuentas-bancarias-balanz");me.btnRetirarDinero=$(".btn-retirar-dinero");me.divLiquidezProyectada=$(".div-liquidez-proyectada");me.cotizacionesDolar=[];me.divContainerCotizacionesDolar=$(".div-container-cotizaciones-dolar");me.divContainerBanners=$(".div-posicion-consolidada-banner");me.divBanners=$(".div-banners");me.divSeleccionMoneda=$(".div-seleccion-moneda");me.ddlSeleccionMoneda=$(".dropdown-seleccion-moneda");me.initControls();me.initCharts();me.header=new Core.Controls.Header($("#topNav"),{});me.header.init(true,me.idDefaultAccount,me.idDefaultProfile,function(){me.loaded=false;me.renderBanners();me.loadCharts(true)},"Core.Business.PosicionConsolidada",((Core.Objects.Context.Configuration.idAplicacion!=1)?{idCuenta:me.idDefaultAccount}:null));me.timerId=window.setInterval(function(){if(!me.txtDateFrom.swidget()){window.clearInterval(me.timerId);return}var date=me.txtDateFrom.swidget().value();var today=new Date();date.setHours(0,0,0,0);today.setHours(0,0,0,0);if(date.getTime()==today.getTime()){me.loadCharts()}},REFRESH_TIME);Core.Objects.Context.Timers.push(me.timerId)})};me.initControls=function(){me.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(e){me.loaded=false;me.loadCharts()}}});me.ddlSeleccionMoneda.on("change",function(){me.loaded=false;me.loadCharts()});me.btnDetalles.click(function(){var sr=new Core.Ajax.ServerRequest({showOverlay:!me.loaded,requestUrl:"detalledisponible/"+encodeURIComponent(me.header.selectedIdAccount),requestType:"GET",requestData:{Fecha:Core.Functions.Date.getDateAsString(me.txtDateFrom.swidget().value()),idMoneda:me.ddlSeleccionMoneda.val()}});sr.onSuccess=function(responseObject){var htmlDetalle="";htmlDetalle+="<h4>Disponible para Operar</h4>";htmlDetalle+="<table class='table table-striped'>";htmlDetalle+="<thead><tr><th>Moneda</th><th>Inmediato</th><th>24hs</th><th>48hs</th><th>Futuro</th><th>Cotización</th></tr></thead>";htmlDetalle+="<tbody>";for(var i=0;i<responseObject.disponible.length;i++){htmlDetalle+="<tr>";htmlDetalle+="<td>"+responseObject.disponible[i].Moneda+"</td>";htmlDetalle+="<td>"+Core.Functions.grid.formatNumber(responseObject.disponible[i].DisponibleOperableCI)+"</td>";htmlDetalle+="<td>"+Core.Functions.grid.formatNumber(responseObject.disponible[i].DisponibleOperable24)+"</td>";htmlDetalle+="<td>"+Core.Functions.grid.formatNumber(responseObject.disponible[i].DisponibleOperable48)+"</td>";htmlDetalle+="<td>"+Core.Functions.grid.formatNumber(responseObject.disponible[i].DisponibleOperableFuturo)+"</td>";htmlDetalle+="<td>"+Core.Functions.grid.formatNumber(responseObject.disponible[i].Cotizacion)+"</td>";htmlDetalle+="</tr>"}htmlDetalle+="</tbody>";htmlDetalle+="</table>";htmlDetalle+="<h4>Disponible para Transferencias</h4>";htmlDetalle+="<table class='table table-striped'>";htmlDetalle+="<thead><tr><th>Moneda</th><th>Inmediato</th><th>24hs</th><th>48hs</th><th>Futuro</th><th>Cotización</th></tr></thead>";htmlDetalle+="<tbody>";for(var i=0;i<responseObject.transferible.length;i++){htmlDetalle+="<tr>";htmlDetalle+="<td>"+responseObject.transferible[i].Moneda+"</td>";htmlDetalle+="<td>"+Core.Functions.grid.formatNumber(responseObject.transferible[i].DisponibleOperableCI)+"</td>";htmlDetalle+="<td>"+Core.Functions.grid.formatNumber(responseObject.transferible[i].DisponibleOperable24)+"</td>";htmlDetalle+="<td>"+Core.Functions.grid.formatNumber(responseObject.transferible[i].DisponibleOperable48)+"</td>";htmlDetalle+="<td>"+Core.Functions.grid.formatNumber(responseObject.transferible[i].DisponibleOperableFuturo)+"</td>";htmlDetalle+="<td>"+Core.Functions.grid.formatNumber(responseObject.transferible[i].Cotizacion)+"</td>";htmlDetalle+="</tr>"}htmlDetalle+="</tbody>";htmlDetalle+="</table>";htmlDetalle+="<h4>Disponible para Suscripciones</h4>";htmlDetalle+="<table class='table table-striped'>";htmlDetalle+="<thead><tr><th>Moneda</th><th>Inmediato</th><th>Cotización</th></tr></thead>";htmlDetalle+="<tbody>";for(var i=0;i<responseObject.suscribible.length;i++){htmlDetalle+="<tr>";htmlDetalle+="<td>"+responseObject.suscribible[i].Moneda+"</td>";htmlDetalle+="<td>"+Core.Functions.grid.formatNumber(responseObject.suscribible[i].DisponibleOperableCI)+"</td>";htmlDetalle+="<td>"+Core.Functions.grid.formatNumber(responseObject.suscribible[i].Cotizacion)+"</td>";htmlDetalle+="</tr>"}htmlDetalle+="</tbody>";htmlDetalle+="</table>";if(responseObject.cauciones&&responseObject.cauciones.length>0){htmlDetalle+="<h4>Disponible para Cauciones</h4>";htmlDetalle+="<table class='table table-striped'>";htmlDetalle+="<thead><tr><th>Moneda</th><th>"+(responseObject.cauciones[0].PlazoCI==1?"1 día":(responseObject.cauciones[0].PlazoCI+" días"))+"</th><th>"+(responseObject.cauciones[0].Plazo24+" días")+"</th><th>"+(responseObject.cauciones[0].Plazo48+" días")+"</th><th>"+(responseObject.cauciones[0].Plazo72+" días")+"</th><th>Futuro</th></tr></thead>";htmlDetalle+="<tbody>";for(var i=0;i<responseObject.cauciones.length;i++){htmlDetalle+="<tr>";htmlDetalle+="<td>"+responseObject.disponible[i].Moneda+"</td>";htmlDetalle+="<td>"+Core.Functions.grid.formatNumber(responseObject.cauciones[i].DisponibleOperableCI)+"</td>";htmlDetalle+="<td>"+Core.Functions.grid.formatNumber(responseObject.cauciones[i].DisponibleOperable24)+"</td>";htmlDetalle+="<td>"+Core.Functions.grid.formatNumber(responseObject.cauciones[i].DisponibleOperable48)+"</td>";htmlDetalle+="<td>"+Core.Functions.grid.formatNumber(responseObject.cauciones[i].DisponibleOperable72)+"</td>";htmlDetalle+="<td>"+Core.Functions.grid.formatNumber(responseObject.cauciones[i].DisponibleOperableFuturo)+"</td>";htmlDetalle+="</tr>"}htmlDetalle+="</tbody>";htmlDetalle+="</table>"}htmlDetalle+="<h4>Márgenes de Garantía</h4>";htmlDetalle+="<table class='table table-striped'>";htmlDetalle+="<thead><tr><th>Tipo</th><th>Margen</th><th>Disponible</th></tr></thead>";htmlDetalle+="<tbody>";for(var i=0;i<responseObject.margenesgarantia.length;i++){htmlDetalle+="<tr>";htmlDetalle+="<td>"+responseObject.margenesgarantia[i].Tipo+"</td>";htmlDetalle+="<td>"+Core.Functions.grid.formatNumber(responseObject.margenesgarantia[i].Margen)+"</td>";htmlDetalle+="<td>"+Core.Functions.grid.formatNumber(responseObject.margenesgarantia[i].Disponible)+"</td>";htmlDetalle+="</tr>"}htmlDetalle+="</tbody>";htmlDetalle+="</table>";if(responseObject.marktomarket&&responseObject.marktomarket.length>0){htmlDetalle+="<h4>Mark to Market</h4>";htmlDetalle+="<table class='table table-striped'>";htmlDetalle+="<thead><tr><th>Ticker</th><th>Moneda</th><th>Importe</th></tr></thead>";htmlDetalle+="<tbody>";for(var i=0;i<responseObject.marktomarket.length;i++){htmlDetalle+="<tr>";htmlDetalle+="<td>"+responseObject.marktomarket[i].Ticker+"</td>";htmlDetalle+="<td>"+responseObject.marktomarket[i].Moneda+"</td>";htmlDetalle+="<td>"+Core.Functions.grid.formatNumber(responseObject.marktomarket[i].Importe)+"</td>";htmlDetalle+="</tr>"}htmlDetalle+="</tbody>";htmlDetalle+="</table>"}htmlDetalle+="<h4>Detalle de Liquidez</h4>";htmlDetalle+="<table class='table table-striped'>";htmlDetalle+="<thead><tr><th>Moneda</th><th>Inmediato</th><th>24hs</th><th>48hs</th><th>Futuro</th><th>Cotización</th></tr></thead>";htmlDetalle+="<tbody>";for(var i=0;i<responseObject.detalleliquidez.length;i++){htmlDetalle+="<tr>";htmlDetalle+="<td>"+responseObject.detalleliquidez[i].Moneda+"</td>";htmlDetalle+="<td>"+Core.Functions.grid.formatNumber(responseObject.detalleliquidez[i].DisponibleCI)+"</td>";htmlDetalle+="<td>"+Core.Functions.grid.formatNumber(responseObject.detalleliquidez[i].Disponible24)+"</td>";htmlDetalle+="<td>"+Core.Functions.grid.formatNumber(responseObject.detalleliquidez[i].Disponible48)+"</td>";htmlDetalle+="<td>"+Core.Functions.grid.formatNumber(responseObject.detalleliquidez[i].DisponibleFuturo)+"</td>";htmlDetalle+="<td>"+Core.Functions.grid.formatNumber(responseObject.detalleliquidez[i].Cotizacion)+"</td>";htmlDetalle+="</tr>"}htmlDetalle+="</tbody>";htmlDetalle+="</table>";var dialog=new Core.Controls.Dialog("Disponible",htmlDetalle,{displayButtons:{close:true,accept:false}});dialog.show()};sr.request()});me.btnReporte.click(function(){Core.Functions.File.download(me.btnReporte,Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"descargar/6/"+encodeURIComponent(me.header.selectedIdAccount)+"?fecha="+Core.Functions.Date.getDateAsString(me.txtDateFrom.swidget().value()),function(){})});if(!me.pageOptions.exportarPosicionConsolidada){me.divReporte.hide()}me.btnCuentasBancariasBalanz.click(function(){var selectedAccount=$.grep(Core.Objects.Accounts,function(obj,index){return obj.idCuenta==me.header.selectedIdAccount})[0];var btnVisible=$.grep(me.btnCuentasBancariasBalanz,function(obj,index){return $(obj).is(":visible")});new Core.Business.PosicionConsolidada.CuentasBancariasBalanz({overlayElement:btnVisible,selectedAccount:selectedAccount}).show()});me.btnRetirarDinero.click(function(){Core.Business.Operar.Transferencias.init(me.header.selectedIdAccount,me.idDefaultProfile,{})})};me.setCotizacionDolarBolsa=function(cotizacion){var divDesktop=$('<div class="grid_contenedor-modulos hidden-xs"></div>').appendTo(cotizacion.divMain);$('<div class="pad0"><p class="total title-dolar bolsa">'+cotizacion.Descripcion+"<br></p></div>").appendTo(divDesktop);var divMobile=$('<div class="col-xs-12 pad0 show-xs hidden-lg hidden-md hidden-sm"></div>').appendTo(cotizacion.divMain);$('<div class="pad0"><p class="total title-dolar bolsa">'+cotizacion.Descripcion+"</p></div>").appendTo(divMobile);var divGridMobile=$('<div class="grid_contenedor-modulos">').appendTo(divMobile);var divContainerGrid=[divDesktop,divGridMobile];var divVenta=$('<div class="venta-dolar"></div>').appendTo(divContainerGrid);$('<p class="cifra venta-dolar-valor venta-dolar-bolsa-valor">'+((cotizacion&&cotizacion.PrecioCompra)?cotizacion.PrecioCompra:"-")+"</p>").appendTo(divVenta);var btnVentaDolarBolsa=$('<button type="submit" class="btn btn-primary btn-venta-dolar btn-block" disabled>Vender</button>').appendTo(divVenta);var divCompra=$('<div class="compra-dolar"></div>').appendTo(divContainerGrid);$('<p class="cifra compra-dolar-valor compra-dolar-bolsa-valor">'+((cotizacion&&cotizacion.PrecioVenta)?cotizacion.PrecioVenta:"-")+"</p>").appendTo(divCompra);var btnCompraDolarBolsa=$('<button type="submit" class="btn btn-primary btn-compra-dolar btn-block" disabled>Comprar</button>').appendTo(divCompra);var selectedAccount=$.grep(Core.Objects.Accounts,function(obj,index){return obj.idCuenta==me.header.selectedIdAccount})[0];if(Core.Functions.Context.Profiles.existPageInMenu("dolarBolsa",Core.Objects.Context.Profiles[me.idDefaultProfile])&&selectedAccount&&me.header.showMenuItem(Core.Functions.Context.Profiles.searchPage("dolarBolsa",Core.Objects.Context.Profiles[me.idDefaultProfile]),selectedAccount)&&cotizacion&&cotizacion.PrecioCompra&&cotizacion.PrecioVenta&&cotizacion.Namespace){btnVentaDolarBolsa.removeAttr("disabled");btnVentaDolarBolsa.click(function(){eval(cotizacion.Namespace+".init("+me.header.selectedIdAccount+", "+me.idDefaultProfile+", { defaultTipoOperacion:"+Core.Enums.eEspeciesTipoOperacion.VentaDolarBolsa+", defaultPrecioCompra:"+((cotizacion&&cotizacion.PrecioCompra)?cotizacion.PrecioCompra:"")+", defaultPrecioVenta:"+((cotizacion&&cotizacion.PrecioVenta)?cotizacion.PrecioVenta:"")+" })")});btnCompraDolarBolsa.removeAttr("disabled");btnCompraDolarBolsa.click(function(){eval(cotizacion.Namespace+".init("+me.header.selectedIdAccount+", "+me.idDefaultProfile+", { defaultTipoOperacion:"+Core.Enums.eEspeciesTipoOperacion.CompraDolarBolsa+", defaultPrecioCompra:"+((cotizacion&&cotizacion.PrecioCompra)?cotizacion.PrecioCompra:"")+", defaultPrecioVenta:"+((cotizacion&&cotizacion.PrecioVenta)?cotizacion.PrecioVenta:"")+" })")})}$('<div class="col-md-12 col-sm-12 col-xs-12 pad0"><p class="small-dolar aclaracion-dolar">'+cotizacion.Texto+"</p></div>").appendTo(cotizacion.divMain)};me.initCharts=function(){var colsLiquidez=[];colsLiquidez.push({field:"Moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(colsLiquidez.length)});colsLiquidez.push({field:"DInm",title:"Inmediato",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(colsLiquidez.length),format:Core.Functions.grid.formatNumber});if(!Core.Functions.isMobile){colsLiquidez.push({field:"D24",title:"24 horas",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(colsLiquidez.length),format:Core.Functions.grid.formatNumber})}colsLiquidez.push({field:"D48",title:"48 horas",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(colsLiquidez.length),format:Core.Functions.grid.formatNumber});colsLiquidez.push({field:"DFut",title:"Futuro",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(colsLiquidez.length),format:Core.Functions.grid.formatNumber});if(!Core.Functions.isMobile&&Core.Functions.Context.Profiles.existPageInMenu("transferencias",Core.Objects.Context.Profiles[me.idDefaultProfile])){colsLiquidez.push({title:" ",width:"40px",headerAttributes:Core.Functions.grid.getHeaderAttribute(colsLiquidez.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),columnTemplate:function(cell,cellItem,index){cell.html('<i class="ico-venta2" data-toggle="tooltip" title="Operar"></i>');cell.addClass("link-cell");cell.on("click",function(){Core.Business.Operar.Transferencias.init(me.header.selectedIdAccount,me.idDefaultProfile,{defaultMoneda:cellItem.idMoneda})})}})}me.gridLiquidez.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,noRecordsText:"No hay información de liquidez proyectada",columns:colsLiquidez});var cols=[];var formatNominales=function(value){value+="";var x=value.split(".");var x1=x[0];var x2=(x.length>1?x[1]:"");x2+=(x2.length>1?"":((x2.length==0)?"00":"0"));var rgx=/(\d+)(\d{3})/;while(rgx.test(x1)){x1=x1.replace(rgx,"$1,$2")}return x1+((x2=="00")?"":"."+x2.substr(0,(x2.length>2?x2.length:2)))};var formatGarantia=function(value){if(value==-1){return""}value+="";var x=value.split(".");var x1=x[0];var x2=(x.length>1?x[1]:"");x2+=(x2.length>1?"":((x2.length==0)?"00":"0"));var rgx=/(\d+)(\d{3})/;while(rgx.test(x1)){x1=x1.replace(rgx,"$1,$2")}return x1+((x2=="00")?"":"."+x2.substr(0,(x2.length>2?x2.length:2)))};cols.push({field:"Ticker",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(cols.length),columnTemplate:function(cell,cellItem,index){cell.html(cellItem.Ticker);if(cellItem.panel==Core.Enums.ePanel.AccionesMerval||cellItem.panel==Core.Enums.ePanel.AccionesBurcap||cellItem.panel==Core.Enums.ePanel.AccionesMercadoArgentino||cellItem.panel==Core.Enums.ePanel.Acciones||cellItem.panel==Core.Enums.ePanel.AccionesMerval25||cellItem.panel==Core.Enums.ePanel.Bonos||cellItem.panel==Core.Enums.ePanel.Cedears||cellItem.panel==Core.Enums.ePanel.Opciones||cellItem.panel==Core.Enums.ePanel.Lebacs||cellItem.panel==Core.Enums.ePanel.Letes||cellItem.panel==Core.Enums.ePanel.ONs||cellItem.panel==Core.Enums.ePanel.Futuros||cellItem.panel==Core.Enums.ePanel.NYSE||cellItem.panel==Core.Enums.ePanel.BCINYSE){cell.html("<a>"+cellItem.Ticker+"</a>");cell.addClass("link-cell");cell.on("click",function(){Core.Business.DetalleInstrumento.init(me.header.selectedIdAccount,me.idDefaultProfile,{ticker:cellItem.Ticker})})}else{if(cellItem.panel==Core.Enums.ePanel.Fondos){cell.html("<a>"+cellItem.Ticker+"</a>");cell.addClass("link-cell");cell.on("click",function(){Core.Business.DetalleInstrumento.init(me.header.selectedIdAccount,me.idDefaultProfile,{fondo:cellItem.Ticker})})}else{if(cellItem.panel==Core.Enums.ePanel.OferentesExternos){cell.html("<a>"+cellItem.Ticker+"</a>");cell.addClass("link-cell");cell.on("click",function(){Core.Business.DetalleRealEstate.init(me.header.selectedIdAccount,me.idDefaultProfile,{ticker:cellItem.Ticker})})}else{if(cellItem.panel==Core.Enums.ePanel.Packs){cell.html("<a>"+cellItem.Ticker+"</a>");cell.addClass("link-cell");cell.on("click",function(){Core.Business.DetallePack.init(me.header.selectedIdAccount,me.idDefaultProfile,{ticker:cellItem.Ticker})})}}}}}});if(!Core.Functions.isMobile&&!Core.Functions.isTablet){cols.push({field:"Descripcion",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(cols.length),width:"18%"})}cols.push({field:"Cantidad",title:"Nominales",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(cols.length),format:formatNominales});if(!Core.Functions.isMobile&&!Core.Functions.isTablet&&me.pageOptions.showTenenciaGarantias){cols.push({field:"Garantias",title:"Garantía",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(cols.length),format:formatGarantia})}cols.push({field:"Precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(cols.length),format:Core.Functions.grid.formatPrice});cols.push({field:"Variacion",title:"Variación (%)",headerAttributes:Core.Functions.grid.getHeaderAttribute(cols.length),format:Core.Functions.grid.formatColorByFirstDigit,width:"100px"});if(!Core.Functions.isMobile){cols.push({field:"FechaUltimoOperado",title:"Fecha",headerAttributes:Core.Functions.grid.getHeaderAttribute(cols.length)})}cols.push({field:"ValorActual",title:"Valor Actual",attributes:Core.Functions.grid.getGreyOpacityAlignedColumnClass(0.5),headerAttributes:Core.Functions.grid.getHeaderAttribute(cols.length),format:Core.Functions.grid.formatIntegerNumber});if(Core.Functions.isLarge){cols.push({field:"PorcTenencia",title:"% de Tenencia",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(cols.length),format:Core.Functions.grid.formatNumberWithDecimals})}if(!Core.Functions.isMobile&&!Core.Functions.isTablet&&me.pageOptions.showTenenciaValorInicial){cols.push({field:"ValorInicial",title:"Valor Inicial",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(cols.length),format:Core.Functions.grid.formatIntegerNumber})}if(!Core.Functions.isMobile){if(me.pageOptions.showTenenciaPPP){cols.push({field:"PPP",title:"Precio Promedio de Compra",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(cols.length),format:Core.Functions.grid.formatPrice})}cols.push({field:"NoRealizado",title:"Rendimiento",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(cols.length),format:Core.Functions.grid.formatIntegerNumber});if(me.pageOptions.showTenenciaPorcentaje){cols.push({field:"Porcentaje",title:"%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(cols.length)})}}if(Core.Functions.isLarge){if(me.pageOptions.showTenenciaDiasPromedioTenencia){cols.push({field:"DiasPromedioTenencia",title:"Días promedio de tenencia",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(cols.length),format:Core.Functions.grid.formatIntegerNumber})}if(me.pageOptions.showTenenciaTna){cols.push({field:"TNA",title:"TNA",attributes:Core.Functions.grid.getGreyOpacityAlignedColumnClass(0.5),headerAttributes:Core.Functions.grid.getHeaderAttribute(cols.length)})}}if(!Core.Functions.isMobile&&me.pageOptions.showTenenciaActions){cols.push({width:"40px",title:" ",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(cols.length),columnTemplate:function(cell,cellItem,index){if(Core.Functions.Operar.enabledOperar(cellItem.panel,me.header.selectedIdAccount,me.idDefaultProfile)){cell.html('<i class="ico-venta2" data-toggle="tooltip" title="Operar"></i>');cell.addClass("link-cell");cell.on("click",function(){Core.Functions.Operar.callOperar(cellItem.panel,cellItem.idTipoOperacion,me.header.selectedIdAccount,me.idDefaultProfile,{defaultEspecie:cellItem.Ticker,defaultValorCantidad:cellItem.Cantidad,defaultFondoOrigen:cellItem.Ticker})})}}})}var optionsTenenciaPesos={dataSource:{data:[],group:[{field:"Tipo",order:"asc"}]},noRecordsText:"No hay información de tenencias",selection:false,rowHover:false,columns:cols};if(me.pageOptions.exportarexcelposicion){optionsTenenciaPesos.toolbar=[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}];optionsTenenciaPesos.exportOptions={excel:{fileName:"Instrumentos cotizados en Pesos",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["Ticker","Descripcion","Cantidad","Garantias","Precio","Variacion","FechaUltimoOperado","ValorActual","PorcTenencia","ValorInicial","PPP","NoRealizado","Porcentaje","DiasPromedioTenencia","TNA"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Instrumentos cotizados en Pesos"}}}}me.gridTenenciaPesos.shieldGrid(optionsTenenciaPesos);var optionsTenenciaDolares={dataSource:{data:[],group:[{field:"Tipo",order:"asc"}]},noRecordsText:"No hay información de tenencias",selection:false,rowHover:false,columns:cols};if(me.pageOptions.exportarexcelposicion){optionsTenenciaDolares.toolbar=[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}];optionsTenenciaDolares.exportOptions={excel:{fileName:"Instrumentos cotizados en Dólares",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["Ticker","Descripcion","Cantidad","Garantias","Precio","Variacion","FechaUltimoOperado","ValorActual","PorcTenencia","ValorInicial","PPP","NoRealizado","Porcentaje","DiasPromedioTenencia","TNA"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Instrumentos cotizados en Dólares"}}}}me.gridTenenciaDolares.shieldGrid(optionsTenenciaDolares);var colsOrdenes=[];colsOrdenes.push({width:"9%",field:"idOrden",title:"Orden",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(colsOrdenes.length)});colsOrdenes.push({width:"9%",field:"Fecha",title:"Fecha",headerAttributes:Core.Functions.grid.getHeaderAttribute(colsOrdenes.length)});colsOrdenes.push({width:"9%",field:"Operacion",title:"Operación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(colsOrdenes.length),format:Core.Functions.grid.formatUndefinedString});colsOrdenes.push({width:"9%",field:"Ticker",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(colsOrdenes.length),format:Core.Functions.grid.formatUndefinedString});colsOrdenes.push({width:"9%",field:"Moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(colsOrdenes.length),format:Core.Functions.grid.formatUndefinedString});colsOrdenes.push({width:"8%",field:"Cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(colsOrdenes.length),format:Core.Functions.grid.formatNuleableIntegerNumber});colsOrdenes.push({width:"8%",field:"Precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(colsOrdenes.length),format:Core.Functions.grid.formatPrice});colsOrdenes.push({width:"8%",field:"Monto",title:"Monto",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(colsOrdenes.length),format:Core.Functions.grid.formatPrice});colsOrdenes.push({width:"9%",field:"Estado",title:"Estado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(colsOrdenes.length)});colsOrdenes.push({width:"9%",field:"CantidadOperada",title:"Cantidad Operada",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(colsOrdenes.length),format:Core.Functions.grid.formatNuleableIntegerNumber});colsOrdenes.push({width:"9%",field:"PrecioOperado",title:"Precio Operado",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(colsOrdenes.length),format:Core.Functions.grid.formatPrice});colsOrdenes.push({width:100,title:" ",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(colsOrdenes.length),columnTemplate:function(cell,cellItem,index){var btnDetalle=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(cell);btnDetalle.on("click",function(){Core.Functions.grid.OrdenDetails.showDetails(me.header.selectedIdAccount,cellItem.idOrden,me.pageOptions)});if(cellItem.Cancelable){var btnCancel=$('<button type="button" title="Cancelar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(cell);btnCancel.on("click",function(){me.cancelOrder(cellItem)})}}});me.gridOrdenes.shieldGrid({dataSource:{data:[]},noRecordsText:"No hay Ordenes en Curso",selection:false,rowHover:false,paging:{pageSize:30,pageLinksCount:10},columns:colsOrdenes});var colsOrdenesPrecargadas=[];colsOrdenesPrecargadas.push({field:"FechaCarga",title:"Fecha de Precarga",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(colsOrdenesPrecargadas.length),format:Core.Functions.grid.formatUndefinedString});colsOrdenesPrecargadas.push({field:"Fecha",title:"Fecha para Confirmar",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(colsOrdenesPrecargadas.length),format:Core.Functions.grid.formatUndefinedString});colsOrdenesPrecargadas.push({field:"Ticker",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(colsOrdenesPrecargadas.length),format:Core.Functions.grid.formatUndefinedString});colsOrdenesPrecargadas.push({field:"Operacion",title:"Operación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(colsOrdenesPrecargadas.length),format:Core.Functions.grid.formatUndefinedString});colsOrdenesPrecargadas.push({field:"Cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(colsOrdenesPrecargadas.length),format:Core.Functions.grid.formatNuleableIntegerNumber});colsOrdenesPrecargadas.push({field:"Moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(colsOrdenesPrecargadas.length),format:Core.Functions.grid.formatUndefinedString});colsOrdenesPrecargadas.push({field:"Monto",title:"Monto Estimado",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(colsOrdenesPrecargadas.length),format:Core.Functions.grid.formatPrice});colsOrdenesPrecargadas.push({field:"UsuarioCarga",title:"Cargado por",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(colsOrdenesPrecargadas.length),format:Core.Functions.grid.formatUndefinedString});colsOrdenesPrecargadas.push({field:"Estado",title:"Estado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(colsOrdenesPrecargadas.length),columnTemplate:function(cell,cellItem,index){cell.addClass("text-center");if(cellItem.Ejecutable){var lblState=$('<a class="precarg-estado">'+Core.Functions.grid.formatUndefinedString(cellItem.Estado)+"</a>").appendTo(cell);lblState.on("click",function(){Core.Business.EjecutarOrdenPrecargada.init(me.header.selectedIdAccount,me.idDefaultProfile,{idCuenta:me.header.selectedIdAccount,idOrdenPrecargada:cellItem.idOrdenPrecargada})})}else{var lblState=$('<span class="label label-precargadas">'+Core.Functions.grid.formatUndefinedString(cellItem.Estado)+"</span>").appendTo(cell)}}});colsOrdenesPrecargadas.push({width:50,title:" ",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(colsOrdenesPrecargadas.length),columnTemplate:function(cell,cellItem,index){if(cellItem.Cancelable){var btnCancel=$('<button type="button" title="Cancelar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(cell);btnCancel.on("click",function(){me.cancelOrder(cellItem)})}}});me.gridOrdenesPrecargadas.shieldGrid({dataSource:{data:[]},noRecordsText:"No hay Precargas en Curso",selection:false,rowHover:false,paging:{pageSize:30,pageLinksCount:10},columns:colsOrdenesPrecargadas});me.gridOrdenesDolarBCRA.shieldGrid({dataSource:{data:[]},noRecordsText:"No hay Ordenes en Curso",selection:false,rowHover:false,paging:{pageSize:30,pageLinksCount:10},columns:colsOrdenes});me.chartMonedas=AmCharts.makeChart(me.divChartMonedas[0],{type:"pie",innerRadius:"40%",startDuration:0,gradientRatio:[-0.4,-0.4,-0.4,-0.4,-0.4,-0.4,0,0.1,0.2,0.1,0,-0.2,-0.5],colorField:"color",balloonText:"[[value]]",valueField:"cantidad",titleField:"moneda",balloon:{drop:true,adjustBorderColor:false,color:"#FFFFFF",fontSize:12}});me.chartDistribucion=AmCharts.makeChart(me.divChartDistribucion[0],{type:"pie",innerRadius:"40%",startDuration:0,gradientRatio:[-0.4,-0.4,-0.4,-0.4,-0.4,-0.4,0,0.1,0.2,0.1,0,-0.2,-0.5],balloonText:"[[value]]",valueField:"pesos",titleField:"instrumento",colorField:"color",balloon:{drop:true,adjustBorderColor:false,color:"#FFFFFF",fontSize:12}})};me.renderBanners=function(){me.divBanners.empty();me.divContainerBanners.hide();var selectedAccount=$.grep(Core.Objects.Accounts,function(obj,index){return obj.idCuenta==me.header.selectedIdAccount})[0];if(selectedAccount&&Core.Objects.Context.Banners){var banners=$.grep(Core.Objects.Context.Banners,function(obj,index){return obj.idnegocio==selectedAccount.idNegocio});banners.forEach(function(obj,index){var div=$("<div "+(obj.backgroundcolor?('style="background:'+obj.backgroundcolor+';" '):"")+'class="item'+(index==0?" active":"")+'"></div>').appendTo(me.divBanners);$('<img class="adjust" src="'+obj.urlimagenlarge+'" />').appendTo(div);var divDescription=$('<div class="carousel-caption dipflex-slide"></div>').appendTo(div);$('<div class="slide-title">'+obj.textoimagen+"</div>").appendTo(divDescription);$("<div "+(obj.footerbackgroundcolor?('style="background:'+obj.footerbackgroundcolor+';" '):"")+'class="slide-txt">'+obj.textotitulopie+"</div>").appendTo(divDescription);div.on("click",function(){Core.Functions.Notification.execute(obj,me.header.selectedIdAccount,me.idDefaultProfile,function(){})});me.divContainerBanners.show()})}};me.loadCharts=function(firstLoad){var account=$.grep(Core.Objects.Accounts,function(obj,index){return obj.idCuenta==me.header.selectedIdAccount})[0];me.headerLabels.divTotal.removeClass("box-total-full-width");me.headerLabels.divTotal.addClass("box-total");me.headerLabels.divInstrumentos.show();me.headerLabels.divMonedas.show();me.headerLabels.divDisponible.show();me.divLiquidezProyectada.show();if(account.NumComitente==""&&account.NumCambio==""){me.headerLabels.divTotal.addClass("box-total-full-width");me.headerLabels.divTotal.removeClass("box-total");me.headerLabels.divInstrumentos.hide();me.headerLabels.divMonedas.hide();me.headerLabels.divDisponible.hide();me.divLiquidezProyectada.hide()}var requestData={Fecha:Core.Functions.Date.getDateAsString(me.txtDateFrom.swidget().value())};var idMonedaSeleccionada=me.ddlSeleccionMoneda.val();if(!firstLoad&&idMonedaSeleccionada){requestData.idMoneda=idMonedaSeleccionada}var sr=new Core.Ajax.ServerRequest({showOverlay:!me.loaded,secureRequest:true,requestUrl:"estadodecuenta/"+encodeURIComponent(me.header.selectedIdAccount),requestType:"GET",requestData:requestData});sr.onSuccess=function(responseObject){me.TenenciaActual=responseObject.tenenciaActual[0];me.Tenencias=responseObject.tenencia;me.Tenencias.forEach(function(tenencia){if(tenencia.ValorInicial==0){tenencia.Porcentaje=""}else{tenencia.Porcentaje=((tenencia.NoRealizado/tenencia.ValorInicial)*100).toFixed(1)+" %"}});me.Monedas=responseObject.liquidez;me.Ordenes=responseObject.ordenes;me.OrdenesPrecargadas=responseObject.precargas?responseObject.precargas:[];me.OrdenesDolarBCRA=responseObject.ordenesDolarBalanz?responseObject.ordenesDolarBalanz:[];me.cotizacionesDolar.forEach(function(obj,index){obj.divMain.remove()});var cotizacionesDolar=$.grep(responseObject.cotizacionesDolar,function(obj,index){return obj.habilitado});cotizacionesDolar.forEach(function(cotizacion,index){if(index<2){cotizacion.divMain=$('<div style="float: left; display: block;" class="col-md-6 col-sm-12 col-xs-12 div-dolar div-cotizacion-dolar-bolsa box-total-dolar bolsa"></div>').appendTo(me.divContainerCotizacionesDolar);if(cotizacionesDolar.length>1){cotizacion.divMain.addClass("x2")}me.setCotizacionDolarBolsa(cotizacion)}});me.cotizacionesDolar=cotizacionesDolar;me.renderSeleccionMoneda(responseObject.monedas);me.getLiquidez();me.getTenencia();me.getOrdenes();me.getOrdenesPrecargadas();me.getOrdenesDolarBCRA();me.loadHeaderLabels();me.loaded=true};sr.request()};me.loadHeaderLabels=function(){var formatColorByFirstDigit=function(value){var sign=value.substr(0,1);if(sign=="+"){return"<span style='color:green; font-size: 18px;'> "+value+"</span>"}if(sign=="-"){return"<span style='color:red; font-size: 18px;'>"+value+"</span>"}return""};var tenenciaActual=(!me.TenenciaActual.Total)?0:me.TenenciaActual.Total;var variacion=((!me.TenenciaActual.VariacionAbs)?0:me.TenenciaActual.VariacionAbs).toFixed(2);porcentajeVariacion=((!me.TenenciaActual.VariacionRel)?0:me.TenenciaActual.VariacionRel).toFixed(2);var textoVariacion="";if(variacion>0){textoVariacion="+"+Core.Functions.grid.formatIntegerNumber(variacion)+" ("+porcentajeVariacion+"%)"}else{if(variacion==0){textoVariacion="="+Core.Functions.grid.formatIntegerNumber(variacion)+" ("+porcentajeVariacion+"%)"}else{textoVariacion=Core.Functions.grid.formatIntegerNumber(variacion)+" ("+porcentajeVariacion+"%)"}}me.headerLabels.lblTotal.html(((me.TenenciaActual.SimboloMoneda)?(me.TenenciaActual.SimboloMoneda+" "):"$ ")+Core.Functions.grid.formatIntegerNumber(tenenciaActual)+"&nbsp;&nbsp;"+formatColorByFirstDigit(textoVariacion));me.divCotizacionMonedas.html(me.TenenciaActual.TextoCotizacionDolar?me.TenenciaActual.TextoCotizacionDolar:"");me.headerLabels.tblDisponible.empty();me.headerLabels.tblMonedas.empty();me.headerLabels.tblInstrumentos.empty();me.Monedas.forEach(function(moneda){me.renderCurrencyDetail(me.headerLabels.tblDisponible,moneda.Moneda,moneda.Simbolo,moneda.DO);me.renderCurrencyDetail(me.headerLabels.tblMonedas,moneda.Moneda,moneda.Simbolo,moneda.DFut);if(moneda.idMoneda==Core.Enums.Currency.Pesos.idMoneda){me.renderCurrencyDetail(me.headerLabels.tblInstrumentos,moneda.Moneda,moneda.Simbolo,me.TenenciaActual.InstrumentosPesos)}if(moneda.idMoneda==Core.Enums.Currency.Dolares.idMoneda){me.renderCurrencyDetail(me.headerLabels.tblInstrumentos,moneda.Moneda,moneda.Simbolo,me.TenenciaActual.InstrumentosDolares)}})};me.renderCurrencyDetail=function(div,label,currency,value){var tr=$("<tr></tr>").appendTo(div);$('<td><p class="ta-l"><span class="detalle-monedas">'+label+"</span></p></td>").appendTo(tr);$('<td><p class="ta-r"><strong>'+currency+" "+Core.Functions.grid.formatIntegerNumber(value)+"</strong></p></td>").appendTo(tr)};me.loadChart=function(chart,dataSource,divChart,exportExcel){if(divChart){divChart.show();if(dataSource.length==0){divChart.hide()}}var scrollTop=me.window.scrollTop();var shieldGrid=chart.swidget();if(shieldGrid){var initialOptions=shieldGrid.initialOptions;initialOptions.dataSource.data=dataSource;if(exportExcel){initialOptions.exportOptions.excel.dataSource.data=dataSource;initialOptions.exportOptions.excel.readDataSource=true}shieldGrid.refresh(initialOptions);me.window.scrollTop(scrollTop)}};me.loadChartDistribucion=function(tenencias,monedas){var dicTenencias={};var data=[];tenencias.forEach(function(tenencia){if(tenencia.Tipo!="Futuros"){dicTenencias[tenencia.Tipo]=(dicTenencias[tenencia.Tipo])?(parseFloat(dicTenencias[tenencia.Tipo])+parseFloat(tenencia.ValorActualPesos)).toFixed(2):(parseFloat(tenencia.ValorActualPesos)).toFixed(2)}});monedas.forEach(function(valorActual){dicTenencias[valorActual.Moneda]=(dicTenencias[valorActual.Moneda])?(parseFloat(dicTenencias[valorActual.Moneda])+(parseFloat(valorActual.DFut)*parseFloat(valorActual.Cotizacion))).toFixed(2):(parseFloat(valorActual.DFut)*parseFloat(valorActual.Cotizacion)).toFixed(2)});$.each(dicTenencias,function(key,value){data.push({instrumento:key,pesos:value,color:me.colorByInstrument[key]})});me.chartDistribucion.dataProvider=data;me.chartDistribucion.validateData()};me.loadChartMonedas=function(monedas,tenencias){var dicMonedas={};var data=[];monedas.forEach(function(valorActual){dicMonedas[valorActual.Moneda]=(dicMonedas[valorActual.Moneda])?(parseFloat(dicMonedas[valorActual.Moneda])+(parseFloat(valorActual.DFut)*parseFloat(valorActual.Cotizacion))).toFixed(2):(parseFloat(valorActual.DFut)*parseFloat(valorActual.Cotizacion)).toFixed(2)});tenencias.forEach(function(tenencia){if(tenencia.Tipo!="Futuros"){dicMonedas[tenencia.Moneda]=(dicMonedas[tenencia.Moneda])?(parseFloat(dicMonedas[tenencia.Moneda])+parseFloat(tenencia.ValorActualPesos)).toFixed(2):(parseFloat(tenencia.ValorActualPesos)).toFixed(2)}});$.each(dicMonedas,function(key,value){data.push({moneda:key,cantidad:value,color:me.colorByCurrency[key]})});me.chartMonedas.dataProvider=data;me.chartMonedas.validateData()};me.getLiquidez=function(){me.loadChart(me.gridLiquidez,me.Monedas);me.loadChartMonedas(me.Monedas,me.Tenencias)};me.getTenencia=function(){me.loadChart(me.gridTenenciaPesos,$.grep(me.Tenencias,function(obj,index){return obj.Grilla==Core.Business.eGrillaTenencia.Pesos}),null,me.pageOptions.exportarexcelposicion);me.loadChart(me.gridTenenciaDolares,$.grep(me.Tenencias,function(obj,index){return obj.Grilla==Core.Business.eGrillaTenencia.Dolares}),me.divTenenciaDolares,me.pageOptions.exportarexcelposicion);me.loadChartDistribucion(me.Tenencias,me.Monedas)};me.getOrdenes=function(){me.loadChart(me.gridOrdenes,me.Ordenes)};me.getOrdenesPrecargadas=function(){me.loadChart(me.gridOrdenesPrecargadas,me.OrdenesPrecargadas,me.divOrdenesPrecargadas);me.lblCantidadPrecargas.text($.grep(me.OrdenesPrecargadas,function(obj,index){return obj.Ejecutable}).length)};me.getOrdenesDolarBCRA=function(){if(me.optionsDolarBcra&&me.optionsDolarBcra.monedasBalanzCambio){me.loadChart(me.gridOrdenesDolarBCRA,me.OrdenesDolarBCRA,me.divOrdenesDolarBCRA)}else{me.divOrdenesDolarBCRA.hide()}};me.renderSeleccionMoneda=function(monedas){me.ddlSeleccionMoneda.empty();monedas=monedas?monedas:[];monedas.forEach(function(moneda,index){$('<option value="'+moneda.idMoneda+'"'+(moneda.selected?" selected":"")+">"+moneda.Descripcion+"</option>").appendTo(me.ddlSeleccionMoneda)});me.divSeleccionMoneda.hide();if(monedas.length>0){me.divSeleccionMoneda.show()}};me.cancelOrder=function(order){var divCancelarOrden=$(".div-cancelar-orden");var txtCodigo4D=divCancelarOrden.find(".textbox-codigo4d");txtCodigo4D.val("");divCancelarOrden.find(".btn-cancel").unbind("click");divCancelarOrden.find(".btn-cancel").click(function(){var valid={value:true};var confirmData={};confirmData.idCuenta=me.header.selectedIdAccount;confirmData.Codigo4D=Core.Functions.Validations.getValidatedInputValue(txtCodigo4D,valid);var requestUrl="";if(order.idOrdenPrecargada){confirmData.idOrdenPrecargada=order.idOrdenPrecargada;requestUrl="precargar/cancelar"}else{confirmData.idOrden=order.idOrden;requestUrl="operar/cancelar"}if(!valid.value){return}var sr=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:requestUrl,requestType:"POST",requestData:confirmData});sr.onSuccess=function(response){var modal=new Core.Controls.Dialog("Aviso",(response.Descripcion==null||response.Descripcion==""?"Su orden esta en proceso de Cancelación":response.Descripcion),{displayButtons:{close:true,accept:false}});modal.show();me.loaded=false;me.loadCharts()};sr.onComplete=function(){divCancelarOrden.modal("hide")};sr.request()});var description="¿Confirma la solicitud de cancelación de la "+(order.idOrdenPrecargada?"Precarga":"Orden");description+=(order.Operacion?(" de "+order.Operacion):"");description+=((order.Cantidad&&order.Cantidad>0)?(" de "+order.Cantidad+" Nominales"):"");description+=(order.Ticker?(" del instrumento "+order.Ticker):"");description+=((order.Monto&&order.Monto>0)?(" por un monto de "+order.Monto+" "+order.Moneda):"");description+="?";divCancelarOrden.find(".div-description").html(description);divCancelarOrden.modal({show:true})};me.getOperarRequestData=function(ordenPrecargada){var requestData={};if(ordenPrecargada.idCuenta!=undefined){requestData.idCuenta=ordenPrecargada.idCuenta}if(ordenPrecargada.FechaVencimiento!=undefined){requestData.FechaVencimiento=ordenPrecargada.FechaVencimiento}if(ordenPrecargada.idTipoOperacion!=undefined){requestData.idTipoOperacion=ordenPrecargada.idTipoOperacion}if(ordenPrecargada.Ticker!=undefined){requestData.ticker=ordenPrecargada.Ticker}if(ordenPrecargada.Plazo!=undefined){requestData.Plazo=ordenPrecargada.Plazo}if(ordenPrecargada.idMoneda!=undefined){requestData.idMoneda=ordenPrecargada.idMoneda}if(ordenPrecargada.Cantidad!=undefined){requestData.Cantidad=ordenPrecargada.Cantidad}if(ordenPrecargada.Monto!=undefined){requestData.Monto=ordenPrecargada.Monto}if(ordenPrecargada.PrecioDisparo!=undefined){requestData.PrecioDisparo=ordenPrecargada.PrecioDisparo}if(ordenPrecargada.Observaciones!=undefined){requestData.Observaciones=ordenPrecargada.Observaciones}if(ordenPrecargada.idOrdenPrecargada!=undefined){requestData.idOrdenPrecargada=ordenPrecargada.idOrdenPrecargada}if(ordenPrecargada.OrderType!=undefined){requestData.OrderType=ordenPrecargada.OrderType}if(ordenPrecargada.TimeInForce!=undefined){requestData.TimeInForce=ordenPrecargada.TimeInForce}if(ordenPrecargada.DisplayQty!=undefined){requestData.DisplayQty=ordenPrecargada.DisplayQty}if(ordenPrecargada.ExecInst!=undefined){requestData.ExecInst=ordenPrecargada.ExecInst}if(ordenPrecargada.PrecioLimite!=undefined){requestData.PrecioLimite=ordenPrecargada.PrecioLimite}if(ordenPrecargada.FechaEjecucion!=undefined){requestData.FechaEjecucion=ordenPrecargada.FechaEjecucion}if(ordenPrecargada.MinutosEjecucion!=undefined){requestData.MinutosEjecucion=ordenPrecargada.MinutosEjecucion}if(ordenPrecargada.FechaExpiracion!=undefined){requestData.FechaExpiracion=ordenPrecargada.FechaExpiracion}if(ordenPrecargada.MinutosExpiracion!=undefined){requestData.MinutosExpiracion=ordenPrecargada.MinutosExpiracion}if(ordenPrecargada.EjecutarValidaciones!=undefined){requestData.EjecutarValidaciones=ordenPrecargada.EjecutarValidaciones}if(ordenPrecargada.ContinuarAutomaticamente!=undefined){requestData.ContinuarAutomaticamente=ordenPrecargada.ContinuarAutomaticamente}return requestData};me.window=$(window)};Core.Business.PosicionConsolidada.BalanzCambioCuentasCorrientes=function(b){var a=this;a.divBalanzCambioCuentasCorrientes=$(".div-balanz-cambio-cuentas-corrientes");a.divContainerDisponible=null;a.divContainerDisponibleVacio=null;a.divCuentasCambio=null;a.divDisponiblePesos=null;a.lblTitleDisponiblePesos=null;a.divDisponibleDolares=null;a.lblTibleDisponibleDolares=null;a.selectedIdAccount=null;$.extend(true,a,b);a.data=null;a.show=function(){a.divContainerDisponible=a.divBalanzCambioCuentasCorrientes.find(".div-container-disponible");a.divContainerDisponibleVacio=a.divBalanzCambioCuentasCorrientes.find(".div-container-disponible-vacio");a.divCuentasCambio=a.divBalanzCambioCuentasCorrientes.find(".div-buttons-cuentas-cambio");a.divDisponiblePesos=a.divBalanzCambioCuentasCorrientes.find(".div-disponible-pesos");a.lblTitleDisponiblePesos=a.divBalanzCambioCuentasCorrientes.find(".lbl-title-disponible-pesos");a.divDisponibleDolares=a.divBalanzCambioCuentasCorrientes.find(".div-disponible-dolares");a.lblTibleDisponibleDolares=a.divBalanzCambioCuentasCorrientes.find(".lbl-title-disponible-dolares");a.divBalanzCambioCuentasCorrientes.unbind("hidden.bs.modal");a.divBalanzCambioCuentasCorrientes.on("hidden.bs.modal",function(){a.destroy()});a.initGrid();a.getData()};a.initGrid=function(){var c=[];c.push({field:"Fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatStringDate});c.push({field:"Descripcion",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"Cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatIntegerNumber});c.push({field:"Importe",title:"Importe",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatPrice});c.push({field:"Saldo",title:"Saldo",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatPrice});c.push({width:50,title:" ",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),columnTemplate:function(d,e,f){if(e.reporte&&e.reporte!=""&&e.codigo&&e.codigo!=""){d.html('<button type="button" title="Descargar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');d.addClass("link-cell");d.on("click",function(){Core.Functions.File.download(d,Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"descargar/"+e.reporte+"/"+e.codigo,function(){})})}}});a.divDisponiblePesos.shieldGrid({dataSource:{data:[]},noRecordsText:"No se encontró información",selection:false,rowHover:false,paging:{pageSize:30,pageLinksCount:10},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Disponible en Pesos",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["Fecha","Descripcion","Cantidad","Importe","Saldo"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Disponible en Pesos"}}},columns:c});a.divDisponibleDolares.shieldGrid({dataSource:{data:[]},noRecordsText:"No se encontró información",selection:false,rowHover:false,paging:{pageSize:30,pageLinksCount:10},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Disponible en Dólares",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["Fecha","Descripcion","Cantidad","Importe","Saldo"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Disponible en Dólares"}}},columns:c})};a.getData=function(){var c=new Date();c.setDate(c.getDate()-60);var d;d="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(c));d+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(new Date()));var e=new Core.Ajax.ServerRequest({showOverlay:true,requestUrl:"balanzcambio/cuentascorrientes/"+a.selectedIdAccount,requestType:"GET",requestData:d});e.onSuccess=function(g){a.data=g;a.divCuentasCambio.html("");if(a.data.disponibles){var f=[];$.each(a.data.disponibles,function(i,j){if(!$.grep(f,function(k,l){return k.Descripcion==j.Descripcion})[0]){var h=$("<li"+(f.length?"":' class="active"')+'><a data-toggle="tab">'+j.Descripcion+"<br />CUIL: "+j.CUIL+"</a></li>").appendTo(a.divCuentasCambio);h.on("click",function(){a.loadControls(j.idCuentaCambio)});f.push(j)}});if(a.data.disponibles.length){a.divCuentasCambio.find(".active")[0].click()}}a.divBalanzCambioCuentasCorrientes.modal({show:true})};e.request()};a.loadControls=function(e){if(e){var d=$.grep(a.data.disponibles,function(h,g){return h.idCuentaCambio==e&&h.idMoneda==Core.Enums.Currency.Pesos.idMoneda})[0];var c=$.grep(a.data.disponibles,function(h,g){return h.idCuentaCambio==e&&h.idMoneda==Core.Enums.Currency.Dolares.idMoneda})[0];a.lblTitleDisponiblePesos.text("Disponible en pesos al "+Core.Functions.grid.formatStringDate(d.Fecha)+" "+d.Simbolo+" "+Core.Functions.grid.formatNumber(d.Disponible));a.lblTibleDisponibleDolares.text("Disponible en dolares al "+Core.Functions.grid.formatStringDate(c.Fecha)+" "+c.Simbolo+" "+Core.Functions.grid.formatNumber(c.Disponible));var f=a.divDisponiblePesos.swidget().initialOptions;f.dataSource.data=$.grep(a.data.cuentascorrientes,function(h,g){return h.idCuentaCambio==e&&h.Moneda=="Pesos"});f.exportOptions.excel.dataSource.data=$.grep(a.data.cuentascorrientes,function(h,g){return h.idCuentaCambio==e&&h.Moneda=="Pesos"});f.exportOptions.excel.readDataSource=true;a.divDisponiblePesos.swidget().refresh(f);var f=a.divDisponibleDolares.swidget().initialOptions;f.dataSource.data=$.grep(a.data.cuentascorrientes,function(h,g){return h.idCuentaCambio==e&&h.Moneda=="Dólares"});f.exportOptions.excel.dataSource.data=$.grep(a.data.cuentascorrientes,function(h,g){return h.idCuentaCambio==e&&h.Moneda=="Dólares"});f.exportOptions.excel.readDataSource=true;a.divDisponibleDolares.swidget().refresh(f);a.divContainerDisponible.show();a.divContainerDisponibleVacio.hide()}else{a.divContainerDisponible.hide();a.divContainerDisponibleVacio.show()}};a.destroy=function(){a.divDisponiblePesos.swidget().destroy();a.divDisponibleDolares.swidget().destroy()}};Core.Business.PosicionConsolidada.CuentasBancariasBalanz=function(b){var a=this;a.overlayElement=null;a.selectedAccount=null;a.divMonedas=[];$.extend(true,a,b);a.divMain=$(".div-modal-cuentas-bancarias-balanz");a.show=function(){var c=new Core.Ajax.ServerRequest({allowCache:true,showOverlay:true,overlayElement:a.overlayElement,secureRequest:true,requestUrl:"cuentasbancariasbalanz",requestType:"GET"});c.onSuccess=function(d){a.divCuentasBancarias=a.divMain.find(".div-cuentas-bancarias");a.divCuentasBancarias.empty();d.cuentas.forEach(function(j,h){if(a.selectedAccount&&j.PropuestaFondeo&&j.idNegocio==a.selectedAccount.idNegocio){var e=$.grep(a.divMonedas,function(k,l){return k.idMoneda==j.idMoneda})[0];if(!e){var f=$("<div></div>").appendTo(a.divCuentasBancarias);var i=$('<h4 style="color:#0d0c5c !important; font-weight: 600; padding-bottom: 25px;"><i class="fa fa-caret-right" aria-hidden="true"></i> Cuentas en '+j.Moneda+":</h4>").appendTo(f);var g=$("<div></div>").appendTo(f);e={idMoneda:j.idMoneda,divCuentasBancarias:g};a.divMonedas.push(e)}a.renderCuentaBancaria(e.divCuentasBancarias,j)}});a.divMain.modal({show:true})};c.request()};a.renderCuentaBancaria=function(d,c){var e=$('<p style="padding-bottom: 20px;"></p>').appendTo(d);if(c.Banco){$("<strong>"+c.Banco+"</strong><br /><br />").appendTo(e)}if(c.Titular){$('<span class="font-w">Titular:</span> '+c.Titular+"<br />").appendTo(e)}if(c.CUIT){$('<span class="font-w">Cuit:</span> '+c.CUIT+"<br />").appendTo(e)}if(c.Descripcion){$('<span class="font-w">Cuenta:</span> '+c.Descripcion+"<br />").appendTo(e)}if(c.CBU){$('<span class="font-w">CBU:</span> <span class="blue-cuadro font-w">'+c.CBU+"</span><br />").appendTo(e)}if(c.Alias){$('<span class="font-w">Alias:</span> <span class="blue-cuadro font-w">'+c.Alias+"</span><br />").appendTo(e)}if(c.SWIFT){$('<span class="font-w">SWIFT:</span> <span class="blue-cuadro font-w">'+c.SWIFT+"</span><br />").appendTo(e)}if(c.ABA){$('<span class="font-w">ABA:</span> <span class="blue-cuadro font-w">'+c.ABA+"</span><br />").appendTo(e)}if(c.Beneficiario){$('<span class="font-w">Beneficiario:</span> <span class="blue-cuadro font-w">'+c.Beneficiario+"</span><br />").appendTo(e)}if(c.NroCuenta){$('<span class="font-w">Nro Cuenta:</span> <span class="blue-cuadro font-w">'+c.NroCuenta+"</span><br />").appendTo(e)}}};Core.Business.Realizado=new function(){var a=this;a.id="realizado";a.divConsideraciones=null;a.divResumenPorTipo=null;a.lblTitleResumenPorTipo=null;a.divResumenPorInstrumento=null;a.lblTitleResumenPorInstrumento=null;a.divResumenPorOperacion=null;a.lblTitleResumenPorOperacion=null;a.txtDateFrom=null;a.txtDateTo=null;a.init=function(b,c){Core.loadPage("realizado.html",function(){document.title="Resultados";a.divConsideraciones=$(".div-consideraciones");a.divResumenPorTipo=$(".div-resumen-por-tipo");a.lblTitleResumenPorTipo=$(".label-title-resumen-por-tipo");a.divResumenPorInstrumento=$(".div-resumen-por-instrumento");a.lblTitleResumenPorInstrumento=$(".label-title-resumen-por-instrumento");a.divResumenPorOperacion=$(".div-resumen-por-operacion");a.lblTitleResumenPorOperacion=$(".label-title-resumen-por-operacion");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.initDatePickers();a.initGrids();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,b,c,a.loadGrids,"Core.Business.Realizado")})};a.initDatePickers=function(){var b=new Date();b.setMonth(0,1);b.setYear(b.getFullYear()-1);var c=new Date();c.setMonth(11,31);c.setYear(c.getFullYear()-1);a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:b,max:new Date(),events:{change:function(d){a.loadGrids()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:c,max:new Date(),events:{change:function(d){a.loadGrids()}}})};a.initGrids=function(){a.divResumenPorTipo.shieldGrid({dataSource:{data:[],aggregate:[{field:"Realizado",aggregate:"sum"},{field:"Cupones",aggregate:"sum"},{field:"Dividendos",aggregate:"sum"},{field:"MTMFuturos",aggregate:"sum"},{field:"Gastos",aggregate:"sum"}]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Resumen por Tipo",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["RazonSocial","Tipo","Realizado","Cupones","Dividendos","MTMFuturos","Gastos"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Resumen por Tipo"}}},selection:false,rowHover:false,sorting:{multiple:true},columns:[{footerTemplate:"<div style='text-align: left;'>Total en Pesos</div>",field:"Tipo",title:"Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{footerTemplate:"<div style='text-align: right;'> $ {sum:n2}</div>",field:"Realizado",title:"Resultado",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNullNumber},{footerTemplate:"<div style='text-align: right;'> $ {sum:n2}</div>",field:"Cupones",title:"Cupones",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNullNumber},{footerTemplate:"<div style='text-align: right;'> $ {sum:n2}</div>",field:"Dividendos",title:"Dividendos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNullNumber},{footerTemplate:"<div style='text-align: right;'> $ {sum:n2}</div>",field:"MTMFuturos",title:"MTM Futuros",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNullNumber},{footerTemplate:"<div style='text-align: right;'> $ {sum:n2}</div>",field:"Gastos",title:"Gastos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNullNumber}]});a.divResumenPorInstrumento.shieldGrid({dataSource:{data:[],aggregate:[{field:"Realizado",aggregate:"sum"},{field:"Cupones",aggregate:"sum"},{field:"Dividendos",aggregate:"sum"},{field:"MTMFuturos",aggregate:"sum"},{field:"Gastos",aggregate:"sum"}]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Resumen por Instrumento",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["RazonSocial","Tipo","Ticker","Realizado","Cupones","Dividendos","MTMFuturos","Gastos"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Resumen por Instrumento"}}},selection:false,rowHover:false,sorting:{multiple:true},columns:[{footerTemplate:"<div style='text-align: left;'>Total en Pesos</div>",field:"Tipo",title:"Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"Ticker",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{footerTemplate:"<div style='text-align: right;'> $ {sum:n2}</div>",field:"Realizado",title:"Resultado",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNullNumber},{footerTemplate:"<div style='text-align: right;'> $ {sum:n2}</div>",field:"Cupones",title:"Cupones",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNullNumber},{footerTemplate:"<div style='text-align: right;'> $ {sum:n2}</div>",field:"Dividendos",title:"Dividendos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNullNumber},{footerTemplate:"<div style='text-align: right;'> $ {sum:n2}</div>",field:"MTMFuturos",title:"MTM Futuros",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNullNumber},{footerTemplate:"<div style='text-align: right;'> $ {sum:n2}</div>",field:"Gastos",title:"Gastos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNullNumber}]});a.divResumenPorOperacion.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Resumen por Operación",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["RazonSocial","Tipo","Ticker","Motivo","Descripcion","Fecha","FechaCompra","Cantidad","PrecioCompra","PrecioVenta","TCC","TCV","Realizado","Cupones","Dividendos","MTMFuturos","Gastos","OperacionCompra","OperacionVenta"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Resumen por Operación"}}},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:100,pageLinksCount:10},columns:[{field:"Tipo",title:"Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"Ticker",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{field:"Motivo",title:"Motivo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"Fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{field:"Cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedIntegerNumber},{field:"PrecioCompra",title:"Precio Compra",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatPrice},{field:"PrecioVenta",title:"Precio Venta",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatPrice},{field:"TCV",title:"Tipo de Cambio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNullNumber},{field:"Realizado",title:"Resultado",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNullNumber},{field:"Cupones",title:"Cupones",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNullNumber},{field:"Dividendos",title:"Dividendos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNullNumber},{field:"MTMFuturos",title:"MTM Futuros",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNullNumber},{field:"Gastos",title:"Gastos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNullNumber}]})};a.loadGrids=function(){a.lblTitleResumenPorTipo.text("Resultado por tipo de instrumento - Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));a.lblTitleResumenPorInstrumento.text("Resultado por Ticker - Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));a.lblTitleResumenPorOperacion.text("Resultado por operación - Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var b;b="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));b+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"realizado/"+encodeURIComponent(a.header.selectedIdAccount),requestType:"GET",requestData:b});c.onSuccess=function(d){a.divConsideraciones.html((d.consideraciones.length>0)?d.consideraciones[0].Consideraciones:"");var g=a.divResumenPorTipo.swidget().initialOptions;g.dataSource.data=d;g.dataSource.schema={data:"resumenportipo"};g.exportOptions.excel.dataSource.data=d;g.exportOptions.excel.dataSource.schema={data:"resumenportipo"};g.exportOptions.excel.readDataSource=true;a.divResumenPorTipo.swidget().refresh(g);var e=a.divResumenPorInstrumento.swidget().initialOptions;e.dataSource.data=d;e.dataSource.schema={data:"resumenporinstrumento"};e.exportOptions.excel.dataSource.data=d;e.exportOptions.excel.dataSource.schema={data:"resumenporinstrumento"};e.exportOptions.excel.readDataSource=true;a.divResumenPorInstrumento.swidget().refresh(e);var f=a.divResumenPorOperacion.swidget().initialOptions;f.dataSource.data=d;f.dataSource.schema={data:"resumenporoperacion"};f.exportOptions.excel.dataSource.data=d;f.exportOptions.excel.dataSource.schema={data:"resumenporoperacion"};f.exportOptions.excel.readDataSource=true;a.divResumenPorOperacion.swidget().refresh(f)};c.request()}};Core.Business.RealizadoLotes=new function(){var a=this;a.id="realizadoLotes";a.init=function(b,c){Core.loadPage("realizado-lotes.html",function(){document.title="Resultados";a.divConsideraciones=$(".div-consideraciones");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.divPosicionInicial=$(".div-posicion-inicial");a.divRealizado=$(".div-realizado");a.divPosicionFinal=$(".div-posicion-final");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,b,c,a.loadGrids,"Core.Business.RealizadoLotes")})};a.initControls=function(){var d=new Date();d.setMonth(0,1);d.setYear(d.getFullYear()-1);a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:d,max:new Date(),events:{change:function(f){a.loadGrids()}}});var e=new Date();e.setMonth(11,31);e.setYear(e.getFullYear()-1);a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:e,max:new Date(),events:{change:function(f){a.loadGrids()}}});var b=[];b.push({width:"7%",field:"Cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatDecimal});b.push({width:"15%",field:"Descripcion",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"7%",field:"DolarCCL",title:"Dólar CCL",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatDecimal});b.push({width:"7%",field:"DolarMEP",title:"Dólar MEP",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatDecimal});b.push({width:"7%",field:"DolarOficial",title:"Dólar Oficial",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatDecimal});b.push({width:"7%",field:"Fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"7%",field:"Gastos",title:"Gastos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatDecimal});b.push({width:"7%",field:"Moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"15%",field:"Operacion",title:"Operación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"7%",field:"PrecioCompra",title:"Precio Compra",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatDecimal});b.push({width:"7%",field:"Ticker",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"7%",field:"Tipo",title:"Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});a.divPosicionInicial.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},columns:b,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Posicion Inicial",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["Cantidad","Descripcion","DolarCCL","DolarMEP","DolarOficial","Fecha","Gastos","Moneda","Operacion","PrecioCompra","Ticker","Tipo"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Posicion Inicial"}}}});a.divPosicionFinal.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},columns:b,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Posicion Final",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["Cantidad","Descripcion","DolarCCL","DolarMEP","DolarOficial","Fecha","Gastos","Moneda","Operacion","PrecioCompra","Ticker","Tipo"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Posicion Final"}}}});var c=[];c.push({width:"5%",field:"Cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatDecimal});c.push({width:"9%",field:"Descripcion",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"5%",field:"Fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"5%",field:"Gastos",title:"Gastos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatDecimal});c.push({width:"5%",field:"MonedaCompra",title:"Moneda Compra",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"5%",field:"MonedaVenta",title:"Moneda Venta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"8%",field:"OperacionCompra",title:"Operación Compra",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"5%",field:"OperacionCompraDolarCCL",title:"Operación Compra Dólar CCL",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatDecimal});c.push({width:"5%",field:"OperacionCompraDolarMEP",title:"Operación Compra Dólar MEP",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatDecimal});c.push({width:"5%",field:"OperacionCompraDolarOficial",title:"Operación Compra Dólar Oficial",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatDecimal});c.push({width:"8%",field:"OperacionVenta",title:"Operación Venta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"5%",field:"OperacionVentaDolarCCL",title:"Operación Venta Dólar CCL",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatDecimal});c.push({width:"5%",field:"OperacionVentaDolarMEP",title:"Operación Venta Dólar MEP",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatDecimal});c.push({width:"5%",field:"OperacionVentaDolarOficial",title:"Operación Venta Dólar Oficial",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatDecimal});c.push({width:"5%",field:"PrecioCompra",title:"Precio Compra",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatDecimal});c.push({width:"5%",field:"PrecioVenta",title:"Precio Venta",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatDecimal});c.push({width:"5%",field:"Ticker",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({width:"5%",field:"Tipo",title:"Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});a.divRealizado.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},columns:c,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Realizado",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["Cantidad","Descripcion","FechaCompra","Fecha","Gastos","MonedaCompra","MonedaVenta","OperacionCompra","OperacionCompraDolarCCL","OperacionCompraDolarMEP","OperacionCompraDolarOficial","OperacionVenta","OperacionVentaDolarCCL","OperacionVentaDolarMEP","OperacionVentaDolarOficial","PrecioCompra","PrecioVenta","Ticker","Tipo"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Realizado"}}}})};a.loadGrids=function(){var b;b="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));b+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"realizado/lotes/"+encodeURIComponent(a.header.selectedIdAccount),requestType:"GET",requestData:b});c.onSuccess=function(d){a.divConsideraciones.html((d.consideraciones.length>0)?d.consideraciones[0].Consideraciones:"");a.refreshGrid(a.divPosicionInicial,(d.lotesIniciales?d.lotesIniciales:[]));a.refreshGrid(a.divRealizado,(d.realizado?d.realizado:[]));a.refreshGrid(a.divPosicionFinal,(d.lotesFinales?d.lotesFinales:[]))};c.request()};a.refreshGrid=function(c,b){var d=c.swidget().initialOptions;d.dataSource.data=b;d.exportOptions.excel.dataSource.data=b;d.exportOptions.excel.readDataSource=true;c.swidget().refresh(d)}};Core.Business.RegistrarUsuario=new function(){var a=this;a.divMain=null;a.divAlert=null;a.nonce=null;a.txtUser=null;a.txtPass1=null;a.txtPass2=null;a.btnContinue=null;a.init=function(b){Core.loadPage("registrar-usuario.html",function(){document.title="Registrar Usuario";a.nonce=b;a.divMain=$(".panel-body");a.divAlert=$(".sign-in-alert");a.txtUser=$(".textbox-user");a.txtPass1=$(".textbox-pass1");a.txtPass2=$(".textbox-pass2");a.btnContinue=$(".button-continue");var c=new Core.Ajax.ServerRequest({overlayElement:a.divMain,secureRequest:true,requestUrl:"usuario/validacionnonce",requestType:"POST",requestData:{Nonce:a.nonce}});c.onSuccess=function(){a.initControls()};c.onError=function(d){Core.Business.ActivacionUsuario.init(d.responseJSON?d.responseJSON.descripcion:"")};c.request()})};a.initControls=function(){a.divAlert.slideUp();a.txtPass1.password_strength();Core.Functions.changePassword.setPasswordsControl(a.txtPass1,a.txtPass2);new Core.Controls.CapslockWarning(a.txtPass2);a.txtUser.on("focusout",function(){a.validUser(null)});a.txtUser.on("focus",function(){Core.Functions.Validations.toggleValidation(a.txtUser,false)});a.btnContinue.click(function(){Core.Functions.Validations.toggleValidation(a.txtUser,false);Core.Functions.Validations.toggleValidation(a.txtPass1,false);Core.Functions.Validations.toggleValidation(a.txtPass2,false);a.divAlert.slideUp();if(!Core.Functions.changePassword.isValidPasswords(a.txtPass1,a.txtPass2,a.divAlert)){return}a.validUser(function(){var b=new Core.Ajax.ServerRequest({overlayElement:a.divMain,secureRequest:true,requestUrl:"usuario/registrar",requestType:"POST",requestData:{Usuario:a.txtUser.val(),Clave:a.txtPass1.val(),Nonce:a.nonce}});b.onSuccess=function(d){var c=new Core.Controls.Dialog("Mensaje","<p>"+d.Descripcion+"</p>",{displayButtons:{close:true,accept:false},onClosed:function(){Core.Business.Logout.clearSession();window.location.href=window.location.origin+Core.Functions.Context.getPathname()}});c.show()};b.request()})})};a.validUser=function(b){Core.Functions.Validations.toggleValidation(a.txtUser,false);a.divAlert.slideUp();var e=a.txtUser.val();if(!e){Core.Functions.Validations.toggleValidation(a.txtUser,true);return}var c=/^[0-9a-zA-Z.]+$/;if(e.length<6||e.length>20||!c.test(e)){Core.Functions.Validations.toggleValidation(a.txtUser,true);a.divAlert.text("El usuario debe contener entre 6 y 20 caracteres alfanuméricos.");a.divAlert.slideDown();return}var d=new Core.Ajax.ServerRequest({overlayElement:a.divMain,secureRequest:true,requestUrl:"usuario/validacionusuario",requestType:"POST",requestData:{Usuario:a.txtUser.val(),Nonce:a.nonce}});d.onSuccess=function(f){if(f.error){Core.Functions.Validations.toggleValidation(a.txtUser,true);a.divAlert.text(f.descripcion);a.divAlert.slideDown()}else{Core.Functions.Validations.toggleValidation(a.txtUser,false);a.divAlert.slideUp();a.txtUser.closest(".input-group, .form-group").addClass("has-success");if(b){b()}}};d.request()}};Core.Business.ReporteAperturasCuentas=new function(){var b=this;var a=13;b.id="homeReporteAperturasCuentas";b.divReporteAperturasCuentas=null;b.idDefaultAccount=null;b.idDefaultProfile=null;b.pageOptions=null;b.txtFilter=null;b.timeout=null;b.containerReporteAperturasCuentas=null;b.containerAltaCuenta=null;b.init=function(c,d,e){Core.loadPage("reporte-aperturas-cuentas.html",function(){document.title="Aperturas de Cuentas";b.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(b.id,Core.Objects.Context.Profiles[d]);b.idDefaultAccount=c;b.idDefaultProfile=d;b.containerReporteAperturasCuentas=$(".div-container-reporte-aperturas-cuentas");b.containerReporteAperturasCuentas.show();b.containerAltaCuenta=$(".div-container-alta-cuenta");b.containerAltaCuenta.hide();b.txtFilter=$(".textbox-filter");b.txtSearch=$(".textbox-search");b.btnSearch=$(".btn-search");if(e&&e.search){b.txtFilter.val(e.search);b.txtSearch.val(e.search)}b.divContainerTablaAperturasCuentas=$(".div-container-tabla-aperturas-cuentas");b.divContainerTablaAperturasCuentas.hide();b.divReporteAperturasCuentas=$(".div-aperturas-cuentas");b.initControls();b.initFilter();b.initGrid();b.header=new Core.Controls.Header($("#topNav"),{});b.header.init(false,c,d,function(){if(Core.Objects.ReporteAperturasCuentas){b.divContainerTablaAperturasCuentas.show()}},"Core.Business.ReporteAperturasCuentas")})};b.initFilter=function(){b.txtFilter.on("keydown",function(){clearTimeout(b.timeout);b.timeout=setTimeout(function(){value=b.txtFilter.val();var c=b.divReporteAperturasCuentas.swidget().dataSource;if(value){c.filter={or:[{path:"idAperturaCuenta",filter:"contains",value:value},{path:"VersionActual",filter:"contains",value:value},{path:"Estado",filter:"contains",value:value},{path:"Asesor",filter:"contains",value:value},{path:"Cuenta",filter:"contains",value:value},{path:"email",filter:"contains",value:value},{path:"FechaUltimoCambioEstado",filter:"contains",value:value},{path:"HoraUltimoCambioEstado",filter:"contains",value:value}]}}else{c.filter=null}c.read()},50)});Core.Functions.Persistence.setTextBox(b.txtFilter,"Core.Business.ReporteAperturasCuentas.txtFilter")};b.initGrid=function(){var c=[];var d=Core.Functions.grid.getHeaderAttribute(1);c.push({width:30,field:"",title:" ",headerAttributes:d,columnTemplate:function(e,f,g){if(f.idNegocio==Core.Enums.eNegocio.BCI){$('<img src="/images/icono-internacional.svg" style="margin-left:10px; width:20px; height:20px;" />').appendTo(e)}}});c.push({field:"idAperturaCuenta",title:"ID Apertura Cuenta",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"12%",headerAttributes:d});c.push({field:"VersionActual",title:"Versión Actual",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"FechaCreacion",title:"Fecha Creación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"Estado",title:"Estado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"Asesor",title:"Asesor",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"Cuenta",title:"Cuenta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"email",title:"Email",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"FechaUltimoCambioEstado",title:"Fecha Ultimo Cambio Estado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({field:"HoraUltimoCambioEstado",title:"Hora Ultimo Cambio Estado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length)});c.push({width:315,field:"",title:" ",headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),columnTemplate:function(l,m,n){if(b.pageOptions.visualizarDatosApertura){var e=$('<button type="button" title="Acceder" class="btn-sm balanz-button"><span class="glyphicon glyphicon-resize-full"></span></button>').appendTo(l);e.on("click",function(){b.containerReporteAperturasCuentas.hide();b.containerAltaCuenta.show();var o=new Core.Controls.ManagerAltaCuenta({idAperturaCuenta:m.idAperturaCuenta,versionActual:m.VersionActual,maxVersion:m.VersionActual,optionsApertura:b.pageOptions,readOnly:true,namespaceActivo:"ReporteAperturas",onClose:function(){$("html, body").animate({scrollTop:$(".cuenta").offset().top},1000);b.containerReporteAperturasCuentas.show();b.containerAltaCuenta.hide()},container:b.containerAltaCuenta,idDefaultAccount:b.idDefaultAccount,idDefaultProfile:b.idDefaultProfile}).show()})}var h=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(l);h.on("click",function(){new Core.Controls.DetalleAperturaCuenta({idAperturaCuenta:m.idAperturaCuenta,overlayElement:h}).show()});if(m.cancelable){var g=$('<button type="button" title="Cancelar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(l);g.on("click",function(){var o=new Core.Business.ReporteAperturasCuentas.InsertarMotivo({onSave:function(){b.loadGrid()},title:"Cancelar Cuenta: ",description:"Motivo o Referencia de la Cancelación",urlRequest:"apertura/cuenta/anular",idAperturaCuenta:m.idAperturaCuenta,overlayElement:g}).show()})}if(m.recuperable){var j=$('<button type="button" title="Recuperar" class="btn-sm balanz-button"><span class="fa fa-undo"></span></button>').appendTo(l);j.on("click",function(){var o=new Core.Business.ReporteAperturasCuentas.InsertarMotivo({onSave:function(){b.loadGrid()},title:"Recuperar Cuenta: ",description:"Motivo o Referencia del Recupero",urlRequest:"apertura/cuenta/recuperar",idAperturaCuenta:m.idAperturaCuenta,overlayElement:j}).show()})}if(b.pageOptions.reasignarAperturas&&m.reasignable){var i=$('<button type="button" title="Reasignar Cuenta" class="btn-sm balanz-button"><span class="glyphicon glyphicon-share"></span></button>').appendTo(l);i.on("click",function(){var o=new Core.Ajax.ServerRequest({allowCache:true,secureRequest:true,requestUrl:"apertura/cuenta/parametrosusuario",requestType:"GET"});o.onSuccess=function(q){var p=new Core.Business.AperturasCuentas.ReasignarCuenta({onSave:function(){b.loadGrid()},unidadesDeNegocio:q.unidadesDeNegocio,idAperturaCuenta:m.idAperturaCuenta,overlayElement:i}).show()};o.request()})}if(m.refirmar){var k=$('<button type="button" title="Reenviar Firma" class="btn-sm balanz-button"><span class="glyphicon glyphicon-envelope"></span></button>').appendTo(l);k.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea Reenviar el mail de firma? Esta acción reenviará los mails con los links para la firma digital a todos aquellos destinatarios que aún no hayan firmado.",{onAccepted:function(){var o=new Core.Ajax.ServerRequest({overlayElement:k,secureRequest:true,requestUrl:"apertura/cuenta/refirmar",requestType:"POST",requestData:{idAperturaCuenta:m.idAperturaCuenta}});o.onSuccess=function(){b.loadGrid()};o.request()}}).show()});var f=$('<button type="button" title="Actualizar Firma" class="btn-sm balanz-button"><span class="glyphicon glyphicon-refresh"></span></button>').appendTo(l);f.on("click",function(){var o=new Core.Ajax.ServerRequest({overlayElement:f,secureRequest:true,requestUrl:"apertura/cuenta/actualizarfirma",requestType:"POST",requestData:{idAperturaCuenta:m.idAperturaCuenta}});o.onSuccess=function(){b.loadGrid()};o.request()})}}});b.divReporteAperturasCuentas.shieldGrid({dataSource:{data:Core.Objects.ReporteAperturasCuentas?Core.Objects.ReporteAperturasCuentas:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],sorting:{multiple:true},selection:false,paging:{pageSize:50,pageLinksCount:10},rowHover:false,exportOptions:{excel:{fileName:"Aperturas Cuentas",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["idAperturaCuenta","VersionActual","FechaCreacion","Estado","Asesor","Cuenta","email","FechaUltimoCambioEstado","HoraUltimoCambioEstado","FechaConfirmacion","FechaPasoCompliance","FechaAperturaCuenta","Equipo"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Aperturas Cuentas"}}},columns:c})};b.initControls=function(){b.txtSearch.on("keyup",function(c){if(c.keyCode==a){b.loadGrid()}});Core.Functions.Persistence.setTextBox(b.txtSearch,"Core.Business.ReporteAperturasCuentas.txtSearch");b.btnSearch.on("click",function(){b.loadGrid()})};b.loadGrid=function(){Core.Objects.ReporteAperturasCuentas=null;b.divContainerTablaAperturasCuentas.hide();if(b.txtSearch.val()&&b.txtSearch.val().length>=3){var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"reporte/aperturascuentas?search="+b.txtSearch.val(),requestType:"GET"});c.onSuccess=function(d){Core.Objects.ReporteAperturasCuentas=d.casos;var e=b.divReporteAperturasCuentas.swidget().initialOptions;e.dataSource.data=d;e.dataSource.schema={data:"casos"};e.exportOptions.excel.dataSource.data=d;e.exportOptions.excel.dataSource.schema={data:"casos"};e.exportOptions.excel.readDataSource=true;b.divReporteAperturasCuentas.swidget().refresh(e);b.txtFilter.keydown();b.divContainerTablaAperturasCuentas.show()};c.request()}else{new Core.Controls.Dialog("Aviso","<p>Debe ingresar un patrón de búsqueda de al menos 3 caracteres.</p>",{displayButtons:{close:true,accept:false}}).show()}}};Core.Business.ReporteAperturasCuentas.InsertarMotivo=function(b){var a=this;a.divModal=$(".div-modal-insertar-motivo");a.lblTitle=null;a.lblDescription=null;a.txtMotivo=null;a.btnConfirmar=null;a.title=null;a.description=null;a.onSave=null;a.idAperturaCuenta=null;a.overlayElement=null;a.urlRequest=null;$.extend(true,a,b);a.show=function(){a.lblTitle=a.divModal.find(".title");a.lblTitle.text(a.title+a.idAperturaCuenta);a.lblDescription=a.divModal.find(".label-description");a.lblDescription.text(a.description);a.txtMotivo=a.divModal.find(".textbox-motivo");Core.Functions.Validations.toggleValidation(a.txtMotivo,false);a.txtMotivo.shieldTextBox({value:""});a.btnConfirmar=a.divModal.find(".btn-confirmar");a.btnConfirmar.unbind("click");a.btnConfirmar.click(function(){if(a.txtMotivo.swidget().value()){new Core.Ajax.ServerRequest({showOverlay:false,secureRequest:true,requestUrl:"apertura/cuenta/observacion/"+a.idAperturaCuenta,requestType:"POST",requestData:{observacion:a.txtMotivo.swidget().value()}}).request()}var c=new Core.Ajax.ServerRequest({secureRequest:true,showOverlay:true,overlayElement:a.overlayElement,requestUrl:a.urlRequest,requestType:"POST",requestData:{idAperturaCuenta:a.idAperturaCuenta}});c.onSuccess=function(d){if(a.onSave){a.onSave()}};c.request();a.divModal.modal("hide")});a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.divModal.modal({show:true})};a.destroy=function(){a.txtMotivo.swidget().destroy()}};Core.Business.ReporteCauciones=new function(){var a=this;a.id="reporteCauciones";a.divCauciones=null;a.init=function(b,c){Core.loadPage("reporte-cauciones.html",function(){document.title="Cauciones Pendientes de Liquidación";a.divCauciones=$(".div-cauciones");a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,b,c,a.loadGrid,"Core.Business.ReporteCauciones")})};a.initGrid=function(){var b=[];b.push({field:"FechaConcertacion",title:"Fecha Concertación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatStringDate});b.push({field:"FechaLiquidacion",title:"Fecha Liquidación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatStringDate});b.push({field:"Plazo",title:"Plazo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatIntegerNumber});b.push({field:"Tasa",title:"Tasa (%)",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumber});b.push({field:"Moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Importe",title:"Importe",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumber});b.push({width:50,field:"",title:" ",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,e,f){if(e.garantias){var c=$('<button type="button" title="Garantías" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(d);c.on("click",function(){var h="";h+="<table class='table table-striped'>";h+="<thead><tr><th>Garantía</th><th>Instrumento</th><th>Tipo</th><th>Cantidad</th></tr></thead>";h+="<tbody>";for(var j=0;j<e.garantias.length;j++){h+="<tr>";h+="<td>"+Core.Functions.grid.formatUndefinedString(e.garantias[j].Garantia)+"</td>";h+="<td>"+Core.Functions.grid.formatUndefinedString(e.garantias[j].Instrumento)+"</td>";h+="<td>"+Core.Functions.grid.formatUndefinedString(e.garantias[j].Tipo)+"</td>";h+="<td class='right'>"+Core.Functions.grid.formatIntegerNumber(e.garantias[j].Cantidad)+"</td>";h+="</tr>"}h+="</tbody>";h+="</table>";var g=new Core.Controls.Dialog("Garantías",h,{displayButtons:{close:true,accept:false}});g.show()})}}});a.divCauciones.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},grouping:{showGroupHeader:true,allowDragToGroup:true,message:"Arrastre un encabezado de columna para agrupar por esa columna"},columns:b})};a.loadGrid=function(){var b=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"cauciones/"+encodeURIComponent(a.header.selectedIdAccount),requestType:"GET"});b.onSuccess=function(c){var d=a.divCauciones.swidget().initialOptions;d.dataSource.data=c.caucionesdetalle?c.caucionesdetalle:[];d.dataSource.group=[{field:"Tipo",order:"asc"}];a.divCauciones.swidget().refresh(d)};b.request()}};Core.Business.ReporteComparativoACDI=new function(){var a=this;a.id="reporteComparativoACDI";a.lblTitle=null;a.divFondosAcdi=null;a.txtDate=null;a.window=$(window);a.init=function(b,c){Core.loadPage("reporte-comparativo-acdi.html",function(){document.title="Reporte Comparativo ACDI";a.lblTitle=$(".label-title");a.txtDate=$(".date-picker");a.divFondosAcdi=$(".div-fondos-acdi");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadGrid()},"Core.Business.ReporteComparativoACDI")})};a.initControls=function(){a.txtDate.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loadGrid()}}});var b=[];b.push({field:"NombreAbreviado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),title:"Fondo",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Abreviatura",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),title:"Abreviatura",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),title:"Moneda",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({field:"RescatesBolsa",attributes:Core.Functions.grid.getRightAlignedColumnClass(),title:"Rescates Bolsa",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumber});b.push({title:" ",width:50,headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,e,f){if(e.RescatesBolsa){var c=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(d);c.on("click",function(){new Core.Business.ReporteComparativoACDI.Detalle({overlayElement:c,idNegocio:1,fecha:Core.Functions.Date.getDateAsString(a.txtDate.swidget().value()),ticker:e.NombreAbreviado,codTpOperacionDet:"RE"}).show()})}}});b.push({field:"RescatesFondos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),title:"Rescates Fondos",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumber});b.push({title:" ",width:50,headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,e,f){if(e.RescatesFondos){var c=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(d);c.on("click",function(){new Core.Business.ReporteComparativoACDI.Detalle({overlayElement:c,idNegocio:2,fecha:Core.Functions.Date.getDateAsString(a.txtDate.swidget().value()),ticker:e.NombreAbreviado,codTpOperacionDet:"RE"}).show()})}}});b.push({field:"SuscripcionesBolsa",attributes:Core.Functions.grid.getRightAlignedColumnClass(),title:"Suscripciones Bolsa",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumber});b.push({title:" ",width:50,headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,e,f){if(e.SuscripcionesBolsa){var c=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(d);c.on("click",function(){new Core.Business.ReporteComparativoACDI.Detalle({overlayElement:c,idNegocio:1,fecha:Core.Functions.Date.getDateAsString(a.txtDate.swidget().value()),ticker:e.NombreAbreviado,codTpOperacionDet:"SU"}).show()})}}});b.push({field:"SuscripcionesFondos",attributes:Core.Functions.grid.getRightAlignedColumnClass(),title:"Suscripciones Fondos",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumber});b.push({title:" ",width:50,headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,e,f){d.parent().css("background-color","rgba("+a.hexToRgb(e.color)+((f%2==0)?", 0.6":", 1 ")+")");if(e.SuscripcionesFondos){var c=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(d);c.on("click",function(){new Core.Business.ReporteComparativoACDI.Detalle({overlayElement:c,idNegocio:2,fecha:Core.Functions.Date.getDateAsString(a.txtDate.swidget().value()),ticker:e.NombreAbreviado,codTpOperacionDet:"SU"}).show()})}}});a.divFondosAcdi.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:b})};a.loadGrid=function(){a.lblTitle.text("Al "+Core.Functions.Date.getDisplayDate(a.txtDate.swidget().value()));var b="fecha="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDate.swidget().value()));var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"acdi/comparativo/maestrodetalle",requestType:"GET",requestData:b});c.onSuccess=function(d){var f=a.window.scrollTop();var e=a.divFondosAcdi.swidget().initialOptions;e.dataSource.data=d.data;a.divFondosAcdi.swidget().refresh(e);a.window.scrollTop(f)};c.request()};a.hexToRgb=function(d){d=d.replace("#","");var f=parseInt(d.substring(0,2),16);var e=parseInt(d.substring(2,4),16);var c=parseInt(d.substring(4,6),16);var h=f+","+e+","+c;return h}};Core.Business.ReporteComparativoACDI.Detalle=function(b){var a=this;a.divModalDetalle=$(".div-operacion-detalle");a.idNegocio=null;a.ticker=null;a.codTpOperacionDet=null;a.fecha=null;a.overlayElement=null;a.title=null;a.divDetalle=null;$.extend(true,a,b);a.show=function(){var c={};c.fecha=a.fecha;c.idnegocio=a.idNegocio;c.ticker=a.ticker;c.codtpoperaciondet=a.codTpOperacionDet;var d=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,requestUrl:"acdi/fondo/detalle",requestType:"GET",requestData:c});d.onSuccess=function(g){a.divDetalle=a.divModalDetalle.find(".div-detalle");a.title=a.divModalDetalle.find(".lbl-title");a.title.text("Detalle");var e=[];e.push({width:"7%",field:"NumLiquidacion",attributes:Core.Functions.grid.getRightAlignedColumnClass(),title:"Número Liquidación",headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length)});e.push({width:"7%",field:"NombreAbreviado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),title:"Fondo",headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatUndefinedString});e.push({width:"7%",field:"Abreviatura",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),title:"Abreviatura",headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatUndefinedString});e.push({width:"7%",field:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),title:"Moneda",headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatUndefinedString});e.push({width:"15%",field:"Importe",attributes:Core.Functions.grid.getRightAlignedColumnClass(),title:"Importe",headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatNumber});if(a.idNegocio==1){e.push({width:"7%",field:"NumComitente",attributes:Core.Functions.grid.getRightAlignedColumnClass(),title:"Comitente",headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length)})}else{e.push({width:"7%",field:"NumCuotapartista",attributes:Core.Functions.grid.getRightAlignedColumnClass(),title:"Cuotapartista",headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length)})}e.push({width:"30%",field:"Nombre",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),title:"Descripción",headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatUndefinedString});e.push({width:"10%",field:"FechaConcertacion",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),title:"Fecha Concertación",headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatUndefinedString});e.push({width:"10%",field:"FechaLiquidacion",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),title:"Fecha Liquidación",headerAttributes:Core.Functions.grid.getHeaderAttribute(e.length),format:Core.Functions.grid.formatUndefinedString});var f={dataSource:{data:g.detalle},selection:false,rowHover:false,sorting:{multiple:true},columns:e,noRecordsText:"No se encontraron detalles."};a.divDetalle.shieldGrid(f);a.divModalDetalle.unbind("hidden.bs.modal");a.divModalDetalle.on("hidden.bs.modal",function(){a.divDetalle.swidget().destroy()});a.divModalDetalle.modal({show:true})};d.request()}};Core.Business.ReporteCuentasPorTicker=new function(){var a=this;a.id="reporteCuentasPorTicker";a.divCuentasTicker=null;a.ddlTickers=null;a.init=function(b,c){Core.loadPage("reporte-cuentas-ticker.html",function(){document.title="Cuentas por Ticker";a.divCuentasTicker=$(".div-cuentas-ticker");a.ddlTickers=$(".dropdown-tickers");a.initDropDownTickers();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadTickers,"Core.Business.ReporteCuentasPorTicker")})};a.initDropDownTickers=function(){a.ddlTickers.shieldComboBox({dataSource:{data:[]},valueTemplate:"{Ticker}",textTemplate:"{DisplayTicker} | {Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}},events:{change:function(b){a.loadGrid()},focus:function(b){var c=a.ddlTickers.swidget().initialOptions;c.value="";a.ddlTickers.swidget().refresh(c);a.ddlTickers.swidget().focus()}}})};a.initGrid=function(){a.divCuentasTicker.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,paging:{pageSize:30,pageLinksCount:10},columns:[{field:"idCuenta",title:"Cuenta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"5%",headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"DescripcionCuenta",title:"Descripcion",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"30%",headerAttributes:Core.Functions.grid.getCellOddClass()},{field:"NumComitente",title:"Comitente",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"5%",headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"NumCuotapartista",title:"Cuotapartista",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"5%",headerAttributes:Core.Functions.grid.getCellOddClass()},{field:"Ticker",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"5%",headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"Cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatPrice},{field:"Asesor",title:"Asesor",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{field:"Equipo",title:"Equipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{field:"UnidadDeNegocio",title:"Unidad",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"8%",title:" ",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(d,e,f){var c=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(d);c.on("click",function(){var g=Core.Functions.Context.Profiles.getPageOptionsByMenu("homeCuentas",Core.Objects.Context.Profiles[0]);Core.Functions.grid.AccountDetails.showDetailsByIdAccount(e,true,(g&&g.actualizarNivelPersonas)?g.actualizarNivelPersonas:false)});if($.grep(Core.Objects.Context.Profiles,function(h,g){return h.id=="transaccional"}).length==1){var b=$('<button type="button" title="Acceder" class="btn-sm balanz-button"><span class="glyphicon glyphicon-resize-full"></span></button>').appendTo(d);b.on("click",function(){Core.Business.PosicionConsolidada.init(e.idCuenta,1)})}}}],noRecordsText:"No hay cuentas para informar",toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Cuentas por Ticker",columnFields:["idCuenta","DescripcionCuenta","NumComitente","NumCuotapartista","Ticker","Cantidad","Asesor","Equipo","UnidadDeNegocio"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Cuentas por Ticker"}}}})};a.loadGrid=function(){var d={value:true};var b={};b.ticker=Core.Functions.Validations.getValidatedSwidgetValue(a.ddlTickers,d);if(!d.value){return}var c=new Core.Ajax.ServerRequest({overlayElement:a.divCuentasTicker.parent(),secureRequest:true,requestUrl:"reportes/cuentasporticker",requestType:"GET",requestData:b});c.onSuccess=function(e){var f=a.divCuentasTicker.swidget().initialOptions;f.dataSource.data=e;f.dataSource.schema={data:"cuentas"};f.exportOptions.excel.dataSource.data=e;f.exportOptions.excel.dataSource.schema={data:"cuentas"};f.exportOptions.excel.readDataSource=true;a.divCuentasTicker.swidget().refresh(f);if(e.cuentas.length==0){var g=new Core.Controls.Dialog("Mensaje","No fueron encotradas cuentas con el Ticker "+b.ticker,{displayButtons:{close:true,accept:false}});g.show()}else{if(!Core.Objects.Accounts){Core.Objects.Accounts=[]}e.cuentas.forEach(function(i,h){if(!$.grep(Core.Objects.Accounts,function(j,k){return j.idCuenta==i.idCuenta})[0]){Core.Objects.Accounts.push({Descripcion:i.DescripcionCuenta,NombreAsesor:i.Asesor,NumComitente:i.NumComitente,NumCuotapartista:i.NumCuotapartista,idCuenta:i.idCuenta})}})}};c.request()};a.loadTickers=function(){var b={};b.panel=17;var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"especies",requestType:"GET",requestData:b});c.onSuccess=function(e){var d=a.ddlTickers.swidget().initialOptions;d.dataSource.data=e.especies;d.textTemplate="{DisplayTicker} | {Descripcion}";a.ddlTickers.swidget().refresh(d)};c.request()}};Core.Business.ReporteDocuSignFirmas=new function(){var a=this;a.id="homeReporteDocuSignFirmas";a.txtFilter=null;a.divDocuSignFirmas=null;a.lblTitle=null;a.txtDateFrom=null;a.txtDateTo=null;a.pageOptions=null;a.timeout=null;a.init=function(b,c){Core.loadPage("reporte-docusign-firmas.html",function(){document.title="Reporte DocuSign Firmas";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.txtFilter=$(".textbox-filter");a.divDocuSignFirmas=$(".div-docusign-firmas");a.lblTitle=$(".label-title");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadGrid()},"Core.Business.ReporteDocuSignFirmas")})};a.initControls=function(){a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var b=a.divDocuSignFirmas.swidget().dataSource;if(value){b.filter={or:[{path:"idEnvelope",filter:"contains",value:value},{path:"ValorOrigen",filter:"contains",value:value},{path:"Estado",filter:"contains",value:value}]}}else{b.filter=null}b.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.ReporteDocuSignFirmas.txtFilter");a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(b){a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(b){a.loadGrid()}}});a.divDocuSignFirmas.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],selection:false,rowHover:false,paging:{pageSize:30,pageLinksCount:10},columns:[{width:"10%",field:"idEnvelope",title:"ID Envelope",headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatIntegerNumber},{width:"20%",field:"EnvelopeId",title:"Envelope Id",headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"10%",field:"Proveedor",title:"Proveedor",headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"10%",field:"FechaCreación",title:"Fecha Creación",headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"10%",field:"Estado",title:"Estado",headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"10%",field:"Origen",title:"Origen",headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"10%",field:"ValorOrigen",title:"Valor Origen",headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"10%",field:"CantidadArchivos",title:"Cantidad Archivos",headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatIntegerNumber},{width:"10%",field:"CantidadFirmantes",title:"Cantidad Firmantes",headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatIntegerNumber},{field:"",title:" ",width:45,headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(c,d,e){var b=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(c);b.on("click",function(){Core.Functions.ExternalServices.DocuSign.showReportByKey(b,{clave:d.idEnvelope})})}}],exportOptions:{excel:{fileName:"Reporte DocuSign Firmas",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["idEnvelope","EnvelopeId","Proveedor","FechaCreación","Estado","Origen","ValorOrigen","CantidadArchivos","CantidadFirmantes"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Reporte DocuSign Firmas"}}}})};a.loadGrid=function(){a.lblTitle.text("Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var b;b="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));b+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"reporte/docusign/firmasporfecha",requestType:"GET",requestData:b});c.onSuccess=function(f){var d=f&&f.envelopes?f.envelopes:[];var e=a.divDocuSignFirmas.swidget().initialOptions;e.dataSource.data=d;e.exportOptions.excel.dataSource.data=d;e.exportOptions.excel.readDataSource=true;a.divDocuSignFirmas.swidget().refresh(e);a.txtFilter.keydown()};c.request()}};Core.Business.ReporteErroresAsignacionCuentas=new function(){var a=this;a.id="reporteErroresAsignacionCuentas";a.divReporteErroresAsignacionCuentas=null;a.btnRefresh=null;a.init=function(b,c){Core.loadPage("reporte-errores-asignacion-cuentas.html",function(){document.title="Errores Asignación Cuentas";a.divReporteErroresAsignacionCuentas=$(".div-reporte-errores-asignacion-cuentas");a.btnRefresh=$(".btn-refresh");a.initControls();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.ReporteErroresAsignacionCuentas")})};a.initGrid=function(){var b=[];b.push({field:"idCuenta",title:"ID Cuenta",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Descripcion",title:"Descripcion",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"15%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Comitente",title:"Comitente",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"DescripcionBolsa",title:"Descripción Bolsa",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"15%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"AsesorESCOBolsa",title:"Asesor ESCO Bolsa",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"AsesorBolsa",title:"Asesor Bolsa",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"AsesorPlataforma",title:"Asesor Plataforma",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"AsesorFondos",title:"Asesor Fondos",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"AsesorESCOFondos",title:"Asesor ESCO Fondos",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Cuotapartista",title:"Cuotapartista",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"DescripcionFondos",title:"Descripción Fondos",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"15%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});a.divReporteErroresAsignacionCuentas.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],sorting:{multiple:true},selection:false,rowHover:false,exportOptions:{excel:{fileName:"Errores Asignación Cuentas",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["idCuenta","Descripcion","Comitente","DescripcionBolsa","AsesorESCOBolsa","AsesorBolsa","AsesorPlataforma","AsesorFondos","AsesorESCOFondos","Cuotapartista","DescripcionFondos"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Errores Asignación Cuentas"}}},columns:b})};a.initControls=function(){a.btnRefresh.on("click",function(){a.loadGrid()})};a.loadGrid=function(){var b=new Core.Ajax.ServerRequest({overlayElement:a.divReporteErroresAsignacionCuentas.parent(),secureRequest:true,requestUrl:"reporte/erroresasignacioncuentas",requestType:"GET"});b.onSuccess=function(c){var d=a.divReporteErroresAsignacionCuentas.swidget().initialOptions;d.dataSource.data=c;d.dataSource.schema={data:"Personas"};d.exportOptions.excel.dataSource.data=c;d.exportOptions.excel.dataSource.schema={data:"Personas"};d.exportOptions.excel.readDataSource=true;a.divReporteErroresAsignacionCuentas.swidget().refresh(d)};b.request()}};Core.Business.ReporteErroresCajaDeValores=new function(){var a=this;a.id="reporteErroresCajaDeValores";a.divReporteErroresCajaDeValores=null;a.btnRefresh=null;a.txtFilter=null;a.timeout=null;a.init=function(b,c){Core.loadPage("reporte-errores-caja-de-valores.html",function(){document.title="Errores Caja de Valores";a.txtFilter=$(".textbox-filter");a.divReporteErroresCajaDeValores=$(".div-reporte-errores-caja-de-valores");a.btnRefresh=$(".btn-refresh");a.initControls();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.ReporteErroresCajaDeValores")})};a.initGrid=function(){var b=[];b.push({width:"8%",field:"NumComitente",title:"Núm Comitente",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({width:"20%",field:"Descripcion",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"6%",field:"Respuesta",title:"Respuesta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"20%",field:"Estado",title:"Estado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"8%",field:"FechaIngreso",title:"Fecha Ingreso",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"10%",field:"UltimaActualizacion",title:"Ultima Actualización",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"20%",field:"TipoBloqueo",title:"Tipo Bloqueo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({width:"8%",field:"FechaBloqueo",title:"Fecha Bloqueo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});b.push({title:"Obs.",width:50,headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,d,e){if(d.Observaciones){var f=(d.length>140)?(d.Observaciones.substr(0,140)+"..."):(d.Observaciones);c.html('<button type="button" title="'+f+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-warning-sign"></span></button>');c.addClass("link-cell");c.on("click",function(){var g=new Core.Controls.Dialog("Observaciones",(d.Observaciones)?d.Observaciones:"",{displayButtons:{close:true,accept:false}});g.show()})}}});a.divReporteErroresCajaDeValores.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],sorting:{multiple:true},selection:false,rowHover:false,exportOptions:{excel:{fileName:"Errores Caja de Valores",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["NumComitente","Descripcion","Respuesta","Estado","FechaIngreso","UltimaActualizacion","TipoBloqueo","FechaBloqueo","Observaciones"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Errores Caja de Valores"}}},paging:{pageSize:30,pageLinksCount:10},columns:b})};a.initControls=function(){a.btnRefresh.on("click",function(){a.loadGrid()});a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var b=a.divReporteErroresCajaDeValores.swidget().dataSource;if(value){b.filter={or:[{path:"NumComitente",filter:"contains",value:value},{path:"Descripcion",filter:"contains",value:value},{path:"Respuesta",filter:"contains",value:value},{path:"Estado",filter:"contains",value:value},{path:"TipoBloqueo",filter:"contains",value:value},{path:"Observaciones",filter:"contains",value:value}]}}else{b.filter=null}b.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.ReporteErroresCajaDeValores.txtFilter")};a.loadGrid=function(){var b=new Core.Ajax.ServerRequest({overlayElement:a.divReporteErroresCajaDeValores.parent(),secureRequest:true,requestUrl:"reporte/errorescajadevalores",requestType:"GET"});b.onSuccess=function(c){var d=a.divReporteErroresCajaDeValores.swidget().initialOptions;d.dataSource.data=c;d.dataSource.schema={data:"datos"};d.exportOptions.excel.dataSource.data=c;d.exportOptions.excel.dataSource.schema={data:"datos"};d.exportOptions.excel.readDataSource=true;a.divReporteErroresCajaDeValores.swidget().refresh(d);a.txtFilter.keydown()};b.request()}};Core.Business.ReporteErroresPersonasESCO=new function(){var a=this;a.id="reporteErroresPersonasESCO";a.divReporteErroresPersonasESCO=null;a.btnRefresh=null;a.lblChkIncluirSinCondominio=null;a.chkIncluirSinCondominio=null;a.txtFilter=null;a.timeout=null;a.init=function(b,c){Core.loadPage("reporte-errores-personas-esco.html",function(){document.title="Errores Personas ESCO";a.divReporteErroresPersonasESCO=$(".div-reporte-errores-personas-esco");a.btnRefresh=$(".btn-refresh");a.chkIncluirSinCondominio=$(".checkbox-incluir-sin-condominio");a.lblChkIncluirSinCondominio=$(".lbl-checkbox-incluir-sin-condominio");a.txtFilter=$(".textbox-filter");a.initControls();a.initGrid();a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var d=a.divReporteErroresPersonasESCO.swidget().dataSource;if(value){d.filter={or:[{path:"Base",filter:"contains",value:value},{path:"Numero",filter:"contains",value:value},{path:"Apellido",filter:"contains",value:value},{path:"Nombre",filter:"contains",value:value},{path:"Tipo",filter:"contains",value:value},{path:"Documento",filter:"contains",value:value},{path:"CUIT_CUIL",filter:"contains",value:value},{path:"Cuenta",filter:"contains",value:value},{path:"Errores",filter:"contains",value:value}]}}else{d.filter=null}d.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.ReporteErroresPersonasESCO.txtFilter");a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.ReporteErroresPersonasESCO")})};a.initGrid=function(){var b=[];b.push({field:"Base",title:"Base",width:"6%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Numero",title:"Número",width:"6%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Apellido",title:"Apellido",width:"10%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Nombre",title:"Nombre",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Tipo",title:"Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Documento",title:"Documento",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"CUIT_CUIL",title:"CUIT/CUIL",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"EsFisica",title:"Es Física",width:"5%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Cuenta",title:"Cuenta",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Errores",title:"Errores",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"36%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});a.divReporteErroresPersonasESCO.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],sorting:{multiple:true},selection:false,rowHover:false,exportOptions:{excel:{fileName:"Errores Personas ESCO",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["Base","Numero","Apellido","Nombre","Tipo","Documento","CUIT_CUIL","EsFisica","Cuenta","Errores"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Errores Personas ESCO"}}},columns:b})};a.initControls=function(){a.btnRefresh.on("click",function(){a.loadGrid()});a.chkIncluirSinCondominio[0].checked=false;a.chkIncluirSinCondominio.on("change",function(){a.loadGrid()})};a.loadGrid=function(){var b;b="incluirSinCondominio="+((a.chkIncluirSinCondominio[0].checked)?1:0);var c=new Core.Ajax.ServerRequest({overlayElement:a.divReporteErroresPersonasESCO.parent(),secureRequest:true,requestUrl:"importadoresco/reporteerrores/1",requestType:"GET",requestData:b});c.onSuccess=function(d){var e=a.divReporteErroresPersonasESCO.swidget().initialOptions;e.dataSource.data=d;e.dataSource.schema={data:"Personas"};e.exportOptions.excel.dataSource.data=d;e.exportOptions.excel.dataSource.schema={data:"Personas"};e.exportOptions.excel.readDataSource=true;a.divReporteErroresPersonasESCO.swidget().refresh(e);a.txtFilter.keydown()};c.request()}};Core.Business.ReporteFlujosAsesores=new function(){var a=this;a.id="reporteFlujosAsesores";a.divContainer=null;a.divReporteFlujosAsesores=null;a.lblTitle=null;a.btnConsultar=null;a.txtDateFrom=null;a.txtDateTo=null;a.init=function(b,c){Core.loadPage("reporte-flujos-asesores.html",function(){document.title="Informe Asesores";a.divContainer=$(".div-container-reporte-flujos-asesores");a.divContainer.hide();a.divReporteFlujosAsesores=$(".div-reporte-flujos-asesores");a.btnConsultar=$(".btn-consultar");a.lblTitle=$(".label-title");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.initControls();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){},"Core.Business.ReporteFlujosAsesores")})};a.initControls=function(){var b=new Date();b.setDate(1);b.setMonth(b.getMonth()-1);var c=new Date();c.setDate(1);c.setDate(b.getDate()-1);a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:b,max:new Date()});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:c,max:new Date()});a.btnConsultar.on("click",function(){if(a.txtDateFrom.swidget().value()&&a.txtDateTo.swidget().value()){a.loadGrid()}else{a.divContainer.hide()}})};a.initGrid=function(){a.divReporteFlujosAsesores.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"ReporteFlujosAsesores",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:[],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"ReporteFlujosAsesores"}}},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},columns:[]})};a.loadGrid=function(){function b(d){if(!d){return""}return d.getFullYear().toString()+"-"+Core.Functions.Date.getTwoCharsNumber(d.getMonth()+1)+"-"+Core.Functions.Date.getTwoCharsNumber(d.getDate())}a.lblTitle.text("Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"reportePorAsesor/obtener/"+encodeURIComponent(b(a.txtDateFrom.swidget().value()))+"/"+encodeURIComponent(b(a.txtDateTo.swidget().value())),requestType:"GET"});c.onSuccess=function(f){var d=[];var e=[];var h=f.reporteXML.shift();$.each(h,function(i,j){e.push(i);d.push({field:i,title:j,attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedString})});var g=a.divReporteFlujosAsesores.swidget().initialOptions;g.columns=d;g.dataSource.data=f.reporteXML;g.exportOptions.excel.dataSource.data=f.reporteXML;g.exportOptions.excel.columnFields=e;g.exportOptions.excel.readDataSource=true;a.divReporteFlujosAsesores.swidget().refresh(g);a.divContainer.show()};c.request()}};Core.Business.ReporteFondeo=new function(){var a=this;a.id="reporte-fondeo";a.divCuentas=null;a.txtFilter=null;a.timeout=null;a.init=function(b,c){Core.loadPage("reporte-fondeo.html",function(){document.title="Reporte Fondeo";a.divCuentas=$(".div-cuentas");a.txtFilter=$(".textbox-filter");a.initGrid();a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var d=a.divCuentas.swidget().dataSource;if(value){d.filter={or:[{path:"Comitente",filter:"contains",value:value},{path:"Cuotapartista",filter:"contains",value:value},{path:"Descripcion",filter:"contains",value:value},{path:"Asesor",filter:"contains",value:value},{path:"Equipo",filter:"contains",value:value}]}}else{d.filter=null}d.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.ReporteFondeo.txtFilter");a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.ReporteFondeo")})};a.initGrid=function(){a.divCuentas.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Reporte Fondeo",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["Comitente","Cuotapartista","Descripcion","Asesor","Equipo","FechaAlta","FechaFondeo","ImporteFondeo","TenenciaActual","UnidadDeNegocio","Juridica"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Reporte Fondeo"}}},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},columns:[{width:"9%",field:"Comitente",title:"Comitente",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"9%",field:"Cuotapartista",title:"Cuotapartista",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"28%",field:"Descripcion",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"9%",field:"Asesor",title:"Asesor",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"9%",field:"Equipo",title:"Equipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"9%",field:"FechaAlta",title:"Fecha Alta",headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"9%",field:"FechaFondeo",title:"Fecha Fondeo",headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"9%",field:"ImporteFondeo",title:"Importe Fondeo",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNumber},{width:"9%",field:"TenenciaActual",title:"Tenencia Actual",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNumber}]})};a.loadGrid=function(){var b=new Core.Ajax.ServerRequest({overlayElement:a.divCuentas.parent(),secureRequest:true,requestUrl:"reportefondeocuentas",requestType:"GET"});b.onSuccess=function(c){var d=a.divCuentas.swidget().initialOptions;d.dataSource.data=c;d.dataSource.schema={data:"cuentas"};d.exportOptions.excel.dataSource.data=c;d.exportOptions.excel.dataSource.schema={data:"cuentas"};d.exportOptions.excel.readDataSource=true;a.divCuentas.swidget().refresh(d);a.txtFilter.keydown()};b.request()}};Core.Business.ReporteListadoAsesores=new function(){var a=this;a.id="reporteListadoAsesores";a.divReporteListadoAsesores=null;a.btnRefresh=null;a.txtFilter=null;a.timeout=null;a.init=function(b,c){Core.loadPage("reporte-listado-asesores.html",function(){document.title="Listado Asesores";a.divReporteListadoAsesores=$(".div-reporte-listado-asesores");a.btnRefresh=$(".btn-refresh");a.initControls();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.ReporteListadoAsesores")})};a.initGrid=function(){var b=[];b.push({field:"idPersona",title:"ID Persona",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Nombre",title:"Nombre",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"15%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"email",title:"Email",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"15%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Equipo",title:"Equipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"15%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Lider",title:"Lider",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"15%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"UnidadDeNegocio",title:"Unidad de Negocio",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"15%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Head",title:"Head",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"15%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({width:80,title:"Link Física",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,e,f){if(e.LinkAperturaFisica){var c=$('<button type="button" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>').appendTo(d);c.on("click",function(){new Core.Business.ReporteListadoAsesores.Link({title:("Link Apertura Física - "+e.Nombre),link:e.LinkAperturaFisica}).show()})}}});b.push({width:80,title:"Link Jurídica",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,e,f){if(e.LinkAperturaJuridica){var c=$('<button type="button" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>').appendTo(d);c.on("click",function(){new Core.Business.ReporteListadoAsesores.Link({title:("Link Apertura Jurídica - "+e.Nombre),link:e.LinkAperturaJuridica}).show()})}}});a.divReporteListadoAsesores.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],sorting:{multiple:true},selection:false,rowHover:false,exportOptions:{excel:{fileName:"Listado Asesores",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["idPersona","Nombre","email","Equipo","Lider","UnidadDeNegocio","Head"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Listado Asesores"}}},paging:{pageSize:30,pageLinksCount:10},columns:b})};a.initControls=function(){a.btnRefresh.on("click",function(){a.loadGrid()});a.txtFilter=$(".textbox-filter");a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var b=a.divReporteListadoAsesores.swidget().dataSource;if(value){b.filter={or:[{path:"idPersona",filter:"contains",value:value},{path:"Nombre",filter:"contains",value:value},{path:"email",filter:"contains",value:value},{path:"Equipo",filter:"contains",value:value},{path:"Lider",filter:"contains",value:value},{path:"UnidadDeNegocio",filter:"contains",value:value},{path:"Head",filter:"contains",value:value}]}}else{b.filter=null}b.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.ReporteListadoAsesores.txtFilter")};a.loadGrid=function(){var b=new Core.Ajax.ServerRequest({overlayElement:a.divReporteListadoAsesores.parent(),secureRequest:true,requestUrl:"reporte/listadoasesores",requestType:"GET"});b.onSuccess=function(c){var d=a.divReporteListadoAsesores.swidget().initialOptions;d.dataSource.data=c;d.dataSource.schema={data:"Personas"};d.exportOptions.excel.dataSource.data=c;d.exportOptions.excel.dataSource.schema={data:"Personas"};d.exportOptions.excel.readDataSource=true;a.divReporteListadoAsesores.swidget().refresh(d);a.txtFilter.keydown()};b.request()}};Core.Business.ReporteListadoAsesores.Link=function(b){var a=this;a.divModal=$(".div-modal-detalle-link");a.link="";a.title="";$.extend(true,a,b);a.show=function(){a.lblTitle=a.divModal.find(".lbl-title");a.lblTitle.text(a.title);a.lblLink=a.divModal.find(".lbl-link");a.lblLink.text(a.link);a.divQR=a.divModal.find(".div-qr");a.divQR.empty();a.qrCode=new QRCode(a.divQR[0],{width:200,height:200});a.qrCode.makeCode(a.link);a.btnDownload=a.divModal.find(".btn-download");a.btnDownload.unbind("click");a.btnDownload.on("click",function(){var c=document.createElement("a");c.href=a.divQR.find("img").attr("src");c.download=(a.title+".png");c.click();c.remove()});a.divModal.modal({show:true})}};Core.Business.ResumenMinutasInternacional=new function(){var a=this;a.id="resumenMinutasInternacional";a.pageOptions=null;a.divResumenMinutas=null;a.lblTitle=null;a.txtDateFrom=null;a.txtDateTo=null;a.init=function(b,c){Core.loadPage("resumen-minutas-internacional.html",function(){document.title="Resumen Minutas Internacional";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.divResumenMinutas=$(".div-resumen-minutas");a.lblTitle=$(".label-title");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.initDatePickers();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,a.loadGrid,"Core.Business.ResumenMinutasInternacional")})};a.initDatePickers=function(){a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(b){a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(b){a.loadGrid()}}})};a.initGrid=function(){var b=[];b.push({field:"fechaAlta",title:"Fecha Alta",width:"7%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"fechaLiquidacion",title:"Fecha Liquidación",width:"7%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"usuarioIngreso",title:"Usuario Ingreso",width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"usuarioOperador",title:"Operador",width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"numComitente",title:"Comitente",width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"descripcionComitente",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"20%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"operacion",title:"Tipo de Operación",width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"mercado",title:"Mercado",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"moneda",title:"Moneda",width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"especie",title:"Especie",width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"cantidad",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNumber});b.push({field:"precio",title:"Precio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNuleablePrice});b.push({field:"precioReferencia",title:"Precio Referencia",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNuleablePrice});if(!Core.Objects.Context.Configuration.idAplicacion){b.push({field:"Precio2",title:"Precio Productor",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatNuleablePrice})}b.push({field:"estado",title:"Estado",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"idordencambio",title:"Orden",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({field:"numsecienciacambio",title:"Secuencia",attributes:Core.Functions.grid.getRightAlignedColumnClass(),width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});b.push({title:" ",width:"8%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(e,f,g){var c=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(e);c.on("click",function(){var h=new Core.Ajax.ServerRequest({requestUrl:"minutas/detalle/"+f.idMinuta,requestType:"GET"});h.onSuccess=function(o){var p="<table class='table table-striped'>";p+="<thead><tr><th>Fecha</th><th>Tipo Acción</th><th>Operador</th><th>Contexto</th></tr></thead>";p+="<tbody>";for(var m=0;m<o.detalle.length;m++){p+="<tr>";p+="<td>"+o.detalle[m].fecha+"</td>";p+="<td>"+o.detalle[m].tipo+"</td>";p+="<td>"+o.detalle[m].nombre+"</td>";var k=o.detalle[m].contexto.split("||");p+="<td>";for(var n=0;n<k.length;n++){p+=k[n]+((n<k.length-1)?"<br/>":"")}p+="</td>"}p+="</tbody>";p+="</table>";var l=new Core.Controls.Dialog("Detalles",p,{displayButtons:{close:true,accept:false}});l.show()};h.request()});if(a.pageOptions.actualizarMinutasPrecioProductor&&f.actualizarPrecio2){var d=$('<button type="button" title="Modificar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(e);d.on("click",function(){new Core.Controls.Prompt("Precio de Referencia Productor","Ingrese el nuevo Precio de Referencia Productor",{defaultValue:f.Precio2,allowEmptyText:true,onAccepted:function(i){var h=(i!="")?Core.Functions.Decimal.parseFloat(i):null;var j={data:{id:f.idMinuta,PrecioProductor:h}};var k=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"minutas/precioproductor",requestType:"PUT",requestData:j});k.onSuccess=function(l){a.loadGrid()};k.request()}}).show()})}}});a.divResumenMinutas.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Resumen Minutas",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["fechaAlta","fechaLiquidacion","usuarioIngreso","usuarioOperador","numComitente","descripcionComitente","operacion","mercado","plazo","moneda","especie","cantidad","precio","precioReferencia","estado","observaciones","idordencambio","numsecienciacambio"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"resumen-minutas"}}},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},grouping:{showGroupHeader:true,allowDragToGroup:true,message:"Arrastre un encabezado de columna para agrupar por esa columna"},columns:b})};a.loadGrid=function(){a.lblTitle.text("Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var b;b="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));b+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));var c=new Core.Ajax.ServerRequest({overlayElement:a.divResumenMinutas.parent(),secureRequest:true,requestUrl:"minutas/resumen",requestType:"GET",requestData:b});c.onSuccess=function(d){var e=a.divResumenMinutas.swidget().initialOptions;e.dataSource.data=d;e.dataSource.schema={data:"minutas"};e.dataSource.group=[{field:"estado",order:"asc"}];e.exportOptions.excel.dataSource.data=d;e.exportOptions.excel.dataSource.schema={data:"minutas"};e.exportOptions.excel.readDataSource=true;a.divResumenMinutas.swidget().refresh(e)};c.request()}};Core.Business.eSignInCredentials={Bolsa:1,Fondos:2};Core.Business.SignIn=new function(){var a=this;a.divMain=null;a.divAlert=null;a.divSuccessMessage=null;a.divCredential=null;a.ddlCredential=null;a.divValidationLegacy=null;a.validationLegacyControls={txtUser:null,txtPassword:null,btnContinue:null};a.divValidation=null;a.validationControls={txtUser:null,txtPassword1:null,txtPassword2:null,txtEmail:null,txtPhoneArea:null,txtPhoneNumber:null,btnSend:null};a.init=function(){Core.loadPage("sign-in.html",function(){document.title="Primer Ingreso";a.divMain=$(".panel-body");a.divAlert=$(".sign-in-alert");a.divCredential=$(".div-credential");a.ddlCredential=$(".dropdown-credential");a.divSuccessMessage=$(".div-success");a.divValidationLegacy=$(".div-validation-legacy");a.validationLegacyControls.txtUser=$(".textbox-validation-legacy-user");a.validationLegacyControls.txtPassword=$(".textbox-validation-legacy-password");new Core.Controls.CapslockWarning(a.validationLegacyControls.txtPassword);a.validationLegacyControls.btnContinue=$(".button-validation-legacy-continue");a.divValidation=$(".div-validation");a.validationControls.txtUser=$(".textbox-validation-user");a.validationControls.txtPassword1=$(".textbox-validation-pass1");a.validationControls.txtPassword2=$(".textbox-validation-pass2");new Core.Controls.CapslockWarning(a.validationControls.txtPassword2);a.validationControls.txtEmail=$(".textbox-validation-email");a.validationControls.txtPhoneArea=$(".textbox-validation-phone-area");a.validationControls.txtPhoneNumber=$(".textbox-validation-phone-number");a.validationControls.btnSend=$(".button-validation-send");a.ddlCredential.change(function(){a.divValidationLegacy.show()});a.validationLegacyControls.txtUser.add(a.validationLegacyControls.txtPassword).on("focus",function(){Core.Functions.Validations.toggleValidation($(this),false)});a.validationLegacyControls.btnContinue.click(function(){var d=a.validationLegacyControls.txtUser.val();var b=a.validationLegacyControls.txtPassword.val();if(!d||!d.length){Core.Functions.Validations.toggleValidation(a.validationLegacyControls.txtUser,true);return}if(!b||!b.length){Core.Functions.Validations.toggleValidation(a.validationLegacyControls.txtPassword,true);return}var c=new Core.Ajax.ServerRequest({overlayElement:a.divMain,secureRequest:false,requestUrl:"migracion/validacionlegacy",requestType:"POST",requestData:{idNegocio:a.ddlCredential.val(),user:d,pass:b}});c.onSuccess=function(e){Core.Objects.Context.Token=e.AccessToken;if(!Core.Functions.Validations.isBlockedStorage()&&Core.Functions.Persistence.getStorage()){Core.Functions.Persistence.getStorage().setItem("CoreContext",LZString.compressToUTF16(JSON.stringify(Core.Objects.Context)))}if(e.username){a.validationControls.txtUser.val(e.username)}if(e.email){a.validationControls.txtEmail.val(e.email)}a.divValidation.show();a.divValidationLegacy.hide()};c.request()});a.validationControls.txtUser.add(a.validationControls.txtEmail).on("focus",function(){Core.Functions.Validations.toggleValidation($(this),false)});Core.restrictions.applyRestriction(a.validationControls.txtPhoneArea,Core.restrictions.types.integer);Core.restrictions.applyRestriction(a.validationControls.txtPhoneNumber,Core.restrictions.types.integer);a.validationControls.txtPhoneArea.add(a.validationControls.txtPhoneNumber).on("focus",function(){Core.Functions.Validations.toggleValidation(a.validationControls.txtPhoneArea,false);Core.Functions.Validations.toggleValidation(a.validationControls.txtPhoneNumber,false)});a.validationControls.txtPassword1.password_strength();Core.Functions.changePassword.setPasswordsControl(a.validationControls.txtPassword1,a.validationControls.txtPassword2);a.validationControls.txtUser.on("focusout",function(){a.validUser(null)});a.validationControls.btnSend.click(function(){Core.Functions.Validations.toggleValidation(a.validationControls.txtUser,false);Core.Functions.Validations.toggleValidation(a.validationControls.txtPassword1,false);Core.Functions.Validations.toggleValidation(a.validationControls.txtPassword2,false);Core.Functions.Validations.toggleValidation(a.validationControls.txtEmail,false);Core.Functions.Validations.toggleValidation(a.validationControls.txtPhoneArea,false);Core.Functions.Validations.toggleValidation(a.validationControls.txtPhoneNumber,false);a.divAlert.slideUp();if(!Core.Functions.changePassword.isValidPasswords(a.validationControls.txtPassword1,a.validationControls.txtPassword2,a.divAlert)){return}if(!Core.Functions.Validations.isEmail(a.validationControls.txtEmail.val())){Core.Functions.Validations.toggleValidation(a.validationControls.txtEmail,true);return}var b=a.validationControls.txtPhoneArea.val();var c=a.validationControls.txtPhoneNumber.val();if(!b||!c||(b.length+c.length)!=10){Core.Functions.Validations.toggleValidation(a.validationControls.txtPhoneArea,true);Core.Functions.Validations.toggleValidation(a.validationControls.txtPhoneNumber,true);return}a.validUser(function(){var d=new Core.Ajax.ServerRequest({overlayElement:a.divMain,secureRequest:true,requestUrl:"migracion/migrarusuario",requestType:"POST",requestData:{newuser:a.validationControls.txtUser.val(),newpass:a.validationControls.txtPassword1.val(),email:a.validationControls.txtEmail.val(),telefono:"+549"+a.validationControls.txtPhoneArea.val()+a.validationControls.txtPhoneNumber.val()}});d.onSuccess=function(e){a.divValidation.hide();a.divValidationLegacy.hide();a.divCredential.hide();a.divSuccessMessage.show()};d.request()})});a.divValidation.hide();a.divValidationLegacy.hide();a.divSuccessMessage.hide()})};a.validUser=function(b){Core.Functions.Validations.toggleValidation(a.validationControls.txtUser,false);a.divAlert.slideUp();var e=a.validationControls.txtUser.val();if(!e){Core.Functions.Validations.toggleValidation(a.validationControls.txtUser,true);return}var c=/^[0-9a-zA-Z.]+$/;if(e.length<6||e.length>20||!c.test(e)){Core.Functions.Validations.toggleValidation(a.validationControls.txtUser,true);a.divAlert.text("El usuario debe contener entre 6 y 20 caracteres alfanuméricos.");a.divAlert.slideDown();return}var d=new Core.Ajax.ServerRequest({overlayElement:a.divMain,secureRequest:true,requestUrl:"migracion/validacionusuario",requestType:"POST",requestData:{user:a.validationControls.txtUser.val()}});d.onSuccess=function(f){if(f.error){Core.Functions.Validations.toggleValidation(a.validationControls.txtUser,true);a.divAlert.text(f.descripcion);a.divAlert.slideDown()}else{Core.Functions.Validations.toggleValidation(a.validationControls.txtUser,false);a.divAlert.slideUp();a.validationControls.txtUser.closest(".input-group, .form-group").addClass("has-success");if(b){b()}}};d.request()};a.close=function(){Core.Business.Logout.clearSession();Core.Business.Login.init()}};Core.Business.Tenencias31del12Concertacion=new function(){var a=this;a.idDefaultAccount=null;a.idDefaultProfile=null;a.id="tenencias31del12_concertacion";a.ddlAnio=null;a.btnDescargar=null;a.init=function(b,c){Core.loadPage("tenencias-concertacion.html",function(){document.title="Tenencias por Concertación";a.idDefaultAccount=b;a.idDefaultProfile=c;a.ddlAnio=$(".dropdown-anio");a.btnDescargar=$(".btn-descargar");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,a.idDefaultAccount,a.idDefaultProfile,function(){},"Core.Business.Tenencias31del12Concertacion")})};a.initControls=function(){var c=[];var b=new Date();for(var d=(b.getFullYear()-1);d>=2008;d--){c.push({value:d,text:d})}a.ddlAnio.shieldDropDown({dataSource:{data:c},valueTemplate:"{value}",textTemplate:"{text}"});a.btnDescargar.on("click",function(){if(a.ddlAnio.swidget().selectedItem()){function f(n){var m=new Blob([n.response],{type:n.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(m);return}var g=window.URL.createObjectURL(m);var l=document.createElement("a");l.href=g;var j=n.getResponseHeader("Content-Disposition").split("; ");var h="filename=reporte.pdf";for(var k=0;k<j.length;k++){if(j[k].indexOf("filename")>=0){h=j[k]}}l.download=h.split("=")[1];l.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(g)}var e=new XMLHttpRequest();e.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"descargar/6/"+encodeURIComponent(a.idDefaultAccount)+"?fecha="+a.ddlAnio.swidget().value()+"1231",true);e.responseType="blob";e.setRequestHeader("Authorization",Core.Objects.Context.Token);e.onload=function(g){if(e.status==200){f(e)}else{var h=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga del reporte.</p>",{displayButtons:{close:true,accept:false}});h.show()}};e.send()}})}};Core.Business.Tenencias31del12Liquidacion=new function(){var a=this;a.idDefaultAccount=null;a.idDefaultProfile=null;a.id="tenencias31del12_liquidacion";a.ddlAnio=null;a.btnDescargar=null;a.init=function(b,c){Core.loadPage("tenencias-liquidacion.html",function(){document.title="Tenencias por Liquidación";a.idDefaultAccount=b;a.idDefaultProfile=c;a.ddlAnio=$(".dropdown-anio");a.btnDescargar=$(".btn-descargar");a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,a.idDefaultAccount,a.idDefaultProfile,function(){},"Core.Business.Tenencias31del12Liquidacion")})};a.initControls=function(){var c=[];var b=new Date();for(var d=(b.getFullYear()-1);d>=2008;d--){c.push({value:d,text:d})}a.ddlAnio.shieldDropDown({dataSource:{data:c},valueTemplate:"{value}",textTemplate:"{text}"});a.btnDescargar.on("click",function(){if(a.ddlAnio.swidget().selectedItem()){function f(n){var m=new Blob([n.response],{type:n.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(m);return}var g=window.URL.createObjectURL(m);var l=document.createElement("a");l.href=g;var j=n.getResponseHeader("Content-Disposition").split("; ");var h="filename=reporte.pdf";for(var k=0;k<j.length;k++){if(j[k].indexOf("filename")>=0){h=j[k]}}l.download=h.split("=")[1];l.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(g)}var e=new XMLHttpRequest();e.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"descargar/7/"+encodeURIComponent(a.idDefaultAccount)+"?fecha="+a.ddlAnio.swidget().value()+"1231",true);e.responseType="blob";e.setRequestHeader("Authorization",Core.Objects.Context.Token);e.onload=function(g){if(e.status==200){f(e)}else{var h=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga del reporte.</p>",{displayButtons:{close:true,accept:false}});h.show()}};e.send()}})}};Core.Business.TesoreriaExtractos=new function(){var a=this;a.init=function(b,c){Core.Business.BaseTesoreriaExtractos.init(b,c,{id:"extractos",namespace:"Core.Business.TesoreriaExtractos"})}};Core.Business.TesoreriaBCIExtractos=new function(){var a=this;a.init=function(b,c){Core.Business.BaseTesoreriaExtractos.init(b,c,{id:"extractosBCI",namespace:"Core.Business.TesoreriaBCIExtractos"})}};Core.Business.BalanzCambioExtractos=new function(){var a=this;a.init=function(b,c){Core.Business.BaseTesoreriaExtractos.init(b,c,{id:"balanzcambioExtractos",namespace:"Core.Business.BalanzCambioExtractos"})}};Core.Business.BaseTesoreriaExtractos=new function(){var a=this;a.id="";a.namespace="";a.divContainerAdjuntarArchivos=null;a.divReporteExtractos=null;a.lblTitle=null;a.txtFilter=null;a.timeout=null;a.chkIncluirFinalizados=null;a.chkIncluirRestricciones=null;a.txtDateFrom=null;a.txtDateTo=null;a.timerId=null;a.btnRefresh=null;a.divBanco=null;a.ddlBanco=null;a.inputFiles=null;a.btnConfirmarArchivos=null;a.btnProcesar=null;a.loaded=false;a.timeout=null;a.window=$(window);a.dataGrid=null;a.divContadores=null;a.coloresActivos={};a.init=function(b,c,d){Core.loadPage("tesoreria-extractos.html",function(){document.title="Extractos";a.id=d.id;a.namespace=d.namespace;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.idNegocio=((a.pageOptions&&a.pageOptions.idNegocio!=null)?a.pageOptions.idNegocio:Core.Enums.eNegocio.BCV);a.divContainerAdjuntarArchivos=$(".div-container-adjuntar-archivos");a.divContainerAdjuntarArchivos.show();if(a.idNegocio==Core.Enums.eNegocio.BalanzCambio){a.divContainerAdjuntarArchivos.hide()}a.divReporteExtractos=$(".div-reporte-extractos");a.lblTitle=$(".label-title");a.txtFilter=$(".textbox-filter");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.btnRefresh=$(".btn-refresh");a.divBanco=$(".div-banco");a.ddlBanco=$(".dropdown-banco");a.chkIncluirFinalizados=$(".checkbox-incluir-finalizados");a.chkIncluirRestricciones=$(".checkbox-incluir-restricciones");a.inputFiles=$(".input-upload-file");a.btnConfirmarArchivos=$(".btn-confirmar-archivos");a.btnProcesar=$(".btn-procesar");a.divContadores=$(".div-contadores");a.initControls();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loaded=false;a.loadGrid()},a.namespace)})};a.initControls=function(){var b=new Date();b.setDate(b.getDate()-1);a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:b,max:new Date(),events:{change:function(c){a.loaded=false;a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loaded=false;a.loadGrid()}}});a.ddlBanco.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",events:{select:function(c){a.refreshGrid()}},width:"85%"});a.btnRefresh.on("click",function(){a.loaded=false;a.loadGrid()});a.btnProcesar.on("click",function(){var c={};c.idNegocio=a.idNegocio;c.FechaDesde=Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value());c.FechaHasta=Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value());c.idCuentaBancariaBalanz=a.ddlBanco.swidget().selectedItem().idCuentaBancariaBalanz;var d=new Core.Ajax.ServerRequest({overlayElement:a.btnProcesar,secureRequest:true,requestUrl:"backoffice/extractos/importacionmasiva",requestType:"POST",requestData:c});d.onSuccess=function(e){new Core.Controls.ProcessProgress({idProcess:((e&&e.idProceso)?e.idProceso:0),overlayElement:a.divReporteExtractos.parent(),onFinish:function(){a.loaded=false;a.loadGrid()}}).show()};d.request()});a.btnConfirmarArchivos.on("click",function(){if(a.inputFiles[0].files.length==0){new Core.Controls.Dialog("Aviso","<p>Debe ingresar algún archivo para procesar.</p>",{displayButtons:{close:true,accept:false}}).show();return}for(var j=0,e;e=a.inputFiles[0].files[j];j++){var g=e.name.split(".");var d=g[g.length-1];if(!d||(d.toLowerCase()!="csv"&&d.toLowerCase()!="xls"&&d.toLowerCase()!="xlsx")){new Core.Controls.Dialog("Aviso","<p>Los archivos seleccionados deben ser: csv, xls, xlsx.</p>",{displayButtons:{close:true,accept:false}}).show();return}}var h={Authorization:Core.Objects.Context.Token,Accept:"application/json"};var c=new FormData();for(var j=0,e;e=a.inputFiles[0].files[j];j++){c.append("file-"+j,e)}var k=new Core.Controls.Overlay(a.btnConfirmarArchivos,{});$.ajax({type:"POST",url:Core.Origin+"/backoffice/"+Core.PrefixUrl+"upload/csv/extractos/1",data:c,cache:false,contentType:false,processData:false,method:"POST",headers:h,success:function(f){a.inputFiles.val("");a.loaded=false;a.loadGrid();new Core.Controls.Dialog("Mensaje","<p>Finalizo la importación del archivo.</p>",{displayButtons:{close:true,accept:false}}).show()},error:function(i){var m=JSON.parse(i.responseText);var n=(m&&m.descripcion)?"Mensaje":"Error de conexión";var f=(m&&m.descripcion)?m.descripcion:"Algunos componentes de la página no se cargaron correctamente. Por favor intente mas tarde...";var l=new Core.Controls.Dialog(n,"<p>"+f+"</p>",{displayButtons:{close:true,accept:false}});l.show()},complete:function(){k.destroy()}})});a.chkIncluirFinalizados.on("change",function(){a.loaded=false;a.loadGrid()});a.chkIncluirRestricciones.on("change",function(){a.loaded=false;a.loadGrid()});a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var c=a.divReporteExtractos.swidget().dataSource;if(value){c.filter={or:[{path:"idExtracto",filter:"contains",value:value},{path:"Fecha",filter:"contains",value:value},{path:"CuentaBalanz",filter:"contains",value:value},{path:"CUIL",filter:"contains",value:value},{path:"Nombre",filter:"contains",value:value},{path:"Importe",filter:"contains",value:value},{path:"idOrden",filter:"contains",value:value},{path:"Comitente",filter:"contains",value:value},{path:"DescripcionCuenta",filter:"contains",value:value},{path:"Solicitud",filter:"contains",value:value},{path:"NumeroRecibo",filter:"contains",value:value}]}}else{c.filter=null}c.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,(a.namespace+".txtFilter"))};a.initGrid=function(){var b=[];b.push({field:"idExtracto",title:"Extracto",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Fecha",title:"Fecha",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"CuentaBalanz",title:"Banco",width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"CUIL",title:"CUIL",width:"7%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Nombre",title:"Nombre",width:"15%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Importe",title:"Importe",width:"9%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatPrice});b.push({title:"Obs.",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,d,e){if(d.Observacion){var f=(d.length>140)?(d.Observacion.substr(0,140)+"..."):(d.Observacion);c.html('<button type="button" title="'+f+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');c.addClass("link-cell");c.on("click",function(){var g=new Core.Controls.Dialog("Observaciones",(d.Observacion)?d.Observacion:"",{displayButtons:{close:true,accept:false}});g.show()})}}});b.push({field:"idOrden",title:"Orden",width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,d,e){if(d.idOrdenNegritas==1){c.html("<a><strong>"+(d.idOrden==""?"No definido":d.idOrden)+"</strong></a>")}else{c.html("<a>"+(d.idOrden==""?"No definido":d.idOrden)+"</a>")}c.addClass("link-cell");c.on("click",function(){new Core.Controls.Prompt("Modificar nº orden","Ingrese nuevo nº (vacio para blanquearlo)",{allowEmptyText:true,onAccepted:function(g){if($.isNumeric(g)||g==""){var f=new Core.Ajax.ServerRequest({requestUrl:"backoffice/extractos/actualizar",requestData:{data:{idExtracto:d.idExtracto,idOrden:(g==""?" ":g)}}});f.onSuccess=function(h){a.loaded=false;a.loadGrid()};f.request()}}}).show()});if(d.ColorFila!=""){c.parent().css("background-color","rgba("+a.hexToRgb(d.ColorFila)+((e%2==0)?", 0.6":", 1 ")+")")}}});b.push({title:"Comp.",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,d,e){if(d.idArchivoComprobante!=0){c.html('<button type="button" title="Descargar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');c.addClass("link-cell");c.on("click",function(){function g(o){var n=new Blob([o.response],{type:o.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(n);return}var h=window.URL.createObjectURL(n);var m=document.createElement("a");m.href=h;var k=o.getResponseHeader("Content-Disposition").split("; ");var j="filename=reporte.xlsx";for(var l=0;l<k.length;l++){if(k[l].indexOf("filename")>=0){j=k[l]}}m.download=j.split("=")[1];m.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(h)}var f=new XMLHttpRequest();f.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"comprobantes/"+d.idTipoArchivo+"/"+d.idArchivoComprobante,true);f.responseType="blob";f.setRequestHeader("Authorization",Core.Objects.Context.Token);f.onload=function(h){if(f.status==200){g(f)}else{var i=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga del reporte.</p>",{displayButtons:{close:true,accept:false}});i.show()}};f.send()})}}});b.push({title:"Comitente",width:"7%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,d,e){if(d.CuentaNegritas==1){c.html("<a><strong>"+(d.Cuenta==""?"No definido":d.Cuenta)+"</strong></a>")}else{c.html("<a>"+(d.Cuenta==""?"No definido":d.Cuenta)+"</a>")}c.addClass("link-cell");c.on("click",function(){var f=new Core.Business.BaseTesoreriaExtractos.ChangeNumeroCuenta({cuenta:d,idNegocio:a.idNegocio,onSuccess:function(){a.loaded=false;a.loadGrid()}}).show()})}});b.push({field:"DescripcionCuenta",title:"Descripción",width:"18%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({field:"Solicitud",title:"Solicitud",width:"7%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length)});b.push({title:"Numero Recibo",width:"7%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(c,d,e){if(d.NumeroReciboNegritas==1){c.html("<a><strong>"+(d.NumeroRecibo==""?"No definido":d.NumeroRecibo)+"</strong></a>")}else{c.html("<a>"+(d.NumeroRecibo==""?"No definido":d.NumeroRecibo)+"</a>")}c.addClass("link-cell");c.on("click",function(){new Core.Controls.Prompt("Modificar nº de recibo","Ingrese nuevo nº (vacio para blanquearlo)",{allowEmptyText:true,onAccepted:function(g){if($.isNumeric(g)||g==""){var f=new Core.Ajax.ServerRequest({requestUrl:"backoffice/extractos/actualizar",requestData:{data:{idExtracto:d.idExtracto,numExternoManual:(g==""?" ":g)}}});f.onSuccess=function(h){a.loaded=false;a.loadGrid()};f.request()}}}).show()})}});b.push({title:"Vincular",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,e,f){if(e.VincularExtracto==1){var c=$('<button type="button" title="Vincular extracto" class="btn-sm balanz-button"><span class="glyphicon glyphicon-refresh"></span></button>').appendTo(d);c.on("click",function(){var g=new Core.Ajax.ServerRequest({overlayElement:c,requestUrl:"backoffice/extractos/vincular",requestData:{data:{FechaDesde:a.getFormatDate(e.Fecha),FechaHasta:a.getFormatDate(e.Fecha),idCuentaBancariaBalanz:e.idCuentaBancariaBalanz,idNegocio:a.idNegocio,idExtractoBancario:e.idExtracto}}});g.onSuccess=function(h){a.loaded=false;a.loadGrid()};g.request()})}}});b.push({title:"Imp.",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,e,f){if(e.Importable==1){var c=$('<button type="button" title="Importar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-chevron-right"></span></button>').appendTo(d);c.on("click",function(){var g=new Core.Ajax.ServerRequest({overlayElement:c,requestUrl:"backoffice/extractos/tesoreria/importar",requestData:{data:{idNegocio:a.idNegocio,idExtractoBancario:e.idExtracto}}});g.onSuccess=function(h){a.loaded=false;a.loadGrid()};g.request()})}}});b.push({title:"Fin. Ord.",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,e,f){if(e.FinalizarOrden==1){var c=$('<button type="button" title="Finalizar orden" class="btn-sm balanz-button"><span class="glyphicon glyphicon-check"></span></button>').appendTo(d);c.on("click",function(){var g=new Core.Ajax.ServerRequest({overlayElement:c,requestUrl:"backoffice/extractos/finalizarordenes",requestData:{data:{FechaDesde:a.getFormatDate(e.Fecha),FechaHasta:a.getFormatDate(e.Fecha),idCuentaBancariaBalanz:e.idCuentaBancariaBalanz,idNegocio:a.idNegocio,idExtractoBancario:e.idExtracto}}});g.onSuccess=function(h){a.loaded=false;a.loadGrid()};g.request()})}}});b.push({title:"Fin. Ext.",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(d,e,f){var c;if(e.Finalizado){c=$('<button type="button" title="Finalizado, click para deshacer" class="btn-sm balanz-button" style="background-color: green;border-color: green;"><span class="glyphicon glyphicon-ok"></span></button>').appendTo(d)}else{c=$('<button type="button" title="No finalizado, click para finalizar" class="btn-sm balanz-button" style="background-color: grey;border-color: grey;"><span class="glyphicon glyphicon-ok"></span></button>').appendTo(d)}c.on("click",function(){var g=new Core.Ajax.ServerRequest({overlatElement:c,requestUrl:"backoffice/extractos/actualizar",requestData:{data:{idExtracto:e.idExtracto,finalizado:(e.Finalizado==1?0:1)}}});g.onSuccess=function(h){a.loaded=false;a.loadGrid()};g.request()})}});a.divReporteExtractos.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:b,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Extractos",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["idExtracto","Fecha","CuentaBalanz","CUIL","Nombre","Importe","Observacion","idOrden","Comitente","DescripcionCuenta","Solicitud","NumeroRecibo"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Extractos"}}},paging:{pageSize:50,pageLinksCount:10}})};a.getFormatDate=function(b){return b.substr(6,4)+b.substr(3,2)+b.substr(0,2)};a.loadGrid=function(){a.lblTitle.text("Entre el "+Core.Functions.Date.getDisplayDate(a.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(a.txtDateTo.swidget().value()));var b=("idNegocio="+a.idNegocio);b+="&FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value()));b+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value()));b+="&incluirFinalizados="+((a.chkIncluirFinalizados[0].checked)?"1":"0");b+="&incluirRestricciones="+((a.chkIncluirRestricciones[0].checked)?"1":"0");var c=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,overlayElement:a.divReporteExtractos.parent(),secureRequest:true,requestUrl:"backoffice/extractos",requestType:"GET",requestData:b});c.onSuccess=function(f){a.dataGrid=f;var e=[];f.extractos.forEach(function(j,i){if(e.indexOf(j.ColorFila)==-1){e.push(j.ColorFila)}});e.sort(function(i,j){if(i>j){return 1}else{return -1}});a.divContadores.empty();$('<label style="width:100px;" class="text-center">Total: '+f.extractos.length+"</label>").appendTo(a.divContadores);e.forEach(function(k,j){var i=$.grep(f.extractos,function(n,m){return n.ColorFila==k});var l=$('<label class="text-center lblColorContador" color="'+k+'" activo="'+((a.coloresActivos[k]==false)?"false":"true")+'" style="color: #2d2d2d !important; border-radius:4px; margin-right:3px; width:75px; border: 4px solid '+(k?k:"transparent")+"; background-color:"+((a.coloresActivos[k]==false)?"#c4c4c4":k)+';">'+i.length+"</label>").appendTo(a.divContadores);if(a.coloresActivos[k]==null){a.coloresActivos[k]=true}l.on("click",function(){a.setColor(l)})});var d=[];var g=[{value:"Todos",text:"Todos",idCuentaBancariaBalanz:-1}];f.extractos.forEach(function(j,i){if(d.indexOf(j.CuentaBalanz)==-1){d.push(j.CuentaBalanz);g.push({value:j.CuentaBalanz,text:j.CuentaBalanz,idCuentaBancariaBalanz:j.idCuentaBancariaBalanz})}});var h=a.ddlBanco.swidget().initialOptions;h.dataSource.data=g;a.ddlBanco.swidget().refresh(h);if(d.length>1){a.divBanco.show()}else{a.divBanco.hide()}a.refreshGrid();a.loaded=true};c.request()};a.setColor=function(b){if(b.attr("activo")=="true"){b.css("background-color","#c4c4c4");b.attr("activo","false");a.coloresActivos[b.attr("color")]=false}else{b.css("background-color",b.attr("color"));b.attr("activo","true");a.coloresActivos[b.attr("color")]=true}a.refreshGrid()};a.refreshGrid=function(){var c=$.grep(a.dataGrid.extractos,function(j,h){return true});if(a.ddlBanco.swidget().selectedItem().value!="Todos"){c=$.grep(c,function(i,h){return i.CuentaBalanz==a.ddlBanco.swidget().selectedItem().value})}var b=$(".lblColorContador");for(var d=0;d<b.length;d++){var f=$(b[d]);if(f.attr("activo")=="false"){c=$.grep(c,function(j,h){return j.ColorFila!=f.attr("color")})}}var g=a.window.scrollTop();var e=a.divReporteExtractos.swidget().initialOptions;e.dataSource.data=c;e.dataSource.sort=a.divReporteExtractos.swidget().dataSource.sort;e.exportOptions.excel.dataSource.data=c;e.exportOptions.excel.readDataSource=true;a.divReporteExtractos.swidget().refresh(e);a.txtFilter.keydown();a.window.scrollTop(g)};a.hexToRgb=function(d){d=d.replace("#","");var f=parseInt(d.substring(0,2),16);var e=parseInt(d.substring(2,4),16);var c=parseInt(d.substring(4,6),16);var h=f+","+e+","+c;return h}};Core.Business.BaseTesoreriaExtractos.ChangeNumeroCuenta=function(b){var a=this;a.divModal=$(".div-tesoreria-cambio-numero-cuenta");a.ddlNumeroCuentaSugeridas=null;a.divNuevoNumeroCuentaExterno=null;a.txtNuevoNumeroCuenta=null;a.divGuardarVinculacion=null;a.chkGuardarVinculacion=null;a.cuenta=null;a.onSuccess=function(){};a.idNegocio=Core.Enums.eNegocio.BCV;a.cuentasSugeridas=[];$.extend(true,a,b);a.show=function(){var c=new Core.Ajax.ServerRequest({showOverlay:true,requestUrl:"backoffice/extractos/cuentassugeridas/"+a.cuenta.idExtracto,requestType:"GET"});c.onSuccess=function(e){e.cuentassugeridas.unshift({Descripcion:"No definido",numCuentaExterno:"No definido"});e.cuentassugeridas.push({Descripcion:"Otro",numCuentaExterno:"Otro"});a.cuentasSugeridas=e.cuentassugeridas;a.divAlertCuentaSugerida=a.divModal.find(".div-alert-cuenta-sugerida");a.divNuevoNumeroCuentaExterno=a.divModal.find(".div-nuevo-numero-cuenta");a.txtNuevoNumeroCuenta=a.divModal.find(".textbox-nuevo-numero-cuenta");var d=$.grep(a.cuentasSugeridas,function(g,f){return g.numCuentaExterno==a.cuenta.Cuenta})[0];new Core.Controls.DecimalPicker(a.txtNuevoNumeroCuenta,{maxDecimalDigitCount:0,showThousandsSeparator:"",defaultValue:(d)?"":a.cuenta.Cuenta.toString(),onKeyUp:function(){a.txtNuevoNumeroCuentaChange()}});a.ddlNumeroCuentaSugeridas=a.divModal.find(".dropdown-numero-cuenta-sugeridos");a.ddlNumeroCuentaSugeridas.shieldDropDown({dataSource:{data:a.cuentasSugeridas},textTemplate:"{Descripcion}",valueTemplate:"{numCuentaExterno}",value:(d)?a.cuenta.Cuenta:((a.cuenta.Cuenta=="")?"No definido":"Otro"),events:{select:function(f){a.ddlNumeroCuentaSugeridasChange()}}});a.divGuardarVinculacion=a.divModal.find(".div-guardar-vinculacion");a.chkGuardarVinculacion=a.divModal.find(".checkbox-guardar-vinculacion");a.chkGuardarVinculacion.shieldCheckBox({label:"Guardar vinculación",});a.chkGuardarVinculacion.swidget().checked(false);a.divModal.find(".btn-confirmar-cambio-numero-cuenta").unbind("click");a.divModal.find(".btn-confirmar-cambio-numero-cuenta").click(function(){var f=a.ddlNumeroCuentaSugeridas.swidget().selectedItem().numCuentaExterno;if(f=="Otro"){f=a.txtNuevoNumeroCuenta.val()}if(f=="No definido"){f=""}var g={idExtracto:a.cuenta.idExtracto,numCuentaExterno:f};if(a.idNegocio==Core.Enums.eNegocio.BCV||a.idNegocio==Core.Enums.eNegocio.BCI){g.GuardarVinculacion=((a.cuenta.VinculacionManual&&(a.ddlNumeroCuentaSugeridas.swidget().selectedItem().numCuentaExterno=="Otro"||a.ddlNumeroCuentaSugeridas.swidget().selectedItem().numCuentaExterno=="No definido")&&a.chkGuardarVinculacion.swidget().checked())?1:0)}var h=new Core.Ajax.ServerRequest({requestUrl:"backoffice/extractos/actualizar",requestData:{data:g}});h.onSuccess=function(i){a.onSuccess();a.divModal.modal("hide")};h.request()});a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.divModal.on("shown.bs.modal",function(){a.ddlNumeroCuentaSugeridas.focus()});a.divModal.modal({show:true});a.ddlNumeroCuentaSugeridasChange()};c.request()};a.ddlNumeroCuentaSugeridasChange=function(){a.divNuevoNumeroCuentaExterno.hide();a.divGuardarVinculacion.hide();a.divAlertCuentaSugerida.hide();if(a.ddlNumeroCuentaSugeridas.swidget().selectedItem().numCuentaExterno=="Otro"){a.divNuevoNumeroCuentaExterno.show();if(a.idNegocio==Core.Enums.eNegocio.BCV){a.txtNuevoNumeroCuentaChange()}}if((a.idNegocio==Core.Enums.eNegocio.BCV||a.idNegocio==Core.Enums.eNegocio.BCI)&&a.cuenta.VinculacionManual&&(a.ddlNumeroCuentaSugeridas.swidget().selectedItem().numCuentaExterno=="Otro"||a.ddlNumeroCuentaSugeridas.swidget().selectedItem().numCuentaExterno=="No definido")){a.divGuardarVinculacion.show()}};a.txtNuevoNumeroCuentaChange=function(){a.divAlertCuentaSugerida.hide();if(!($.grep(a.cuentasSugeridas,function(d,c){return d.numCuentaExterno==a.txtNuevoNumeroCuenta.val()})[0])){a.divAlertCuentaSugerida.show()}};a.destroy=function(){a.ddlNumeroCuentaSugeridas.swidget().destroy();a.chkGuardarVinculacion.swidget().destroy()}};Core.Business.TesoreriaExtractosConciliacion=new function(){var a=this;a.init=function(b,c){Core.Business.BaseTesoreriaExtractosConciliacion.init(b,c,{id:"extractosConciliacion",namespace:"Core.Business.TesoreriaExtractosConciliacion"})}};Core.Business.TesoreriaBCIExtractosConciliacion=new function(){var a=this;a.init=function(b,c){Core.Business.BaseTesoreriaExtractosConciliacion.init(b,c,{id:"extractosBCIConciliacion",namespace:"Core.Business.TesoreriaBCIExtractosConciliacion"})}};Core.Business.BalanzCambioConciliacion=new function(){var a=this;a.init=function(b,c){Core.Business.BaseTesoreriaExtractosConciliacion.init(b,c,{id:"balanzcambioConciliacion",namespace:"Core.Business.BalanzCambioConciliacion"})}};Core.Business.BaseTesoreriaExtractosConciliacion=new function(){var a=this;a.id="";a.namespace="";a.divBotoneraSaldos=null;a.divContainerConciliaciones=null;a.divDiferencias=null;a.divConciliaciones=null;a.btnGenerarAsientos=null;a.txtFilter=null;a.timeout=null;a.txtDateFrom=null;a.txtDateTo=null;a.selectedIdCuentaBancariaBalanz=null;a.pageOptions=null;a.window=$(window);a.init=function(b,c,d){Core.loadPage("tesoreria-extractos-conciliaciones.html",function(){a.id=d.id;a.namespace=d.namespace;document.title="Conciliaciones";a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.idNegocio=((a.pageOptions&&a.pageOptions.idNegocio!=null)?a.pageOptions.idNegocio:Core.Enums.eNegocio.BCV);a.divBotoneraSaldos=$(".div-botonera-saldos");a.divContainerConciliaciones=$(".div-container-conciliaciones");a.divContainerConciliaciones.hide();a.divDiferencias=$(".div-reporte-diferencias");a.divConciliaciones=$(".div-reporte-conciliaciones");a.btnGenerarAsientos=$(".btn-generar-asientos");a.txtFilter=$(".textbox-filter");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.initControls();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadControls()},a.namespace)})};a.initControls=function(){a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var c=a.divConciliaciones.swidget().dataSource;if(value){c.filter={or:[{path:"CodFondo",filter:"contains",value:value},{path:"NumComitenteB",filter:"contains",value:value},{path:"NumComitenteF",filter:"contains",value:value},{path:"Leyenda",filter:"contains",value:value},{path:"Descripcion",filter:"contains",value:value},{path:"CUIL",filter:"contains",value:value},{path:"NumComitente",filter:"contains",value:value},{path:"NumCuotapartista",filter:"contains",value:value}]}}else{c.filter=null}c.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,(a.namespace+".txtFilter"));var b=new Date();b.setDate(b.getDate()-1);a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:b,max:new Date(),events:{change:function(c){a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:b,max:new Date(),events:{change:function(c){a.loadGrid()}}});a.btnGenerarAsientos.on("click",function(){if(a.selectedIdCuentaBancariaBalanz!=null){var c={};c.idCuentaBancariaBalanz=a.selectedIdCuentaBancariaBalanz;c.idNegocio=a.idNegocio;c.FechaDesde=Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value());c.FechaHasta=Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value());var d=new Core.Ajax.ServerRequest({overlayElement:a.btnGenerarAsientos,secureRequest:true,requestUrl:"balanzcambio/conciliacion/generarAsientosAutomaticos",requestType:"POST",requestData:c});d.onSuccess=function(){a.loadGrid()};d.request()}});a.btnGenerarAsientos.hide();if(a.pageOptions&&a.pageOptions.generarAsientosAutomaticos==1){a.btnGenerarAsientos.show()}};a.loadControls=function(){var b={};b.idNegocio=a.idNegocio;var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"backoffice/extractos/saldos",requestType:"GET",requestData:b});c.onSuccess=function(d){a.divBotoneraSaldos.empty();d.saldos.forEach(function(g,e){var f=$("<label class='lblEstadoContador' style='background-color: transparent; margin: 8px 6px 8px 0; padding: 4px 5px; border: 1px solid #ccc;  font-weight: normal;' activo='false' idCuentaBancariaBalanz='"+g.idCuentaBancariaBalanz+"'>"+g.Descripcion+"<br/>"+g.Simbolo+": "+Core.Functions.grid.formatIntegerNumber(g.Saldo)+"<br/><span style='font-size: 13px;'>"+g.Fecha+"</span></label>").appendTo(a.divBotoneraSaldos);f.on("click",function(){a.setSaldo(f)})})};c.request()};a.setSaldo=function(c){var e=a.divBotoneraSaldos.find(".lblEstadoContador");for(var b=0;b<e.length;b++){var d=$(e[b]);d.css("background-color","transparent");d.attr("activo","false")}c.css("background-color","lightblue");c.attr("activo","true");a.selectedIdCuentaBancariaBalanz=c.attr("idCuentaBancariaBalanz");a.loadGrid()};a.initGrid=function(){var b=[];var d=[];if(a.idNegocio==Core.Enums.eNegocio.FCI){b.push({width:"5%",field:"CodFondo",title:"Fondo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});d.push("CodFondo")}b.push({width:"5%",field:"Fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});d.push("Fecha");if(a.idNegocio==Core.Enums.eNegocio.BCV||Core.Enums.eNegocio.BCI){b.push({width:"5%",field:"NumComitenteB",title:"Comitente B",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});d.push("NumComitenteB")}else{if(a.idNegocio==Core.Enums.eNegocio.BalanzCambio){b.push({width:"5%",field:"CuentaCambioB",title:"Cuenta Cambio B",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});d.push("CuentaCambioB")}else{b.push({width:"5%",field:"NumCuotapartistaF",title:"Cuotapartista F",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});d.push("NumCuotapartistaF")}}b.push({width:"25%",field:"Leyenda",title:"Leyenda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});d.push("Leyenda");b.push({width:"5%",field:"FechaCarga",title:"Fecha Carga",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});d.push("FechaCarga");if(a.idNegocio==Core.Enums.eNegocio.BCV||a.idNegocio==Core.Enums.eNegocio.BCI||a.idNegocio==Core.Enums.eNegocio.BalanzCambio){b.push({width:"5%",field:"ImporteB",title:"Importe B",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatPrice});d.push("ImporteB")}else{b.push({width:"5%",field:"ImporteF",title:"Importe F",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatPrice});d.push("ImporteF")}b.push({width:"5%",field:"ImporteE",title:"Importe E",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatPrice});d.push("ImporteE");b.push({width:"25%",field:"Descripcion",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});d.push("Descripcion");b.push({width:"5%",field:"CUIL",title:"CUIL",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});d.push("CUIL");b.push({width:"5%",field:"FechaBanco",title:"Fecha Banco",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});d.push("FechaBanco");b.push({width:"5%",field:"Referencia",title:"Referencia",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});d.push("Referencia");b.push({width:"5%",field:"idOrden",title:"ID Orden",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedIntegerNumber});d.push("idOrden");if(a.idNegocio==Core.Enums.eNegocio.BCV||a.idNegocio==Core.Enums.eNegocio.BCI){b.push({width:"5%",field:"NumComitente",title:"Comitente",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});d.push("NumComitente")}else{if(a.idNegocio==Core.Enums.eNegocio.BalanzCambio){b.push({width:"5%",field:"CuentaCambio",title:"Cuenta Cambio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});d.push("CuentaCambio")}else{b.push({width:"5%",field:"NumCuotapartista",title:"Cuotapartista",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});d.push("NumCuotapartista")}}a.divConciliaciones.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:b,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Conciliaciones",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:d,header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Conciliaciones"}}},paging:{pageSize:50,pageLinksCount:10}});var c=[];c.push({field:"Fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatUndefinedString});c.push({field:"SaldoVisual",title:(a.idNegocio==Core.Enums.eNegocio.BalanzCambio?"Saldo Balanz Cambio":"Saldo Visual"),attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatPrice});c.push({field:"DiarioVisual",title:(a.idNegocio==Core.Enums.eNegocio.BalanzCambio?"Diario Balanz Cambio":"Diario Visual"),attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatPrice});c.push({field:"SaldoBanco",title:"Saldo Banco",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatPrice});c.push({field:"DiarioBanco",title:"Diario Banco",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatPrice});c.push({field:"DiferenciaSaldo",title:"Diferencia Saldo",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatPrice});c.push({field:"DiferenciaDiario",title:"Diferencia Diario",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(c.length),format:Core.Functions.grid.formatPrice});a.divDiferencias.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:c})};a.loadGrid=function(){if(a.selectedIdCuentaBancariaBalanz!=null){var b={};b.idNegocio=a.idNegocio;b.FechaDesde=Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value());b.FechaHasta=Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value());var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"backoffice/extractos/conciliacion/"+a.selectedIdCuentaBancariaBalanz,requestType:"GET",requestData:b});c.onSuccess=function(d){a.divContainerConciliaciones.show();var e=a.divDiferencias.swidget().initialOptions;e.dataSource.data=d.diferencias;a.divDiferencias.swidget().refresh(e);var e=a.divConciliaciones.swidget().initialOptions;e.dataSource.data=d.conciliacion;e.exportOptions.excel.dataSource.data=d.conciliacion;e.exportOptions.excel.readDataSource=true;a.divConciliaciones.swidget().refresh(e);a.txtFilter.keydown()};c.request()}}};Core.Business.TesoreriaExtractosMovimientos=new function(){var a=this;a.init=function(b,c){Core.Business.BaseTesoreriaExtractosMovimientos.init(b,c,{id:"extractosMovimientos",namespace:"Core.Business.TesoreriaExtractosMovimientos"})}};Core.Business.TesoreriaBCIExtractosMovimientos=new function(){var a=this;a.init=function(b,c){Core.Business.BaseTesoreriaExtractosMovimientos.init(b,c,{id:"extractosBCIMovimientos",namespace:"Core.Business.TesoreriaBCIExtractosMovimientos"})}};Core.Business.BalanzCambioMovimientos=new function(){var a=this;a.init=function(b,c){Core.Business.BaseTesoreriaExtractosMovimientos.init(b,c,{id:"balanzcambioMovimientos",namespace:"Core.Business.BalanzCambioMovimientos"})}};Core.Business.BaseTesoreriaExtractosMovimientos=new function(){var a=this;a.id="";a.namespace="";a.divBotoneraSaldos=null;a.divContainerMovimientos=null;a.divMovimientos=null;a.txtFilter=null;a.timeout=null;a.txtDateFrom=null;a.txtDateTo=null;a.selectedIdCuentaBancariaBalanz=null;a.pageOptions=null;a.window=$(window);a.init=function(b,c,d){Core.loadPage("tesoreria-extractos-movimientos.html",function(){document.title="Movimientos";a.id=d.id;a.namespace=d.namespace;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[c]);a.idNegocio=((a.pageOptions&&a.pageOptions.idNegocio!=null)?a.pageOptions.idNegocio:Core.Enums.eNegocio.BCV);a.divBotoneraSaldos=$(".div-botonera-saldos");a.divContainerMovimientos=$(".div-container-movimientos");a.divContainerMovimientos.hide();a.divMovimientos=$(".div-reporte-movimientos");a.txtFilter=$(".textbox-filter");a.txtDateFrom=$(".date-picker-from");a.txtDateTo=$(".date-picker-to");a.initControls();a.initGrid();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadControls()},a.namespace)})};a.initControls=function(){a.txtFilter.on("keydown",function(){clearTimeout(a.timeout);a.timeout=setTimeout(function(){value=a.txtFilter.val();var c=a.divMovimientos.swidget().dataSource;if(value){c.filter={or:[{path:"CUIL",filter:"contains",value:value},{path:"Descripcion",filter:"contains",value:value},{path:"Comitente",filter:"contains",value:value},{path:"Cuotapartista",filter:"contains",value:value},{path:"Importe",filter:"contains",value:value}]}}else{c.filter=null}c.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,(a.namespace+".txtFilter"));var b=new Date();b.setDate(b.getDate()-1);a.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:b,max:new Date(),events:{change:function(c){a.loadGrid()}}});a.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(c){a.loadGrid()}}})};a.loadControls=function(){var b={};b.idNegocio=a.idNegocio;var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"backoffice/extractos/saldos",requestType:"GET",requestData:b});c.onSuccess=function(d){a.divBotoneraSaldos.empty();d.saldos.forEach(function(g,e){var f=$("<label class='lblEstadoContador' style='background-color: transparent; margin: 8px 6px 8px 0; padding: 4px 5px; border: 1px solid #ccc;  font-weight: normal;' activo='false' idCuentaBancariaBalanz='"+g.idCuentaBancariaBalanz+"'>"+g.Descripcion+"<br/>"+g.Simbolo+": "+Core.Functions.grid.formatIntegerNumber(g.Saldo)+"<br/><span style='font-size: 13px;'>"+g.Fecha+"</span></label>").appendTo(a.divBotoneraSaldos);f.on("click",function(){a.setSaldo(f)})})};c.request()};a.setSaldo=function(c){var e=a.divBotoneraSaldos.find(".lblEstadoContador");for(var b=0;b<e.length;b++){var d=$(e[b]);d.css("background-color","transparent");d.attr("activo","false")}c.css("background-color","lightblue");c.attr("activo","true");a.selectedIdCuentaBancariaBalanz=c.attr("idCuentaBancariaBalanz");a.loadGrid()};a.initGrid=function(){var b=[];var c=[];b.push({width:"10%",field:"Fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});c.push("Fecha");b.push({width:"10%",field:"CUIL",title:"CUIL",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});c.push("CUIL");b.push({width:"40%",field:"Descripcion",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});c.push("Descripcion");b.push({width:"10%",field:"Importe",title:"Importe",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatPrice});c.push("Importe");b.push({width:"10%",field:"Saldo",title:"Saldo",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatPrice});c.push("Saldo");if(a.idNegocio==Core.Enums.eNegocio.BCV||a.idNegocio==Core.Enums.eNegocio.BCI){b.push({width:"10%",field:"Comitente",title:"Comitente",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});c.push("Comitente")}else{if(a.idNegocio==Core.Enums.eNegocio.BalanzCambio){b.push({width:"10%",field:"CuentaCambio",title:"Cuenta Cambio",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});c.push("CuentaCambio")}else{b.push({width:"10%",field:"Cuotapartista",title:"Cuotapartista",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});c.push("Cuotapartista")}}b.push({width:"10%",field:"FechaMovimiento",title:"Fecha Movimiento",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),format:Core.Functions.grid.formatUndefinedString});c.push("FechaMovimiento");c=c.concat(["Color","idExterno","SaldoCalculado","Referencia","DescripcionOperacion","DescripcionOperacion","TipoVinculacion","FechaCarga","FechaLote","OrdenLote","OrdenDiario","Actualizaciones"]);b.push({title:" ",width:50,headerAttributes:Core.Functions.grid.getHeaderAttribute(b.length),columnTemplate:function(e,f,g){if(f.Color){e.parent().css("background-color","rgba("+a.hexToRgb(f.Color)+((g%2==0)?", 0.6":", 1 ")+")")}var d=$('<button type="button" title="Detalles" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(e);d.on("click",function(){var i="";i+="<table class='table table-striped'>";i+="<thead><tr><th>Nombre</th><th>Valor</th></tr></thead>";i+="<tbody>";$.each(f,function(j,k){i+="<tr>";i+="<td>"+j+"</td>";i+="<td>"+k+"</td>";i+="</tr>"});i+="</tbody>";i+="</table>";var h=new Core.Controls.Dialog("Detalles de Movimiento",i,{displayButtons:{close:true,accept:false}});h.show()})}});a.divMovimientos.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:b,toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{fileName:"Movimientos",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:c,header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Movimientos"}}},paging:{pageSize:50,pageLinksCount:10}})};a.loadGrid=function(){if(a.selectedIdCuentaBancariaBalanz!=null){var b={};b.idNegocio=a.idNegocio;b.FechaDesde=Core.Functions.Date.getDateAsString(a.txtDateFrom.swidget().value());b.FechaHasta=Core.Functions.Date.getDateAsString(a.txtDateTo.swidget().value());var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"backoffice/extractos/movimientos/"+a.selectedIdCuentaBancariaBalanz,requestType:"GET",requestData:b});c.onSuccess=function(d){a.divContainerMovimientos.show();var e=a.divMovimientos.swidget().initialOptions;e.dataSource.data=d.movimientos;e.exportOptions.excel.dataSource.data=d.movimientos;e.exportOptions.excel.readDataSource=true;a.divMovimientos.swidget().refresh(e);a.txtFilter.keydown()};c.request()}};a.hexToRgb=function(d){d=d.replace("#","");var f=parseInt(d.substring(0,2),16);var e=parseInt(d.substring(2,4),16);var c=parseInt(d.substring(4,6),16);var h=f+","+e+","+c;return h}};Core.Business.ReporteOperacionesCambio=new function(){var b=this;var c=300000;var a=0;b.timerId=null;b.id="reporteOperacionesCambio";b.divContadoresDetalle=null;b.divOperacionesCambioDetalle=null;b.lblTitleDetalle=null;b.divOperacionesCambioResumen=null;b.lblTitleResumen=null;b.txtDateFrom=null;b.txtDateTo=null;b.txtFilter=null;b.chkIncluirFinalizados=null;b.chkRectificacion=null;b.timeout=null;b.loaded=false;b.lblPrecioCompra=null;b.lblPrecioVenta=null;b.btnRefresh=null;b.btnArchivoOpcam=null;b.pageOptions=null;b.divPrecios=null;b.dataDetalles=null;b.coloresActivos={};b.init=function(d,e){Core.loadPage("tesoreria-reporte-operaciones-cambio.html",function(){document.title="Reporte Operaciones Cambio";b.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(b.id,Core.Objects.Context.Profiles[e]);b.divOperacionesCambioDetalle=$(".div-operaciones-cambio-detalle");b.divContadoresDetalle=$(".div-detalle-contadores");b.divOperacionesCambioResumen=$(".div-operaciones-cambio-resumen");b.lblTitleDetalle=$(".label-title-detalle");b.lblTitleResumen=$(".label-title-resumen");b.txtDateFrom=$(".date-picker-from");b.txtDateTo=$(".date-picker-to");b.txtFilter=$(".textbox-filter");b.btnRefresh=$(".btn-refresh");b.btnArchivoOpcam=$(".btn-archivo-opcam");b.divPrecios=$(".div-precios");b.initDatePickers();b.initGrids();b.chkIncluirFinalizados=$(".checkbox-incluir-finalizados");b.chkIncluirFinalizados[0].checked=true;b.chkIncluirFinalizados.on("change",function(){b.loaded=false;b.loadGrids()});b.divPrecios.hide();if(b.pageOptions.editarPuntasCambio&&b.pageOptions.editarPuntasCambio==1){b.divPrecios.show()}b.chkRectificacion=$(".checkbox-rectificacion");b.chkRectificacion[0].checked=false;b.btnRefresh.on("click",function(){b.loaded=false;b.loadGrids()});b.btnArchivoOpcam.on("click",function(){function g(p){var o=new Blob([p.response],{type:p.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(o);return}var j=window.URL.createObjectURL(o);var n=document.createElement("a");n.href=j;var l=p.getResponseHeader("Content-Disposition").split("; ");var k="filename=reporte.xlsx";for(var m=0;m<l.length;m++){if(l[m].indexOf("filename")>=0){k=l[m]}}n.download=k.split("=")[1];n.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(j)}var f=new XMLHttpRequest();var h=Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"reporte/opcam/";h+=Core.Functions.Date.getDateAsString(b.txtDateTo.swidget().value())+"/";h+=(b.chkRectificacion[0].checked)?"1":"0";f.open("GET",h,true);f.responseType="blob";f.setRequestHeader("Authorization",Core.Objects.Context.Token);f.onload=function(i){if(f.status==200){g(f)}else{var j=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga del reporte.</p>",{displayButtons:{close:true,accept:false}});j.show()}};f.send()});b.lblPrecioCompra=$(".cotizacion-precio-compra");b.lblPrecioVenta=$(".cotizacion-precio-venta");b.header=new Core.Controls.Header($("#topNav"),{});b.header.init(false,d,e,b.loadGrids,"Core.Business.ReporteOperacionesCambio");b.timerId=window.setInterval(function(){b.loadGrids()},c);Core.Objects.Context.Timers.push(b.timerId)})};b.initDatePickers=function(){b.txtDateFrom.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(d){b.loaded=false;b.loadGrids()}}});b.txtDateTo.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date(),events:{change:function(d){b.loaded=false;b.loadGrids()}}})};b.initGrids=function(){b.divPrecios.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:[{field:"Nombre",width:"25%",title:"Origen",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{field:"PrecioCompra",width:"15%",title:"Precio Compra",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNuleablePrice},{field:"PrecioReferenciaCompra",width:"15%",title:"Precio Referencia Compra",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNuleablePrice},{field:"PrecioReferenciaVenta",width:"15%",title:"Precio Referencia Venta",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatNuleablePrice},{field:"PrecioVenta",width:"15%",title:"Precio Venta",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNuleablePrice},{field:"FechaUltimoOperado",width:"15%",title:"Fecha Ultimo Operado",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:50,title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(f,g,h){if(g.Seleccionada){f.parent().css("background-color","rgb(161, 234, 163)")}var e=$('<button type="button" title="Seleccionar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-check"></span></button>').appendTo(f);e.on("click",function(){if(g.idFuente==a){new Core.Business.ReporteOperacionesCambio.EditarPrecios({precioCompra:g.PrecioCompra,precioVenta:g.PrecioVenta,precioReferenciaCompra:g.PrecioReferenciaCompra,precioReferenciaVenta:g.PrecioReferenciaVenta,onConfirm:function(i,l,j,k){b.actualizarValores(e,a,i,l,j,k)}}).show()}else{b.actualizarValores(e,g.idFuente,g.PrecioCompra,g.PrecioVenta,g.PrecioReferenciaCompra,g.PrecioReferenciaVenta)}})}}]});b.divOperacionesCambioResumen.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:[{field:"Instrumento",title:"Instrumento",width:"10%",headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"CantidadOperaciones",title:"Operaciones",width:"10%",headerAttributes:Core.Functions.grid.getCellOddClass(),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatIntegerNumber},{field:"TotalOperado",title:"Total Operado",width:"10%",headerAttributes:Core.Functions.grid.getCellEvenClass(),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatPrice},{field:"Comprado",title:"Comprado",width:"10%",headerAttributes:Core.Functions.grid.getCellOddClass(),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatPrice},{field:"PPC",title:"PPC",width:"10%",headerAttributes:Core.Functions.grid.getCellEvenClass(),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatPrice},{field:"Vendido",title:"Vendido",width:"10%",headerAttributes:Core.Functions.grid.getCellOddClass(),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatPrice},{field:"PPV",title:"PPV",width:"10%",headerAttributes:Core.Functions.grid.getCellEvenClass(),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatPrice},{field:"Neto",title:"Neto",width:"10%",headerAttributes:Core.Functions.grid.getCellOddClass(),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatPrice},{field:"PPNeto",title:"PPNeto",width:"10%",headerAttributes:Core.Functions.grid.getCellEvenClass(),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatPrice},{field:"Moneda",title:"Moneda",width:"10%",headerAttributes:Core.Functions.grid.getCellOddClass()}]});b.txtFilter.on("keydown",function(){clearTimeout(b.timeout);b.timeout=setTimeout(function(){value=b.txtFilter.val();var e=b.divOperacionesCambioDetalle.swidget().dataSource;if(value){e.filter={or:[{path:"NumComitente",filter:"contains",value:value},{path:"DescripcionCuenta",filter:"contains",value:value},{path:"Instrumento",filter:"contains",value:value},{path:"Observaciones",filter:"contains",value:value},{path:"Estado",filter:"contains",value:value},{path:"idOrden",filter:"contains",value:value},{path:"Secuencia",filter:"contains",value:value}]}}else{e.filter=null}e.read()},50)});Core.Functions.Persistence.setTextBox(b.txtFilter,"Core.Business.ReporteOperacionesCambio.txtFilter");var d=[];d.push({field:"idOrden",title:"Orden",width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),columnTemplate:function(e,f,g){e.html(f.idOrden);if(f.Color!=""){e.parent().css("background-color","rgba("+b.hexToRgb(f.Color)+((g%2==0)?", 0.6":", 1 ")+")")}}});d.push({field:"Secuencia",title:"Secuencia",width:"7%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});d.push({field:"Fecha",title:"Concertación",width:"8%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});d.push({field:"Hora",title:"Hora",width:"6%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});d.push({field:"Liquidacion",title:"Liquidación",width:"8%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});d.push({field:"NumComitente",title:"Comitente",width:"7%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});d.push({field:"DescripcionCuenta",title:"Descripción",width:"28%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});d.push({field:"NombreOperacion",title:"Nombre Operación",width:"10%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});d.push({field:"Instrumento",title:"Instrumento",width:"7%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});d.push({field:"Cantidad",title:"Cantidad",width:"7%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatPrice});d.push({field:"Precio",title:"Precio",width:"7%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatPrice});d.push({field:"Monto",title:"Monto",width:"7%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatPrice});d.push({field:"Moneda",title:"Moneda",width:"6%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});d.push({title:"Obs.",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),columnTemplate:function(e,f,g){if(f.Observaciones){var h=(f.length>140)?(f.Observaciones.substr(0,140)+"..."):(f.Observaciones);e.html('<button type="button" title="'+h+'" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>');e.addClass("link-cell");e.on("click",function(){var i=new Core.Controls.Dialog("Observaciones",(f.Observaciones)?f.Observaciones:"",{displayButtons:{close:true,accept:false}});i.show()})}}});d.push({field:"Estado",title:"Estado",width:"6%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});d.push({field:"idExterno",title:"idExterno",width:"7%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length)});b.divOperacionesCambioDetalle.shieldGrid({dataSource:{data:[]},toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],paging:{pageSize:100,pageLinksCount:10},exportOptions:{excel:{fileName:"Reporte Operaciones Cambio",dataSource:{data:[]},author:"Balanz Capital Valores S.A.",columnFields:["idOrden","Secuencia","Fecha","Hora","Liquidacion","NumComitente","DescripcionCuenta","NombreOperacion","Instrumento","Cantidad","Precio","Monto","Moneda","Observaciones","Estado","idExterno"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Reporte Operaciones Cambio"}}},selection:false,rowHover:false,sorting:{multiple:true},columns:d})};b.loadGrids=function(){b.lblTitleDetalle.text("Detalles - entre el "+Core.Functions.Date.getDisplayDate(b.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(b.txtDateTo.swidget().value()));b.lblTitleResumen.text("Resumen - entre el "+Core.Functions.Date.getDisplayDate(b.txtDateFrom.swidget().value())+" al "+Core.Functions.Date.getDisplayDate(b.txtDateTo.swidget().value()));var d;d="FechaDesde="+encodeURIComponent(Core.Functions.Date.getDateAsString(b.txtDateFrom.swidget().value()));d+="&FechaHasta="+encodeURIComponent(Core.Functions.Date.getDateAsString(b.txtDateTo.swidget().value()));d+=("&incluirFinalizados="+((b.chkIncluirFinalizados[0].checked)?"1":"0"));var e=new Core.Ajax.ServerRequest({showOverlay:!b.loaded,secureRequest:true,requestUrl:"reporte/operacionescambio",requestType:"GET",requestData:d});e.onSuccess=function(g){b.lblPrecioCompra.text("$ "+Core.Functions.grid.formatPrice((!g.cotizacion[0].PrecioCompra)?0:g.cotizacion[0].PrecioCompra));b.lblPrecioVenta.text("$ "+Core.Functions.grid.formatPrice((!g.cotizacion[0].PrecioVenta)?0:g.cotizacion[0].PrecioVenta));var h=b.divOperacionesCambioResumen.swidget().initialOptions;h.dataSource.data=g;h.dataSource.schema={data:"resumen"};b.divOperacionesCambioResumen.swidget().refresh(h);var i=b.divPrecios.swidget().initialOptions;i.dataSource.data=g.fuentes;b.divPrecios.swidget().refresh(i);var f=[];g.detalle.forEach(function(k,j){if(f.indexOf(k.Color)==-1){f.push(k.Color)}});f.sort(function(j,k){if(j>k){return 1}else{return -1}});b.divContadoresDetalle.empty();$('<label style="width:75px;" class="text-center">Total: '+g.detalle.length+"</label>").appendTo(b.divContadoresDetalle);f.forEach(function(l,k){var j=$.grep(g.detalle,function(p,n){return p.Color==l});var m=$('<label class="text-center lblColorContador" color="'+l+'" activo="'+((b.coloresActivos[l]==false)?"false":"true")+'" style="color: #2d2d2d !important; border-radius:4px; margin-right:3px; width:75px; border: 4px solid '+(l?l:"transparent")+"; background-color:"+((b.coloresActivos[l]==false)?"#c4c4c4":l)+';">'+j.length+"</label>").appendTo(b.divContadoresDetalle);if(b.coloresActivos[l]==null){b.coloresActivos[l]=true}m.on("click",function(){b.setColor(m)})});b.dataDetalles=g.detalle;b.refreshGridDetalles();b.loaded=true};e.request()};b.refreshGridDetalles=function(){var e=$.grep(b.dataDetalles,function(k,j){return true});var d=$(".lblColorContador");for(var f=0;f<d.length;f++){var h=$(d[f]);if(h.attr("activo")=="false"){e=$.grep(e,function(k,j){return k.Color!=h.attr("color")})}}var g=b.divOperacionesCambioDetalle.swidget().initialOptions;g.dataSource.data=e;g.exportOptions.excel.dataSource.data=e;g.exportOptions.excel.readDataSource=true;b.divOperacionesCambioDetalle.swidget().refresh(g);b.txtFilter.keydown()};b.setColor=function(d){if(d.attr("activo")=="true"){d.css("background-color","#c4c4c4");d.attr("activo","false");b.coloresActivos[d.attr("color")]=false}else{d.css("background-color",d.attr("color"));d.attr("activo","true");b.coloresActivos[d.attr("color")]=true}b.refreshGridDetalles()};b.actualizarValores=function(d,e,f,i,g,h){var j={};j.idFuente=e;j.PrecioCompra=(f)?f:0;j.PrecioVenta=(i)?i:0;j.PrecioReferenciaCompra=(g)?g:0;j.PrecioReferenciaVenta=(h)?h:0;var k=new Core.Ajax.ServerRequest({overlayElement:d,showOverlay:true,secureRequest:true,requestUrl:"cotizacionfuentes",requestType:"POST",requestData:j});k.onSuccess=function(l){b.loaded=false;b.loadGrids()};k.request()};b.hexToRgb=function(e){e=e.replace("#","");var h=parseInt(e.substring(0,2),16);var f=parseInt(e.substring(2,4),16);var d=parseInt(e.substring(4,6),16);var i=h+","+f+","+d;return i}};Core.Business.ReporteOperacionesCambio.EditarPrecios=function(b){var a=this;a.divModal=$(".div-modal-editar-precios");a.decimalCount=4;a.txtPrecioCompra=null;a.txtPrecioReferenciaCompra=null;a.txtPrecioReferenciaVenta=null;a.txtPrecioVenta=null;a.btnConfirmar=null;a.onConfirm=function(c,f,d,e){};a.precioCompra="";a.precioVenta="";a.precioReferenciaCompra="";a.precioReferenciaVenta="";$.extend(true,a,b);a.show=function(){a.txtPrecioCompra=$(".textbox-precio-compra");a.txtPrecioReferenciaCompra=$(".textbox-precio-referencia-compra");a.txtPrecioReferenciaVenta=$(".textbox-precio-referencia-venta");a.txtPrecioVenta=$(".textbox-precio-venta");a.btnConfirmar=$(".btn-confirmar");a.initControls();a.divModal.modal({show:true})};a.initControls=function(){new Core.Controls.DecimalPicker(a.txtPrecioCompra,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:a.precioCompra});Core.Functions.Validations.toggleValidation(a.txtPrecioCompra,false);new Core.Controls.DecimalPicker(a.txtPrecioReferenciaCompra,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:a.precioReferenciaCompra});Core.Functions.Validations.toggleValidation(a.txtPrecioReferenciaCompra,false);new Core.Controls.DecimalPicker(a.txtPrecioReferenciaVenta,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:a.precioReferenciaVenta});Core.Functions.Validations.toggleValidation(a.txtPrecioReferenciaVenta,false);new Core.Controls.DecimalPicker(a.txtPrecioVenta,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:a.precioVenta});Core.Functions.Validations.toggleValidation(a.txtPrecioVenta,false);a.btnConfirmar.unbind("click");a.btnConfirmar.on("click",function(){Core.Functions.Validations.toggleValidation(a.txtPrecioCompra,false);Core.Functions.Validations.toggleValidation(a.txtPrecioVenta,false);Core.Functions.Validations.toggleValidation(a.txtPrecioReferenciaCompra,false);Core.Functions.Validations.toggleValidation(a.txtPrecioReferenciaVenta,false);if(!a.txtPrecioCompra.val()){Core.Functions.Validations.toggleValidation(a.txtPrecioCompra,true);return}if(!a.txtPrecioReferenciaCompra.val()){Core.Functions.Validations.toggleValidation(a.txtPrecioReferenciaCompra,true);return}if(!a.txtPrecioReferenciaVenta.val()){Core.Functions.Validations.toggleValidation(a.txtPrecioReferenciaVenta,true);return}if(!a.txtPrecioVenta.val()){Core.Functions.Validations.toggleValidation(a.txtPrecioVenta,true);return}var c=Core.Functions.Decimal.parseFloat(a.txtPrecioCompra.val());var f=Core.Functions.Decimal.parseFloat(a.txtPrecioVenta.val());var d=Core.Functions.Decimal.parseFloat(a.txtPrecioReferenciaCompra.val());var e=Core.Functions.Decimal.parseFloat(a.txtPrecioReferenciaVenta.val());var g="";if(c>d){g+=(((g=="")?"":"<br />")+"El Precio Compra es mayor al Precio de Referencia Compra.")}if(d>e){g+=(((g=="")?"":"<br />")+"El Precio de Referencia Compra es mayor al Precio de Referencia Venta.")}if(e>f){g+=(((g=="")?"":"<br />")+"El Precio de Referencia Venta es mayor al Precio de Venta.")}if(c<10||f<10||d<10||e<10){g+=(((g=="")?"":"<br />")+"Alguno de los precios es demasiado bajo.")}if(c>100||f>100||d>100||e>100){g+=(((g=="")?"":"<br />")+"Alguno de los precios es demasiado alto.")}if(g!=""){new Core.Controls.Confirmation("Confirmación",g+"<br />¿Está seguro que desea continuar?",{onAccepted:function(){a.onConfirm(c,f,d,e);a.divModal.modal("hide")}}).show()}else{a.onConfirm(c,f,d,e);a.divModal.modal("hide")}})}};Core.Business.ReporteOperacionesRentas=new function(){var a=this;var b=300000;a.id="tesoreriaReporteOperacionesRentas";a.txtFilter=null;a.timeoutFilter=null;a.divOperaciones=null;a.btnRefresh=null;a.loaded=false;a.timerId=null;a.window=$(window);a.init=function(c,d){Core.loadPage("tesoreria-reporte-operaciones-rentas.html",function(){document.title="Operaciones Rentas";a.divOperaciones=$(".div-operaciones");a.txtFilter=$(".textbox-filter");a.btnRefresh=$(".btn-refresh");a.initFilter();a.initGrid();a.initButtons();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,c,d,a.loadGrid,"Core.Business.ReporteOperacionesRentas");a.timerId=window.setInterval(function(){a.loadGrid()},b);Core.Objects.Context.Timers.push(a.timerId)})};a.initButtons=function(){a.btnRefresh.click(function(){a.loaded=false;a.loadGrid()})};a.initFilter=function(){a.txtFilter.on("keydown",function(){clearTimeout(a.timeoutFilter);a.timeoutFilter=setTimeout(function(){value=a.txtFilter.val();var c=a.divOperaciones.swidget().dataSource;if(value){c.filter={or:[{path:"idCuenta",filter:"contains",value:value},{path:"Comitente",filter:"contains",value:value},{path:"Cuenta",filter:"contains",value:value}]}}else{c.filter=null}c.read()},50)});Core.Functions.Persistence.setTextBox(a.txtFilter,"Core.Business.ReporteOperacionesRentas.txtFilter")};a.initGrid=function(){a.divOperaciones.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:[{width:"7%",field:"idCuenta",title:"ID Cuenta",headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"7%",field:"Comitente",title:"Comitente",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"26%",field:"Cuenta",title:"Cuenta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"10%",field:"DolaresMEP",title:"Dólares MEP",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatPrice},{width:"10%",field:"DolaresCable",title:"Dólares Cable",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatPrice},{width:"10%",field:"DolaresCV10000",title:"Dólares CV10000",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatPrice},{width:"10%",field:"DolaresCV7000",title:"Dólares CV7000",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatPrice},{width:"10%",field:"OperadoCI",title:"Operado CI",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatPrice},{width:"10%",field:"Operado24",title:"Operado 24",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatPrice},{width:"10%",field:"Operado48",title:"Operado 48",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatPrice},{width:"10%",field:"OperadoFut",title:"Operado Futuro",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatPrice}],toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Operaciones Rentas",columnFields:["idCuenta","Comitente","Cuenta","DolaresMEP","DolaresCable","DolaresCV10000","DolaresCV7000","OperadoCI","Operado24","Operado48","OperadoFut"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Operaciones Rentas"}}}})};a.loadGrid=function(){var c=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,overlayElement:a.divOperaciones.parent(),secureRequest:true,requestUrl:"reporte/operacionesrenta",requestType:"GET"});c.onSuccess=function(d){var f=a.window.scrollTop();var e=a.divOperaciones.swidget().initialOptions;e.dataSource.data=d.detalle;e.dataSource.sort=a.divOperaciones.swidget().dataSource.sort;e.dataSource.group=a.divOperaciones.swidget().dataSource.group;e.exportOptions.excel.dataSource.data=d.detalle;e.exportOptions.excel.readDataSource=true;a.divOperaciones.swidget().refresh(e);a.txtFilter.keydown();a.window.scrollTop(f);a.loaded=true};c.request()}};Core.Business.TestInversorCuestionario=new function(){var a=this;a.id="testInversorCuestionario";a.lblPregunta=null;a.divRespuestas=null;a.btnReiniciarTest=null;a.btnContinuar=null;a.idCuenta=null;a.idPersona=null;a.token=null;a.header=null;a.init=function(b,c,d){Core.loadPage("test-inversor-cuestionario.html",function(){a.idDefaultAccount=b;a.idDefaultProfile=c;$(".default-modal").modal("hide");document.title="Perfil del Inversor";a.lblPregunta=$(".lbl-cuestionatio-pregunta");a.divRespuestas=$(".div-cuestionario-respuestas");a.btnReiniciarTest=$(".btn-reiniciar-test");a.btnContinuar=$(".btn-continuar");a.idCuenta=null;a.idPersona=null;a.token=null;$.extend(true,a,d);a.setControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,b,c,function(){a.initCuestionario()},"Core.Business.TestInversorCuestionario",d)})};a.setControls=function(){a.btnContinuar.on("click",function(){var b=a.getOptionSelected();if(!b){new Core.Controls.Dialog("Aviso","Debe seleccionar una opción.",{displayButtons:{close:true,accept:false}}).show()}else{var c=new Core.Ajax.ServerRequest({overlayElement:a.btnContinuar,secureRequest:true,requestUrl:"testinversor/"+a.token,requestType:"POST",requestData:{idRespuesta:b}});c.onSuccess=function(f){if(f.perfil&&f.perfil!=""){if(Core.Objects.Context.TestInversor){if(a.idPersona){Core.Objects.Context.TestInversor.personal[0].idPerfil=f.idperfil}else{for(var e=0;e<Core.Objects.Context.TestInversor.juridicas.length;e++){var d=Core.Objects.Context.TestInversor.juridicas[e];if(d.idCuenta==a.idCuenta){d.idPerfil=f.idperfil;break}}}if(!Core.Functions.Validations.isBlockedStorage()&&Core.Functions.Persistence.getStorage()){Core.Functions.Persistence.getStorage().setItem("CoreContext",LZString.compressToUTF16(JSON.stringify(Core.Objects.Context)))}}Core.Business.TestInversorResultado.init(a.idDefaultAccount,a.idDefaultProfile,{idCuenta:a.idCuenta,idPersona:a.idPersona})}else{a.token=f.token;a.loadQuestion(f.testInversor)}};c.request()}});a.btnReiniciarTest.on("click",function(){Core.Business.TestInversorCuestionario.init(a.idDefaultAccount,a.idDefaultProfile,{idCuenta:a.idCuenta,idPersona:a.idPersona})})};a.initCuestionario=function(){var b={};if(a.idCuenta){b.idCuenta=a.idCuenta}if(a.idPersona){b.idPersona=a.idPersona}var c=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"testinversor",requestType:"POST",requestData:b});c.onSuccess=function(d){a.token=d.token;a.loadQuestion(d.testInversor)};c.request()};a.loadQuestion=function(b){a.lblPregunta.text(b.pregunta);a.divRespuestas.empty();for(var d=0;d<b.respuestas.length;d++){var g=b.respuestas[d];var c=$('<div class="col-md-12 col-sm-12 col-xs-12 mb-1" />').appendTo(a.divRespuestas);var f=$('<label class="container-test-inversor" />').appendTo(c);var j=$("<span>"+g.respuesta+"</span>").appendTo(f);var e=$('<input class="check-option-respuesta" type="radio" name="option-respuesta" idRespuesta="'+g.idrespuesta+'" />').appendTo(f);var h=$('<span class="checkmark" />').appendTo(f)}};a.getOptionSelected=function(){var d=$(".check-option-respuesta");for(var b=0;b<d.length;b++){var c=$(d[b]);if(c[0].checked){return c.attr("idRespuesta")}}return null}};Core.Business.TestInversorNotificacion=new function(){var a=this;a.init=function(c,d){if(Core.Objects.Context.TestInversor){var b=(Core.Objects.Context.TestInversor.juridicas)?$.grep(Core.Objects.Context.TestInversor.juridicas,function(g,f){return !g.EsCalificada}):[];if(b.length>0){Core.Business.TestInversorSeleccion.init(c,d)}else{if(Core.Objects.Context.TestInversor.personal[0].idPerfil&&Core.Objects.Context.TestInversor.personal[0].idPerfil!=Core.Enums.eTestInversorPerfil.Error){var e={idPersona:Core.Objects.Context.TestInversor.personal[0].idPersona};Core.Business.TestInversorResultado.init(c,d,e)}else{var e={idPersona:Core.Objects.Context.TestInversor.personal[0].idPersona};Core.Business.TestInversorCuestionario.init(c,d,e)}}}}};Core.Business.TestInversorResultado=new function(){var a=this;a.id="testInversorResultado";a.header=null;a.lblTipoInversor=null;a.imgTipoInversor=null;a.lblTipoInversorDescripcion=null;a.lblTipoInversorDetalles=null;a.divChartComposicion=null;a.chartComposicion=null;a.btnReiniciarTest=null;a.idCuenta=null;a.idPersona=null;a.iconsTestInversorByPerfil=["/images/noimage.png","/images/conservador.png","/images/moderado.png","/images/agresivo.png","/images/noimage.png","/images/muyagresivo.png","/images/calificado.png"];a.init=function(b,c,d){Core.loadPage("test-inversor-resultado.html",function(){a.idDefaultAccount=b;a.idDefaultProfile=c;$(".default-modal").modal("hide");document.title="Perfil del Inversor";a.lblTipoInversor=$(".lbl-tipo-inversor");a.imgTipoInversor=$(".img-tipo-inversor");a.lblTipoInversorDescripcion=$(".lbl-tipo-inversor-descripcion");a.lblTipoInversorDetalles=$(".lbl-tipo-inversor-detalles");a.lblFechaTest=$(".lbl-fecha-actual");a.btnReiniciarTest=$(".btn-reiniciar-test");a.idCuenta=null;a.idPersona=null;$.extend(true,a,d);a.setControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,b,c,function(){a.loadTestResult()},"Core.Business.TestInversorResultado",d)})};a.setControls=function(){a.btnReiniciarTest.on("click",function(){Core.Business.TestInversorCuestionario.init(a.idDefaultAccount,a.idDefaultProfile,{idCuenta:a.idCuenta,idPersona:a.idPersona})})};a.loadTestResult=function(){var b=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"testinversor/"+((a.idCuenta)?("cuenta?idCuenta="+encodeURIComponent(a.idCuenta)):("persona?idPersona="+encodeURIComponent(a.idPersona))),requestType:"GET"});b.onSuccess=function(c){a.lblTipoInversor.text(c.perfil);a.imgTipoInversor.attr("src",a.iconsTestInversorByPerfil[c.idperfil]);a.lblTipoInversorDescripcion.text(c.respuesta);a.lblFechaTest.text("(Realizado el: "+c.fecha+")");a.lblTipoInversorDetalles.text("["+c.perfil+"]")};b.request()}};Core.Business.TestInversorSeleccion=new function(){var a=this;a.id="testInversorSeleccion";a.divTests=null;a.btnContinuar=null;a.header=null;a.init=function(b,c){Core.loadPage("test-inversor-seleccion.html",function(){a.idDefaultAccount=b;a.idDefaultProfile=c;document.title="Perfil del Inversor";a.divTests=$(".div-seleccion-test");a.btnContinuar=$(".btn-continuar");a.setControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,b,c,function(){},"Core.Business.TestInversorSeleccion")})};a.setControls=function(){a.btnContinuar.on("click",function(){var i=a.getOptionSelected();if(!i){new Core.Controls.Dialog("Aviso","Debe seleccionar una opción.",{displayButtons:{close:true,accept:false}}).show()}else{var k=null;if(i.idPersona){k=Core.Objects.Context.TestInversor.personal[0]}else{k=$.grep(Core.Objects.Context.TestInversor.juridicas,function(m,l){return m.idCuenta==i.idCuenta})[0]}if(k&&k.idPerfil&&k.idPerfil!=Core.Enums.eTestInversorPerfil.Error){Core.Business.TestInversorResultado.init(a.idDefaultAccount,a.idDefaultProfile,i)}else{Core.Business.TestInversorCuestionario.init(a.idDefaultAccount,a.idDefaultProfile,i)}}});a.divTests.empty();var g=Core.Objects.Context.TestInversor.personal[0];var c=$('<div class="col-md-12 col-sm-12 col-xs-12 mb-1" />').appendTo(a.divTests);var f=$('<label class="container-test-inversor" />').appendTo(c);var j=$("<span>"+g.Descripcion+"</span>").appendTo(f);var e=$('<input class="check-option-test" type="radio" name="option-test" idPersona="'+g.idPersona+'" />').appendTo(f);var h=$('<span class="checkmark" />').appendTo(f);for(var d=0;d<Core.Objects.Context.TestInversor.juridicas.length;d++){var b=Core.Objects.Context.TestInversor.juridicas[d];if(!b.EsCalificada){var c=$('<div class="col-md-12 col-sm-12 col-xs-12 mb-1" />').appendTo(a.divTests);var f=$('<label class="container-test-inversor" />').appendTo(c);var j=$("<span>"+b.Descripcion+"</span>").appendTo(f);var e=$('<input class="check-option-test" type="radio" name="option-test" idCuenta="'+b.idCuenta+'" />').appendTo(f);var h=$('<span class="checkmark" />').appendTo(f)}}};a.getOptionSelected=function(){var d=$(".check-option-test");for(var b=0;b<d.length;b++){var c=$(d[b]);if(c[0].checked){return{idPersona:c.attr("idPersona"),idCuenta:c.attr("idCuenta")}}}return null}};Core.Business.TradingAvanzado=new function(){var a=this;var b=60000;a.id="tradingAvanzado";a.idDefaultAccount=null;a.idDefaultProfile=null;a.estadosFiltro=["Pendiente","En Ejecución","Ejecutada","Cancelada","Otros"];a.ticker=null;a.panel=null;a.securityID=null;a.verProfundidad=null;a.tickerHistorico=null;a.plazoHistorico=null;a.plazo=null;a.loaded=false;a.loadedInstrumento=false;a.divBuscadorInstrumento=null;a.ddlBuscadorInstrumento=null;a.lastDataCotizacionInstrumento=null;a.divDetalleInstrumento=null;a.btnDetalleInstrumentoAddWatchlistItem=null;a.btnDetalleInstrumentoDeleteWatchlistItem=null;a.btnDetalleInstrumentoHistorico=null;a.btnDetalleInstrumentoIntradiario=null;a.btnDetalleInstrumentoOperaciones=null;a.btnDetalleSelected=null;a.divDetalleInstrumentoHistorico=null;a.divDetalleInstrumentoIntradiario=null;a.chartDetalleInstrumentoIntradiario=null;a.chartDetalleInstrumentoHistorico=null;a.divDetalleInstrumentoOperacionesContainer=null;a.divDetalleInstrumentoOperaciones=null;a.divDetalleInstrumentoIntradiarioVacio=null;a.lblDetalleInstrumentoDescripcion=null;a.lblDetalleInstrumentoFecha=null;a.lblDetalleInstrumentoApertura=null;a.lblDetalleInstrumentoVolumen=null;a.lblDetalleInstrumentoCierreAnterior=null;a.lblDetalleInstrumentoMaximo=null;a.lblDetalleInstrumentoMinimo=null;a.lblDetalleInstrumentoVariacion=null;a.divDetalleInstrumentoCompraVentaProfundidad=null;a.lblDetalleInstrumentoProfundidad1=null;a.lblDetalleInstrumentoProfundidad2=null;a.lblDetalleInstrumentoProfundidad3=null;a.lblDetalleInstrumentoProfundidad4=null;a.lblDetalleInstrumentoProfundidad5=null;a.lblDetalleInstrumentoProfundidad1CompraCantidad=null;a.lblDetalleInstrumentoProfundidad2CompraCantidad=null;a.lblDetalleInstrumentoProfundidad3CompraCantidad=null;a.lblDetalleInstrumentoProfundidad4CompraCantidad=null;a.lblDetalleInstrumentoProfundidad5CompraCantidad=null;a.lblDetalleInstrumentoProfundidad1VentaCantidad=null;a.lblDetalleInstrumentoProfundidad2VentaCantidad=null;a.lblDetalleInstrumentoProfundidad3VentaCantidad=null;a.lblDetalleInstrumentoProfundidad4VentaCantidad=null;a.lblDetalleInstrumentoProfundidad5VentaCantidad=null;a.lblDetalleInstrumentoProfundidad1CompraPrecio=null;a.lblDetalleInstrumentoProfundidad2CompraPrecio=null;a.lblDetalleInstrumentoProfundidad3CompraPrecio=null;a.lblDetalleInstrumentoProfundidad4CompraPrecio=null;a.lblDetalleInstrumentoProfundidad5CompraPrecio=null;a.lblDetalleInstrumentoProfundidad1VentaPrecio=null;a.lblDetalleInstrumentoProfundidad2VentaPrecio=null;a.lblDetalleInstrumentoProfundidad3VentaPrecio=null;a.lblDetalleInstrumentoProfundidad4VentaPrecio=null;a.lblDetalleInstrumentoProfundidad5VentaPrecio=null;a.chkDetalleInstrumentoPlazoCI=null;a.chkDetalleInstrumentoPlazo24=null;a.chkDetalleInstrumentoPlazo48=null;a.timerIdCotizacionIntradiario=null;a.executeCotizacionIntradiario=false;a.timerIdCotizacionInstrumento=null;a.executeCotizacionInstrumento=false;a.ddlWatchlists=null;a.divWatchlistItems=null;a.maxTokenWatchlist=0;a.watchlistItems=null;a.forceRefreshWatchlist=false;a.timerIdForceRefreshWatchlist=null;a.refreshWatchlist=false;a.timerIdWatchlist=null;a.divOrdenes=null;a.btnRefreshOrdenes=null;a.txtFilterOrdenes=null;a.chkSoloPropias=null;a.divOrdenesEstados=null;a.timeoutFilterOrdenes=null;a.ordenes=null;a.eTipoOrden={Market:1,Limit:2,StopMerval:3,StopLimit:4,Stop:"z",MarketWithLeftOverAsLimit:"K"};a.eVencimientoOrden={GoodTillDate:6};a.selectedAccount=null;a.btnOperarInstrumentoVenderLimit=null;a.btnOperarInstrumentoVenderMkt=null;a.btnOperarInstrumentoVenderOffer=null;a.btnOperarInstrumentoComprarLimit=null;a.btnOperarInstrumentoComprarMkt=null;a.btnOperarInstrumentoComprarBid=null;a.divOperarInstrumento=null;a.ddlOperarInstrumentoCuentas=null;a.divOperarInstrumentoDisponible=null;a.lblOperarInstrumentoDisponible=null;a.divOperarInstrumentoFix=null;a.divOperarInstrumentoReplacePreviousOrders=null;a.chkOperarInstrumentoReplacePreviousOrders=null;a.divOperarInstrumentoCancelInDisconnection=null;a.chkOperarInstrumentoCancelInDisconnection=null;a.divOperarInstrumentoTipoOrden=null;a.ddlOperarInstrumentoTipoOrden=null;a.divOperarInstrumentoVencimientoOrden=null;a.ddlOperarInstrumentoVencimientoOrden=null;a.divOperarInstrumentoPrecioStop=null;a.txtOperarInstrumentoPrecioStop=null;a.divOperarInstrumentoFechaVencimiento=null;a.txtOperarInstrumentoFechaVencimiento=null;a.txtOperarInstrumentoValorCantidad=null;a.txtOperarInstrumentoValorPrecio=null;a.divOperarInstrumentoTotal=null;a.lblOperarInstrumentoTotal=null;a.divOperarInstrumentoMargenRequerido=null;a.lblOperarInstrumentoMargenRequerido=null;a.chkOperarInstrumentoCantidadAMostrar=null;a.txtOperarInstrumentoCantidadAMostrar=null;a.divOperarInstrumentoCantidadAMostrar=null;a.btnOperarInstrumentoContinuar=null;a.defaultTipoOperacion=null;a.defaultEspecie=null;a.disponibleActual=null;a.detalleDisponible=null;a.pageOptions=null;a.operarOptions=null;a.init=function(c,d){Core.loadPage("trading-avanzado.html",function(){document.title="Trading Avanzado";a.idDefaultAccount=c;a.idDefaultProfile=d;a.loaded=false;a.loadedInstrumento=false;a.ddlWatchlists=$(".dropdown-watchlists");a.divWatchlistItems=$(".div-watchlist-items");a.maxTokenWatchlist=0;a.refreshWatchlist=false;a.forceRefreshWatchlist=false;a.timerIdWatchlist=null;a.timerIdForceRefreshWatchlist=null;a.divOrdenes=$(".div-ordenes");a.txtFilterOrdenes=$(".textbox-filter-ordenes");a.chkSoloPropias=$(".checkbox-solo-propias");a.divOrdenesEstados=$(".div-ordenes-estados");a.btnRefreshOrdenes=$(".btn-refresh-ordenes");a.divDetalleInstrumento=$(".div-detalle-instrumento");a.divDetalleInstrumento.hide();a.btnDetalleInstrumentoAddWatchlistItem=$(".btn-add-watchlist-item");a.btnDetalleInstrumentoDeleteWatchlistItem=$(".btn-delete-watchlist-item");a.btnDetalleInstrumentoHistorico=$(".btn-detalle-instrumento-historico");a.btnDetalleInstrumentoIntradiario=$(".btn-detalle-instrumento-intradiario");a.btnDetalleInstrumentoOperaciones=$(".btn-detalle-instrumento-operaciones");a.divDetalleInstrumentoHistorico=$(".div-detalle-instrumento-historico");a.divDetalleInstrumentoIntradiario=$(".div-detalle-instrumento-intradiario");a.divDetalleInstrumentoIntradiarioVacio=$(".div-detalle-instrumento-intradiario-vacio");a.divDetalleInstrumentoOperacionesContainer=$(".div-detalle-instrumento-operaciones-container");a.divDetalleInstrumentoOperaciones=$(".div-detalle-instrumento-operaciones");a.lblDetalleInstrumentoDescripcion=$(".lbl-detalle-instrumento-descripcion");a.lblDetalleInstrumentoFecha=$(".lbl-detalle-instrumento-fecha");a.lblDetalleInstrumentoApertura=$(".lbl-detalle-instrumento-apertura");a.lblDetalleInstrumentoVolumen=$(".lbl-detalle-instrumento-volumen");a.lblDetalleInstrumentoCierreAnterior=$(".lbl-detalle-instrumento-cierre-anterior");a.lblDetalleInstrumentoMaximo=$(".lbl-detalle-instrumento-maximo");a.lblDetalleInstrumentoMinimo=$(".lbl-detalle-instrumento-minimo");a.lblDetalleInstrumentoUltimoOperado=$(".lbl-detalle-instrumento-ultimo-operado");a.divDetalleInstrumentoCompraVentaProfundidad=$(".div-detalle-instrumento-compra-venta-profundidad");a.lblDetalleInstrumentoVariacion=$(".lbl-detalle-instrumento-variacion");a.lblDetalleInstrumentoProfundidad1=$(".lbl-detalle-instrumento-profundidad-1");a.lblDetalleInstrumentoProfundidad2=$(".lbl-detalle-instrumento-profundidad-2");a.lblDetalleInstrumentoProfundidad3=$(".lbl-detalle-instrumento-profundidad-3");a.lblDetalleInstrumentoProfundidad4=$(".lbl-detalle-instrumento-profundidad-4");a.lblDetalleInstrumentoProfundidad5=$(".lbl-detalle-instrumento-profundidad-5");a.lblDetalleInstrumentoProfundidad1CompraCantidad=$(".lbl-detalle-instrumento-profundidad-1-compra-cantidad");a.lblDetalleInstrumentoProfundidad2CompraCantidad=$(".lbl-detalle-instrumento-profundidad-2-compra-cantidad");a.lblDetalleInstrumentoProfundidad3CompraCantidad=$(".lbl-detalle-instrumento-profundidad-3-compra-cantidad");a.lblDetalleInstrumentoProfundidad4CompraCantidad=$(".lbl-detalle-instrumento-profundidad-4-compra-cantidad");a.lblDetalleInstrumentoProfundidad5CompraCantidad=$(".lbl-detalle-instrumento-profundidad-5-compra-cantidad");a.lblDetalleInstrumentoProfundidad1VentaCantidad=$(".lbl-detalle-instrumento-profundidad-1-venta-cantidad");a.lblDetalleInstrumentoProfundidad2VentaCantidad=$(".lbl-detalle-instrumento-profundidad-2-venta-cantidad");a.lblDetalleInstrumentoProfundidad3VentaCantidad=$(".lbl-detalle-instrumento-profundidad-3-venta-cantidad");a.lblDetalleInstrumentoProfundidad4VentaCantidad=$(".lbl-detalle-instrumento-profundidad-4-venta-cantidad");a.lblDetalleInstrumentoProfundidad5VentaCantidad=$(".lbl-detalle-instrumento-profundidad-5-venta-cantidad");a.lblDetalleInstrumentoProfundidad1CompraPrecio=$(".lbl-detalle-instrumento-profundidad-1-compra-precio");a.lblDetalleInstrumentoProfundidad2CompraPrecio=$(".lbl-detalle-instrumento-profundidad-2-compra-precio");a.lblDetalleInstrumentoProfundidad3CompraPrecio=$(".lbl-detalle-instrumento-profundidad-3-compra-precio");a.lblDetalleInstrumentoProfundidad4CompraPrecio=$(".lbl-detalle-instrumento-profundidad-4-compra-precio");a.lblDetalleInstrumentoProfundidad5CompraPrecio=$(".lbl-detalle-instrumento-profundidad-5-compra-precio");a.lblDetalleInstrumentoProfundidad1VentaPrecio=$(".lbl-detalle-instrumento-profundidad-1-venta-precio");a.lblDetalleInstrumentoProfundidad2VentaPrecio=$(".lbl-detalle-instrumento-profundidad-2-venta-precio");a.lblDetalleInstrumentoProfundidad3VentaPrecio=$(".lbl-detalle-instrumento-profundidad-3-venta-precio");a.lblDetalleInstrumentoProfundidad4VentaPrecio=$(".lbl-detalle-instrumento-profundidad-4-venta-precio");a.lblDetalleInstrumentoProfundidad5VentaPrecio=$(".lbl-detalle-instrumento-profundidad-5-venta-precio");a.chkDetalleInstrumentoPlazoCI=$(".checkbox-detalle-instrumento-plazo-ci");a.chkDetalleInstrumentoPlazo24=$(".checkbox-detalle-instrumento-plazo-24");a.chkDetalleInstrumentoPlazo48=$(".checkbox-detalle-instrumento-plazo-48");a.lastDataCotizacionInstrumento=null;a.timerIdCotizacionIntradiario=null;a.executeCotizacionIntradiario=false;a.timerIdCotizacionInstrumento=null;a.executeCotizacionInstrumento=false;a.btnOperarInstrumentoVenderLimit=$(".btn-operar-instrumento-vender-limit");a.btnOperarInstrumentoVenderMkt=$(".btn-operar-instrumento-vender-mkt");a.btnOperarInstrumentoVenderOffer=$(".btn-operar-instrumento-vender-offer");a.btnOperarInstrumentoComprarLimit=$(".btn-operar-instrumento-comprar-limit");a.btnOperarInstrumentoComprarMkt=$(".btn-operar-instrumento-comprar-mkt");a.btnOperarInstrumentoComprarBid=$(".btn-operar-instrumento-comprar-bid");a.divOperarInstrumento=$(".div-operar-instrumento");a.ddlOperarInstrumentoCuentas=$(".dropdown-operar-instrumento-cuentas");a.lblOperarInstrumentoCuenta=$(".lbl-operar-instrumento-cuenta");a.divOperarInstrumentoDisponible=$(".div-disponible");a.lblOperarInstrumentoDisponible=$(".label-disponible");a.divOperarInstrumentoOperarFix=$(".div-operar-fix");a.divOperarInstrumentoReplacePreviousOrders=$(".div-replace-previous-orders");a.chkOperarInstrumentoReplacePreviousOrders=$(".checkbox-replace-previous-orders");a.divOperarInstrumentoCancelInDisconnection=$(".div-cancel-in-disconnection");a.chkOperarInstrumentoCancelInDisconnection=$(".checkbox-cancel-in-disconnection");a.divOperarInstrumentoTipoOrden=$(".div-tipo-orden");a.ddlOperarInstrumentoTipoOrden=$(".dropdown-tipo-orden");a.divOperarInstrumentoVencimientoOrden=$(".div-vencimiento-orden");a.ddlOperarInstrumentoVencimientoOrden=$(".dropdown-vencimiento-orden");a.divOperarInstrumentoPrecioStop=$(".div-precio-stop");a.txtOperarInstrumentoPrecioStop=$(".textbox-precio-stop");a.divOperarInstrumentoFechaVencimiento=$(".div-fecha-vencimiento");a.txtOperarInstrumentoFechaVencimiento=$(".date-fecha-vencimiento");a.txtOperarInstrumentoValorCantidad=$(".textbox-cantidad");a.txtOperarInstrumentoValorPrecio=$(".textbox-precio");a.divOperarInstrumentoTotal=$(".div-precio-total");a.lblOperarInstrumentoTotal=$(".label-precio-total");a.divOperarInstrumentoMargenRequerido=$(".div-margen-requerido");a.lblOperarInstrumentoMargenRequerido=$(".label-margen-requerido");a.txtOperarInstrumentoCantidadAMostrar=$(".textbox-cantidad-a-mostrar");a.chkOperarInstrumentoCantidadAMostrar=$(".checkbox-cantidad-a-mostrar");a.divOperarInstrumentoCantidadAMostrar=$(".div-cantidad-a-mostrar");a.btnOperarInstrumentoContinuar=$(".btn-continuar");a.divBuscadorInstrumento=$(".div-buscador-instrumento");a.ddlBuscadorInstrumento=$(".dropdown-buscador-instrumento");a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[d]);a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,c,d,function(){$(".div-reminder-notifications").hide();a.initControlsOrdenes();a.initControlsWatchlists();a.initControlsDetalleInstrumento();a.initControlsOperar();a.initControlsBuscadorInstrumento();a.loadWatchlists();a.loadOrdenes();a.loadBuscadorInstrumento();a.header.hideAccounts();a.loaded=true},"Core.Business.TradingAvanzado")})};a.initControlsWatchlists=function(){a.ddlWatchlists.shieldDropDown({dataSource:{data:[]},textTemplate:"{nombre}",valueTemplate:"{idWatchlist}",events:{select:function(c){a.setSelectedWatchListItems()}}});a.timerIdWatchlist=window.setInterval(function(){if(a.ddlWatchlists.swidget().value()&&a.watchlistItems&&(a.refreshWatchlist||a.forceRefreshWatchlist)){var c=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"cotizaciones/watchlists/"+a.ddlWatchlists.swidget().value()+"?token="+a.maxTokenWatchlist,requestType:"GET"});c.onSuccess=function(d){a.refreshWatchlistItems(d.cotizaciones);a.forceRefreshWatchlist=false};c.request()}a.refreshWatchlist=true},b);Core.Objects.Context.Timers.push(a.timerIdWatchlist);a.timerIdForceRefreshWatchlist=window.setInterval(function(){a.forceRefreshWatchlist=true},600000);Core.Objects.Context.Timers.push(a.timerIdForceRefreshWatchlist)};a.loadWatchlists=function(){if(!Core.Objects.Context.Watchlists){var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"watchlists",requestType:"GET"});c.onSuccess=function(d){Core.Objects.Context.Watchlists=d.watchlists;if(!Core.Functions.Validations.isBlockedStorage()&&Core.Functions.Persistence.getStorage()){Core.Functions.Persistence.getStorage().setItem("CoreContext",LZString.compressToUTF16(JSON.stringify(Core.Objects.Context)))}a.setWatchlists()};c.request()}else{a.setWatchlists()}};a.setWatchlists=function(){var c=a.ddlWatchlists.swidget().initialOptions;c.dataSource.data=$.grep(Core.Objects.Context.Watchlists,function(e,d){return e.propia==1});a.ddlWatchlists.swidget().refresh(c);a.setSelectedWatchListItems()};a.setSelectedWatchListItems=function(d,c){a.maxTokenWatchlist=0;a.refreshWatchlist=false;a.forceRefreshWatchlist=false;a.ticker=(d!=null?d:null);a.plazo=(c!=null?c:null);if(!a.ticker){a.divDetalleInstrumento.hide()}if(a.ddlWatchlists.swidget().value()){var e=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"cotizaciones/watchlists/"+a.ddlWatchlists.swidget().value()+"?token="+a.maxTokenWatchlist,requestType:"GET"});e.onSuccess=function(f){a.setWatchlistItems(f.cotizaciones);if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({idwatchlist:a.ddlWatchlists.swidget().value(),token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(g){a.socketMessage(g)}}};e.request()}};a.getMaxToken=function(c){var e=a.maxTokenWatchlist;for(var d=0;d<c.length;d++){if(c[d].t>e){e=c[d].t}}return e};a.setWatchlistItemValues=function(d){if(!d.ant||d.ant==0||d.ant==-1||!d.u||d.u==0||d.u==-1||d.f.length==10){d.varValorAbsoluto=0;d.varValorPorcentaje=0}else{var c=d.u-d.ant;if(c>0){d.varValorAbsoluto=parseFloat(c.toFixed(2));d.varValorPorcentaje=parseFloat((c/d.ant*100).toFixed(2))}else{if(c==0){d.varValorAbsoluto=parseFloat(c.toFixed(2));d.varValorPorcentaje=parseFloat((c/d.ant*100).toFixed(2))}else{if(c<0){d.varValorAbsoluto=parseFloat(c.toFixed(2));d.varValorPorcentaje=parseFloat((c/d.ant*100).toFixed(2))}}}}d.spread=(((d.pv-d.pc)/((d.pv+d.pc)/2))*100)};a.setWatchlistItems=function(c){a.divWatchlistItems.empty();a.watchlistItems=null;var d=[];c.forEach(function(f,e){a.setWatchlistItemValues(f);var g=$("<tr />").appendTo(a.divWatchlistItems);$('<td class="td-watchlist-item-ticker'+((a.ticker&&a.ticker==f.ticker&&a.plazo==f.idPlazo)?" active":"")+'"><a class="btn-detalle"><strong>'+Core.Functions.grid.formatUndefinedString(f.ticker)+"</strong></a></td>").appendTo(g);g.find(".btn-detalle").on("click",function(){var h=a.ddlBuscadorInstrumento.swidget().initialOptions;h.value=f.ticker;a.ddlBuscadorInstrumento.swidget().refresh(h);a.loadDetalleInstrumento(f.ticker,f.idPlazo)});$('<td class="td-watchlist-item-plazo">'+Core.Functions.grid.formatUndefinedString(f.plazo)+"</td>").appendTo(g);$('<td class="td-watchlist-item-cantidad-compra center gc">'+Core.Functions.grid.formatNuleableIntegerNumber(f.cc)+"</td>").appendTo(g);$('<td class="td-watchlist-item-precio-compra center go">'+Core.Functions.grid.formatPrice(f.pc)+"</td>").appendTo(g);$('<td class="td-watchlist-item-spread center go">'+Core.Functions.grid.formatNumber(f.spread)+"</td>").appendTo(g);$('<td class="td-watchlist-item-precio-venta center go">'+Core.Functions.grid.formatPrice(f.pv)+"</td>").appendTo(g);$('<td class="td-watchlist-item-cantidad-venta center gc">'+Core.Functions.grid.formatNuleableIntegerNumber(f.cv)+"</td>").appendTo(g);$('<td class="td-watchlist-item-ultimo center">'+Core.Functions.grid.formatPrice(f.u)+"</td>").appendTo(g);$('<td class="td-watchlist-item-variacion center '+((f.varValorAbsoluto<0)?"red":((f.varValorAbsoluto>0)?" green":""))+'">'+Core.Functions.grid.formatNumber(f.varValorAbsoluto)+"</td>").appendTo(g);$('<td class="td-watchlist-item-variacion-porcentual center '+((f.varValorPorcentaje<0)?"red":((f.varValorPorcentaje>0)?" green":""))+'">'+Core.Functions.grid.formatNumber(f.varValorPorcentaje)+"</td>").appendTo(g);$('<td class="td-watchlist-item-volumen center">'+Core.Functions.grid.formatNuleableIntegerNumber(f.v)+"</td>").appendTo(g);$('<td class="td-watchlist-item-fecha">'+Core.Functions.grid.formatUndefinedString(f.f)+"</td>").appendTo(g);d.push({item:f,tr:g})});a.watchlistItems=d;a.maxTokenWatchlist=a.getMaxToken(c)};a.refreshWatchlistItems=function(c){c.forEach(function(e,d){a.setWatchlistItemValues(e);var g=null;var f=$.grep(a.watchlistItems,function(s,i){if(s.item.SecurityID==e.SecurityID){g=i;return true}return false})[0];if(g!=null&&f){var h=f.tr.find(".td-watchlist-item-cantidad-compra");h.html(Core.Functions.grid.formatNuleableIntegerNumber(e.cc));a.setHighlight(h,e.cc,f.item.cc);var l=f.tr.find(".td-watchlist-item-precio-compra");l.html(Core.Functions.grid.formatPrice(e.pc));a.setHighlight(l,e.pc,f.item.pc);var n=f.tr.find(".td-watchlist-item-spread");n.html(Core.Functions.grid.formatNumber(e.spread));a.setHighlight(l,e.spread,f.item.spread);var m=f.tr.find(".td-watchlist-item-precio-venta");m.html(Core.Functions.grid.formatPrice(e.pv));a.setHighlight(m,e.pv,f.item.pv);var j=f.tr.find(".td-watchlist-item-cantidad-venta");j.html(Core.Functions.grid.formatNuleableIntegerNumber(e.cv));a.setHighlight(j,e.cv,f.item.cv);var o=f.tr.find(".td-watchlist-item-ultimo");o.html(Core.Functions.grid.formatPrice(e.u));a.setHighlight(o,e.u,f.item.u);var p=f.tr.find(".td-watchlist-item-variacion");p.removeClass("red");p.removeClass("green");p.html(Core.Functions.grid.formatNumber(e.varValorAbsoluto));if(e.varValorAbsoluto>0){p.addClass("green")}else{if(e.varValorAbsoluto<0){p.addClass("red")}}a.setHighlight(p,e.varValorAbsoluto,f.item.varValorAbsoluto);var q=f.tr.find(".td-watchlist-item-variacion-porcentual");q.removeClass("red");q.removeClass("green");q.html(Core.Functions.grid.formatNumber(e.varValorPorcentaje));if(e.varValorPorcentaje>0){q.addClass("green")}else{if(e.varValorPorcentaje<0){q.addClass("red")}}a.setHighlight(q,e.varValorPorcentaje,f.item.varValorPorcentaje);var r=f.tr.find(".td-watchlist-item-volumen");r.html(Core.Functions.grid.formatNuleableIntegerNumber(e.v));a.setHighlight(r,e.v,f.item.v);var k=f.tr.find(".td-watchlist-item-fecha");k.html(Core.Functions.grid.formatUndefinedString(e.f));a.watchlistItems[g].item=e}});a.maxTokenWatchlist=a.getMaxToken(c)};a.initControlsOrdenes=function(){a.txtFilterOrdenes.on("keydown",function(){clearTimeout(a.timeout);a.timeoutFilterOrdenes=setTimeout(function(){a.filterOrdenes()},50)});Core.Functions.Persistence.setTextBox(a.txtFilterOrdenes,"Core.Business.TradingAvanzado.txtFilterOrdenes");a.chkSoloPropias.on("change",function(){a.filterOrdenes()});a.btnRefreshOrdenes.on("click",function(){a.loadOrdenes()});a.estadosFiltro.forEach(function(e,d){var c=$('<button type="submit" class="btn btn-primary btn-filtro btn-activo btn-orden-estado" activo="true" estado="'+e+'">'+e+"</button>").appendTo(a.divOrdenesEstados);c.on("click",function(){if(c.attr("activo")=="true"){c.attr("activo","false");c.removeClass("btn-activo")}else{c.attr("activo","true");c.addClass("btn-activo")}a.filterOrdenes()})});if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({ordenes:1,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(c){a.socketMessage(c)}}};a.filterOrdenes=function(){var j=a.txtFilterOrdenes.val().toLowerCase();var h=a.chkSoloPropias[0].checked;var e=[];var d=$(".btn-orden-estado");for(var f=0;f<d.length;f++){var c=$(d[f]);if(c.attr("activo")=="true"){e.push(c.attr("estado").toLowerCase())}}var g=$.grep(a.ordenes,function(k,i){k.tr.hide();return((!j||((k.orden.Comitente&&k.orden.Comitente.toLowerCase().indexOf(j)>=0)||(k.orden.Ticker&&k.orden.Ticker.toLowerCase().indexOf(j)>=0)||(k.orden.Estado&&k.orden.Estado.toLowerCase().indexOf(j)>=0)||(k.orden.Usuario&&k.orden.Usuario.toLowerCase().indexOf(j)>=0)))&&(!h||(k.orden.Usuario&&k.orden.Usuario.toLowerCase()==Core.Objects.Context.User.toLowerCase()))&&(k.orden.EstadoFiltro&&e.indexOf(k.orden.EstadoFiltro.toLowerCase())>=0))});g.forEach(function(k,i){k.tr.show()})};a.loadOrdenes=function(){var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"ordenes/trading",requestType:"GET"});c.onSuccess=function(d){a.setOrdenes(d.ordenes);a.filterOrdenes()};c.request()};a.setOrdenes=function(c){a.divOrdenes.empty();a.ordenes=null;var d=[];c.forEach(function(g,f){g.EstadoFiltro=((a.estadosFiltro.indexOf(g.Estado)>=0)?g.Estado:"Otros");var i=$('<tr class="'+a.getClassByOrden(g)+'"/>').appendTo(a.divOrdenes);$('<td><strong class="orden">'+Core.Functions.grid.formatUndefinedString(g.idOrden)+"</strong></td>").appendTo(i);$("<td>"+Core.Functions.grid.formatUndefinedString(g.Comitente)+"</td>").appendTo(i);$("<td>"+Core.Functions.grid.formatUndefinedString(g.Fecha)+"</td>").appendTo(i);$('<td class="'+((g.Operacion&&g.Operacion.indexOf("Compra")>=0)?"compra":"venta")+'">'+Core.Functions.grid.formatUndefinedString(g.Operacion)+"</td>").appendTo(i);$('<td class="center">'+Core.Functions.grid.formatUndefinedString(g.Ticker)+"</td>").appendTo(i);$("<td>"+Core.Functions.grid.formatUndefinedString(g.Moneda)+"</td>").appendTo(i);$('<td class="td-orden-item-cantidad">'+Core.Functions.grid.formatUndefinedIntegerNumber(g.Cantidad)+"</td>").appendTo(i);$('<td class="td-orden-item-precio">'+Core.Functions.grid.formatPrice(g.Precio)+"</td>").appendTo(i);$('<td class="center td-orden-item-estado">'+Core.Functions.grid.formatUndefinedString(g.Estado)+"</td>").appendTo(i);$('<td class="td-orden-item-cantidad-operada">'+Core.Functions.grid.formatUndefinedIntegerNumber(g.CantidadOperada)+"</td>").appendTo(i);$('<td class="td-orden-item-precio-operado">'+Core.Functions.grid.formatPrice(g.PrecioOperado)+"</td>").appendTo(i);$("<td>"+Core.Functions.grid.formatUndefinedString(g.Usuario)+"</td>").appendTo(i);var h=$('<td style="text-align:left;"></td>').appendTo(i);if(g.Cancelable){var e=$('<button type="button" class="btn btn-primary btn-trading-avanzado-acciones btn-sm btn-cancelar-orden"><i class="fa fa-times" aria-hidden="true"></i></button>').appendTo(h);e.on("click",function(){a.cancelarOrden(g)})}d.push({orden:g,tr:i})});a.ordenes=d};a.refreshOrdenes=function(c){c.forEach(function(f,e){var h=null;var g=$.grep(a.ordenes,function(q,i){if(q.orden.idOrden==f.idOrden){h=i;return true}return false})[0];if(h!=null&&g){g.tr.removeClass("pendiente cancelada encurso-c encurso-v ejecutada-c ejecutada-v parcancelada-c parcancelada-v");g.tr.addClass(a.getClassByOrden(f));f.EstadoFiltro=((a.estadosFiltro.indexOf(f.Estado)>=0)?f.Estado:"Otros");var k=g.tr.find(".td-orden-item-cantidad");k.html(Core.Functions.grid.formatUndefinedIntegerNumber(f.Cantidad));a.setHighlight(k,f.cc,g.orden.Cantidad);var n=g.tr.find(".td-orden-item-precio");n.html(Core.Functions.grid.formatPrice(f.Precio));a.setHighlight(n,f.Precio,g.orden.Precio);var m=g.tr.find(".td-orden-item-estado");m.html(Core.Functions.grid.formatUndefinedString(f.Estado));var l=g.tr.find(".td-orden-item-cantidad-operada");l.html(Core.Functions.grid.formatUndefinedIntegerNumber(f.CantidadOperada));a.setHighlight(l,f.CantidadOperada,g.orden.CantidadOperada);var o=g.tr.find(".td-orden-item-precio-operado");o.html(Core.Functions.grid.formatPrice(f.PrecioOperado));a.setHighlight(o,f.PrecioOperado,g.orden.PrecioOperado);var d=g.tr.find(".btn-cancelar-orden");d.hide();if(f.Cancelable!=0){d.show()}a.ordenes[h].orden=f}else{f.EstadoFiltro=((a.estadosFiltro.indexOf(f.Estado)>=0)?f.Estado:"Otros");var p=$('<tr class="'+a.getClassByOrden(f)+'"/>').appendTo(a.divOrdenes);$('<td><strong class="orden">'+Core.Functions.grid.formatUndefinedString(f.idOrden)+"</strong></td>").appendTo(p);$("<td>"+Core.Functions.grid.formatUndefinedString(f.Comitente)+"</td>").appendTo(p);$("<td>"+Core.Functions.grid.formatUndefinedString(f.Fecha)+"</td>").appendTo(p);$('<td class="'+((f.Operacion&&f.Operacion.indexOf("Compra")>=0)?"compra":"venta")+'">'+Core.Functions.grid.formatUndefinedString(f.Operacion)+"</td>").appendTo(p);$('<td class="center">'+Core.Functions.grid.formatUndefinedString(f.Ticker)+"</td>").appendTo(p);$("<td>"+Core.Functions.grid.formatUndefinedString(f.Moneda)+"</td>").appendTo(p);$('<td class="td-orden-item-cantidad">'+Core.Functions.grid.formatUndefinedIntegerNumber(f.Cantidad)+"</td>").appendTo(p);$('<td class="td-orden-item-precio">'+Core.Functions.grid.formatPrice(f.Precio)+"</td>").appendTo(p);$('<td class="center td-orden-item-estado">'+Core.Functions.grid.formatUndefinedString(f.Estado)+"</td>").appendTo(p);$('<td class="td-orden-item-cantidad-operada">'+Core.Functions.grid.formatUndefinedIntegerNumber(f.CantidadOperada)+"</td>").appendTo(p);$('<td class="td-orden-item-precio-operado">'+Core.Functions.grid.formatPrice(f.PrecioOperado)+"</td>").appendTo(p);$("<td>"+Core.Functions.grid.formatUndefinedString(f.Usuario)+"</td>").appendTo(p);var j=$('<td style="text-align:center;"></td>').appendTo(p);if(f.Cancelable!=0){var d=$('<button type="button" class="btn btn-primary btn-trading-avanzado-acciones btn-sm btn-cancelar-orden"><i class="fa fa-times" aria-hidden="true"></i></button>').appendTo(j);d.on("click",function(){a.cancelarOrden(f)})}a.ordenes.push({orden:f,tr:p})}a.filterOrdenes()})};a.cancelarOrden=function(f){var d=$(".trading-avanzado-cancelar-orden");var e=d.find(".label-cancelar-orden");e.text("¿Confirma la solicitud de cancelación de la Orden de "+f.Operacion+((f.Cantidad)?(" de "+f.Cantidad+" Nominales"):"")+" del instrumento "+f.Ticker+" por un monto de "+f.Monto+" "+f.Moneda+"?");var g=d.find(".textbox-codigo4d");var c=d.find(".chk-recordar-codigo-operacion");c[0].checked=false;g.val(Core.Objects.Context.OperationCode?Core.Objects.Context.OperationCode:"");d.find(".btn-cancelar-orden").unbind("click");d.find(".btn-cancelar-orden").click(function(){var j={value:true};Core.Functions.Validations.toggleValidation(g,false);var h={idCuenta:f.idCuenta,idOrden:f.idOrden,Codigo4D:Core.Functions.Validations.getValidatedInputValue(g,j)};if(!j.value){return}var i=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"operar/cancelar",requestType:"POST",requestData:h});i.onSuccess=function(k){if(c[0].checked){Core.Objects.Context.OperationCode=g.val();if(!Core.Functions.Validations.isBlockedStorage()&&Core.Functions.Persistence.getStorage()){Core.Functions.Persistence.getStorage().setItem("CoreContext",LZString.compressToUTF16(JSON.stringify(Core.Objects.Context)))}}};i.onComplete=function(){d.modal("hide")};i.request()});if(Core.Objects.Context.OperationCode){d.find(".btn-cancelar-orden").click()}else{d.modal({show:true})}};a.editarOrden=function(d){var c=$(".trading-avanzado-editar-orden");c.modal({show:true})};a.getClassByOrden=function(c){if(c.Estado=="Pendiente"){return"pendiente"}else{if(c.Estado=="Cancelada"){return"cancelada"}else{if(c.Estado=="En Ejecución"&&c.Operacion.indexOf("Compra")>=0){return"encurso-c"}else{if(c.Estado=="En Ejecución"&&c.Operacion.indexOf("Venta")>=0){return"encurso-v"}else{if(c.Estado=="Ejecutada"&&c.Operacion.indexOf("Compra")>=0){return"ejecutada-c"}else{if(c.Estado=="Ejecutada"&&c.Operacion.indexOf("Venta")>=0){return"ejecutada-v"}else{if(c.Estado=="Parcialmente Cancelada"&&c.Operacion.indexOf("Compra")>=0){return"parcancelada-c"}else{if(c.Estado=="Parcialmente Cancelada"&&c.Operacion.indexOf("Venta")>=0){return"parcancelada-v"}else{return""}}}}}}}}};a.initControlsBuscadorInstrumento=function(){a.ddlBuscadorInstrumento.shieldComboBox({dataSource:{data:[]},valueTemplate:"{DisplayTicker}",value:a.defaultEspecie,textTemplate:"{DisplayTicker} | {Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}},events:{select:function(c){a.lastDataCotizacionInstrumento=null;a.plazo=null;a.ticker=null;a.watchlistItems.forEach(function(e,d){e.tr.find(".td-watchlist-item-ticker").removeClass("active")});if(c.index>=0){if(a.ddlBuscadorInstrumento.swidget().selectedItem()){a.loadDetalleInstrumento(a.ddlBuscadorInstrumento.swidget().selectedItem().DisplayTicker)}}else{a.divDetalleInstrumento.hide()}}}})};a.loadBuscadorInstrumento=function(){var c=new Core.Ajax.ServerRequest({allowCache:true,showOverlay:true,requestUrl:"especies",requestType:"GET",requestData:{panel:Core.Enums.ePanel.All}});c.onSuccess=function(d){var e=a.ddlBuscadorInstrumento.swidget().initialOptions;e.dataSource.data=$.grep(d.especies,function(g,f){return g.panel!=Core.Enums.ePanel.Fondos});a.ddlBuscadorInstrumento.swidget().refresh(e)};c.request()};a.initControlsDetalleInstrumento=function(){Core.Controls.Menu(a.btnDetalleInstrumentoAddWatchlistItem,[],{my:"left top",at:"left bottom",of:a.btnDetalleInstrumentoAddWatchlistItem},Core.Controls.eMenuTriggerButton.MouseLeft,function(){var f=[];for(var e=0;e<Core.Objects.Context.Watchlists.length;e++){if(Core.Objects.Context.Watchlists[e].propia==1){f.push({Name:Core.Objects.Context.Watchlists[e].nombre,onClick:function(i,h){var g={ticker:a.ticker,plazo:a.plazo,Nombre:i.Name,publica:0};var j=new Core.Ajax.ServerRequest({requestUrl:"watchlists",requestType:"POST",requestData:g});j.onSuccess=function(){a.setSelectedWatchListItems(a.ticker,a.plazo)};j.request()}})}}f.push({Name:"Nueva watchlist",onClick:function(h,g){if($.grep(Core.Objects.Context.Watchlists,function(j,i){return j.propia==1}).length<a.pageOptions.maxWatchlists){new Core.Controls.Prompt("Nueva Watchlist","Ingrese el nombre de la nueva watchlist",{onAccepted:function(j){if($.grep(Core.Objects.Context.Watchlists,function(m,l){return m.nombre==j}).length>0){new Core.Controls.Dialog("Aviso","Ya existe una watchlist con ese nombre, por favor ingrese otro nombre.",{displayButtons:{close:true,accept:false}}).show();return}if(j!=null&&j!="Nueva watchlist"&&j!="Agregar a watchlists"){var i={ticker:a.ticker,plazo:a.plazo,Nombre:j,publica:0};var k=new Core.Ajax.ServerRequest({requestUrl:"watchlists",requestType:"POST",requestData:i});k.onSuccess=function(){var l=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"watchlists",requestType:"GET"});l.onSuccess=function(n){Core.Objects.Context.Watchlists=n.watchlists;if(Core.Functions.Validations.isBlockedStorage()||!Core.Functions.Persistence.getStorage()){return}Core.Functions.Persistence.getStorage().setItem("CoreContext",LZString.compressToUTF16(JSON.stringify(Core.Objects.Context)));var m=a.ddlWatchlists.swidget().initialOptions;m.dataSource.data=$.grep(Core.Objects.Context.Watchlists,function(p,o){return p.propia==1});m.value=a.ddlWatchlists.swidget().value().toString();a.ddlWatchlists.swidget().refresh(m);a.loadDetalleInstrumento(a.ticker,a.plazo,a.btnDetalleSelected)};l.request()};k.request()}}}).show()}else{new Core.Controls.Dialog("Aviso","Se ha alcanzado la cantidad máxima de watchlists.",{displayButtons:{close:true,accept:false}}).show()}}});return f});a.btnDetalleInstrumentoDeleteWatchlistItem.on("click",function(){if(a.ticker&&a.lastDataCotizacionInstrumento){var e=new Core.Ajax.ServerRequest({requestUrl:"watchlists/"+a.lastDataCotizacionInstrumento.Cotizacion.idWatchlist+"?ticker="+a.ticker+"&plazo="+a.plazo,requestType:"DELETE"});e.onSuccess=function(){a.setSelectedWatchListItems(a.ticker,a.plazo);a.loadDetalleInstrumento(a.ticker,a.plazo,a.btnDetalleSelected)};e.request()}});a.btnDetalleInstrumentoHistorico.on("click",function(){a.btnDetalleSelected=a.btnDetalleInstrumentoHistorico;a.btnDetalleInstrumentoHistorico.addClass("btn-activo");a.divDetalleInstrumentoHistorico.show();a.btnDetalleInstrumentoIntradiario.removeClass("btn-activo");a.divDetalleInstrumentoIntradiario.hide();a.divDetalleInstrumentoIntradiarioVacio.hide();a.btnDetalleInstrumentoOperaciones.removeClass("btn-activo");a.divDetalleInstrumentoOperacionesContainer.hide();a.executeCotizacionIntradiario=false});a.btnDetalleInstrumentoIntradiario.on("click",function(){a.loadDetalleInstrumentoIntradiario(function(e){a.btnDetalleSelected=a.btnDetalleInstrumentoIntradiario;a.btnDetalleInstrumentoHistorico.removeClass("btn-activo");a.divDetalleInstrumentoHistorico.hide();a.btnDetalleInstrumentoIntradiario.addClass("btn-activo");a.divDetalleInstrumentoIntradiario.show();a.divDetalleInstrumentoIntradiarioVacio.hide();a.btnDetalleInstrumentoOperaciones.removeClass("btn-activo");a.divDetalleInstrumentoOperacionesContainer.hide();a.setChartIntradiario(e);a.executeCotizacionIntradiario=true})});a.btnDetalleInstrumentoOperaciones.on("click",function(){a.loadDetalleInstrumentoIntradiario(function(e){a.btnDetalleSelected=a.btnDetalleInstrumentoOperaciones;a.btnDetalleInstrumentoHistorico.removeClass("btn-activo");a.divDetalleInstrumentoHistorico.hide();a.btnDetalleInstrumentoIntradiario.removeClass("btn-activo");a.divDetalleInstrumentoIntradiario.hide();a.divDetalleInstrumentoIntradiarioVacio.hide();a.btnDetalleInstrumentoOperaciones.addClass("btn-activo");a.divDetalleInstrumentoOperacionesContainer.show();a.setOperacionesInstrumento(e);a.executeCotizacionIntradiario=true})});var d={type:"stock",theme:"dark",glueToTheEnd:true,dataSets:[{fieldMappings:[{fromField:"precioapertura",toField:"open"},{fromField:"preciomaximo",toField:"high"},{fromField:"preciominimo",toField:"low"},{fromField:"preciocierre",toField:"close"},{fromField:"totalnominal",toField:"totalnominal"},{fromField:"volumen",toField:"volume"}],compared:false,categoryField:"fecha"}],dataDateFormat:"YYYY-MM-DD JJ:NN:SS",panels:[{title:"Value",percentHeight:70,showCategoryAxis:false,stockGraphs:[{type:"candlestick",id:"g1",openField:"open",closeField:"close",highField:"high",lowField:"low",valueField:"close",lineColor:"#3f8360",fillColors:"#4ba94b",negativeLineColor:"#944242",negativeFillColors:"#ff0000",fillAlphas:1,columnWidth:0.7,useDataSetColors:false,comparable:false,showBalloon:true,balloonText:"Ultimo Precio:<b>[[close]]</b><br>Precio Máximo:<b>[[high]]</b><br>Precio Mínimo:<b>[[low]]</b>"}]},{title:"Volumen",percentHeight:30,marginTop:1,columnWidth:0.6,showCategoryAxis:true,stockGraphs:[{valueField:"volume",type:"column",showBalloon:true,balloonText:"Volumen:<b>[[value]]</b>",fillAlphas:1,lineColor:"#3f8360",fillColors:"#4ba94b",useNegativeColorIfDown:true,negativeLineColor:"#944242",negativeFillColors:"#ff0000",useDataSetColors:false,periodValue:"Sum"}],stockLegend:{markerType:"none",markerSize:0,labelText:"",periodValueTextRegular:"[[value.close]]"},prefixesOfBigNumbers:[{number:1000000,prefix:"MM"},{number:1000000000,prefix:"Bn"}],valueAxes:[{usePrefixes:true}]}],panelsSettings:{plotAreaFillColors:"#000000",plotAreaFillAlphas:0.5,marginLeft:80,marginTop:5,marginBottom:5},chartScrollbarSettings:{graph:"g1",graphType:"line",usePeriod:"mm"},categoryAxesSettings:{equalSpacing:false,minPeriod:"mm",groupToPeriods:["ss","10ss","30ss","mm","5mm","10mm","30mm","hh","DD","WW","MM","YYYY"],parseDates:true,gridColor:"#434d56",gridAlpha:1,maxSeries:150},valueAxesSettings:{gridColor:"#434d56",gridAlpha:1,inside:false,showLastLabel:true},chartCursorSettings:{pan:true,valueLineEnabled:true,valueLineBalloonEnabled:true},stockEventsSettings:{showAt:"high",type:"pin"},balloon:{textAlign:"left",offsetY:10},periodSelector:{position:"bottom",dateFormat:"JJ:NN",inputFieldWidth:100,periods:[{period:"hh",count:1,label:"1 hour"},{period:"hh",count:2,label:"2 hours"},{period:"MAX",selected:true,label:"MAX"}]}};a.chartDetalleInstrumentoIntradiario=AmCharts.makeChart(a.divDetalleInstrumentoIntradiario[0],d);var c={type:"stock",theme:"dark",dataSets:[{fieldMappings:[{fromField:"precioapertura",toField:"open"},{fromField:"preciomaximo",toField:"high"},{fromField:"preciominimo",toField:"low"},{fromField:"preciocierre",toField:"close"},{fromField:"totalnominal",toField:"totalnominal"},{fromField:"volumen",toField:"volume"}],compared:false,categoryField:"fecha"}],dataDateFormat:"YYYY-MM-DD",panels:[{title:"Value",percentHeight:70,showCategoryAxis:false,stockGraphs:[{type:"candlestick",id:"g1",openField:"open",closeField:"close",highField:"high",lowField:"low",valueField:"close",lineColor:"#3f8360",fillColors:"#4ba94b",negativeLineColor:"#944242",negativeFillColors:"#ff0000",fillAlphas:1,columnWidth:0.7,useDataSetColors:false,comparable:false,showBalloon:true,balloonText:"Ultimo Precio:<b>[[close]]</b><br>Precio Máximo:<b>[[high]]</b><br>Precio Mínimo:<b>[[low]]</b>"}]},{title:"Volumen",percentHeight:30,marginTop:1,columnWidth:0.6,showCategoryAxis:true,stockGraphs:[{valueField:"volume",type:"column",showBalloon:true,balloonText:"Volumen:<b>[[value]]</b>",fillAlphas:1,lineColor:"#3f8360",fillColors:"#4ba94b",useNegativeColorIfDown:true,negativeLineColor:"#944242",negativeFillColors:"#ff0000",useDataSetColors:false,periodValue:"Sum"}],stockLegend:{markerType:"none",markerSize:0,labelText:"",periodValueTextRegular:"[[value.close]]"},prefixesOfBigNumbers:[{number:1000000,prefix:"MM"},{number:1000000000,prefix:"Bn"}],valueAxes:[{usePrefixes:true}]}],panelsSettings:{plotAreaFillColors:"#000000",plotAreaFillAlphas:0.5,marginLeft:80,marginTop:5,marginBottom:5},chartScrollbarSettings:{graph:"g1",graphType:"line",usePeriod:"WW"},categoryAxesSettings:{equalSpacing:true,gridColor:"#434d56",gridAlpha:1,maxSeries:400},valueAxesSettings:{gridColor:"#434d56",gridAlpha:1,inside:false,showLastLabel:true},chartCursorSettings:{pan:true,valueLineEnabled:true,valueLineBalloonEnabled:true},stockEventsSettings:{showAt:"high",type:"pin"},balloon:{textAlign:"left",offsetY:10},periodSelector:{position:"bottom",periods:[{period:"DD",count:10,label:"10D"},{period:"MM",count:1,label:"1M"},{period:"MM",count:6,label:"6M"},{period:"YYYY",count:1,selected:true,label:"1Y"},{period:"YYYY",count:5,label:"5Y"},{period:"MAX",label:"MAX"}]}};a.chartDetalleInstrumentoHistorico=AmCharts.makeChart(a.divDetalleInstrumentoHistorico[0],c);a.chkDetalleInstrumentoPlazoCI.on("change",function(){a.loadDetalleInstrumento(a.ticker,Core.Enums.ePlazo.CI,a.btnDetalleSelected)});a.chkDetalleInstrumentoPlazo24.on("change",function(){a.loadDetalleInstrumento(a.ticker,Core.Enums.ePlazo.D24,a.btnDetalleSelected)});a.chkDetalleInstrumentoPlazo48.on("change",function(){a.loadDetalleInstrumento(a.ticker,Core.Enums.ePlazo.D48,a.btnDetalleSelected)});a.timerIdCotizacionIntradiario=window.setInterval(function(){if(a.executeCotizacionIntradiario&&a.ticker){a.loadDetalleInstrumentoIntradiario(function(e){if(a.btnDetalleInstrumentoIntradiario.hasClass("btn-activo")){a.setChartIntradiario(e)}else{if(a.btnDetalleInstrumentoOperaciones.hasClass("btn-activo")){a.setOperacionesInstrumento(e)}}})}},b);Core.Objects.Context.Timers.push(a.timerIdCotizacionIntradiario);a.timerIdCotizacionInstrumento=window.setInterval(function(){if(a.executeCotizacionInstrumento&&a.ticker){var e={};e.ticker=a.tickerHistorico;if(a.plazoHistorico!=null){e.plazo=a.plazoHistorico}var f=new Core.Ajax.ServerRequest({showOverlay:!a.loadedInstrumento,secureRequest:true,requestUrl:"cotizacioninstrumento",requestType:"GET",requestData:e});f.onSuccess=function(g){a.loadCotizacionInstrumento(g)};f.request()}a.executeCotizacionInstrumento=true},b)};a.setOperacionesInstrumento=function(c){a.divDetalleInstrumentoIntradiarioVacio.show();a.divDetalleInstrumentoOperacionesContainer.hide();if(c.intradiario.length>0){a.divDetalleInstrumentoIntradiarioVacio.hide();a.divDetalleInstrumentoOperacionesContainer.show();c.intradiario.sort(function(d,f){var i=f.cantidadoperaciones-d.cantidadoperaciones;if(i==0){var h=new Date();var e=new Date(h.getFullYear()+"-"+(h.getMonth()+1)+"-"+h.getDate()+" "+d.hora);var g=new Date(h.getFullYear()+"-"+(h.getMonth()+1)+"-"+h.getDate()+" "+f.hora);i=g.getTime()-e.getTime()}return i})}a.divDetalleInstrumentoOperaciones.empty();c.intradiario.forEach(function(e,d){var f=$("<tr />").appendTo(a.divDetalleInstrumentoOperaciones);$("<td>"+Core.Functions.grid.formatUndefinedString(e.hora)+"</td>").appendTo(f);$("<td>"+Core.Functions.grid.formatIntegerNumber(e.cantidadoperaciones)+"</td>").appendTo(f);$("<td>"+Core.Functions.grid.formatPrice(e.precio)+"</td>").appendTo(f);$("<td>"+Core.Functions.grid.formatNumber(e.cantidad)+"</td>").appendTo(f)})};a.setChartIntradiario=function(c){a.divDetalleInstrumentoIntradiario.hide();a.divDetalleInstrumentoIntradiarioVacio.show();if(c.agrupado.length>0){a.divDetalleInstrumentoIntradiario.show();a.divDetalleInstrumentoIntradiarioVacio.hide();a.chartDetalleInstrumentoIntradiario.dataSets[0].dataProvider=c.agrupado;a.chartDetalleInstrumentoIntradiario.dataProvider=c.agrupado;a.chartDetalleInstrumentoIntradiario.validateData()}};a.loadDetalleInstrumentoIntradiario=function(c){var d={};d.ticker=a.ticker;if(a.plazoHistorico!=null){d.plazo=a.plazoHistorico}var e=new Core.Ajax.ServerRequest({showOverlay:!a.loadedInstrumento,secureRequest:true,requestUrl:"cotizacionintradiario",requestType:"GET",requestData:d});e.onSuccess=function(f){c(f)};e.request()};a.loadDetalleInstrumento=function(g,d,c){a.divDetalleInstrumento.hide();a.lastDataCotizacionInstrumento=null;a.executeCotizacionIntradiario=false;a.executeCotizacionInstrumento=false;a.loadedInstrumento=false;var e={};e.ticker=g;if(d!=null){e.plazo=d}var f=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"cotizacioninstrumento",requestType:"GET",requestData:e});f.onSuccess=function(h){a.ticker=g;a.plazo=((d!=null)?d:h.Cotizacion.plazoHistorico);a.chkDetalleInstrumentoPlazoCI[0].checked=(a.plazo==Core.Enums.ePlazo.CI);a.chkDetalleInstrumentoPlazo24[0].checked=(a.plazo==Core.Enums.ePlazo.D24);a.chkDetalleInstrumentoPlazo48[0].checked=(a.plazo==Core.Enums.ePlazo.D48);a.panel=h.Cotizacion.panel;a.securityID=h.Cotizacion.SecurityID;a.verProfundidad=h.Cotizacion.verProfundidad;a.tickerHistorico=h.Cotizacion.TickerHistorico;a.plazoHistorico=h.Cotizacion.plazoHistorico;a.watchlistItems.forEach(function(l,k){l.tr.find(".td-watchlist-item-ticker").removeClass("active");if(l.item.ticker==a.ticker&&l.item.idPlazo==a.plazo){l.tr.find(".td-watchlist-item-ticker").addClass("active")}});a.loadCotizacionInstrumento(h);var i={};i.ticker=a.tickerHistorico;if(a.plazoHistorico!=null){i.plazo=a.plazoHistorico}var j=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"cotizacionhistorico",requestType:"GET",requestData:i});j.onSuccess=function(k){a.cotizacionHistoricoInstrumento=k;a.loadDetalleInstrumentoHistorico();if(c){c.click()}else{a.btnDetalleInstrumentoIntradiario.click()}a.divDetalleInstrumento.show();a.setSelectedButton();a.divOperarInstrumento.hide();a.loadedInstrumento=true};j.request()};f.request()};a.loadDetalleInstrumentoHistorico=function(){if(a.cotizacionHistoricoInstrumento.historico.length>0){a.chartDetalleInstrumentoHistorico.dataSets[0].dataProvider=a.cotizacionHistoricoInstrumento.historico;a.chartDetalleInstrumentoHistorico.dataProvider=a.cotizacionHistoricoInstrumento.historico;a.chartDetalleInstrumentoHistorico.validateData()}};a.loadCotizacionInstrumento=function(c){var d=new Date();d.setHours(0,0,0,0);var f=(c.Cotizacion.UltimaOperacion)?new Date(c.Cotizacion.UltimaOperacion):new Date();f.setHours(0,0,0,0);a.lblDetalleInstrumentoDescripcion.html(c.Cotizacion.Descripcion);a.lblDetalleInstrumentoFecha.text((c.Cotizacion.UltimaOperacion)?((d.getTime()!=f.getTime())?(c.Cotizacion.UltimaOperacion.substr(0,10)):(c.Cotizacion.UltimaOperacion.substr(11,5))):"-");a.lblDetalleInstrumentoUltimoOperado.text((c.Cotizacion.UltimoPrecio)?(c.Cotizacion.SimboloMoneda+" "+Core.Functions.grid.formatPrice(c.Cotizacion.UltimoPrecio)):"-");if(a.lastDataCotizacionInstrumento){a.setHighlight(a.lblDetalleInstrumentoUltimoOperado,c.Cotizacion.UltimoPrecio,a.lastDataCotizacionInstrumento.Cotizacion.UltimoPrecio)}a.lblDetalleInstrumentoApertura.text((c.Cotizacion.PrecioApertura)?(Core.Functions.grid.formatPrice(c.Cotizacion.PrecioApertura)):"-");if(a.lastDataCotizacionInstrumento){a.setHighlight(a.lblDetalleInstrumentoApertura,c.Cotizacion.PrecioApertura,a.lastDataCotizacionInstrumento.Cotizacion.PrecioApertura)}a.lblDetalleInstrumentoMaximo.text((c.Cotizacion.PrecioMaximo)?(Core.Functions.grid.formatPrice(c.Cotizacion.PrecioMaximo)):"-");if(a.lastDataCotizacionInstrumento){a.setHighlight(a.lblDetalleInstrumentoMaximo,c.Cotizacion.PrecioMaximo,a.lastDataCotizacionInstrumento.Cotizacion.PrecioMaximo)}a.lblDetalleInstrumentoVolumen.text((c.Cotizacion.Volumen)?(Core.Functions.grid.formatIntegerNumber(c.Cotizacion.Volumen)):"-");if(a.lastDataCotizacionInstrumento){a.setHighlight(a.lblDetalleInstrumentoVolumen,c.Cotizacion.Volumen,a.lastDataCotizacionInstrumento.Cotizacion.Volumen)}a.lblDetalleInstrumentoCierreAnterior.text((c.Cotizacion.PrecioCierreAnterior)?(Core.Functions.grid.formatPrice(c.Cotizacion.PrecioCierreAnterior)):"-");if(a.lastDataCotizacionInstrumento){a.setHighlight(a.lblDetalleInstrumentoCierreAnterior,c.Cotizacion.PrecioCierreAnterior,a.lastDataCotizacionInstrumento.Cotizacion.PrecioCierreAnterior)}a.lblDetalleInstrumentoMinimo.text((c.Cotizacion.PrecioMinimo)?(Core.Functions.grid.formatPrice(c.Cotizacion.PrecioMinimo)):"-");if(a.lastDataCotizacionInstrumento){a.setHighlight(a.lblDetalleInstrumentoMinimo,c.Cotizacion.PrecioMinimo,a.lastDataCotizacionInstrumento.Cotizacion.PrecioMinimo)}a.setItemProfunidad(c.Cotizacion,a.lblDetalleInstrumentoProfundidad1,a.lblDetalleInstrumentoProfundidad1VentaCantidad,a.lblDetalleInstrumentoProfundidad1VentaPrecio,a.lblDetalleInstrumentoProfundidad1CompraCantidad,a.lblDetalleInstrumentoProfundidad1CompraPrecio,((a.lastDataCotizacionInstrumento)?a.lastDataCotizacionInstrumento.Cotizacion:null));a.setItemProfunidad(((a.verProfundidad&&c.Profundidad&&c.Profundidad[0])?c.Profundidad[0]:null),a.lblDetalleInstrumentoProfundidad2,a.lblDetalleInstrumentoProfundidad2VentaCantidad,a.lblDetalleInstrumentoProfundidad2VentaPrecio,a.lblDetalleInstrumentoProfundidad2CompraCantidad,a.lblDetalleInstrumentoProfundidad2CompraPrecio,((a.lastDataCotizacionInstrumento)?a.lastDataCotizacionInstrumento.Profundidad[0]:null));a.setItemProfunidad(((a.verProfundidad&&c.Profundidad&&c.Profundidad[1])?c.Profundidad[1]:null),a.lblDetalleInstrumentoProfundidad3,a.lblDetalleInstrumentoProfundidad3VentaCantidad,a.lblDetalleInstrumentoProfundidad3VentaPrecio,a.lblDetalleInstrumentoProfundidad3CompraCantidad,a.lblDetalleInstrumentoProfundidad3CompraPrecio,((a.lastDataCotizacionInstrumento)?a.lastDataCotizacionInstrumento.Profundidad[1]:null));a.setItemProfunidad(((a.verProfundidad&&c.Profundidad&&c.Profundidad[2])?c.Profundidad[2]:null),a.lblDetalleInstrumentoProfundidad4,a.lblDetalleInstrumentoProfundidad4VentaCantidad,a.lblDetalleInstrumentoProfundidad4VentaPrecio,a.lblDetalleInstrumentoProfundidad4CompraCantidad,a.lblDetalleInstrumentoProfundidad4CompraPrecio,((a.lastDataCotizacionInstrumento)?a.lastDataCotizacionInstrumento.Profundidad[2]:null));a.setItemProfunidad(((a.verProfundidad&&c.Profundidad&&c.Profundidad[3])?c.Profundidad[3]:null),a.lblDetalleInstrumentoProfundidad5,a.lblDetalleInstrumentoProfundidad5VentaCantidad,a.lblDetalleInstrumentoProfundidad5VentaPrecio,a.lblDetalleInstrumentoProfundidad5CompraCantidad,a.lblDetalleInstrumentoProfundidad5CompraPrecio,((a.lastDataCotizacionInstrumento)?a.lastDataCotizacionInstrumento.Profundidad[3]:null));a.lblDetalleInstrumentoVariacion.removeClass("red");a.lblDetalleInstrumentoVariacion.removeClass("green");if(!c.Cotizacion.UltimaOperacion||!c.Cotizacion.PrecioCierreAnterior||!c.Cotizacion.UltimoPrecio||d.getTime()!=f.getTime()){a.lblDetalleInstrumentoVariacion.html("0.00 %")}else{var e=c.Cotizacion.UltimoPrecio-c.Cotizacion.PrecioCierreAnterior;if(e>0){a.lblDetalleInstrumentoVariacion.addClass("green");a.lblDetalleInstrumentoVariacion.html('<i class="fa fa-arrow-up" aria-hidden="true"></i>'+Core.Functions.grid.formatNumber(parseFloat((e/c.Cotizacion.PrecioCierreAnterior*100).toFixed(2)))+" %")}else{if(e==0){a.lblDetalleInstrumentoVariacion.html("0.00 %")}else{if(e<0){a.lblDetalleInstrumentoVariacion.addClass("red");a.lblDetalleInstrumentoVariacion.html('<i class="fa fa-arrow-down" aria-hidden="true"></i>'+Core.Functions.grid.formatNumber(parseFloat((e/c.Cotizacion.PrecioCierreAnterior*100).toFixed(2)))+" %")}}}if(a.lastDataCotizacionInstrumento){a.setHighlight(a.lblDetalleInstrumentoVariacion,c.Cotizacion.UltimoPrecio,a.lastDataCotizacionInstrumento.Cotizacion.UltimoPrecio)}}a.btnDetalleInstrumentoDeleteWatchlistItem.hide();if(c.Cotizacion.idWatchlist){a.btnDetalleInstrumentoDeleteWatchlistItem.show()}a.lastDataCotizacionInstrumento=c};a.setItemProfunidad=function(d,c,g,i,f,h,e){if(d){g.text((d.CantCompra)?(Core.Functions.grid.formatIntegerNumber(d.CantCompra)+" x "):"");if(e){a.setHighlight(g,d.CantCompra,e.CantCompra)}i.text((d.PrecioCompra)?(Core.Functions.grid.formatPrice(d.PrecioCompra)):"");if(e){a.setHighlight(i,d.PrecioCompra,e.PrecioCompra)}f.text((d.CantVenta)?(" x "+Core.Functions.grid.formatIntegerNumber(d.CantVenta)):"");if(e){a.setHighlight(f,d.CantVenta,e.CantVenta)}h.text((d.PrecioVenta)?(Core.Functions.grid.formatPrice(d.PrecioVenta)):"");if(e){a.setHighlight(h,d.PrecioVenta,e.PrecioVenta)}c.show()}else{c.hide()}};a.initControlsOperar=function(){a.btnOperarInstrumentoVenderLimit.on("click",function(){a.setSelectedButton(a.btnOperarInstrumentoVenderLimit,Core.Enums.eEspeciesTipoOperacion.Venta);parameters={};parameters.tipoOperacion=Core.Enums.eEspeciesTipoOperacion.Venta;parameters.especie=a.ticker;parameters.valorTipoOrden=a.eTipoOrden.Limit.toString();parameters.valorLimite=(a.lastDataCotizacionInstrumento?a.lastDataCotizacionInstrumento.Cotizacion.PrecioCompra:"");a.loadOperar(parameters)});a.btnOperarInstrumentoVenderMkt.on("click",function(){a.setSelectedButton(a.btnOperarInstrumentoVenderMkt,Core.Enums.eEspeciesTipoOperacion.Venta);parameters={};parameters.tipoOperacion=Core.Enums.eEspeciesTipoOperacion.Venta;parameters.especie=a.ticker;parameters.valorLimite=(a.lastDataCotizacionInstrumento?a.lastDataCotizacionInstrumento.Cotizacion.PrecioCompra:"");parameters.valorTipoOrden=a.eTipoOrden.Market.toString();a.loadOperar(parameters)});a.btnOperarInstrumentoVenderOffer.on("click",function(){a.setSelectedButton(a.btnOperarInstrumentoVenderOffer,Core.Enums.eEspeciesTipoOperacion.Venta);parameters={};parameters.tipoOperacion=Core.Enums.eEspeciesTipoOperacion.Venta;parameters.especie=a.ticker;parameters.valorLimite=(a.lastDataCotizacionInstrumento?a.lastDataCotizacionInstrumento.Cotizacion.PrecioVenta:"");parameters.valorTipoOrden=a.eTipoOrden.Limit.toString();a.loadOperar(parameters)});a.btnOperarInstrumentoComprarLimit.on("click",function(){a.setSelectedButton(a.btnOperarInstrumentoComprarLimit,Core.Enums.eEspeciesTipoOperacion.Compra);parameters={};parameters.tipoOperacion=Core.Enums.eEspeciesTipoOperacion.Compra;parameters.especie=a.ticker;parameters.valorTipoOrden=a.eTipoOrden.Limit.toString();parameters.valorLimite=(a.lastDataCotizacionInstrumento?a.lastDataCotizacionInstrumento.Cotizacion.PrecioVenta:"");a.loadOperar(parameters)});a.btnOperarInstrumentoComprarMkt.on("click",function(){a.setSelectedButton(a.btnOperarInstrumentoComprarMkt,Core.Enums.eEspeciesTipoOperacion.Compra);parameters={};parameters.tipoOperacion=Core.Enums.eEspeciesTipoOperacion.Compra;parameters.especie=a.ticker;parameters.valorLimite=(a.lastDataCotizacionInstrumento?a.lastDataCotizacionInstrumento.Cotizacion.PrecioVenta:"");parameters.valorTipoOrden=a.eTipoOrden.Market.toString();a.loadOperar(parameters)});a.btnOperarInstrumentoComprarBid.on("click",function(){a.setSelectedButton(a.btnOperarInstrumentoComprarBid,Core.Enums.eEspeciesTipoOperacion.Compra);parameters={};parameters.tipoOperacion=Core.Enums.eEspeciesTipoOperacion.Compra;parameters.especie=a.ticker;parameters.valorLimite=(a.lastDataCotizacionInstrumento?a.lastDataCotizacionInstrumento.Cotizacion.PrecioCompra:"");parameters.valorTipoOrden=a.eTipoOrden.Limit.toString();a.loadOperar(parameters)});var c=$.grep(Core.Objects.Accounts,function(f,e){return f.NumComitente});var d=c[0];a.ddlOperarInstrumentoCuentas.shieldComboBox({dataSource:{data:c},valueTemplate:"{idCuenta}",value:d.idCuenta.toString(),textTemplate:"{NumComitente}",autoComplete:{enabled:true,filter:{or:[{path:"NumComitente",filter:"contains",value:""}]}},events:{blur:function(f){var g=$.grep(Core.Objects.Accounts,function(h,e){return h.NumComitente==a.ddlOperarInstrumentoCuentas.swidget().text()})[0];if(g){a.header.setSelectedAccount(g,true);a.lblOperarInstrumentoCuenta.text(g.Descripcion);a.selectedAccount=g}else{a.selectedAccount=null;a.lblOperarInstrumentoCuenta.text("")}}}});if(d){a.header.setSelectedAccount(d,true);a.lblOperarInstrumentoCuenta.text(d.Descripcion);a.selectedAccount=d}else{a.selectedAccount=null;a.lblOperarInstrumentoCuenta.text("")}a.ddlOperarInstrumentoTipoOrden.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{Valor}",events:{select:function(e){a.setControlsByTipoOrden();if(a.ddlOperarInstrumentoTipoOrden.swidget().value()==a.eTipoOrden.Limit||a.ddlOperarInstrumentoTipoOrden.swidget().value()==a.eTipoOrden.StopLimit){a.setSelectedButton(a.defaultTipoOperacion==Core.Enums.eEspeciesTipoOperacion.Compra?a.btnOperarInstrumentoComprarLimit:a.btnOperarInstrumentoVenderLimit,a.defaultTipoOperacion)}else{if(a.ddlOperarInstrumentoTipoOrden.swidget().value()==a.eTipoOrden.Market){a.setSelectedButton(a.defaultTipoOperacion==Core.Enums.eEspeciesTipoOperacion.Compra?a.btnOperarInstrumentoComprarMkt:a.btnOperarInstrumentoVenderMkt,a.defaultTipoOperacion)}else{a.setSelectedButton(null,a.defaultTipoOperacion)}}}}});a.ddlOperarInstrumentoVencimientoOrden.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{Valor}",events:{select:function(e){a.setControlsByVencimientoOrden()}}});new Core.Controls.DecimalPicker(a.txtOperarInstrumentoPrecioStop,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:""});a.txtOperarInstrumentoFechaVencimiento.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date()});new Core.Controls.DecimalPicker(a.txtOperarInstrumentoValorCantidad,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){if(a.panel!=Core.Enums.ePanel.Futuros){Core.Functions.Operar.setTotalOperacion(a.txtOperarInstrumentoValorCantidad.val(),a.getPrecio(),a.lblOperarInstrumentoTotal,((a.defaultTipoOperacion==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))}else{a.setTotalEstimado();a.setMargenRequerido()}}});new Core.Controls.DecimalPicker(a.txtOperarInstrumentoValorPrecio,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){if(a.panel!=Core.Enums.ePanel.Futuros){Core.Functions.Operar.setTotalOperacion(a.txtOperarInstrumentoValorCantidad.val(),a.getPrecio(),a.lblOperarInstrumentoTotal,((a.defaultTipoOperacion==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))}else{a.setTotalEstimado();a.setMargenRequerido()}}});a.chkOperarInstrumentoCantidadAMostrar.shieldCheckBox({label:"Difusión Parcial / Iceberg",events:{click:function(f){a.divOperarInstrumentoCantidadAMostrar.hide();if(a.chkOperarInstrumentoCantidadAMostrar.swidget().checked()){a.divOperarInstrumentoCantidadAMostrar.show()}}}});new Core.Controls.DecimalPicker(a.txtOperarInstrumentoCantidadAMostrar,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:""});a.chkOperarInstrumentoReplacePreviousOrders.shieldCheckBox({label:"Reemplazar órdenes previas"});a.chkOperarInstrumentoCancelInDisconnection.shieldCheckBox({label:"Cancelar orden ante desconexión"});a.btnOperarInstrumentoContinuar.click(function(){a.btnOperarInstrumentoContinuarClick()})};a.setSelectedButton=function(c,d){a.btnOperarInstrumentoVenderLimit.css("background-color","");a.btnOperarInstrumentoVenderMkt.css("background-color","");a.btnOperarInstrumentoVenderOffer.css("background-color","");a.btnOperarInstrumentoComprarLimit.css("background-color","");a.btnOperarInstrumentoComprarMkt.css("background-color","");a.btnOperarInstrumentoComprarBid.css("background-color","");a.divOperarInstrumento.removeClass("vender");a.divOperarInstrumento.removeClass("comprar");a.divOperarInstrumento.addClass(((d==Core.Enums.eEspeciesTipoOperacion.Compra)?"comprar":"vender"));if(c){c.css("background-color",((d==Core.Enums.eEspeciesTipoOperacion.Compra)?"green":"red"))}};a.setControlsByTipoOrden=function(){a.txtOperarInstrumentoPrecioStop.val("");a.txtOperarInstrumentoPrecioStop.attr("disabled","disabled");if(a.ddlOperarInstrumentoTipoOrden.swidget().value()==a.eTipoOrden.StopLimit||a.ddlOperarInstrumentoTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlOperarInstrumentoTipoOrden.swidget().value()==a.eTipoOrden.Stop){a.txtOperarInstrumentoPrecioStop.removeAttr("disabled")}a.txtOperarInstrumentoValorPrecio.removeAttr("disabled");if(a.ddlOperarInstrumentoTipoOrden.swidget().value()==a.eTipoOrden.Market||a.ddlOperarInstrumentoTipoOrden.swidget().value()==a.eTipoOrden.MarketWithLeftOverAsLimit){a.txtOperarInstrumentoValorPrecio.val("");a.txtOperarInstrumentoValorPrecio.attr("disabled","disabled");if(a.panel!=Core.Enums.ePanel.Futuros){Core.Functions.Operar.setTotalOperacion(a.txtOperarInstrumentoValorCantidad.val(),a.getPrecio(),a.lblOperarInstrumentoTotal,((a.defaultTipoOperacion==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))}else{a.setTotalEstimado();a.setMargenRequerido()}}};a.setControlsByVencimientoOrden=function(){a.txtOperarInstrumentoFechaVencimiento.swidget().value(new Date());a.txtOperarInstrumentoFechaVencimiento.swidget().enabled(false);if(a.ddlOperarInstrumentoVencimientoOrden.swidget().value()==a.eVencimientoOrden.GoodTillDate){a.txtOperarInstrumentoFechaVencimiento.swidget().enabled(true)}};a.getPrecio=function(){if(a.ddlOperarInstrumentoTipoOrden.swidget().value()==a.eTipoOrden.Market||a.ddlOperarInstrumentoTipoOrden.swidget().value()==a.eTipoOrden.MarketWithLeftOverAsLimit){if(a.lastDataCotizacionInstrumento){if(a.defaultTipoOperacion==Core.Enums.eEspeciesTipoOperacion.Compra){return a.lastDataCotizacionInstrumento.Cotizacion.PrecioVenta}else{return a.lastDataCotizacionInstrumento.Cotizacion.PrecioCompra}}else{return null}}else{return a.txtOperarInstrumentoValorPrecio.val()}};a.loadOperar=function(e){a.defaultTipoOperacion=e.tipoOperacion;a.defaultEspecie=e.especie;a.txtOperarInstrumentoValorPrecio.val(e.valorLimite);a.disponibleActual=null;a.detalleDisponible=null;a.divOperarInstrumentoOperarFix.hide();a.divOperarInstrumentoCantidadAMostrar.hide();a.divOperarInstrumento.hide();a.divOperarInstrumentoDisponible.hide();a.divOperarInstrumentoTotal.removeClass("col-lg-6 col-md-6 col-sm-12 col-xs-12");a.divOperarInstrumentoMargenRequerido.removeClass("col-lg-6 col-md-6 col-sm-12 col-xs-12");a.txtOperarInstrumentoCantidadAMostrar.val("");a.txtOperarInstrumentoPrecioStop.val("");a.txtOperarInstrumentoValorCantidad.val("");var c=a.txtOperarInstrumentoFechaVencimiento.swidget().initialOptions;a.txtOperarInstrumentoFechaVencimiento.swidget().refresh(c);a.chkOperarInstrumentoCantidadAMostrar.swidget().checked(false);a.chkOperarInstrumentoCancelInDisconnection.swidget().checked(false);a.chkOperarInstrumentoReplacePreviousOrders.swidget().checked(false);var d=a.ddlOperarInstrumentoVencimientoOrden.swidget().initialOptions;a.ddlOperarInstrumentoVencimientoOrden.swidget().refresh(d);if(a.panel==Core.Enums.ePanel.Fondos){return}if(a.panel!=Core.Enums.ePanel.Futuros){a.divOperarInstrumentoTotal.addClass("col-lg-6 col-md-6 col-sm-12 col-xs-12");a.divOperarInstrumentoMargenRequerido.hide()}else{a.divOperarInstrumentoTotal.addClass("col-lg-3 col-md-3 col-sm-6 col-xs-6");a.divOperarInstrumentoMargenRequerido.addClass("col-lg-3 col-md-3 col-sm-6 col-xs-6");a.divOperarInstrumentoMargenRequerido.show()}if(a.panel!=Core.Enums.ePanel.Futuros){Core.Functions.Operar.setTotalOperacion(a.txtOperarInstrumentoValorCantidad.val(),a.getPrecio(),a.lblOperarInstrumentoTotal,((a.defaultTipoOperacion==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))}else{a.setTotalEstimado();a.setMargenRequerido()}if(a.pageOptions.operarFIX){Core.Functions.Operar.setControlsOperarFix(a.lastDataCotizacionInstrumento,a.ddlOperarInstrumentoTipoOrden,a.ddlOperarInstrumentoVencimientoOrden,a.divOperarInstrumentoOperarFix,a.divOperarInstrumentoReplacePreviousOrders,a.divOperarInstrumentoCancelInDisconnection,a.loadedInstrumento,function(){if(e.valorTipoOrden){if(e.valorTipoOrden==a.eTipoOrden.Market&&!$.grep(a.ddlOperarInstrumentoTipoOrden.swidget().dataSource.data,function(h,g){return h.Valor==e.valorTipoOrden})[0]){e.valorTipoOrden=a.eTipoOrden.MarketWithLeftOverAsLimit}var f=a.ddlOperarInstrumentoTipoOrden.swidget().initialOptions;f.value=e.valorTipoOrden;a.ddlOperarInstrumentoTipoOrden.swidget().refresh(f)}a.setControlsByVencimientoOrden();a.setControlsByTipoOrden();a.divOperarInstrumento.show()})}else{a.divOperarInstrumento.show()}};a.btnOperarInstrumentoContinuarClick=function(){var h={value:true};Core.Functions.Validations.toggleValidation(a.ddlOperarInstrumentoCuentas,false);if(!a.selectedAccount){Core.Functions.Validations.toggleValidation(a.ddlOperarInstrumentoCuentas,true);h.value=false}var f={idCuenta:((a.selectedAccount)?a.selectedAccount.idCuenta:""),FechaVencimiento:Core.Functions.Date.getDateAsString(new Date()),idTipoOperacion:a.defaultTipoOperacion,ticker:((a.ddlBuscadorInstrumento.swidget().selectedItem())?a.ddlBuscadorInstrumento.swidget().selectedItem().Ticker:a.defaultEspecie),Plazo:((a.plazo!=null)?a.plazo:a.pageOptions.plazoDefault),idMoneda:(a.lastDataCotizacionInstrumento)?a.lastDataCotizacionInstrumento.Cotizacion.idMoneda:null,Cantidad:Core.Functions.Validations.getValidatedNumericInputValue(a.txtOperarInstrumentoValorCantidad,h),Monto:null,PrecioDisparo:null,Observaciones:""};if(a.pageOptions.operarFIX&&a.ddlOperarInstrumentoTipoOrden.swidget().selectedItem()&&a.ddlOperarInstrumentoVencimientoOrden.swidget().selectedItem()){f.OrderType=Core.Functions.Validations.getValidatedDropDownValue(a.ddlOperarInstrumentoTipoOrden,h);f.TimeInForce=Core.Functions.Validations.getValidatedDropDownValue(a.ddlOperarInstrumentoVencimientoOrden,h);if(a.ddlOperarInstrumentoTipoOrden.swidget().value()==a.eTipoOrden.StopLimit||a.ddlOperarInstrumentoTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlOperarInstrumentoTipoOrden.swidget().value()==a.eTipoOrden.Stop){f.PrecioDisparo=Core.Functions.Validations.getValidatedNumericInputValue(a.txtOperarInstrumentoPrecioStop,h)}if(a.ddlOperarInstrumentoVencimientoOrden.swidget().value()==a.eVencimientoOrden.GoodTillDate){var c=new Date();c.setHours(0,0,0,0);var e=((a.txtOperarInstrumentoFechaVencimiento.swidget().value())?a.txtOperarInstrumentoFechaVencimiento.swidget().value():new Date());e.setHours(0,0,0,0);f.FechaVencimiento=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtOperarInstrumentoFechaVencimiento,h));if(c.getTime()>e.getTime()){h.value=false;Core.Functions.Validations.toggleValidation(a.txtOperarInstrumentoFechaVencimiento,true)}}if(a.chkOperarInstrumentoCantidadAMostrar.swidget().checked()){f.DisplayQty=Core.Functions.Validations.getValidatedNumericInputValue(a.txtOperarInstrumentoCantidadAMostrar,h);if(h.value&&(parseFloat(f.DisplayQty)<0||parseFloat(f.DisplayQty)>=parseFloat(f.Cantidad))){h.value=false;var d=new Core.Controls.Dialog("Aviso","La cantidad a mostrar debe ser positiva y menor a los nominales ingresados ",{displayButtons:{close:true,accept:false}}).show()}}}if(a.divOperarInstrumentoReplacePreviousOrders.is(":visible")&&a.chkOperarInstrumentoReplacePreviousOrders.swidget().checked()){f.ExecInst="x"}if(a.divOperarInstrumentoCancelInDisconnection.is(":visible")&&a.chkOperarInstrumentoCancelInDisconnection.swidget().checked()){if(f.ExecInst){f.ExecInst+=" o"}else{f.ExecInst="o"}}if(!a.ddlOperarInstrumentoTipoOrden.swidget().selectedItem()||(a.ddlOperarInstrumentoTipoOrden.swidget().value()!=a.eTipoOrden.Market&&a.ddlOperarInstrumentoTipoOrden.swidget().value()!=a.eTipoOrden.MarketWithLeftOverAsLimit)){f.PrecioLimite=Core.Functions.Validations.getValidatedNumericInputValue(a.txtOperarInstrumentoValorPrecio,h)}if(h.value){Core.Functions.Operar.srOperarEspeciesValidaciones(a.txtOperarInstrumentoValorCantidad,h)}if(!h.value){return}if(Core.Objects.Context.OperationCode){var g=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"operar/especies/solicitud",requestType:"POST",requestData:f});g.onSuccess=function(j){var i={idCuenta:a.selectedAccount.idCuenta,Operation:j.Operation,idOrden:j.idOrden,Codigo4D:Core.Objects.Context.OperationCode};var k=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"operar/especies/confirmar",requestType:"POST",requestData:i});k.onSuccess=function(l){};k.request()};g.request()}else{Core.Functions.Operar.srOperarEspecies(f,function(){},a.selectedAccount.idCuenta,a.idDefaultProfile,a.loaded,true)}};a.setTotalEstimado=function(){var c=a.txtOperarInstrumentoValorCantidad.val();var d=a.getPrecio();if((!c||c==0)||(!d||d==0)||(!a.lastDataCotizacionInstrumento||a.lastDataCotizacionInstrumento.Cotizacion.Contratos==0)){a.lblOperarInstrumentoTotal.text("")}else{var e=c*d*a.lastDataCotizacionInstrumento.Cotizacion.Contratos;a.lblOperarInstrumentoTotal.text(e.toFixed(2))}};a.setMargenRequerido=function(){a.lblOperarInstrumentoMargenRequerido.removeClass("field-varnegativa");var c=a.txtOperarInstrumentoValorCantidad.val();var e=(a.lastDataCotizacionInstrumento.Cotizacion.Cantidad?a.lastDataCotizacionInstrumento.Cotizacion.Cantidad:0);if(a.lastDataCotizacionInstrumento){if(e==0||(e>0&&a.defaultTipoOperacion==Core.Enums.eEspeciesTipoOperacion.Compra)||(e<0&&a.defaultTipoOperacion==Core.Enums.eEspeciesTipoOperacion.Venta)){if((!c||c==0)||(a.lastDataCotizacionInstrumento.MargenRequerido==0)||(a.lastDataCotizacionInstrumento.Cotizacion.Contratos==0)){a.lblOperarInstrumentoMargenRequerido.text("")}else{var d=c*a.lastDataCotizacionInstrumento.Cotizacion.MargenRequerido*a.lastDataCotizacionInstrumento.Cotizacion.Contratos;a.lblOperarInstrumentoMargenRequerido.text(d.toFixed(2));if(d&&a.disponibleActual&&d>a.disponibleActual){a.lblOperarInstrumentoMargenRequerido.addClass("field-varnegativa")}}}else{if((!c||c==0)||(a.lastDataCotizacionInstrumento.Cotizacion.MargenRequerido==0)||(a.lastDataCotizacionInstrumento.Cotizacion.Contratos==0)){a.lblOperarInstrumentoMargenRequerido.text("")}else{var d=(c-(2*Math.abs(e)))*a.lastDataCotizacionInstrumento.Cotizacion.MargenRequerido*a.lastDataCotizacionInstrumento.Cotizacion.Contratos;d=(d<0)?0:d;a.lblOperarInstrumentoMargenRequerido.text(d.toFixed(2));if(d&&a.disponibleActual&&d>a.disponibleActual){a.lblOperarInstrumentoMargenRequerido.addClass("field-varnegativa")}}}}else{a.lblOperarInstrumentoMargenRequerido.text("")}};a.setHighlight=function(c,d,e){if(d!=null&&e!=null){if(d>e){Core.Functions.Highlight(c,{cssClass:"animation-green-pulse"})}else{if(d<e){Core.Functions.Highlight(c,{cssClass:"animation-red-pulse"})}}}};a.socketMessage=function(e){if(a.loaded){var f=JSON.parse(e.data);if(a.ordenes&&(f.idCuenta||f.idOrden)){var d={ordenes:[]};d.ordenes.push(f);a.refreshOrdenes(d.ordenes)}else{if(a.watchlistItems){var c={cotizaciones:[]};c.cotizaciones.push(f);a.refreshWatchlistItems(c.cotizaciones);a.refreshWatchlist=false;if(a.ticker&&a.securityID==f.SecurityID&&a.lastDataCotizacionInstrumento){a.loadCotizacionInstrumento(a.processWebSocketData(f));a.executeCotizacionInstrumento=false}}}}};a.processWebSocketData=function(d){var g={Cotizacion:{},Profundidad:[]};g.Cotizacion.Descripcion=a.lastDataCotizacionInstrumento.Cotizacion.Descripcion;g.Cotizacion.SimboloMoneda=a.lastDataCotizacionInstrumento.Cotizacion.SimboloMoneda;g.Cotizacion.plazo=a.lastDataCotizacionInstrumento.Cotizacion.plazo;g.Cotizacion.Contratos=a.lastDataCotizacionInstrumento.Cotizacion.Contratos;g.Cotizacion.idMoneda=a.lastDataCotizacionInstrumento.Cotizacion.idMoneda;g.Cotizacion.MargenRequerido=a.lastDataCotizacionInstrumento.Cotizacion.MargenRequerido;g.Cotizacion.Cantidad=a.lastDataCotizacionInstrumento.Cotizacion.Cantidad;g.Cotizacion.idWatchlist=a.lastDataCotizacionInstrumento.Cotizacion.idWatchlist;g.Cotizacion.UltimoPrecio=d.u;var c=new Date();var f=(c.getMonth()+1).toString();if(f.length==1){f="0"+f}var e=(c.getDate()).toString();if(e.length==1){e="0"+e}g.Cotizacion.UltimaOperacion=(d.f.length==10)?d.f:c.getFullYear()+"-"+f+"-"+e+" "+d.f;g.Cotizacion.PrecioApertura=d.ap;g.Cotizacion.PrecioMaximo=d.max;g.Cotizacion.Volumen=d.v;g.Cotizacion.PrecioCierreAnterior=d.ant;g.Cotizacion.PrecioMinimo=d.min;g.Cotizacion.PrecioCompra=d.pc;g.Cotizacion.PrecioVenta=d.pv;g.Cotizacion.CantCompra=d.cc;g.Cotizacion.CantVenta=d.cv;if(d.cc2||d.pc2||d.pv2||d.cv2){g.Profundidad.push({CantCompra:d.cc2,PrecioCompra:d.pc2,PrecioVenta:d.pv2,CantVenta:d.cv2})}if(d.cc3||d.pc3||d.pv3||d.cv3){g.Profundidad.push({CantCompra:d.cc3,PrecioCompra:d.pc3,PrecioVenta:d.pv3,CantVenta:d.cv3})}if(d.cc4||d.pc4||d.pv4||d.cv4){g.Profundidad.push({CantCompra:d.cc4,PrecioCompra:d.pc4,PrecioVenta:d.pv4,CantVenta:d.cv4})}if(d.cc5||d.pc5||d.pv5||d.cv5){g.Profundidad.push({CantCompra:d.cc5,PrecioCompra:d.pc5,PrecioVenta:d.pv5,CantVenta:d.cv5})}return g}};Core.Business.Watchlists=new function(){var a=this;a.idDefaultAccount=0;a.idDefaultProfile=0;a.id="watchlists";a.optionsCotizaciones=null;a.divs=[];a.idWatchListByDefault=0;a.maxToken=0;a.lastData=null;a.timerId=null;a.timerIdForceRefresh=null;a.loaded=false;a.refresh=false;a.forceRefresh=false;a.init=function(b,c){Core.loadPage("watchlists.html",function(){document.title="Watchlists";a.optionsCotizaciones=Core.Functions.Context.Profiles.getPageOptionsByMenu("cotizaciones",Core.Objects.Context.Profiles[c]);a.idDefaultAccount=b;a.idDefaultProfile=c;a.divs=[];a.maxToken=0;a.lastData=null;a.loaded=false;a.refresh=false;a.forceRefresh=false;if(!Core.Objects.Context.Watchlists){var e=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"watchlists",requestType:"GET"});e.onSuccess=function(f){Core.Objects.Context.Watchlists=f.watchlists;if(!Core.Functions.Validations.isBlockedStorage()&&Core.Functions.Persistence.getStorage()){Core.Functions.Persistence.getStorage().setItem("CoreContext",LZString.compressToUTF16(JSON.stringify(Core.Objects.Context)))}};e.request()}var d=window.setInterval(function(){if(Core.Objects.Context.Watchlists){window.clearInterval(d);if($.grep(Core.Objects.Context.Watchlists,function(h,g){return h.propia==1}).length==0){a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.showNoWatchlistMessage()},"Core.Business.Watchlists");return}a.setTabs(Core.Objects.Context.Watchlists);for(var f=0;f<a.divs.length;f++){Core.Functions.grid.Cotizaciones.initGrid(a.divs[f],true,false,true,0,a.divs[f].attr("idWatchlist"),function(g){a.removeWatchlistPanel(g)},a.optionsCotizaciones.cot_profundidad,null,a.idDefaultAccount,a.idDefaultProfile)}a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,b,c,function(){a.loadTab(a.divs[0],"watchlists/"+a.idWatchListByDefault,a.idWatchListByDefault)},"Core.Business.Watchlists")}},50)})};a.setTabs=function(k){var h=$(".tab-buttons");var j=$(".tab-content");var e=true;for(var d=0;d<k.length;d++){if(k[d].propia!=1){continue}var f=$("<li>").appendTo(h);if(e){f.addClass("active");a.idWatchListByDefault=k[d].idWatchlist}var b=$("<a data-toggle='tab' idWatchlist='"+k[d].idWatchlist+"' title='Click derecho para eliminar' href='#"+k[d].idWatchlist+"'>"+k[d].nombre+"</a>").appendTo(f);var c=$("<div id='"+k[d].idWatchlist+"' class='tab-pane fade col-lg-12 col-md-12 col-sm-12 col-xs-12 form-tabla'>").appendTo(j);if(e){c.addClass("in active")}c=$("<div class='row' />").appendTo(c);c=$("<div class='col-md-12 col-sm-12 col-xs-12 cuenta-tabla' />").appendTo(c);c=$("<div class='col-md-12 col-sm-12 col-xs-12 radius shadow bgBlanco pad0 padding-top:30px' />").appendTo(c);c=$("<div class='div-grid-cotizacion sui-grid sui-grid-core' idWatchlist='"+k[d].idWatchlist+"' />").appendTo(c);b.click(function(){var i=$(this).attr("idWatchlist");a.loadTab($.grep(a.divs,function(m,l){return m.attr("idWatchlist")==i})[0],"watchlists/"+i,i)});var g=[];g.push({Name:"Eliminar esta watchlist",Id:k[d].idWatchlist,onClick:function(l,i){a.deleteWatchlist(l.Id)}});Core.Controls.Menu(b,g,{my:"left top",at:"left bottom",of:b},Core.Controls.eMenuTriggerButton.MouseRight,function(i){return i});a.divs.push(c);e=false}};a.loadTab=function(b,d,c){Core.Functions.grid.Cotizaciones.details=[];a.maxToken=0;a.lastData=null;a.refresh=false;a.forceRefresh=false;if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({panel:0,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(e){}}window.clearInterval(a.timerId);Core.Objects.Context.Timers.remove(a.timerId);window.clearInterval(a.timerIdForceRefresh);Core.Objects.Context.Timers.remove(a.timerIdForceRefresh);Core.Functions.grid.Cotizaciones.loadGrid(b,null,d,a.lastData,a.maxToken,null,null,function(){return true},function(e,f){a.lastData=e;a.maxToken=f;a.loaded=true;a.refresh=true},a.optionsCotizaciones.cot_profundidad);a.timerId=window.setInterval(function(){if(a.loaded&&(a.refresh||a.forceRefresh)){Core.Functions.grid.Cotizaciones.loadGrid(b,null,d,a.lastData,a.maxToken,null,null,function(){return true},function(e,f){a.lastData=e;a.maxToken=f},a.optionsCotizaciones.cot_profundidad);a.forceRefresh=false}a.refresh=true},Core.Functions.grid.Cotizaciones.REFRESH_TIME);Core.Objects.Context.Timers.push(a.timerId);a.timerIdForceRefresh=window.setInterval(function(){a.forceRefresh=true},600000);Core.Objects.Context.Timers.push(a.timerIdForceRefresh);if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.send(JSON.stringify({idwatchlist:c,token:Core.Objects.Context.Token}));Core.Objects.Context.WebSocket.onmessage=function(f){if(a.loaded){var e={cotizaciones:[]};e.cotizaciones.push(JSON.parse(f.data));Core.Functions.grid.Cotizaciones.refreshGrid(e,b,null,a.lastData,a.maxToken,null,null,function(){return true},function(g,h){a.lastData=g;a.maxToken=h;a.refresh=false},a.optionsCotizaciones.cot_profundidad)}}}};a.clearTimer=function(){window.clearInterval(a.timerId);Core.Objects.Context.Timers.remove(a.timerId)};a.showNoWatchlistMessage=function(){new Core.Controls.Dialog("Aviso","Usted no tiene ninguna watchlists configurada, puede crear una nueva desde cualquier pantalla de Cotizaciones",{displayButtons:{close:true,accept:false}}).show()};a.deleteWatchlist=function(b){var c=new Core.Ajax.ServerRequest({requestUrl:"watchlists/"+b,requestType:"DELETE"});c.onSuccess=function(){a.removeWatchlistPanel(b)};c.request()};a.removeWatchlistPanel=function(b){var c=$.grep(Core.Objects.Context.Watchlists,function(e,d){return e.idWatchlist==b})[0];Core.Objects.Context.Watchlists.remove(c);if(!Core.Functions.Validations.isBlockedStorage()&&Core.Functions.Persistence.getStorage()){Core.Functions.Persistence.getStorage().setItem("CoreContext",LZString.compressToUTF16(JSON.stringify(Core.Objects.Context)))}a.clearTimer();Core.Business.Watchlists.init(a.idDefaultAccount,a.idDefaultProfile)}};Core.Business.Operar=new Object();Core.Business.Operar.CanjeMonedas=new function(){var a=this;a.id="canjeMonedas";a.decimalCount=6;a.detalleDisponible=null;a.especies=null;a.idDefaultAccount=null;a.idDefaultProfile=null;a.divMain=null;a.divCuenta=null;a.ddlMonedaDestino=null;a.ddlMonedaOrigen=null;a.lblMejorPrecioDisponible=null;a.lblDiasParkingRequerido=null;a.ddlInstrumento=null;a.lblCantidad=null;a.txtCantidad=null;a.lblTitleTotal=null;a.lblTotal=null;a.lblDisponible=null;a.divObservaciones=null;a.txtObservaciones=null;a.btnContinuar=null;a.init=function(c,d,e){a.idDefaultAccount=c;a.idDefaultProfile=d;a.precioActual=null;$.extend(true,a,e);if(Core.Objects.Context.TieneC4D==1){Core.loadPage("operar-canje-monedas.html",function(){document.title="Operación de Conversión de Moneda";a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,c,d,function(){a.loadControls()},"Core.Business.Operar.CanjeMonedas")})}else{var b=new Core.Controls.Dialog("Aviso","<p>Para poder Operar debe generar el código de operación de cuatro dígitos desde Configuración de Cuenta.<br/> <a onclick=\"$('.close-btn').click(); Core.Business.AccountSettings.init("+c+", "+d+');">Haga Click Aquí para ir a Configuración de Cuenta.</a></p>',{displayButtons:{close:true,accept:false}}).show()}};a.initControls=function(){a.divMain=$(".div-main");a.divCuenta=$(".div-cuenta");a.lblCuenta=$(".label-cuenta");a.ddlMonedaDestino=$(".dropdown-moneda-destino");a.ddlMonedaOrigen=$(".dropdown-moneda-origen");a.lblMejorPrecioDisponible=$(".label-mejor-precio-disponible");a.lblDiasParkingRequerido=$(".label-dias-parking-requeridos");a.ddlInstrumento=$(".dropdown-instrumento");a.divDisponible=$(".div-disponible");a.lblDisponible=$(".label-disponible");a.lblCantidad=$(".label-cantidad");a.txtCantidad=$(".textbox-cantidad");a.lblTitleTotal=$(".label-title-total");a.lblTotal=$(".label-total");a.divObservaciones=$(".div-observaciones");a.txtObservaciones=$(".text-observaciones");a.btnContinuar=$(".btn-continuar");a.ddlMonedaDestino.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{idMoneda}",events:{select:function(b){a.setInstrumentos()}}});a.ddlMonedaOrigen.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{idMoneda}",events:{select:function(b){a.setInstrumentos()}}});a.ddlInstrumento.shieldDropDown({dataSource:{data:[]},textTemplate:"{Instrumento}",valueTemplate:"{SecurityID}",events:{select:function(b){a.setInstrumento()}}});new Core.Controls.DecimalPicker(a.txtCantidad,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){a.setTotal()}});a.txtObservaciones.shieldTextBox({});if(Core.Objects.Context.Configuration.idAplicacion==1){a.divObservaciones.hide()}a.btnContinuar.click(function(){a.btnContinuarClick()})};a.loadControls=function(){Core.Functions.Operar.setComitente(a.lblCuenta,a.header.selectedIdAccount,false);var b=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divMain,requestUrl:"especies",requestType:"GET",requestData:{panel:Core.Enums.ePanel.DolarBolsa}});b.onSuccess=function(c){a.especies=c.especies?c.especies:[];var d=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divMain,requestUrl:"detalledisponible/"+encodeURIComponent(a.header.selectedIdAccount),requestType:"GET",requestData:{Fecha:Core.Functions.Date.getDateAsString(new Date())}});d.onSuccess=function(e){a.detalleDisponible=e;a.setMonedas()};d.request()};b.request()};a.setMonedas=function(){var c=[];var b=[];a.especies.forEach(function(f,g){if(!$.grep(c,function(h,i){return h.idMoneda==f.idMonedaOrigen})[0]){c.push({idMoneda:f.idMonedaOrigen,Descripcion:f.MonedaOrigen})}if(!$.grep(b,function(h,i){return h.idMoneda==f.idMonedaDestino})[0]){b.push({idMoneda:f.idMonedaDestino,Descripcion:f.MonedaDestino})}});var e=a.ddlMonedaOrigen.swidget().initialOptions;e.dataSource.data=c;a.ddlMonedaOrigen.swidget().refresh(e);var d=a.ddlMonedaDestino.swidget().initialOptions;d.dataSource.data=b;a.ddlMonedaDestino.swidget().refresh(d);a.setInstrumentos()};a.setInstrumentos=function(){var d=a.ddlMonedaOrigen.swidget().selectedItem()?a.ddlMonedaOrigen.swidget().selectedItem().idMoneda:0;var c=a.ddlMonedaDestino.swidget().selectedItem()?a.ddlMonedaDestino.swidget().selectedItem().idMoneda:0;var e=$.grep(a.especies,function(g,h){return g.idMonedaOrigen==d&&g.idMonedaDestino==c});var b=$.grep(e,function(g,h){return g.EsDefault})[0];var f=a.ddlInstrumento.swidget().initialOptions;f.dataSource.data=e;f.value=b?b.Instrumento:"";a.ddlInstrumento.swidget().refresh(f);a.setInstrumento()};a.setInstrumento=function(){if(a.ddlInstrumento.swidget().selectedItem()){Core.Functions.Operar.setDisponible(a.detalleDisponible.disponible,a.ddlInstrumento.swidget().selectedItem().idMonedaOrigen,a.ddlInstrumento.swidget().selectedItem().plazoDisponible,a.lblDisponible,a.divDisponible);Core.Functions.Operar.setColorByTipoOperacion(a.ddlInstrumento.swidget().selectedItem().idTipoOperacion,a.divMain,a.divCuenta);a.lblCantidad.text(a.ddlInstrumento.swidget().selectedItem().idTipoOperacion==Core.Enums.eEspeciesTipoOperacion.CompraDolarBolsa?"Monto a comprar":"Monto a vender");a.lblTitleTotal.text(a.ddlInstrumento.swidget().selectedItem().idTipoOperacion==Core.Enums.eEspeciesTipoOperacion.CompraDolarBolsa?"Monto Bruto estimado a debitar":"Monto bruto estimado a acreditar");a.lblDiasParkingRequerido.text(a.ddlInstrumento.swidget().selectedItem().DiasParking);var b=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divMain,secureRequest:true,requestUrl:"cotizacioninstrumento",requestType:"GET",requestData:{ticker:a.ddlInstrumento.swidget().selectedItem().Ticker,plazo:a.ddlInstrumento.swidget().selectedItem().plazoInstrumento}});b.onSuccess=function(c){if(c&&c.Cotizacion){a.precioActual={SimboloMoneda:c.Cotizacion.SimboloMoneda,Precio:a.ddlInstrumento.swidget().selectedItem().idTipoOperacion==Core.Enums.eEspeciesTipoOperacion.CompraDolarBolsa?c.Cotizacion.PrecioVenta:c.Cotizacion.PrecioCompra};a.lblMejorPrecioDisponible.text(a.precioActual.SimboloMoneda+" "+a.precioActual.Precio)}else{a.precioActual=null;a.lblMejorPrecioDisponible.text("No disponible")}a.setTotal()};b.request()}else{a.lblDiasParkingRequerido.text("No disponible");a.lblMejorPrecioDisponible.text("No disponible");a.precioActual=null;a.setTotal()}};a.setTotal=function(){if(a.precioActual!=null&&a.txtCantidad.val()){var b=(a.precioActual.Precio.toFixed(2)*Core.Functions.Decimal.parseFloat(a.txtCantidad.val()).toFixed(2)).toFixed(2);a.lblTotal.text(a.precioActual.SimboloMoneda+" "+b)}else{a.lblTotal.text("")}};a.btnContinuarClick=function(){var d={value:true};var b={idCuenta:a.header.selectedIdAccount,idTipoOperacion:a.ddlInstrumento.swidget().selectedItem()?a.ddlInstrumento.swidget().selectedItem().idTipoOperacion:null,Cantidad:Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidad,d),SecurityID:Core.Functions.Validations.getValidatedDropDownValue(a.ddlInstrumento,d),Observaciones:a.txtObservaciones.val()};if(!d.value){return}var c=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divMain,secureRequest:true,requestUrl:"operar/dolarbolsa/solicitud",requestType:"POST",requestData:b});c.onSuccess=function(i){var f="Comitente N°"+i.NumComitente+" - "+i.DescripcionCuenta;var g="S.E:U.O. (Salvo error u omisión) <br>Los valores son estimados; los valores finales de la operación surgiran de la ejecución misma y reflejados en el boleto.";var h={data:i,idDefaultProfile:a.idDefaultProfile,idAccount:a.header.selectedIdAccount,generalTitle:"CONFIRMACION DE ORDEN",title:"Operación de Dólares",accountDescription:f,footerHtml:g,urlMethod:"operar/dolarbolsa/confirmar",codigo4DDescription:"Ingrese su código de operación de cuatro dígitos:",onConfirm:function(){Core.Functions.Operar.refreshDisponible(a.detalleDisponible,function(){Core.Functions.Operar.setDisponible(a.detalleDisponible.disponible,a.ddlInstrumento.swidget().selectedItem().idMonedaOrigen,a.ddlInstrumento.swidget().selectedItem().plazoDisponible,a.lblDisponible,a.divDisponible)},a.header.selectedIdAccount,true)}};var e=new Core.Controls.OperarConfirmation(h).show()};c.request()}};Core.Business.Operar.ConversionEspecies=new function(){var a=this;a.id="conversionEspecies";a.init=function(d,e,f){if(Core.Objects.Accounts){var b=$.grep(Core.Objects.Accounts,function(h,g){return h.idCuenta==d})[0];if(b&&b.NumComitente==""){return}}a.decimalCount=6;a.idDefaultAccount=d;a.idDefaultProfile=e;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[e]);a.operarOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu("operar",Core.Objects.Context.Profiles[e]);a.defaultTipoOperacion=Core.Enums.eEspeciesTipoOperacion.ConversionEspecies;a.defaultPlazo=a.pageOptions.plazoDefault;$.extend(true,a,f);if(Core.Objects.Context.TieneC4D==1){Core.loadPage("conversion-especies.html",function(){document.title="Conversión Especies";a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,d,e,function(){var g=$.grep(Core.Objects.Accounts,function(i,h){return i.idCuenta==a.header.selectedIdAccount})[0];if(g.NumComitente==""){Core.Business.PosicionConsolidada.init(a.header.selectedIdAccount,a.idDefaultProfile);return}a.loaded=false;a.loadControls()},"Core.Business.Operar.ConversionEspecies")})}else{var c=new Core.Controls.Dialog("Aviso","<p>Para poder Operar debe generar el código de operación de cuatro dígitos desde Configuración de Cuenta.<br/> <a onclick=\"$('.close-btn').click(); Core.Business.AccountSettings.init("+d+", "+e+');">Haga Click Aquí para ir a Configuración de Cuenta.</a></p>',{displayButtons:{close:true,accept:false}}).show()}};a.initControls=function(){a.divMain=$(".div-main");a.divCuenta=$(".div-cuenta");a.ddlTipoOperacion=$(".dropdown-tipo-operacion");a.ddlEspecie=$(".dropdown-especie");a.lblCuenta=$(".label-cuenta");a.ddlPlazo=$(".dropdown-plazo");a.txtValorCantidad=$(".textbox-cantidad");a.divObservaciones=$(".div-observaciones");a.txtObservaciones=$(".text-observaciones");a.btnContinuar=$(".btn-continuar");a.ddlTipoOperacion.shieldDropDown({dataSource:{data:[{value:Core.Enums.eEspeciesTipoOperacion.ConversionEspecies,text:"Conversión de Especies"}]},textTemplate:"{text}",valueTemplate:"{value}",value:a.defaultTipoOperacion.toString(),events:{select:function(b){Core.Functions.Operar.setColorByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.divMain,a.divCuenta);Core.Functions.Operar.setEspecieByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlEspecie,Core.Enums.ePanel.ConversionEspecies,a.ddlPlazo.swidget().selectedItem().value,a.header.selectedIdAccount,a.loaded,function(){a.clearControls(true)})}}});a.ddlPlazo.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",value:a.defaultPlazo.toString(),events:{select:function(b){Core.Functions.Operar.setEspecieByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlEspecie,Core.Enums.ePanel.ConversionEspecies,a.ddlPlazo.swidget().selectedItem().value,a.header.selectedIdAccount,a.loaded,function(){a.clearControls(true)})}}});Core.Functions.Operar.setPlazos(a.ddlPlazo,a.pageOptions.plazosHabilitados);a.ddlEspecie.shieldComboBox({dataSource:{data:[]},valueTemplate:"{DisplayTicker}",textTemplate:"{DisplayTicker} | {Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}},events:{select:function(b){if(b.index>=0){a.clearControls(false)}}}});new Core.Controls.DecimalPicker(a.txtValorCantidad,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:""});a.txtObservaciones.shieldTextBox({});if(Core.Objects.Context.Configuration.idAplicacion==1){a.divObservaciones.hide()}a.btnContinuar.click(function(){a.btnContinuarClick()})};a.loadControls=function(){Core.Functions.Operar.setColorByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.divMain,a.divCuenta);Core.Functions.Operar.setComitente(a.lblCuenta,a.header.selectedIdAccount,a.loaded);Core.Functions.Operar.setEspecieByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlEspecie,Core.Enums.ePanel.ConversionEspecies,a.ddlPlazo.swidget().selectedItem().value,a.header.selectedIdAccount,a.loaded,function(){a.clearControls(true)})};a.btnContinuarClick=function(){var d={value:true};Core.Functions.Validations.getValidatedDropDownValue(a.ddlEspecie,d);var b={idCuenta:a.header.selectedIdAccount,idTipoOperacion:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,d),ticker:(a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().Ticker:null,Plazo:Core.Functions.Validations.getValidatedDropDownValue(a.ddlPlazo,d),Cantidad:Core.Functions.Validations.getValidatedNumericInputValue(a.txtValorCantidad,d),Observaciones:a.txtObservaciones.val()};if(d.value){Core.Functions.Operar.srOperarEspeciesValidaciones(a.txtValorCantidad,d)}if(!d.value){return}var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"operar/conversionespecies/solicitud",requestType:"POST",requestData:b});c.onSuccess=function(h){var e="Comitente N°"+h.NumComitente+" - "+h.DescripcionCuenta;var f="S.E:U.O. (Salvo error u omisión) <br>Los valores son estimados; los valores finales de la operación surgiran de la ejecución misma y reflejados en el boleto.";var g={data:h,idDefaultProfile:a.idDefaultProfile,idAccount:a.header.selectedIdAccount,generalTitle:"CONFIRMACION DE ORDEN",accountDescription:e,footerHtml:f,urlMethod:"operar/conversionespecies/confirmar",codigo4DDescription:"Ingrese su código de operación de cuatro dígitos:",onConfirm:function(){},stayInPage:false};new Core.Controls.OperarConfirmation(g).show()};c.request()};a.clearControls=function(b){if(b){a.ddlEspecie.swidget().refresh()}a.txtValorCantidad.val("");a.txtObservaciones.val("")}};Core.Business.Operar.Acciones=new function(){var a=this;a.id="acciones";a.loaded=false;a.detalleDisponible=null;a.idDefaultAccount=null;a.idDefaultProfile=null;a.decimalCount=6;a.eVencimientoOrden={GoodTillDate:6};a.eTipoOrden={Market:1,Limit:2,StopMerval:3,StopLimit:4,Stop:"z",MarketWithLeftOverAsLimit:"K",MarketIfTouched:"J"};a.divMain=null;a.divCuenta=null;a.ddlTipoOperacion=null;a.ddlEspecie=null;a.lblCuenta=null;a.ddlPlazo=null;a.divDisponible=null;a.lblDisponible=null;a.lblUltimoPrecio=null;a.lblVariacion=null;a.lblMejorOfertaCompra=null;a.lblMejorOfertaVenta=null;a.divOperarFix=null;a.divReplacePreviousOrders=null;a.chkReplacePreviousOrders=null;a.divCancelInDisconnection=null;a.chkCancelInDisconnection=null;a.divTipoOrden=null;a.ddlTipoOrden=null;a.divVencimientoOrden=null;a.ddlVencimientoOrden=null;a.divPrecioStop=null;a.txtPrecioStop=null;a.divFechaVencimiento=null;a.txtFechaVencimiento=null;a.txtValorCantidad=null;a.txtValorPrecio=null;a.lblTotal=null;a.chkCantidadAMostrar=null;a.txtCantidadAMostrar=null;a.divOperarPrecarga=null;a.divFechaEjecucion=null;a.ddlMinutosEjecucion=null;a.txtFechaEjecucion=null;a.ddlHoraEjecucion=null;a.divFechaExpiracion=null;a.ddlMinutosExpiracion=null;a.txtFechaExpiracion=null;a.ddlHoraExpiracion=null;a.btnAyudaEjecutarValidaciones=null;a.chkEjecutarValidaciones=null;a.chkContinuarAutomaticamente=null;a.divObservaciones=null;a.txtObservaciones=null;a.btnContinuar=null;a.defaultPlazo=null;a.defaultTipoOperacion=null;a.defaultEspecie=null;a.defaultValorCantidad=null;a.defaultValorLimite=null;a.disponibleActual=null;a.pageOptions=null;a.operarOptions=null;a.ultimaCotizacion=null;a.ordenPrecargada=null;a.init=function(d,e,f){if(Core.Objects.Accounts){var b=$.grep(Core.Objects.Accounts,function(h,g){return h.idCuenta==d})[0];if(b&&b.NumComitente==""){return}}a.idDefaultAccount=d;a.idDefaultProfile=e;a.defaultTipoOperacion=Core.Enums.eEspeciesTipoOperacion.Venta;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[e]);a.operarOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu("operar",Core.Objects.Context.Profiles[e]);a.defaultEspecie="";a.defaultValorCantidad="";a.defaultValorLimite="";a.defaultPlazo=a.pageOptions.plazoDefault;a.ordenPrecargada=null;$.extend(true,a,f);if(Core.Objects.Context.TieneC4D==1){Core.loadPage("operar-acciones.html",function(){document.title="Operar Acciones";a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,d,e,function(){var g=$.grep(Core.Objects.Accounts,function(i,h){return i.idCuenta==a.header.selectedIdAccount})[0];if(g.NumComitente==""){Core.Business.PosicionConsolidada.init(a.header.selectedIdAccount,a.idDefaultProfile);return}a.loaded=false;a.loadControls()},"Core.Business.Operar.Acciones")})}else{var c=new Core.Controls.Dialog("Aviso","<p>Para poder Operar debe generar el código de operación de cuatro dígitos desde Configuración de Cuenta.<br/> <a onclick=\"$('.close-btn').click(); Core.Business.AccountSettings.init("+d+", "+e+');">Haga Click Aquí para ir a Configuración de Cuenta.</a></p>',{displayButtons:{close:true,accept:false}}).show()}};a.initControls=function(){a.divMain=$(".div-main");a.divCuenta=$(".div-cuenta");a.ddlTipoOperacion=$(".dropdown-tipo-operacion");a.ddlEspecie=$(".dropdown-especie");a.lblCuenta=$(".label-cuenta");a.divDisponible=$(".div-disponible");a.lblDisponible=$(".label-disponible");a.ddlPlazo=$(".dropdown-plazo");a.lblUltimoPrecio=$(".label-ultimo-precio");a.lblVariacion=$(".label-variacion");a.lblMejorOfertaCompra=$(".label-mejor-oferta-compra");a.lblMejorOfertaVenta=$(".label-mejor-oferta-venta");a.divOperarFix=$(".div-operar-fix");a.divOperarFix.hide();a.divReplacePreviousOrders=$(".div-replace-previous-orders");a.chkReplacePreviousOrders=$(".checkbox-replace-previous-orders");a.divCancelInDisconnection=$(".div-cancel-in-disconnection");a.chkCancelInDisconnection=$(".checkbox-cancel-in-disconnection");a.divTipoOrden=$(".div-tipo-orden");a.ddlTipoOrden=$(".dropdown-tipo-orden");a.divVencimientoOrden=$(".div-vencimiento-orden");a.ddlVencimientoOrden=$(".dropdown-vencimiento-orden");a.divPrecioStop=$(".div-precio-stop");a.txtPrecioStop=$(".textbox-precio-stop");a.divFechaVencimiento=$(".div-fecha-vencimiento");a.txtFechaVencimiento=$(".date-fecha-vencimiento");a.txtValorCantidad=$(".textbox-cantidad");a.txtValorPrecio=$(".textbox-precio");a.lblTotal=$(".label-precio-total");a.divObservaciones=$(".div-observaciones");a.txtObservaciones=$(".text-observaciones");a.txtCantidadAMostrar=$(".textbox-cantidad-a-mostrar");a.chkCantidadAMostrar=$(".checkbox-cantidad-a-mostrar");a.divCantidadAMostrar=$(".div-cantidad-a-mostrar");a.divCantidadAMostrar.hide();a.divSeleccionPrecarga=$(".div-seleccion-precarga");a.divSeleccionPrecarga.hide();if(a.pageOptions&&a.pageOptions.precargar){a.divSeleccionPrecarga.show()}a.btnPrecarga=$(".btn-precarga");a.btnNormal=$(".btn-normal");a.divOperarPrecarga=$(".div-operar-precarga");a.divFechaEjecucion=$(".div-fecha-ejecucion");a.ddlMinutosEjecucion=$(".dropdown-minutos-ejecucion");a.txtFechaEjecucion=$(".date-fecha-ejecucion");a.ddlHoraEjecucion=$(".dropdown-hora-ejecucion");a.divFechaExpiracion=$(".div-fecha-expiracion");a.ddlMinutosExpiracion=$(".dropdown-minutos-expiracion");a.txtFechaExpiracion=$(".date-fecha-expiracion");a.ddlHoraExpiracion=$(".dropdown-hora-expiracion");a.btnAyudaEjecutarValidaciones=$(".btn-ayuda-ejecutar-validaciones");a.chkEjecutarValidaciones=$(".checkbox-ejecutar-validaciones");a.chkContinuarAutomaticamente=$(".checkbox-continuar-automaticamente");a.btnContinuar=$(".btn-continuar");a.ddlTipoOperacion.shieldDropDown({dataSource:{data:[{value:Core.Enums.eEspeciesTipoOperacion.Compra,text:"Compra"},{value:Core.Enums.eEspeciesTipoOperacion.Venta,text:"Venta"}]},textTemplate:"{text}",valueTemplate:"{value}",value:(a.ordenPrecargada?a.ordenPrecargada.idTipoOperacion.toString():a.defaultTipoOperacion.toString()),events:{select:function(e){a.clearControls(true);Core.Functions.Operar.setEspecieByTipoOperacion(e.item.value,a.ddlEspecie,Core.Enums.ePanel.Acciones,a.ddlPlazo.swidget().selectedItem().value,a.header.selectedIdAccount,a.loaded,function(){a.loadControlsByEspecie();a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem())});Core.Functions.Operar.setColorByTipoOperacion(e.item.value,a.divMain,a.divCuenta)}}});a.ddlEspecie.shieldComboBox({dataSource:{data:[]},valueTemplate:"{DisplayTicker}",value:(a.ordenPrecargada?a.ordenPrecargada.DisplayTicker:a.defaultEspecie),textTemplate:"{DisplayTicker} | {Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}},events:{select:function(f){if(f.index>=0){a.clearControls(false);a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem());Core.Functions.Operar.setLabelsByEspecie(a.ddlEspecie,a.ddlPlazo.swidget().selectedItem().value,a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(e){a.ultimaCotizacion=e;if(a.operarOptions.operarFIX){Core.Functions.Operar.setControlsOperarFix(a.ultimaCotizacion,a.ddlTipoOrden,a.ddlVencimientoOrden,a.divOperarFix,a.divReplacePreviousOrders,a.divCancelInDisconnection,false,function(){a.setControlsByVencimientoOrden();a.setControlsByTipoOrden()})}})}}}});a.ddlPlazo.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",value:(a.ordenPrecargada?a.ordenPrecargada.Plazo.toString():a.defaultPlazo.toString()),events:{select:function(e){Core.Functions.Operar.setEspecieByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlEspecie,Core.Enums.ePanel.Acciones,a.ddlPlazo.swidget().selectedItem().value,a.header.selectedIdAccount,a.loaded,function(){a.loadControlsByEspecie();a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem());Core.Functions.Operar.setLabelsByEspecie(a.ultimaCotizacion,a.ddlPlazo.swidget().selectedItem().value,a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(f){a.ultimaCotizacion=f;Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))})})}}});Core.Functions.Operar.setPlazos(a.ddlPlazo,a.pageOptions.plazosHabilitados);a.ddlTipoOrden.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{Valor}",value:(a.ordenPrecargada?a.ordenPrecargada.OrderType:""),events:{select:function(e){a.setControlsByTipoOrden()}}});a.ddlVencimientoOrden.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{Valor}",value:(a.ordenPrecargada?a.ordenPrecargada.TimeInForce:""),events:{select:function(e){a.setControlsByVencimientoOrden()}}});new Core.Controls.DecimalPicker(a.txtPrecioStop,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))},defaultValue:(a.ordenPrecargada?a.ordenPrecargada.PrecioDisparo:0)});a.txtFechaVencimiento.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.ordenPrecargada?Core.Functions.Date.getDateByStringWithoutSeparator(a.ordenPrecargada.FechaVencimiento):new Date())});new Core.Controls.DecimalPicker(a.txtValorCantidad,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))},defaultValue:(a.ordenPrecargada?a.ordenPrecargada.Cantidad:a.defaultValorCantidad)});new Core.Controls.DecimalPicker(a.txtValorPrecio,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))},defaultValue:(a.ordenPrecargada?a.ordenPrecargada.PrecioLimite:a.defaultValorLimite)});a.chkCantidadAMostrar.shieldCheckBox({label:"Difusión Parcial / Iceberg",checked:(a.ordenPrecargada&&a.ordenPrecargada.DisplayQty),events:{click:function(f){a.divCantidadAMostrar.hide();if(a.chkCantidadAMostrar.swidget().checked()){a.divCantidadAMostrar.show()}}}});new Core.Controls.DecimalPicker(a.txtCantidadAMostrar,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",defaultValue:(a.ordenPrecargada?a.ordenPrecargada.DisplayQty:0)});a.chkReplacePreviousOrders.shieldCheckBox({label:"Reemplazar órdenes previas",checked:(a.ordenPrecargada&&a.ordenPrecargada.ExecInst&&a.ordenPrecargada.ExecInst.indexOf("x")>=0)});a.chkCancelInDisconnection.shieldCheckBox({label:"Cancelar orden ante desconexión",checked:(a.ordenPrecargada&&a.ordenPrecargada.ExecInst&&a.ordenPrecargada.ExecInst.indexOf("o")>=0)});a.divOperarPrecarga.hide();a.btnNormal.on("click",function(){a.divOperarPrecarga.hide()});a.btnPrecarga.on("click",function(){a.divOperarPrecarga.show()});var b=[];for(var c=10;c<=18;c++){for(var d=0;d<=55;d=d+5){b.push({value:(c.padLeft(2,"0")+":"+d.padLeft(2,"0"))})}}a.ddlMinutosEjecucion.shieldDropDown({dataSource:{data:[{value:0,text:"Ahora"},{value:10,text:"En 10 minutos"},{value:30,text:"En 30 minutos"},{value:60,text:"En 1 hora"},{value:-1,text:"Otro"}]},textTemplate:"{text}",valueTemplate:"{value}",value:(a.ordenPrecargada&&a.ordenPrecargada.MinutosEjecucion?a.ordenPrecargada.MinutosEjecucion.toString():(a.ordenPrecargada&&a.ordenPrecargada.FechaEjecucion?"-1":"0")),events:{select:function(e){Core.Functions.Operar.setControlsByMinutosEjecucion(a.ddlMinutosEjecucion,a.divFechaEjecucion)}}});a.txtFechaEjecucion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.ordenPrecargada?Core.Functions.Date.getDateByStringDisplayDate(a.ordenPrecargada.FechaEjecucion):new Date())});a.ddlHoraEjecucion.shieldDropDown({dataSource:{data:b},textTemplate:"{value}",valueTemplate:"{value}",value:(a.ordenPrecargada&&a.ordenPrecargada.FechaEjecucion?a.ordenPrecargada.FechaEjecucion.substr(11,5):"")});a.ddlMinutosExpiracion.shieldDropDown({dataSource:{data:[{value:10,text:"En 10 minutos"},{value:30,text:"En 30 minutos"},{value:60,text:"En 1 hora"},{value:360,text:"En 6 horas"},{value:-1,text:"Otro"}]},textTemplate:"{text}",valueTemplate:"{value}",value:(a.ordenPrecargada&&a.ordenPrecargada.MinutosExpiracion?a.ordenPrecargada.MinutosExpiracion.toString():(a.ordenPrecargada&&a.ordenPrecargada.FechaExpiracion?"-1":"360")),events:{select:function(e){Core.Functions.Operar.setControlsByMinutosExpiracion(a.ddlMinutosExpiracion,a.divFechaExpiracion)}}});a.txtFechaExpiracion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.ordenPrecargada?Core.Functions.Date.getDateByStringDisplayDate(a.ordenPrecargada.FechaExpiracion):new Date())});a.ddlHoraExpiracion.shieldDropDown({dataSource:{data:b},textTemplate:"{value}",valueTemplate:"{value}",value:(a.ordenPrecargada&&a.ordenPrecargada.FechaExpiracion?a.ordenPrecargada.FechaExpiracion.substr(11,5):"")});a.btnAyudaEjecutarValidaciones.on("click",function(){Core.Functions.Operar.showAyudaEjecutarValidaciones()});a.chkEjecutarValidaciones.shieldCheckBox({label:"Excluir validaciones",checked:(a.ordenPrecargada&&a.ordenPrecargada.EjecutarValidaciones)});a.chkContinuarAutomaticamente.shieldCheckBox({label:"Permitir al cliente modificar esta precarga",checked:(a.ordenPrecargada&&a.ordenPrecargada.ContinuarAutomaticamente)});a.txtObservaciones.shieldTextBox({value:(a.ordenPrecargada?a.ordenPrecargada.Observaciones:"")});if(Core.Objects.Context.Configuration.idAplicacion==1){a.divObservaciones.hide()}a.btnContinuar.click(function(){a.btnContinuarClick()})};a.loadControlsByEspecie=function(){if(a.ddlEspecie.swidget().selectedItem()){Core.Functions.Operar.setLabelsByEspecie(a.ddlEspecie,a.ddlPlazo.swidget().selectedItem().value,a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(c){a.ultimaCotizacion=c;if(a.operarOptions.operarFIX){Core.Functions.Operar.setControlsOperarFix(a.ultimaCotizacion,a.ddlTipoOrden,a.ddlVencimientoOrden,a.divOperarFix,a.divReplacePreviousOrders,a.divCancelInDisconnection,true,function(){a.setControlsByVencimientoOrden();a.setControlsByTipoOrden()})}})}else{if(a.defaultEspecie!=""){var b=new Core.Controls.Dialog("Aviso","No posee la Especie "+a.defaultEspecie+".",{displayButtons:{close:true,accept:false}}).show();a.clearControls(true)}}};a.loadControls=function(){Core.Functions.Operar.setComitente(a.lblCuenta,a.header.selectedIdAccount,a.loaded);var b=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,requestUrl:"detalledisponible/"+encodeURIComponent(a.header.selectedIdAccount),requestType:"GET",requestData:{Fecha:Core.Functions.Date.getDateAsString(new Date())}});b.onSuccess=function(c){a.detalleDisponible=c;Core.Functions.Operar.setEspecieByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlEspecie,Core.Enums.ePanel.Acciones,a.ddlPlazo.swidget().selectedItem().value,a.header.selectedIdAccount,a.loaded,function(){a.loadControlsByEspecie();a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem());if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra&&a.defaultValorCantidad!=""&&a.defaultValorLimite!=""){var d=$.grep(a.detalleDisponible.disponible,function(g,f){return g.idMoneda==Core.Enums.Currency.Pesos.idMoneda})[0];if(!d){d=0}else{d=d.DisponibleOperable72}var e=Math.floor((d/a.defaultValorLimite));if(e<a.defaultValorCantidad){if(e<0){a.txtValorCantidad.val("")}else{a.txtValorCantidad.val(e)}}}if(a.ddlEspecie.swidget().selectedItem()&&a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta&&a.defaultValorCantidad!=""){if(a.ddlEspecie.swidget().selectedItem().Cantidad<a.defaultValorCantidad){a.txtValorCantidad.val(a.ddlEspecie.swidget().selectedItem().Cantidad)}else{a.txtValorCantidad.val(a.defaultValorCantidad)}}Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null));Core.Functions.Operar.setColorByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.divMain,a.divCuenta);Core.Functions.Operar.setControlsByMinutosEjecucion(a.ddlMinutosEjecucion,a.divFechaEjecucion);Core.Functions.Operar.setControlsByMinutosExpiracion(a.ddlMinutosExpiracion,a.divFechaExpiracion)})};b.request()};a.setDisponible=function(d,c,b){a.divDisponible.hide();if(d==Core.Enums.eEspeciesTipoOperacion.Compra&&c!=null&&b!=null){a.disponibleActual=Core.Functions.Operar.setDisponible(a.detalleDisponible.disponible,b.idMoneda,c,a.lblDisponible,a.divDisponible)}};a.btnContinuarClick=function(){var f={value:true};Core.Functions.Validations.getValidatedDropDownValue(a.ddlEspecie,f);var e={idCuenta:a.header.selectedIdAccount,FechaVencimiento:Core.Functions.Date.getDateAsString(new Date()),idTipoOperacion:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,f),ticker:(a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().Ticker:null,Plazo:Core.Functions.Validations.getValidatedDropDownValue(a.ddlPlazo,f),idMoneda:(a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().idMoneda:null,Cantidad:Core.Functions.Validations.getValidatedNumericInputValue(a.txtValorCantidad,f),Monto:null,PrecioDisparo:null,Observaciones:a.txtObservaciones.val()};if(a.ordenPrecargada){e.idOrdenPrecargada=a.ordenPrecargada.idOrdenPrecargada}if(a.operarOptions.operarFIX&&a.ddlTipoOrden.swidget().selectedItem()&&a.ddlVencimientoOrden.swidget().selectedItem()){e.OrderType=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOrden,f);e.TimeInForce=Core.Functions.Validations.getValidatedDropDownValue(a.ddlVencimientoOrden,f);if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){e.PrecioDisparo=Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecioStop,f)}if(a.ddlVencimientoOrden.swidget().value()==a.eVencimientoOrden.GoodTillDate){var b=new Date();b.setHours(0,0,0,0);var d=((a.txtFechaVencimiento.swidget().value())?a.txtFechaVencimiento.swidget().value():new Date());d.setHours(0,0,0,0);e.FechaVencimiento=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaVencimiento,f));if(b.getTime()>d.getTime()){f.value=false;Core.Functions.Validations.toggleValidation(a.txtFechaVencimiento,true)}}if(a.chkCantidadAMostrar.swidget().checked()){e.DisplayQty=Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidadAMostrar,f);if(f.value&&(parseFloat(e.DisplayQty)<0||parseFloat(e.DisplayQty)>=parseFloat(e.Cantidad))){f.value=false;var c=new Core.Controls.Dialog("Aviso","La cantidad a mostrar debe ser positiva y menor a los nominales ingresados ",{displayButtons:{close:true,accept:false}}).show()}}}if(a.divReplacePreviousOrders.is(":visible")&&a.chkReplacePreviousOrders.swidget().checked()){e.ExecInst="x"}if(a.divCancelInDisconnection.is(":visible")&&a.chkCancelInDisconnection.swidget().checked()){if(e.ExecInst){e.ExecInst+=" o"}else{e.ExecInst="o"}}if(!a.ddlTipoOrden.swidget().selectedItem()||(a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.Market&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.MarketWithLeftOverAsLimit&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.StopMerval&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.Stop&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.MarketIfTouched)){e.PrecioLimite=Core.Functions.Validations.getValidatedNumericInputValue(a.txtValorPrecio,f)}if(a.divOperarPrecarga.is(":visible")){e.EsPrecarga=1;if(a.divFechaEjecucion.is(":visible")){e.FechaEjecucion=(Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaEjecucion,f))+" "+Core.Functions.Validations.getValidatedDropDownValue(a.ddlHoraEjecucion,f)+":00")}else{e.MinutosEjecucion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMinutosEjecucion,f)}if(a.divFechaExpiracion.is(":visible")){e.FechaExpiracion=(Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaExpiracion,f))+" "+Core.Functions.Validations.getValidatedDropDownValue(a.ddlHoraExpiracion,f)+":00")}else{e.MinutosExpiracion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMinutosExpiracion,f)}e.EjecutarValidaciones=a.chkEjecutarValidaciones.swidget().checked()?1:0;e.ContinuarAutomaticamente=a.chkContinuarAutomaticamente.swidget().checked()?0:1}if(f.value){Core.Functions.Operar.srOperarEspeciesValidaciones(a.txtValorCantidad,f)}if(!f.value){return}Core.Functions.Operar.srOperarEspecies(e,function(){Core.Functions.Operar.refreshDisponible(a.detalleDisponible,function(){a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem())},a.header.selectedIdAccount,a.loaded)},a.header.selectedIdAccount,a.idDefaultProfile,a.loaded)};a.setControlsByVencimientoOrden=function(){if(a.ddlVencimientoOrden.swidget().value()==a.eVencimientoOrden.GoodTillDate){a.divFechaVencimiento.show()}else{a.txtFechaVencimiento.swidget().value(new Date());a.divFechaVencimiento.hide()}};a.setControlsByTipoOrden=function(){if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){a.divPrecioStop.show()}else{a.txtPrecioStop.val("");a.divPrecioStop.hide()}a.txtValorPrecio.removeAttr("disabled");if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Market||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketWithLeftOverAsLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){a.txtValorPrecio.val("");a.txtValorPrecio.attr("disabled","disabled");Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))}};a.getPrecio=function(){if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Market||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketWithLeftOverAsLimit){if(a.ultimaCotizacion){if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra){return a.ultimaCotizacion.Cotizacion.PrecioVenta}else{return a.ultimaCotizacion.Cotizacion.PrecioCompra}}else{return null}}else{if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){return a.txtPrecioStop.val()}else{return a.txtValorPrecio.val()}}};a.clearControls=function(b){if(b){a.ddlEspecie.swidget().refresh();a.lblUltimoPrecio.text("");a.lblVariacion.text("");a.lblMejorOfertaCompra.text("");a.lblMejorOfertaVenta.text("")}a.txtValorCantidad.val("");a.txtValorPrecio.val("");a.lblTotal.text("");a.txtObservaciones.val("");a.ddlTipoOrden.swidget().refresh();a.ddlVencimientoOrden.swidget().refresh();a.txtPrecioStop.val("");a.txtCantidadAMostrar.val("");a.txtFechaVencimiento.swidget().refresh();a.ultimaCotizacion=null}};Core.Business.AcdiInsertar=new function(){var a=this;a.id="internacional/acdi";a.init=function(c,d,e){a.defaultTipoOperacion=Core.Enums.eFondosTipoOperacion.Rescate;a.defaultFondoOrigen="";a.defaultFondoDestino="";a.defaultCantidad="";a.defaultMoneda="";a.detalleDisponible=null;a.idDefaultAccount=c;a.idDefaultProfile=d;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[d]);$.extend(true,a,e);if(Core.Objects.Context.TieneC4D==1){Core.loadPage("operar-acdi.html",function(){document.title="Operar ACDI";a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,c,d,function(){a.loaded=false;a.loadControls()},"Core.Business.AcdiInsertar")})}else{var b=new Core.Controls.Dialog("Aviso","<p>Para poder Operar debe generar el código de operación de cuatro dígitos desde Configuración de Cuenta.<br/> <a onclick=\"$('.close-btn').click(); Core.Business.AccountSettings.init("+c+", "+d+');">Haga Click Aquí para ir a Configuración de Cuenta.</a></p>',{displayButtons:{close:true,accept:false}}).show()}};a.initControls=function(){a.divMain=$(".div-main");a.divCuenta=$(".div-cuenta");a.lblCuenta=$(".label-cuenta");a.ddlTipoOperacion=$(".dropdown-tipo-operacion");a.divCuentaOrigen=$(".div-cuenta-origen");a.ddlCuentaOrigen=$(".dropdown-cuenta-origen");a.divFondoOrigen=$(".div-fondo-origen");a.ddlFondoOrigen=$(".dropdown-fondo-origen");a.divDisponible=$(".div-disponible");a.lblDisponible=$(".label-disponible");a.divFondoOrigenCotizacion=$(".div-fondo-origen-cotizacion");a.lblFondoOrigenUltimoPrecio=$(".label-fondo-origen-ultimo-precio");a.lblFondoOrigenVariacionDiaria=$(".label-fondo-origen-variacion-diaria");a.lblFondoOrigenVariacionMensual=$(".label-fondo-origen-variacion-mensual");a.lblFondoOrigenVariacionYTD=$(".label-fondo-origen-variacion-ytd");a.divChkRescateTotal=$(".div-checkbox-rescate-total");a.chkRescateTotal=$(".checkbox-rescate-total");a.lblUnidadMedida=$(".label-unidad-medida");a.ddlUnidadMedida=$(".dropdown-unidad-medida");a.lblCantidad=$(".label-cantidad");a.txtCantidad=$(".textbox-cantidad");a.btnContinuar=$(".btn-continuar");a.divFondoDestino=$(".div-fondo-destino");a.lblFondoDestinoUltimoPrecio=$(".label-fondo-destino-ultimo-precio");a.lblFondoDestinoVariacionDiaria=$(".label-fondo-destino-variacion-diaria");a.lblFondoDestinoVariacionMensual=$(".label-fondo-destino-variacion-mensual");a.lblFondoDestinoVariacionYTD=$(".label-fondo-destino-variacion-ytd");a.ddlFondoDestino=$(".dropdown-fondo-destino");a.divCuentaDestino=$(".div-cuenta-destino");a.ddlCuentaDestino=$(".dropdown-cuenta-destino");a.divObservaciones=$(".div-observaciones");a.txtObservaciones=$(".text-observaciones");a.ddlTipoOperacion.shieldDropDown({dataSource:{data:[{value:Core.Enums.eFondosTipoOperacion.Suscripcion,text:"Suscripción"},{value:Core.Enums.eFondosTipoOperacion.Rescate,text:"Rescate"}]},textTemplate:"{text}",valueTemplate:"{value}",value:a.defaultTipoOperacion.toString(),events:{select:function(b){a.setControlesByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,false)}}});a.ddlFondoOrigen.shieldComboBox({dataSource:{data:[]},textTemplate:"{Ticker} ({Cantidad}) | {Descripcion}",valueTemplate:"{Ticker}",value:a.defaultFondoOrigen,autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"Ticker",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}},events:{select:function(b){if(b.index>=0){a.setControlesByFondoOrigen()}}}});a.ddlFondoDestino.shieldComboBox({dataSource:{data:[]},textTemplate:"{Ticker} | {Descripcion}",valueTemplate:"{Ticker}",value:a.defaultFondoDestino,autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"Ticker",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}},events:{select:function(b){if(b.index>=0){a.setCotizacionFondo(a.ddlFondoDestino.swidget().selectedItem().Ticker,a.lblFondoDestinoUltimoPrecio,a.lblFondoDestinoVariacionDiaria,a.lblFondoDestinoVariacionMensual,a.lblFondoDestinoVariacionYTD)}}}});a.ddlCuentaOrigen.shieldComboBox({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{idCuentaBancaria}",value:"",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""}]}},events:{select:function(b){if(b.index>=0){a.setControlesByCuentaOrigen()}}}});a.ddlCuentaDestino.shieldComboBox({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{idCuentaBancaria}",value:"",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""}]}}});a.ddlUnidadMedida.shieldDropDown({dataSource:{data:[{value:Core.Enums.eFondosUnidadMedida.Moneda,text:"Pesos"},{value:Core.Enums.eFondosUnidadMedida.Cuotapartes,text:"Cuotapartes"}]},textTemplate:"{text}",valueTemplate:"{value}",value:Core.Enums.eFondosUnidadMedida.Moneda.toString(),events:{select:function(b){a.setLabelsByOperacionUnidadMedida()}}});a.txtCantidad.shieldNumericTextBox({min:0,step:1e-06,max:999999999,spinners:false,value:a.defaultCantidad.toString()});a.txtObservaciones.shieldTextBox({});if(Core.Objects.Context.Configuration.idAplicacion==1){a.divObservaciones.hide()}a.btnContinuar.click(function(){a.btnContinuarClick()});a.chkRescateTotal.change(function(){a.ddlUnidadMedida.swidget().enabled(!a.chkRescateTotal.get(0).checked);a.txtCantidad.swidget().enabled(!a.chkRescateTotal.get(0).checked)})};a.loadControls=function(){Core.Functions.Operar.setComitente(a.lblCuenta,a.header.selectedIdAccount,a.loaded);var b=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,requestUrl:"detalledisponible/"+encodeURIComponent(a.header.selectedIdAccount),requestType:"GET",requestData:{Fecha:Core.Functions.Date.getDateAsString(new Date())}});b.onSuccess=function(c){a.detalleDisponible=c;a.setControlesByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,true)};b.request()};a.setControlesByTipoOperacion=function(f,b){Core.Functions.Operar.setColorByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.divMain,a.divCuenta);var d=a.ddlFondoDestino.swidget().initialOptions;d.dataSource.data=[];a.ddlFondoDestino.swidget().refresh(d);var c=a.ddlCuentaDestino.swidget().initialOptions;c.dataSource.data=[];a.ddlCuentaDestino.swidget().refresh(c);var e=a.ddlUnidadMedida.swidget().initialOptions;e.dataSource.data=[];a.ddlUnidadMedida.swidget().refresh(e);a.ddlUnidadMedida.swidget().enabled(true);a.lblFondoOrigenUltimoPrecio.text("");a.lblFondoOrigenVariacionDiaria.text("");a.lblFondoOrigenVariacionMensual.text("");a.lblFondoOrigenVariacionYTD.text("");a.lblFondoDestinoUltimoPrecio.text("");a.lblFondoDestinoVariacionDiaria.text("");a.lblFondoDestinoVariacionMensual.text("");a.lblFondoDestinoVariacionYTD.text("");a.txtCantidad.swidget().value((b)?a.defaultCantidad:"");a.txtCantidad.swidget().enabled(true);a.chkRescateTotal.get(0).checked=false;a.divDisponible.hide();a.divCuentaOrigen.hide();a.divFondoOrigen.hide();a.divFondoOrigenCotizacion.hide();a.divFondoDestino.hide();a.divCuentaDestino.hide();a.divChkRescateTotal.hide();if(f==Core.Enums.eFondosTipoOperacion.Suscripcion){a.lblUnidadMedida.text("Moneda:");a.lblCantidad.text("Monto:");a.divCuentaOrigen.show();a.divFondoDestino.show();a.setCuentasVinculadas(a.ddlCuentaOrigen,function(g){return g.idCuentaBancaria<=0&&(!b||(a.defaultMoneda&&g.Moneda==a.defaultMoneda))},function(){if(b&&a.defaultMoneda){a.ddlCuentaOrigen.swidget().value("0");if(a.ddlCuentaOrigen.swidget().selectedItem()){a.setControlesByCuentaOrigen()}}})}else{a.lblUnidadMedida.text("Unidad de Medida:");a.lblCantidad.text("Cantidad:");a.divFondoOrigen.show();a.divFondoOrigenCotizacion.show();a.divCuentaDestino.show();a.divChkRescateTotal.show();a.setFondosByTipoOperacion(f,a.ddlFondoOrigen,function(){if(a.ddlFondoOrigen.swidget().selectedItem()){a.setControlesByFondoOrigen()}else{if(b&&a.defaultFondoOrigen&&f==Core.Enums.eFondosTipoOperacion.Rescate){new Core.Controls.Dialog("Aviso","No posee el fondo seleccionado para realizar el rescate.",{displayButtons:{close:true,accept:false}}).show()}}})}};a.setUnidadesMedidaByOperacionYMoneda=function(d,b){var c=a.ddlUnidadMedida.swidget().initialOptions;if(d==Core.Enums.eFondosTipoOperacion.Suscripcion){c.dataSource.data=[{value:Core.Enums.eFondosUnidadMedida.Moneda,text:(b==Core.Enums.Currency.Pesos.idMoneda)?Core.Enums.Currency.Pesos.Descripcion:Core.Enums.Currency.Dolares.Descripcion}]}else{c.dataSource.data=[{value:Core.Enums.eFondosUnidadMedida.Moneda,text:(b==Core.Enums.Currency.Pesos.idMoneda)?Core.Enums.Currency.Pesos.Descripcion:Core.Enums.Currency.Dolares.Descripcion},{value:Core.Enums.eFondosUnidadMedida.Cuotapartes,text:"Cuotapartes"}]}c.value=Core.Enums.eFondosUnidadMedida.Moneda.toString();a.ddlUnidadMedida.swidget().refresh(c);a.chkRescateTotal.change();a.setLabelsByOperacionUnidadMedida()};a.setLabelsByOperacionUnidadMedida=function(){if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eFondosTipoOperacion.Suscripcion||(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eFondosTipoOperacion.Rescate&&a.ddlUnidadMedida.swidget().selectedItem().value!=Core.Enums.eFondosUnidadMedida.Cuotapartes)){a.lblCantidad.text("Monto:")}else{a.lblCantidad.text("Cantidad:")}};a.setFondosByTipoOperacion=function(g,b,d,c){var e={};e.plazo=0;e.panel=Core.Enums.ePanel.ACDI;if(g==Core.Enums.eFondosTipoOperacion.Rescate){e.idCuenta=a.header.selectedIdAccount}var f=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"especies",requestType:"GET",requestData:e});f.onSuccess=function(i){var h=b.swidget().initialOptions;if(c){i.especies=$.grep(i.especies,function(k,j){return c(k)})}h.dataSource.data=i.especies;b.swidget().refresh(h);if(d){d()}};f.request()};a.setCuentasVinculadas=function(b,c,d){var e=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"acdi/cuentasbancariasvinculadas/"+a.header.selectedIdAccount,requestType:"GET"});e.onSuccess=function(h){var g=b.swidget().initialOptions;var f=h.cuentasbancarias;if(c){f=$.grep(f,function(j,i){return c(j)})}g.dataSource.data=f;b.swidget().refresh(g);if(d){d()}};e.request()};a.setCotizacionFondo=function(i,b,c,d,e){var g=function(k,l){var j="field-var";if(l!=null){if(l>0){j="field-varpositiva"}if(l<0){j="field-varnegativa"}}k.removeClass("field-var field-varpositiva field-varnegativa").addClass(j)};var f={};f.ticker=i;var h=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"cotizacioncuotaparte",requestType:"GET",requestData:f});h.onSuccess=function(j){b.text(j.Cotizacion.Cotizacion!=null?j.Cotizacion.Cotizacion:"No disponible");c.text(j.Cotizacion.VarDiaria!=null?j.Cotizacion.VarDiaria:"No disponible");d.text(j.Cotizacion.VarMensual!=null?j.Cotizacion.VarMensual:"No disponible");e.text(j.Cotizacion.VarYTD!=null?j.Cotizacion.VarYTD:"No disponible");g(c,j.Cotizacion.VarDiaria);g(d,j.Cotizacion.VarMensual);g(e,j.Cotizacion.VarYTD)};h.request()};a.setDisponible=function(c,b){a.divDisponible.hide();if(c==Core.Enums.eFondosTipoOperacion.Suscripcion&&b&&b.idCuentaBancaria==0){Core.Functions.Operar.setDisponible(a.detalleDisponible.suscribible,b.idMoneda,Core.Enums.ePlazo.CI,a.lblDisponible,a.divDisponible)}};a.setControlesByCuentaOrigen=function(){a.setUnidadesMedidaByOperacionYMoneda(a.ddlTipoOperacion.swidget().value(),a.ddlCuentaOrigen.swidget().selectedItem().idMoneda);a.setDisponible(a.ddlTipoOperacion.swidget().value(),a.ddlCuentaOrigen.swidget().selectedItem());a.setFondosByTipoOperacion(a.ddlTipoOperacion.swidget().value(),a.ddlFondoDestino,function(){if(!a.ddlFondoDestino.swidget().selectedItem()){a.lblFondoDestinoUltimoPrecio.text("");a.lblFondoDestinoVariacionDiaria.text("");a.lblFondoDestinoVariacionMensual.text("");a.lblFondoDestinoVariacionYTD.text("")}},function(b){return b.idMoneda==a.ddlCuentaOrigen.swidget().selectedItem().idMoneda})};a.setControlesByFondoOrigen=function(){a.setCotizacionFondo(a.ddlFondoOrigen.swidget().selectedItem().Ticker,a.lblFondoOrigenUltimoPrecio,a.lblFondoOrigenVariacionDiaria,a.lblFondoOrigenVariacionMensual,a.lblFondoOrigenVariacionYTD);a.setUnidadesMedidaByOperacionYMoneda(a.ddlTipoOperacion.swidget().value(),a.ddlFondoOrigen.swidget().selectedItem().idMoneda);a.setCuentasVinculadas(a.ddlCuentaDestino,function(b){return b.idMoneda==a.ddlFondoOrigen.swidget().selectedItem().idMoneda&&b.idCuentaBancaria>=0})};a.btnContinuarClick=function(){var e={value:true};var c=false;var b={};b.idCuenta=a.header.selectedIdAccount;b.idOpcion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,e);b.Observaciones=a.txtObservaciones.val();if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eFondosTipoOperacion.Suscripcion){b.Ticker=Core.Functions.Validations.getValidatedDropDownValue(a.ddlFondoDestino,e);b.Monto=Core.Functions.Validations.getValidatedNumericSwidgetValue(a.txtCantidad,e);b.idCuentaBancaria=Core.Functions.Validations.getValidatedDropDownValue(a.ddlCuentaOrigen,e);c=(a.ddlCuentaOrigen.swidget().selectedItem())?(a.ddlCuentaOrigen.swidget().selectedItem().idMoneda!=Core.Enums.Currency.Pesos.idMoneda):false}else{b.total=(a.chkRescateTotal.get(0).checked?"1":"0");b.Ticker=Core.Functions.Validations.getValidatedDropDownValue(a.ddlFondoOrigen,e);c=(a.ddlFondoOrigen.swidget().selectedItem())?(a.ddlFondoOrigen.swidget().selectedItem().idMoneda!=Core.Enums.Currency.Pesos.idMoneda):false;b.idCuentaBancaria=Core.Functions.Validations.getValidatedDropDownValue(a.ddlCuentaDestino,e);if(a.chkRescateTotal.get(0).checked&&a.ddlFondoOrigen.swidget().selectedItem()){b.Cantidad=a.ddlFondoOrigen.swidget().selectedItem().Cantidad}else{b.Cantidad=(a.ddlUnidadMedida.swidget().value()==Core.Enums.eFondosUnidadMedida.Cuotapartes)?Core.Functions.Validations.getValidatedNumericSwidgetValue(a.txtCantidad,e):null;b.Monto=(a.ddlUnidadMedida.swidget().value()==Core.Enums.eFondosUnidadMedida.Moneda)?Core.Functions.Validations.getValidatedNumericSwidgetValue(a.txtCantidad,e):null}}if(!e.value){return}var d=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"acdi/orden/solicitud",requestType:"POST",requestData:b});d.onSuccess=function(j){var k="";if(a.ddlTipoOperacion.swidget().value()==Core.Enums.eFondosTipoOperacion.Suscripcion){k="Suscripción Fondos Comunes de Inversión"}else{k="Rescate Fondos Comunes de Inversión"}var g="Comitente N°"+j.NumComitente+" - "+j.DescripcionCuenta;var h="S.E:U.O. (Salvo error u omisión)";h+=(a.ddlTipoOperacion.swidget().value()==Core.Enums.eFondosTipoOperacion.Suscripcion)?"<br />La cantidad cuotapartes definitivas surgiran del valor de la cuotaparte al cierre, momento en que se hace efectiva la suscripción.":"<br />El monto final surgira del valor de la cuotaparte al cierre, momento en que se hace efectivo el rescate.";h+=(c)?"<br />NOTA: En el caso de necesitar conversión de divisas, la operación puede demorar hasta 48hs hábiles.":"";var i={data:j,idDefaultProfile:a.idDefaultProfile,terminosYCondiciones:j.Terminos,terminosYCondicionesDescripcion:"Declaro que he leído el Reglamento de Gestión del Fondo",idAccount:a.header.selectedIdAccount,generalTitle:"CONFIRMACION DE ORDEN",title:k,accountDescription:g,footerHtml:h,urlMethod:"operar/fondos/confirmar",codigo4DDescription:"Ingrese su código de operación de cuatro dígitos:",onConfirm:function(){Core.Functions.Operar.refreshDisponible(a.detalleDisponible,function(){a.setDisponible(a.ddlTipoOperacion.swidget().value(),a.ddlCuentaOrigen.swidget().selectedItem())},a.header.selectedIdAccount,a.loaded)}};var f=new Core.Controls.OperarConfirmation(i).show()};d.request()}};Core.Business.Operar.BCIAcciones=new function(){var a=this;a.id="bci_internacional";a.loaded=false;a.detalleDisponible=null;a.idDefaultAccount=null;a.idDefaultProfile=null;a.decimalCount=6;a.eVencimientoOrden={GoodTillDate:6};a.eTipoOrden={Market:1,Limit:2,StopMerval:3,StopLimit:4,Stop:"z",MarketWithLeftOverAsLimit:"K",MarketIfTouched:"J"};a.divMain=null;a.divCuenta=null;a.divAlertaTipoPrecio=null;a.ddlTipoOperacion=null;a.ddlEspecie=null;a.lblCuenta=null;a.ddlPlazo=null;a.divDisponible=null;a.lblDisponible=null;a.lblUltimoPrecio=null;a.lblVariacion=null;a.lblMejorOfertaCompra=null;a.lblMejorOfertaVenta=null;a.divOperarFix=null;a.divReplacePreviousOrders=null;a.chkReplacePreviousOrders=null;a.divCancelInDisconnection=null;a.chkCancelInDisconnection=null;a.divTipoOrden=null;a.ddlTipoOrden=null;a.divVencimientoOrden=null;a.ddlVencimientoOrden=null;a.divPrecioStop=null;a.txtPrecioStop=null;a.divFechaVencimiento=null;a.txtFechaVencimiento=null;a.txtValorCantidad=null;a.txtValorPrecio=null;a.lblTotal=null;a.chkCantidadAMostrar=null;a.txtCantidadAMostrar=null;a.divCantidadAMostrar=null;a.divObservaciones=null;a.txtObservaciones=null;a.btnContinuar=null;a.defaultPlazo=null;a.defaultTipoOperacion=null;a.defaultEspecie=null;a.defaultValorCantidad=null;a.defaultValorLimite=null;a.disponibleActual=null;a.pageOptions=null;a.operarOptions=null;a.ultimaCotizacion=null;a.ordenPrecargada=null;a.init=function(d,e,f){if(Core.Objects.Accounts){var b=$.grep(Core.Objects.Accounts,function(h,g){return h.idCuenta==d})[0];if(b&&b.NumComitente==""){return}}a.idDefaultAccount=d;a.idDefaultProfile=e;a.defaultTipoOperacion=Core.Enums.eEspeciesTipoOperacion.Venta;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[e]);a.operarOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu("operar",Core.Objects.Context.Profiles[e]);a.defaultEspecie="";a.defaultValorCantidad="";a.defaultValorLimite="";a.defaultPlazo=a.pageOptions.plazoDefault;a.ordenPrecargada=null;$.extend(true,a,f);if(Core.Objects.Context.TieneC4D==1){Core.loadPage("operar-bci-acciones.html",function(){document.title="Operar BCI Internacional";a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,d,e,function(){var g=$.grep(Core.Objects.Accounts,function(i,h){return i.idCuenta==a.header.selectedIdAccount})[0];if(g.NumComitente==""){Core.Business.PosicionConsolidada.init(a.header.selectedIdAccount,a.idDefaultProfile);return}a.loaded=false;a.loadControls()},"Core.Business.Operar.BCIAcciones")})}else{var c=new Core.Controls.Dialog("Aviso","<p>Para poder Operar debe generar el código de operación de cuatro dígitos desde Configuración de Cuenta.<br/> <a onclick=\"$('.close-btn').click(); Core.Business.AccountSettings.init("+d+", "+e+');">Haga Click Aquí para ir a Configuración de Cuenta.</a></p>',{displayButtons:{close:true,accept:false}}).show()}};a.initControls=function(){a.divMain=$(".div-main");a.divCuenta=$(".div-cuenta");a.divAlertaTipoPrecio=$(".div-alert-price-type");a.divAlertaTipoPrecio.hide();a.ddlTipoOperacion=$(".dropdown-tipo-operacion");a.ddlEspecie=$(".dropdown-especie");a.lblCuenta=$(".label-cuenta");a.divDisponible=$(".div-disponible");a.lblDisponible=$(".label-disponible");a.ddlPlazo=$(".dropdown-plazo");a.lblUltimoPrecio=$(".label-ultimo-precio");a.lblVariacion=$(".label-variacion");a.lblMejorOfertaCompra=$(".label-mejor-oferta-compra");a.lblMejorOfertaVenta=$(".label-mejor-oferta-venta");a.divOperarFix=$(".div-operar-fix");a.divOperarFix.hide();a.divReplacePreviousOrders=$(".div-replace-previous-orders");a.chkReplacePreviousOrders=$(".checkbox-replace-previous-orders");a.divCancelInDisconnection=$(".div-cancel-in-disconnection");a.chkCancelInDisconnection=$(".checkbox-cancel-in-disconnection");a.divTipoOrden=$(".div-tipo-orden");a.ddlTipoOrden=$(".dropdown-tipo-orden");a.divVencimientoOrden=$(".div-vencimiento-orden");a.ddlVencimientoOrden=$(".dropdown-vencimiento-orden");a.divPrecioStop=$(".div-precio-stop");a.txtPrecioStop=$(".textbox-precio-stop");a.divFechaVencimiento=$(".div-fecha-vencimiento");a.txtFechaVencimiento=$(".date-fecha-vencimiento");a.txtValorCantidad=$(".textbox-cantidad");a.txtValorPrecio=$(".textbox-precio");a.lblTotal=$(".label-precio-total");a.divObservaciones=$(".div-observaciones");a.txtObservaciones=$(".text-observaciones");a.txtCantidadAMostrar=$(".textbox-cantidad-a-mostrar");a.chkCantidadAMostrar=$(".checkbox-cantidad-a-mostrar");a.divCantidadAMostrar=$(".div-cantidad-a-mostrar");a.divCantidadAMostrar.hide();a.divSeleccionPrecarga=$(".div-seleccion-precarga");a.divSeleccionPrecarga.hide();if(a.pageOptions&&a.pageOptions.precargar){a.divSeleccionPrecarga.show()}a.btnPrecarga=$(".btn-precarga");a.btnNormal=$(".btn-normal");a.divOperarPrecarga=$(".div-operar-precarga");a.divFechaEjecucion=$(".div-fecha-ejecucion");a.ddlMinutosEjecucion=$(".dropdown-minutos-ejecucion");a.txtFechaEjecucion=$(".date-fecha-ejecucion");a.ddlHoraEjecucion=$(".dropdown-hora-ejecucion");a.divFechaExpiracion=$(".div-fecha-expiracion");a.ddlMinutosExpiracion=$(".dropdown-minutos-expiracion");a.txtFechaExpiracion=$(".date-fecha-expiracion");a.ddlHoraExpiracion=$(".dropdown-hora-expiracion");a.btnAyudaEjecutarValidaciones=$(".btn-ayuda-ejecutar-validaciones");a.chkEjecutarValidaciones=$(".checkbox-ejecutar-validaciones");a.chkContinuarAutomaticamente=$(".checkbox-continuar-automaticamente");a.btnContinuar=$(".btn-continuar");a.ddlTipoOperacion.shieldDropDown({dataSource:{data:[{value:Core.Enums.eEspeciesTipoOperacion.Compra,text:"Compra"},{value:Core.Enums.eEspeciesTipoOperacion.Venta,text:"Venta"}]},textTemplate:"{text}",valueTemplate:"{value}",value:(a.ordenPrecargada?a.ordenPrecargada.idTipoOperacion.toString():a.defaultTipoOperacion.toString()),events:{select:function(e){a.clearControls(true);Core.Functions.Operar.setEspecieByTipoOperacion(e.item.value,a.ddlEspecie,Core.Enums.ePanel.BCINYSE,a.ddlPlazo.swidget().selectedItem().value,a.header.selectedIdAccount,a.loaded,function(){a.loadControlsByEspecie();a.setDisponible(e.item.value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem())});Core.Functions.Operar.setColorByTipoOperacion(e.item.value,a.divMain,a.divCuenta)}}});a.ddlEspecie.shieldComboBox({dataSource:{data:[]},valueTemplate:"{DisplayTicker}",value:(a.ordenPrecargada?a.ordenPrecargada.DisplayTicker:a.defaultEspecie),textTemplate:"{DisplayTicker} | {Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}},events:{select:function(f){if(f.index>=0){a.clearControls(false);a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem());Core.Functions.Operar.setLabelsByEspecie(a.ddlEspecie,a.ddlPlazo.swidget().selectedItem().value,a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(e){a.ultimaCotizacion=e;Core.Functions.grid.Cotizaciones.setAlertPriceType(a.divAlertaTipoPrecio,a.ultimaCotizacion.Cotizacion.TextoAlerta,a.ultimaCotizacion.Cotizacion.TipoAlerta,a.idDefaultAccount,a.idDefaultProfile);if(a.operarOptions.operarFIX){Core.Functions.Operar.setControlsOperarFix(a.ultimaCotizacion,a.ddlTipoOrden,a.ddlVencimientoOrden,a.divOperarFix,a.divReplacePreviousOrders,a.divCancelInDisconnection,a.loaded,function(){a.setControlsByVencimientoOrden();a.setControlsByTipoOrden()})}})}}}});a.ddlPlazo.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",value:(a.ordenPrecargada?a.ordenPrecargada.Plazo.toString():a.defaultPlazo.toString()),events:{select:function(e){a.clearControls(true);Core.Functions.Operar.setEspecieByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlEspecie,Core.Enums.ePanel.BCINYSE,a.ddlPlazo.swidget().selectedItem().value,a.header.selectedIdAccount,a.loaded,function(){a.loadControlsByEspecie();a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,e.item.value,a.ddlEspecie.swidget().selectedItem());Core.Functions.Operar.setLabelsByEspecie(a.ddlEspecie,a.ddlPlazo.swidget().selectedItem().value,a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(f){a.ultimaCotizacion=f;Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null));Core.Functions.grid.Cotizaciones.setAlertPriceType(a.divAlertaTipoPrecio,a.ultimaCotizacion.Cotizacion.TextoAlerta,a.ultimaCotizacion.Cotizacion.TipoAlerta,a.idDefaultAccount,a.idDefaultProfile)})})}}});Core.Functions.Operar.setPlazos(a.ddlPlazo,a.pageOptions.plazosHabilitados);a.ddlTipoOrden.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{Valor}",value:(a.ordenPrecargada?a.ordenPrecargada.OrderType:""),events:{select:function(e){a.setControlsByTipoOrden()}}});a.ddlVencimientoOrden.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{Valor}",value:(a.ordenPrecargada?a.ordenPrecargada.TimeInForce:""),events:{select:function(e){a.setControlsByVencimientoOrden()}}});new Core.Controls.DecimalPicker(a.txtPrecioStop,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))},defaultValue:(a.ordenPrecargada?a.ordenPrecargada.PrecioDisparo:0)});a.txtFechaVencimiento.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.ordenPrecargada?Core.Functions.Date.getDateByStringWithoutSeparator(a.ordenPrecargada.FechaVencimiento):new Date())});new Core.Controls.DecimalPicker(a.txtValorCantidad,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))},defaultValue:(a.ordenPrecargada?a.ordenPrecargada.Cantidad:a.defaultValorCantidad)});new Core.Controls.DecimalPicker(a.txtValorPrecio,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))},defaultValue:(a.ordenPrecargada?a.ordenPrecargada.PrecioLimite:a.defaultValorLimite)});a.chkCantidadAMostrar.shieldCheckBox({label:"Difusión Parcial / Iceberg",checked:(a.ordenPrecargada&&a.ordenPrecargada.DisplayQty),events:{click:function(f){a.divCantidadAMostrar.hide();if(a.chkCantidadAMostrar.swidget().checked()){a.divCantidadAMostrar.show()}}}});new Core.Controls.DecimalPicker(a.txtCantidadAMostrar,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",defaultValue:(a.ordenPrecargada?a.ordenPrecargada.DisplayQty:0)});a.chkReplacePreviousOrders.shieldCheckBox({label:"Reemplazar órdenes previas",checked:(a.ordenPrecargada&&a.ordenPrecargada.ExecInst&&a.ordenPrecargada.ExecInst.indexOf("x")>=0)});a.chkCancelInDisconnection.shieldCheckBox({label:"Cancelar orden ante desconexión",checked:(a.ordenPrecargada&&a.ordenPrecargada.ExecInst&&a.ordenPrecargada.ExecInst.indexOf("o")>=0)});a.divOperarPrecarga.hide();a.btnNormal.on("click",function(){a.divOperarPrecarga.hide()});a.btnPrecarga.on("click",function(){a.divOperarPrecarga.show()});var b=[];for(var c=10;c<=18;c++){for(var d=0;d<=55;d=d+5){b.push({value:(c.padLeft(2,"0")+":"+d.padLeft(2,"0"))})}}a.ddlMinutosEjecucion.shieldDropDown({dataSource:{data:[{value:0,text:"Ahora"},{value:10,text:"En 10 minutos"},{value:30,text:"En 30 minutos"},{value:60,text:"En 1 hora"},{value:-1,text:"Otro"}]},textTemplate:"{text}",valueTemplate:"{value}",value:(a.ordenPrecargada&&a.ordenPrecargada.MinutosEjecucion?a.ordenPrecargada.MinutosEjecucion.toString():(a.ordenPrecargada&&a.ordenPrecargada.FechaEjecucion?"-1":"0")),events:{select:function(e){Core.Functions.Operar.setControlsByMinutosEjecucion(a.ddlMinutosEjecucion,a.divFechaEjecucion)}}});a.txtFechaEjecucion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.ordenPrecargada?Core.Functions.Date.getDateByStringDisplayDate(a.ordenPrecargada.FechaEjecucion):new Date())});a.ddlHoraEjecucion.shieldDropDown({dataSource:{data:b},textTemplate:"{value}",valueTemplate:"{value}",value:(a.ordenPrecargada&&a.ordenPrecargada.FechaEjecucion?a.ordenPrecargada.FechaEjecucion.substr(11,5):"")});a.ddlMinutosExpiracion.shieldDropDown({dataSource:{data:[{value:10,text:"En 10 minutos"},{value:30,text:"En 30 minutos"},{value:60,text:"En 1 hora"},{value:360,text:"En 6 horas"},{value:-1,text:"Otro"}]},textTemplate:"{text}",valueTemplate:"{value}",value:(a.ordenPrecargada&&a.ordenPrecargada.MinutosExpiracion?a.ordenPrecargada.MinutosExpiracion.toString():(a.ordenPrecargada&&a.ordenPrecargada.FechaExpiracion?"-1":"360")),events:{select:function(e){Core.Functions.Operar.setControlsByMinutosExpiracion(a.ddlMinutosExpiracion,a.divFechaExpiracion)}}});a.txtFechaExpiracion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.ordenPrecargada?Core.Functions.Date.getDateByStringDisplayDate(a.ordenPrecargada.FechaExpiracion):new Date())});a.ddlHoraExpiracion.shieldDropDown({dataSource:{data:b},textTemplate:"{value}",valueTemplate:"{value}",value:(a.ordenPrecargada&&a.ordenPrecargada.FechaExpiracion?a.ordenPrecargada.FechaExpiracion.substr(11,5):"")});a.btnAyudaEjecutarValidaciones.on("click",function(){Core.Functions.Operar.showAyudaEjecutarValidaciones()});a.chkEjecutarValidaciones.shieldCheckBox({label:"Excluir validaciones",checked:(a.ordenPrecargada&&a.ordenPrecargada.EjecutarValidaciones)});a.chkContinuarAutomaticamente.shieldCheckBox({label:"Permitir al cliente modificar esta precarga",checked:(a.ordenPrecargada&&a.ordenPrecargada.ContinuarAutomaticamente)});a.txtObservaciones.shieldTextBox({});if(Core.Objects.Context.Configuration.idAplicacion==1){a.divObservaciones.hide()}a.btnContinuar.click(function(){a.btnContinuarClick()})};a.loadControlsByEspecie=function(){if(a.ddlEspecie.swidget().selectedItem()){Core.Functions.Operar.setLabelsByEspecie(a.ddlEspecie,a.ddlPlazo.swidget().selectedItem().value,a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(c){a.ultimaCotizacion=c;Core.Functions.grid.Cotizaciones.setAlertPriceType(a.divAlertaTipoPrecio,a.ultimaCotizacion.Cotizacion.TextoAlerta,a.ultimaCotizacion.Cotizacion.TipoAlerta,a.idDefaultAccount,a.idDefaultProfile);if(a.operarOptions.operarFIX){Core.Functions.Operar.setControlsOperarFix(a.ultimaCotizacion,a.ddlTipoOrden,a.ddlVencimientoOrden,a.divOperarFix,a.divReplacePreviousOrders,a.divCancelInDisconnection,a.loaded,function(){a.setControlsByVencimientoOrden();a.setControlsByTipoOrden()})}})}else{if(a.defaultEspecie!=""){var b=new Core.Controls.Dialog("Aviso","No posee la Especie "+a.defaultEspecie+".",{displayButtons:{close:true,accept:false}}).show();a.clearControls(true)}}};a.loadControls=function(){Core.Functions.Operar.setComitente(a.lblCuenta,a.header.selectedIdAccount,a.loaded);var b=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,requestUrl:"detalledisponible/"+encodeURIComponent(a.header.selectedIdAccount),requestType:"GET",requestData:{Fecha:Core.Functions.Date.getDateAsString(new Date())}});b.onSuccess=function(c){a.detalleDisponible=c;Core.Functions.Operar.setEspecieByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlEspecie,Core.Enums.ePanel.BCINYSE,a.ddlPlazo.swidget().selectedItem().value,a.header.selectedIdAccount,a.loaded,function(){a.loadControlsByEspecie();var f=a.ddlEspecie.swidget().selectedItem();a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,(f)?f:null);Core.Functions.Operar.setColorByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.divMain,a.divCuenta);if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra&&a.defaultValorCantidad!=""&&a.defaultValorLimite!=""&&f){var d=$.grep(a.detalleDisponible.disponible,function(h,g){return h.idMoneda==f.idMoneda})[0];if(!d){d=0}else{d=d.DisponibleOperable48}var e=Math.floor((d/a.defaultValorLimite));if(e<a.defaultValorCantidad){if(e<0){a.txtValorCantidad.val("")}else{a.txtValorCantidad.val(e)}}}if(a.ddlEspecie.swidget().selectedItem()&&a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta&&a.defaultValorCantidad!=""){if(a.ddlEspecie.swidget().selectedItem().Cantidad<a.defaultValorCantidad){a.txtValorCantidad.val(a.ddlEspecie.swidget().selectedItem().Cantidad)}else{a.txtValorCantidad.val(a.defaultValorCantidad)}}Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null));Core.Functions.Operar.setControlsByMinutosEjecucion(a.ddlMinutosEjecucion,a.divFechaEjecucion);Core.Functions.Operar.setControlsByMinutosExpiracion(a.ddlMinutosExpiracion,a.divFechaExpiracion)})};b.request()};a.setDisponible=function(d,c,b){a.divDisponible.hide();if(d==Core.Enums.eEspeciesTipoOperacion.Compra&&c!=null&&b!=null){a.disponibleActual=Core.Functions.Operar.setDisponible(a.detalleDisponible.disponible,b.idMoneda,c,a.lblDisponible,a.divDisponible)}};a.btnContinuarClick=function(){var f={value:true};var e={idCuenta:a.header.selectedIdAccount,FechaVencimiento:Core.Functions.Date.getDateAsString(new Date()),idTipoOperacion:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,f),ticker:Core.Functions.Validations.getValidatedDropDownValue(a.ddlEspecie,f),Plazo:Core.Functions.Validations.getValidatedDropDownValue(a.ddlPlazo,f),idMoneda:(a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().idMoneda:null,Cantidad:Core.Functions.Validations.getValidatedNumericInputValue(a.txtValorCantidad,f),Monto:null,PrecioDisparo:null,Observaciones:a.txtObservaciones.val()};if(a.ordenPrecargada){e.idOrdenPrecargada=a.ordenPrecargada.idOrdenPrecargada}if(a.operarOptions.operarFIX&&a.ddlTipoOrden.swidget().selectedItem()&&a.ddlVencimientoOrden.swidget().selectedItem()){e.OrderType=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOrden,f);e.TimeInForce=Core.Functions.Validations.getValidatedDropDownValue(a.ddlVencimientoOrden,f);if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){e.PrecioDisparo=Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecioStop,f)}if(a.ddlVencimientoOrden.swidget().value()==a.eVencimientoOrden.GoodTillDate){var b=new Date();b.setHours(0,0,0,0);var d=((a.txtFechaVencimiento.swidget().value())?a.txtFechaVencimiento.swidget().value():new Date());d.setHours(0,0,0,0);e.FechaVencimiento=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaVencimiento,f));if(b.getTime()>d.getTime()){f.value=false;Core.Functions.Validations.toggleValidation(a.txtFechaVencimiento,true)}}if(a.chkCantidadAMostrar.swidget().checked()){e.DisplayQty=Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidadAMostrar,f);if(f.value&&(parseFloat(e.DisplayQty)<0||parseFloat(e.DisplayQty)>=parseFloat(e.Cantidad))){f.value=false;var c=new Core.Controls.Dialog("Aviso","La cantidad a mostrar debe ser positiva y menor a los nominales ingresados ",{displayButtons:{close:true,accept:false}}).show()}}}if(a.divReplacePreviousOrders.is(":visible")&&a.chkReplacePreviousOrders.swidget().checked()){e.ExecInst="x"}if(a.divCancelInDisconnection.is(":visible")&&a.chkCancelInDisconnection.swidget().checked()){if(e.ExecInst){e.ExecInst+=" o"}else{e.ExecInst="o"}}if(!a.ddlTipoOrden.swidget().selectedItem()||(a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.Market&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.MarketWithLeftOverAsLimit&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.StopMerval&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.Stop&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.MarketIfTouched)){e.PrecioLimite=Core.Functions.Validations.getValidatedNumericInputValue(a.txtValorPrecio,f)}if(a.divOperarPrecarga.is(":visible")){e.EsPrecarga=1;if(a.divFechaEjecucion.is(":visible")){e.FechaEjecucion=(Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaEjecucion,f))+" "+Core.Functions.Validations.getValidatedDropDownValue(a.ddlHoraEjecucion,f)+":00")}else{e.MinutosEjecucion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMinutosEjecucion,f)}if(a.divFechaExpiracion.is(":visible")){e.FechaExpiracion=(Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaExpiracion,f))+" "+Core.Functions.Validations.getValidatedDropDownValue(a.ddlHoraExpiracion,f)+":00")}else{e.MinutosExpiracion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMinutosExpiracion,f)}e.EjecutarValidaciones=a.chkEjecutarValidaciones.swidget().checked()?1:0;e.ContinuarAutomaticamente=a.chkContinuarAutomaticamente.swidget().checked()?0:1}if(f.value){Core.Functions.Operar.srOperarEspeciesValidaciones(a.txtValorCantidad,f)}if(!f.value){return}Core.Functions.Operar.srOperarEspecies(e,function(){Core.Functions.Operar.refreshDisponible(a.detalleDisponible,function(){a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem())},a.header.selectedIdAccount,a.loaded)},a.header.selectedIdAccount,a.idDefaultProfile,a.loaded)};a.setControlsByVencimientoOrden=function(){if(a.ddlVencimientoOrden.swidget().value()==a.eVencimientoOrden.GoodTillDate){a.divFechaVencimiento.show()}else{a.txtFechaVencimiento.swidget().value(new Date());a.divFechaVencimiento.hide()}};a.setControlsByTipoOrden=function(){if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){a.divPrecioStop.show()}else{a.txtPrecioStop.val("");a.divPrecioStop.hide()}a.txtValorPrecio.removeAttr("disabled");if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Market||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketWithLeftOverAsLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){a.txtValorPrecio.val("");a.txtValorPrecio.attr("disabled","disabled");Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))}};a.getPrecio=function(){if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Market||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketWithLeftOverAsLimit){if(a.ultimaCotizacion){if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra){return a.ultimaCotizacion.Cotizacion.PrecioVenta}else{return a.ultimaCotizacion.Cotizacion.PrecioCompra}}else{return null}}else{if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){return a.txtPrecioStop.val()}else{return a.txtValorPrecio.val()}}};a.clearControls=function(b){if(b){a.ddlEspecie.swidget().refresh();a.lblUltimoPrecio.text("");a.lblVariacion.text("");a.lblMejorOfertaCompra.text("");a.lblMejorOfertaVenta.text("")}a.txtValorCantidad.val("");a.txtValorPrecio.val("");a.lblTotal.text("");a.txtObservaciones.val("");a.ddlTipoOrden.swidget().refresh();a.ddlVencimientoOrden.swidget().refresh();a.txtPrecioStop.val("");a.txtCantidadAMostrar.val("");a.txtFechaVencimiento.swidget().refresh();a.divAlertaTipoPrecio.hide();a.ultimaCotizacion=null}};Core.Business.Operar.Bonos=new function(){var a=this;a.id="bonos";a.loaded=false;a.detalleDisponible=null;a.idDefaultAccount=null;a.idDefaultProfile=null;a.decimalCount=6;a.eVencimientoOrden={GoodTillDate:6};a.eTipoOrden={Market:1,Limit:2,StopMerval:3,StopLimit:4,Stop:"z",MarketWithLeftOverAsLimit:"K",MarketIfTouched:"J"};a.divMain=null;a.divCuenta=null;a.ddlTipoOperacion=null;a.ddlPlazo=null;a.ddlEspecie=null;a.lblCuenta=null;a.divDisponible=null;a.lblDisponible=null;a.lblUltimoPrecio=null;a.lblVariacion=null;a.lblMejorOfertaCompra=null;a.lblMejorOfertaVenta=null;a.divOperarFix=null;a.divReplacePreviousOrders=null;a.chkReplacePreviousOrders=null;a.divCancelInDisconnection=null;a.chkCancelInDisconnection=null;a.divTipoOrden=null;a.ddlTipoOrden=null;a.divVencimientoOrden=null;a.ddlVencimientoOrden=null;a.divPrecioStop=null;a.txtPrecioStop=null;a.divFechaVencimiento=null;a.txtFechaVencimiento=null;a.txtValorCantidad=null;a.txtValorPrecio=null;a.lblTotal=null;a.chkCantidadAMostrar=null;a.txtCantidadAMostrar=null;a.divCantidadAMostrar=null;a.divOperarPrecarga=null;a.divFechaEjecucion=null;a.ddlMinutosEjecucion=null;a.txtFechaEjecucion=null;a.ddlHoraEjecucion=null;a.divFechaExpiracion=null;a.ddlMinutosExpiracion=null;a.txtFechaExpiracion=null;a.ddlHoraExpiracion=null;a.btnAyudaEjecutarValidaciones=null;a.chkEjecutarValidaciones=null;a.chkContinuarAutomaticamente=null;a.divObservaciones=null;a.txtObservaciones=null;a.btnContinuar=null;a.defaultTipoOperacion=null;a.defaultEspecie=null;a.defaultValorCantidad=null;a.defaultValorLimite=null;a.defaultPlazo=null;a.disponibleActual=null;a.pageOptions=null;a.operarOptions=null;a.ultimaCotizacion=null;a.ordenPrecargada=null;a.init=function(d,e,f){if(Core.Objects.Accounts){var b=$.grep(Core.Objects.Accounts,function(h,g){return h.idCuenta==d})[0];if(b.NumComitente==""){return}}a.idDefaultAccount=d;a.idDefaultProfile=e;a.defaultTipoOperacion=Core.Enums.eEspeciesTipoOperacion.Venta;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[e]);a.operarOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu("operar",Core.Objects.Context.Profiles[e]);a.defaultEspecie="";a.defaultValorCantidad="";a.defaultValorLimite="";a.defaultPlazo=a.pageOptions.plazoDefault;a.ordenPrecargada=null;$.extend(true,a,f);if(Core.Objects.Context.TieneC4D==1){Core.loadPage("operar-bonos.html",function(){document.title="Operar Bonos";a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,d,e,function(){var g=$.grep(Core.Objects.Accounts,function(i,h){return i.idCuenta==a.header.selectedIdAccount})[0];if(g.NumComitente==""){Core.Business.PosicionConsolidada.init(a.header.selectedIdAccount,a.idDefaultProfile);return}a.loaded=false;a.loadControls()},"Core.Business.Operar.Bonos")})}else{var c=new Core.Controls.Dialog("Aviso","<p>Para poder Operar debe generar el código de operación de cuatro dígitos desde Configuración de Cuenta.<br/> <a onclick=\"$('.close-btn').click(); Core.Business.AccountSettings.init("+d+", "+e+');">Haga Click Aquí para ir a Configuración de Cuenta.</a></p>',{displayButtons:{close:true,accept:false}}).show()}};a.initControls=function(){a.divMain=$(".div-main");a.divCuenta=$(".div-cuenta");a.ddlTipoOperacion=$(".dropdown-tipo-operacion");a.ddlPlazo=$(".dropdown-plazo");a.ddlEspecie=$(".dropdown-especie");a.lblCuenta=$(".label-cuenta");a.divDisponible=$(".div-disponible");a.lblDisponible=$(".label-disponible");a.lblUltimoPrecio=$(".label-ultimo-precio");a.lblVariacion=$(".label-variacion");a.lblMejorOfertaCompra=$(".label-mejor-oferta-compra");a.lblMejorOfertaVenta=$(".label-mejor-oferta-venta");a.divOperarFix=$(".div-operar-fix");a.divOperarFix.hide();a.divTipoOrden=$(".div-tipo-orden");a.ddlTipoOrden=$(".dropdown-tipo-orden");a.divVencimientoOrden=$(".div-vencimiento-orden");a.ddlVencimientoOrden=$(".dropdown-vencimiento-orden");a.divPrecioStop=$(".div-precio-stop");a.txtPrecioStop=$(".textbox-precio-stop");a.divFechaVencimiento=$(".div-fecha-vencimiento");a.txtFechaVencimiento=$(".date-fecha-vencimiento");a.txtValorCantidad=$(".textbox-cantidad");a.txtValorPrecio=$(".textbox-precio");a.lblTotal=$(".label-precio-total");a.divObservaciones=$(".div-observaciones");a.txtObservaciones=$(".text-observaciones");a.txtCantidadAMostrar=$(".textbox-cantidad-a-mostrar");a.chkCantidadAMostrar=$(".checkbox-cantidad-a-mostrar");a.divCantidadAMostrar=$(".div-cantidad-a-mostrar");a.divCantidadAMostrar.hide();a.divReplacePreviousOrders=$(".div-replace-previous-orders");a.chkReplacePreviousOrders=$(".checkbox-replace-previous-orders");a.divCancelInDisconnection=$(".div-cancel-in-disconnection");a.chkCancelInDisconnection=$(".checkbox-cancel-in-disconnection");a.divSeleccionPrecarga=$(".div-seleccion-precarga");a.divSeleccionPrecarga.hide();if(a.pageOptions&&a.pageOptions.precargar){a.divSeleccionPrecarga.show()}a.btnPrecarga=$(".btn-precarga");a.btnNormal=$(".btn-normal");a.divOperarPrecarga=$(".div-operar-precarga");a.divFechaEjecucion=$(".div-fecha-ejecucion");a.ddlMinutosEjecucion=$(".dropdown-minutos-ejecucion");a.txtFechaEjecucion=$(".date-fecha-ejecucion");a.ddlHoraEjecucion=$(".dropdown-hora-ejecucion");a.divFechaExpiracion=$(".div-fecha-expiracion");a.ddlMinutosExpiracion=$(".dropdown-minutos-expiracion");a.txtFechaExpiracion=$(".date-fecha-expiracion");a.ddlHoraExpiracion=$(".dropdown-hora-expiracion");a.btnAyudaEjecutarValidaciones=$(".btn-ayuda-ejecutar-validaciones");a.chkEjecutarValidaciones=$(".checkbox-ejecutar-validaciones");a.chkContinuarAutomaticamente=$(".checkbox-continuar-automaticamente");a.btnContinuar=$(".btn-continuar");a.ddlTipoOperacion.shieldDropDown({dataSource:{data:[{value:Core.Enums.eEspeciesTipoOperacion.Compra,text:"Compra"},{value:Core.Enums.eEspeciesTipoOperacion.Venta,text:"Venta"}]},textTemplate:"{text}",valueTemplate:"{value}",value:(a.ordenPrecargada?a.ordenPrecargada.idTipoOperacion.toString():a.defaultTipoOperacion.toString()),events:{select:function(e){a.clearControls(true);Core.Functions.Operar.setEspecieByTipoOperacion(e.item.value,a.ddlEspecie,Core.Enums.ePanel.Bonos,a.ddlPlazo.swidget().selectedItem().value,a.header.selectedIdAccount,a.loaded,function(){a.loadControlsByEspecie();a.setDisponible(e.item.value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem())});Core.Functions.Operar.setColorByTipoOperacion(e.item.value,a.divMain,a.divCuenta)}}});a.ddlEspecie.shieldComboBox({dataSource:{data:[]},valueTemplate:"{DisplayTicker}",value:(a.ordenPrecargada?a.ordenPrecargada.DisplayTicker:a.defaultEspecie),textTemplate:"{DisplayTicker} | {Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}},events:{select:function(f){if(f.index>=0){a.clearControls(false);a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem());Core.Functions.Operar.setLabelsByEspecie(a.ddlEspecie,a.ddlPlazo.swidget().selectedItem().value,a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(e){a.ultimaCotizacion=e;if(a.operarOptions.operarFIX){Core.Functions.Operar.setControlsOperarFix(a.ultimaCotizacion,a.ddlTipoOrden,a.ddlVencimientoOrden,a.divOperarFix,a.divReplacePreviousOrders,a.divCancelInDisconnection,false,function(){a.setControlsByVencimientoOrden();a.setControlsByTipoOrden()})}})}}}});a.ddlPlazo.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",value:(a.ordenPrecargada?a.ordenPrecargada.Plazo.toString():a.defaultPlazo.toString()),events:{select:function(e){a.clearControls(true);Core.Functions.Operar.setEspecieByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlEspecie,Core.Enums.ePanel.Bonos,a.ddlPlazo.swidget().selectedItem().value,a.header.selectedIdAccount,a.loaded,function(){a.loadControlsByEspecie();a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,e.item.value,a.ddlEspecie.swidget().selectedItem());Core.Functions.Operar.setLabelsByEspecie(a.ddlEspecie,a.ddlPlazo.swidget().selectedItem().value,a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(f){a.ultimaCotizacion=f;Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))})})}}});Core.Functions.Operar.setPlazos(a.ddlPlazo,a.pageOptions.plazosHabilitados);a.ddlTipoOrden.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{Valor}",value:(a.ordenPrecargada?a.ordenPrecargada.OrderType:""),events:{select:function(e){a.setControlsByTipoOrden()}}});a.ddlVencimientoOrden.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{Valor}",value:(a.ordenPrecargada?a.ordenPrecargada.TimeInForce:""),events:{select:function(e){a.setControlsByVencimientoOrden()}}});new Core.Controls.DecimalPicker(a.txtPrecioStop,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))},defaultValue:(a.ordenPrecargada?a.ordenPrecargada.PrecioDisparo:0)});a.txtFechaVencimiento.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.ordenPrecargada?Core.Functions.Date.getDateByStringWithoutSeparator(a.ordenPrecargada.FechaVencimiento):new Date())});new Core.Controls.DecimalPicker(a.txtValorCantidad,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))},defaultValue:(a.ordenPrecargada?a.ordenPrecargada.Cantidad:a.defaultValorCantidad)});new Core.Controls.DecimalPicker(a.txtValorPrecio,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))},defaultValue:(a.ordenPrecargada?a.ordenPrecargada.PrecioLimite:a.defaultValorLimite)});a.chkCantidadAMostrar.shieldCheckBox({label:"Difusión Parcial / Iceberg",checked:(a.ordenPrecargada&&a.ordenPrecargada.DisplayQty),events:{click:function(f){a.divCantidadAMostrar.hide();if(a.chkCantidadAMostrar.swidget().checked()){a.divCantidadAMostrar.show()}}}});new Core.Controls.DecimalPicker(a.txtCantidadAMostrar,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",defaultValue:(a.ordenPrecargada?a.ordenPrecargada.DisplayQty:0)});a.chkReplacePreviousOrders.shieldCheckBox({label:"Reemplazar órdenes previas",checked:(a.ordenPrecargada&&a.ordenPrecargada.ExecInst&&a.ordenPrecargada.ExecInst.indexOf("x")>=0)});a.chkCancelInDisconnection.shieldCheckBox({label:"Cancelar orden ante desconexión",checked:(a.ordenPrecargada&&a.ordenPrecargada.ExecInst&&a.ordenPrecargada.ExecInst.indexOf("o")>=0)});a.divOperarPrecarga.hide();a.btnNormal.on("click",function(){a.divOperarPrecarga.hide()});a.btnPrecarga.on("click",function(){a.divOperarPrecarga.show()});var b=[];for(var c=10;c<=18;c++){for(var d=0;d<=55;d=d+5){b.push({value:(c.padLeft(2,"0")+":"+d.padLeft(2,"0"))})}}a.ddlMinutosEjecucion.shieldDropDown({dataSource:{data:[{value:0,text:"Ahora"},{value:10,text:"En 10 minutos"},{value:30,text:"En 30 minutos"},{value:60,text:"En 1 hora"},{value:-1,text:"Otro"}]},textTemplate:"{text}",valueTemplate:"{value}",value:(a.ordenPrecargada&&a.ordenPrecargada.MinutosEjecucion?a.ordenPrecargada.MinutosEjecucion.toString():(a.ordenPrecargada&&a.ordenPrecargada.FechaEjecucion?"-1":"0")),events:{select:function(e){Core.Functions.Operar.setControlsByMinutosEjecucion(a.ddlMinutosEjecucion,a.divFechaEjecucion)}}});a.txtFechaEjecucion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.ordenPrecargada?Core.Functions.Date.getDateByStringDisplayDate(a.ordenPrecargada.FechaEjecucion):new Date())});a.ddlHoraEjecucion.shieldDropDown({dataSource:{data:b},textTemplate:"{value}",valueTemplate:"{value}",value:(a.ordenPrecargada&&a.ordenPrecargada.FechaEjecucion?a.ordenPrecargada.FechaEjecucion.substr(11,5):"")});a.ddlMinutosExpiracion.shieldDropDown({dataSource:{data:[{value:10,text:"En 10 minutos"},{value:30,text:"En 30 minutos"},{value:60,text:"En 1 hora"},{value:360,text:"En 6 horas"},{value:-1,text:"Otro"}]},textTemplate:"{text}",valueTemplate:"{value}",value:(a.ordenPrecargada&&a.ordenPrecargada.MinutosExpiracion?a.ordenPrecargada.MinutosExpiracion.toString():(a.ordenPrecargada&&a.ordenPrecargada.FechaExpiracion?"-1":"360")),events:{select:function(e){Core.Functions.Operar.setControlsByMinutosExpiracion(a.ddlMinutosExpiracion,a.divFechaExpiracion)}}});a.txtFechaExpiracion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.ordenPrecargada?Core.Functions.Date.getDateByStringDisplayDate(a.ordenPrecargada.FechaExpiracion):new Date())});a.ddlHoraExpiracion.shieldDropDown({dataSource:{data:b},textTemplate:"{value}",valueTemplate:"{value}",value:(a.ordenPrecargada&&a.ordenPrecargada.FechaExpiracion?a.ordenPrecargada.FechaExpiracion.substr(11,5):"")});a.btnAyudaEjecutarValidaciones.on("click",function(){Core.Functions.Operar.showAyudaEjecutarValidaciones()});a.chkEjecutarValidaciones.shieldCheckBox({label:"Excluir validaciones",checked:(a.ordenPrecargada&&a.ordenPrecargada.EjecutarValidaciones)});a.chkContinuarAutomaticamente.shieldCheckBox({label:"Permitir al cliente modificar esta precarga",checked:(a.ordenPrecargada&&a.ordenPrecargada.ContinuarAutomaticamente)});a.txtObservaciones.shieldTextBox({value:(a.ordenPrecargada?a.ordenPrecargada.Observaciones:"")});if(Core.Objects.Context.Configuration.idAplicacion==1){a.divObservaciones.hide()}a.btnContinuar.click(function(){a.btnContinuarClick()})};a.loadControlsByEspecie=function(){if(a.ddlEspecie.swidget().selectedItem()){Core.Functions.Operar.setLabelsByEspecie(a.ddlEspecie,a.ddlPlazo.swidget().selectedItem().value,a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(c){a.ultimaCotizacion=c;if(a.operarOptions.operarFIX){Core.Functions.Operar.setControlsOperarFix(a.ultimaCotizacion,a.ddlTipoOrden,a.ddlVencimientoOrden,a.divOperarFix,a.divReplacePreviousOrders,a.divCancelInDisconnection,true,function(){a.setControlsByVencimientoOrden();a.setControlsByTipoOrden()})}})}else{if(a.defaultEspecie!=""){var b=new Core.Controls.Dialog("Aviso","No posee la Especie "+a.defaultEspecie+".",{displayButtons:{close:true,accept:false}}).show();a.clearControls(true)}}};a.loadControls=function(){Core.Functions.Operar.setComitente(a.lblCuenta,a.header.selectedIdAccount,a.loaded);var b=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,requestUrl:"detalledisponible/"+encodeURIComponent(a.header.selectedIdAccount),requestType:"GET",requestData:{Fecha:Core.Functions.Date.getDateAsString(new Date())}});b.onSuccess=function(c){a.detalleDisponible=c;Core.Functions.Operar.setEspecieByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlEspecie,Core.Enums.ePanel.Bonos,a.ddlPlazo.swidget().selectedItem().value,a.header.selectedIdAccount,a.loaded,function(){a.loadControlsByEspecie();var d=a.ddlEspecie.swidget().selectedItem();a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,(d)?d:null);Core.Functions.Operar.setColorByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.divMain,a.divCuenta);if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra&&a.defaultValorCantidad!=""&&a.defaultValorLimite!=""&&d){var e=$.grep(a.detalleDisponible.disponible,function(h,g){return h.idMoneda==d.idMoneda})[0];if(!e){e=0}else{if(a.ddlPlazo.swidget().selectedItem().value==Core.Enums.ePlazo.CI){e=e.DisponibleOperableCI}else{e=e.DisponibleOperable72}}var f=Math.floor((e/a.defaultValorLimite));if(f<a.defaultValorCantidad){if(f<0){a.txtValorCantidad.val("")}else{a.txtValorCantidad.val(f)}}}if(a.ddlEspecie.swidget().selectedItem()&&a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta&&a.defaultValorCantidad!=""){if(a.ddlEspecie.swidget().selectedItem().Cantidad<a.defaultValorCantidad){a.txtValorCantidad.val(a.ddlEspecie.swidget().selectedItem().Cantidad)}else{a.txtValorCantidad.val(a.defaultValorCantidad)}}Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null));Core.Functions.Operar.setControlsByMinutosEjecucion(a.ddlMinutosEjecucion,a.divFechaEjecucion);Core.Functions.Operar.setControlsByMinutosExpiracion(a.ddlMinutosExpiracion,a.divFechaExpiracion)})};b.request()};a.setDisponible=function(d,c,b){a.divDisponible.hide();if(d==Core.Enums.eEspeciesTipoOperacion.Compra&&c!=null&&b!=null){a.disponibleActual=Core.Functions.Operar.setDisponible(a.detalleDisponible.disponible,b.idMoneda,c,a.lblDisponible,a.divDisponible)}};a.btnContinuarClick=function(){var f={value:true};Core.Functions.Validations.getValidatedDropDownValue(a.ddlEspecie,f);var e={idCuenta:a.header.selectedIdAccount,FechaVencimiento:Core.Functions.Date.getDateAsString(new Date()),idTipoOperacion:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,f),ticker:(a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().Ticker:null,Plazo:Core.Functions.Validations.getValidatedDropDownValue(a.ddlPlazo,f),idMoneda:(a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().idMoneda:null,Cantidad:Core.Functions.Validations.getValidatedNumericInputValue(a.txtValorCantidad,f),Monto:null,PrecioDisparo:null,Observaciones:a.txtObservaciones.val()};if(a.ordenPrecargada){e.idOrdenPrecargada=a.ordenPrecargada.idOrdenPrecargada}if(a.operarOptions.operarFIX&&a.ddlTipoOrden.swidget().selectedItem()&&a.ddlVencimientoOrden.swidget().selectedItem()){e.OrderType=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOrden,f);e.TimeInForce=Core.Functions.Validations.getValidatedDropDownValue(a.ddlVencimientoOrden,f);if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){e.PrecioDisparo=Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecioStop,f)}if(a.ddlVencimientoOrden.swidget().value()==a.eVencimientoOrden.GoodTillDate){var b=new Date();b.setHours(0,0,0,0);var d=((a.txtFechaVencimiento.swidget().value())?a.txtFechaVencimiento.swidget().value():new Date());d.setHours(0,0,0,0);e.FechaVencimiento=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaVencimiento,f));if(b.getTime()>d.getTime()){f.value=false;Core.Functions.Validations.toggleValidation(a.txtFechaVencimiento,true)}}if(a.chkCantidadAMostrar.swidget().checked()){e.DisplayQty=Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidadAMostrar,f);if(f.value&&(parseFloat(e.DisplayQty)<0||parseFloat(e.DisplayQty)>=parseFloat(e.Cantidad))){f.value=false;var c=new Core.Controls.Dialog("Aviso","La cantidad a mostrar debe ser positiva y menor a los nominales ingresados ",{displayButtons:{close:true,accept:false}}).show()}}}if(a.divReplacePreviousOrders.is(":visible")&&a.chkReplacePreviousOrders.swidget().checked()){e.ExecInst="x"}if(a.divCancelInDisconnection.is(":visible")&&a.chkCancelInDisconnection.swidget().checked()){if(e.ExecInst){e.ExecInst+=" o"}else{e.ExecInst="o"}}if(!a.ddlTipoOrden.swidget().selectedItem()||(a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.Market&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.MarketWithLeftOverAsLimit&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.StopMerval&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.Stop&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.MarketIfTouched)){e.PrecioLimite=Core.Functions.Validations.getValidatedNumericInputValue(a.txtValorPrecio,f)}if(a.divOperarPrecarga.is(":visible")){e.EsPrecarga=1;if(a.divFechaEjecucion.is(":visible")){e.FechaEjecucion=(Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaEjecucion,f))+" "+Core.Functions.Validations.getValidatedDropDownValue(a.ddlHoraEjecucion,f)+":00")}else{e.MinutosEjecucion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMinutosEjecucion,f)}if(a.divFechaExpiracion.is(":visible")){e.FechaExpiracion=(Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaExpiracion,f))+" "+Core.Functions.Validations.getValidatedDropDownValue(a.ddlHoraExpiracion,f)+":00")}else{e.MinutosExpiracion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMinutosExpiracion,f)}e.EjecutarValidaciones=a.chkEjecutarValidaciones.swidget().checked()?1:0;e.ContinuarAutomaticamente=a.chkContinuarAutomaticamente.swidget().checked()?0:1}if(f.value){Core.Functions.Operar.srOperarEspeciesValidaciones(a.txtValorCantidad,f)}if(!f.value){return}Core.Functions.Operar.srOperarEspecies(e,function(){Core.Functions.Operar.refreshDisponible(a.detalleDisponible,function(){a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem())},a.header.selectedIdAccount,a.loaded)},a.header.selectedIdAccount,a.idDefaultProfile,a.loaded)};a.setControlsByVencimientoOrden=function(){if(a.ddlVencimientoOrden.swidget().value()==a.eVencimientoOrden.GoodTillDate){a.divFechaVencimiento.show()}else{a.txtFechaVencimiento.swidget().value(new Date());a.divFechaVencimiento.hide()}};a.setControlsByTipoOrden=function(){if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){a.divPrecioStop.show()}else{a.txtPrecioStop.val("");a.divPrecioStop.hide()}a.txtValorPrecio.removeAttr("disabled");if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Market||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketWithLeftOverAsLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){a.txtValorPrecio.val("");a.txtValorPrecio.attr("disabled","disabled");Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))}};a.getPrecio=function(){if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Market||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketWithLeftOverAsLimit){if(a.ultimaCotizacion){if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra){return a.ultimaCotizacion.Cotizacion.PrecioVenta}else{return a.ultimaCotizacion.Cotizacion.PrecioCompra}}else{return null}}else{if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){return a.txtPrecioStop.val()}else{return a.txtValorPrecio.val()}}};a.clearControls=function(b){if(b){a.ddlEspecie.swidget().refresh();a.lblUltimoPrecio.text("");a.lblVariacion.text("");a.lblMejorOfertaCompra.text("");a.lblMejorOfertaVenta.text("")}a.txtValorCantidad.val("");a.txtValorPrecio.val("");a.lblTotal.text("");a.txtObservaciones.val("");a.ddlTipoOrden.swidget().refresh();a.ddlVencimientoOrden.swidget().refresh();a.txtPrecioStop.val("");a.txtCantidadAMostrar.val("");a.txtFechaVencimiento.swidget().refresh();a.ultimaCotizacion=null}};Core.Business.Operar.Cauciones=new function(){var a=this;a.id="cauciones";a.loaded=false;a.detalleDisponible=null;a.idDefaultAccount=null;a.idDefaultProfile=null;a.decimalCount=6;a.eVencimientoOrden={GoodTillDate:6};a.eTipoOrden={Market:1,Limit:2,StopMerval:3,StopLimit:4,Stop:"z",MarketWithLeftOverAsLimit:"K",MarketIfTouched:"J"};a.divMain=null;a.divCuenta=null;a.ddlTipoOperacion=null;a.ddlMoneda=null;a.ddlEspecie=null;a.lblCuenta=null;a.divDisponible=null;a.lblDisponible=null;a.lblUltimoPrecio=null;a.lblVariacion=null;a.lblMejorOfertaCompra=null;a.lblMejorOfertaVenta=null;a.divOperarFix=null;a.divTipoOrden=null;a.ddlTipoOrden=null;a.divVencimientoOrden=null;a.ddlVencimientoOrden=null;a.divPrecioStop=null;a.txtPrecioStop=null;a.divFechaVencimiento=null;a.txtFechaVencimiento=null;a.txtValorCantidad=null;a.txtValorPrecio=null;a.lblTotal=null;a.btnContinuar=null;a.defaultTipoOperacion=null;a.defaultMoneda=null;a.defaultEspecie=null;a.defaultValorCantidad=null;a.defaultValorLimite=null;a.disponibleActual=null;a.pageOptions=null;a.operarOptions=null;a.ultimaCotizacion=null;a.init=function(c,d,e){if(Core.Objects.Accounts){var b=$.grep(Core.Objects.Accounts,function(g,f){return g.idCuenta==c})[0];if(b&&b.NumComitente==""){return}}a.idDefaultAccount=c;a.idDefaultProfile=d;a.defaultTipoOperacion=Core.Enums.eEspeciesTipoOperacion.CaucionColocadora;a.defaultMoneda=Core.Enums.Currency.Pesos.idMoneda;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[d]);a.operarOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu("operar",Core.Objects.Context.Profiles[d]);a.defaultEspecie="";a.defaultValorCantidad="";a.defaultValorLimite="";$.extend(true,a,e);a.tiposDeOperacion=[{value:Core.Enums.eEspeciesTipoOperacion.CaucionColocadora,text:"Caución Colocadora"}];if(a.pageOptions.puedeTomarCaucion==1){a.tiposDeOperacion.push({value:Core.Enums.eEspeciesTipoOperacion.CaucionTomadora,text:"Caución Tomadora"})}if(!$.grep(a.tiposDeOperacion,function(g,f){return g.value==a.defaultTipoOperacion})[0]){new Core.Controls.Dialog("Aviso","Para poder realizar esta operación, por favor comunicate con tu Asesor.",{displayButtons:{close:true,accept:false}}).show()}else{if(Core.Objects.Context.TieneC4D==1){Core.loadPage("operar-cauciones.html",function(){document.title="Operar Cauciones";a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,c,d,function(){var f=$.grep(Core.Objects.Accounts,function(h,g){return h.idCuenta==a.header.selectedIdAccount})[0];if(f.NumComitente==""){Core.Business.PosicionConsolidada.init(a.header.selectedIdAccount,a.idDefaultProfile);return}a.loaded=false;a.loadControls()},"Core.Business.Operar.Cauciones")})}else{new Core.Controls.Dialog("Aviso","<p>Para poder Operar debe generar el código de operación de cuatro dígitos desde Configuración de Cuenta.<br/> <a onclick=\"$('.close-btn').click(); Core.Business.AccountSettings.init("+c+", "+d+');">Haga Click Aquí para ir a Configuración de Cuenta.</a></p>',{displayButtons:{close:true,accept:false}}).show()}}};a.initControls=function(){a.divMain=$(".div-main");a.divCuenta=$(".div-cuenta");a.ddlTipoOperacion=$(".dropdown-tipo-operacion");a.ddlMoneda=$(".dropdown-moneda");a.ddlEspecie=$(".dropdown-especie");a.lblCuenta=$(".label-cuenta");a.divDisponible=$(".div-disponible");a.lblDisponible=$(".label-disponible");a.lblUltimoPrecio=$(".label-ultimo-precio");a.lblVariacion=$(".label-variacion");a.lblMejorOfertaCompra=$(".label-mejor-oferta-compra");a.lblMejorOfertaVenta=$(".label-mejor-oferta-venta");a.divOperarFix=$(".div-operar-fix");a.divOperarFix.hide();a.divTipoOrden=$(".div-tipo-orden");a.ddlTipoOrden=$(".dropdown-tipo-orden");a.divVencimientoOrden=$(".div-vencimiento-orden");a.ddlVencimientoOrden=$(".dropdown-vencimiento-orden");a.divPrecioStop=$(".div-precio-stop");a.txtPrecioStop=$(".textbox-precio-stop");a.divFechaVencimiento=$(".div-fecha-vencimiento");a.txtFechaVencimiento=$(".date-fecha-vencimiento");a.txtValorCantidad=$(".textbox-cantidad");a.txtValorPrecio=$(".textbox-precio");a.lblTotal=$(".label-precio-total");a.btnContinuar=$(".btn-continuar");a.ddlTipoOperacion.shieldDropDown({dataSource:{data:a.tiposDeOperacion},textTemplate:"{text}",valueTemplate:"{value}",value:a.defaultTipoOperacion.toString(),events:{select:function(b){a.clearControls(true);a.setDisponible();Core.Functions.Operar.setColorByTipoOperacion(b.item.value,a.divMain,a.divCuenta);Core.Functions.Operar.setEspecieByTipoOperacion(b.item.value,a.ddlEspecie,Core.Enums.ePanel.Cauciones,null,a.header.selectedIdAccount,a.loaded,function(){a.loadControlsByEspecie()},function(c){return c.idMoneda==a.ddlMoneda.swidget().value()})}}});a.ddlMoneda.shieldDropDown({dataSource:{data:[Core.Enums.Currency.Pesos,Core.Enums.Currency.Dolares]},textTemplate:"{Descripcion}",valueTemplate:"{idMoneda}",value:a.defaultMoneda.toString(),events:{select:function(b){a.clearControls(true);a.setDisponible();Core.Functions.Operar.setEspecieByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlEspecie,Core.Enums.ePanel.Cauciones,null,a.header.selectedIdAccount,a.loaded,function(){a.loadControlsByEspecie()},function(c){return c.idMoneda==a.ddlMoneda.swidget().value()})}}});a.ddlEspecie.shieldComboBox({dataSource:{data:[]},valueTemplate:"{SecurityID}",value:a.defaultEspecie,textTemplate:"{DisplayTicker} | {Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}},events:{select:function(b){if(b.index>=0){a.clearControls(false);a.setDisponible();Core.Functions.Operar.setLabelsByEspecie(a.ddlEspecie,((!a.ddlEspecie.swidget().selectedItem())?null:a.ddlEspecie.swidget().selectedItem().Plazo),a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(c){a.ultimaCotizacion=c;if(a.operarOptions.operarFIX){Core.Functions.Operar.setControlsOperarFix(a.ultimaCotizacion,a.ddlTipoOrden,a.ddlVencimientoOrden,a.divOperarFix,null,null,a.loaded,function(){a.setControlsByVencimientoOrden();a.setControlsByTipoOrden()})}})}}}});a.ddlTipoOrden.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{Valor}",events:{select:function(b){a.setControlsByTipoOrden()}}});a.ddlVencimientoOrden.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{Valor}",events:{select:function(b){a.setControlsByVencimientoOrden()}}});new Core.Controls.DecimalPicker(a.txtPrecioStop,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){a.setTotalOperacion()}});a.txtFechaVencimiento.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date()});new Core.Controls.DecimalPicker(a.txtValorCantidad,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){a.setTotalOperacion()},defaultValue:a.defaultValorCantidad});new Core.Controls.DecimalPicker(a.txtValorPrecio,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){a.setTotalOperacion()},defaultValue:a.defaultValorLimite});a.btnContinuar.click(function(){a.btnContinuarClick()})};a.loadControlsByEspecie=function(){if(a.ddlEspecie.swidget().selectedItem()){Core.Functions.Operar.setLabelsByEspecie(a.ddlEspecie,((!a.ddlEspecie.swidget().selectedItem())?null:a.ddlEspecie.swidget().selectedItem().Plazo),a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(c){a.ultimaCotizacion=c;if(a.operarOptions.operarFIX){Core.Functions.Operar.setControlsOperarFix(a.ultimaCotizacion,a.ddlTipoOrden,a.ddlVencimientoOrden,a.divOperarFix,null,null,a.loaded,function(){a.setControlsByVencimientoOrden();a.setControlsByTipoOrden()})}})}else{if(a.defaultEspecie!=""){var b=new Core.Controls.Dialog("Aviso","No posee la Especie "+a.defaultEspecie+".",{displayButtons:{close:true,accept:false}}).show();a.clearControls(true)}}};a.loadControls=function(){Core.Functions.Operar.setComitente(a.lblCuenta,a.header.selectedIdAccount,a.loaded);var b=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,requestUrl:"detalledisponible/"+encodeURIComponent(a.header.selectedIdAccount),requestType:"GET",requestData:{Fecha:Core.Functions.Date.getDateAsString(new Date())}});b.onSuccess=function(c){a.detalleDisponible=c;Core.Functions.Operar.setEspecieByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlEspecie,Core.Enums.ePanel.Cauciones,null,a.header.selectedIdAccount,a.loaded,function(){a.loadControlsByEspecie();if(a.ddlEspecie.swidget().selectedItem()){a.ddlMoneda.swidget().value(a.ddlEspecie.swidget().selectedItem().idMoneda.toString());var d=a.ddlEspecie.swidget().initialOptions;d.dataSource.data=$.grep(a.ddlEspecie.swidget().dataSource.data,function(f,e){return f.idMoneda==a.ddlMoneda.swidget().value()});a.ddlEspecie.swidget().refresh(d)}a.setDisponible();a.setTotalOperacion();Core.Functions.Operar.setColorByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.divMain,a.divCuenta)},function(d){return true})};b.request()};a.setDisponible=function(){a.divDisponible.hide();if(a.ddlMoneda.swidget().selectedItem()&&a.ddlEspecie.swidget().selectedItem()&&a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.CaucionColocadora){var c=$.grep(a.detalleDisponible.cauciones,function(e,d){return e.idMoneda==a.ddlMoneda.swidget().selectedItem().idMoneda})[0];var b="0";if(c){if(a.ddlEspecie.swidget().selectedItem().Plazo<=c.PlazoCI){b=c.DisponibleOperableCI}else{if(a.ddlEspecie.swidget().selectedItem().Plazo<=c.Plazo24){b=c.DisponibleOperable24}else{if(a.ddlEspecie.swidget().selectedItem().Plazo<=c.Plazo48){b=c.DisponibleOperable48}else{if(a.ddlEspecie.swidget().selectedItem().Plazo<=c.Plazo72){b=c.DisponibleOperable72}else{b=c.DisponibleOperableFuturo}}}}}a.lblDisponible.text("Disponible: "+b+" "+a.ddlMoneda.swidget().selectedItem().Descripcion);a.divDisponible.show();a.disponibleActual=b}};a.btnContinuarClick=function(){var e={value:true};var d={idCuenta:a.header.selectedIdAccount,FechaVencimiento:Core.Functions.Date.getDateAsString(new Date()),idTipoOperacion:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,e),ticker:(a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().Ticker:null,SecurityID:Core.Functions.Validations.getValidatedDropDownValue(a.ddlEspecie,e),Plazo:(a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().Plazo:null,idMoneda:(a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().idMoneda:null,Cantidad:Core.Functions.Validations.getValidatedNumericInputValue(a.txtValorCantidad,e),Monto:null,PrecioDisparo:null};if(a.operarOptions.operarFIX&&a.ddlTipoOrden.swidget().selectedItem()&&a.ddlVencimientoOrden.swidget().selectedItem()){d.OrderType=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOrden,e);d.TimeInForce=Core.Functions.Validations.getValidatedDropDownValue(a.ddlVencimientoOrden,e);if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){d.PrecioDisparo=Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecioStop,e)}if(a.ddlVencimientoOrden.swidget().value()==a.eVencimientoOrden.GoodTillDate){var b=new Date();b.setHours(0,0,0,0);var c=((a.txtFechaVencimiento.swidget().value())?a.txtFechaVencimiento.swidget().value():new Date());c.setHours(0,0,0,0);d.FechaVencimiento=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaVencimiento,e));if(b.getTime()>c.getTime()){e.value=false;Core.Functions.Validations.toggleValidation(a.txtFechaVencimiento,true)}}}if(!a.ddlTipoOrden.swidget().selectedItem()||(a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.Market&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.MarketWithLeftOverAsLimit&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.StopMerval&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.Stop&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.MarketIfTouched)){d.PrecioLimite=Core.Functions.Validations.getValidatedNumericInputValue(a.txtValorPrecio,e)}if(e.value){Core.Functions.Operar.srOperarEspeciesValidaciones(a.txtValorCantidad,e)}if(!e.value){return}Core.Functions.Operar.srOperarEspecies(d,function(){Core.Functions.Operar.refreshDisponible(a.detalleDisponible,function(){a.setDisponible()},a.header.selectedIdAccount,a.loaded)},a.header.selectedIdAccount,a.idDefaultProfile,a.loaded)};a.setControlsByVencimientoOrden=function(){if(a.ddlVencimientoOrden.swidget().value()==a.eVencimientoOrden.GoodTillDate){a.divFechaVencimiento.show()}else{a.txtFechaVencimiento.swidget().value(new Date());a.divFechaVencimiento.hide()}};a.setControlsByTipoOrden=function(){if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){a.divPrecioStop.show()}else{a.txtPrecioStop.val("");a.divPrecioStop.hide()}a.txtValorPrecio.removeAttr("disabled");if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Market||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketWithLeftOverAsLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){a.txtValorPrecio.val("");a.txtValorPrecio.attr("disabled","disabled");a.setTotalOperacion()}};a.getPrecio=function(){if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Market||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketWithLeftOverAsLimit){if(a.ultimaCotizacion){if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.CaucionColocadora){return a.ultimaCotizacion.Cotizacion.PrecioCompra}else{return a.ultimaCotizacion.Cotizacion.PrecioVenta}}else{return null}}else{if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){return a.txtPrecioStop.val()}else{return a.txtValorPrecio.val()}}};a.setTotalOperacion=function(){var b=Core.Functions.Decimal.parseFloat(a.txtValorCantidad.val());var d=Core.Functions.Decimal.parseFloat(a.getPrecio());var c=Core.Functions.Decimal.parseFloat(((a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().Plazo:null));if(!b||b==0||!d||d==0||!c||c==0){a.lblTotal.text("")}else{var e=(Core.Functions.Decimal.parseFloat(b)+(b*d*c)/36500);a.lblTotal.text(e.toFixed(2))}};a.clearControls=function(b){if(b){a.ddlEspecie.swidget().refresh();a.lblUltimoPrecio.text("");a.lblVariacion.text("");a.lblMejorOfertaCompra.text("");a.lblMejorOfertaVenta.text("")}a.txtValorCantidad.val("");a.txtValorPrecio.val("");a.lblTotal.text("");a.ddlTipoOrden.swidget().refresh();a.ddlVencimientoOrden.swidget().refresh();a.txtPrecioStop.val("");a.txtFechaVencimiento.swidget().refresh();a.ultimaCotizacion=null}};Core.Business.Operar.Cedears=new function(){var a=this;a.id="cedears";a.loaded=false;a.detalleDisponible=null;a.idDefaultAccount=null;a.idDefaultProfile=null;a.eVencimientoOrden={GoodTillDate:6};a.eTipoOrden={Market:1,Limit:2,StopMerval:3,StopLimit:4,Stop:"z",MarketWithLeftOverAsLimit:"K",MarketIfTouched:"J"};a.divMain=null;a.divCuenta=null;a.ddlTipoOperacion=null;a.ddlEspecie=null;a.lblCuenta=null;a.ddlPlazo=null;a.divDisponible=null;a.lblDisponible=null;a.lblUltimoPrecio=null;a.lblVariacion=null;a.lblMejorOfertaCompra=null;a.lblMejorOfertaVenta=null;a.divOperarFix=null;a.divReplacePreviousOrders=null;a.chkReplacePreviousOrders=null;a.divCancelInDisconnection=null;a.chkCancelInDisconnection=null;a.divTipoOrden=null;a.ddlTipoOrden=null;a.divVencimientoOrden=null;a.ddlVencimientoOrden=null;a.divPrecioStop=null;a.txtPrecioStop=null;a.divFechaVencimiento=null;a.txtFechaVencimiento=null;a.txtValorCantidad=null;a.txtValorPrecio=null;a.lblTotal=null;a.chkCantidadAMostrar=null;a.txtCantidadAMostrar=null;a.divCantidadAMostrar=null;a.divOperarPrecarga=null;a.divFechaEjecucion=null;a.ddlMinutosEjecucion=null;a.txtFechaEjecucion=null;a.ddlHoraEjecucion=null;a.divFechaExpiracion=null;a.ddlMinutosExpiracion=null;a.txtFechaExpiracion=null;a.ddlHoraExpiracion=null;a.btnAyudaEjecutarValidaciones=null;a.chkEjecutarValidaciones=null;a.chkContinuarAutomaticamente=null;a.divObservaciones=null;a.txtObservaciones=null;a.btnContinuar=null;a.defaultPlazo=null;a.defaultTipoOperacion=null;a.defaultEspecie=null;a.defaultValorCantidad=null;a.defaultValorLimite=null;a.disponibleActual=null;a.pageOptions=null;a.operarOptions=null;a.ultimaCotizacion=null;a.ordenPrecargada=null;a.init=function(d,e,f){if(Core.Objects.Accounts){var b=$.grep(Core.Objects.Accounts,function(h,g){return h.idCuenta==d})[0];if(b.NumComitente==""){return}}a.idDefaultAccount=d;a.idDefaultProfile=e;a.defaultTipoOperacion=Core.Enums.eEspeciesTipoOperacion.Venta;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[e]);a.operarOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu("operar",Core.Objects.Context.Profiles[e]);a.defaultEspecie="";a.defaultValorCantidad="";a.defaultValorLimite="";a.defaultPlazo=a.pageOptions.plazoDefault;a.ordenPrecargada=null;$.extend(true,a,f);if(Core.Objects.Context.TieneC4D==1){Core.loadPage("operar-cedears.html",function(){document.title="Operar Cedears";a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,d,e,function(){var g=$.grep(Core.Objects.Accounts,function(i,h){return i.idCuenta==a.header.selectedIdAccount})[0];if(g.NumComitente==""){Core.Business.PosicionConsolidada.init(a.header.selectedIdAccount,a.idDefaultProfile);return}a.loaded=false;a.loadControls()},"Core.Business.Operar.Cedears")})}else{var c=new Core.Controls.Dialog("Aviso","<p>Para poder Operar debe generar el código de operación de cuatro dígitos desde Configuración de Cuenta.<br/> <a onclick=\"$('.close-btn').click(); Core.Business.AccountSettings.init("+d+", "+e+');">Haga Click Aquí para ir a Configuración de Cuenta.</a></p>',{displayButtons:{close:true,accept:false}}).show()}};a.initControls=function(){a.divMain=$(".div-main");a.divCuenta=$(".div-cuenta");a.ddlTipoOperacion=$(".dropdown-tipo-operacion");a.ddlEspecie=$(".dropdown-especie");a.lblCuenta=$(".label-cuenta");a.divDisponible=$(".div-disponible");a.lblDisponible=$(".label-disponible");a.lblUltimoPrecio=$(".label-ultimo-precio");a.lblVariacion=$(".label-variacion");a.ddlPlazo=$(".dropdown-plazo");a.lblMejorOfertaCompra=$(".label-mejor-oferta-compra");a.lblMejorOfertaVenta=$(".label-mejor-oferta-venta");a.divOperarFix=$(".div-operar-fix");a.divOperarFix.hide();a.divTipoOrden=$(".div-tipo-orden");a.ddlTipoOrden=$(".dropdown-tipo-orden");a.divVencimientoOrden=$(".div-vencimiento-orden");a.ddlVencimientoOrden=$(".dropdown-vencimiento-orden");a.divPrecioStop=$(".div-precio-stop");a.txtPrecioStop=$(".textbox-precio-stop");a.divFechaVencimiento=$(".div-fecha-vencimiento");a.txtFechaVencimiento=$(".date-fecha-vencimiento");a.txtValorCantidad=$(".textbox-cantidad");a.txtValorPrecio=$(".textbox-precio");a.lblTotal=$(".label-precio-total");a.divObservaciones=$(".div-observaciones");a.txtObservaciones=$(".text-observaciones");a.txtCantidadAMostrar=$(".textbox-cantidad-a-mostrar");a.chkCantidadAMostrar=$(".checkbox-cantidad-a-mostrar");a.divCantidadAMostrar=$(".div-cantidad-a-mostrar");a.divCantidadAMostrar.hide();a.divReplacePreviousOrders=$(".div-replace-previous-orders");a.chkReplacePreviousOrders=$(".checkbox-replace-previous-orders");a.divCancelInDisconnection=$(".div-cancel-in-disconnection");a.chkCancelInDisconnection=$(".checkbox-cancel-in-disconnection");a.divSeleccionPrecarga=$(".div-seleccion-precarga");a.divSeleccionPrecarga.hide();if(a.pageOptions&&a.pageOptions.precargar){a.divSeleccionPrecarga.show()}a.btnPrecarga=$(".btn-precarga");a.btnNormal=$(".btn-normal");a.divOperarPrecarga=$(".div-operar-precarga");a.divFechaEjecucion=$(".div-fecha-ejecucion");a.ddlMinutosEjecucion=$(".dropdown-minutos-ejecucion");a.txtFechaEjecucion=$(".date-fecha-ejecucion");a.ddlHoraEjecucion=$(".dropdown-hora-ejecucion");a.divFechaExpiracion=$(".div-fecha-expiracion");a.ddlMinutosExpiracion=$(".dropdown-minutos-expiracion");a.txtFechaExpiracion=$(".date-fecha-expiracion");a.ddlHoraExpiracion=$(".dropdown-hora-expiracion");a.btnAyudaEjecutarValidaciones=$(".btn-ayuda-ejecutar-validaciones");a.chkEjecutarValidaciones=$(".checkbox-ejecutar-validaciones");a.chkContinuarAutomaticamente=$(".checkbox-continuar-automaticamente");a.btnContinuar=$(".btn-continuar");a.ddlTipoOperacion.shieldDropDown({dataSource:{data:[{value:Core.Enums.eEspeciesTipoOperacion.Compra,text:"Compra"},{value:Core.Enums.eEspeciesTipoOperacion.Venta,text:"Venta"}]},textTemplate:"{text}",valueTemplate:"{value}",value:(a.ordenPrecargada?a.ordenPrecargada.idTipoOperacion.toString():a.defaultTipoOperacion.toString()),events:{select:function(e){a.clearControls(true);Core.Functions.Operar.setEspecieByTipoOperacion(e.item.value,a.ddlEspecie,Core.Enums.ePanel.Cedears,a.ddlPlazo.swidget().selectedItem().value,a.header.selectedIdAccount,a.loaded,function(){a.loadControlsByEspecie();a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem())});Core.Functions.Operar.setColorByTipoOperacion(e.item.value,a.divMain,a.divCuenta)}}});a.ddlEspecie.shieldComboBox({dataSource:{data:[]},valueTemplate:"{DisplayTicker}",value:(a.ordenPrecargada?a.ordenPrecargada.DisplayTicker:a.defaultEspecie),textTemplate:"{DisplayTicker} | {Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}},events:{select:function(f){if(f.index>=0){a.clearControls(false);a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem());Core.Functions.Operar.setLabelsByEspecie(a.ddlEspecie,a.ddlPlazo.swidget().selectedItem().value,a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(e){a.ultimaCotizacion=e;if(a.operarOptions.operarFIX){Core.Functions.Operar.setControlsOperarFix(a.ultimaCotizacion,a.ddlTipoOrden,a.ddlVencimientoOrden,a.divOperarFix,a.divReplacePreviousOrders,a.divCancelInDisconnection,false,function(){a.setControlsByVencimientoOrden();a.setControlsByTipoOrden()})}})}}}});a.ddlPlazo.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",value:(a.ordenPrecargada?a.ordenPrecargada.Plazo.toString():a.defaultPlazo.toString()),events:{select:function(e){Core.Functions.Operar.setEspecieByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlEspecie,Core.Enums.ePanel.Cedears,a.ddlPlazo.swidget().selectedItem().value,a.header.selectedIdAccount,a.loaded,function(){a.loadControlsByEspecie();a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem());Core.Functions.Operar.setLabelsByEspecie(a.ddlEspecie,a.ddlPlazo.swidget().selectedItem().value,a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(f){a.ultimaCotizacion=f;Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))})})}}});Core.Functions.Operar.setPlazos(a.ddlPlazo,a.pageOptions.plazosHabilitados);a.ddlTipoOrden.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{Valor}",value:(a.ordenPrecargada?a.ordenPrecargada.OrderType:""),events:{select:function(e){a.setControlsByTipoOrden()}}});a.ddlVencimientoOrden.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{Valor}",value:(a.ordenPrecargada?a.ordenPrecargada.TimeInForce:""),events:{select:function(e){a.setControlsByVencimientoOrden()}}});new Core.Controls.DecimalPicker(a.txtPrecioStop,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))},defaultValue:(a.ordenPrecargada?a.ordenPrecargada.PrecioDisparo:0)});a.txtFechaVencimiento.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.ordenPrecargada?Core.Functions.Date.getDateByStringWithoutSeparator(a.ordenPrecargada.FechaVencimiento):new Date())});new Core.Controls.DecimalPicker(a.txtValorCantidad,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))},defaultValue:(a.ordenPrecargada?a.ordenPrecargada.Cantidad:a.defaultValorCantidad)});new Core.Controls.DecimalPicker(a.txtValorPrecio,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))},defaultValue:(a.ordenPrecargada?a.ordenPrecargada.PrecioLimite:a.defaultValorLimite)});a.chkCantidadAMostrar.shieldCheckBox({label:"Difusión Parcial / Iceberg",checked:(a.ordenPrecargada&&a.ordenPrecargada.DisplayQty),events:{click:function(f){a.divCantidadAMostrar.hide();if(a.chkCantidadAMostrar.swidget().checked()){a.divCantidadAMostrar.show()}}}});new Core.Controls.DecimalPicker(a.txtCantidadAMostrar,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",defaultValue:(a.ordenPrecargada?a.ordenPrecargada.DisplayQty:0)});a.chkReplacePreviousOrders.shieldCheckBox({label:"Reemplazar órdenes previas",checked:(a.ordenPrecargada&&a.ordenPrecargada.ExecInst&&a.ordenPrecargada.ExecInst.indexOf("x")>=0)});a.chkCancelInDisconnection.shieldCheckBox({label:"Cancelar orden ante desconexión",checked:(a.ordenPrecargada&&a.ordenPrecargada.ExecInst&&a.ordenPrecargada.ExecInst.indexOf("o")>=0)});a.divOperarPrecarga.hide();a.btnNormal.on("click",function(){a.divOperarPrecarga.hide()});a.btnPrecarga.on("click",function(){a.divOperarPrecarga.show()});var b=[];for(var c=10;c<=18;c++){for(var d=0;d<=55;d=d+5){b.push({value:(c.padLeft(2,"0")+":"+d.padLeft(2,"0"))})}}a.ddlMinutosEjecucion.shieldDropDown({dataSource:{data:[{value:0,text:"Ahora"},{value:10,text:"En 10 minutos"},{value:30,text:"En 30 minutos"},{value:60,text:"En 1 hora"},{value:-1,text:"Otro"}]},textTemplate:"{text}",valueTemplate:"{value}",value:(a.ordenPrecargada&&a.ordenPrecargada.MinutosEjecucion?a.ordenPrecargada.MinutosEjecucion.toString():(a.ordenPrecargada&&a.ordenPrecargada.FechaEjecucion?"-1":"0")),events:{select:function(e){Core.Functions.Operar.setControlsByMinutosEjecucion(a.ddlMinutosEjecucion,a.divFechaEjecucion)}}});a.txtFechaEjecucion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.ordenPrecargada?Core.Functions.Date.getDateByStringDisplayDate(a.ordenPrecargada.FechaEjecucion):new Date())});a.ddlHoraEjecucion.shieldDropDown({dataSource:{data:b},textTemplate:"{value}",valueTemplate:"{value}",value:(a.ordenPrecargada&&a.ordenPrecargada.FechaEjecucion?a.ordenPrecargada.FechaEjecucion.substr(11,5):"")});a.ddlMinutosExpiracion.shieldDropDown({dataSource:{data:[{value:10,text:"En 10 minutos"},{value:30,text:"En 30 minutos"},{value:60,text:"En 1 hora"},{value:360,text:"En 6 horas"},{value:-1,text:"Otro"}]},textTemplate:"{text}",valueTemplate:"{value}",value:(a.ordenPrecargada&&a.ordenPrecargada.MinutosExpiracion?a.ordenPrecargada.MinutosExpiracion.toString():(a.ordenPrecargada&&a.ordenPrecargada.FechaExpiracion?"-1":"360")),events:{select:function(e){Core.Functions.Operar.setControlsByMinutosExpiracion(a.ddlMinutosExpiracion,a.divFechaExpiracion)}}});a.txtFechaExpiracion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.ordenPrecargada?Core.Functions.Date.getDateByStringDisplayDate(a.ordenPrecargada.FechaExpiracion):new Date())});a.ddlHoraExpiracion.shieldDropDown({dataSource:{data:b},textTemplate:"{value}",valueTemplate:"{value}",value:(a.ordenPrecargada&&a.ordenPrecargada.FechaExpiracion?a.ordenPrecargada.FechaExpiracion.substr(11,5):"")});a.btnAyudaEjecutarValidaciones.on("click",function(){Core.Functions.Operar.showAyudaEjecutarValidaciones()});a.chkEjecutarValidaciones.shieldCheckBox({label:"Excluir validaciones",checked:(a.ordenPrecargada&&a.ordenPrecargada.EjecutarValidaciones)});a.chkContinuarAutomaticamente.shieldCheckBox({label:"Permitir al cliente modificar esta precarga",checked:(a.ordenPrecargada&&a.ordenPrecargada.ContinuarAutomaticamente)});a.txtObservaciones.shieldTextBox({value:(a.ordenPrecargada?a.ordenPrecargada.Observaciones:"")});if(Core.Objects.Context.Configuration.idAplicacion==1){a.divObservaciones.hide()}a.btnContinuar.click(function(){a.btnContinuarClick()})};a.loadControlsByEspecie=function(){if(a.ddlEspecie.swidget().selectedItem()){Core.Functions.Operar.setLabelsByEspecie(a.ddlEspecie,a.ddlPlazo.swidget().selectedItem().value,a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(c){a.ultimaCotizacion=c;if(a.operarOptions.operarFIX){Core.Functions.Operar.setControlsOperarFix(a.ultimaCotizacion,a.ddlTipoOrden,a.ddlVencimientoOrden,a.divOperarFix,a.divReplacePreviousOrders,a.divCancelInDisconnection,true,function(){a.setControlsByVencimientoOrden();a.setControlsByTipoOrden()})}})}else{if(a.defaultEspecie!=""){var b=new Core.Controls.Dialog("Aviso","No posee la Especie "+a.defaultEspecie+".",{displayButtons:{close:true,accept:false}}).show();a.clearControls(true)}}};a.loadControls=function(){Core.Functions.Operar.setComitente(a.lblCuenta,a.header.selectedIdAccount,a.loaded);var b=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,requestUrl:"detalledisponible/"+encodeURIComponent(a.header.selectedIdAccount),requestType:"GET",requestData:{Fecha:Core.Functions.Date.getDateAsString(new Date())}});b.onSuccess=function(c){a.detalleDisponible=c;Core.Functions.Operar.setEspecieByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlEspecie,Core.Enums.ePanel.Cedears,a.ddlPlazo.swidget().selectedItem().value,a.header.selectedIdAccount,a.loaded,function(){a.loadControlsByEspecie();a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem());Core.Functions.Operar.setColorByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.divMain,a.divCuenta);if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra&&a.defaultValorCantidad!=""&&a.defaultValorLimite!=""){var d=$.grep(a.detalleDisponible.disponible,function(g,f){return g.idMoneda==Core.Enums.Currency.Pesos.idMoneda})[0];if(!d){d=0}else{d=d.DisponibleOperable72}var e=Math.floor((d/a.defaultValorLimite));if(e<a.defaultValorCantidad){if(e<0){a.txtValorCantidad.val("")}else{a.txtValorCantidad.val(e)}}}if(a.ddlEspecie.swidget().selectedItem()&&a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta&&a.defaultValorCantidad!=""){if(a.ddlEspecie.swidget().selectedItem().Cantidad<a.defaultValorCantidad){a.txtValorCantidad.val(a.ddlEspecie.swidget().selectedItem().Cantidad)}else{a.txtValorCantidad.val(a.defaultValorCantidad)}}Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null));Core.Functions.Operar.setControlsByMinutosEjecucion(a.ddlMinutosEjecucion,a.divFechaEjecucion);Core.Functions.Operar.setControlsByMinutosExpiracion(a.ddlMinutosExpiracion,a.divFechaExpiracion)})};b.request()};a.setDisponible=function(d,c,b){a.divDisponible.hide();if(d==Core.Enums.eEspeciesTipoOperacion.Compra&&c!=null&&b!=null){a.disponibleActual=Core.Functions.Operar.setDisponible(a.detalleDisponible.disponible,b.idMoneda,c,a.lblDisponible,a.divDisponible)}};a.btnContinuarClick=function(){var f={value:true};Core.Functions.Validations.getValidatedDropDownValue(a.ddlEspecie,f);var e={idCuenta:a.header.selectedIdAccount,FechaVencimiento:Core.Functions.Date.getDateAsString(new Date()),idTipoOperacion:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,f),ticker:(a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().Ticker:null,Plazo:Core.Functions.Validations.getValidatedDropDownValue(a.ddlPlazo,f),idMoneda:(a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().idMoneda:null,Cantidad:Core.Functions.Validations.getValidatedNumericInputValue(a.txtValorCantidad,f),Monto:null,PrecioDisparo:null,Observaciones:a.txtObservaciones.val()};if(a.ordenPrecargada){e.idOrdenPrecargada=a.ordenPrecargada.idOrdenPrecargada}if(a.operarOptions.operarFIX&&a.ddlTipoOrden.swidget().selectedItem()&&a.ddlVencimientoOrden.swidget().selectedItem()){e.OrderType=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOrden,f);e.TimeInForce=Core.Functions.Validations.getValidatedDropDownValue(a.ddlVencimientoOrden,f);if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){e.PrecioDisparo=Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecioStop,f)}if(a.ddlVencimientoOrden.swidget().value()==a.eVencimientoOrden.GoodTillDate){var b=new Date();b.setHours(0,0,0,0);var d=((a.txtFechaVencimiento.swidget().value())?a.txtFechaVencimiento.swidget().value():new Date());d.setHours(0,0,0,0);e.FechaVencimiento=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaVencimiento,f));if(b.getTime()>d.getTime()){f.value=false;Core.Functions.Validations.toggleValidation(a.txtFechaVencimiento,true)}}if(a.chkCantidadAMostrar.swidget().checked()){e.DisplayQty=Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidadAMostrar,f);if(f.value&&(parseFloat(e.DisplayQty)<0||parseFloat(e.DisplayQty)>=parseFloat(e.Cantidad))){f.value=false;var c=new Core.Controls.Dialog("Aviso","La cantidad a mostrar debe ser positiva y menor a los nominales ingresados ",{displayButtons:{close:true,accept:false}}).show()}}}if(a.divReplacePreviousOrders.is(":visible")&&a.chkReplacePreviousOrders.swidget().checked()){e.ExecInst="x"}if(a.divCancelInDisconnection.is(":visible")&&a.chkCancelInDisconnection.swidget().checked()){if(e.ExecInst){e.ExecInst+=" o"}else{e.ExecInst="o"}}if(!a.ddlTipoOrden.swidget().selectedItem()||(a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.Market&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.MarketWithLeftOverAsLimit&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.StopMerval&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.Stop&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.MarketIfTouched)){e.PrecioLimite=Core.Functions.Validations.getValidatedNumericInputValue(a.txtValorPrecio,f)}if(a.divOperarPrecarga.is(":visible")){e.EsPrecarga=1;if(a.divFechaEjecucion.is(":visible")){e.FechaEjecucion=(Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaEjecucion,f))+" "+Core.Functions.Validations.getValidatedDropDownValue(a.ddlHoraEjecucion,f)+":00")}else{e.MinutosEjecucion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMinutosEjecucion,f)}if(a.divFechaExpiracion.is(":visible")){e.FechaExpiracion=(Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaExpiracion,f))+" "+Core.Functions.Validations.getValidatedDropDownValue(a.ddlHoraExpiracion,f)+":00")}else{e.MinutosExpiracion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMinutosExpiracion,f)}e.EjecutarValidaciones=a.chkEjecutarValidaciones.swidget().checked()?1:0;e.ContinuarAutomaticamente=a.chkContinuarAutomaticamente.swidget().checked()?0:1}if(f.value){Core.Functions.Operar.srOperarEspeciesValidaciones(a.txtValorCantidad,f)}if(!f.value){return}Core.Functions.Operar.srOperarEspecies(e,function(){Core.Functions.Operar.refreshDisponible(a.detalleDisponible,function(){a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem())},a.header.selectedIdAccount,a.loaded)},a.header.selectedIdAccount,a.idDefaultProfile,a.loaded)};a.setControlsByVencimientoOrden=function(){if(a.ddlVencimientoOrden.swidget().value()==a.eVencimientoOrden.GoodTillDate){a.divFechaVencimiento.show()}else{a.txtFechaVencimiento.swidget().value(new Date());a.divFechaVencimiento.hide()}};a.setControlsByTipoOrden=function(){if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){a.divPrecioStop.show()}else{a.txtPrecioStop.val("");a.divPrecioStop.hide()}a.txtValorPrecio.removeAttr("disabled");if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Market||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketWithLeftOverAsLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){a.txtValorPrecio.val("");a.txtValorPrecio.attr("disabled","disabled");Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))}};a.getPrecio=function(){if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Market||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketWithLeftOverAsLimit){if(a.ultimaCotizacion){if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra){return a.ultimaCotizacion.Cotizacion.PrecioVenta}else{return a.ultimaCotizacion.Cotizacion.PrecioCompra}}else{return null}}else{if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){return a.txtPrecioStop.val()}else{return a.txtValorPrecio.val()}}};a.clearControls=function(b){if(b){a.ddlEspecie.swidget().refresh();a.lblUltimoPrecio.text("");a.lblVariacion.text("");a.lblMejorOfertaCompra.text("");a.lblMejorOfertaVenta.text("")}a.txtValorCantidad.val("");a.txtValorPrecio.val("");a.lblTotal.text("");a.txtObservaciones.val("");a.ddlTipoOrden.swidget().refresh();a.ddlVencimientoOrden.swidget().refresh();a.txtPrecioStop.val("");a.txtCantidadAMostrar.val("");a.txtFechaVencimiento.swidget().refresh();a.ultimaCotizacion=null}};Core.Business.Operar.DolarBolsa=new function(){var a=this;a.id="dolarBolsa";a.loaded=false;a.decimalCount=6;a.detalleDisponible=null;a.idDefaultAccount=null;a.idDefaultProfile=null;var b=10000;a.timerId=null;a.divMain=null;a.divCuenta=null;a.ddlTipoOperacion=null;a.txtCantidadNominales=null;a.lblPrecio=null;a.lblTotal=null;a.lblDisponible=null;a.divObservaciones=null;a.txtObservaciones=null;a.divInfoParking=null;a.btnContinuar=null;a.defaultTipoOperacion=null;a.defaultPrecioCompra=null;a.defaultPrecioVenta=null;a.defaultCantidadNominales=null;a.precioActual=null;a.init=function(d,e,f){a.idDefaultAccount=d;a.idDefaultProfile=e;a.defaultTipoOperacion=Core.Enums.eEspeciesTipoOperacion.CompraDolarBolsa;a.defaultCantidadNominales="";a.defaultPrecioCompra="";a.defaultPrecioVenta="";a.precioActual=null;$.extend(true,a,f);if(Core.Objects.Context.TieneC4D==1){Core.loadPage("operar-dolar-bolsa.html",function(){document.title="Operar Dólares MEP";a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,d,e,function(){a.loaded=false;a.loadControls();a.loaded=true},"Core.Business.Operar.DolarBolsa")})}else{var c=new Core.Controls.Dialog("Aviso","<p>Para poder Operar debe generar el código de operación de cuatro dígitos desde Configuración de Cuenta.<br/> <a onclick=\"$('.close-btn').click(); Core.Business.AccountSettings.init("+d+", "+e+');">Haga Click Aquí para ir a Configuración de Cuenta.</a></p>',{displayButtons:{close:true,accept:false}}).show()}};a.initControls=function(){a.divMain=$(".div-main");a.divCuenta=$(".div-cuenta");a.ddlTipoOperacion=$(".dropdown-tipo-operacion");a.lblCuenta=$(".label-cuenta");a.divDisponible=$(".div-disponible");a.lblDisponible=$(".label-disponible");a.txtCantidadNominales=$(".textbox-cantidad-nominales");a.btnContinuar=$(".btn-continuar");a.divObservaciones=$(".div-observaciones");a.lblPrecio=$(".label-precio");a.lblTotal=$(".label-total");a.txtObservaciones=$(".text-observaciones");a.divInfoParking=$(".div-info-parking");a.ddlTipoOperacion.shieldDropDown({dataSource:{data:[{value:Core.Enums.eEspeciesTipoOperacion.CompraDolarBolsa,text:"Compra Dólares Bolsa"},{value:Core.Enums.eEspeciesTipoOperacion.VentaDolarBolsa,text:"Venta Dólares Bolsa"}]},textTemplate:"{text}",valueTemplate:"{value}",value:a.defaultTipoOperacion.toString(),events:{select:function(c){Core.Functions.Operar.setDisponible(a.detalleDisponible.disponible,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.CompraDolarBolsa)?Core.Enums.Currency.Pesos.idMoneda:Core.Enums.Currency.Dolares.idMoneda),Core.Enums.ePlazo.CI,a.lblDisponible,a.divDisponible);Core.Functions.Operar.setColorByTipoOperacion(c.item.value,a.divMain,a.divCuenta);a.precioActual=null;a.setPrecio();a.showInfoParking()}}});new Core.Controls.DecimalPicker(a.txtCantidadNominales,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){a.setTotal()},defaultValue:a.defaultCantidadNominales});a.txtObservaciones.shieldTextBox({});if(Core.Objects.Context.Configuration.idAplicacion==1){a.divObservaciones.hide()}a.btnContinuar.click(function(){a.btnContinuarClick()})};a.loadControls=function(){Core.Functions.Operar.setComitente(a.lblCuenta,a.header.selectedIdAccount,a.loaded);var c=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,requestUrl:"detalledisponible/"+encodeURIComponent(a.header.selectedIdAccount),requestType:"GET",requestData:{Fecha:Core.Functions.Date.getDateAsString(new Date())}});c.onSuccess=function(d){a.detalleDisponible=d;Core.Functions.Operar.setDisponible(a.detalleDisponible.disponible,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.CompraDolarBolsa)?Core.Enums.Currency.Pesos.idMoneda:Core.Enums.Currency.Dolares.idMoneda),Core.Enums.ePlazo.CI,a.lblDisponible,a.divDisponible);Core.Functions.Operar.setColorByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.divMain,a.divCuenta);a.setPrecio();a.showInfoParking()};c.request()};a.btnContinuarClick=function(){var e={value:true};var c={idCuenta:a.header.selectedIdAccount,idTipoOperacion:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,e),Cantidad:Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidadNominales,e),Observaciones:a.txtObservaciones.val()};if(!e.value){return}var d=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"operar/dolarbolsa/solicitud",requestType:"POST",requestData:c});d.onSuccess=function(j){var g="Comitente N°"+j.NumComitente+" - "+j.DescripcionCuenta;var h="S.E:U.O. (Salvo error u omisión) <br>Los valores son estimados; los valores finales de la operación surgiran de la ejecución misma y reflejados en el boleto.";var i={data:j,idDefaultProfile:a.idDefaultProfile,idAccount:a.header.selectedIdAccount,generalTitle:"CONFIRMACION DE ORDEN",title:"Operación de Dólares",accountDescription:g,footerHtml:h,urlMethod:"operar/dolarbolsa/confirmar",codigo4DDescription:"Ingrese su código de operación de cuatro dígitos:",onConfirm:function(){Core.Functions.Operar.refreshDisponible(a.detalleDisponible,function(){Core.Functions.Operar.setDisponible(a.detalleDisponible.disponible,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.CompraDolarBolsa)?Core.Enums.Currency.Pesos.idMoneda:Core.Enums.Currency.Dolares.idMoneda),Core.Enums.ePlazo.CI,a.lblDisponible,a.divDisponible)},a.header.selectedIdAccount,a.loaded)}};var f=new Core.Controls.OperarConfirmation(i).show()};d.request()};a.setPrecio=function(){var c;if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.CompraDolarBolsa){c=(a.defaultPrecioVenta?a.defaultPrecioVenta:null)}else{c=(a.defaultPrecioCompra?a.defaultPrecioCompra:null)}if(c!=null){a.lblPrecio.text("$ "+c);a.btnContinuar.show()}else{a.lblPrecio.text("Cotización no disponible");a.btnContinuar.hide()}a.precioActual=c;a.setTotal()};a.setTotal=function(){if(a.precioActual!=null&&a.txtCantidadNominales.val()){var c=(a.precioActual.toFixed(2)*Core.Functions.Decimal.parseFloat(a.txtCantidadNominales.val()).toFixed(2)).toFixed(2);a.lblTotal.text("$ "+c)}else{a.lblTotal.text("")}};a.showInfoParking=function(){a.divInfoParking.hide();if(a.ddlTipoOperacion.swidget().value()==Core.Enums.eEspeciesTipoOperacion.CompraDolarBolsa){a.divInfoParking.show()}};a.clearControls=function(){a.ddlTipoOperacion.swidget().selected(0,true);a.txtCantidadNominales.swidget().value("");a.txtObservaciones.val("")}};Core.Business.Operar.FCI=new function(){var a=this;a.id="FCI";a.loaded=false;a.detalleDisponible=null;a.idDefaultAccount=null;a.idDefaultProfile=null;a.pageOptions=null;a.divMain=null;a.divCuenta=null;a.ddlTipoOperaciones=null;a.divFondoOrigen=null;a.ddlFondoOrigen=null;a.divCuentaOrigen=null;a.ddlCuentaOrigen=null;a.divFondoDestino=null;a.ddlFondoDestino=null;a.divCuentaDestino=null;a.ddlCuentaDestino=null;a.lblCuenta=null;a.divDisponible=null;a.lblDisponible=null;a.divFondoOrigenCotizacion=null;a.lblFondoOrigenUltimoPrecio=null;a.lblFondoOrigenVariacionDiaria=null;a.lblFondoOrigenVariacionMensual=null;a.lblFondoOrigenVariacionYTD=null;a.lblFondoDestinoUltimoPrecio=null;a.lblFondoDestinoVariacionDiaria=null;a.lblFondoDestinoVariacionMensual=null;a.lblFondoDestinoVariacionYTD=null;a.divChkRescateTotal=null;a.chkRescateTotal=null;a.divChkOrdenACDI=null;a.chkOrdenACDI=null;a.lblUnidadMedida=null;a.ddlUnidadMedida=null;a.divComprobante=null;a.txtNumeroComprobante=null;a.divUploadComprobante=null;a.idComprobanteAdjunto=null;a.lblCantidad=null;a.txtCantidad=null;a.divObservaciones=null;a.txtObservaciones=null;a.btnContinuar=null;a.defaultTipoOperacion=null;a.defaultFondoOrigen=null;a.defaultFondoDestino=null;a.defaultCantidad=null;a.defaultMoneda=null;a.init=function(d,e,f){if(Core.Objects.Accounts){var b=$.grep(Core.Objects.Accounts,function(h,g){return h.idCuenta==d})[0];if(b.NumCuotapartista==""){return}}a.defaultTipoOperacion=Core.Enums.eFondosTipoOperacion.Rescate;a.defaultFondoOrigen="";a.defaultFondoDestino="";a.defaultCantidad="";a.defaultMoneda="";a.idDefaultAccount=d;a.idDefaultProfile=e;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[e]);$.extend(true,a,f);if(Core.Objects.Context.TieneC4D==1){Core.loadPage("operar-fondos.html",function(){document.title="Operar Fondos";a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,d,e,function(){var g=$.grep(Core.Objects.Accounts,function(i,h){return i.idCuenta==a.header.selectedIdAccount})[0];if(g.NumCuotapartista==""){Core.Business.PosicionConsolidada.init(a.header.selectedIdAccount,a.idDefaultProfile);return}a.loaded=false;a.loadControls()},"Core.Business.Operar.FCI")})}else{var c=new Core.Controls.Dialog("Aviso","<p>Para poder Operar debe generar el código de operación de cuatro dígitos desde Configuración de Cuenta.<br/> <a onclick=\"$('.close-btn').click(); Core.Business.AccountSettings.init("+d+", "+e+');">Haga Click Aquí para ir a Configuración de Cuenta.</a></p>',{displayButtons:{close:true,accept:false}}).show()}};a.initControls=function(){a.divMain=$(".div-main");a.divCuenta=$(".div-cuenta");a.lblCuenta=$(".label-cuenta");a.ddlTipoOperaciones=$(".dropdown-tipo-operacion");a.divCuentaOrigen=$(".div-cuenta-origen");a.ddlCuentaOrigen=$(".dropdown-cuenta-origen");a.divFondoOrigen=$(".div-fondo-origen");a.ddlFondoOrigen=$(".dropdown-fondo-origen");a.divDisponible=$(".div-disponible");a.lblDisponible=$(".label-disponible");a.divFondoOrigenCotizacion=$(".div-fondo-origen-cotizacion");a.lblFondoOrigenUltimoPrecio=$(".label-fondo-origen-ultimo-precio");a.lblFondoOrigenVariacionDiaria=$(".label-fondo-origen-variacion-diaria");a.lblFondoOrigenVariacionMensual=$(".label-fondo-origen-variacion-mensual");a.lblFondoOrigenVariacionYTD=$(".label-fondo-origen-variacion-ytd");a.divChkRescateTotal=$(".div-checkbox-rescate-total");a.chkRescateTotal=$(".checkbox-rescate-total");a.divChkOrdenACDI=$(".div-orden-acdi");a.chkOrdenACDI=$(".checkbox-orden-acdi");a.lblUnidadMedida=$(".label-unidad-medida");a.ddlUnidadMedida=$(".dropdown-unidad-medida");a.lblCantidad=$(".label-cantidad");a.txtCantidad=$(".textbox-cantidad");a.divComprobante=$(".div-comprobante");a.txtNumeroComprobante=$(".textbox-numero-comprobante");a.divUploadComprobante=$(".div-upload-comprobante");a.btnContinuar=$(".btn-continuar");a.divFondoDestino=$(".div-fondo-destino");a.lblFondoDestinoUltimoPrecio=$(".label-fondo-destino-ultimo-precio");a.lblFondoDestinoVariacionDiaria=$(".label-fondo-destino-variacion-diaria");a.lblFondoDestinoVariacionMensual=$(".label-fondo-destino-variacion-mensual");a.lblFondoDestinoVariacionYTD=$(".label-fondo-destino-variacion-ytd");a.ddlFondoDestino=$(".dropdown-fondo-destino");a.divCuentaDestino=$(".div-cuenta-destino");a.ddlCuentaDestino=$(".dropdown-cuenta-destino");a.divObservaciones=$(".div-observaciones");a.txtObservaciones=$(".text-observaciones");a.ddlTipoOperaciones.shieldDropDown({dataSource:{data:[{value:Core.Enums.eFondosTipoOperacion.Suscripcion,text:"Suscripción"},{value:Core.Enums.eFondosTipoOperacion.Rescate,text:"Rescate"},{value:Core.Enums.eFondosTipoOperacion.CambioFondo,text:"Cambio de Fondo"}]},textTemplate:"{text}",valueTemplate:"{value}",value:a.defaultTipoOperacion.toString(),events:{select:function(b){a.setControlesByTipoOperacion(b.item.value,false);a.setDisponible(b.item.value,a.ddlCuentaOrigen.swidget().selectedItem());Core.Functions.Operar.setColorByTipoOperacion(b.item.value,a.divMain,a.divCuenta)}}});a.ddlFondoOrigen.shieldComboBox({dataSource:{data:[]},textTemplate:"{Ticker} ({Cantidad}) | {Descripcion}",valueTemplate:"{Ticker}",value:a.defaultFondoOrigen,autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"Ticker",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}},events:{select:function(b){if(b.index>=0){a.setCotizacionFondo(b.item.Ticker,a.lblFondoOrigenUltimoPrecio,a.lblFondoOrigenVariacionDiaria,a.lblFondoOrigenVariacionMensual,a.lblFondoOrigenVariacionYTD);a.setUnidadesMedidaByMoneda(a.ddlTipoOperaciones.swidget().value(),b.item.idMoneda);a.setDestinosByFondoOrigen(b.item,a.ddlTipoOperaciones.swidget().value())}}}});a.ddlFondoDestino.shieldComboBox({dataSource:{data:[]},textTemplate:"{Ticker} | {Descripcion}",valueTemplate:"{Ticker}",value:a.defaultFondoDestino,autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"Ticker",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}},events:{select:function(b){if(b.index>=0){a.setCotizacionFondo(b.item.Ticker,a.lblFondoDestinoUltimoPrecio,a.lblFondoDestinoVariacionDiaria,a.lblFondoDestinoVariacionMensual,a.lblFondoDestinoVariacionYTD)}}}});a.ddlCuentaOrigen.shieldComboBox({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{idCuentaBancaria}",value:"",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""}]}},events:{select:function(b){a.setUnidadesMedidaByMoneda(a.ddlTipoOperaciones.swidget().value(),b.item.idMoneda);a.setComprobante(a.ddlTipoOperaciones.swidget().value(),b.item);a.setDisponible(a.ddlTipoOperaciones.swidget().value(),a.ddlCuentaOrigen.swidget().selectedItem());a.setFondosDestino(b.item.idMoneda)}}});a.ddlCuentaDestino.shieldComboBox({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{idCuentaBancaria}",value:"",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""}]}}});a.ddlUnidadMedida.shieldDropDown({dataSource:{data:[{value:Core.Enums.eFondosUnidadMedida.Moneda,text:"Pesos"},{value:Core.Enums.eFondosUnidadMedida.Cuotapartes,text:"Cuotapartes"}]},textTemplate:"{text}",valueTemplate:"{value}",value:Core.Enums.eFondosUnidadMedida.Moneda.toString(),events:{select:function(b){a.setLabelsByOperacionUnidadMedida()}}});a.txtCantidad.shieldNumericTextBox({min:0,step:1e-06,max:999999999999,spinners:false,value:a.defaultCantidad.toString()});a.txtNumeroComprobante.shieldTextBox({});new Core.Controls.FileUpload(a.divUploadComprobante,{urlMethod:Core.PrefixUrl+"upload/comprobante",fileTypes:{"image/jpeg":"image/jpeg","image/png":"image/png","image/gif":"image/gif","application/pdf":"application/pdf"},maxSize:10485760,onLoad:function(b){a.idComprobanteAdjunto=b.idArchivo},onFileChange:function(){a.idComprobanteAdjunto=null},onError:function(){a.idComprobanteAdjunto=null;var b=new Core.Controls.Dialog("Error","No se ha podido adjuntar el comprobante",{displayButtons:{close:true,accept:false}});b.show();return}});a.txtObservaciones.shieldTextBox({});if(Core.Objects.Context.Configuration.idAplicacion==1){a.divObservaciones.hide()}a.btnContinuar.click(function(){a.btnContinuarClick()});a.chkRescateTotal.change(function(){a.ddlUnidadMedida.swidget().enabled(!a.chkRescateTotal.get(0).checked);a.txtCantidad.swidget().enabled(!a.chkRescateTotal.get(0).checked)})};a.loadControls=function(){Core.Functions.Operar.setCuotapartista(a.lblCuenta,a.header.selectedIdAccount,a.loaded);var b=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,requestUrl:"detalledisponible/"+encodeURIComponent(a.header.selectedIdAccount),requestType:"GET",requestData:{Fecha:Core.Functions.Date.getDateAsString(new Date())}});b.onSuccess=function(c){var d=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,requestUrl:"parametrogeneral/Ordenes_Comitentes_Para_ACDI",requestType:"GET"});d.onSuccess=function(e){a.detalleDisponible=c;a.permisoOrdenACDI=(e.parametro&&e.parametro[0])?e.parametro[0].Valor:0;a.setControlesByTipoOperacion(a.ddlTipoOperaciones.swidget().selectedItem().value,true);a.setDisponible(a.ddlTipoOperaciones.swidget().selectedItem().value,null);Core.Functions.Operar.setColorByTipoOperacion(a.ddlTipoOperaciones.swidget().selectedItem().value,a.divMain,a.divCuenta)};d.request()};b.request()};a.setControlesByTipoOperacion=function(f,b){a.divCuentaOrigen.hide();a.divFondoOrigen.hide();a.divFondoOrigenCotizacion.hide();a.divFondoDestino.hide();a.divCuentaDestino.hide();a.divChkRescateTotal.hide();a.divChkOrdenACDI.hide();if(f==Core.Enums.eFondosTipoOperacion.Suscripcion){a.lblUnidadMedida.text("Moneda:");a.lblCantidad.text("Monto:");a.divCuentaOrigen.show();a.divFondoDestino.show();if(a.pageOptions.permisoAlternativaOrdenesACDI&&a.permisoOrdenACDI=="1"){a.divChkOrdenACDI.show()}a.setCuentasVinculadas(a.ddlCuentaOrigen,function(g){return g.idCuentaBancaria<=0&&(!b||(a.defaultMoneda&&g.Moneda==a.defaultMoneda))},function(){if(b&&a.defaultMoneda){a.ddlCuentaOrigen.swidget().value("0");if(a.ddlCuentaOrigen.swidget().selectedItem()){a.setUnidadesMedidaByMoneda(a.ddlTipoOperaciones.swidget().value(),a.ddlCuentaOrigen.swidget().selectedItem().idMoneda);a.setComprobante(a.ddlTipoOperaciones.swidget().value(),a.ddlCuentaOrigen.swidget().selectedItem());a.setDisponible(a.ddlTipoOperaciones.swidget().value(),a.ddlCuentaOrigen.swidget().selectedItem());a.setFondosDestino(a.ddlCuentaOrigen.swidget().selectedItem().idMoneda)}}})}else{if(f==Core.Enums.eFondosTipoOperacion.Rescate){a.lblUnidadMedida.text("Unidad de Medida:");a.lblCantidad.text("Cantidad:");a.divFondoOrigen.show();a.divFondoOrigenCotizacion.show();a.divCuentaDestino.show();a.divChkRescateTotal.show();a.setFondosOrigen(f,b)}else{a.lblUnidadMedida.text("Unidad de Medida:");a.lblCantidad.text("Cantidad:");a.divFondoOrigen.show();a.divFondoOrigenCotizacion.show();a.divFondoDestino.show();a.divChkRescateTotal.show();a.setFondosOrigen(f,b)}}a.divComprobante.hide();var d=a.ddlFondoDestino.swidget().initialOptions;d.dataSource.data=[];a.ddlFondoDestino.swidget().refresh(d);var c=a.ddlCuentaDestino.swidget().initialOptions;c.dataSource.data=[];a.ddlCuentaDestino.swidget().refresh(c);var e=a.ddlUnidadMedida.swidget().initialOptions;e.dataSource.data=[];a.ddlUnidadMedida.swidget().refresh(e);a.ddlUnidadMedida.swidget().enabled(true);a.lblFondoOrigenUltimoPrecio.text("");a.lblFondoOrigenVariacionDiaria.text("");a.lblFondoOrigenVariacionMensual.text("");a.lblFondoOrigenVariacionYTD.text("");a.lblFondoDestinoUltimoPrecio.text("");a.lblFondoDestinoVariacionDiaria.text("");a.lblFondoDestinoVariacionMensual.text("");a.lblFondoDestinoVariacionYTD.text("");a.txtCantidad.swidget().value((b)?a.defaultCantidad:"");a.txtCantidad.swidget().enabled(true);a.chkRescateTotal.get(0).checked=false;a.chkOrdenACDI.get(0).checked=true};a.setUnidadesMedidaByMoneda=function(d,b){var c=a.ddlUnidadMedida.swidget().initialOptions;if(d==Core.Enums.eFondosTipoOperacion.Suscripcion){c.dataSource.data=[{value:Core.Enums.eFondosUnidadMedida.Moneda,text:(b==Core.Enums.Currency.Pesos.idMoneda)?Core.Enums.Currency.Pesos.Descripcion:Core.Enums.Currency.Dolares.Descripcion}]}else{c.dataSource.data=[{value:Core.Enums.eFondosUnidadMedida.Moneda,text:(b==Core.Enums.Currency.Pesos.idMoneda)?Core.Enums.Currency.Pesos.Descripcion:Core.Enums.Currency.Dolares.Descripcion},{value:Core.Enums.eFondosUnidadMedida.Cuotapartes,text:"Cuotapartes"}]}c.value=Core.Enums.eFondosUnidadMedida.Moneda.toString();a.ddlUnidadMedida.swidget().refresh(c);a.chkRescateTotal.change();a.setLabelsByOperacionUnidadMedida()};a.setLabelsByOperacionUnidadMedida=function(){if(a.ddlTipoOperaciones.swidget().selectedItem().value==Core.Enums.eFondosTipoOperacion.Suscripcion||((a.ddlTipoOperaciones.swidget().selectedItem().value==Core.Enums.eFondosTipoOperacion.Rescate||a.ddlTipoOperaciones.swidget().selectedItem().value==Core.Enums.eFondosTipoOperacion.CambioFondo)&&a.ddlUnidadMedida.swidget().selectedItem().value!=Core.Enums.eFondosUnidadMedida.Cuotapartes)){a.lblCantidad.text("Monto:")}else{a.lblCantidad.text("Cantidad:")}};a.setComprobante=function(c,b){a.divComprobante.hide();if(c==Core.Enums.eFondosTipoOperacion.Suscripcion){if(b.idCuentaBancaria!=0){a.divComprobante.show()}}};a.setDestinosByFondoOrigen=function(b,c){if(c==Core.Enums.eFondosTipoOperacion.CambioFondo){a.setFondosDestino(b.idMoneda,b.idFondo)}else{if(c==Core.Enums.eFondosTipoOperacion.Rescate){a.setCuentasVinculadas(a.ddlCuentaDestino,function(d){return d.idMoneda==b.idMoneda&&d.idCuentaBancaria>=0})}}};a.setFondosDestino=function(c,b){var d=new Core.Ajax.ServerRequest({allowCache:true,showOverlay:!a.loaded,secureRequest:true,requestUrl:"fondos",requestType:"GET",requestData:{idCuenta:a.header.selectedIdAccount}});d.onSuccess=function(g){var e=$.grep(g.fondos,function(i,h){return i.idMoneda==c});var f=a.ddlFondoDestino.swidget().initialOptions;if(b){e=$.grep(e,function(i,h){return i.idFondo!=b})}f.dataSource.data=e;a.ddlFondoDestino.swidget().refresh(f);if(!a.ddlFondoDestino.swidget().selectedItem()){a.lblFondoDestinoUltimoPrecio.text("");a.lblFondoDestinoVariacionDiaria.text("");a.lblFondoDestinoVariacionMensual.text("");a.lblFondoDestinoVariacionYTD.text("")}};d.request()};a.setFondosOrigen=function(e,b){var c={};c.idCuenta=a.header.selectedIdAccount;c.plazo=0;c.panel=Core.Enums.ePanel.Fondos;var d=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"especies",requestType:"GET",requestData:c});d.onSuccess=function(g){var f=a.ddlFondoOrigen.swidget().initialOptions;f.dataSource.data=g.especies;a.ddlFondoOrigen.swidget().refresh(f);if(a.ddlFondoOrigen.swidget().selectedItem()){a.setCotizacionFondo(a.ddlFondoOrigen.swidget().selectedItem().Ticker,a.lblFondoOrigenUltimoPrecio,a.lblFondoOrigenVariacionDiaria,a.lblFondoOrigenVariacionMensual,a.lblFondoOrigenVariacionYTD);a.setUnidadesMedidaByMoneda(a.ddlTipoOperaciones.swidget().value(),a.ddlFondoOrigen.swidget().selectedItem().idMoneda);a.setDestinosByFondoOrigen(a.ddlFondoOrigen.swidget().selectedItem(),a.ddlTipoOperaciones.swidget().value())}else{if(b&&a.defaultFondoOrigen&&e==Core.Enums.eFondosTipoOperacion.Rescate){new Core.Controls.Dialog("Aviso","No posee el fondo seleccionado para realizar el rescate.",{displayButtons:{close:true,accept:false}}).show()}else{if(b&&a.defaultFondoOrigen&&e==Core.Enums.eFondosTipoOperacion.CambioFondo){new Core.Controls.Dialog("Aviso","No posee el fondo seleccionado para realizar el cambio.",{displayButtons:{close:true,accept:false}}).show()}}}};d.request()};a.setCuentasVinculadas=function(b,c,d){var e=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"cuentasbancariasvinculadas/"+a.header.selectedIdAccount,requestType:"GET"});e.onSuccess=function(h){var g=b.swidget().initialOptions;var f=h.cuentasbancarias;if(c){f=$.grep(f,function(j,i){return c(j)})}g.dataSource.data=f;b.swidget().refresh(g);if(d){d()}};e.request()};a.setCotizacionFondo=function(i,b,c,d,e){var g=function(k,l){var j="field-var";if(l!=null){if(l>0){j="field-varpositiva"}if(l<0){j="field-varnegativa"}}k.removeClass("field-var field-varpositiva field-varnegativa").addClass(j)};var f={};f.ticker=i;var h=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"cotizacioncuotaparte",requestType:"GET",requestData:f});h.onSuccess=function(j){b.text(j.Cotizacion.Cotizacion!=null?j.Cotizacion.Cotizacion:"No disponible");c.text(j.Cotizacion.VarDiaria!=null?j.Cotizacion.VarDiaria:"No disponible");d.text(j.Cotizacion.VarMensual!=null?j.Cotizacion.VarMensual:"No disponible");e.text(j.Cotizacion.VarYTD!=null?j.Cotizacion.VarYTD:"No disponible");g(c,j.Cotizacion.VarDiaria);g(d,j.Cotizacion.VarMensual);g(e,j.Cotizacion.VarYTD)};h.request()};a.setDisponible=function(c,b){a.divDisponible.hide();if(c==Core.Enums.eFondosTipoOperacion.Suscripcion&&b&&b.idCuentaBancaria==0){Core.Functions.Operar.setDisponible(a.detalleDisponible.suscribible,b.idMoneda,Core.Enums.ePlazo.CI,a.lblDisponible,a.divDisponible)}};a.btnContinuarClick=function(){var g={value:true};var e=false;var b=$.grep(Core.Objects.Accounts,function(i,h){return i.idCuenta==a.header.selectedIdAccount})[0];var d={};d.idCuenta=a.header.selectedIdAccount;d.idOpcion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperaciones,g);d.Observaciones=a.txtObservaciones.val();if(a.ddlTipoOperaciones.swidget().selectedItem().value==Core.Enums.eFondosTipoOperacion.Suscripcion){d.Ticker=Core.Functions.Validations.getValidatedDropDownValue(a.ddlFondoDestino,g);d.Monto=Core.Functions.Validations.getValidatedNumericSwidgetValue(a.txtCantidad,g);d.idCuentaBancaria=Core.Functions.Validations.getValidatedDropDownValue(a.ddlCuentaOrigen,g);if(a.pageOptions.permisoAlternativaOrdenesACDI&&a.permisoOrdenACDI=="1"){d.permisoAlternativaOrdenesACDI=(a.chkOrdenACDI.get(0).checked?"1":"0")}e=(a.ddlCuentaOrigen.swidget().selectedItem())?(a.ddlCuentaOrigen.swidget().selectedItem().idMoneda!=Core.Enums.Currency.Pesos.idMoneda):false}else{if(a.ddlTipoOperaciones.swidget().selectedItem().value==Core.Enums.eFondosTipoOperacion.Rescate){d.total=(a.chkRescateTotal.get(0).checked?"1":"0");d.Ticker=Core.Functions.Validations.getValidatedDropDownValue(a.ddlFondoOrigen,g);e=(a.ddlFondoOrigen.swidget().selectedItem())?(a.ddlFondoOrigen.swidget().selectedItem().idMoneda!=Core.Enums.Currency.Pesos.idMoneda):false;d.idCuentaBancaria=Core.Functions.Validations.getValidatedDropDownValue(a.ddlCuentaDestino,g);if(a.chkRescateTotal.get(0).checked&&a.ddlFondoOrigen.swidget().selectedItem()){d.Cantidad=a.ddlFondoOrigen.swidget().selectedItem().Cantidad}else{d.Cantidad=(a.ddlUnidadMedida.swidget().value()==Core.Enums.eFondosUnidadMedida.Cuotapartes)?Core.Functions.Validations.getValidatedNumericSwidgetValue(a.txtCantidad,g):null;d.Monto=(a.ddlUnidadMedida.swidget().value()==Core.Enums.eFondosUnidadMedida.Moneda)?Core.Functions.Validations.getValidatedNumericSwidgetValue(a.txtCantidad,g):null}}else{d.total=(a.chkRescateTotal.get(0).checked?"1":"0");d.Ticker=Core.Functions.Validations.getValidatedDropDownValue(a.ddlFondoOrigen,g);e=(a.ddlFondoOrigen.swidget().selectedItem())?(a.ddlFondoOrigen.swidget().selectedItem().idMoneda!=Core.Enums.Currency.Pesos.idMoneda):false;d.TickerDestino=Core.Functions.Validations.getValidatedDropDownValue(a.ddlFondoDestino,g);if(a.chkRescateTotal.get(0).checked&&a.ddlFondoOrigen.swidget().selectedItem()){d.Cantidad=a.ddlFondoOrigen.swidget().selectedItem().Cantidad}else{d.Cantidad=(a.ddlUnidadMedida.swidget().value()==Core.Enums.eFondosUnidadMedida.Cuotapartes)?Core.Functions.Validations.getValidatedNumericSwidgetValue(a.txtCantidad,g):null;d.Monto=(a.ddlUnidadMedida.swidget().value()==Core.Enums.eFondosUnidadMedida.Moneda)?Core.Functions.Validations.getValidatedNumericSwidgetValue(a.txtCantidad,g):null}}}if(d.idOpcion==Core.Enums.eFondosTipoOperacion.Suscripcion&&d.idCuentaBancaria&&d.idCuentaBancaria!=0){Core.Functions.Validations.toggleValidation(a.txtNumeroComprobante,false);if(a.idComprobanteAdjunto||a.txtNumeroComprobante.swidget().value()||a.permisoOrdenACDI=="1"){if(a.idComprobanteAdjunto){d.idArchivo=a.idComprobanteAdjunto}if(a.txtNumeroComprobante.swidget().value()){d.NroReferencia=a.txtNumeroComprobante.swidget().value()}}else{g.value=false;Core.Functions.Validations.toggleValidation(a.txtNumeroComprobante,true);var c=new Core.Controls.Dialog("Aviso","Es necesario que se ingrese un número de comprobante o se adjunte el mismo.",{displayButtons:{close:true,accept:false}});c.show()}}if(!g.value){return}var f=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"operar/fondos/solicitud",requestType:"POST",requestData:d});f.onSuccess=function(l){var m="";if(a.ddlTipoOperaciones.swidget().value()==Core.Enums.eFondosTipoOperacion.Suscripcion){m="Suscripción Fondos Comunes de Inversión"}else{if(a.ddlTipoOperaciones.swidget().value()==Core.Enums.eFondosTipoOperacion.Rescate){m="Rescate Fondos Comunes de Inversión"}else{m="Cambio Fondos Comunes de Inversión"}}var i="Cuotapartista N°"+l.NumCuotapartista+" - "+l.DescripcionCuenta;var j="S.E:U.O. (Salvo error u omisión)";j+=(a.ddlTipoOperaciones.swidget().value()==Core.Enums.eFondosTipoOperacion.Suscripcion)?"<br />La cantidad cuotapartes definitivas surgiran del valor de la cuotaparte al cierre, momento en que se hace efectiva la suscripción.":"<br />El monto final surgira del valor de la cuotaparte al cierre, momento en que se hace efectivo el rescate.";j+=(e)?"<br />NOTA: En el caso de necesitar conversión de divisas, la operación puede demorar hasta 48hs hábiles.":"";var k={data:l,idDefaultProfile:a.idDefaultProfile,terminosYCondiciones:l.Terminos,terminosYCondicionesDescripcion:"Declaro que he leído el Reglamento de Gestión del Fondo",idAccount:a.header.selectedIdAccount,generalTitle:"CONFIRMACION DE ORDEN",title:m,accountDescription:i,footerHtml:j,urlMethod:"operar/fondos/confirmar",codigo4DDescription:(a.ddlTipoOperaciones.swidget().value()==Core.Enums.eFondosTipoOperacion.RescateBalanz||a.ddlTipoOperaciones.swidget().value()==Core.Enums.eFondosTipoOperacion.RescateBanco)?"Ingrese la clave de transacción de cuatro digitos:":"Ingrese su código de operación de cuatro dígitos:",onConfirm:function(){Core.Functions.Operar.refreshDisponible(a.detalleDisponible,function(){a.setDisponible(a.ddlTipoOperaciones.swidget().value(),a.ddlCuentaOrigen.swidget().selectedItem())},a.header.selectedIdAccount,a.loaded)}};var h=new Core.Controls.OperarConfirmation(k).show()};f.request()};a.clearControls=function(){a.ddlTipoOperaciones.swidget().selected(0,true);a.ddlFondosFondo.swidget().selected(0,true);a.ddlFondosCuentaVinculada.swidget().selected(0,true);a.lblFondosUltimoPrecio.text("");a.lblFondosVariacionDiaria.text("");a.lblFondosVariacionMensual.text("");a.lblFondosVariacionYTD.text("");a.ddlUnidadMedida.swidget().selected(0,true);a.txtCantidad.swidget().value("");a.txtNumeroComprobante.swidget().value("");a.txtObservaciones.val("")}};Core.Business.Operar.Futuros=new function(){var a=this;a.id="futuros";a.loaded=false;a.detalleDisponible=null;a.idDefaultAccount=null;a.idDefaultProfile=null;a.decimalCount=6;a.eVencimientoOrden={GoodTillDate:6};a.eTipoOrden={Market:1,Limit:2,StopMerval:3,StopLimit:4,Stop:"z",MarketWithLeftOverAsLimit:"K",MarketIfTouched:"J"};a.divMain=null;a.divCuenta=null;a.ddlTipoOperacion=null;a.ddlEspecie=null;a.lblCuenta=null;a.ddlPlazo=null;a.divDisponible=null;a.lblDisponible=null;a.disponibleActual=null;a.lblUltimoPrecio=null;a.lblVariacion=null;a.lblMejorOfertaCompra=null;a.lblMejorOfertaVenta=null;a.divOperarFix=null;a.divReplacePreviousOrders=null;a.chkReplacePreviousOrders=null;a.divCancelInDisconnection=null;a.chkCancelInDisconnection=null;a.divTipoOrden=null;a.ddlTipoOrden=null;a.divVencimientoOrden=null;a.ddlVencimientoOrden=null;a.divPrecioStop=null;a.txtPrecioStop=null;a.divFechaVencimiento=null;a.txtFechaVencimiento=null;a.txtValorCantidad=null;a.txtValorPrecio=null;a.lblTotal=null;a.lblMargenRequerido=null;a.chkCantidadAMostrar=null;a.txtCantidadAMostrar=null;a.divCantidadAMostrar=null;a.divObservaciones=null;a.txtObservaciones=null;a.btnContinuar=null;a.defaultPlazo=null;a.defaultTipoOperacion=null;a.defaultEspecie=null;a.defaultValorCantidad=null;a.defaultValorLimite=null;a.pageOptions=null;a.operarOptions=null;a.ultimaCotizacion=null;a.init=function(d,e,f){if(Core.Objects.Accounts){var b=$.grep(Core.Objects.Accounts,function(h,g){return h.idCuenta==d})[0];if(b.NumComitente==""){return}}a.idDefaultAccount=d;a.idDefaultProfile=e;a.defaultTipoOperacion=Core.Enums.eEspeciesTipoOperacion.Venta;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[e]);a.operarOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu("operar",Core.Objects.Context.Profiles[e]);a.defaultEspecie="";a.defaultValorCantidad="";a.defaultValorLimite="";a.defaultPlazo=a.pageOptions.plazoDefault;$.extend(true,a,f);if(Core.Objects.Context.TieneC4D==1){Core.loadPage("operar-futuros.html",function(){document.title="Operar Futuros";a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,d,e,function(){var g=$.grep(Core.Objects.Accounts,function(i,h){return i.idCuenta==a.header.selectedIdAccount})[0];if(g.NumComitente==""){Core.Business.PosicionConsolidada.init(a.header.selectedIdAccount,a.idDefaultProfile);return}a.loaded=false;a.loadControls()},"Core.Business.Operar.Futuros")})}else{var c=new Core.Controls.Dialog("Aviso","<p>Para poder Operar debe generar el código de operación de cuatro dígitos desde Configuración de Cuenta.<br/> <a onclick=\"$('.close-btn').click(); Core.Business.AccountSettings.init("+d+", "+e+');">Haga Click Aquí para ir a Configuración de Cuenta.</a></p>',{displayButtons:{close:true,accept:false}}).show()}};a.initControls=function(){a.divMain=$(".div-main");a.divCuenta=$(".div-cuenta");a.ddlTipoOperacion=$(".dropdown-tipo-operacion");a.ddlEspecie=$(".dropdown-especie");a.lblCuenta=$(".label-cuenta");a.divDisponible=$(".div-disponible");a.lblDisponible=$(".label-disponible");a.ddlPlazo=$(".dropdown-plazo");a.lblUltimoPrecio=$(".label-ultimo-precio");a.lblVariacion=$(".label-variacion");a.lblMejorOfertaCompra=$(".label-mejor-oferta-compra");a.lblMejorOfertaVenta=$(".label-mejor-oferta-venta");a.divOperarFix=$(".div-operar-fix");a.divOperarFix.hide();a.divTipoOrden=$(".div-tipo-orden");a.ddlTipoOrden=$(".dropdown-tipo-orden");a.divVencimientoOrden=$(".div-vencimiento-orden");a.ddlVencimientoOrden=$(".dropdown-vencimiento-orden");a.divPrecioStop=$(".div-precio-stop");a.txtPrecioStop=$(".textbox-precio-stop");a.divFechaVencimiento=$(".div-fecha-vencimiento");a.txtFechaVencimiento=$(".date-fecha-vencimiento");a.txtValorCantidad=$(".textbox-cantidad");a.txtValorPrecio=$(".textbox-precio");a.lblTotal=$(".label-precio-total");a.lblMargenRequerido=$(".label-margen-requerido");a.divObservaciones=$(".div-observaciones");a.txtObservaciones=$(".text-observaciones");a.txtCantidadAMostrar=$(".textbox-cantidad-a-mostrar");a.chkCantidadAMostrar=$(".checkbox-cantidad-a-mostrar");a.divCantidadAMostrar=$(".div-cantidad-a-mostrar");a.divCantidadAMostrar.hide();a.divReplacePreviousOrders=$(".div-replace-previous-orders");a.chkReplacePreviousOrders=$(".checkbox-replace-previous-orders");a.divCancelInDisconnection=$(".div-cancel-in-disconnection");a.chkCancelInDisconnection=$(".checkbox-cancel-in-disconnection");a.btnContinuar=$(".btn-continuar");a.ddlTipoOperacion.shieldDropDown({dataSource:{data:[{value:Core.Enums.eEspeciesTipoOperacion.Compra,text:"Compra"},{value:Core.Enums.eEspeciesTipoOperacion.Venta,text:"Venta"}]},textTemplate:"{text}",valueTemplate:"{value}",value:a.defaultTipoOperacion.toString(),events:{select:function(b){a.clearControls(true);Core.Functions.Operar.setColorByTipoOperacion(b.item.value,a.divMain,a.divCuenta);Core.Functions.Operar.setEspecieByTipoOperacion(b.item.value,a.ddlEspecie,Core.Enums.ePanel.Futuros,a.ddlPlazo.swidget().selectedItem().value,a.header.selectedIdAccount,a.loaded,function(){a.loadControlsByEspecie()})}}});a.ddlEspecie.shieldComboBox({dataSource:{data:[]},valueTemplate:"{Ticker}",value:a.defaultEspecie,textTemplate:"{DisplayTicker} | {Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}},events:{select:function(b){if(b.index>=0){a.clearControls(false);Core.Functions.Operar.setLabelsByEspecie(a.ddlEspecie,a.ddlPlazo.swidget().selectedItem().value,a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(c){a.ultimaCotizacion=c;if(a.operarOptions.operarFIX){Core.Functions.Operar.setControlsOperarFix(a.ultimaCotizacion,a.ddlTipoOrden,a.ddlVencimientoOrden,a.divOperarFix,a.divReplacePreviousOrders,a.divCancelInDisconnection,a.loaded,function(d){a.setControlsByVencimientoOrden();a.marketID=d;a.setDisponible(d);a.setControlsByTipoOrden()})}})}}}});a.ddlPlazo.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",value:a.defaultPlazo.toString(),events:{select:function(b){Core.Functions.Operar.setEspecieByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlEspecie,Core.Enums.ePanel.Futuros,a.ddlPlazo.swidget().selectedItem().value,a.header.selectedIdAccount,a.loaded,function(){a.loadControlsByEspecie(function(){a.setMargenRequerido()})});Core.Functions.Operar.setLabelsByEspecie(a.ddlEspecie,a.ddlPlazo.swidget().selectedItem().value,a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(c){a.ultimaCotizacion=c;a.setTotalEstimado()})}}});a.ddlTipoOrden.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{Valor}",events:{select:function(b){a.setControlsByTipoOrden()}}});a.ddlVencimientoOrden.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{Valor}",events:{select:function(b){a.setControlsByVencimientoOrden()}}});new Core.Controls.DecimalPicker(a.txtPrecioStop,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){a.setTotalEstimado();a.setMargenRequerido()}});a.txtFechaVencimiento.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date()});Core.Functions.Operar.setPlazos(a.ddlPlazo,a.pageOptions.plazosHabilitados);new Core.Controls.DecimalPicker(a.txtValorCantidad,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){a.setTotalEstimado();a.setMargenRequerido()},defaultValue:a.defaultValorCantidad});new Core.Controls.DecimalPicker(a.txtValorPrecio,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){a.setTotalEstimado();a.setMargenRequerido()},defaultValue:a.defaultValorLimite});a.chkCantidadAMostrar.shieldCheckBox({label:"Difusión Parcial / Iceberg",events:{click:function(b){a.divCantidadAMostrar.hide();if(a.chkCantidadAMostrar.swidget().checked()){a.divCantidadAMostrar.show()}}}});new Core.Controls.DecimalPicker(a.txtCantidadAMostrar,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:""});a.chkReplacePreviousOrders.shieldCheckBox({label:"Reemplazar órdenes previas"});a.chkCancelInDisconnection.shieldCheckBox({label:"Cancelar orden ante desconexión"});a.txtObservaciones.shieldTextBox({});if(Core.Objects.Context.Configuration.idAplicacion==1){a.divObservaciones.hide()}a.btnContinuar.click(function(){a.btnContinuarClick()})};a.loadControlsByEspecie=function(c){if(a.ddlEspecie.swidget().selectedItem()){Core.Functions.Operar.setLabelsByEspecie(a.ddlEspecie,a.ddlPlazo.swidget().selectedItem().value,a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(d){a.ultimaCotizacion=d;if(a.operarOptions.operarFIX){Core.Functions.Operar.setControlsOperarFix(a.ultimaCotizacion,a.ddlTipoOrden,a.ddlVencimientoOrden,a.divOperarFix,a.divReplacePreviousOrders,a.divCancelInDisconnection,a.loaded,function(e){a.setControlsByVencimientoOrden();a.marketID=e;a.setDisponible(e);a.setControlsByTipoOrden();if(c){c()}})}})}else{if(a.defaultEspecie!=""){var b=new Core.Controls.Dialog("Aviso","No posee la Especie "+a.defaultEspecie+".",{displayButtons:{close:true,accept:false}}).show();a.clearControls(true)}}};a.loadControls=function(){Core.Functions.Operar.setComitente(a.lblCuenta,a.header.selectedIdAccount,a.loaded);var b=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,requestUrl:"detalledisponible/"+encodeURIComponent(a.header.selectedIdAccount),requestType:"GET",requestData:{Fecha:Core.Functions.Date.getDateAsString(new Date())}});b.onSuccess=function(c){a.detalleDisponible=c;Core.Functions.Operar.setEspecieByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlEspecie,Core.Enums.ePanel.Futuros,a.ddlPlazo.swidget().selectedItem().value,a.header.selectedIdAccount,a.loaded,function(){a.loadControlsByEspecie(function(){var e=a.ddlEspecie.swidget().selectedItem();if(e){var d=0;if(e.Cantidad==0||(e.Cantidad>0&&a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)||(e.Cantidad<0&&a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta)){d=((e.Contratos!=0&&e.MargenRequerido!=0)?(a.disponibleActual/(e.Contratos*e.MargenRequerido)):0)}else{d=((e.Contratos!=0&&e.MargenRequerido!=0)?((a.disponibleActual/(e.Contratos*e.MargenRequerido))+(2*Math.abs(e.Cantidad))):0)}if(d<a.defaultValorCantidad){if(d<=0){a.txtValorCantidad.val("")}else{a.txtValorCantidad.val(d.toFixed(2))}}}a.setTotalEstimado();a.setMargenRequerido()});Core.Functions.Operar.setColorByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.divMain,a.divCuenta)})};b.request()};a.setDisponible=function(c){var b=$.grep(a.detalleDisponible.margenesgarantia,function(e,d){return e.Tipo==c})[0];if(b){a.lblDisponible.text("Disponible: "+Core.Functions.grid.formatNumber(b.Disponible)+" Pesos");a.disponibleActual=b.Disponible}else{a.lblDisponible.text("Disponible: "+Core.Functions.grid.formatNumber(0)+" Pesos");a.disponibleActual=0}};a.btnContinuarClick=function(){var f={value:true};var e={idCuenta:a.header.selectedIdAccount,FechaVencimiento:Core.Functions.Date.getDateAsString(new Date()),idTipoOperacion:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,f),ticker:Core.Functions.Validations.getValidatedDropDownValue(a.ddlEspecie,f),Plazo:Core.Functions.Validations.getValidatedDropDownValue(a.ddlPlazo,f),idMoneda:(a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().idMoneda:null,Cantidad:Core.Functions.Validations.getValidatedNumericInputValue(a.txtValorCantidad,f),Monto:null,PrecioDisparo:null,Observaciones:a.txtObservaciones.val()};if(a.operarOptions.operarFIX&&a.ddlTipoOrden.swidget().selectedItem()&&a.ddlVencimientoOrden.swidget().selectedItem()){e.OrderType=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOrden,f);e.TimeInForce=Core.Functions.Validations.getValidatedDropDownValue(a.ddlVencimientoOrden,f);if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){e.PrecioDisparo=Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecioStop,f)}if(a.ddlVencimientoOrden.swidget().value()==a.eVencimientoOrden.GoodTillDate){var b=new Date();b.setHours(0,0,0,0);var d=((a.txtFechaVencimiento.swidget().value())?a.txtFechaVencimiento.swidget().value():new Date());d.setHours(0,0,0,0);e.FechaVencimiento=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaVencimiento,f));if(b.getTime()>d.getTime()){f.value=false;Core.Functions.Validations.toggleValidation(a.txtFechaVencimiento,true)}}if(a.chkCantidadAMostrar.swidget().checked()){e.DisplayQty=Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidadAMostrar,f);if(f.value&&(parseFloat(e.DisplayQty)<0||parseFloat(e.DisplayQty)>=parseFloat(e.Cantidad))){f.value=false;var c=new Core.Controls.Dialog("Aviso","La cantidad a mostrar debe ser positiva y menor a los nominales ingresados ",{displayButtons:{close:true,accept:false}}).show()}}}if(a.divReplacePreviousOrders.is(":visible")&&a.chkReplacePreviousOrders.swidget().checked()){e.ExecInst="x"}if(a.divCancelInDisconnection.is(":visible")&&a.chkCancelInDisconnection.swidget().checked()){if(e.ExecInst){e.ExecInst+=" o"}else{e.ExecInst="o"}}if(!a.ddlTipoOrden.swidget().selectedItem()||(a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.Market&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.MarketWithLeftOverAsLimit&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.StopMerval&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.Stop&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.MarketIfTouched)){e.PrecioLimite=Core.Functions.Validations.getValidatedNumericInputValue(a.txtValorPrecio,f)}if(f.value){Core.Functions.Operar.srOperarEspeciesValidaciones(a.txtValorCantidad,f)}if(!f.value){return}Core.Functions.Operar.srOperarEspecies(e,function(){Core.Functions.Operar.refreshDisponible(a.detalleDisponible,function(){a.setDisponible(a.marketID)},a.header.selectedIdAccount,a.loaded)},a.header.selectedIdAccount,a.idDefaultProfile,a.loaded)};a.setControlsByVencimientoOrden=function(){if(a.ddlVencimientoOrden.swidget().value()==a.eVencimientoOrden.GoodTillDate){a.divFechaVencimiento.show()}else{a.txtFechaVencimiento.swidget().value(new Date());a.divFechaVencimiento.hide()}};a.setControlsByTipoOrden=function(){if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){a.divPrecioStop.show()}else{a.txtPrecioStop.val("");a.divPrecioStop.hide()}a.txtValorPrecio.removeAttr("disabled");if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Market||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketWithLeftOverAsLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){a.txtValorPrecio.val("");a.txtValorPrecio.attr("disabled","disabled");a.setTotalEstimado();a.setMargenRequerido()}};a.getPrecio=function(){if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Market||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketWithLeftOverAsLimit){if(a.ultimaCotizacion){if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra){return a.ultimaCotizacion.Cotizacion.PrecioVenta}else{return a.ultimaCotizacion.Cotizacion.PrecioCompra}}else{return null}}else{if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){return a.txtPrecioStop.val()}else{return a.txtValorPrecio.val()}}};a.setTotalEstimado=function(){var b=a.txtValorCantidad.val();var c=a.getPrecio();if((!b||b==0)||(!c||c==0)||(!a.ddlEspecie.swidget().selectedItem()||a.ddlEspecie.swidget().selectedItem().Contratos==0)){a.lblTotal.text("")}else{var d=b*c*a.ddlEspecie.swidget().selectedItem().Contratos;a.lblTotal.text(d.toFixed(2))}};a.setMargenRequerido=function(){a.lblMargenRequerido.removeClass("field-varnegativa");var b=a.txtValorCantidad.val();var d=a.ddlEspecie.swidget().selectedItem();if(d){if(d.Cantidad==0||(d.Cantidad>0&&a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)||(d.Cantidad<0&&a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta)){if((!b||b==0)||(d.MargenRequerido==0)||(d.Contratos==0)){a.lblMargenRequerido.text("")}else{var c=b*d.MargenRequerido*d.Contratos;a.lblMargenRequerido.text(c.toFixed(2));if(c&&a.disponibleActual&&c>a.disponibleActual){a.lblMargenRequerido.addClass("field-varnegativa")}}}else{if((!b||b==0)||(d.MargenRequerido==0)||(d.Contratos==0)){a.lblMargenRequerido.text("")}else{var c=(b-(2*Math.abs(d.Cantidad)))*d.MargenRequerido*d.Contratos;c=(c<0)?0:c;a.lblMargenRequerido.text(c.toFixed(2));if(c&&a.disponibleActual&&c>a.disponibleActual){a.lblMargenRequerido.addClass("field-varnegativa")}}}}else{a.lblMargenRequerido.text("")}};a.clearControls=function(b){if(b){a.ddlEspecie.swidget().refresh();a.lblUltimoPrecio.text("");a.lblVariacion.text("");a.lblMejorOfertaCompra.text("");a.lblMejorOfertaVenta.text("")}a.txtValorCantidad.val("");a.txtValorPrecio.val("");a.lblTotal.text("");a.lblMargenRequerido.text("");a.lblMargenRequerido.removeClass("field-varnegativa");a.txtObservaciones.val("");a.ddlTipoOrden.swidget().refresh();a.ddlVencimientoOrden.swidget().refresh();a.txtPrecioStop.val("");a.txtCantidadAMostrar.val("");a.txtFechaVencimiento.swidget().refresh();a.ultimaCotizacion=null}};Core.Business.Operar.Internacional=new function(){var a=this;a.id="internacional";a.loaded=false;a.detalleDisponible=null;a.idDefaultAccount=null;a.idDefaultProfile=null;a.decimalCount=6;a.eVencimientoOrden={GoodTillDate:6};a.eTipoOrden={Market:1,Limit:2,StopMerval:3,StopLimit:4,Stop:"z",MarketWithLeftOverAsLimit:"K",MarketIfTouched:"J"};a.divMain=null;a.divCuenta=null;a.divAlertaTipoPrecio=null;a.ddlTipoOperacion=null;a.ddlEspecie=null;a.lblCuenta=null;a.ddlPlazo=null;a.divDisponible=null;a.lblDisponible=null;a.lblUltimoPrecio=null;a.lblVariacion=null;a.lblMejorOfertaCompra=null;a.lblMejorOfertaVenta=null;a.divOperarFix=null;a.divReplacePreviousOrders=null;a.chkReplacePreviousOrders=null;a.divCancelInDisconnection=null;a.chkCancelInDisconnection=null;a.divTipoOrden=null;a.ddlTipoOrden=null;a.divVencimientoOrden=null;a.ddlVencimientoOrden=null;a.divPrecioStop=null;a.txtPrecioStop=null;a.divFechaVencimiento=null;a.txtFechaVencimiento=null;a.txtValorCantidad=null;a.txtValorPrecio=null;a.lblTotal=null;a.chkCantidadAMostrar=null;a.txtCantidadAMostrar=null;a.divCantidadAMostrar=null;a.divObservaciones=null;a.txtObservaciones=null;a.btnContinuar=null;a.defaultPlazo=null;a.defaultTipoOperacion=null;a.defaultEspecie=null;a.defaultValorCantidad=null;a.defaultValorLimite=null;a.disponibleActual=null;a.pageOptions=null;a.operarOptions=null;a.ultimaCotizacion=null;a.ordenPrecargada=null;a.init=function(d,e,f){if(Core.Objects.Accounts){var b=$.grep(Core.Objects.Accounts,function(h,g){return h.idCuenta==d})[0];if(b&&b.NumComitente==""){return}}a.idDefaultAccount=d;a.idDefaultProfile=e;a.defaultTipoOperacion=Core.Enums.eEspeciesTipoOperacion.Venta;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[e]);a.operarOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu("operar",Core.Objects.Context.Profiles[e]);a.defaultEspecie="";a.defaultValorCantidad="";a.defaultValorLimite="";a.defaultPlazo=a.pageOptions.plazoDefault;a.ordenPrecargada=null;$.extend(true,a,f);if(Core.Objects.Context.TieneC4D==1){Core.loadPage("operar-internacional.html",function(){document.title="Operar Internacional";a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,d,e,function(){var g=$.grep(Core.Objects.Accounts,function(i,h){return i.idCuenta==a.header.selectedIdAccount})[0];if(g.NumComitente==""){Core.Business.PosicionConsolidada.init(a.header.selectedIdAccount,a.idDefaultProfile);return}a.loaded=false;a.loadControls()},"Core.Business.Operar.Internacional")})}else{var c=new Core.Controls.Dialog("Aviso","<p>Para poder Operar debe generar el código de operación de cuatro dígitos desde Configuración de Cuenta.<br/> <a onclick=\"$('.close-btn').click(); Core.Business.AccountSettings.init("+d+", "+e+');">Haga Click Aquí para ir a Configuración de Cuenta.</a></p>',{displayButtons:{close:true,accept:false}}).show()}};a.initControls=function(){a.divMain=$(".div-main");a.divCuenta=$(".div-cuenta");a.divAlertaTipoPrecio=$(".div-alert-price-type");a.divAlertaTipoPrecio.hide();a.ddlTipoOperacion=$(".dropdown-tipo-operacion");a.ddlEspecie=$(".dropdown-especie");a.lblCuenta=$(".label-cuenta");a.divDisponible=$(".div-disponible");a.lblDisponible=$(".label-disponible");a.ddlPlazo=$(".dropdown-plazo");a.lblUltimoPrecio=$(".label-ultimo-precio");a.lblVariacion=$(".label-variacion");a.lblMejorOfertaCompra=$(".label-mejor-oferta-compra");a.lblMejorOfertaVenta=$(".label-mejor-oferta-venta");a.divOperarFix=$(".div-operar-fix");a.divOperarFix.hide();a.divReplacePreviousOrders=$(".div-replace-previous-orders");a.chkReplacePreviousOrders=$(".checkbox-replace-previous-orders");a.divCancelInDisconnection=$(".div-cancel-in-disconnection");a.chkCancelInDisconnection=$(".checkbox-cancel-in-disconnection");a.divTipoOrden=$(".div-tipo-orden");a.ddlTipoOrden=$(".dropdown-tipo-orden");a.divVencimientoOrden=$(".div-vencimiento-orden");a.ddlVencimientoOrden=$(".dropdown-vencimiento-orden");a.divPrecioStop=$(".div-precio-stop");a.txtPrecioStop=$(".textbox-precio-stop");a.divFechaVencimiento=$(".div-fecha-vencimiento");a.txtFechaVencimiento=$(".date-fecha-vencimiento");a.txtValorCantidad=$(".textbox-cantidad");a.txtValorPrecio=$(".textbox-precio");a.lblTotal=$(".label-precio-total");a.divObservaciones=$(".div-observaciones");a.txtObservaciones=$(".text-observaciones");a.txtCantidadAMostrar=$(".textbox-cantidad-a-mostrar");a.chkCantidadAMostrar=$(".checkbox-cantidad-a-mostrar");a.divCantidadAMostrar=$(".div-cantidad-a-mostrar");a.divCantidadAMostrar.hide();a.divSeleccionPrecarga=$(".div-seleccion-precarga");a.divSeleccionPrecarga.hide();if(a.pageOptions&&a.pageOptions.precargar){a.divSeleccionPrecarga.show()}a.btnPrecarga=$(".btn-precarga");a.btnNormal=$(".btn-normal");a.divOperarPrecarga=$(".div-operar-precarga");a.divFechaEjecucion=$(".div-fecha-ejecucion");a.ddlMinutosEjecucion=$(".dropdown-minutos-ejecucion");a.txtFechaEjecucion=$(".date-fecha-ejecucion");a.ddlHoraEjecucion=$(".dropdown-hora-ejecucion");a.divFechaExpiracion=$(".div-fecha-expiracion");a.ddlMinutosExpiracion=$(".dropdown-minutos-expiracion");a.txtFechaExpiracion=$(".date-fecha-expiracion");a.ddlHoraExpiracion=$(".dropdown-hora-expiracion");a.btnAyudaEjecutarValidaciones=$(".btn-ayuda-ejecutar-validaciones");a.chkEjecutarValidaciones=$(".checkbox-ejecutar-validaciones");a.chkContinuarAutomaticamente=$(".checkbox-continuar-automaticamente");a.btnContinuar=$(".btn-continuar");a.ddlTipoOperacion.shieldDropDown({dataSource:{data:[{value:Core.Enums.eEspeciesTipoOperacion.Compra,text:"Compra"},{value:Core.Enums.eEspeciesTipoOperacion.Venta,text:"Venta"}]},textTemplate:"{text}",valueTemplate:"{value}",value:(a.ordenPrecargada?a.ordenPrecargada.idTipoOperacion.toString():a.defaultTipoOperacion.toString()),events:{select:function(e){a.clearControls(true);Core.Functions.Operar.setEspecieByTipoOperacion(e.item.value,a.ddlEspecie,Core.Enums.ePanel.NYSE,a.ddlPlazo.swidget().selectedItem().value,a.header.selectedIdAccount,a.loaded,function(){a.loadControlsByEspecie();a.setDisponible(e.item.value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem())});Core.Functions.Operar.setColorByTipoOperacion(e.item.value,a.divMain,a.divCuenta)}}});a.ddlEspecie.shieldComboBox({dataSource:{data:[]},valueTemplate:"{DisplayTicker}",value:(a.ordenPrecargada?a.ordenPrecargada.DisplayTicker:a.defaultEspecie),textTemplate:"{DisplayTicker} | {Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}},events:{select:function(f){if(f.index>=0){a.clearControls(false);a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem());Core.Functions.Operar.setLabelsByEspecie(a.ddlEspecie,a.ddlPlazo.swidget().selectedItem().value,a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(e){a.ultimaCotizacion=e;Core.Functions.grid.Cotizaciones.setAlertPriceType(a.divAlertaTipoPrecio,a.ultimaCotizacion.Cotizacion.TextoAlerta,a.ultimaCotizacion.Cotizacion.TipoAlerta,a.idDefaultAccount,a.idDefaultProfile);if(a.operarOptions.operarFIX){Core.Functions.Operar.setControlsOperarFix(a.ultimaCotizacion,a.ddlTipoOrden,a.ddlVencimientoOrden,a.divOperarFix,a.divReplacePreviousOrders,a.divCancelInDisconnection,a.loaded,function(){a.setControlsByVencimientoOrden();a.setControlsByTipoOrden()})}})}}}});a.ddlPlazo.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",value:(a.ordenPrecargada?a.ordenPrecargada.Plazo.toString():a.defaultPlazo.toString()),events:{select:function(e){a.clearControls(true);Core.Functions.Operar.setEspecieByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlEspecie,Core.Enums.ePanel.NYSE,a.ddlPlazo.swidget().selectedItem().value,a.header.selectedIdAccount,a.loaded,function(){a.loadControlsByEspecie();a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,e.item.value,a.ddlEspecie.swidget().selectedItem());Core.Functions.Operar.setLabelsByEspecie(a.ddlEspecie,a.ddlPlazo.swidget().selectedItem().value,a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(f){a.ultimaCotizacion=f;Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null));Core.Functions.grid.Cotizaciones.setAlertPriceType(a.divAlertaTipoPrecio,a.ultimaCotizacion.Cotizacion.TextoAlerta,a.ultimaCotizacion.Cotizacion.TipoAlerta,a.idDefaultAccount,a.idDefaultProfile)})})}}});Core.Functions.Operar.setPlazos(a.ddlPlazo,a.pageOptions.plazosHabilitados);a.ddlTipoOrden.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{Valor}",value:(a.ordenPrecargada?a.ordenPrecargada.OrderType:""),events:{select:function(e){a.setControlsByTipoOrden()}}});a.ddlVencimientoOrden.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{Valor}",value:(a.ordenPrecargada?a.ordenPrecargada.TimeInForce:""),events:{select:function(e){a.setControlsByVencimientoOrden()}}});new Core.Controls.DecimalPicker(a.txtPrecioStop,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))},defaultValue:(a.ordenPrecargada?a.ordenPrecargada.PrecioDisparo:0)});a.txtFechaVencimiento.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.ordenPrecargada?Core.Functions.Date.getDateByStringWithoutSeparator(a.ordenPrecargada.FechaVencimiento):new Date())});new Core.Controls.DecimalPicker(a.txtValorCantidad,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))},defaultValue:(a.ordenPrecargada?a.ordenPrecargada.Cantidad:a.defaultValorCantidad)});new Core.Controls.DecimalPicker(a.txtValorPrecio,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))},defaultValue:(a.ordenPrecargada?a.ordenPrecargada.PrecioLimite:a.defaultValorLimite)});a.chkCantidadAMostrar.shieldCheckBox({label:"Difusión Parcial / Iceberg",checked:(a.ordenPrecargada&&a.ordenPrecargada.DisplayQty),events:{click:function(f){a.divCantidadAMostrar.hide();if(a.chkCantidadAMostrar.swidget().checked()){a.divCantidadAMostrar.show()}}}});new Core.Controls.DecimalPicker(a.txtCantidadAMostrar,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",defaultValue:(a.ordenPrecargada?a.ordenPrecargada.DisplayQty:0)});a.chkReplacePreviousOrders.shieldCheckBox({label:"Reemplazar órdenes previas",checked:(a.ordenPrecargada&&a.ordenPrecargada.ExecInst&&a.ordenPrecargada.ExecInst.indexOf("x")>=0)});a.chkCancelInDisconnection.shieldCheckBox({label:"Cancelar orden ante desconexión",checked:(a.ordenPrecargada&&a.ordenPrecargada.ExecInst&&a.ordenPrecargada.ExecInst.indexOf("o")>=0)});a.divOperarPrecarga.hide();a.btnNormal.on("click",function(){a.divOperarPrecarga.hide()});a.btnPrecarga.on("click",function(){a.divOperarPrecarga.show()});var b=[];for(var c=10;c<=18;c++){for(var d=0;d<=55;d=d+5){b.push({value:(c.padLeft(2,"0")+":"+d.padLeft(2,"0"))})}}a.ddlMinutosEjecucion.shieldDropDown({dataSource:{data:[{value:0,text:"Ahora"},{value:10,text:"En 10 minutos"},{value:30,text:"En 30 minutos"},{value:60,text:"En 1 hora"},{value:-1,text:"Otro"}]},textTemplate:"{text}",valueTemplate:"{value}",value:(a.ordenPrecargada&&a.ordenPrecargada.MinutosEjecucion?a.ordenPrecargada.MinutosEjecucion.toString():(a.ordenPrecargada&&a.ordenPrecargada.FechaEjecucion?"-1":"0")),events:{select:function(e){Core.Functions.Operar.setControlsByMinutosEjecucion(a.ddlMinutosEjecucion,a.divFechaEjecucion)}}});a.txtFechaEjecucion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.ordenPrecargada?Core.Functions.Date.getDateByStringDisplayDate(a.ordenPrecargada.FechaEjecucion):new Date())});a.ddlHoraEjecucion.shieldDropDown({dataSource:{data:b},textTemplate:"{value}",valueTemplate:"{value}",value:(a.ordenPrecargada&&a.ordenPrecargada.FechaEjecucion?a.ordenPrecargada.FechaEjecucion.substr(11,5):"")});a.ddlMinutosExpiracion.shieldDropDown({dataSource:{data:[{value:10,text:"En 10 minutos"},{value:30,text:"En 30 minutos"},{value:60,text:"En 1 hora"},{value:360,text:"En 6 horas"},{value:-1,text:"Otro"}]},textTemplate:"{text}",valueTemplate:"{value}",value:(a.ordenPrecargada&&a.ordenPrecargada.MinutosExpiracion?a.ordenPrecargada.MinutosExpiracion.toString():(a.ordenPrecargada&&a.ordenPrecargada.FechaExpiracion?"-1":"360")),events:{select:function(e){Core.Functions.Operar.setControlsByMinutosExpiracion(a.ddlMinutosExpiracion,a.divFechaExpiracion)}}});a.txtFechaExpiracion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.ordenPrecargada?Core.Functions.Date.getDateByStringDisplayDate(a.ordenPrecargada.FechaExpiracion):new Date())});a.ddlHoraExpiracion.shieldDropDown({dataSource:{data:b},textTemplate:"{value}",valueTemplate:"{value}",value:(a.ordenPrecargada&&a.ordenPrecargada.FechaExpiracion?a.ordenPrecargada.FechaExpiracion.substr(11,5):"")});a.btnAyudaEjecutarValidaciones.on("click",function(){Core.Functions.Operar.showAyudaEjecutarValidaciones()});a.chkEjecutarValidaciones.shieldCheckBox({label:"Excluir validaciones",checked:(a.ordenPrecargada&&a.ordenPrecargada.EjecutarValidaciones)});a.chkContinuarAutomaticamente.shieldCheckBox({label:"Permitir al cliente modificar esta precarga",checked:(a.ordenPrecargada&&a.ordenPrecargada.ContinuarAutomaticamente)});a.txtObservaciones.shieldTextBox({});if(Core.Objects.Context.Configuration.idAplicacion==1){a.divObservaciones.hide()}a.btnContinuar.click(function(){a.btnContinuarClick()})};a.loadControlsByEspecie=function(){if(a.ddlEspecie.swidget().selectedItem()){Core.Functions.Operar.setLabelsByEspecie(a.ddlEspecie,a.ddlPlazo.swidget().selectedItem().value,a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(c){a.ultimaCotizacion=c;Core.Functions.grid.Cotizaciones.setAlertPriceType(a.divAlertaTipoPrecio,a.ultimaCotizacion.Cotizacion.TextoAlerta,a.ultimaCotizacion.Cotizacion.TipoAlerta,a.idDefaultAccount,a.idDefaultProfile);if(a.operarOptions.operarFIX){Core.Functions.Operar.setControlsOperarFix(a.ultimaCotizacion,a.ddlTipoOrden,a.ddlVencimientoOrden,a.divOperarFix,a.divReplacePreviousOrders,a.divCancelInDisconnection,a.loaded,function(){a.setControlsByVencimientoOrden();a.setControlsByTipoOrden()})}})}else{if(a.defaultEspecie!=""){var b=new Core.Controls.Dialog("Aviso","No posee la Especie "+a.defaultEspecie+".",{displayButtons:{close:true,accept:false}}).show();a.clearControls(true)}}};a.loadControls=function(){Core.Functions.Operar.setComitente(a.lblCuenta,a.header.selectedIdAccount,a.loaded);var b=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,requestUrl:"detalledisponible/"+encodeURIComponent(a.header.selectedIdAccount),requestType:"GET",requestData:{Fecha:Core.Functions.Date.getDateAsString(new Date())}});b.onSuccess=function(c){a.detalleDisponible=c;Core.Functions.Operar.setEspecieByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlEspecie,Core.Enums.ePanel.NYSE,a.ddlPlazo.swidget().selectedItem().value,a.header.selectedIdAccount,a.loaded,function(){a.loadControlsByEspecie();var f=a.ddlEspecie.swidget().selectedItem();a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,(f)?f:null);Core.Functions.Operar.setColorByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.divMain,a.divCuenta);if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra&&a.defaultValorCantidad!=""&&a.defaultValorLimite!=""&&f){var d=$.grep(a.detalleDisponible.disponible,function(h,g){return h.idMoneda==f.idMoneda})[0];if(!d){d=0}else{d=d.DisponibleOperable48}var e=Math.floor((d/a.defaultValorLimite));if(e<a.defaultValorCantidad){if(e<0){a.txtValorCantidad.val("")}else{a.txtValorCantidad.val(e)}}}if(a.ddlEspecie.swidget().selectedItem()&&a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta&&a.defaultValorCantidad!=""){if(a.ddlEspecie.swidget().selectedItem().Cantidad<a.defaultValorCantidad){a.txtValorCantidad.val(a.ddlEspecie.swidget().selectedItem().Cantidad)}else{a.txtValorCantidad.val(a.defaultValorCantidad)}}Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null));Core.Functions.Operar.setControlsByMinutosEjecucion(a.ddlMinutosEjecucion,a.divFechaEjecucion);Core.Functions.Operar.setControlsByMinutosExpiracion(a.ddlMinutosExpiracion,a.divFechaExpiracion)})};b.request()};a.setDisponible=function(d,c,b){a.divDisponible.hide();if(d==Core.Enums.eEspeciesTipoOperacion.Compra&&c!=null&&b!=null){a.disponibleActual=Core.Functions.Operar.setDisponible(a.detalleDisponible.disponible,b.idMoneda,c,a.lblDisponible,a.divDisponible)}};a.btnContinuarClick=function(){var f={value:true};var e={idCuenta:a.header.selectedIdAccount,FechaVencimiento:Core.Functions.Date.getDateAsString(new Date()),idTipoOperacion:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,f),ticker:Core.Functions.Validations.getValidatedDropDownValue(a.ddlEspecie,f),Plazo:Core.Functions.Validations.getValidatedDropDownValue(a.ddlPlazo,f),idMoneda:(a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().idMoneda:null,Cantidad:Core.Functions.Validations.getValidatedNumericInputValue(a.txtValorCantidad,f),Monto:null,PrecioDisparo:null,Observaciones:a.txtObservaciones.val()};if(a.ordenPrecargada){e.idOrdenPrecargada=a.ordenPrecargada.idOrdenPrecargada}if(a.operarOptions.operarFIX&&a.ddlTipoOrden.swidget().selectedItem()&&a.ddlVencimientoOrden.swidget().selectedItem()){e.OrderType=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOrden,f);e.TimeInForce=Core.Functions.Validations.getValidatedDropDownValue(a.ddlVencimientoOrden,f);if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){e.PrecioDisparo=Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecioStop,f)}if(a.ddlVencimientoOrden.swidget().value()==a.eVencimientoOrden.GoodTillDate){var b=new Date();b.setHours(0,0,0,0);var d=((a.txtFechaVencimiento.swidget().value())?a.txtFechaVencimiento.swidget().value():new Date());d.setHours(0,0,0,0);e.FechaVencimiento=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaVencimiento,f));if(b.getTime()>d.getTime()){f.value=false;Core.Functions.Validations.toggleValidation(a.txtFechaVencimiento,true)}}if(a.chkCantidadAMostrar.swidget().checked()){e.DisplayQty=Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidadAMostrar,f);if(f.value&&(parseFloat(e.DisplayQty)<0||parseFloat(e.DisplayQty)>=parseFloat(e.Cantidad))){f.value=false;var c=new Core.Controls.Dialog("Aviso","La cantidad a mostrar debe ser positiva y menor a los nominales ingresados ",{displayButtons:{close:true,accept:false}}).show()}}}if(a.divReplacePreviousOrders.is(":visible")&&a.chkReplacePreviousOrders.swidget().checked()){e.ExecInst="x"}if(a.divCancelInDisconnection.is(":visible")&&a.chkCancelInDisconnection.swidget().checked()){if(e.ExecInst){e.ExecInst+=" o"}else{e.ExecInst="o"}}if(!a.ddlTipoOrden.swidget().selectedItem()||(a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.Market&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.MarketWithLeftOverAsLimit&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.StopMerval&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.Stop&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.MarketIfTouched)){e.PrecioLimite=Core.Functions.Validations.getValidatedNumericInputValue(a.txtValorPrecio,f)}if(a.divOperarPrecarga.is(":visible")){e.EsPrecarga=1;if(a.divFechaEjecucion.is(":visible")){e.FechaEjecucion=(Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaEjecucion,f))+" "+Core.Functions.Validations.getValidatedDropDownValue(a.ddlHoraEjecucion,f)+":00")}else{e.MinutosEjecucion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMinutosEjecucion,f)}if(a.divFechaExpiracion.is(":visible")){e.FechaExpiracion=(Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaExpiracion,f))+" "+Core.Functions.Validations.getValidatedDropDownValue(a.ddlHoraExpiracion,f)+":00")}else{e.MinutosExpiracion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMinutosExpiracion,f)}e.EjecutarValidaciones=a.chkEjecutarValidaciones.swidget().checked()?1:0;e.ContinuarAutomaticamente=a.chkContinuarAutomaticamente.swidget().checked()?0:1}if(f.value){Core.Functions.Operar.srOperarEspeciesValidaciones(a.txtValorCantidad,f)}if(!f.value){return}Core.Functions.Operar.srOperarEspecies(e,function(){Core.Functions.Operar.refreshDisponible(a.detalleDisponible,function(){a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem())},a.header.selectedIdAccount,a.loaded)},a.header.selectedIdAccount,a.idDefaultProfile,a.loaded)};a.setControlsByVencimientoOrden=function(){if(a.ddlVencimientoOrden.swidget().value()==a.eVencimientoOrden.GoodTillDate){a.divFechaVencimiento.show()}else{a.txtFechaVencimiento.swidget().value(new Date());a.divFechaVencimiento.hide()}};a.setControlsByTipoOrden=function(){if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){a.divPrecioStop.show()}else{a.txtPrecioStop.val("");a.divPrecioStop.hide()}a.txtValorPrecio.removeAttr("disabled");if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Market||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketWithLeftOverAsLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){a.txtValorPrecio.val("");a.txtValorPrecio.attr("disabled","disabled");Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))}};a.getPrecio=function(){if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Market||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketWithLeftOverAsLimit){if(a.ultimaCotizacion){if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra){return a.ultimaCotizacion.Cotizacion.PrecioVenta}else{return a.ultimaCotizacion.Cotizacion.PrecioCompra}}else{return null}}else{if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){return a.txtPrecioStop.val()}else{return a.txtValorPrecio.val()}}};a.clearControls=function(b){if(b){a.ddlEspecie.swidget().refresh();a.lblUltimoPrecio.text("");a.lblVariacion.text("");a.lblMejorOfertaCompra.text("");a.lblMejorOfertaVenta.text("")}a.txtValorCantidad.val("");a.txtValorPrecio.val("");a.lblTotal.text("");a.txtObservaciones.val("");a.ddlTipoOrden.swidget().refresh();a.ddlVencimientoOrden.swidget().refresh();a.txtPrecioStop.val("");a.txtCantidadAMostrar.val("");a.txtFechaVencimiento.swidget().refresh();a.divAlertaTipoPrecio.hide();a.ultimaCotizacion=null}};Core.Business.Operar.Lebacs=new function(){var a=this;a.id="lebacs";a.loaded=false;a.detalleDisponible=null;a.idDefaultAccount=null;a.idDefaultProfile=null;a.decimalCount=6;a.eVencimientoOrden={GoodTillDate:6};a.eTipoOrden={Market:1,Limit:2,StopMerval:3,StopLimit:4,Stop:"z",MarketWithLeftOverAsLimit:"K",MarketIfTouched:"J"};a.divMain=null;a.divCuenta=null;a.ddlTipoOperacion=null;a.divPlazo=null;a.ddlPlazo=null;a.divMoneda=null;a.ddlMoneda=null;a.divRenovar=null;a.ddlRenovar=null;a.divEspecie=null;a.ddlEspecie=null;a.lblCuenta=null;a.divDisponible=null;a.lblDisponible=null;a.divCotizacion=null;a.lblUltimoPrecio=null;a.lblVariacion=null;a.lblMejorOfertaCompra=null;a.lblMejorOfertaVenta=null;a.divOperarFix=null;a.divReplacePreviousOrders=null;a.chkReplacePreviousOrders=null;a.divCancelInDisconnection=null;a.chkCancelInDisconnection=null;a.divTipoOrden=null;a.ddlTipoOrden=null;a.divVencimientoOrden=null;a.ddlVencimientoOrden=null;a.divPrecioStop=null;a.txtPrecioStop=null;a.divFechaVencimiento=null;a.txtFechaVencimiento=null;a.divCantidad=null;a.lblCantidad=null;a.txtValorCantidad=null;a.divMontoLicitar=null;a.lblMontoLicitar=null;a.txtMontoLicitar=null;a.divValorNegociacion=null;a.lblValorNegociacion=null;a.txtValorNegociacion=null;a.divPrecio=null;a.txtValorPrecio=null;a.divTotal=null;a.lblTotal=null;a.chkCantidadAMostrar=null;a.txtCantidadAMostrar=null;a.divCantidadAMostrar=null;a.divObservaciones=null;a.txtObservaciones=null;a.lblNota=null;a.btnContinuar=null;a.defaultTipoOperacion=null;a.defaultEspecie=null;a.defaultValorCantidad=null;a.defaultValorLimite=null;a.defaultPlazo=null;a.disponibleActual=null;a.pageOptions=null;a.operarOptions=null;a.ultimaCotizacion=null;a.init=function(d,e,f){if(Core.Objects.Accounts){var b=$.grep(Core.Objects.Accounts,function(h,g){return h.idCuenta==d})[0];if(b.NumComitente==""){return}}a.idDefaultAccount=d;a.idDefaultProfile=e;a.defaultTipoOperacion=Core.Enums.eEspeciesTipoOperacion.Venta;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[e]);a.operarOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu("operar",Core.Objects.Context.Profiles[e]);a.defaultEspecie="";a.defaultValorCantidad="";a.defaultValorLimite="";a.defaultPlazo=a.pageOptions.plazoDefault;$.extend(true,a,f);if(Core.Objects.Context.TieneC4D==1){Core.loadPage("operar-lebacs.html",function(){document.title="Operar Lebacs";a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,d,e,function(){var g=$.grep(Core.Objects.Accounts,function(i,h){return i.idCuenta==a.header.selectedIdAccount})[0];if(g.NumComitente==""){Core.Business.PosicionConsolidada.init(a.header.selectedIdAccount,a.idDefaultProfile);return}a.loaded=false;a.loadControls()},"Core.Business.Operar.Lebacs")})}else{var c=new Core.Controls.Dialog("Aviso","<p>Para poder Operar debe generar el código de operación de cuatro dígitos desde Configuración de Cuenta.<br/> <a onclick=\"$('.close-btn').click(); Core.Business.AccountSettings.init("+d+", "+e+');">Haga Click Aquí para ir a Configuración de Cuenta.</a></p>',{displayButtons:{close:true,accept:false}}).show()}};a.initControls=function(){a.divMain=$(".div-main");a.divCuenta=$(".div-cuenta");a.ddlTipoOperacion=$(".dropdown-tipo-operacion");a.ddlPlazo=$(".dropdown-plazo");a.divPlazo=$(".div-plazo");a.ddlMoneda=$(".dropdown-moneda");a.divMoneda=$(".div-moneda");a.ddlRenovar=$(".dropdown-renovar");a.divRenovar=$(".div-renovar");a.ddlEspecie=$(".dropdown-especie");a.divEspecie=$(".div-especie");a.lblCuenta=$(".label-cuenta");a.divDisponible=$(".div-disponible");a.lblDisponible=$(".label-disponible");a.divCotizacion=$(".div-cotizacion");a.lblUltimoPrecio=$(".label-ultimo-precio");a.lblVariacion=$(".label-variacion");a.lblMejorOfertaCompra=$(".label-mejor-oferta-compra");a.lblMejorOfertaVenta=$(".label-mejor-oferta-venta");a.divOperarFix=$(".div-operar-fix");a.divOperarFix.hide();a.divTipoOrden=$(".div-tipo-orden");a.ddlTipoOrden=$(".dropdown-tipo-orden");a.divVencimientoOrden=$(".div-vencimiento-orden");a.ddlVencimientoOrden=$(".dropdown-vencimiento-orden");a.divPrecioStop=$(".div-precio-stop");a.txtPrecioStop=$(".textbox-precio-stop");a.divFechaVencimiento=$(".div-fecha-vencimiento");a.txtFechaVencimiento=$(".date-fecha-vencimiento");a.divCantidad=$(".div-cantidad");a.lblCantidad=$(".lbl-cantidad");a.txtValorCantidad=$(".textbox-cantidad");a.divMontoLicitar=$(".div-monto-licitar");a.lblMontoLicitar=$(".lbl-monto-licitar");a.txtMontoLicitar=$(".textbox-monto-licitar");a.divValorNegociacion=$(".div-valor-negociacion");a.lblValorNegociacion=$(".lbl-valor-negociacion");a.txtValorNegociacion=$(".textbox-valor-negociacion");a.divPrecio=$(".div-precio");a.txtValorPrecio=$(".textbox-precio");a.divTotal=$(".div-total");a.lblTotal=$(".label-precio-total");a.divObservaciones=$(".div-observaciones");a.txtObservaciones=$(".text-observaciones");a.lblNota=$(".lbl-nota");a.txtCantidadAMostrar=$(".textbox-cantidad-a-mostrar");a.chkCantidadAMostrar=$(".checkbox-cantidad-a-mostrar");a.divCantidadAMostrar=$(".div-cantidad-a-mostrar");a.divCantidadAMostrar.hide();a.divReplacePreviousOrders=$(".div-replace-previous-orders");a.chkReplacePreviousOrders=$(".checkbox-replace-previous-orders");a.divCancelInDisconnection=$(".div-cancel-in-disconnection");a.chkCancelInDisconnection=$(".checkbox-cancel-in-disconnection");a.btnContinuar=$(".btn-continuar");var b=[{value:Core.Enums.eEspeciesTipoOperacion.Venta,text:"Venta en mercado secundario"},{value:Core.Enums.eEspeciesTipoOperacion.Compra,text:"Compra en mercado secundario"}];if(a.pageOptions&&a.pageOptions.puedeLicitar>0){b.push({value:Core.Enums.eEspeciesTipoOperacion.Licitacion,text:"Licitar LEBAC"});b.push({value:Core.Enums.eEspeciesTipoOperacion.Renovacion,text:"Renovación"})}a.ddlTipoOperacion.shieldDropDown({dataSource:{data:b},textTemplate:"{text}",valueTemplate:"{value}",value:a.defaultTipoOperacion.toString(),events:{select:function(c){a.clearControls(true);a.setControlsByTipoOperacion(c.item.value);a.setEspecieByTipoOperacion(c.item.value,function(){a.loadControlsByEspecie()});a.setDisponible(c.item.value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem());Core.Functions.Operar.setColorByTipoOperacion(c.item.value,a.divMain,a.divCuenta)}}});a.ddlEspecie.shieldComboBox({dataSource:{data:[]},valueTemplate:"{ticker}",value:a.defaultEspecie,textTemplate:"{ticker} | {Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"ticker",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}},events:{select:function(c){if(c.index>=0){a.clearControls(false);if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta||a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra){Core.Functions.Operar.setLabelsByEspecie(a.ddlEspecie,a.ddlPlazo.swidget().selectedItem().value,a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(d){a.ultimaCotizacion=d;if(a.operarOptions.operarFIX){Core.Functions.Operar.setControlsOperarFix(a.ultimaCotizacion,a.ddlTipoOrden,a.ddlVencimientoOrden,a.divOperarFix,a.divReplacePreviousOrders,a.divCancelInDisconnection,a.loaded,function(){a.setControlsByVencimientoOrden();a.setControlsByTipoOrden()})}})}else{a.loadMonedas();a.lblNota.hide();if(a.ddlEspecie.swidget().selectedItem()&&a.ddlEspecie.swidget().selectedItem().Nota){a.lblNota.text(a.ddlEspecie.swidget().selectedItem().Nota);a.lblNota.show()}if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Licitacion){a.lblMontoLicitar.text((a.ddlEspecie.swidget().selectedItem()&&a.ddlEspecie.swidget().selectedItem().Rotulo)?a.ddlEspecie.swidget().selectedItem().Rotulo:"Monto a Licitar");a.txtMontoLicitar.attr("placeholder",(a.ddlEspecie.swidget().selectedItem()&&a.ddlEspecie.swidget().selectedItem().Rotulo)?a.ddlEspecie.swidget().selectedItem().Rotulo:"Monto a Licitar")}if(a.ddlEspecie.swidget().selectedItem()&&a.ddlEspecie.swidget().selectedItem().idTipoNegociacion){a.lblValorNegociacion.text(a.ddlEspecie.swidget().selectedItem().TipoNegociacion);a.txtValorNegociacion.attr("placeholder","Ingrese "+a.ddlEspecie.swidget().selectedItem().TipoNegociacion.toLowerCase());a.txtValorNegociacion.attr("max-decimal-digit-count",a.ddlEspecie.swidget().selectedItem().Decimales.toString());a.txtValorNegociacion.maxDecimalDigitCount=a.ddlEspecie.swidget().selectedItem().Decimales;a.divValorNegociacion.show()}else{a.divValorNegociacion.hide()}}a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem())}}}});a.ddlMoneda.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{idMoneda}",events:{select:function(c){a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem())}}});a.ddlRenovar.shieldDropDown({dataSource:{data:[]},textTemplate:"{ticker} ({Cantidad}) | {Descripcion}",valueTemplate:"{ticker}"});a.ddlPlazo.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",value:a.defaultPlazo.toString(),events:{select:function(c){a.clearControls(true);a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,c.item.value,a.ddlEspecie.swidget().selectedItem());a.setEspecieByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,function(){a.loadControlsByEspecie()});if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta||a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra){Core.Functions.Operar.setLabelsByEspecie(a.ddlEspecie,a.ddlPlazo.swidget().selectedItem().value,a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(d){a.ultimaCotizacion=d;Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))})}}}});Core.Functions.Operar.setPlazos(a.ddlPlazo,a.pageOptions.plazosHabilitados);a.ddlTipoOrden.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{Valor}",events:{select:function(c){a.setControlsByTipoOrden()}}});a.ddlVencimientoOrden.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{Valor}",events:{select:function(c){a.setControlsByVencimientoOrden()}}});new Core.Controls.DecimalPicker(a.txtPrecioStop,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta||a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra){Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))}}});a.txtFechaVencimiento.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date()});new Core.Controls.DecimalPicker(a.txtValorCantidad,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta||a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra){Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))}},defaultValue:a.defaultValorCantidad});new Core.Controls.DecimalPicker(a.txtMontoLicitar,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:""});new Core.Controls.DecimalPicker(a.txtValorNegociacion,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:""});new Core.Controls.DecimalPicker(a.txtValorPrecio,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta||a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra){Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))}},defaultValue:a.defaultValorLimite});a.chkCantidadAMostrar.shieldCheckBox({label:"Difusión Parcial / Iceberg",events:{click:function(c){a.divCantidadAMostrar.hide();if(a.chkCantidadAMostrar.swidget().checked()){a.divCantidadAMostrar.show()}}}});new Core.Controls.DecimalPicker(a.txtCantidadAMostrar,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:""});a.chkReplacePreviousOrders.shieldCheckBox({label:"Reemplazar órdenes previas"});a.chkCancelInDisconnection.shieldCheckBox({label:"Cancelar orden ante desconexión"});a.txtObservaciones.shieldTextBox({});if(Core.Objects.Context.Configuration.idAplicacion==1){a.divObservaciones.hide()}a.btnContinuar.click(function(){a.btnContinuarClick()})};a.loadControlsByEspecie=function(){if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra||a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta){if(a.ddlEspecie.swidget().selectedItem()){Core.Functions.Operar.setLabelsByEspecie(a.ddlEspecie,a.ddlPlazo.swidget().selectedItem().value,a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(c){a.ultimaCotizacion=c;if(a.operarOptions.operarFIX){Core.Functions.Operar.setControlsOperarFix(a.ultimaCotizacion,a.ddlTipoOrden,a.ddlVencimientoOrden,a.divOperarFix,a.divReplacePreviousOrders,a.divCancelInDisconnection,a.loaded,function(){a.setControlsByVencimientoOrden();a.setControlsByTipoOrden()})}})}else{if(a.defaultEspecie!=""){var b=new Core.Controls.Dialog("Aviso","No posee la Especie "+a.defaultEspecie+".",{displayButtons:{close:true,accept:false}}).show();a.clearControls(true)}}}};a.loadControls=function(){a.divDisponible.hide();Core.Functions.Operar.setComitente(a.lblCuenta,a.header.selectedIdAccount,a.loaded);var b=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,requestUrl:"detalledisponible/"+encodeURIComponent(a.header.selectedIdAccount),requestType:"GET",requestData:{Fecha:Core.Functions.Date.getDateAsString(new Date())}});b.onSuccess=function(c){a.detalleDisponible=c;a.setControlsByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value);a.setEspecieByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,function(){a.loadControlsByEspecie();var e=a.ddlEspecie.swidget().selectedItem();a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,(e)?e:null);Core.Functions.Operar.setColorByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.divMain,a.divCuenta);if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra&&a.defaultValorCantidad!=""&&a.defaultValorLimite!=""&&e){var d=Math.floor((a.disponibleActual/a.defaultValorLimite));if(d<a.defaultValorCantidad){if(d<0){a.txtValorCantidad.val("")}else{a.txtValorCantidad.val(d)}}}if(a.ddlEspecie.swidget().selectedItem()&&a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta&&a.defaultValorCantidad!=""){if(a.ddlEspecie.swidget().selectedItem().Cantidad<a.defaultValorCantidad){a.txtValorCantidad.val(a.ddlEspecie.swidget().selectedItem().Cantidad)}else{a.txtValorCantidad.val(a.defaultValorCantidad)}}Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))})};b.request()};a.setDisponible=function(g,e,c){a.divDisponible.hide();if(g==Core.Enums.eEspeciesTipoOperacion.Compra&&e!=null&&c!=null){a.disponibleActual=Core.Functions.Operar.setDisponible(a.detalleDisponible.disponible,c.idMoneda,e,a.lblDisponible,a.divDisponible)}else{if(c!=null&&g==Core.Enums.eEspeciesTipoOperacion.Licitacion){var d=(a.ddlMoneda.swidget().selectedItem())?a.ddlMoneda.swidget().selectedItem().idMoneda:null;var b=$.grep(a.detalleDisponible.disponible,function(i,h){return i.idMoneda==d})[0];var f=-1;if(c.FechaCierre==b.FechaCI){f=Core.Enums.ePlazo.CI}else{if(c.FechaCierre==b.Fecha24){f=Core.Enums.ePlazo.D24}else{if(c.FechaCierre==b.Fecha48){f=Core.Enums.ePlazo.D48}else{if(c.FechaCierre==b.Fecha72){f=Core.Enums.ePlazo.D72}}}}if(d!=null){a.disponibleActual=Core.Functions.Operar.setDisponible(a.detalleDisponible.disponible,d,f,a.lblDisponible,a.divDisponible)}}}};a.btnContinuarClick=function(){var f={value:true};if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta||a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra){Core.Functions.Validations.getValidatedDropDownValue(a.ddlEspecie,f);var e={idCuenta:a.header.selectedIdAccount,FechaVencimiento:Core.Functions.Date.getDateAsString(new Date()),idTipoOperacion:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,f),ticker:(a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().Ticker:null,Plazo:Core.Functions.Validations.getValidatedDropDownValue(a.ddlPlazo,f),idMoneda:(a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().idMoneda:null,Cantidad:Core.Functions.Validations.getValidatedNumericInputValue(a.txtValorCantidad,f),Monto:null,PrecioDisparo:null,Observaciones:a.txtObservaciones.val()};if(a.operarOptions.operarFIX&&a.ddlTipoOrden.swidget().selectedItem()&&a.ddlVencimientoOrden.swidget().selectedItem()){e.OrderType=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOrden,f);e.TimeInForce=Core.Functions.Validations.getValidatedDropDownValue(a.ddlVencimientoOrden,f);if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){e.PrecioDisparo=Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecioStop,f)}if(a.ddlVencimientoOrden.swidget().value()==a.eVencimientoOrden.GoodTillDate){var b=new Date();b.setHours(0,0,0,0);var d=((a.txtFechaVencimiento.swidget().value())?a.txtFechaVencimiento.swidget().value():new Date());d.setHours(0,0,0,0);e.FechaVencimiento=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaVencimiento,f));if(b.getTime()>d.getTime()){f.value=false;Core.Functions.Validations.toggleValidation(a.txtFechaVencimiento,true)}}if(a.chkCantidadAMostrar.swidget().checked()){e.DisplayQty=Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidadAMostrar,f);if(f.value&&(parseFloat(e.DisplayQty)<0||parseFloat(e.DisplayQty)>=parseFloat(e.Cantidad))){f.value=false;var c=new Core.Controls.Dialog("Aviso","La cantidad a mostrar debe ser positiva y menor a los nominales ingresados ",{displayButtons:{close:true,accept:false}}).show()}}}if(a.divReplacePreviousOrders.is(":visible")&&a.chkReplacePreviousOrders.swidget().checked()){e.ExecInst="x"}if(a.divCancelInDisconnection.is(":visible")&&a.chkCancelInDisconnection.swidget().checked()){if(e.ExecInst){e.ExecInst+=" o"}else{e.ExecInst="o"}}if(!a.ddlTipoOrden.swidget().selectedItem()||(a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.Market&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.MarketWithLeftOverAsLimit&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.StopMerval&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.Stop&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.MarketIfTouched)){e.PrecioLimite=Core.Functions.Validations.getValidatedNumericInputValue(a.txtValorPrecio,f)}if(f.value){Core.Functions.Operar.srOperarEspeciesValidaciones(a.txtValorCantidad,f)}if(!f.value){return}Core.Functions.Operar.srOperarEspecies(e,function(){Core.Functions.Operar.refreshDisponible(a.detalleDisponible,function(){a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem())},a.header.selectedIdAccount,a.loaded)},a.header.selectedIdAccount,a.idDefaultProfile,a.loaded)}else{Core.Functions.Validations.getValidatedDropDownValue(a.ddlEspecie,f);var e={idCuenta:a.header.selectedIdAccount,idLicitacion:(a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().idLicitacion:null,idTipoOperacion:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,f),ticker:(a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().ticker:null};if(a.ddlEspecie.swidget().selectedItem()){e.idTipoNegociacion=a.ddlEspecie.swidget().selectedItem().idTipoNegociacion;if(a.ddlEspecie.swidget().selectedItem().idTipoNegociacion){e.ValorNegociacion=Core.Functions.Validations.getValidatedNumericInputValue(a.txtValorNegociacion,f)}}if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Renovacion){e.tickerRenovacion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlRenovar,f);e.Cantidad=Core.Functions.Validations.getValidatedNumericInputValue(a.txtValorCantidad,f);if(f.value){Core.Functions.Operar.srOperarEspeciesValidaciones(a.txtValorCantidad,f)}}else{e.idMoneda=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMoneda,f);e.Monto=Core.Functions.Validations.getValidatedNumericInputValue(a.txtMontoLicitar,f);if(f.value){Core.Functions.Operar.srOperarEspeciesValidaciones(a.txtMontoLicitar,f)}}if(!f.value){return}Core.Functions.Operar.srOperarLicitacion(e,function(){Core.Functions.Operar.refreshDisponible(a.detalleDisponible,function(){a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem())},a.header.selectedIdAccount,a.loaded)},a.header.selectedIdAccount,a.idDefaultProfile)}};a.setControlsByTipoOperacion=function(b){a.divPlazo.hide();a.divMoneda.hide();a.divRenovar.hide();a.divCotizacion.hide();a.divPrecio.hide();a.divTotal.hide();a.divObservaciones.hide();a.divMontoLicitar.hide();a.divValorNegociacion.hide();a.divCantidad.hide();a.lblNota.hide();a.divOperarFix.hide();if(b==Core.Enums.eEspeciesTipoOperacion.Venta||b==Core.Enums.eEspeciesTipoOperacion.Compra){a.divPlazo.show();a.divCotizacion.show();a.divPrecio.show();a.divTotal.show();a.divCantidad.show();a.lblCantidad.text("Cantidad de nominales");if(Core.Objects.Context.Configuration.idAplicacion!=1){a.divObservaciones.show()}}else{if(b==Core.Enums.eEspeciesTipoOperacion.Renovacion){a.divRenovar.show();a.divCantidad.show();a.lblCantidad.text("Monto a renovar")}else{if(b==Core.Enums.eEspeciesTipoOperacion.Licitacion){a.divMoneda.show();a.divMontoLicitar.show()}}}};a.setEspecieByTipoOperacion=function(e,b){var c={};c.panel=Core.Enums.ePanel.Lebacs;if(e==Core.Enums.eEspeciesTipoOperacion.Venta||e==Core.Enums.eEspeciesTipoOperacion.Compra){if(e==Core.Enums.eEspeciesTipoOperacion.Venta){c.idCuenta=a.header.selectedIdAccount;c.plazo=a.ddlPlazo.swidget().selectedItem().value}var d=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,allowCache:e==Core.Enums.eEspeciesTipoOperacion.Compra,secureRequest:true,requestUrl:"especies",requestType:"GET",requestData:c});d.onSuccess=function(f){a.loadEspecies(e,f.especies,b)};d.request()}else{c.idCuenta=a.header.selectedIdAccount;if(e==Core.Enums.eEspeciesTipoOperacion.Renovacion){c.renovar=1}var d=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"licitacion/detalle",requestType:"POST",requestData:c});d.onSuccess=function(f){a.loadEspecies(e,f.instrumentos,b);if(e==Core.Enums.eEspeciesTipoOperacion.Renovacion){a.loadRenovaciones(f.renovaciones)}};d.request()}};a.loadMonedas=function(){var b=[];b=(a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().monedas:[];var c=a.ddlMoneda.swidget().initialOptions;c.dataSource.data=b;a.ddlMoneda.swidget().refresh(c)};a.loadEspecies=function(e,b,c){var d=a.ddlEspecie.swidget().initialOptions;d.dataSource.data=b;if(e==Core.Enums.eEspeciesTipoOperacion.Venta){d.textTemplate="{DisplayTicker} ({Cantidad}) | {Descripcion}";d.valueTemplate="{DisplayTicker}"}else{if(e==Core.Enums.eEspeciesTipoOperacion.Compra){d.textTemplate="{DisplayTicker} {Descripcion}";d.valueTemplate="{DisplayTicker}"}else{d.textTemplate="{ticker} | {Descripcion}";d.valueTemplate="{ticker}"}}a.ddlEspecie.swidget().refresh(d);if(c){c()}};a.loadRenovaciones=function(b){var c=a.ddlRenovar.swidget().initialOptions;c.dataSource.data=b;a.ddlRenovar.swidget().refresh(c)};a.setControlsByVencimientoOrden=function(){if(a.ddlVencimientoOrden.swidget().value()==a.eVencimientoOrden.GoodTillDate){a.divFechaVencimiento.show()}else{a.txtFechaVencimiento.swidget().value(new Date());a.divFechaVencimiento.hide()}};a.setControlsByTipoOrden=function(){if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){a.divPrecioStop.show()}else{a.txtPrecioStop.val("");a.divPrecioStop.hide()}a.txtValorPrecio.removeAttr("disabled");if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Market||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketWithLeftOverAsLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){a.txtValorPrecio.val("");a.txtValorPrecio.attr("disabled","disabled");Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))}};a.getPrecio=function(){if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Market||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketWithLeftOverAsLimit){if(a.ultimaCotizacion){if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra){return a.ultimaCotizacion.Cotizacion.PrecioVenta}else{return a.ultimaCotizacion.Cotizacion.PrecioCompra}}else{return null}}else{if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){return a.txtPrecioStop.val()}else{return a.txtValorPrecio.val()}}};a.clearControls=function(b){if(b){a.ddlEspecie.swidget().refresh();a.ddlRenovar.swidget().refresh();a.ddlMoneda.swidget().refresh();a.lblUltimoPrecio.text("");a.lblVariacion.text("");a.lblMejorOfertaCompra.text("");a.lblMejorOfertaVenta.text("")}a.lblMontoLicitar.text("Seleccione la Especie");a.txtMontoLicitar.attr("placeholder","Seleccione la Especie");a.txtValorCantidad.val("");a.txtValorPrecio.val("");a.lblTotal.text("");a.txtObservaciones.val("");a.ddlTipoOrden.swidget().refresh();a.ddlVencimientoOrden.swidget().refresh();a.txtPrecioStop.val("");a.txtCantidadAMostrar.val("");a.txtFechaVencimiento.swidget().refresh();a.ultimaCotizacion=null}};Core.Business.Operar.Letes=new function(){var a=this;a.id="letes";a.loaded=false;a.detalleDisponible=null;a.idDefaultAccount=null;a.idDefaultProfile=null;a.decimalCount=6;a.eVencimientoOrden={GoodTillDate:6};a.eTipoOrden={Market:1,Limit:2,StopMerval:3,StopLimit:4,Stop:"z",MarketWithLeftOverAsLimit:"K",MarketIfTouched:"J"};a.divMain=null;a.divCuenta=null;a.ddlTipoOperacion=null;a.divPlazo=null;a.ddlPlazo=null;a.divMoneda=null;a.ddlMoneda=null;a.divRenovar=null;a.ddlRenovar=null;a.divEspecie=null;a.ddlEspecie=null;a.lblCuenta=null;a.divDisponible=null;a.lblDisponible=null;a.divCotizacion=null;a.lblUltimoPrecio=null;a.lblVariacion=null;a.lblMejorOfertaCompra=null;a.lblMejorOfertaVenta=null;a.divOperarFix=null;a.divReplacePreviousOrders=null;a.chkReplacePreviousOrders=null;a.divCancelInDisconnection=null;a.chkCancelInDisconnection=null;a.divTipoOrden=null;a.ddlTipoOrden=null;a.divVencimientoOrden=null;a.ddlVencimientoOrden=null;a.divPrecioStop=null;a.txtPrecioStop=null;a.divFechaVencimiento=null;a.txtFechaVencimiento=null;a.divCantidad=null;a.lblCantidad=null;a.txtValorCantidad=null;a.divMontoLicitar=null;a.lblMontoLicitar=null;a.txtMontoLicitar=null;a.divValorNegociacion=null;a.lblValorNegociacion=null;a.txtValorNegociacion=null;a.divPrecio=null;a.txtValorPrecio=null;a.divTotal=null;a.lblTotal=null;a.chkCantidadAMostrar=null;a.txtCantidadAMostrar=null;a.divCantidadAMostrar=null;a.divObservaciones=null;a.txtObservaciones=null;a.lblNota=null;a.btnContinuar=null;a.defaultTipoOperacion=null;a.defaultEspecie=null;a.defaultValorCantidad=null;a.defaultValorLimite=null;a.defaultPlazo=null;a.disponibleActual=null;a.pageOptions=null;a.operarOptions=null;a.ultimaCotizacion=null;a.instrumentos=[];a.renovaciones=[];a.init=function(d,e,f){if(Core.Objects.Accounts){var b=$.grep(Core.Objects.Accounts,function(h,g){return h.idCuenta==d})[0];if(b.NumComitente==""){return}}a.idDefaultAccount=d;a.idDefaultProfile=e;a.defaultTipoOperacion=Core.Enums.eEspeciesTipoOperacion.Venta;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[e]);a.operarOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu("operar",Core.Objects.Context.Profiles[e]);a.defaultEspecie="";a.defaultValorCantidad="";a.defaultValorLimite="";a.defaultPlazo=a.pageOptions.plazoDefault;$.extend(true,a,f);if(Core.Objects.Context.TieneC4D==1){Core.loadPage("operar-letes.html",function(){document.title="Operar Letras";a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,d,e,function(){var g=$.grep(Core.Objects.Accounts,function(i,h){return i.idCuenta==a.header.selectedIdAccount})[0];if(g.NumComitente==""){Core.Business.PosicionConsolidada.init(a.header.selectedIdAccount,a.idDefaultProfile);return}a.loaded=false;a.loadControls()},"Core.Business.Operar.Letes")})}else{var c=new Core.Controls.Dialog("Aviso","<p>Para poder Operar debe generar el código de operación de cuatro dígitos desde Configuración de Cuenta.<br/> <a onclick=\"$('.close-btn').click(); Core.Business.AccountSettings.init("+d+", "+e+');">Haga Click Aquí para ir a Configuración de Cuenta.</a></p>',{displayButtons:{close:true,accept:false}}).show()}};a.initControls=function(){a.divMain=$(".div-main");a.divCuenta=$(".div-cuenta");a.ddlTipoOperacion=$(".dropdown-tipo-operacion");a.ddlPlazo=$(".dropdown-plazo");a.divPlazo=$(".div-plazo");a.ddlMoneda=$(".dropdown-moneda");a.divMoneda=$(".div-moneda");a.ddlRenovar=$(".dropdown-renovar");a.divRenovar=$(".div-renovar");a.ddlEspecie=$(".dropdown-especie");a.divEspecie=$(".div-especie");a.lblCuenta=$(".label-cuenta");a.divDisponible=$(".div-disponible");a.lblDisponible=$(".label-disponible");a.divCotizacion=$(".div-cotizacion");a.lblUltimoPrecio=$(".label-ultimo-precio");a.lblVariacion=$(".label-variacion");a.lblMejorOfertaCompra=$(".label-mejor-oferta-compra");a.lblMejorOfertaVenta=$(".label-mejor-oferta-venta");a.divOperarFix=$(".div-operar-fix");a.divOperarFix.hide();a.divTipoOrden=$(".div-tipo-orden");a.ddlTipoOrden=$(".dropdown-tipo-orden");a.divVencimientoOrden=$(".div-vencimiento-orden");a.ddlVencimientoOrden=$(".dropdown-vencimiento-orden");a.divPrecioStop=$(".div-precio-stop");a.txtPrecioStop=$(".textbox-precio-stop");a.divFechaVencimiento=$(".div-fecha-vencimiento");a.txtFechaVencimiento=$(".date-fecha-vencimiento");a.divCantidad=$(".div-cantidad");a.lblCantidad=$(".lbl-cantidad");a.txtValorCantidad=$(".textbox-cantidad");a.divMontoLicitar=$(".div-monto-licitar");a.lblMontoLicitar=$(".lbl-monto-licitar");a.txtMontoLicitar=$(".textbox-monto-licitar");a.divValorNegociacion=$(".div-valor-negociacion");a.lblValorNegociacion=$(".lbl-valor-negociacion");a.txtValorNegociacion=$(".textbox-valor-negociacion");a.divPrecio=$(".div-precio");a.txtValorPrecio=$(".textbox-precio");a.divTotal=$(".div-total");a.lblTotal=$(".label-precio-total");a.divObservaciones=$(".div-observaciones");a.txtObservaciones=$(".text-observaciones");a.lblNota=$(".lbl-nota");a.txtCantidadAMostrar=$(".textbox-cantidad-a-mostrar");a.chkCantidadAMostrar=$(".checkbox-cantidad-a-mostrar");a.divCantidadAMostrar=$(".div-cantidad-a-mostrar");a.divCantidadAMostrar.hide();a.divReplacePreviousOrders=$(".div-replace-previous-orders");a.chkReplacePreviousOrders=$(".checkbox-replace-previous-orders");a.divCancelInDisconnection=$(".div-cancel-in-disconnection");a.chkCancelInDisconnection=$(".checkbox-cancel-in-disconnection");a.btnContinuar=$(".btn-continuar");var b=[{value:Core.Enums.eEspeciesTipoOperacion.Venta,text:"Venta en mercado secundario"},{value:Core.Enums.eEspeciesTipoOperacion.Compra,text:"Compra en mercado secundario"}];if(a.pageOptions&&a.pageOptions.puedeLicitar>0){b.push({value:Core.Enums.eEspeciesTipoOperacion.Licitacion,text:"Licitación"});b.push({value:Core.Enums.eEspeciesTipoOperacion.Renovacion,text:"Renovación"})}a.ddlTipoOperacion.shieldDropDown({dataSource:{data:b},textTemplate:"{text}",valueTemplate:"{value}",value:a.defaultTipoOperacion.toString(),events:{select:function(c){a.clearControls(true);a.setControlsByTipoOperacion(c.item.value);a.setEspecieByTipoOperacion(c.item.value,function(){a.loadControlsByEspecie()});a.setDisponible(c.item.value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem());Core.Functions.Operar.setColorByTipoOperacion(c.item.value,a.divMain,a.divCuenta)}}});a.ddlMoneda.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{idMoneda}",events:{select:function(c){a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem())}}});a.ddlEspecie.shieldComboBox({dataSource:{data:[]},valueTemplate:"{ticker}",value:a.defaultEspecie,textTemplate:"{ticker} | {Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"ticker",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}},events:{select:function(c){if(c.index>=0){a.clearControls(false);if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta||a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra){Core.Functions.Operar.setLabelsByEspecie(a.ddlEspecie,a.ddlPlazo.swidget().selectedItem().value,a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(d){a.ultimaCotizacion=d;if(a.operarOptions.operarFIX){Core.Functions.Operar.setControlsOperarFix(a.ultimaCotizacion,a.ddlTipoOrden,a.ddlVencimientoOrden,a.divOperarFix,a.divReplacePreviousOrders,a.divCancelInDisconnection,a.loaded,function(){a.setControlsByVencimientoOrden();a.setControlsByTipoOrden()})}})}else{a.loadMonedas();a.lblNota.hide();if(a.ddlEspecie.swidget().selectedItem()&&a.ddlEspecie.swidget().selectedItem().Nota){a.lblNota.text(a.ddlEspecie.swidget().selectedItem().Nota);a.lblNota.show()}if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Licitacion){a.lblMontoLicitar.text((a.ddlEspecie.swidget().selectedItem()&&a.ddlEspecie.swidget().selectedItem().Rotulo)?a.ddlEspecie.swidget().selectedItem().Rotulo:"Monto a Licitar");a.txtMontoLicitar.attr("placeholder",(a.ddlEspecie.swidget().selectedItem()&&a.ddlEspecie.swidget().selectedItem().Rotulo)?a.ddlEspecie.swidget().selectedItem().Rotulo:"Monto a Licitar")}if(a.ddlEspecie.swidget().selectedItem()&&a.ddlEspecie.swidget().selectedItem().TipoNegociacion&&a.ddlEspecie.swidget().selectedItem().TipoNegociacion!=""){a.lblValorNegociacion.text(a.ddlEspecie.swidget().selectedItem().TipoNegociacion);a.txtValorNegociacion.attr("placeholder","Ingrese "+a.ddlEspecie.swidget().selectedItem().TipoNegociacion.toLowerCase());a.txtValorNegociacion.attr("max-decimal-digit-count",a.ddlEspecie.swidget().selectedItem().Decimales.toString());a.txtValorNegociacion.maxDecimalDigitCount=a.ddlEspecie.swidget().selectedItem().Decimales;a.divValorNegociacion.show()}else{a.divValorNegociacion.hide()}}a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem())}}}});a.ddlRenovar.shieldDropDown({dataSource:{data:[]},textTemplate:"{ticker} ({Cantidad}) | {Descripcion}",valueTemplate:"{ticker}",events:{select:function(c){a.loadEspeciesByRenovacion(a.ddlTipoOperacion.swidget().selectedItem().value,function(){})}}});a.ddlPlazo.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",value:a.defaultPlazo.toString(),events:{select:function(c){a.clearControls(true);a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,c.item.value,a.ddlEspecie.swidget().selectedItem());a.setEspecieByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,function(){a.loadControlsByEspecie()});if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta||a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra){Core.Functions.Operar.setLabelsByEspecie(a.ddlEspecie,a.ddlPlazo.swidget().selectedItem().value,a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(d){a.ultimaCotizacion=d;Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))})}}}});Core.Functions.Operar.setPlazos(a.ddlPlazo,a.pageOptions.plazosHabilitados);a.ddlTipoOrden.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{Valor}",events:{select:function(c){a.setControlsByTipoOrden()}}});a.ddlVencimientoOrden.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{Valor}",events:{select:function(c){a.setControlsByVencimientoOrden()}}});new Core.Controls.DecimalPicker(a.txtPrecioStop,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta||a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra){Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))}}});a.txtFechaVencimiento.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date()});new Core.Controls.DecimalPicker(a.txtValorCantidad,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta||a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra){Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))}},defaultValue:a.defaultValorCantidad});new Core.Controls.DecimalPicker(a.txtMontoLicitar,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:""});new Core.Controls.DecimalPicker(a.txtValorNegociacion,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",enabledZero:true});new Core.Controls.DecimalPicker(a.txtValorPrecio,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta||a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra){Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))}},defaultValue:a.defaultValorLimite});a.chkCantidadAMostrar.shieldCheckBox({label:"Difusión Parcial / Iceberg",events:{click:function(c){a.divCantidadAMostrar.hide();if(a.chkCantidadAMostrar.swidget().checked()){a.divCantidadAMostrar.show()}}}});new Core.Controls.DecimalPicker(a.txtCantidadAMostrar,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:""});a.chkReplacePreviousOrders.shieldCheckBox({label:"Reemplazar órdenes previas"});a.chkCancelInDisconnection.shieldCheckBox({label:"Cancelar orden ante desconexión"});a.txtObservaciones.shieldTextBox({});if(Core.Objects.Context.Configuration.idAplicacion==1){a.divObservaciones.hide()}a.btnContinuar.click(function(){a.btnContinuarClick()})};a.loadControlsByEspecie=function(){if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra||a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta){if(a.ddlEspecie.swidget().selectedItem()){Core.Functions.Operar.setLabelsByEspecie(a.ddlEspecie,a.ddlPlazo.swidget().selectedItem().value,a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(c){a.ultimaCotizacion=c;if(a.operarOptions.operarFIX){Core.Functions.Operar.setControlsOperarFix(a.ultimaCotizacion,a.ddlTipoOrden,a.ddlVencimientoOrden,a.divOperarFix,a.divReplacePreviousOrders,a.divCancelInDisconnection,a.loaded,function(){a.setControlsByVencimientoOrden();a.setControlsByTipoOrden()})}})}else{if(a.defaultEspecie!=""){var b=new Core.Controls.Dialog("Aviso","No posee la Especie "+a.defaultEspecie+".",{displayButtons:{close:true,accept:false}}).show();a.clearControls(true)}}}};a.loadControls=function(){a.divDisponible.hide();Core.Functions.Operar.setComitente(a.lblCuenta,a.header.selectedIdAccount,a.loaded);var b=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,requestUrl:"detalledisponible/"+encodeURIComponent(a.header.selectedIdAccount),requestType:"GET",requestData:{Fecha:Core.Functions.Date.getDateAsString(new Date())}});b.onSuccess=function(c){a.detalleDisponible=c;a.setControlsByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value);a.setEspecieByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,function(){a.loadControlsByEspecie();var e=a.ddlEspecie.swidget().selectedItem();a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,(e)?e:null);Core.Functions.Operar.setColorByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.divMain,a.divCuenta);if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra&&a.defaultValorCantidad!=""&&a.defaultValorLimite!=""&&e){var d=Math.floor((a.disponibleActual/a.defaultValorLimite));if(d<a.defaultValorCantidad){if(d<0){a.txtValorCantidad.val("")}else{a.txtValorCantidad.val(d)}}}if(a.ddlEspecie.swidget().selectedItem()&&a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta&&a.defaultValorCantidad!=""){if(a.ddlEspecie.swidget().selectedItem().Cantidad<a.defaultValorCantidad){a.txtValorCantidad.val(a.ddlEspecie.swidget().selectedItem().Cantidad)}else{a.txtValorCantidad.val(a.defaultValorCantidad)}}Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))})};b.request()};a.setDisponible=function(g,e,c){a.divDisponible.hide();if(g==Core.Enums.eEspeciesTipoOperacion.Compra&&e!=null&&c!=null){a.disponibleActual=Core.Functions.Operar.setDisponible(a.detalleDisponible.disponible,c.idMoneda,e,a.lblDisponible,a.divDisponible)}else{if(c!=null&&g==Core.Enums.eEspeciesTipoOperacion.Licitacion){var d=(a.ddlMoneda.swidget().selectedItem())?a.ddlMoneda.swidget().selectedItem().idMoneda:null;var b=$.grep(a.detalleDisponible.disponible,function(i,h){return i.idMoneda==d})[0];var f=-1;if(c.FechaCierre==b.FechaCI){f=Core.Enums.ePlazo.CI}else{if(c.FechaCierre==b.Fecha24){f=Core.Enums.ePlazo.D24}else{if(c.FechaCierre==b.Fecha48){f=Core.Enums.ePlazo.D48}else{if(c.FechaCierre==b.Fecha72){f=Core.Enums.ePlazo.D72}}}}if(d!=null){a.disponibleActual=Core.Functions.Operar.setDisponible(a.detalleDisponible.disponible,d,f,a.lblDisponible,a.divDisponible)}}}};a.btnContinuarClick=function(){var f={value:true};if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta||a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra){Core.Functions.Validations.getValidatedDropDownValue(a.ddlEspecie,f);var e={idCuenta:a.header.selectedIdAccount,FechaVencimiento:Core.Functions.Date.getDateAsString(new Date()),idTipoOperacion:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,f),ticker:(a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().Ticker:null,Plazo:Core.Functions.Validations.getValidatedDropDownValue(a.ddlPlazo,f),idMoneda:(a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().idMoneda:null,Cantidad:Core.Functions.Validations.getValidatedNumericInputValue(a.txtValorCantidad,f),Monto:null,PrecioDisparo:null,Observaciones:a.txtObservaciones.val()};if(a.operarOptions.operarFIX&&a.ddlTipoOrden.swidget().selectedItem()&&a.ddlVencimientoOrden.swidget().selectedItem()){e.OrderType=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOrden,f);e.TimeInForce=Core.Functions.Validations.getValidatedDropDownValue(a.ddlVencimientoOrden,f);if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){e.PrecioDisparo=Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecioStop,f)}if(a.ddlVencimientoOrden.swidget().value()==a.eVencimientoOrden.GoodTillDate){var b=new Date();b.setHours(0,0,0,0);var d=((a.txtFechaVencimiento.swidget().value())?a.txtFechaVencimiento.swidget().value():new Date());d.setHours(0,0,0,0);e.FechaVencimiento=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaVencimiento,f));if(b.getTime()>d.getTime()){f.value=false;Core.Functions.Validations.toggleValidation(a.txtFechaVencimiento,true)}}if(a.chkCantidadAMostrar.swidget().checked()){e.DisplayQty=Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidadAMostrar,f);if(f.value&&(parseFloat(e.DisplayQty)<0||parseFloat(e.DisplayQty)>=parseFloat(e.Cantidad))){f.value=false;var c=new Core.Controls.Dialog("Aviso","La cantidad a mostrar debe ser positiva y menor a los nominales ingresados ",{displayButtons:{close:true,accept:false}}).show()}}}if(a.divReplacePreviousOrders.is(":visible")&&a.chkReplacePreviousOrders.swidget().checked()){e.ExecInst="x"}if(a.divCancelInDisconnection.is(":visible")&&a.chkCancelInDisconnection.swidget().checked()){if(e.ExecInst){e.ExecInst+=" o"}else{e.ExecInst="o"}}if(!a.ddlTipoOrden.swidget().selectedItem()||(a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.Market&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.MarketWithLeftOverAsLimit&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.StopMerval&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.Stop&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.MarketIfTouched)){e.PrecioLimite=Core.Functions.Validations.getValidatedNumericInputValue(a.txtValorPrecio,f)}if(f.value){Core.Functions.Operar.srOperarEspeciesValidaciones(a.txtValorCantidad,f)}if(!f.value){return}Core.Functions.Operar.srOperarEspecies(e,function(){Core.Functions.Operar.refreshDisponible(a.detalleDisponible,function(){a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem())},a.header.selectedIdAccount,a.loaded)},a.header.selectedIdAccount,a.idDefaultProfile,a.loaded)}else{Core.Functions.Validations.getValidatedDropDownValue(a.ddlEspecie,f);var e={idCuenta:a.header.selectedIdAccount,idLicitacion:(a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().idLicitacion:null,idTipoOperacion:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,f),ticker:(a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().ticker:null,Observaciones:a.txtObservaciones.val()};if(a.ddlEspecie.swidget().selectedItem()){e.idTipoNegociacion=a.ddlEspecie.swidget().selectedItem().idTipoNegociacion;if(a.ddlEspecie.swidget().selectedItem().TipoNegociacion&&a.ddlEspecie.swidget().selectedItem().TipoNegociacion!=""){e.ValorNegociacion=Core.Functions.Validations.getValidatedNoEmptyNumericInputValue(a.txtValorNegociacion,f)}}if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Renovacion){e.tickerRenovacion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlRenovar,f);e.Cantidad=Core.Functions.Validations.getValidatedNumericInputValue(a.txtValorCantidad,f);if(f.value){Core.Functions.Operar.srOperarEspeciesValidaciones(a.txtValorCantidad,f)}}else{e.idMoneda=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMoneda,f);e.Monto=Core.Functions.Validations.getValidatedNumericInputValue(a.txtMontoLicitar,f);if(f.value){Core.Functions.Operar.srOperarEspeciesValidaciones(a.txtMontoLicitar,f)}}if(!f.value){return}Core.Functions.Operar.srOperarLicitacion(e,function(){Core.Functions.Operar.refreshDisponible(a.detalleDisponible,function(){a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem())},a.header.selectedIdAccount,a.loaded)},a.header.selectedIdAccount,a.idDefaultProfile)}};a.setControlsByTipoOperacion=function(b){a.divPlazo.hide();a.divMoneda.hide();a.divRenovar.hide();a.divCotizacion.hide();a.divPrecio.hide();a.divTotal.hide();a.divMontoLicitar.hide();a.divValorNegociacion.hide();a.divCantidad.hide();a.lblNota.hide();a.divOperarFix.hide();if(b==Core.Enums.eEspeciesTipoOperacion.Venta||b==Core.Enums.eEspeciesTipoOperacion.Compra){a.divPlazo.show();a.divCotizacion.show();a.divPrecio.show();a.divTotal.show();a.divCantidad.show();a.lblCantidad.text("Cantidad de nominales");a.txtValorCantidad.attr("placeholder","Ingrese la cantidad")}else{if(b==Core.Enums.eEspeciesTipoOperacion.Renovacion){a.divRenovar.show();a.lblCantidad.text("Nominales a renovar");a.txtValorCantidad.attr("placeholder","Ingrese los nominales");a.divCantidad.show()}else{if(b==Core.Enums.eEspeciesTipoOperacion.Licitacion){a.divMontoLicitar.show();a.divMoneda.show()}}}};a.setEspecieByTipoOperacion=function(e,b){var c={};c.panel=Core.Enums.ePanel.Letes;if(e==Core.Enums.eEspeciesTipoOperacion.Venta||e==Core.Enums.eEspeciesTipoOperacion.Compra){if(e==Core.Enums.eEspeciesTipoOperacion.Venta){c.idCuenta=a.header.selectedIdAccount;c.plazo=a.ddlPlazo.swidget().selectedItem().value}var d=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,allowCache:e==Core.Enums.eEspeciesTipoOperacion.Compra,secureRequest:true,requestUrl:"especies",requestType:"GET",requestData:c});d.onSuccess=function(f){a.loadEspecies(e,f.especies,b)};d.request()}else{c.idCuenta=a.header.selectedIdAccount;if(e==Core.Enums.eEspeciesTipoOperacion.Renovacion){c.renovar=1}var d=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"licitacion/detalle",requestType:"POST",requestData:c});d.onSuccess=function(f){a.instrumentos=f.instrumentos?f.instrumentos:[];a.renovaciones=f.renovaciones?f.renovaciones:[];if(e==Core.Enums.eEspeciesTipoOperacion.Renovacion){a.loadRenovaciones(e,f.renovaciones,b)}else{a.loadEspecies(e,f.instrumentos,b)}};d.request()}};a.loadEspecies=function(e,b,c){var d=a.ddlEspecie.swidget().initialOptions;d.dataSource.data=b;if(e==Core.Enums.eEspeciesTipoOperacion.Venta){d.textTemplate="{DisplayTicker} ({Cantidad}) | {Descripcion}";d.valueTemplate="{DisplayTicker}"}else{if(e==Core.Enums.eEspeciesTipoOperacion.Compra){d.textTemplate="{DisplayTicker} {Descripcion}";d.valueTemplate="{DisplayTicker}"}else{d.textTemplate="{ticker} | {Descripcion}";d.valueTemplate="{ticker}"}}a.ddlEspecie.swidget().refresh(d);if(c){c()}};a.loadRenovaciones=function(e,b,c){var d=a.ddlRenovar.swidget().initialOptions;d.dataSource.data=b;a.ddlRenovar.swidget().refresh(d);a.loadEspeciesByRenovacion(e,c)};a.loadEspeciesByRenovacion=function(d,c){var b=a.ddlRenovar.swidget().selectedItem()?$.grep(a.instrumentos,function(f,e){return f.idLicitacion==a.ddlRenovar.swidget().selectedItem().idLicitacion}):[];a.loadEspecies(d,b,c)};a.loadMonedas=function(){var b=[];b=(a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().monedas:[];var c=a.ddlMoneda.swidget().initialOptions;c.dataSource.data=b;a.ddlMoneda.swidget().refresh(c)};a.setControlsByVencimientoOrden=function(){if(a.ddlVencimientoOrden.swidget().value()==a.eVencimientoOrden.GoodTillDate){a.divFechaVencimiento.show()}else{a.txtFechaVencimiento.swidget().value(new Date());a.divFechaVencimiento.hide()}};a.setControlsByTipoOrden=function(){if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){a.divPrecioStop.show()}else{a.txtPrecioStop.val("");a.divPrecioStop.hide()}a.txtValorPrecio.removeAttr("disabled");if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Market||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketWithLeftOverAsLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){a.txtValorPrecio.val("");a.txtValorPrecio.attr("disabled","disabled");Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))}};a.getPrecio=function(){if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Market||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketWithLeftOverAsLimit){if(a.ultimaCotizacion){if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra){return a.ultimaCotizacion.Cotizacion.PrecioVenta}else{return a.ultimaCotizacion.Cotizacion.PrecioCompra}}else{return null}}else{if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){return a.txtPrecioStop.val()}else{return a.txtValorPrecio.val()}}};a.clearControls=function(b){if(b){a.ddlEspecie.swidget().refresh();a.ddlRenovar.swidget().refresh();a.ddlMoneda.swidget().refresh();a.lblUltimoPrecio.text("");a.lblVariacion.text("");a.lblMejorOfertaCompra.text("");a.lblMejorOfertaVenta.text("")}a.lblMontoLicitar.text("Seleccione la Especie");a.txtMontoLicitar.attr("placeholder","Seleccione la Especie");a.txtValorCantidad.val("");a.txtValorPrecio.val("");a.lblTotal.text("");a.txtObservaciones.val("");a.ddlTipoOrden.swidget().refresh();a.ddlVencimientoOrden.swidget().refresh();a.txtPrecioStop.val("");a.txtCantidadAMostrar.val("");a.txtFechaVencimiento.swidget().refresh();a.ultimaCotizacion=null}};Core.Business.Operar.Licitaciones=new function(){var a=this;a.id="licitaciones";a.loaded=false;a.detalleDisponible=null;a.idDefaultAccount=null;a.idDefaultProfile=null;a.decimalCount=6;a.divMain=null;a.divCuenta=null;a.ddlTipoOperacion=null;a.ddlLicitacion=null;a.divMoneda=null;a.ddlMoneda=null;a.divRenovar=null;a.ddlRenovar=null;a.divEspecie=null;a.ddlEspecie=null;a.lblCuenta=null;a.divDisponible=null;a.lblDisponible=null;a.divCantidad=null;a.txtValorCantidad=null;a.divMontoLicitar=null;a.lblMontoLicitar=null;a.txtMontoLicitar=null;a.divValorNegociacion=null;a.lblValorNegociacion=null;a.txtValorNegociacion=null;a.divOperarPrecarga=null;a.divFechaEjecucion=null;a.ddlMinutosEjecucion=null;a.txtFechaEjecucion=null;a.ddlHoraEjecucion=null;a.divFechaExpiracion=null;a.ddlMinutosExpiracion=null;a.txtFechaExpiracion=null;a.ddlHoraExpiracion=null;a.btnAyudaEjecutarValidaciones=null;a.chkEjecutarValidaciones=null;a.chkContinuarAutomaticamente=null;a.divObservaciones=null;a.txtObservaciones=null;a.lblNota=null;a.btnContinuar=null;a.defaultTipoOperacion=null;a.defaultLicitacion=null;a.defaultEspecie=null;a.defaultValorCantidad=null;a.disponibleActual=null;a.pageOptions=null;a.operarOptions=null;a.renovaciones=[];a.instrumentos=[];a.licitaciones=[];a.ordenPrecargada=null;a.init=function(d,e,f){if(Core.Objects.Accounts){var b=$.grep(Core.Objects.Accounts,function(h,g){return h.idCuenta==d})[0];if(b.NumComitente==""){return}}a.idDefaultAccount=d;a.idDefaultProfile=e;a.defaultTipoOperacion=Core.Enums.eEspeciesTipoOperacion.Venta;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[e]);a.operarOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu("operar",Core.Objects.Context.Profiles[e]);a.defaultEspecie="";a.defaultValorCantidad="";a.defaultLicitacion="";a.ordenPrecargada=null;$.extend(true,a,f);if(Core.Objects.Context.TieneC4D==1){Core.loadPage("operar-licitaciones.html",function(){document.title="Operar Licitaciones";a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,d,e,function(){var g=$.grep(Core.Objects.Accounts,function(i,h){return i.idCuenta==a.header.selectedIdAccount})[0];if(g.NumComitente==""){Core.Business.PosicionConsolidada.init(a.header.selectedIdAccount,a.idDefaultProfile);return}a.loaded=false;a.loadControls()},"Core.Business.Operar.Licitaciones")})}else{var c=new Core.Controls.Dialog("Aviso","<p>Para poder Operar debe generar el código de operación de cuatro dígitos desde Configuración de Cuenta.<br/> <a onclick=\"$('.close-btn').click(); Core.Business.AccountSettings.init("+d+", "+e+');">Haga Click Aquí para ir a Configuración de Cuenta.</a></p>',{displayButtons:{close:true,accept:false}}).show()}};a.initControls=function(){a.divMain=$(".div-main");a.divCuenta=$(".div-cuenta");a.ddlTipoOperacion=$(".dropdown-tipo-operacion");a.ddlLicitacion=$(".dropdown-licitacion");a.ddlMoneda=$(".dropdown-moneda");a.divMoneda=$(".div-moneda");a.ddlRenovar=$(".dropdown-renovar");a.divRenovar=$(".div-renovar");a.ddlEspecie=$(".dropdown-especie");a.divEspecie=$(".div-especie");a.lblCuenta=$(".label-cuenta");a.divDisponible=$(".div-disponible");a.lblDisponible=$(".label-disponible");a.divCantidad=$(".div-cantidad");a.txtValorCantidad=$(".textbox-cantidad");a.divMontoLicitar=$(".div-monto-licitar");a.lblMontoLicitar=$(".lbl-monto-licitar");a.txtMontoLicitar=$(".textbox-monto-licitar");a.divValorNegociacion=$(".div-valor-negociacion");a.lblValorNegociacion=$(".lbl-valor-negociacion");a.txtValorNegociacion=$(".textbox-valor-negociacion");a.divObservaciones=$(".div-observaciones");a.txtObservaciones=$(".text-observaciones");a.divSeleccionPrecarga=$(".div-seleccion-precarga");a.divSeleccionPrecarga.hide();if(a.pageOptions&&a.pageOptions.precargar){a.divSeleccionPrecarga.show()}a.btnPrecarga=$(".btn-precarga");a.btnNormal=$(".btn-normal");a.divOperarPrecarga=$(".div-operar-precarga");a.divFechaEjecucion=$(".div-fecha-ejecucion");a.ddlMinutosEjecucion=$(".dropdown-minutos-ejecucion");a.txtFechaEjecucion=$(".date-fecha-ejecucion");a.ddlHoraEjecucion=$(".dropdown-hora-ejecucion");a.divFechaExpiracion=$(".div-fecha-expiracion");a.ddlMinutosExpiracion=$(".dropdown-minutos-expiracion");a.txtFechaExpiracion=$(".date-fecha-expiracion");a.ddlHoraExpiracion=$(".dropdown-hora-expiracion");a.btnAyudaEjecutarValidaciones=$(".btn-ayuda-ejecutar-validaciones");a.chkEjecutarValidaciones=$(".checkbox-ejecutar-validaciones");a.chkContinuarAutomaticamente=$(".checkbox-continuar-automaticamente");a.lblNota=$(".lbl-nota");a.btnContinuar=$(".btn-continuar");var e=[];e.push({value:Core.Enums.eEspeciesTipoOperacion.Licitacion,text:"Licitar"});e.push({value:Core.Enums.eEspeciesTipoOperacion.Renovacion,text:"Renovación"});a.ddlTipoOperacion.shieldDropDown({dataSource:{data:e},textTemplate:"{text}",valueTemplate:"{value}",value:(a.ordenPrecargada?a.ordenPrecargada.idTipoOperacion.toString():a.defaultTipoOperacion.toString()),events:{select:function(f){a.clearControls(true);Core.Functions.Operar.setColorByTipoOperacion(f.item.value,a.divMain,a.divCuenta);a.setDisponible();a.loadControlsByTipoOperacion(function(){})}}});a.ddlLicitacion.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{Licitacion}",value:(a.ordenPrecargada?a.ordenPrecargada.idLicitacion.toString():a.defaultLicitacion.toString()),events:{select:function(f){a.loadControlsByLicitacion()}}});a.ddlRenovar.shieldDropDown({dataSource:{data:[]},textTemplate:"{ticker} ({Cantidad}) | {Descripcion}",valueTemplate:"{ticker}",value:(a.ordenPrecargada?a.ordenPrecargada.tickerRenovacion:"")});a.ddlEspecie.shieldComboBox({dataSource:{data:[]},valueTemplate:"{ticker}",value:(a.ordenPrecargada?a.ordenPrecargada.DisplayTicker:a.defaultEspecie),textTemplate:"{ticker} | {Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"ticker",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}},events:{select:function(f){a.loadControlsByEspecie()}}});a.ddlMoneda.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{idMoneda}",value:(a.ordenPrecargada?a.ordenPrecargada.idMoneda.toString():""),events:{select:function(f){a.setDisponible()}}});new Core.Controls.DecimalPicker(a.txtValorCantidad,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",defaultValue:(a.ordenPrecargada?a.ordenPrecargada.Cantidad:a.defaultValorCantidad)});new Core.Controls.DecimalPicker(a.txtMontoLicitar,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",defaultValue:(a.ordenPrecargada?(a.ordenPrecargada.Monto?a.ordenPrecargada.Monto:a.ordenPrecargada.Cantidad):0)});new Core.Controls.DecimalPicker(a.txtValorNegociacion,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",enabledZero:true,defaultValue:(a.ordenPrecargada?a.ordenPrecargada.ValorNegociacion:"")});a.divOperarPrecarga.hide();a.btnNormal.on("click",function(){a.divOperarPrecarga.hide()});a.btnPrecarga.on("click",function(){a.divOperarPrecarga.show()});var b=[];for(var c=10;c<=18;c++){for(var d=0;d<=55;d=d+5){b.push({value:(c.padLeft(2,"0")+":"+d.padLeft(2,"0"))})}}a.ddlMinutosEjecucion.shieldDropDown({dataSource:{data:[{value:0,text:"Ahora"},{value:10,text:"En 10 minutos"},{value:30,text:"En 30 minutos"},{value:60,text:"En 1 hora"},{value:-1,text:"Otro"}]},textTemplate:"{text}",valueTemplate:"{value}",value:(a.ordenPrecargada&&a.ordenPrecargada.MinutosEjecucion?a.ordenPrecargada.MinutosEjecucion.toString():(a.ordenPrecargada&&a.ordenPrecargada.FechaEjecucion?"-1":"0")),events:{select:function(f){Core.Functions.Operar.setControlsByMinutosEjecucion(a.ddlMinutosEjecucion,a.divFechaEjecucion)}}});a.txtFechaEjecucion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.ordenPrecargada?Core.Functions.Date.getDateByStringDisplayDate(a.ordenPrecargada.FechaEjecucion):new Date())});a.ddlHoraEjecucion.shieldDropDown({dataSource:{data:b},textTemplate:"{value}",valueTemplate:"{value}",value:(a.ordenPrecargada&&a.ordenPrecargada.FechaEjecucion?a.ordenPrecargada.FechaEjecucion.substr(11,5):"")});a.ddlMinutosExpiracion.shieldDropDown({dataSource:{data:[{value:10,text:"En 10 minutos"},{value:30,text:"En 30 minutos"},{value:60,text:"En 1 hora"},{value:360,text:"En 6 horas"},{value:-1,text:"Otro"}]},textTemplate:"{text}",valueTemplate:"{value}",value:(a.ordenPrecargada&&a.ordenPrecargada.MinutosExpiracion?a.ordenPrecargada.MinutosExpiracion.toString():(a.ordenPrecargada&&a.ordenPrecargada.FechaExpiracion?"-1":"360")),events:{select:function(f){Core.Functions.Operar.setControlsByMinutosExpiracion(a.ddlMinutosExpiracion,a.divFechaExpiracion)}}});a.txtFechaExpiracion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.ordenPrecargada?Core.Functions.Date.getDateByStringDisplayDate(a.ordenPrecargada.FechaExpiracion):new Date())});a.ddlHoraExpiracion.shieldDropDown({dataSource:{data:b},textTemplate:"{value}",valueTemplate:"{value}",value:(a.ordenPrecargada&&a.ordenPrecargada.FechaExpiracion?a.ordenPrecargada.FechaExpiracion.substr(11,5):"")});a.btnAyudaEjecutarValidaciones.on("click",function(){Core.Functions.Operar.showAyudaEjecutarValidaciones()});a.chkEjecutarValidaciones.shieldCheckBox({label:"Excluir validaciones",checked:(a.ordenPrecargada&&a.ordenPrecargada.EjecutarValidaciones)});a.chkContinuarAutomaticamente.shieldCheckBox({label:"Permitir al cliente modificar esta precarga",checked:(a.ordenPrecargada&&a.ordenPrecargada.ContinuarAutomaticamente)});a.txtObservaciones.shieldTextBox({value:(a.ordenPrecargada?a.ordenPrecargada.Observaciones:"")});if(Core.Objects.Context.Configuration.idAplicacion==1){a.divObservaciones.hide()}a.btnContinuar.click(function(){a.btnContinuarClick()})};a.loadControls=function(){a.divDisponible.hide();var b=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,requestUrl:"detalledisponible/"+encodeURIComponent(a.header.selectedIdAccount),requestType:"GET",requestData:{Fecha:Core.Functions.Date.getDateAsString(new Date())}});b.onSuccess=function(c){a.detalleDisponible=c;a.loadControlsByTipoOperacion(function(){Core.Functions.Operar.setComitente(a.lblCuenta,a.header.selectedIdAccount,a.loaded);Core.Functions.Operar.setColorByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.divMain,a.divCuenta);Core.Functions.Operar.setControlsByMinutosEjecucion(a.ddlMinutosEjecucion,a.divFechaEjecucion);Core.Functions.Operar.setControlsByMinutosExpiracion(a.ddlMinutosExpiracion,a.divFechaExpiracion)})};b.request()};a.setDisponible=function(){a.divDisponible.hide();if(a.ddlEspecie.swidget().selectedItem()&&a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Licitacion){var c=(a.ddlMoneda.swidget().selectedItem())?a.ddlMoneda.swidget().selectedItem().idMoneda:null;var b=$.grep(a.detalleDisponible.disponible,function(f,e){return f.idMoneda==c})[0];var d=-1;if(a.ddlEspecie.swidget().selectedItem().FechaCierre==b.FechaCI){d=Core.Enums.ePlazo.CI}else{if(a.ddlEspecie.swidget().selectedItem().FechaCierre==b.Fecha24){d=Core.Enums.ePlazo.D24}else{if(a.ddlEspecie.swidget().selectedItem().FechaCierre==b.Fecha48){d=Core.Enums.ePlazo.D48}else{if(a.ddlEspecie.swidget().selectedItem().FechaCierre==b.Fecha72){d=Core.Enums.ePlazo.D72}}}}if(c!=null){a.disponibleActual=Core.Functions.Operar.setDisponible(a.detalleDisponible.disponible,c,d,a.lblDisponible,a.divDisponible)}}};a.btnContinuarClick=function(){var c={value:true};var b={idCuenta:a.header.selectedIdAccount,idLicitacion:Core.Functions.Validations.getValidatedDropDownValue(a.ddlLicitacion,c),idTipoOperacion:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,c),ticker:Core.Functions.Validations.getValidatedDropDownValue(a.ddlEspecie,c),Observaciones:a.txtObservaciones.val()};if(a.ddlEspecie.swidget().selectedItem()){b.idTipoNegociacion=a.ddlEspecie.swidget().selectedItem().idTipoNegociacion;if(a.ddlEspecie.swidget().selectedItem().TipoNegociacion&&a.ddlEspecie.swidget().selectedItem().TipoNegociacion!=""){b.ValorNegociacion=Core.Functions.Validations.getValidatedNoEmptyNumericInputValue(a.txtValorNegociacion,c)}}if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Renovacion){b.tickerRenovacion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlRenovar,c);b.Cantidad=Core.Functions.Validations.getValidatedNumericInputValue(a.txtValorCantidad,c);if(c.value){Core.Functions.Operar.srOperarEspeciesValidaciones(a.txtValorCantidad,c)}}else{b.idMoneda=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMoneda,c);if(a.ddlEspecie.swidget().selectedItem()&&a.ddlEspecie.swidget().selectedItem().Rotulo=="Cantidad a Licitar"){b.Cantidad=Core.Functions.Validations.getValidatedNumericInputValue(a.txtMontoLicitar,c)}else{b.Monto=Core.Functions.Validations.getValidatedNumericInputValue(a.txtMontoLicitar,c);if(c.value){Core.Functions.Operar.srOperarEspeciesValidaciones(a.txtMontoLicitar,c)}}}if(a.ordenPrecargada){b.idOrdenPrecargada=a.ordenPrecargada.idOrdenPrecargada}if(a.divOperarPrecarga.is(":visible")){b.EsPrecarga=1;if(a.divFechaEjecucion.is(":visible")){b.FechaEjecucion=(Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaEjecucion,c))+" "+Core.Functions.Validations.getValidatedDropDownValue(a.ddlHoraEjecucion,c)+":00")}else{b.MinutosEjecucion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMinutosEjecucion,c)}if(a.divFechaExpiracion.is(":visible")){b.FechaExpiracion=(Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaExpiracion,c))+" "+Core.Functions.Validations.getValidatedDropDownValue(a.ddlHoraExpiracion,c)+":00")}else{b.MinutosExpiracion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMinutosExpiracion,c)}b.EjecutarValidaciones=a.chkEjecutarValidaciones.swidget().checked()?1:0;b.ContinuarAutomaticamente=a.chkContinuarAutomaticamente.swidget().checked()?0:1}if(!c.value){return}Core.Functions.Operar.srOperarLicitacion(b,function(){Core.Functions.Operar.refreshDisponible(a.detalleDisponible,function(){a.setDisponible()},a.header.selectedIdAccount,a.loaded)},a.header.selectedIdAccount,a.idDefaultProfile)};a.loadMonedas=function(){var b=[];b=(a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().monedas:[];var c=a.ddlMoneda.swidget().initialOptions;c.dataSource.data=b;a.ddlMoneda.swidget().refresh(c)};a.loadControlsByTipoOperacion=function(b){a.divMoneda.hide();a.divRenovar.hide();a.divMontoLicitar.hide();a.divValorNegociacion.hide();a.divCantidad.hide();a.lblNota.hide();if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Renovacion){a.divRenovar.show();a.divCantidad.show()}else{if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Licitacion){a.divMoneda.show();a.divMontoLicitar.show()}}var c={};c.idCuenta=a.header.selectedIdAccount;if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Renovacion){c.renovar=1}var d=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"licitacion/detalle",requestType:"POST",requestData:c});d.onSuccess=function(g){a.instrumentos=g.instrumentos?g.instrumentos:[];a.renovaciones=g.renovaciones?g.renovaciones:[];a.licitaciones=g.licitaciones?g.licitaciones:[];var f=a.ddlLicitacion.swidget().initialOptions;f.dataSource.data=a.licitaciones;var e=$.grep(a.licitaciones,function(i,h){return i.esDefault})[0];if(e){f.value=e.Licitacion.toString()}a.ddlLicitacion.swidget().refresh(f);a.loadControlsByLicitacion();b()};d.request()};a.loadControlsByLicitacion=function(){var b=a.ddlRenovar.swidget().initialOptions;b.dataSource.data=a.ddlLicitacion.swidget().selectedItem()?$.grep(a.renovaciones,function(d,c){return d.idLicitacion==a.ddlLicitacion.swidget().selectedItem().Licitacion}):[];a.ddlRenovar.swidget().refresh(b);var b=a.ddlEspecie.swidget().initialOptions;b.dataSource.data=a.ddlLicitacion.swidget().selectedItem()?$.grep(a.instrumentos,function(d,c){return d.idLicitacion==a.ddlLicitacion.swidget().selectedItem().Licitacion}):[];a.ddlEspecie.swidget().refresh(b);a.loadControlsByEspecie()};a.loadControlsByEspecie=function(){a.lblNota.hide();a.divValorNegociacion.hide();if(a.ddlEspecie.swidget().selectedItem()){a.clearControls(false);a.loadMonedas();if(a.ddlEspecie.swidget().selectedItem().Nota){a.lblNota.text(a.ddlEspecie.swidget().selectedItem().Nota);a.lblNota.show()}if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Licitacion){a.lblMontoLicitar.text((a.ddlEspecie.swidget().selectedItem()&&a.ddlEspecie.swidget().selectedItem().Rotulo)?a.ddlEspecie.swidget().selectedItem().Rotulo:"Monto a Licitar");a.txtMontoLicitar.attr("placeholder",(a.ddlEspecie.swidget().selectedItem()&&a.ddlEspecie.swidget().selectedItem().Rotulo)?a.ddlEspecie.swidget().selectedItem().Rotulo:"Monto a Licitar")}if(a.ddlEspecie.swidget().selectedItem().TipoNegociacion&&a.ddlEspecie.swidget().selectedItem().TipoNegociacion!=""){a.lblValorNegociacion.text(a.ddlEspecie.swidget().selectedItem().TipoNegociacion);a.txtValorNegociacion.attr("placeholder","Ingrese "+a.ddlEspecie.swidget().selectedItem().TipoNegociacion.toLowerCase());a.txtValorNegociacion.attr("max-decimal-digit-count",a.ddlEspecie.swidget().selectedItem().Decimales.toString());a.txtValorNegociacion.maxDecimalDigitCount=a.ddlEspecie.swidget().selectedItem().Decimales;a.divValorNegociacion.show()}}a.setDisponible()};a.clearControls=function(b){if(b){a.ddlRenovar.swidget().refresh();a.ddlEspecie.swidget().refresh();a.ddlMoneda.swidget().refresh()}a.lblMontoLicitar.text("Seleccione la Especie");a.txtMontoLicitar.attr("placeholder","Seleccione la Especie");a.txtValorCantidad.val("");a.txtObservaciones.val("")}};Core.Business.Operar.Monedas=new function(){var a=this;a.id="monedas";a.loaded=false;a.decimalCount=6;a.detalleDisponible=null;a.idDefaultAccount=null;a.idDefaultProfile=null;var b=10000;a.timerId=null;a.divMain=null;a.divCuenta=null;a.ddlTipoOperacion=null;a.txtCantidadNominales=null;a.lblPrecio=null;a.lblTotal=null;a.lblDisponible=null;a.divObservaciones=null;a.txtObservaciones=null;a.btnContinuar=null;a.defaultTipoOperacion=null;a.defaultCantidadNominales=null;a.precioActual=null;a.cotizacionActual=null;a.init=function(c,d,e){a.idDefaultAccount=c;a.idDefaultProfile=d;a.defaultTipoOperacion=Core.Enums.eEspeciesTipoOperacion.CompraMonedas;a.defaultCantidadNominales="";$.extend(true,a,e);a.cuentaCambio=null;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[a.idDefaultProfile]);if(a.pageOptions&&a.pageOptions.monedasBalanzCambio){a.cuentaCambio=$.grep(Core.Objects.Accounts,function(g,f){return g.NumCambio&&!g.NumComitente&&!g.NumCuotapartista})[0];if(a.cuentaCambio){a.initOperar()}else{a.verificarTyC()}}else{a.initOperar()}};a.verificarTyC=function(){var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"/terminos/verificartyc/balanzcambio",requestType:"GET"});c.onSuccess=function(d){a.divTerminosyCondiciones=$(".terminos-y-condiciones-cuenta-cambio");a.divAccept=a.divTerminosyCondiciones.find(".div-checkbox-accept");a.chkAccept=a.divTerminosyCondiciones.find(".checkbox-accept");a.btnTyC=a.divTerminosyCondiciones.find(".terminos-y-condiciones-link");a.btnConfirm=a.divTerminosyCondiciones.find(".btn-confirm");a.chkAccept[0].checked=d.Terminos?false:true;a.btnTyC.attr("href",d.Terminos?d.Terminos.urlTyC:"");a.divAccept.show();a.btnTyC.show();if(a.chkAccept[0].checked){a.divAccept.hide();a.btnTyC.hide()}a.btnConfirm.unbind("click");a.btnConfirm.click(function(){if(a.chkAccept[0].checked){if(d.Terminos){var e=new Core.Ajax.ServerRequest({overlayElement:a.divTerminosyCondiciones.find(".modal-body"),showOverlay:true,secureRequest:true,requestUrl:"terminos/aceptartyc",requestType:"POST",requestData:{idPersona:Core.Objects.Context.IdPersona,idTerminoYCondicion:d.Terminos.idTerminoYCondicion}});e.onSuccess=function(f){a.abrirCuentaCambio()};e.request()}else{a.abrirCuentaCambio()}}});a.divTerminosyCondiciones.modal({show:true})};c.request()};a.abrirCuentaCambio=function(){var c=new Core.Ajax.ServerRequest({overlayElement:a.divTerminosyCondiciones.find(".modal-body"),showOverlay:true,secureRequest:true,requestUrl:"/balanzcambio/abrircuenta",requestType:"POST"});c.onSuccess=function(d){var e=new Core.Ajax.ServerRequest({overlayElement:a.divTerminosyCondiciones.find(".modal-body"),showOverlay:true,secureRequest:true,requestUrl:"cuentas/"+encodeURIComponent(Core.Objects.Context.IdPersona),requestType:"GET"});e.onSuccess=function(f){a.divTerminosyCondiciones.modal("hide");Core.Objects.Accounts=f.cuentas;a.cuentaCambio=$.grep(Core.Objects.Accounts,function(h,g){return h.NumCambio&&!h.NumComitente&&!h.NumCuotapartista})[0];if(a.cuentaCambio){a.initOperar()}};e.request()};c.request()};a.initOperar=function(){if(Core.Objects.Context.TieneC4D==1){Core.loadPage("operar-monedas.html",function(){document.title="Operar Monedas";a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,a.idDefaultAccount,a.idDefaultProfile,function(){a.loaded=false;if(a.cuentaCambio){a.header.hideAccounts()}a.loadControls();a.loadPrecio();a.loaded=true},"Core.Business.Operar.Monedas");a.timerId=window.setInterval(function(){a.loadPrecio()},b);Core.Objects.Context.Timers.push(a.timerId)})}else{var c=new Core.Controls.Dialog("Aviso","<p>Para poder Operar debe generar el código de operación de cuatro dígitos desde Configuración de Cuenta.<br/> <a onclick=\"$('.close-btn').click(); Core.Business.AccountSettings.init("+a.idDefaultAccount+", "+a.idDefaultProfile+');">Haga Click Aquí para ir a Configuración de Cuenta.</a></p>',{displayButtons:{close:true,accept:false}}).show()}};a.initControls=function(){a.divMain=$(".div-main");a.divCuenta=$(".div-cuenta");a.ddlTipoOperacion=$(".dropdown-tipo-operacion");a.lblCuenta=$(".label-cuenta");a.divDisponible=$(".div-disponible");a.lblDisponible=$(".label-disponible");a.txtCantidadNominales=$(".textbox-cantidad-nominales");a.btnContinuar=$(".btn-continuar");a.divObservaciones=$(".div-observaciones");a.lblPrecio=$(".label-precio");a.lblTotal=$(".label-total");a.txtObservaciones=$(".text-observaciones");a.ddlTipoOperacion.shieldDropDown({dataSource:{data:[{value:Core.Enums.eEspeciesTipoOperacion.CompraMonedas,text:"Compra Dólares"},{value:Core.Enums.eEspeciesTipoOperacion.VentaMonedas,text:"Venta Dólares"}]},textTemplate:"{text}",valueTemplate:"{value}",value:a.defaultTipoOperacion.toString(),events:{select:function(c){Core.Functions.Operar.setDisponible(a.detalleDisponible.disponible,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.CompraMonedas)?Core.Enums.Currency.Pesos.idMoneda:Core.Enums.Currency.Dolares.idMoneda),Core.Enums.ePlazo.CI,a.lblDisponible,a.divDisponible);Core.Functions.Operar.setColorByTipoOperacion(c.item.value,a.divMain,a.divCuenta);a.precioActual=null;a.setPrecio()}}});new Core.Controls.DecimalPicker(a.txtCantidadNominales,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){a.setTotal()},defaultValue:a.defaultCantidadNominales});a.txtObservaciones.shieldTextBox({});if(Core.Objects.Context.Configuration.idAplicacion==1){a.divObservaciones.hide()}a.btnContinuar.click(function(){a.btnContinuarClick()})};a.loadControls=function(){if(!a.cuentaCambio){Core.Functions.Operar.setComitente(a.lblCuenta,a.header.selectedIdAccount,a.loaded)}else{a.lblCuenta.text("Cuenta Nº "+a.cuentaCambio.NumCambio+" | "+a.cuentaCambio.Descripcion)}var c=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,requestUrl:"detalledisponible/"+encodeURIComponent(a.cuentaCambio?a.cuentaCambio.idCuenta:a.header.selectedIdAccount),requestType:"GET",requestData:{Fecha:Core.Functions.Date.getDateAsString(new Date())}});c.onSuccess=function(d){a.detalleDisponible=d;Core.Functions.Operar.setDisponible(a.detalleDisponible.disponible,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.CompraMonedas)?Core.Enums.Currency.Pesos.idMoneda:Core.Enums.Currency.Dolares.idMoneda),Core.Enums.ePlazo.CI,a.lblDisponible,a.divDisponible);Core.Functions.Operar.setColorByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.divMain,a.divCuenta)};c.request()};a.btnContinuarClick=function(){var e={value:true};var c={idCuenta:(a.cuentaCambio?a.cuentaCambio.idCuenta:a.header.selectedIdAccount),idTipoOperacion:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,e),idMonedaInstrumento:2,Plazo:0,idMoneda:1,Cantidad:Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidadNominales,e),Monto:null,Observaciones:a.txtObservaciones.val()};if(!e.value){return}var d=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"operar/monedas/solicitud",requestType:"POST",requestData:c});d.onSuccess=function(j){var g="";if(a.cuentaCambio){g="Cuenta Nº "+a.cuentaCambio.NumCambio+" | "+a.cuentaCambio.Descripcion}else{g="Comitente N°"+j.NumComitente+" - "+j.DescripcionCuenta}var h="Por la presente declaro bajo juramento que:<br />(1) Las informaciones consignadas en la presente solicitud son exactas y verdaderas, en los términos previstos en el Régimen Penal Cambiario, del cual tengo pleno conocimiento de sus normas y sanciones.<br />(2) Me comprometo a indemnizar y mantener indemne a Balanz Capital Valores S.A.U. por cualquier reclamo, costo, gasto, multa y/o daños y perjuicios de cualquier clase o naturaleza en que pudiere incurrir en caso de que cualquier declaración y/o información realizada y aportada en el presente resultare falsa y/o inexacta. <br />(3) Al día de la fecha no me encuentro inhabilitado a operar en cambios en los términos de la normativa aplicable del B.C.R.A.";var i={data:j,idDefaultProfile:a.idDefaultProfile,terminosYCondiciones:j.Terminos,terminosYCondicionesDescripcion:"Acepto los nuevos términos y condiciones para la operatoria de Dólar Balanz",incluirDescripcionTerminoYCondicion:false,idAccount:(a.cuentaCambio?a.cuentaCambio.idCuenta:a.header.selectedIdAccount),idAccountToContinue:(a.cuentaCambio?a.idDefaultAccount:a.header.selectedIdAccount),generalTitle:"CONFIRMACION DE ORDEN",title:"Operación de Dólares",accountDescription:g,footerHtml:h,urlMethod:"operar/monedas/confirmar",codigo4DDescription:"Ingrese su código de operación de cuatro dígitos:",onConfirm:function(){Core.Functions.Operar.refreshDisponible(a.detalleDisponible,function(){Core.Functions.Operar.setDisponible(a.detalleDisponible.disponible,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.CompraMonedas)?Core.Enums.Currency.Pesos.idMoneda:Core.Enums.Currency.Dolares.idMoneda),Core.Enums.ePlazo.CI,a.lblDisponible,a.divDisponible)},(a.cuentaCambio?a.cuentaCambio.idCuenta:a.header.selectedIdAccount),a.loaded)}};var f=new Core.Controls.OperarConfirmation(i).show()};d.request()};a.loadPrecio=function(){var c=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"cotizacionmoneda/2",requestType:"GET"});c.onSuccess=function(d){if(d.Cotizacion!=null){a.cotizacionActual=d.Cotizacion}a.setPrecio()};c.request()};a.setPrecio=function(){var c;if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.CompraMonedas){c=(a.cotizacionActual&&a.cotizacionActual.PrecioVenta!=null)?a.cotizacionActual.PrecioVenta:null}else{c=(a.cotizacionActual&&a.cotizacionActual.PrecioCompra!=null)?a.cotizacionActual.PrecioCompra:null}if(c!=null){a.lblPrecio.text("$ "+c);if(a.precioActual!=null){if(c>a.precioActual){Core.Functions.Highlight(a.lblPrecio,{cssClass:"animation-green-pulse"})}else{if(c<a.precioActual){Core.Functions.Highlight(a.lblPrecio,{cssClass:"animation-red-pulse"})}}}a.btnContinuar.show()}else{a.lblPrecio.text("Cotización no disponible");a.btnContinuar.hide()}a.precioActual=c;a.setTotal()};a.setTotal=function(){if(a.precioActual!=null&&a.txtCantidadNominales.val()){var c=(a.precioActual.toFixed(2)*Core.Functions.Decimal.parseFloat(a.txtCantidadNominales.val()).toFixed(2)).toFixed(2);a.lblTotal.text("$ "+c)}else{a.lblTotal.text("")}};a.clearControls=function(){a.ddlTipoOperacion.swidget().selected(0,true);a.txtCantidadNominales.swidget().value("");a.txtObservaciones.val("")}};Core.Business.Operar.ObligacionesNegociables=new function(){var a=this;a.id="obligacionesnegociables";a.loaded=false;a.detalleDisponible=null;a.idDefaultAccount=null;a.idDefaultProfile=null;a.decimalCount=6;a.eVencimientoOrden={GoodTillDate:6};a.eTipoOrden={Market:1,Limit:2,StopMerval:3,StopLimit:4,Stop:"z",MarketWithLeftOverAsLimit:"K",MarketIfTouched:"J"};a.divMain=null;a.divCuenta=null;a.ddlTipoOperacion=null;a.divPlazo=null;a.ddlPlazo=null;a.divMoneda=null;a.ddlMoneda=null;a.divRenovar=null;a.ddlRenovar=null;a.divEspecie=null;a.ddlEspecie=null;a.lblCuenta=null;a.divDisponible=null;a.lblDisponible=null;a.divCotizacion=null;a.lblUltimoPrecio=null;a.lblVariacion=null;a.lblMejorOfertaCompra=null;a.lblMejorOfertaVenta=null;a.divOperarFix=null;a.divReplacePreviousOrders=null;a.chkReplacePreviousOrders=null;a.divCancelInDisconnection=null;a.chkCancelInDisconnection=null;a.divTipoOrden=null;a.ddlTipoOrden=null;a.divVencimientoOrden=null;a.ddlVencimientoOrden=null;a.divPrecioStop=null;a.txtPrecioStop=null;a.divFechaVencimiento=null;a.txtFechaVencimiento=null;a.divCantidad=null;a.txtValorCantidad=null;a.lblCantidad=null;a.divMontoLicitar=null;a.lblMontoLicitar=null;a.txtMontoLicitar=null;a.divValorNegociacion=null;a.lblValorNegociacion=null;a.txtValorNegociacion=null;a.divPrecio=null;a.txtValorPrecio=null;a.divTotal=null;a.lblTotal=null;a.chkCantidadAMostrar=null;a.txtCantidadAMostrar=null;a.divCantidadAMostrar=null;a.divOperarPrecarga=null;a.divFechaEjecucion=null;a.ddlMinutosEjecucion=null;a.txtFechaEjecucion=null;a.ddlHoraEjecucion=null;a.divFechaExpiracion=null;a.ddlMinutosExpiracion=null;a.txtFechaExpiracion=null;a.ddlHoraExpiracion=null;a.btnAyudaEjecutarValidaciones=null;a.chkEjecutarValidaciones=null;a.chkContinuarAutomaticamente=null;a.divObservaciones=null;a.txtObservaciones=null;a.lblNota=null;a.btnContinuar=null;a.defaultTipoOperacion=null;a.defaultEspecie=null;a.defaultValorCantidad=null;a.defaultValorLimite=null;a.defaultPlazo=null;a.disponibleActual=null;a.pageOptions=null;a.operarOptions=null;a.ultimaCotizacion=null;a.renovaciones=[];a.instrumentos=[];a.ordenPrecargada=null;a.init=function(d,e,f){if(Core.Objects.Accounts){var b=$.grep(Core.Objects.Accounts,function(h,g){return h.idCuenta==d})[0];if(b.NumComitente==""){return}}a.idDefaultAccount=d;a.idDefaultProfile=e;a.defaultTipoOperacion=Core.Enums.eEspeciesTipoOperacion.Venta;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[e]);a.operarOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu("operar",Core.Objects.Context.Profiles[e]);a.defaultEspecie="";a.defaultValorCantidad="";a.defaultValorLimite="";a.defaultPlazo=a.pageOptions.plazoDefault;a.ordenPrecargada=null;$.extend(true,a,f);if(Core.Objects.Context.TieneC4D==1){Core.loadPage("operar-ons.html",function(){document.title="Operar Obligaciones Negociables";a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,d,e,function(){var g=$.grep(Core.Objects.Accounts,function(i,h){return i.idCuenta==a.header.selectedIdAccount})[0];if(g.NumComitente==""){Core.Business.PosicionConsolidada.init(a.header.selectedIdAccount,a.idDefaultProfile);return}a.loaded=false;a.loadControls()},"Core.Business.Operar.ObligacionesNegociables")})}else{var c=new Core.Controls.Dialog("Aviso","<p>Para poder Operar debe generar el código de operación de cuatro dígitos desde Configuración de Cuenta.<br/> <a onclick=\"$('.close-btn').click(); Core.Business.AccountSettings.init("+d+", "+e+');">Haga Click Aquí para ir a Configuración de Cuenta.</a></p>',{displayButtons:{close:true,accept:false}}).show()}};a.initControls=function(){a.divMain=$(".div-main");a.divCuenta=$(".div-cuenta");a.ddlTipoOperacion=$(".dropdown-tipo-operacion");a.ddlPlazo=$(".dropdown-plazo");a.divPlazo=$(".div-plazo");a.ddlMoneda=$(".dropdown-moneda");a.divMoneda=$(".div-moneda");a.ddlRenovar=$(".dropdown-renovar");a.divRenovar=$(".div-renovar");a.ddlEspecie=$(".dropdown-especie");a.divEspecie=$(".div-especie");a.lblCuenta=$(".label-cuenta");a.divDisponible=$(".div-disponible");a.lblDisponible=$(".label-disponible");a.divCotizacion=$(".div-cotizacion");a.lblUltimoPrecio=$(".label-ultimo-precio");a.lblVariacion=$(".label-variacion");a.lblMejorOfertaCompra=$(".label-mejor-oferta-compra");a.lblMejorOfertaVenta=$(".label-mejor-oferta-venta");a.divOperarFix=$(".div-operar-fix");a.divOperarFix.hide();a.divTipoOrden=$(".div-tipo-orden");a.ddlTipoOrden=$(".dropdown-tipo-orden");a.divVencimientoOrden=$(".div-vencimiento-orden");a.ddlVencimientoOrden=$(".dropdown-vencimiento-orden");a.divPrecioStop=$(".div-precio-stop");a.txtPrecioStop=$(".textbox-precio-stop");a.divFechaVencimiento=$(".div-fecha-vencimiento");a.txtFechaVencimiento=$(".date-fecha-vencimiento");a.divCantidad=$(".div-cantidad");a.txtValorCantidad=$(".textbox-cantidad");a.lblCantidad=$(".lbl-cantidad");a.divMontoLicitar=$(".div-monto-licitar");a.lblMontoLicitar=$(".lbl-monto-licitar");a.txtMontoLicitar=$(".textbox-monto-licitar");a.divValorNegociacion=$(".div-valor-negociacion");a.lblValorNegociacion=$(".lbl-valor-negociacion");a.txtValorNegociacion=$(".textbox-valor-negociacion");a.divPrecio=$(".div-precio");a.txtValorPrecio=$(".textbox-precio");a.divTotal=$(".div-total");a.lblTotal=$(".label-precio-total");a.divObservaciones=$(".div-observaciones");a.txtObservaciones=$(".text-observaciones");a.txtCantidadAMostrar=$(".textbox-cantidad-a-mostrar");a.chkCantidadAMostrar=$(".checkbox-cantidad-a-mostrar");a.divCantidadAMostrar=$(".div-cantidad-a-mostrar");a.divCantidadAMostrar.hide();a.divReplacePreviousOrders=$(".div-replace-previous-orders");a.chkReplacePreviousOrders=$(".checkbox-replace-previous-orders");a.divCancelInDisconnection=$(".div-cancel-in-disconnection");a.chkCancelInDisconnection=$(".checkbox-cancel-in-disconnection");a.divSeleccionPrecarga=$(".div-seleccion-precarga");a.divSeleccionPrecarga.hide();a.btnPrecarga=$(".btn-precarga");a.btnNormal=$(".btn-normal");a.divOperarPrecarga=$(".div-operar-precarga");a.divFechaEjecucion=$(".div-fecha-ejecucion");a.ddlMinutosEjecucion=$(".dropdown-minutos-ejecucion");a.txtFechaEjecucion=$(".date-fecha-ejecucion");a.ddlHoraEjecucion=$(".dropdown-hora-ejecucion");a.divFechaExpiracion=$(".div-fecha-expiracion");a.ddlMinutosExpiracion=$(".dropdown-minutos-expiracion");a.txtFechaExpiracion=$(".date-fecha-expiracion");a.ddlHoraExpiracion=$(".dropdown-hora-expiracion");a.btnAyudaEjecutarValidaciones=$(".btn-ayuda-ejecutar-validaciones");a.chkEjecutarValidaciones=$(".checkbox-ejecutar-validaciones");a.chkContinuarAutomaticamente=$(".checkbox-continuar-automaticamente");a.lblNota=$(".lbl-nota");a.btnContinuar=$(".btn-continuar");var e=[{value:Core.Enums.eEspeciesTipoOperacion.Venta,text:"Venta en mercado secundario"},{value:Core.Enums.eEspeciesTipoOperacion.Compra,text:"Compra en mercado secundario"}];if(a.pageOptions&&a.pageOptions.puedeLicitar>0){e.push({value:Core.Enums.eEspeciesTipoOperacion.Licitacion,text:"Licitar"});e.push({value:Core.Enums.eEspeciesTipoOperacion.Renovacion,text:"Renovación"})}a.ddlTipoOperacion.shieldDropDown({dataSource:{data:e},textTemplate:"{text}",valueTemplate:"{value}",value:(a.ordenPrecargada?a.ordenPrecargada.idTipoOperacion.toString():a.defaultTipoOperacion.toString()),events:{select:function(f){a.clearControls(true);a.setControlsByTipoOperacion(f.item.value);a.setEspecieByTipoOperacion(f.item.value,function(){a.loadControlsByEspecie()});a.setDisponible(f.item.value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem());Core.Functions.Operar.setColorByTipoOperacion(f.item.value,a.divMain,a.divCuenta)}}});a.ddlRenovar.shieldDropDown({dataSource:{data:[]},textTemplate:"{ticker} ({Cantidad}) | {Descripcion}",valueTemplate:"{ticker}",value:(a.ordenPrecargada?a.ordenPrecargada.tickerRenovacion:""),events:{select:function(f){a.loadEspeciesByRenovacion(a.ddlTipoOperacion.swidget().selectedItem().value,function(){})}}});a.ddlEspecie.shieldComboBox({dataSource:{data:[]},valueTemplate:"{ticker}",value:(a.ordenPrecargada?a.ordenPrecargada.DisplayTicker:a.defaultEspecie),textTemplate:"{ticker} | {Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"ticker",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}},events:{select:function(f){if(f.index>=0){a.clearControls(false);if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta||a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra){Core.Functions.Operar.setLabelsByEspecie(a.ddlEspecie,a.ddlPlazo.swidget().selectedItem().value,a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(g){a.ultimaCotizacion=g;if(a.operarOptions.operarFIX){Core.Functions.Operar.setControlsOperarFix(a.ultimaCotizacion,a.ddlTipoOrden,a.ddlVencimientoOrden,a.divOperarFix,a.divReplacePreviousOrders,a.divCancelInDisconnection,false,function(){a.setControlsByVencimientoOrden();a.setControlsByTipoOrden()})}})}else{a.loadMonedas();a.lblNota.hide();if(a.ddlEspecie.swidget().selectedItem()&&a.ddlEspecie.swidget().selectedItem().Nota){a.lblNota.text(a.ddlEspecie.swidget().selectedItem().Nota);a.lblNota.show()}if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Licitacion){a.lblMontoLicitar.text((a.ddlEspecie.swidget().selectedItem()&&a.ddlEspecie.swidget().selectedItem().Rotulo)?a.ddlEspecie.swidget().selectedItem().Rotulo:"Monto a Licitar");a.txtMontoLicitar.attr("placeholder",(a.ddlEspecie.swidget().selectedItem()&&a.ddlEspecie.swidget().selectedItem().Rotulo)?a.ddlEspecie.swidget().selectedItem().Rotulo:"Monto a Licitar")}if(a.ddlEspecie.swidget().selectedItem()&&a.ddlEspecie.swidget().selectedItem().TipoNegociacion&&a.ddlEspecie.swidget().selectedItem().TipoNegociacion!=""){a.lblValorNegociacion.text(a.ddlEspecie.swidget().selectedItem().TipoNegociacion);a.txtValorNegociacion.attr("placeholder","Ingrese "+a.ddlEspecie.swidget().selectedItem().TipoNegociacion.toLowerCase());a.txtValorNegociacion.attr("max-decimal-digit-count",a.ddlEspecie.swidget().selectedItem().Decimales.toString());a.txtValorNegociacion.maxDecimalDigitCount=a.ddlEspecie.swidget().selectedItem().Decimales;a.divValorNegociacion.show()}else{a.divValorNegociacion.hide()}}a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem())}}}});a.ddlMoneda.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{idMoneda}",value:(a.ordenPrecargada?a.ordenPrecargada.idMoneda.toString():""),events:{select:function(f){a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem())}}});a.ddlPlazo.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",value:(a.ordenPrecargada?a.ordenPrecargada.Plazo.toString():a.defaultPlazo.toString()),events:{select:function(f){a.clearControls(true);a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,f.item.value,a.ddlEspecie.swidget().selectedItem());a.setEspecieByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,function(){a.loadControlsByEspecie()});if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta||a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra){Core.Functions.Operar.setLabelsByEspecie(a.ddlEspecie,a.ddlPlazo.swidget().selectedItem().value,a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(g){a.ultimaCotizacion=g;Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))})}}}});Core.Functions.Operar.setPlazos(a.ddlPlazo,a.pageOptions.plazosHabilitados);a.ddlTipoOrden.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{Valor}",value:(a.ordenPrecargada?a.ordenPrecargada.OrderType:""),events:{select:function(f){a.setControlsByTipoOrden()}}});a.ddlVencimientoOrden.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{Valor}",value:(a.ordenPrecargada?a.ordenPrecargada.TimeInForce:""),events:{select:function(f){a.setControlsByVencimientoOrden()}}});new Core.Controls.DecimalPicker(a.txtPrecioStop,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta||a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra){Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))}},defaultValue:(a.ordenPrecargada?a.ordenPrecargada.PrecioDisparo:0)});a.txtFechaVencimiento.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.ordenPrecargada?Core.Functions.Date.getDateByStringWithoutSeparator(a.ordenPrecargada.FechaVencimiento):new Date())});new Core.Controls.DecimalPicker(a.txtValorCantidad,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta||a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra){Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))}},defaultValue:(a.ordenPrecargada?a.ordenPrecargada.Cantidad:a.defaultValorCantidad)});new Core.Controls.DecimalPicker(a.txtMontoLicitar,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",defaultValue:(a.ordenPrecargada?a.ordenPrecargada.Monto:0)});new Core.Controls.DecimalPicker(a.txtValorNegociacion,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",enabledZero:true,defaultValue:(a.ordenPrecargada?a.ordenPrecargada.ValorNegociacion:"")});new Core.Controls.DecimalPicker(a.txtValorPrecio,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta||a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra){Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))}},defaultValue:(a.ordenPrecargada?a.ordenPrecargada.PrecioLimite:a.defaultValorLimite)});a.chkCantidadAMostrar.shieldCheckBox({label:"Difusión Parcial / Iceberg",checked:(a.ordenPrecargada&&a.ordenPrecargada.DisplayQty),events:{click:function(f){a.divCantidadAMostrar.hide();if(a.chkCantidadAMostrar.swidget().checked()){a.divCantidadAMostrar.show()}}}});new Core.Controls.DecimalPicker(a.txtCantidadAMostrar,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",defaultValue:(a.ordenPrecargada?a.ordenPrecargada.DisplayQty:0)});a.chkReplacePreviousOrders.shieldCheckBox({label:"Reemplazar órdenes previas",checked:(a.ordenPrecargada&&a.ordenPrecargada.ExecInst&&a.ordenPrecargada.ExecInst.indexOf("x")>=0)});a.chkCancelInDisconnection.shieldCheckBox({label:"Cancelar orden ante desconexión",checked:(a.ordenPrecargada&&a.ordenPrecargada.ExecInst&&a.ordenPrecargada.ExecInst.indexOf("o")>=0)});a.divOperarPrecarga.hide();a.btnNormal.on("click",function(){a.divOperarPrecarga.hide()});a.btnPrecarga.on("click",function(){a.divOperarPrecarga.show()});var b=[];for(var c=10;c<=18;c++){for(var d=0;d<=55;d=d+5){b.push({value:(c.padLeft(2,"0")+":"+d.padLeft(2,"0"))})}}a.ddlMinutosEjecucion.shieldDropDown({dataSource:{data:[{value:0,text:"Ahora"},{value:10,text:"En 10 minutos"},{value:30,text:"En 30 minutos"},{value:60,text:"En 1 hora"},{value:-1,text:"Otro"}]},textTemplate:"{text}",valueTemplate:"{value}",value:(a.ordenPrecargada&&a.ordenPrecargada.MinutosEjecucion?a.ordenPrecargada.MinutosEjecucion.toString():(a.ordenPrecargada&&a.ordenPrecargada.FechaEjecucion?"-1":"0")),events:{select:function(f){Core.Functions.Operar.setControlsByMinutosEjecucion(a.ddlMinutosEjecucion,a.divFechaEjecucion)}}});a.txtFechaEjecucion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.ordenPrecargada?Core.Functions.Date.getDateByStringDisplayDate(a.ordenPrecargada.FechaEjecucion):new Date())});a.ddlHoraEjecucion.shieldDropDown({dataSource:{data:b},textTemplate:"{value}",valueTemplate:"{value}",value:(a.ordenPrecargada&&a.ordenPrecargada.FechaEjecucion?a.ordenPrecargada.FechaEjecucion.substr(11,5):"")});a.ddlMinutosExpiracion.shieldDropDown({dataSource:{data:[{value:10,text:"En 10 minutos"},{value:30,text:"En 30 minutos"},{value:60,text:"En 1 hora"},{value:360,text:"En 6 horas"},{value:-1,text:"Otro"}]},textTemplate:"{text}",valueTemplate:"{value}",value:(a.ordenPrecargada&&a.ordenPrecargada.MinutosExpiracion?a.ordenPrecargada.MinutosExpiracion.toString():(a.ordenPrecargada&&a.ordenPrecargada.FechaExpiracion?"-1":"360")),events:{select:function(f){Core.Functions.Operar.setControlsByMinutosExpiracion(a.ddlMinutosExpiracion,a.divFechaExpiracion)}}});a.txtFechaExpiracion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.ordenPrecargada?Core.Functions.Date.getDateByStringDisplayDate(a.ordenPrecargada.FechaExpiracion):new Date())});a.ddlHoraExpiracion.shieldDropDown({dataSource:{data:b},textTemplate:"{value}",valueTemplate:"{value}",value:(a.ordenPrecargada&&a.ordenPrecargada.FechaExpiracion?a.ordenPrecargada.FechaExpiracion.substr(11,5):"")});a.btnAyudaEjecutarValidaciones.on("click",function(){Core.Functions.Operar.showAyudaEjecutarValidaciones()});a.chkEjecutarValidaciones.shieldCheckBox({label:"Excluir validaciones",checked:(a.ordenPrecargada&&a.ordenPrecargada.EjecutarValidaciones)});a.chkContinuarAutomaticamente.shieldCheckBox({label:"Permitir al cliente modificar esta precarga",checked:(a.ordenPrecargada&&a.ordenPrecargada.ContinuarAutomaticamente)});a.txtObservaciones.shieldTextBox({value:(a.ordenPrecargada?a.ordenPrecargada.Observaciones:"")});if(Core.Objects.Context.Configuration.idAplicacion==1){a.divObservaciones.hide()}a.btnContinuar.click(function(){a.btnContinuarClick()})};a.loadControlsByEspecie=function(){if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra||a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta){if(a.ddlEspecie.swidget().selectedItem()){Core.Functions.Operar.setLabelsByEspecie(a.ddlEspecie,a.ddlPlazo.swidget().selectedItem().value,a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(c){a.ultimaCotizacion=c;if(a.operarOptions.operarFIX){Core.Functions.Operar.setControlsOperarFix(a.ultimaCotizacion,a.ddlTipoOrden,a.ddlVencimientoOrden,a.divOperarFix,a.divReplacePreviousOrders,a.divCancelInDisconnection,true,function(){a.setControlsByVencimientoOrden();a.setControlsByTipoOrden()})}})}else{if(a.defaultEspecie!=""){var b=new Core.Controls.Dialog("Aviso","No posee la Especie "+a.defaultEspecie+".",{displayButtons:{close:true,accept:false}}).show();a.clearControls(true)}}}};a.loadControls=function(){a.divDisponible.hide();Core.Functions.Operar.setComitente(a.lblCuenta,a.header.selectedIdAccount,a.loaded);var b=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,requestUrl:"detalledisponible/"+encodeURIComponent(a.header.selectedIdAccount),requestType:"GET",requestData:{Fecha:Core.Functions.Date.getDateAsString(new Date())}});b.onSuccess=function(c){a.detalleDisponible=c;a.setControlsByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value);a.setEspecieByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,function(){a.loadControlsByEspecie();var e=a.ddlEspecie.swidget().selectedItem();a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,(e)?e:null);Core.Functions.Operar.setColorByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.divMain,a.divCuenta);if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra&&a.defaultValorCantidad!=""&&a.defaultValorLimite!=""&&e){var d=Math.floor((a.disponibleActual/a.defaultValorLimite));if(d<a.defaultValorCantidad){if(d<0){a.txtValorCantidad.val("")}else{a.txtValorCantidad.val(d)}}}if(a.ddlEspecie.swidget().selectedItem()&&a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta&&a.defaultValorCantidad!=""){if(a.ddlEspecie.swidget().selectedItem().Cantidad<a.defaultValorCantidad){a.txtValorCantidad.val(a.ddlEspecie.swidget().selectedItem().Cantidad)}else{a.txtValorCantidad.val(a.defaultValorCantidad)}}Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null));Core.Functions.Operar.setControlsByMinutosEjecucion(a.ddlMinutosEjecucion,a.divFechaEjecucion);Core.Functions.Operar.setControlsByMinutosExpiracion(a.ddlMinutosExpiracion,a.divFechaExpiracion)})};b.request()};a.setDisponible=function(g,e,c){a.divDisponible.hide();if(g==Core.Enums.eEspeciesTipoOperacion.Compra&&e!=null&&c!=null){a.disponibleActual=Core.Functions.Operar.setDisponible(a.detalleDisponible.disponible,c.idMoneda,e,a.lblDisponible,a.divDisponible)}else{if(c!=null&&g==Core.Enums.eEspeciesTipoOperacion.Licitacion){var d=(a.ddlMoneda.swidget().selectedItem())?a.ddlMoneda.swidget().selectedItem().idMoneda:null;var b=$.grep(a.detalleDisponible.disponible,function(i,h){return i.idMoneda==d})[0];var f=-1;if(c.FechaCierre==b.FechaCI){f=Core.Enums.ePlazo.CI}else{if(c.FechaCierre==b.Fecha24){f=Core.Enums.ePlazo.D24}else{if(c.FechaCierre==b.Fecha48){f=Core.Enums.ePlazo.D48}else{if(c.FechaCierre==b.Fecha72){f=Core.Enums.ePlazo.D72}}}}if(d!=null){a.disponibleActual=Core.Functions.Operar.setDisponible(a.detalleDisponible.disponible,d,f,a.lblDisponible,a.divDisponible)}}}};a.btnContinuarClick=function(){var f={value:true};if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta||a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra){Core.Functions.Validations.getValidatedDropDownValue(a.ddlEspecie,f);var e={idCuenta:a.header.selectedIdAccount,FechaVencimiento:Core.Functions.Date.getDateAsString(new Date()),idTipoOperacion:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,f),ticker:(a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().Ticker:null,Plazo:Core.Functions.Validations.getValidatedDropDownValue(a.ddlPlazo,f),idMoneda:(a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().idMoneda:null,Cantidad:Core.Functions.Validations.getValidatedNumericInputValue(a.txtValorCantidad,f),Monto:null,PrecioDisparo:null,Observaciones:a.txtObservaciones.val()};if(a.ordenPrecargada){e.idOrdenPrecargada=a.ordenPrecargada.idOrdenPrecargada}if(a.operarOptions.operarFIX&&a.ddlTipoOrden.swidget().selectedItem()&&a.ddlVencimientoOrden.swidget().selectedItem()){e.OrderType=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOrden,f);e.TimeInForce=Core.Functions.Validations.getValidatedDropDownValue(a.ddlVencimientoOrden,f);if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){e.PrecioDisparo=Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecioStop,f)}if(a.ddlVencimientoOrden.swidget().value()==a.eVencimientoOrden.GoodTillDate){var b=new Date();b.setHours(0,0,0,0);var d=((a.txtFechaVencimiento.swidget().value())?a.txtFechaVencimiento.swidget().value():new Date());d.setHours(0,0,0,0);e.FechaVencimiento=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaVencimiento,f));if(b.getTime()>d.getTime()){f.value=false;Core.Functions.Validations.toggleValidation(a.txtFechaVencimiento,true)}}if(a.chkCantidadAMostrar.swidget().checked()){e.DisplayQty=Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidadAMostrar,f);if(f.value&&(parseFloat(e.DisplayQty)<0||parseFloat(e.DisplayQty)>=parseFloat(e.Cantidad))){f.value=false;var c=new Core.Controls.Dialog("Aviso","La cantidad a mostrar debe ser positiva y menor a los nominales ingresados ",{displayButtons:{close:true,accept:false}}).show()}}}if(a.divReplacePreviousOrders.is(":visible")&&a.chkReplacePreviousOrders.swidget().checked()){e.ExecInst="x"}if(a.divCancelInDisconnection.is(":visible")&&a.chkCancelInDisconnection.swidget().checked()){if(e.ExecInst){e.ExecInst+=" o"}else{e.ExecInst="o"}}if(!a.ddlTipoOrden.swidget().selectedItem()||(a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.Market&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.MarketWithLeftOverAsLimit&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.StopMerval&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.Stop&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.MarketIfTouched)){e.PrecioLimite=Core.Functions.Validations.getValidatedNumericInputValue(a.txtValorPrecio,f)}if(a.divOperarPrecarga.is(":visible")){e.EsPrecarga=1;if(a.divFechaEjecucion.is(":visible")){e.FechaEjecucion=(Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaEjecucion,f))+" "+Core.Functions.Validations.getValidatedDropDownValue(a.ddlHoraEjecucion,f)+":00")}else{e.MinutosEjecucion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMinutosEjecucion,f)}if(a.divFechaExpiracion.is(":visible")){e.FechaExpiracion=(Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaExpiracion,f))+" "+Core.Functions.Validations.getValidatedDropDownValue(a.ddlHoraExpiracion,f)+":00")}else{e.MinutosExpiracion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMinutosExpiracion,f)}e.EjecutarValidaciones=a.chkEjecutarValidaciones.swidget().checked()?1:0;e.ContinuarAutomaticamente=a.chkContinuarAutomaticamente.swidget().checked()?0:1}if(f.value){Core.Functions.Operar.srOperarEspeciesValidaciones(a.txtValorCantidad,f)}if(!f.value){return}Core.Functions.Operar.srOperarEspecies(e,function(){Core.Functions.Operar.refreshDisponible(a.detalleDisponible,function(){a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem())},a.header.selectedIdAccount,a.loaded)},a.header.selectedIdAccount,a.idDefaultProfile,a.loaded)}else{Core.Functions.Validations.getValidatedDropDownValue(a.ddlEspecie,f);var e={idCuenta:a.header.selectedIdAccount,idLicitacion:(a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().idLicitacion:null,idTipoOperacion:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,f),ticker:(a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().ticker:null,Observaciones:a.txtObservaciones.val()};if(a.ddlEspecie.swidget().selectedItem()){e.idTipoNegociacion=a.ddlEspecie.swidget().selectedItem().idTipoNegociacion;if(a.ddlEspecie.swidget().selectedItem().TipoNegociacion&&a.ddlEspecie.swidget().selectedItem().TipoNegociacion!=""){e.ValorNegociacion=Core.Functions.Validations.getValidatedNoEmptyNumericInputValue(a.txtValorNegociacion,f)}}if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Renovacion){e.tickerRenovacion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlRenovar,f);e.Cantidad=Core.Functions.Validations.getValidatedNumericInputValue(a.txtValorCantidad,f);if(f.value){Core.Functions.Operar.srOperarEspeciesValidaciones(a.txtValorCantidad,f)}}else{e.idMoneda=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMoneda,f);e.Monto=Core.Functions.Validations.getValidatedNumericInputValue(a.txtMontoLicitar,f);if(f.value){Core.Functions.Operar.srOperarEspeciesValidaciones(a.txtMontoLicitar,f)}}if(!f.value){return}Core.Functions.Operar.srOperarLicitacion(e,function(){Core.Functions.Operar.refreshDisponible(a.detalleDisponible,function(){a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlPlazo.swidget().selectedItem().value,a.ddlEspecie.swidget().selectedItem())},a.header.selectedIdAccount,a.loaded)},a.header.selectedIdAccount,a.idDefaultProfile)}};a.setControlsByTipoOperacion=function(b){a.divPlazo.hide();a.divMoneda.hide();a.divRenovar.hide();a.divCotizacion.hide();a.divPrecio.hide();a.divTotal.hide();a.divMontoLicitar.hide();a.divValorNegociacion.hide();a.divCantidad.hide();a.divOperarFix.hide();a.lblNota.hide();a.divSeleccionPrecarga.hide();a.divOperarPrecarga.hide();if(b==Core.Enums.eEspeciesTipoOperacion.Venta||b==Core.Enums.eEspeciesTipoOperacion.Compra){a.divPlazo.show();a.divCotizacion.show();a.divPrecio.show();a.divTotal.show();a.divCantidad.show();a.lblCantidad.text("Cantidad de nominales");a.txtValorCantidad.attr("placeholder","Ingrese la cantidad");if(a.pageOptions&&a.pageOptions.precargar){a.divSeleccionPrecarga.show();if(a.btnPrecarga.hasClass("active")){a.divOperarPrecarga.show()}}}else{if(b==Core.Enums.eEspeciesTipoOperacion.Renovacion){a.divRenovar.show();a.lblCantidad.text("Nominales a renovar");a.txtValorCantidad.attr("placeholder","Ingrese los nominales");a.divCantidad.show()}else{if(b==Core.Enums.eEspeciesTipoOperacion.Licitacion){a.divMoneda.show();a.divMontoLicitar.show()}}}};a.loadMonedas=function(){var b=[];b=(a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().monedas:[];var c=a.ddlMoneda.swidget().initialOptions;c.dataSource.data=b;a.ddlMoneda.swidget().refresh(c)};a.setEspecieByTipoOperacion=function(e,b){var c={};c.panel=Core.Enums.ePanel.ONs;if(e==Core.Enums.eEspeciesTipoOperacion.Venta||e==Core.Enums.eEspeciesTipoOperacion.Compra){if(e==Core.Enums.eEspeciesTipoOperacion.Venta){c.idCuenta=a.header.selectedIdAccount;c.plazo=a.ddlPlazo.swidget().selectedItem().value}var d=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,allowCache:e==Core.Enums.eEspeciesTipoOperacion.Compra,secureRequest:true,requestUrl:"especies",requestType:"GET",requestData:c});d.onSuccess=function(f){a.loadEspecies(e,f.especies,b)};d.request()}else{c.idCuenta=a.header.selectedIdAccount;if(e==Core.Enums.eEspeciesTipoOperacion.Renovacion){c.renovar=1}var d=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"licitacion/detalle",requestType:"POST",requestData:c});d.onSuccess=function(f){a.instrumentos=f.instrumentos?f.instrumentos:[];a.renovaciones=f.renovaciones?f.renovaciones:[];if(e==Core.Enums.eEspeciesTipoOperacion.Renovacion){a.loadRenovaciones(e,f.renovaciones,b)}else{a.loadEspecies(e,f.instrumentos,b)}};d.request()}};a.loadRenovaciones=function(e,b,c){var d=a.ddlRenovar.swidget().initialOptions;d.dataSource.data=b;a.ddlRenovar.swidget().refresh(d);a.loadEspeciesByRenovacion(e,c)};a.loadEspeciesByRenovacion=function(d,c){var b=a.ddlRenovar.swidget().selectedItem()?$.grep(a.instrumentos,function(f,e){return f.idLicitacion==a.ddlRenovar.swidget().selectedItem().idLicitacion}):[];a.loadEspecies(d,b,c)};a.loadEspecies=function(e,b,c){var d=a.ddlEspecie.swidget().initialOptions;d.dataSource.data=b;if(e==Core.Enums.eEspeciesTipoOperacion.Venta){d.textTemplate="{DisplayTicker} ({Cantidad}) | {Descripcion}";d.valueTemplate="{DisplayTicker}"}else{if(e==Core.Enums.eEspeciesTipoOperacion.Compra){d.textTemplate="{DisplayTicker} {Descripcion}";d.valueTemplate="{DisplayTicker}"}else{d.textTemplate="{ticker} | {Descripcion}";d.valueTemplate="{ticker}"}}a.ddlEspecie.swidget().refresh(d);if(c){c()}};a.setControlsByVencimientoOrden=function(){if(a.ddlVencimientoOrden.swidget().value()==a.eVencimientoOrden.GoodTillDate){a.divFechaVencimiento.show()}else{a.txtFechaVencimiento.swidget().value(new Date());a.divFechaVencimiento.hide()}};a.setControlsByTipoOrden=function(){if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){a.divPrecioStop.show()}else{a.txtPrecioStop.val("");a.divPrecioStop.hide()}a.txtValorPrecio.removeAttr("disabled");if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Market||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketWithLeftOverAsLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){a.txtValorPrecio.val("");a.txtValorPrecio.attr("disabled","disabled");Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))}};a.getPrecio=function(){if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Market||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketWithLeftOverAsLimit){if(a.ultimaCotizacion){if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra){return a.ultimaCotizacion.Cotizacion.PrecioVenta}else{return a.ultimaCotizacion.Cotizacion.PrecioCompra}}else{return null}}else{if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){return a.txtPrecioStop.val()}else{return a.txtValorPrecio.val()}}};a.clearControls=function(b){if(b){a.ddlRenovar.swidget().refresh();a.ddlEspecie.swidget().refresh();a.ddlMoneda.swidget().refresh();a.lblUltimoPrecio.text("");a.lblVariacion.text("");a.lblMejorOfertaCompra.text("");a.lblMejorOfertaVenta.text("")}a.lblMontoLicitar.text("Seleccione la Especie");a.txtMontoLicitar.attr("placeholder","Seleccione la Especie");a.txtValorCantidad.val("");a.txtValorPrecio.val("");a.lblTotal.text("");a.txtObservaciones.val("");a.ddlTipoOrden.swidget().refresh();a.ddlVencimientoOrden.swidget().refresh();a.txtPrecioStop.val("");a.txtCantidadAMostrar.val("");a.txtFechaVencimiento.swidget().refresh();a.ultimaCotizacion=null}};Core.Business.Operar.Opciones=new function(){var a=this;a.id="opciones";a.loaded=false;a.detalleDisponible=null;a.idDefaultAccount=null;a.idDefaultProfile=null;a.decimalCount=6;a.eVencimientoOrden={GoodTillDate:6};a.eTipoOrden={Market:1,Limit:2,StopMerval:3,StopLimit:4,Stop:"z",MarketWithLeftOverAsLimit:"K",MarketIfTouched:"J"};a.divMain=null;a.divCuenta=null;a.ddlTipoOperacion=null;a.ddlEspecie=null;a.lblCuenta=null;a.divDisponible=null;a.lblDisponible=null;a.lblUltimoPrecio=null;a.lblVariacion=null;a.lblMejorOfertaCompra=null;a.lblMejorOfertaVenta=null;a.divOperarFix=null;a.divReplacePreviousOrders=null;a.chkReplacePreviousOrders=null;a.divCancelInDisconnection=null;a.chkCancelInDisconnection=null;a.divTipoOrden=null;a.ddlTipoOrden=null;a.divVencimientoOrden=null;a.ddlVencimientoOrden=null;a.divPrecioStop=null;a.txtPrecioStop=null;a.divFechaVencimiento=null;a.txtFechaVencimiento=null;a.txtValorCantidad=null;a.txtValorPrecio=null;a.lblTotal=null;a.chkCantidadAMostrar=null;a.txtCantidadAMostrar=null;a.divCantidadAMostrar=null;a.divObservaciones=null;a.txtObservaciones=null;a.btnContinuar=null;a.defaultTipoOperacion=null;a.defaultEspecie=null;a.defaultValorCantidad=null;a.defaultValorLimite=null;a.disponibleActual=null;a.pageOptions=null;a.operarOptions=null;a.ultimaCotizacion=null;a.init=function(d,e,f){if(Core.Objects.Accounts){var b=$.grep(Core.Objects.Accounts,function(h,g){return h.idCuenta==d})[0];if(b.NumComitente==""){return}}a.idDefaultAccount=d;a.idDefaultProfile=e;a.defaultTipoOperacion=Core.Enums.eEspeciesTipoOperacion.Venta;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[e]);a.operarOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu("operar",Core.Objects.Context.Profiles[e]);a.defaultEspecie="";a.defaultValorCantidad="";a.defaultValorLimite="";$.extend(true,a,f);if(Core.Objects.Context.TieneC4D==1){Core.loadPage("operar-opciones.html",function(){document.title="Operar Opciones";a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,d,e,function(){var g=$.grep(Core.Objects.Accounts,function(i,h){return i.idCuenta==a.header.selectedIdAccount})[0];if(g.NumComitente==""){Core.Business.PosicionConsolidada.init(a.header.selectedIdAccount,a.idDefaultProfile);return}a.loaded=false;a.loadControls()},"Core.Business.Operar.Opciones")})}else{var c=new Core.Controls.Dialog("Aviso","<p>Para poder Operar debe generar el código de operación de cuatro dígitos desde Configuración de Cuenta.<br/> <a onclick=\"$('.close-btn').click(); Core.Business.AccountSettings.init("+d+", "+e+');">Haga Click Aquí para ir a Configuración de Cuenta.</a></p>',{displayButtons:{close:true,accept:false}}).show()}};a.initControls=function(){a.divMain=$(".div-main");a.divCuenta=$(".div-cuenta");a.ddlTipoOperacion=$(".dropdown-tipo-operacion");a.ddlEspecie=$(".dropdown-especie");a.lblCuenta=$(".label-cuenta");a.divDisponible=$(".div-disponible");a.lblDisponible=$(".label-disponible");a.lblUltimoPrecio=$(".label-ultimo-precio");a.lblVariacion=$(".label-variacion");a.lblMejorOfertaCompra=$(".label-mejor-oferta-compra");a.lblMejorOfertaVenta=$(".label-mejor-oferta-venta");a.divOperarFix=$(".div-operar-fix");a.divOperarFix.hide();a.divTipoOrden=$(".div-tipo-orden");a.ddlTipoOrden=$(".dropdown-tipo-orden");a.divVencimientoOrden=$(".div-vencimiento-orden");a.ddlVencimientoOrden=$(".dropdown-vencimiento-orden");a.divPrecioStop=$(".div-precio-stop");a.txtPrecioStop=$(".textbox-precio-stop");a.divFechaVencimiento=$(".div-fecha-vencimiento");a.txtFechaVencimiento=$(".date-fecha-vencimiento");a.txtValorCantidad=$(".textbox-cantidad");a.txtValorPrecio=$(".textbox-precio");a.lblTotal=$(".label-precio-total");a.divObservaciones=$(".div-observaciones");a.txtObservaciones=$(".text-observaciones");a.txtCantidadAMostrar=$(".textbox-cantidad-a-mostrar");a.chkCantidadAMostrar=$(".checkbox-cantidad-a-mostrar");a.divCantidadAMostrar=$(".div-cantidad-a-mostrar");a.divCantidadAMostrar.hide();a.divReplacePreviousOrders=$(".div-replace-previous-orders");a.chkReplacePreviousOrders=$(".checkbox-replace-previous-orders");a.divCancelInDisconnection=$(".div-cancel-in-disconnection");a.chkCancelInDisconnection=$(".checkbox-cancel-in-disconnection");a.btnContinuar=$(".btn-continuar");a.ddlTipoOperacion.shieldDropDown({dataSource:{data:[{value:Core.Enums.eEspeciesTipoOperacion.Compra,text:"Compra"},{value:Core.Enums.eEspeciesTipoOperacion.Venta,text:"Venta"}]},textTemplate:"{text}",valueTemplate:"{value}",value:a.defaultTipoOperacion.toString(),events:{select:function(b){a.clearControls(true);a.setDisponible(b.item.value);Core.Functions.Operar.setColorByTipoOperacion(b.item.value,a.divMain,a.divCuenta);Core.Functions.Operar.setEspecieByTipoOperacion(b.item.value,a.ddlEspecie,Core.Enums.ePanel.Opciones,Core.Enums.ePlazo.D24,a.header.selectedIdAccount,a.loaded,function(){a.loadControlsByEspecie()})}}});a.ddlEspecie.shieldComboBox({dataSource:{data:[]},valueTemplate:"{Ticker}",value:a.defaultEspecie,textTemplate:"{DisplayTicker} | {Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}},events:{select:function(b){if(b.index>=0){a.clearControls(false);Core.Functions.Operar.setLabelsByEspecie(a.ddlEspecie,Core.Enums.ePlazo.D24,a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(c){a.ultimaCotizacion=c;if(a.operarOptions.operarFIX){Core.Functions.Operar.setControlsOperarFix(a.ddlEspecie.swidget().selectedItem().DisplayTicker,a.ddlTipoOrden,a.ddlVencimientoOrden,a.divOperarFix,a.divReplacePreviousOrders,a.divCancelInDisconnection,a.loaded,function(){a.setControlsByVencimientoOrden();a.setControlsByTipoOrden()})}})}}}});a.ddlTipoOrden.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{Valor}",events:{select:function(b){a.setControlsByTipoOrden()}}});a.ddlVencimientoOrden.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{Valor}",events:{select:function(b){a.setControlsByVencimientoOrden()}}});new Core.Controls.DecimalPicker(a.txtPrecioStop,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))}});a.txtFechaVencimiento.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date()});new Core.Controls.DecimalPicker(a.txtValorCantidad,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))},defaultValue:a.defaultValorCantidad});new Core.Controls.DecimalPicker(a.txtValorPrecio,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:"",onKeyUp:function(){Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))},defaultValue:a.defaultValorLimite});a.chkCantidadAMostrar.shieldCheckBox({label:"Difusión Parcial / Iceberg",events:{click:function(b){a.divCantidadAMostrar.hide();if(a.chkCantidadAMostrar.swidget().checked()){a.divCantidadAMostrar.show()}}}});new Core.Controls.DecimalPicker(a.txtCantidadAMostrar,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:""});a.chkReplacePreviousOrders.shieldCheckBox({label:"Reemplazar órdenes previas"});a.chkCancelInDisconnection.shieldCheckBox({label:"Cancelar orden ante desconexión"});a.txtObservaciones.shieldTextBox({});if(Core.Objects.Context.Configuration.idAplicacion==1){a.divObservaciones.hide()}a.btnContinuar.click(function(){a.btnContinuarClick()})};a.loadControlsByEspecie=function(){if(a.ddlEspecie.swidget().selectedItem()){Core.Functions.Operar.setLabelsByEspecie(a.ddlEspecie,Core.Enums.ePlazo.D24,a.lblUltimoPrecio,a.lblVariacion,a.lblMejorOfertaCompra,a.lblMejorOfertaVenta,a.loaded,function(c){a.ultimaCotizacion=c;if(a.operarOptions.operarFIX){Core.Functions.Operar.setControlsOperarFix(a.ultimaCotizacion,a.ddlTipoOrden,a.ddlVencimientoOrden,a.divOperarFix,a.divReplacePreviousOrders,a.divCancelInDisconnection,a.loaded,function(){a.setControlsByVencimientoOrden();a.setControlsByTipoOrden()})}})}else{if(a.defaultEspecie!=""){var b=new Core.Controls.Dialog("Aviso","No posee la Especie "+a.defaultEspecie+".",{displayButtons:{close:true,accept:false}}).show();a.clearControls(true)}}};a.loadControls=function(){Core.Functions.Operar.setComitente(a.lblCuenta,a.header.selectedIdAccount,a.loaded);var b=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,requestUrl:"detalledisponible/"+encodeURIComponent(a.header.selectedIdAccount),requestType:"GET",requestData:{Fecha:Core.Functions.Date.getDateAsString(new Date())}});b.onSuccess=function(c){a.detalleDisponible=c;Core.Functions.Operar.setEspecieByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.ddlEspecie,Core.Enums.ePanel.Opciones,Core.Enums.ePlazo.D24,a.header.selectedIdAccount,a.loaded,function(){a.loadControlsByEspecie();a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value);if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra&&a.defaultValorCantidad!=""&&a.defaultValorLimite!=""){var d=$.grep(a.detalleDisponible.disponible,function(g,f){return g.idMoneda==Core.Enums.Currency.Pesos.idMoneda})[0];if(!d){d=0}else{d=d.DisponibleOperable72}var e=Math.floor((d/a.defaultValorLimite));if(e<a.defaultValorCantidad){if(e<0){a.txtValorCantidad.val("")}else{a.txtValorCantidad.val(e)}}}if(a.ddlEspecie.swidget().selectedItem()&&a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Venta&&a.defaultValorCantidad!=""){if(a.ddlEspecie.swidget().selectedItem().Cantidad<a.defaultValorCantidad){a.txtValorCantidad.val(a.ddlEspecie.swidget().selectedItem().Cantidad)}else{a.txtValorCantidad.val(a.defaultValorCantidad)}}Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null));Core.Functions.Operar.setColorByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().value,a.divMain,a.divCuenta)})};b.request()};a.setDisponible=function(b){a.divDisponible.hide();if(b==Core.Enums.eEspeciesTipoOperacion.Compra){a.disponibleActual=Core.Functions.Operar.setDisponible(a.detalleDisponible.disponible,Core.Enums.Currency.Pesos.idMoneda,Core.Enums.ePlazo.D24,a.lblDisponible,a.divDisponible)}};a.btnContinuarClick=function(){var f={value:true};var e={idCuenta:a.header.selectedIdAccount,FechaVencimiento:Core.Functions.Date.getDateAsString(new Date()),idTipoOperacion:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,f),ticker:Core.Functions.Validations.getValidatedDropDownValue(a.ddlEspecie,f),Plazo:Core.Enums.ePlazo.D24,idMoneda:(a.ddlEspecie.swidget().selectedItem())?a.ddlEspecie.swidget().selectedItem().idMoneda:null,Cantidad:Core.Functions.Validations.getValidatedNumericInputValue(a.txtValorCantidad,f),Monto:null,PrecioDisparo:null,Observaciones:a.txtObservaciones.val()};if(a.operarOptions.operarFIX&&a.ddlTipoOrden.swidget().selectedItem()&&a.ddlVencimientoOrden.swidget().selectedItem()){e.OrderType=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOrden,f);e.TimeInForce=Core.Functions.Validations.getValidatedDropDownValue(a.ddlVencimientoOrden,f);if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){e.PrecioDisparo=Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecioStop,f)}if(a.ddlVencimientoOrden.swidget().value()==a.eVencimientoOrden.GoodTillDate){var b=new Date();b.setHours(0,0,0,0);var d=((a.txtFechaVencimiento.swidget().value())?a.txtFechaVencimiento.swidget().value():new Date());d.setHours(0,0,0,0);e.FechaVencimiento=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaVencimiento,f));if(b.getTime()>d.getTime()){f.value=false;Core.Functions.Validations.toggleValidation(a.txtFechaVencimiento,true)}}if(a.chkCantidadAMostrar.swidget().checked()){e.DisplayQty=Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidadAMostrar,f);if(f.value&&(parseFloat(e.DisplayQty)<0||parseFloat(e.DisplayQty)>=parseFloat(e.Cantidad))){f.value=false;var c=new Core.Controls.Dialog("Aviso","La cantidad a mostrar debe ser positiva y menor a los nominales ingresados ",{displayButtons:{close:true,accept:false}}).show()}}}if(a.divReplacePreviousOrders.is(":visible")&&a.chkReplacePreviousOrders.swidget().checked()){e.ExecInst="x"}if(a.divCancelInDisconnection.is(":visible")&&a.chkCancelInDisconnection.swidget().checked()){if(e.ExecInst){e.ExecInst+=" o"}else{e.ExecInst="o"}}if(!a.ddlTipoOrden.swidget().selectedItem()||(a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.Market&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.MarketWithLeftOverAsLimit&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.StopMerval&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.Stop&&a.ddlTipoOrden.swidget().value()!=a.eTipoOrden.MarketIfTouched)){e.PrecioLimite=Core.Functions.Validations.getValidatedNumericInputValue(a.txtValorPrecio,f)}if(f.value){Core.Functions.Operar.srOperarEspeciesValidaciones(a.txtValorCantidad,f)}if(!f.value){return}Core.Functions.Operar.srOperarEspecies(e,function(){Core.Functions.Operar.refreshDisponible(a.detalleDisponible,function(){a.setDisponible(a.ddlTipoOperacion.swidget().selectedItem().value)},a.header.selectedIdAccount,a.loaded)},a.header.selectedIdAccount,a.idDefaultProfile,a.loaded)};a.setControlsByVencimientoOrden=function(){if(a.ddlVencimientoOrden.swidget().value()==a.eVencimientoOrden.GoodTillDate){a.divFechaVencimiento.show()}else{a.txtFechaVencimiento.swidget().value(new Date());a.divFechaVencimiento.hide()}};a.setControlsByTipoOrden=function(){if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){a.divPrecioStop.show()}else{a.txtPrecioStop.val("");a.divPrecioStop.hide()}a.txtValorPrecio.removeAttr("disabled");if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Market||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketWithLeftOverAsLimit||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){a.txtValorPrecio.val("");a.txtValorPrecio.attr("disabled","disabled");Core.Functions.Operar.setTotalOperacion(a.txtValorCantidad.val(),a.getPrecio(),a.lblTotal,((a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra)?a.disponibleActual:null))}};a.getPrecio=function(){if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Market||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketWithLeftOverAsLimit){if(a.ultimaCotizacion){if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eEspeciesTipoOperacion.Compra){return a.ultimaCotizacion.Cotizacion.PrecioVenta}else{return a.ultimaCotizacion.Cotizacion.PrecioCompra}}else{return null}}else{if(a.ddlTipoOrden.swidget().value()==a.eTipoOrden.StopMerval||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.Stop||a.ddlTipoOrden.swidget().value()==a.eTipoOrden.MarketIfTouched){return a.txtPrecioStop.val()}else{return a.txtValorPrecio.val()}}};a.clearControls=function(b){if(b){a.ddlEspecie.swidget().refresh();a.lblUltimoPrecio.text("");a.lblVariacion.text("");a.lblMejorOfertaCompra.text("");a.lblMejorOfertaVenta.text("")}a.txtValorCantidad.val("");a.txtValorPrecio.val("");a.lblTotal.text("");a.txtObservaciones.val("");a.ddlTipoOrden.swidget().refresh();a.ddlVencimientoOrden.swidget().refresh();a.txtPrecioStop.val("");a.txtCantidadAMostrar.val("");a.txtFechaVencimiento.swidget().refresh();a.ultimaCotizacion=null}};Core.Business.OperarPack=new function(){var a=this;a.id="packoperar";a.idDefaultAccount=null;a.idDefaultProfile=null;a.pageOptions=null;a.detalleDisponible=null;a.divMain=null;a.divCuenta=null;a.lblCuenta=null;a.divDisponible=null;a.lblDisponible=null;a.lblTicker=null;a.lblTotal=null;a.txtCantidadPack=null;a.lblCantidadPersonalidado=null;a.btnResetearCantidades=null;a.divComposicion=null;a.divObservaciones=null;a.txtObservaciones=null;a.btnContinuar=null;a.detallePack=null;a.defaultCantidadPack="1";a.init=function(c,d,e){if(Core.Objects.Accounts){var b=$.grep(Core.Objects.Accounts,function(g,f){return g.idCuenta==c})[0];if(b.NumComitente==""){return}}a.idDefaultAccount=c;a.idDefaultProfile=d;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[d]);a.detallePack=null;a.defaultCantidadPack="1";$.extend(true,a,e);if(Core.Objects.Context.TieneC4D==1){Core.loadPage("operar-pack.html",function(){document.title="Pack";a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,c,d,function(){var f=$.grep(Core.Objects.Accounts,function(h,g){return h.idCuenta==a.header.selectedIdAccount})[0];if(f.NumComitente==""||!a.detallePack||!a.detallePack.detalle||!a.detallePack.detalle[0]||!a.detallePack.composicion||!a.detallePack.composicion.length){Core.Business.PosicionConsolidada.init(a.header.selectedIdAccount,a.idDefaultProfile);return}a.loadControls()},"Core.Business.OperarPack")})}else{new Core.Controls.Dialog("Aviso","<p>Para poder Operar debe generar el código de operación de cuatro dígitos desde Configuración de Cuenta.<br/> <a onclick=\"$('.close-btn').click(); Core.Business.AccountSettings.init("+c+", "+d+');">Haga Click Aquí para ir a Configuración de Cuenta.</a></p>',{displayButtons:{close:true,accept:false}}).show()}};a.initControls=function(){a.divMain=$(".div-main");a.divCuenta=$(".div-cuenta");a.lblCuenta=$(".label-cuenta");a.divDisponible=$(".div-disponible");a.lblDisponible=$(".label-disponible");a.btnAyuda=$(".btn-ayuda");a.lblTicker=$(".label-ticker");a.lblTotal=$(".label-precio-total");a.txtCantidadPack=$(".textbox-cantidad-pack");a.lblCantidadPersonalidado=$(".label-cantidad-personalizado");a.btnResetearCantidades=$(".btn-resetear-cantidades");a.divComposicion=$(".div-composicion");a.btnContinuar=$(".btn-continuar");a.divObservaciones=$(".div-observaciones");a.txtObservaciones=$(".text-observaciones");a.btnAyuda.on("click",function(){$(".div-ayuda-packs").modal({show:true})});a.dpCantidadPack=new Core.Controls.DecimalPicker(a.txtCantidadPack,{maxDecimalDigitCount:0,showThousandsSeparator:"",onKeyUp:function(){a.setCantidades()},defaultValue:a.defaultCantidadPack});Core.Functions.Validations.toggleValidation(a.txtCantidadPack,false);a.btnResetearCantidades.click(function(){a.dpCantidadPack.setValue(1);a.setCantidades()});a.txtObservaciones.shieldTextBox({});if(Core.Objects.Context.Configuration.idAplicacion==1){a.divObservaciones.hide()}a.btnContinuar.click(function(){a.btnContinuarClick()})};a.loadControls=function(){var b=new Core.Ajax.ServerRequest({showOverlay:true,requestUrl:"detalledisponible/"+encodeURIComponent(a.header.selectedIdAccount),requestType:"GET",requestData:{Fecha:Core.Functions.Date.getDateAsString(new Date())}});b.onSuccess=function(c){a.detalleDisponible=c;Core.Functions.Operar.setComitente(a.lblCuenta,a.header.selectedIdAccount,false);Core.Functions.Operar.setColorByTipoOperacion(29,a.divMain,a.divCuenta);a.lblTicker.text(("Operar "+Core.Functions.grid.formatUndefinedString(a.detallePack.detalle[0].Ticker)));a.divComposicion.empty();a.detallePack.composicion.forEach(function(e,d){e.divRow=$('<div class="row" style="padding-left:15px; padding-right:15px"></div>').appendTo(a.divComposicion);e.divTicker=$('<div class="col-lg-5 col-md-5 col-sm-12 col-xs-12"></div>').appendTo(e.divRow);$("<p>Ticker</p>").appendTo(e.divTicker);$('<div class="control-group form-group"><p class="field-ultimo label-precio">'+e.Ticker+"</p></div>").appendTo(e.divTicker);e.divCantidad=$('<div class="col-lg-3 col-md-3 col-sm-6 col-xs-6"></div>').appendTo(e.divRow);$("<p>Cantidad</p>").appendTo(e.divCantidad);e.divControl=$('<div class="control-group form-group"></div>').appendTo(e.divCantidad);e.txtCantidad=$('<input type="text" maxlength="12" class="form-control" placeholder="Ingrese la cantidad" />').appendTo(e.divControl);e.controlCantidad=new Core.Controls.DecimalPicker(e.txtCantidad,{maxDecimalDigitCount:0,showThousandsSeparator:"",onKeyUp:function(){a.setTotal()},defaultValue:""});e.divPrecio=$('<div class="col-lg-3 col-md-3 col-sm-6 col-xs-6"></div>').appendTo(e.divRow);$("<p>Precio</p>").appendTo(e.divPrecio);$('<div class="control-group form-group"><p class="field-ultimo label-precio">'+e.Precio.toFixed(2)+"</p></div>").appendTo(e.divPrecio);e.divAcciones=$('<div class="col-lg-1 col-md-1 col-sm-12 col-xs-12"></div>').appendTo(e.divRow);e.divButtons=$('<div class="control-group form-group"></div>').appendTo(e.divAcciones);e.btnEliminar=$('<button type="button" class="btn-sm balanz-button btn-eliminar hidden-sm hidden-xs"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(e.divButtons);e.btnEliminarMobile=$('<button type="button" class="btn btn-primary btn-eliminar-mobile hidden-lg hidden-md">Eliminar Ticker</button>').appendTo(e.divButtons);e.btnEliminar.on("click",function(){a.eliminarInstrumento(e)});e.btnEliminarMobile.on("click",function(){a.eliminarInstrumento(e)})});a.setDisponible();a.setCantidades()};b.request()};a.eliminarInstrumento=function(b){b.controlCantidad.setValue(0);b.divRow.hide();a.setTotal()};a.setDisponible=function(){a.divDisponible.hide();if(a.detallePack.detalle[0].Plazo!=null&&a.detallePack.detalle[0].idMoneda!=null){Core.Functions.Operar.setDisponible(a.detalleDisponible.transferible,a.detallePack.detalle[0].idMoneda,a.detallePack.detalle[0].Plazo,a.lblDisponible,a.divDisponible)}};a.setCantidades=function(){a.detallePack.composicion.forEach(function(c,b){c.divRow.show();c.controlCantidad.setValue(a.dpCantidadPack.getValue()?(a.dpCantidadPack.getValue()*c.Cantidad):0)});a.setTotal()};a.setTotal=function(){var b=0;a.detallePack.composicion.forEach(function(d,c){if(d.controlCantidad.getValue()){b+=(d.controlCantidad.getValue()*d.Precio)}});a.lblTotal.text(b?b.toFixed(2):"");a.showCantidadDescripcion()};a.showCantidadDescripcion=function(){var b=((a.detallePack.composicion[0].controlCantidad.getValue()&&a.detallePack.composicion[0].Cantidad)?Math.floor(a.detallePack.composicion[0].controlCantidad.getValue()/a.detallePack.composicion[0].Cantidad):0);if($.grep(a.detallePack.composicion,function(c,d){return c.divRow.is(":visible")&&(c.Cantidad*b)==c.controlCantidad.getValue()}).length==a.detallePack.composicion.length){if(b){a.dpCantidadPack.setValue(b)}else{a.dpCantidadPack.targetControl.val("")}a.txtCantidadPack.show();a.lblCantidadPersonalidado.hide()}else{a.txtCantidadPack.hide();a.lblCantidadPersonalidado.show()}};a.btnContinuarClick=function(){Core.Functions.Validations.toggleValidation(a.txtCantidadPack,false);var d={value:true};var b={};b.idCuenta=a.header.selectedIdAccount;b.idTipoOperacion=29;b.idSintetico=a.detallePack.detalle[0].idSintetico;b.Observaciones=a.txtObservaciones.val();if(a.txtCantidadPack.is(":visible")){b.Cantidad=Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidadPack,d)}else{b.Cantidades=[];a.detallePack.composicion.forEach(function(f,e){Core.Functions.Validations.toggleValidation(f.txtCantidad,false);b.Cantidades.push({SecurityID:f.SecurityID,Cantidad:(f.divRow.is(":visible")?Core.Functions.Validations.getValidatedNumericInputValue(f.txtCantidad,d):0)})})}if(!d.value){return}var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"operar/sinteticos/solicitud",requestType:"POST",requestData:b});c.onSuccess=function(i){var j="Solicitud de Pack";var f="Comitente N°"+i.NumComitente+" - "+i.DescripcionCuenta;var g="S.E:U.O. (Salvo error u omisión) <br>Los valores son estimados; los valores finales de la operación surgiran de la ejecución misma y reflejados en el boleto.";var h={data:i,idDefaultProfile:a.idDefaultProfile,terminosYCondiciones:i.Terminos,terminosYCondicionesDescripcion:"Declaro que he leído los Términos y Condiciones",idAccount:a.header.selectedIdAccount,generalTitle:"CONFIRMACION DE ORDEN",title:j,accountDescription:f,footerHtml:g,urlMethod:"operar/sinteticos/confirmar",codigo4DDescription:"Ingrese su código de operación de cuatro dígitos:",onConfirm:function(){Core.Functions.Operar.refreshDisponible(a.detalleDisponible,function(){a.setDisponible()},a.header.selectedIdAccount,false)}};var e=new Core.Controls.OperarConfirmation(h).show()};c.request()}};Core.Business.OperarRealEstate=new function(){var a=this;a.id="realestateoperar";a.idDefaultAccount=null;a.idDefaultProfile=null;a.pageOptions=null;a.divMain=null;a.divCuenta=null;a.lblCuenta=null;a.ddlTipoOperacion=null;a.ddlProyecto=null;a.divMoneda=null;a.ddlMoneda=null;a.divTitulo=null;a.ddlTitulo=null;a.lblMonto=null;a.txtMonto=null;a.divTitularCuenta=null;a.ddlTitularCuenta=null;a.divCuentasBancarias=null;a.divCuentaBancariaPesos=null;a.ddlCuentaBancariaPesos=null;a.divCuentaBancariaDolares=null;a.ddlCuentaBancariaDolares=null;a.divObservaciones=null;a.txtObservaciones=null;a.btnContinuar=null;a.titularesCuenta=[];a.defaultProyecto=null;a.init=function(c,d,e){if(Core.Objects.Accounts){var b=$.grep(Core.Objects.Accounts,function(g,f){return g.idCuenta==c})[0];if(b.NumComitente==""||b.Juridica==1){new Core.Controls.Dialog("Aviso","<p>La cuenta seleccionada no posee comitente o es jurídica.</p>",{displayButtons:{close:true,accept:false}}).show();return}}a.idDefaultAccount=c;a.idDefaultProfile=d;a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[d]);a.defaultProyecto="";$.extend(true,a,e);if(Core.Objects.Context.TieneC4D==1){Core.loadPage("operar-real-estate.html",function(){document.title="Real Estate";a.titularesCuenta=[];a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,c,d,function(){var f=$.grep(Core.Objects.Accounts,function(h,g){return h.idCuenta==a.header.selectedIdAccount})[0];if(f.NumComitente==""||f.Juridica==1){Core.Business.PosicionConsolidada.init(a.header.selectedIdAccount,a.idDefaultProfile);return}a.loadControls()},"Core.Business.OperarRealEstate")})}else{new Core.Controls.Dialog("Aviso","<p>Para poder Operar debe generar el código de operación de cuatro dígitos desde Configuración de Cuenta.<br/> <a onclick=\"$('.close-btn').click(); Core.Business.AccountSettings.init("+c+", "+d+');">Haga Click Aquí para ir a Configuración de Cuenta.</a></p>',{displayButtons:{close:true,accept:false}}).show()}};a.initControls=function(){a.divMain=$(".div-main");a.divCuenta=$(".div-cuenta");a.lblCuenta=$(".label-cuenta");a.ddlTipoOperacion=$(".dropdown-tipo-operacion");a.ddlProyecto=$(".dropdown-proyecto");a.divMoneda=$(".div-moneda");a.ddlMoneda=$(".dropdown-moneda");a.divTitulo=$(".div-titulo");a.ddlTitulo=$(".dropdown-titulo");a.lblMonto=$(".label-monto");a.txtMonto=$(".textbox-monto");a.divTitularCuenta=$(".div-titular-cuenta");a.ddlTitularCuenta=$(".dropdown-titular-cuenta");a.divCuentasBancarias=$(".div-cuentas-bancarias");a.divCuentaBancariaPesos=$(".div-cuenta-bancaria-pesos");a.ddlCuentaBancariaPesos=$(".dropdown-cuenta-bancaria-pesos");a.divCuentaBancariaDolares=$(".div-cuenta-bancaria-dolares");a.ddlCuentaBancariaDolares=$(".dropdown-cuenta-bancaria-dolares");a.btnContinuar=$(".btn-continuar");a.divObservaciones=$(".div-observaciones");a.txtObservaciones=$(".text-observaciones");a.ddlTipoOperacion.shieldDropDown({dataSource:{data:[]},textTemplate:"{TipoOperacion}",valueTemplate:"{idTipoOperacion}",value:"",events:{select:function(b){a.setControlsByTipoOperacion()}}});a.ddlProyecto.shieldComboBox({dataSource:{data:[]},valueTemplate:"{Ticker}",textTemplate:"{Ticker} | {Descripcion}",value:a.defaultProyecto,autoComplete:{enabled:true,filter:{or:[{path:"Ticker",filter:"contains",value:""},{path:"Descripcion",filter:"contains",value:""}]}},events:{select:function(b){a.setControlsByProyecto()}}});a.ddlMoneda.shieldDropDown({dataSource:{data:[]},textTemplate:"{text}",valueTemplate:"{value}",value:""});a.ddlTitulo.shieldComboBox({dataSource:{data:[]},valueTemplate:"{DisplayTicker}",value:"",textTemplate:"{DisplayTicker} ({Cantidad}) | {Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}}});a.txtMonto.shieldNumericTextBox({min:0,step:1e-06,max:999999999,spinners:false,value:""});a.ddlTitularCuenta.shieldDropDown({dataSource:{data:[]},textTemplate:"{Persona}",valueTemplate:"{idPersona}"});a.ddlCuentaBancariaPesos.shieldComboBox({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{idCuentaBancaria}",value:"",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""}]}}});a.ddlCuentaBancariaDolares.shieldComboBox({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{idCuentaBancaria}",value:"",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""}]}}});a.txtObservaciones.shieldTextBox({});if(Core.Objects.Context.Configuration.idAplicacion==1){a.divObservaciones.hide()}a.btnContinuar.click(function(){a.btnContinuarClick()})};a.loadControls=function(){Core.Functions.Operar.setComitente(a.lblCuenta,a.header.selectedIdAccount,false);var b=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divMain,secureRequest:true,requestUrl:"oferentesexternos/tiposoperacion",requestType:"GET"});b.onSuccess=function(c){var d=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divMain,secureRequest:true,requestUrl:"especies",requestType:"GET",requestData:{panel:Core.Enums.ePanel.OferentesExternos}});d.onSuccess=function(e){var f=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divMain,secureRequest:true,requestUrl:"cuentasbancariasvinculadas/"+a.header.selectedIdAccount,requestType:"GET"});f.onSuccess=function(k){a.tiposOperacion=c.tipos;var j=a.ddlProyecto.swidget().initialOptions;j.dataSource.data=e.especies;a.ddlProyecto.swidget().refresh(j);var g=((k&&k.cuentasbancarias)?k.cuentasbancarias:[]);var i=$.grep(g,function(n,m){return n.CBU&&n.idMoneda==Core.Enums.Currency.Pesos.idMoneda});var j=a.ddlCuentaBancariaPesos.swidget().initialOptions;j.dataSource.data=i;a.ddlCuentaBancariaPesos.swidget().refresh(j);var h=$.grep(g,function(n,m){return n.CBU&&n.idMoneda==Core.Enums.Currency.Dolares.idMoneda});var j=a.ddlCuentaBancariaDolares.swidget().initialOptions;j.dataSource.data=h;a.ddlCuentaBancariaDolares.swidget().refresh(j);if(Core.Objects.Context.Configuration.idAplicacion!=1){var l=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divMain,secureRequest:true,requestUrl:"personas/titulares/"+a.header.selectedIdAccount,requestType:"GET"});l.onSuccess=function(n){a.titularesCuenta=n.titulares;if(a.titularesCuenta.length>1){var m=a.ddlTitularCuenta.swidget().initialOptions;m.dataSource.data=a.titularesCuenta;a.ddlTitularCuenta.swidget().refresh(m);a.divTitularCuenta.show()}else{a.divTitularCuenta.hide()}a.setControlsByProyecto()};l.request()}else{a.divTitularCuenta.hide();a.setControlsByProyecto()}};f.request()};d.request()};b.request()};a.setControlsByTipoOperacion=function(){a.divMoneda.hide();a.divTitulo.hide();a.lblMonto.text("Monto:");if(a.ddlTipoOperacion.swidget().selectedItem()){Core.Functions.Operar.setColorByTipoOperacion(a.ddlTipoOperacion.swidget().selectedItem().idTipoOperacion,a.divMain,a.divCuenta);if(a.ddlTipoOperacion.swidget().selectedItem().idMoneda){var c=a.ddlMoneda.swidget().initialOptions;if(a.ddlTipoOperacion.swidget().selectedItem().idMoneda==Core.Enums.Currency.Pesos.idMoneda){c.dataSource.data=[{value:"PESOS",text:Core.Enums.Currency.Pesos.Descripcion}]}else{if(a.ddlTipoOperacion.swidget().selectedItem().idMoneda==Core.Enums.Currency.Dolares.idMoneda){c.dataSource.data=[{value:"DOLAR",text:Core.Enums.Currency.Dolares.Descripcion}]}}a.ddlMoneda.swidget().refresh(c);a.divMoneda.show()}else{var d=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.divMain,secureRequest:true,requestUrl:"especies",requestType:"GET",requestData:{idCuenta:a.header.selectedIdAccount,plazo:Core.Enums.ePlazo.CI,panel:Core.Enums.ePanel.Bonos}});d.onSuccess=function(f){var e=a.ddlTitulo.swidget().initialOptions;e.dataSource.data=$.grep(f.especies,function(h,g){return h.idMoneda==Core.Enums.Currency.Pesos.idMoneda});e.value="";a.ddlTitulo.swidget().refresh(e)};d.request();a.divTitulo.show();a.lblMonto.text("Cantidad:")}}else{var b=a.ddlTitulo.swidget().initialOptions;b.dataSource.data=[];a.ddlTitulo.swidget().refresh(b);var b=a.ddlMoneda.swidget().initialOptions;b.dataSource.data=[];a.ddlMoneda.swidget().refresh(b);a.divMoneda.show()}};a.setControlsByProyecto=function(){var d=[];if(a.ddlProyecto.swidget().selectedItem()){var c=a.ddlProyecto.swidget().selectedItem();var d=$.grep(a.tiposOperacion,function(f,e){return((c.OperaPesos&&f.idMoneda==Core.Enums.Currency.Pesos.idMoneda)||(c.OperaDolar&&f.idMoneda==Core.Enums.Currency.Dolares.idMoneda)||(c.OperaTitulos&&!f.idMoneda))})}var b=a.ddlTipoOperacion.swidget().initialOptions;b.dataSource.data=d;a.ddlTipoOperacion.swidget().refresh(b);a.setControlsByTipoOperacion()};a.btnContinuarClick=function(){var d={value:true};var b={};b.idCuenta=a.header.selectedIdAccount;b.idTipoOperacion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,d);b.Ticker=Core.Functions.Validations.getValidatedDropDownValue(a.ddlProyecto,d);if(a.ddlTipoOperacion.swidget().selectedItem()&&a.ddlTipoOperacion.swidget().selectedItem().idMoneda){b.TickerPago=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMoneda,d);b.Monto=Core.Functions.Validations.getValidatedNumericSwidgetValue(a.txtMonto,d)}else{b.TickerPago=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTitulo,d);b.Cantidad=Core.Functions.Validations.getValidatedNumericSwidgetValue(a.txtMonto,d)}b.idCuentaBancariaPesos=Core.Functions.Validations.getValidatedDropDownValue(a.ddlCuentaBancariaPesos,d);b.idCuentaBancariaDolar=Core.Functions.Validations.getValidatedDropDownValue(a.ddlCuentaBancariaDolares,d);if(Core.Objects.Context.Configuration.idAplicacion!=1&&a.titularesCuenta.length>1){b.idPersonaTitular=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTitularCuenta,d)}b.Observaciones=a.txtObservaciones.val();if(!d.value){return}var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"operar/oferentesexternos/solicitud",requestType:"POST",requestData:b});c.onSuccess=function(e){new Core.Controls.Confirmation("Confirmación",e.htmlTYCExterno[0].htmlTYCExterno,{onAccepted:function(){var j=a.ddlTipoOperacion.swidget().selectedItem().TipoOperacion;var g="Comitente N°"+e.NumComitente+" - "+e.DescripcionCuenta;var h="S.E:U.O. (Salvo error u omisión)";var i={data:e,idDefaultProfile:a.idDefaultProfile,terminosYCondiciones:e.Terminos,terminosYCondicionesDescripcion:"Declaro que he leído los Términos y Condiciones",idAccount:a.header.selectedIdAccount,generalTitle:"CONFIRMACION DE ORDEN",title:j,accountDescription:g,footerHtml:h,urlMethod:"operar/oferentesexternos/confirmar",codigo4DDescription:"Ingrese su código de operación de cuatro dígitos:",onConfirm:function(){}};var f=new Core.Controls.OperarConfirmation(i).show()}}).show()};c.request()}};Core.Business.Operar.Transferencias=new function(){var a=this;a.id="transferencias";a.loaded=false;a.detalleDisponible=null;a.idDefaultAccount=null;a.idDefaultProfile=null;a.ddlCuenta=null;a.ddlMoneda=null;a.divTipoTransferencia=null;a.chkTipoTransferenciaEcheq=null;a.chkTipoTransferenciaTransferenciaACuentaBancaria=null;a.ddlCuentaVinculada=null;a.lblCuenta=null;a.divDisponible=null;a.lblDisponible=null;a.txtImporte=null;a.ddlPlazo=null;a.divObservaciones=null;a.txtObservaciones=null;a.btnContinuar=null;a.defaultMoneda=null;a.defaultCuentaVinculada=null;a.defaultCuitEcheq=null;a.defaultImporte=null;a.defaultPlazo=null;a.init=function(c,d,e){a.idDefaultAccount=c;a.idDefaultProfile=d;a.defaultMoneda=Core.Enums.Currency.Pesos.idMoneda;a.defaultCuentaVinculada="";a.defaultCuitEcheq="";a.defaultImporte="";a.defaultPlazo=Core.Enums.ePlazo.CI;$.extend(true,a,e);a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[d]);if(Core.Objects.Context.TieneC4D==1){Core.loadPage("operar-transferencias.html",function(){document.title="Operar Transferencias";a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,c,d,function(){a.loaded=false;a.header.hideAccounts();a.loadControls()},"Core.Business.Operar.Transferencias")})}else{var b=new Core.Controls.Dialog("Aviso","<p>Para poder Operar debe generar el código de operación de cuatro dígitos desde Configuración de Cuenta.<br/> <a onclick=\"$('.close-btn').click(); Core.Business.AccountSettings.init("+c+", "+d+');">Haga Click Aquí para ir a Configuración de Cuenta.</a></p>',{displayButtons:{close:true,accept:false}}).show()}};a.initControls=function(){a.ddlCuenta=$(".dropdown-cuenta");a.ddlMoneda=$(".dropdown-monedas");a.divTipoTransferencia=$(".div-tipo-transferencia");a.divTipoTransferencia.hide();a.chkTipoTransferenciaEcheq=$(".chk-tipo-transferencia-echeq");a.chkTipoTransferenciaTransferenciaACuentaBancaria=$(".chk-tipo-transferencia-transferencia-a-cuenta-bancaria");a.divCuentaVinculada=$(".div-cuenta-vinculada");a.ddlCuentaVinculada=$(".dropdown-cuenta-vinculada");a.divCuitEcheq=$(".div-cuit-echeq");a.divCuitEcheq.hide();a.ddlCuitEcheq=$(".dropdown-cuit-echeq");a.lblCuenta=$(".label-cuenta");a.divDisponible=$(".div-disponible");a.lblDisponible=$(".label-disponible");a.txtImporte=$(".textbox-importe");a.btnContinuar=$(".btn-continuar");a.ddlPlazo=$(".dropdown-plazo");a.divObservaciones=$(".div-observaciones");a.txtObservaciones=$(".text-observaciones");var c=0;if(a.idDefaultAccount>0){for(var b=0;(b<Core.Objects.Accounts.length&&c==0);b++){if(Core.Objects.Accounts[b].idCuenta==a.idDefaultAccount){c=b}}}a.ddlCuenta.shieldDropDown({dataSource:{data:Core.Objects.Context.Configuration.idAplicacion==1?Core.Objects.Accounts:[Core.Objects.Accounts[c]]},valueTemplate:"{idCuenta}",textTemplate:"{idCuenta} | {Descripcion}",selected:(Core.Objects.Context.Configuration.idAplicacion==1?c:0),enabled:(Core.Objects.Context.Configuration.idAplicacion==1),events:{select:function(d){if(a.ddlCuenta.swidget().selectedItem()&&!a.ddlCuenta.swidget().selectedItem().NumCambio){a.header.setSelectedAccount(a.ddlCuenta.swidget().selectedItem())}else{a.loadControls()}}}});a.ddlMoneda.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{idMoneda}",value:a.defaultMoneda.toString(),events:{select:function(d){a.setControlsByMoneda(a.ddlMoneda.swidget().selectedItem().idMoneda);a.setDisponible(a.ddlMoneda.swidget().selectedItem().idMoneda,a.ddlPlazo.swidget().selectedItem().value);a.txtImporte.swidget().value("")}}});a.chkTipoTransferenciaTransferenciaACuentaBancaria.shieldRadioButton({label:"Transferencia a Cuenta Bancaria",checked:true,events:{click:function(d){a.setControlsByTipoTransferencia()}}});a.chkTipoTransferenciaEcheq.shieldRadioButton({label:"Echeq",checked:false,events:{click:function(d){a.setControlsByTipoTransferencia()}}});a.ddlCuentaVinculada.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idCuentaBancaria}",textTemplate:"{Descripcion}",value:a.defaultCuentaVinculada,autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""}]}}});a.ddlCuitEcheq.shieldComboBox({dataSource:{data:[]},valueTemplate:"{CUIT}",textTemplate:"{Descripcion}",value:a.defaultCuitEcheq,autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""}]}}});a.txtImporte.shieldNumericTextBox({min:0,step:1e-06,max:999999999,spinners:false,value:a.defaultImporte});a.ddlPlazo.shieldDropDown({dataSource:{data:[]},valueTemplate:"{value}",textTemplate:"{description}",value:a.defaultPlazo.toString(),events:{select:function(d){a.setDisponible(a.ddlMoneda.swidget().selectedItem().idMoneda,d.item.value)}}});a.txtObservaciones.shieldTextBox({});if(Core.Objects.Context.Configuration.idAplicacion==1){a.divObservaciones.hide()}a.btnContinuar.click(function(){a.btnContinuarClick()})};a.loadControls=function(){if(a.ddlCuenta.swidget().selectedItem()){if(!a.ddlCuenta.swidget().selectedItem().NumCambio){Core.Functions.Operar.setComitente(a.lblCuenta,a.header.selectedIdAccount,a.loaded)}else{a.lblCuenta.text("Cuenta Nº "+a.ddlCuenta.swidget().selectedItem().NumCambio+" | "+a.ddlCuenta.swidget().selectedItem().Descripcion)}var b=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,requestUrl:"detalledisponible/"+encodeURIComponent(a.ddlCuenta.swidget().selectedItem().idCuenta),requestType:"GET",requestData:{Fecha:Core.Functions.Date.getDateAsString(new Date())}});b.onSuccess=function(i){function f(j){var k=j.split("/");return k[2]+k[1]+k[0]}a.detalleDisponible=i;var h=a.ddlPlazo.swidget().initialOptions;var c=[];var d=Core.Functions.Date.getDateAsString(new Date());if(d<=f(a.detalleDisponible.disponible[0].FechaCI)){c.push({value:Core.Enums.ePlazo.CI,description:"Hoy "+a.detalleDisponible.disponible[0].FechaCI})}if(d<=f(a.detalleDisponible.disponible[0].Fecha24)){c.push({value:Core.Enums.ePlazo.D24,description:"24hs "+a.detalleDisponible.disponible[0].Fecha24})}if(d<=f(a.detalleDisponible.disponible[0].Fecha48)){c.push({value:Core.Enums.ePlazo.D48,description:"48hs "+a.detalleDisponible.disponible[0].Fecha48})}if(d<=f(a.detalleDisponible.disponible[0].Fecha72)){c.push({value:Core.Enums.ePlazo.D72,description:"72hs "+a.detalleDisponible.disponible[0].Fecha72})}h.dataSource.data=c;a.ddlPlazo.swidget().refresh(h);var g=[];if(a.ddlCuenta.swidget().selectedItem().idNegocio==Core.Enums.eNegocio.BCV){g.push(Core.Enums.Currency.Pesos);g.push(Core.Enums.Currency.Dolares)}var e=$.grep(a.detalleDisponible.disponible,function(k,j){return k.idMoneda==Core.Enums.Currency.DolaresCable.idMoneda})[0];if(a.ddlCuenta.swidget().selectedItem().idNegocio==Core.Enums.eNegocio.BCI||Core.Objects.Context.Configuration.idAplicacion!=1||(e&&(e.DisponibleOperable24!=0||e.DisponibleOperable48!=0||e.DisponibleOperable72!=0||e.DisponibleOperableCI!=0||e.DisponibleOperableFuturo!=0))){g.push(Core.Enums.Currency.DolaresCable)}var h=a.ddlMoneda.swidget().initialOptions;h.dataSource.data=g;a.ddlMoneda.swidget().refresh(h);a.setControlsByMoneda(a.ddlMoneda.swidget().selectedItem().idMoneda);a.setDisponible(a.ddlMoneda.swidget().selectedItem().idMoneda,a.ddlPlazo.swidget().selectedItem().value)};b.request()}};a.setControlsByMoneda=function(b){var c=new Core.Ajax.ServerRequest({showOverlay:!a.loaded,secureRequest:true,requestUrl:"cuentasbancariasvinculadas/"+a.ddlCuenta.swidget().selectedItem().idCuenta,requestType:"GET"});c.onSuccess=function(e){var d=a.ddlCuentaVinculada.swidget().initialOptions;d.dataSource.data=$.grep(e.cuentasbancarias,function(g,f){return g.idMoneda==b&&g.idCuentaBancaria>0});a.ddlCuentaVinculada.swidget().refresh(d);var d=a.ddlCuitEcheq.swidget().initialOptions;d.dataSource.data=e.cuits?e.cuits:[];a.ddlCuitEcheq.swidget().refresh(d);a.divTipoTransferencia.hide();a.divCuitEcheq.hide();a.divCuentaVinculada.show();if(b==Core.Enums.Currency.Pesos.idMoneda&&a.pageOptions&&a.pageOptions.permiteEcheq){a.divTipoTransferencia.show();a.setControlsByTipoTransferencia()}};c.request()};a.setControlsByTipoTransferencia=function(){a.divCuitEcheq.hide();a.divCuentaVinculada.hide();if(a.chkTipoTransferenciaEcheq.swidget().checked()){a.divCuitEcheq.show()}else{a.divCuentaVinculada.show()}};a.setDisponible=function(b,c){a.divDisponible.hide();Core.Functions.Operar.setDisponible(a.detalleDisponible.transferible,b,c,a.lblDisponible,a.divDisponible)};a.btnContinuarClick=function(){var d={value:true};var b={idCuenta:Core.Functions.Validations.getValidatedDropDownValue(a.ddlCuenta,d),Plazo:Core.Functions.Validations.getValidatedDropDownValue(a.ddlPlazo,d),idMoneda:Core.Functions.Validations.getValidatedDropDownValue(a.ddlMoneda,d),Monto:Core.Functions.Validations.getValidatedNumericSwidgetValue(a.txtImporte,d),Observaciones:a.txtObservaciones.val()};if(a.ddlMoneda.swidget().value()==Core.Enums.Currency.Pesos.idMoneda&&a.chkTipoTransferenciaEcheq.swidget().checked()){b.CUITEcheq=Core.Functions.Validations.getValidatedDropDownValue(a.ddlCuitEcheq,d)}else{b.idCuentaBancaria=Core.Functions.Validations.getValidatedDropDownValue(a.ddlCuentaVinculada,d)}if(!d.value){return}var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"operar/transferencias/solicitud",requestType:"POST",requestData:b});c.onSuccess=function(i){var f="";if(a.ddlCuenta.swidget().selectedItem().NumCambio){f="Cuenta Nº "+a.ddlCuenta.swidget().selectedItem().NumCambio+" | "+a.ddlCuenta.swidget().selectedItem().Descripcion}else{f="Comitente N°"+i.NumComitente+" - "+i.DescripcionCuenta}var g="S.E:U.O. (Salvo error u omisión) <br />La fecha de acreditación dependerá del horario de la solicitud de transfencia y del procesamiento del banco de destino.";g+=(a.ddlMoneda.swidget().selectedItem().idMoneda!=Core.Enums.Currency.Pesos.idMoneda)?"<br />NOTA: En el caso de necesitar conversión de divisas, la operación puede demorar hasta 48hs hábiles.":"";var h={data:i,idDefaultProfile:a.idDefaultProfile,idAccount:a.ddlCuenta.swidget().selectedItem().idCuenta,idAccountToContinue:a.header.selectedIdAccount,generalTitle:"CONFIRMACION DE ORDEN",title:"Transferencia a Cuenta Vinculada",accountDescription:f,footerHtml:g,urlMethod:"operar/transferencias/confirmar",codigo4DDescription:"Ingrese su código de operación de cuatro dígitos:",onConfirm:function(){Core.Functions.Operar.refreshDisponible(a.detalleDisponible,function(){a.setDisponible(a.ddlMoneda.swidget().selectedItem().idMoneda,a.ddlPlazo.swidget().selectedItem().value)},a.ddlCuenta.swidget().selectedItem().idCuenta,a.loaded)}};var e=new Core.Controls.OperarConfirmation(h).show()};c.request()};a.clearControls=function(){a.ddlMoneda.swidget().selected(0,true);a.ddlCuentaVinculada.swidget().selected(0,true);a.ddlCuitEcheq.swidget().selected(0,true);a.txtImporte.swidget().value("");a.ddlPlazo.swidget().selected(0,true);a.txtObservaciones.val("")}};Core.Business.OperarTransfTitulos=new function(){var a=this;a.id="transferencias/titulos";a.init=function(c,d,e){a.idDefaultAccount=c;a.idDefaultProfile=d;$.extend(true,a,e);if(Core.Objects.Context.TieneC4D==1){Core.loadPage("operar-transferencias-titulos.html",function(){document.title="Operar Transferencias Títulos";a.idStatementAdjunto=null;a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(true,c,d,function(){a.loadControls()},"Core.Business.OperarTransfTitulos")})}else{var b=new Core.Controls.Dialog("Aviso","<p>Para poder Operar debe generar el código de operación de cuatro dígitos desde Configuración de Cuenta.<br/> <a onclick=\"$('.close-btn').click(); Core.Business.AccountSettings.init("+c+", "+d+');">Haga Click Aquí para ir a Configuración de Cuenta.</a></p>',{displayButtons:{close:true,accept:false}}).show()}};a.initControls=function(){a.divMain=$(".div-main");a.divCuenta=$(".div-cuenta");a.lblCuenta=$(".label-cuenta");a.ddlEmisorReceptor=$(".dropdown-emisor-receptor");a.ddlEmisorReceptor.shieldDropDown({dataSource:{data:[]},textTemplate:"{texto}",valueTemplate:"{inicial}",events:{select:function(b){a.setControlsByEmisorReceptor(function(){a.setControlsByAgente()});Core.Functions.Operar.setColorByTipoOperacion(a.ddlEmisorReceptor.swidget().value(),a.divMain,a.divCuenta)}}});a.ddlPaisContraparte=$(".dropdown-pais-contraparte");a.ddlPaisContraparte.shieldDropDown({dataSource:{data:[]},textTemplate:"{pais}",valueTemplate:"{id}",events:{select:function(b){a.setControlsByPais()}}});a.ddlAgenteContraparte=$(".dropdown-agente-contraparte");a.ddlAgenteContraparte.shieldComboBox({dataSource:{data:[]},textTemplate:"{CodigoAgente} | {Agente}",valueTemplate:"{id}",autoComplete:{enabled:true,filter:{or:[{path:"CodigoAgente",filter:"contains",value:""},{path:"Agente",filter:"contains",value:""}]}},events:{select:function(b){a.setControlsByAgente()}}});a.divCuentaVinculada=$(".div-cuenta-vinculada");a.ddlCuentaVinculada=$(".dropdown-cuenta-vinculada");a.ddlCuentaVinculada.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{idCuentaVinculada}",events:{select:function(b){a.setControlsByCuentaVinculada()}}});a.divComitenteContraparte=$(".div-comitente-contraparte");a.txtComitenteContraparte=$(".textbox-comitente-contraparte");new Core.Controls.DecimalPicker(a.txtComitenteContraparte,{maxDecimalDigitCount:0,showThousandsSeparator:"",onChange:function(){a.setDescripcionComitente()}});a.divDescripcionComitenteContraparte=$(".div-descripcion-comitente-contraparte");a.lblDescripcionComitenteContraparte=$(".lbl-descripcion-comitente-contraparte");a.ddlEspecie=$(".dropdown-especie");a.ddlEspecie.shieldComboBox({dataSource:{data:[]},valueTemplate:"{DisplayTicker}",textTemplate:"{DisplayTicker} | {Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}}});a.txtCantidad=$(".textbox-cantidad");new Core.Controls.DecimalPicker(a.txtCantidad,{maxDecimalDigitCount:2,showThousandsSeparator:""});a.divStatementAdjunto=$(".div-statement-adjunto");a.fileUpload=new Core.Controls.FileUpload(a.divStatementAdjunto,{urlMethod:Core.PrefixUrl+"upload/documento/39",fileTypes:{"image/jpeg":"image/jpeg","image/png":"image/png","image/gif":"image/gif","application/pdf":"application/pdf"},maxSize:10485760,onLoad:function(b){a.idStatementAdjunto=b.idArchivo},onFileChange:function(){a.idStatementAdjunto=null},onError:function(){a.idStatementAdjunto=null;var b=new Core.Controls.Dialog("Error","No se ha podido adjuntar el archivo",{displayButtons:{close:true,accept:false}});b.show();return}});a.txtObservaciones=$(".text-observaciones");a.txtObservaciones.shieldTextBox({});a.btnContinuar=$(".btn-continuar");a.btnContinuar.click(function(){a.btnContinuarClick()})};a.loadControls=function(){Core.Functions.Operar.setColorByTipoOperacion(null,a.divMain,a.divCuenta);Core.Functions.Operar.setComitente(a.lblCuenta,a.header.selectedIdAccount,false);var b=new Core.Ajax.ServerRequest({overlayElement:a.divMain,showOverlay:true,secureRequest:true,requestUrl:"transf-titulos/emisor-receptor",requestType:"GET"});b.onSuccess=function(d){var c=a.ddlEmisorReceptor.swidget().initialOptions;c.dataSource.data=d.emirec?d.emirec:[];a.ddlEmisorReceptor.swidget().refresh(c);Core.Functions.Operar.setColorByTipoOperacion(a.ddlEmisorReceptor.swidget().value(),a.divMain,a.divCuenta);var e=new Core.Ajax.ServerRequest({overlayElement:a.divMain,showOverlay:true,secureRequest:true,requestUrl:"transf-titulos/paises/"+a.header.selectedIdAccount,requestType:"GET"});e.onSuccess=function(g){var f=a.ddlPaisContraparte.swidget().initialOptions;f.dataSource.data=g.paises?g.paises:[];a.ddlPaisContraparte.swidget().refresh(f);a.setControlsByPais()};e.request()};b.request()};a.setControlsByPais=function(){var b=new Core.Ajax.ServerRequest({overlayElement:a.divMain,showOverlay:true,secureRequest:true,requestUrl:"transf-titulos/agentes/"+a.header.selectedIdAccount+"/"+a.ddlPaisContraparte.swidget().value(),requestType:"GET"});b.onSuccess=function(d){var c=a.ddlAgenteContraparte.swidget().initialOptions;c.dataSource.data=d.agentes?d.agentes:[];c.value=(a.ddlPaisContraparte.swidget().value()==1?"150":"");a.ddlAgenteContraparte.swidget().refresh(c);a.setControlsByEmisorReceptor(function(){a.setControlsByAgente()})};b.request()};a.setControlsByEmisorReceptor=function(b){var c={plazo:Core.Enums.ePlazo.CI};var d=$.grep(Core.Objects.Accounts,function(g,f){return g.idCuenta==a.header.selectedIdAccount})[0];if(d&&d.idNegocio==Core.Enums.eNegocio.BCI){c.panel=Core.Enums.ePanel.TransferenciasTitulosInternacionalBCI}else{c.panel=(a.ddlPaisContraparte.swidget().value()==1?Core.Enums.ePanel.TransferenciasTitulosArgentina:Core.Enums.ePanel.TransferenciasTitulosInternacional)}if(a.ddlEmisorReceptor.swidget().value()=="E"){c.idCuenta=a.header.selectedIdAccount}var e=new Core.Ajax.ServerRequest({overlayElement:a.divMain,showOverlay:true,secureRequest:true,requestUrl:"especies",requestType:"GET",requestData:c});e.onSuccess=function(g){var f=a.ddlEspecie.swidget().initialOptions;f.dataSource.data=g.especies?g.especies:[];if(a.ddlEmisorReceptor.swidget().value()=="E"){f.textTemplate="{DisplayTicker} ({Cantidad}) | {Descripcion}"}else{f.textTemplate="{DisplayTicker} | {Descripcion}"}a.ddlEspecie.swidget().refresh(f);if(b){b()}};e.request()};a.setControlsByAgente=function(){if(a.ddlEmisorReceptor.swidget().value()=="E"&&a.ddlAgenteContraparte.swidget().selectedItem()&&a.ddlAgenteContraparte.swidget().selectedItem().PerteneceGrupo>0){var b=new Core.Ajax.ServerRequest({overlayElement:a.divMain,showOverlay:true,secureRequest:true,requestUrl:"/transf-titulos/cuentas-vinculadas/"+a.header.selectedIdAccount+"/"+a.ddlAgenteContraparte.swidget().selectedItem().PerteneceGrupo,requestType:"GET"});b.onSuccess=function(e){a.divCuentaVinculada.show();var c=e.cuentas?e.cuentas:[];c.push({idCuentaVinculada:0,Descripcion:"Otro"});var d=a.ddlCuentaVinculada.swidget().initialOptions;d.dataSource.data=c;a.ddlCuentaVinculada.swidget().refresh(d);a.setControlsByCuentaVinculada()};b.request()}else{a.divCuentaVinculada.hide();a.divComitenteContraparte.show();a.setDescripcionComitente()}};a.setControlsByCuentaVinculada=function(){a.divComitenteContraparte.hide();a.divDescripcionComitenteContraparte.hide();if(a.ddlCuentaVinculada.swidget().value()==0){a.divComitenteContraparte.show();a.setDescripcionComitente()}};a.setDescripcionComitente=function(){a.divDescripcionComitenteContraparte.hide();if(a.ddlAgenteContraparte.swidget().value()==150){a.divDescripcionComitenteContraparte.show();if(a.txtComitenteContraparte.val()){var b=new Core.Ajax.ServerRequest({overlayElement:a.divMain,showOverlay:true,secureRequest:true,requestUrl:"transf-titulos/comitentes/150/"+a.txtComitenteContraparte.val(),requestType:"GET"});b.onSuccess=function(c){a.lblDescripcionComitenteContraparte.text(c&&c.Descripcion?c.Descripcion:"Comitente no encontrado")};b.request()}else{a.lblDescripcionComitenteContraparte.text("Seleccione un comitente")}}};a.btnContinuarClick=function(){var d={value:true};Core.Functions.Validations.getValidatedDropDownValue(a.ddlEspecie,d);var b={idCuenta:a.header.selectedIdAccount,inicialEmiRec:Core.Functions.Validations.getValidatedDropDownValue(a.ddlEmisorReceptor,d),idPais:Core.Functions.Validations.getValidatedDropDownValue(a.ddlPaisContraparte,d),Cantidad:Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidad,d),Ticker:(a.ddlEspecie.swidget().selectedItem()?a.ddlEspecie.swidget().selectedItem().Ticker:null),Observaciones:a.txtObservaciones.swidget().value(),idAgente:Core.Functions.Validations.getValidatedDropDownValue(a.ddlAgenteContraparte,d)};if(a.ddlEmisorReceptor.swidget().value()=="E"&&a.ddlAgenteContraparte.swidget().selectedItem()&&a.ddlAgenteContraparte.swidget().selectedItem().PerteneceGrupo>0&&a.ddlCuentaVinculada.swidget().value()>0){b.idCuentaVinculada=Core.Functions.Validations.getValidatedDropDownValue(a.ddlCuentaVinculada,d)}else{b.NumComitente=Core.Functions.Validations.getValidatedNumericInputValue(a.txtComitenteContraparte,d)}if(a.idStatementAdjunto){b.idArchivo=a.idStatementAdjunto}if(!d.value){return}var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"operar/transf-titulos/solicitud",requestType:"POST",requestData:b});c.onSuccess=function(h){var e="Comitente N°"+h.NumComitente+(h.DescripcionCuenta?(" - "+h.DescripcionCuenta):"");var f="S.E:U.O. (Salvo error u omisión) <br>Los valores son estimados; los valores finales de la operación surgiran de la ejecución misma y reflejados en el boleto.";var g={data:h,idDefaultProfile:a.idDefaultProfile,idAccount:a.header.selectedIdAccount,generalTitle:"CONFIRMACION DE ORDEN",accountDescription:e,footerHtml:f,urlMethod:"operar/transf-titulos/confirmar",codigo4DDescription:"Ingrese su código de operación de cuatro dígitos:",onConfirm:function(){a.idStatementAdjunto=null;a.fileUpload.clear();a.txtCantidad.val("")},stayInPage:(Core.Objects.Context.Configuration.idAplicacion==3),terminosYCondiciones:h.Terminos,terminosYCondicionesDescripcion:"He leído la Declaración Jurada de la Operatoria"};new Core.Controls.OperarConfirmation(g).show()};c.request()}};Core.Business.OperarTransfTitulosBO=new function(){var a=this;a.init=function(b,c){Core.Business.BaseOperarTransfTitulosBO.init(b,c,{id:"BackofficeTitulosTransferenciasInsertarBO",namespace:"Core.Business.TransfTitulosInternacionales",tipoTransferencias:Core.Business.eTipoTransferencias.Internacionales,idNegocio:Core.Enums.eNegocio.BCV})}};Core.Business.OperarTransfTitulosBOBCI=new function(){var a=this;a.init=function(b,c){Core.Business.BaseOperarTransfTitulosBO.init(b,c,{id:"BackofficeTitulosTransferenciasInsertarBOBCI",namespace:"Core.Business.TransfTitulosLocalesBCI",tipoTransferencias:Core.Business.eTipoTransferencias.Locales,idNegocio:Core.Enums.eNegocio.BCI})}};Core.Business.BaseOperarTransfTitulosBO=new function(){var a=this;a.id="";a.namespace="";a.idNegocio=0;a.init=function(c,d,e){a.idDefaultAccount=c;a.idDefaultProfile=d;a.id=e.id;a.namespace=e.namespace;a.idNegocio=e.idNegocio;if(Core.Objects.Context.TieneC4D==1){Core.loadPage("operar-transferencias-titulos-backoffice.html",function(){var f=("Operar Transferencias Títulos"+(a.idNegocio==Core.Enums.eNegocio.BCV?" BCV":" BCI"));document.title=f;a.lblTitle=$(".lbl-title");a.lblTitle.text(f);a.selectedAccount=null;a.idStatementAdjunto=null;a.initControls();a.header=new Core.Controls.Header($("#topNav"),{});a.header.init(false,c,d,function(){a.setSelectedAccount()},a.namespace)})}else{var b=new Core.Controls.Dialog("Aviso","<p>Para poder Operar debe generar el código de operación de cuatro dígitos desde Configuración de Cuenta.<br/> <a onclick=\"$('.close-btn').click(); Core.Business.AccountSettings.init("+c+", "+d+');">Haga Click Aquí para ir a Configuración de Cuenta.</a></p>',{displayButtons:{close:true,accept:false}}).show()}};a.initControls=function(){a.divMain=$(".div-main");a.divCuenta=$(".div-cuenta");a.lblCuenta=$(".label-cuenta");a.btnBuscarCuenta=$(".button-buscar-cuentas");a.btnBuscarCuenta.on("click",function(){new Core.Controls.MinutaBuscarCuenta({requestUrl:("cuentas-bo/"+a.idNegocio+"/{filter}"),onSelected:function(b){a.setSelectedAccount(b)}}).show()});a.ddlEmisorReceptor=$(".dropdown-emisor-receptor");a.ddlEmisorReceptor.shieldDropDown({dataSource:{data:[]},textTemplate:"{texto}",valueTemplate:"{inicial}",events:{select:function(b){a.setControlsByEmisorReceptor(function(){a.setControlsByAgente()});Core.Functions.Operar.setColorByTipoOperacion(a.ddlEmisorReceptor.swidget().value(),a.divMain,a.divCuenta)}}});a.ddlPaisContraparte=$(".dropdown-pais-contraparte");a.ddlPaisContraparte.shieldDropDown({dataSource:{data:[]},textTemplate:"{pais}",valueTemplate:"{id}",events:{select:function(b){a.setControlsByPais()}}});a.ddlAgenteContraparte=$(".dropdown-agente-contraparte");a.ddlAgenteContraparte.shieldComboBox({dataSource:{data:[]},textTemplate:"{CodigoAgente} | {Agente}",valueTemplate:"{id}",autoComplete:{enabled:true,filter:{or:[{path:"CodigoAgente",filter:"contains",value:""},{path:"Agente",filter:"contains",value:""}]}},events:{select:function(b){a.setControlsByAgente()}}});a.divCuentaVinculada=$(".div-cuenta-vinculada");a.ddlCuentaVinculada=$(".dropdown-cuenta-vinculada");a.ddlCuentaVinculada.shieldDropDown({dataSource:{data:[]},textTemplate:"{Descripcion}",valueTemplate:"{idCuentaVinculada}",events:{select:function(b){a.setControlsByCuentaVinculada()}}});a.divComitenteContraparte=$(".div-comitente-contraparte");a.txtComitenteContraparte=$(".textbox-comitente-contraparte");new Core.Controls.DecimalPicker(a.txtComitenteContraparte,{maxDecimalDigitCount:0,showThousandsSeparator:"",onChange:function(){a.setDescripcionComitente()}});a.divDescripcionComitenteContraparte=$(".div-descripcion-comitente-contraparte");a.lblDescripcionComitenteContraparte=$(".lbl-descripcion-comitente-contraparte");a.ddlEspecie=$(".dropdown-especie");a.ddlEspecie.shieldComboBox({dataSource:{data:[]},valueTemplate:"{DisplayTicker}",textTemplate:"{DisplayTicker} | {Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}}});a.txtCantidad=$(".textbox-cantidad");new Core.Controls.DecimalPicker(a.txtCantidad,{maxDecimalDigitCount:2,showThousandsSeparator:""});a.divStatementAdjunto=$(".div-statement-adjunto");new Core.Controls.FileUpload(a.divStatementAdjunto,{urlMethod:Core.PrefixUrl+"upload/documento/39",fileTypes:{"image/jpeg":"image/jpeg","image/png":"image/png","image/gif":"image/gif","application/pdf":"application/pdf"},maxSize:10485760,onLoad:function(b){a.idStatementAdjunto=b.idArchivo},onFileChange:function(){a.idStatementAdjunto=null},onError:function(){a.idStatementAdjunto=null;var b=new Core.Controls.Dialog("Error","No se ha podido adjuntar el archivo",{displayButtons:{close:true,accept:false}});b.show();return}});a.txtObservaciones=$(".text-observaciones");a.txtObservaciones.shieldTextBox({});a.btnContinuar=$(".btn-continuar");a.btnContinuar.click(function(){var d={value:true};Core.Functions.Validations.getValidatedDropDownValue(a.ddlEspecie,d);var b={idCuenta:a.selectedAccount.idCuenta,inicialEmiRec:Core.Functions.Validations.getValidatedDropDownValue(a.ddlEmisorReceptor,d),idPais:Core.Functions.Validations.getValidatedDropDownValue(a.ddlPaisContraparte,d),Cantidad:Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidad,d),Ticker:(a.ddlEspecie.swidget().selectedItem()?a.ddlEspecie.swidget().selectedItem().Ticker:null),Observaciones:a.txtObservaciones.swidget().value(),idAgente:Core.Functions.Validations.getValidatedDropDownValue(a.ddlAgenteContraparte,d)};if(a.ddlEmisorReceptor.swidget().value()=="E"&&a.ddlAgenteContraparte.swidget().selectedItem()&&a.ddlAgenteContraparte.swidget().selectedItem().PerteneceGrupo>0&&a.ddlCuentaVinculada.swidget().value()>0){b.idCuentaVinculada=Core.Functions.Validations.getValidatedDropDownValue(a.ddlCuentaVinculada,d)}else{b.NumComitente=Core.Functions.Validations.getValidatedNumericInputValue(a.txtComitenteContraparte,d)}if(a.idStatementAdjunto){b.idArchivo=a.idStatementAdjunto}if(!d.value){return}var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"operar/transf-titulos/solicitud",requestType:"POST",requestData:b});c.onSuccess=function(h){var e="Comitente N°"+h.NumComitente+(h.DescripcionCuenta?(" - "+h.DescripcionCuenta):"");var f="S.E:U.O. (Salvo error u omisión) <br>Los valores son estimados; los valores finales de la operación surgiran de la ejecución misma y reflejados en el boleto.";var g={data:h,idDefaultProfile:a.idDefaultProfile,idAccount:a.selectedAccount.idCuenta,generalTitle:"CONFIRMACION DE ORDEN",accountDescription:e,footerHtml:f,urlMethod:"operar/transf-titulos/confirmar",codigo4DDescription:"Ingrese su código de operación de cuatro dígitos:",onConfirm:function(){var i=new Core.Controls.Dialog("Aviso","Orden ingresada correctamente.",{displayButtons:{close:true,accept:false}});i.show();a.selectedAccount=null;a.divMain.hide()},stayInPage:true,terminosYCondiciones:h.Terminos,terminosYCondicionesDescripcion:"He leído la Declaración Jurada de la Operatoria"};new Core.Controls.OperarConfirmation(g).show()};c.request()})};a.setSelectedAccount=function(b){a.selectedAccount=b;a.divMain.hide();if(a.selectedAccount){a.divMain.show();a.loadControls()}};a.loadControls=function(){Core.Functions.Operar.setColorByTipoOperacion(null,a.divMain,a.divCuenta);Core.Functions.Operar.setComitente(a.lblCuenta,a.selectedAccount.idCuenta,false);var b=new Core.Ajax.ServerRequest({overlayElement:a.divMain,showOverlay:true,secureRequest:true,requestUrl:"transf-titulos/emisor-receptor",requestType:"GET"});b.onSuccess=function(d){var c=a.ddlEmisorReceptor.swidget().initialOptions;c.dataSource.data=d.emirec?d.emirec:[];a.ddlEmisorReceptor.swidget().refresh(c);Core.Functions.Operar.setColorByTipoOperacion(a.ddlEmisorReceptor.swidget().value(),a.divMain,a.divCuenta);var e=new Core.Ajax.ServerRequest({overlayElement:a.divMain,showOverlay:true,secureRequest:true,requestUrl:"transf-titulos/paises/"+a.selectedAccount.idCuenta,requestType:"GET"});e.onSuccess=function(g){var f=a.ddlPaisContraparte.swidget().initialOptions;f.dataSource.data=g.paises?g.paises:[];a.ddlPaisContraparte.swidget().refresh(f);a.setControlsByPais()};e.request()};b.request()};a.setControlsByPais=function(){var b=new Core.Ajax.ServerRequest({overlayElement:a.divMain,showOverlay:true,secureRequest:true,requestUrl:"transf-titulos/agentes/"+a.selectedAccount.idCuenta+"/"+a.ddlPaisContraparte.swidget().value(),requestType:"GET"});b.onSuccess=function(d){var c=a.ddlAgenteContraparte.swidget().initialOptions;c.dataSource.data=d.agentes?d.agentes:[];c.value=(a.ddlPaisContraparte.swidget().value()==1?"150":"");a.ddlAgenteContraparte.swidget().refresh(c);a.setControlsByEmisorReceptor(function(){a.setControlsByAgente()})};b.request()};a.setControlsByEmisorReceptor=function(b){var c={plazo:Core.Enums.ePlazo.CI};c.panel=(a.ddlPaisContraparte.swidget().value()==1?Core.Enums.ePanel.TransferenciasTitulosArgentina:Core.Enums.ePanel.TransferenciasTitulosInternacional);if(a.ddlEmisorReceptor.swidget().value()=="E"){c.idCuenta=a.selectedAccount.idCuenta}var d=new Core.Ajax.ServerRequest({overlayElement:a.divMain,showOverlay:true,secureRequest:true,requestUrl:"especies",requestType:"GET",requestData:c});d.onSuccess=function(f){var e=a.ddlEspecie.swidget().initialOptions;e.dataSource.data=f.especies?f.especies:[];if(a.ddlEmisorReceptor.swidget().value()=="E"){e.textTemplate="{DisplayTicker} ({Cantidad}) | {Descripcion}"}else{e.textTemplate="{DisplayTicker} | {Descripcion}"}a.ddlEspecie.swidget().refresh(e);if(b){b()}};d.request()};a.setControlsByAgente=function(){if(a.ddlEmisorReceptor.swidget().value()=="E"&&a.ddlAgenteContraparte.swidget().selectedItem()&&a.ddlAgenteContraparte.swidget().selectedItem().PerteneceGrupo>0){var b=new Core.Ajax.ServerRequest({overlayElement:a.divMain,showOverlay:true,secureRequest:true,requestUrl:"/transf-titulos/cuentas-vinculadas/"+a.selectedAccount.idCuenta+"/"+a.ddlAgenteContraparte.swidget().selectedItem().PerteneceGrupo,requestType:"GET"});b.onSuccess=function(e){a.divCuentaVinculada.show();var c=e.cuentas?e.cuentas:[];c.push({idCuentaVinculada:0,Descripcion:"Otro"});var d=a.ddlCuentaVinculada.swidget().initialOptions;d.dataSource.data=c;a.ddlCuentaVinculada.swidget().refresh(d);a.setControlsByCuentaVinculada()};b.request()}else{a.divCuentaVinculada.hide();a.divComitenteContraparte.show();a.setDescripcionComitente()}};a.setControlsByCuentaVinculada=function(){a.divComitenteContraparte.hide();a.divDescripcionComitenteContraparte.hide();if(a.ddlCuentaVinculada.swidget().value()==0){a.divComitenteContraparte.show();a.setDescripcionComitente()}};a.setDescripcionComitente=function(){a.divDescripcionComitenteContraparte.hide();if(a.ddlAgenteContraparte.swidget().value()==150){a.divDescripcionComitenteContraparte.show();if(a.txtComitenteContraparte.val()){var b=new Core.Ajax.ServerRequest({overlayElement:a.divMain,showOverlay:true,secureRequest:true,requestUrl:"transf-titulos/comitentes/150/"+a.txtComitenteContraparte.val(),requestType:"GET"});b.onSuccess=function(c){a.lblDescripcionComitenteContraparte.text(c&&c.Descripcion?c.Descripcion:"Comitente no encontrado")};b.request()}else{a.lblDescripcionComitenteContraparte.text("Seleccione un comitente")}}}};var LZString=(function(){var b=String.fromCharCode;var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$";var a={};function c(f,h){if(!a[f]){a[f]={};for(var j=0;j<f.length;j++){a[f][f.charAt(j)]=j}}return a[f][h]}var g={compressToBase64:function(f){if(f==null){return""}var h=g._compress(f,6,function(i){return d.charAt(i)});switch(h.length%4){default:case 0:return h;case 1:return h+"===";case 2:return h+"==";case 3:return h+"="}},decompressFromBase64:function(f){if(f==null){return""}if(f==""){return null}return g._decompress(f.length,32,function(h){return c(d,f.charAt(h))})},compressToUTF16:function(f){if(f==null){return""}return g._compress(f,15,function(h){return b(h+32)})+" "},decompressFromUTF16:function(f){if(f==null){return""}if(f==""){return null}return g._decompress(f.length,16384,function(h){return f.charCodeAt(h)-32})},compressToUint8Array:function(m){var h=g.compress(m);var f=new Uint8Array(h.length*2);for(var k=0,l=h.length;k<l;k++){var j=h.charCodeAt(k);f[k*2]=j>>>8;f[k*2+1]=j%256}return f},decompressFromUint8Array:function(h){if(h===null||h===undefined){return g.decompress(h)}else{var f=new Array(h.length/2);for(var j=0,l=f.length;j<l;j++){f[j]=h[j*2]*256+h[j*2+1]}var k=[];f.forEach(function(i){k.push(b(i))});return g.decompress(k.join(""))}},compressToEncodedURIComponent:function(f){if(f==null){return""}return g._compress(f,6,function(h){return e.charAt(h)})},decompressFromEncodedURIComponent:function(f){if(f==null){return""}if(f==""){return null}f=f.replace(/ /g,"+");return g._decompress(f.length,32,function(h){return c(e,f.charAt(h))})},compress:function(f){return g._compress(f,16,function(h){return b(h)})},_compress:function(w,f,t){if(w==null){return""}var u,x,m={},n={},h="",s="",r="",p=2,o=3,q=2,j=[],l=0,k=0,v;for(v=0;v<w.length;v+=1){h=w.charAt(v);if(!Object.prototype.hasOwnProperty.call(m,h)){m[h]=o++;n[h]=true}s=r+h;if(Object.prototype.hasOwnProperty.call(m,s)){r=s}else{if(Object.prototype.hasOwnProperty.call(n,r)){if(r.charCodeAt(0)<256){for(u=0;u<q;u++){l=(l<<1);if(k==f-1){k=0;j.push(t(l));l=0}else{k++}}x=r.charCodeAt(0);for(u=0;u<8;u++){l=(l<<1)|(x&1);if(k==f-1){k=0;j.push(t(l));l=0}else{k++}x=x>>1}}else{x=1;for(u=0;u<q;u++){l=(l<<1)|x;if(k==f-1){k=0;j.push(t(l));l=0}else{k++}x=0}x=r.charCodeAt(0);for(u=0;u<16;u++){l=(l<<1)|(x&1);if(k==f-1){k=0;j.push(t(l));l=0}else{k++}x=x>>1}}p--;if(p==0){p=Math.pow(2,q);q++}delete n[r]}else{x=m[r];for(u=0;u<q;u++){l=(l<<1)|(x&1);if(k==f-1){k=0;j.push(t(l));l=0}else{k++}x=x>>1}}p--;if(p==0){p=Math.pow(2,q);q++}m[s]=o++;r=String(h)}}if(r!==""){if(Object.prototype.hasOwnProperty.call(n,r)){if(r.charCodeAt(0)<256){for(u=0;u<q;u++){l=(l<<1);if(k==f-1){k=0;j.push(t(l));l=0}else{k++}}x=r.charCodeAt(0);for(u=0;u<8;u++){l=(l<<1)|(x&1);if(k==f-1){k=0;j.push(t(l));l=0}else{k++}x=x>>1}}else{x=1;for(u=0;u<q;u++){l=(l<<1)|x;if(k==f-1){k=0;j.push(t(l));l=0}else{k++}x=0}x=r.charCodeAt(0);for(u=0;u<16;u++){l=(l<<1)|(x&1);if(k==f-1){k=0;j.push(t(l));l=0}else{k++}x=x>>1}}p--;if(p==0){p=Math.pow(2,q);q++}delete n[r]}else{x=m[r];for(u=0;u<q;u++){l=(l<<1)|(x&1);if(k==f-1){k=0;j.push(t(l));l=0}else{k++}x=x>>1}}p--;if(p==0){p=Math.pow(2,q);q++}}x=2;for(u=0;u<q;u++){l=(l<<1)|(x&1);if(k==f-1){k=0;j.push(t(l));l=0}else{k++}x=x>>1}while(true){l=(l<<1);if(k==f-1){j.push(t(l));break}else{k++}}return j.join("")},decompress:function(f){if(f==null){return""}if(f==""){return null}return g._decompress(f.length,32768,function(h){return f.charCodeAt(h)})},_decompress:function(q,x,o){var k=[],s,m=4,l=4,t=3,n="",y=[],p,z,f,v,r,u,h,j={val:o(0),position:x,index:1};for(p=0;p<3;p+=1){k[p]=p}f=0;r=Math.pow(2,2);u=1;while(u!=r){v=j.val&j.position;j.position>>=1;if(j.position==0){j.position=x;j.val=o(j.index++)}f|=(v>0?1:0)*u;u<<=1}switch(s=f){case 0:f=0;r=Math.pow(2,8);u=1;while(u!=r){v=j.val&j.position;j.position>>=1;if(j.position==0){j.position=x;j.val=o(j.index++)}f|=(v>0?1:0)*u;u<<=1}h=b(f);break;case 1:f=0;r=Math.pow(2,16);u=1;while(u!=r){v=j.val&j.position;j.position>>=1;if(j.position==0){j.position=x;j.val=o(j.index++)}f|=(v>0?1:0)*u;u<<=1}h=b(f);break;case 2:return""}k[3]=h;z=h;y.push(h);while(true){if(j.index>q){return""}f=0;r=Math.pow(2,t);u=1;while(u!=r){v=j.val&j.position;j.position>>=1;if(j.position==0){j.position=x;j.val=o(j.index++)}f|=(v>0?1:0)*u;u<<=1}switch(h=f){case 0:f=0;r=Math.pow(2,8);u=1;while(u!=r){v=j.val&j.position;j.position>>=1;if(j.position==0){j.position=x;j.val=o(j.index++)}f|=(v>0?1:0)*u;u<<=1}k[l++]=b(f);h=l-1;m--;break;case 1:f=0;r=Math.pow(2,16);u=1;while(u!=r){v=j.val&j.position;j.position>>=1;if(j.position==0){j.position=x;j.val=o(j.index++)}f|=(v>0?1:0)*u;u<<=1}k[l++]=b(f);h=l-1;m--;break;case 2:return y.join("")}if(m==0){m=Math.pow(2,t);t++}if(k[h]){n=k[h]}else{if(h===l){n=z+z.charAt(0)}else{return null}}y.push(n);k[l++]=z+n.charAt(0);m--;z=n;if(m==0){m=Math.pow(2,t);t++}}}};return g})();if(typeof define==="function"&&define.amd){define(function(){return LZString})}else{if(typeof module!=="undefined"&&module!=null){module.exports=LZString}else{if(typeof angular!=="undefined"&&angular!=null){angular.module("LZString",[]).factory("LZString",function(){return LZString})}}}Core.Controls={};Core.Controls.ActualizarIdExternoOrdenTesoreria=function(b){var a=this;a.divModal=$(".div-orden-actualizar-id-externo");a.lblTitle=null;a.divMoneda=null;a.lblMoneda=null;a.divTicker=null;a.lblTicker=null;a.divTipo=null;a.lblTipo=null;a.divMonto=null;a.lblMonto=null;a.divCantidad=null;a.lblCantidad=null;a.txtIdExterno=null;a.orden=null;a.onSuccess=function(){};$.extend(true,a,b);a.show=function(){a.lblTitle=a.divModal.find(".title");a.lblTitle.text("Actualizar Id Externo - Orden: "+a.orden.idOrden);a.divMoneda=a.divModal.find(".div-orden-moneda");a.lblMoneda=a.divModal.find(".label-orden-moneda");if(a.orden.Moneda){a.lblMoneda.text(a.orden.Moneda);a.divMoneda.show()}else{a.divMoneda.hide()}a.divTicker=a.divModal.find(".div-orden-ticker");a.lblTicker=a.divModal.find(".label-orden-ticker");if(a.orden.Ticker){a.lblTicker.text(a.orden.Ticker);a.divTicker.show()}else{a.divTicker.hide()}a.divTipo=a.divModal.find(".div-orden-tipo");a.lblTipo=a.divModal.find(".label-orden-tipo");if(a.orden.Operacion){a.lblTipo.text(a.orden.Operacion);a.divTipo.show()}else{a.divTipo.hide()}a.divMonto=a.divModal.find(".div-orden-monto");a.lblMonto=a.divModal.find(".label-orden-monto");if(a.orden.Monto){a.lblMonto.text(Core.Functions.grid.formatNumber(a.orden.Monto));a.divMonto.show()}else{a.divMonto.hide()}a.divCantidad=a.divModal.find(".div-orden-cantidad");a.lblCantidad=a.divModal.find(".label-orden-cantidad");if(a.orden.Cantidad){a.lblCantidad.text(Core.Functions.grid.formatIntegerNumber(a.orden.Cantidad));a.divCantidad.show()}else{a.divCantidad.hide()}a.txtIdExterno=a.divModal.find(".textbox-id-externo");new Core.Controls.DecimalPicker(a.txtIdExterno,{maxDecimalDigitCount:0,showThousandsSeparator:"",defaultValue:(a.orden.idExterno)?a.orden.idExterno:""});Core.Functions.Validations.toggleValidation(a.txtIdExterno,false);a.divModal.find(".btn-buscar-id-externo").unbind("click");a.divModal.find(".btn-buscar-id-externo").click(function(){var c=new Core.Ajax.ServerRequest({overlayElement:a.divModal.find(".btn-buscar-id-externo"),showOverlay:true,secureRequest:true,requestUrl:"/ordenes/backoffice/idexterno/"+a.orden.idCuenta+"/"+a.orden.idOrden,requestType:"GET"});c.onSuccess=function(d){if(d.idexterno){a.txtIdExterno.val(d.idexterno)}};c.request()});a.divModal.find(".btn-confirmar-id-externo").unbind("click");a.divModal.find(".btn-confirmar-id-externo").click(function(){Core.Functions.Validations.toggleValidation(a.txtIdExterno,false);if(a.txtIdExterno.val()&&a.txtIdExterno.val()>0){var c=new Core.Ajax.ServerRequest({overlayElement:a.divModal.find(".btn-confirmar-id-externo"),showOverlay:true,secureRequest:true,requestUrl:"ordenes/backoffice/orden",requestType:"PUT",requestData:{data:{id:a.orden.idOrden,idCuenta:a.orden.idCuenta,idExterno:a.txtIdExterno.val(),idEstadoOrden:a.orden.idEstadoActualizarIdExterno}}});c.onSuccess=function(d){a.onSuccess();a.divModal.modal("hide")};c.request()}else{Core.Functions.Validations.toggleValidation(a.txtIdExterno,true)}});a.divModal.on("shown.bs.modal",function(){a.txtIdExterno.focus()});a.divModal.modal({show:true})}};Core.Controls.BuscarEspecie=function(c){var b=this;var a=13;b.divModal=$(".modal-buscar-especies");b.divEspecies=null;b.onSelected=function(){};b.onDestroy=function(){};b.requestUrl="especies/search/{filter}";$.extend(true,b,c);b.show=function(){b.divEspecies=b.divModal.find(".div-especies");b.txtFilter=b.divModal.find(".textbox-filter-especies");b.txtFilter.val("");b.btnBuscar=b.divModal.find(".button-buscar");b.initControls();b.divModal.unbind("hidden.bs.modal");b.divModal.on("hidden.bs.modal",function(){b.destroy()});b.divModal.modal({show:true})};b.initControls=function(){var d=[];d.push({field:"DisplayTicker",width:"45%",title:"Ticker",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});d.push({field:"Descripcion",width:"45%",title:"Descripción",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),attributes:Core.Functions.grid.getLeftAlignedColumnClass(),format:Core.Functions.grid.formatUndefinedString});d.push({field:"",title:" ",width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),buttons:[{caption:"Seleccionar",cls:"",commandName:"Seleccionar",click:function(f){var e=b.divEspecies.swidget().dataItem(f);b.onSelected(e);b.divModal.modal("hide")}}]});b.divEspecies.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:d});b.txtFilter.unbind("keyup");b.txtFilter.on("keyup",function(f){if(f.keyCode==a){b.loadGrid()}});b.btnBuscar.unbind("click");b.btnBuscar.on("click",function(){b.loadGrid()})};b.loadGrid=function(){if(b.txtFilter.val()&&b.txtFilter.val().length>=4){var d=b.requestUrl.replaceAll("{filter}",b.txtFilter.val());var e=new Core.Ajax.ServerRequest({overlayElement:b.divModal.find(".modal-body"),showOverlay:true,secureRequest:true,requestUrl:d,requestType:"GET"});e.onSuccess=function(f){b.refreshGrid(f.especies?f.especies:[])};e.request()}else{b.refreshGrid([])}};b.refreshGrid=function(d){var e=b.divEspecies.swidget().initialOptions;e.dataSource.data=d;b.divEspecies.swidget().refresh(e)};b.destroy=function(){b.divEspecies.swidget().destroy();b.onDestroy()}};Core.Controls.CapslockWarning=function(b){var a=this;a.targetControl=$(b);a.icon=null;a.targetControl.on("keypress.Core.Controls.CapslockWarning",function(c){var d=c.keyCode?c.keyCode:c.which;var f=c.shiftKey?c.shiftKey:((d==16)?true:false);if(((d>=65&&d<=90)&&!f)||((d>=97&&d<=122)&&f)){if(a.icon==null){a.icon=Core.Controls.icon(a.targetControl,{icon:Core.Controls.icons.information,textLabel:"Tecla Mayús Activada",iconPosition:null})}}else{if(a.icon!=null){a.icon.destroy();a.icon=null}}});a.destroy=function(){a.targetControl.off("keypress.Core.Controls.CapslockWarning");if(a.icon!=null){a.icon.destroy()}}};Core.Controls.ClonarOperacion=function(b){var a=this;a.divModal=$(".div-modal-clonar-operacion");a.divGridOperaciones=null;a.onSelected=function(){};$.extend(true,a,b);a.show=function(){a.divGridOperaciones=$(".div-clonar-operaciones");if(!a.divGridOperaciones.swidget()){a.initGrid()}a.loadGrid()};a.initGrid=function(){a.divGridOperaciones.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:[{field:"Contraparte",width:"50%",title:"Contraparte",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{field:"Ticker",width:"15%",title:"Ticker",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"ValorNominal",width:"25%",title:"Cantidad",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatNumber},{field:"",title:" ",width:"10%",headerAttributes:Core.Functions.grid.getCellEvenClass(),buttons:[{caption:"Clonar",cls:"",commandName:"Clonar",click:function(d){var c=a.divGridOperaciones.swidget().dataItem(d);a.onSelected(c);a.divModal.modal("hide")}}]}]})};a.loadGrid=function(){var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"operaciones/recientes",requestType:"GET"});c.onSuccess=function(f){var d=f.operaciones==null?[]:f.operaciones;var e=a.divGridOperaciones.swidget().initialOptions;e.dataSource.data=d;a.divGridOperaciones.swidget().refresh(e);a.divModal.modal({show:true})};c.request()};a.destroy=function(){}};Core.Controls.Confirmation=function(d,a,c){var b=this;b.onAccepted=null;b.onCanceled=null;b.btnAccept=null;b.btnCancel=null;b.divModal=$(".confirmation-modal");$.extend(true,b,c);b.show=function(){b.divModal.find(".confirmation-title").html(d);b.divModal.find(".confirmation-body").html(a);b.btnAccept=b.divModal.find(".accept-btn");b.btnAccept.unbind("click");b.btnAccept.click(function(){b.divModal.unbind("hidden.bs.modal");b.divModal.on("hidden.bs.modal",function(){if(b.onAccepted){b.onAccepted()}});b.divModal.modal("hide")});b.btnCancel=b.divModal.find(".cancel-btn");b.btnCancel.unbind("click");b.btnCancel.click(function(){b.divModal.unbind("hidden.bs.modal");b.divModal.on("hidden.bs.modal",function(){if(b.onCanceled){b.onCanceled()}});b.divModal.modal("hide")});b.divModal.unbind("hidden.bs.modal");b.divModal.on("hidden.bs.modal",function(){if(b.onCanceled){b.onCanceled()}});b.divModal.modal({show:true})};b.destroy=function(){}};Core.Controls.DecimalPicker=function(d,c){var b=this;var a=13;b.targetControl=d;b.maxDecimalDigitCount=2;b.showThousandsSeparator=true;b.onChange=function(){};b.onKeyUp=function(){};b.defaultValue="";b.enabledZero=false;b.useRestrict=true;$.extend(true,b,c);b.getValue=function(){var e=b.targetControl.val();return Core.Functions.Decimal.parseFloat(e)};b.setValue=function(e){e=Core.Functions.Decimal.parseFloat(e);e=Core.Functions.Decimal.localizeFloat(e,b.maxDecimalDigitCount,b.showThousandsSeparator);b.targetControl.val(e)};b.setMaxDecimalDigitCount=function(e){b.maxDecimalDigitCount=e;b.targetControl.attr("max-decimal-digit-count",b.maxDecimalDigitCount.toString())};b.targetControl.attr("max-decimal-digit-count",b.maxDecimalDigitCount.toString());b.targetControl.attr("show-thousands-separator",b.showThousandsSeparator.toString());if(b.useRestrict){Core.restrictions.applyRestriction(b.targetControl,Core.restrictions.types.decimal)}if(b.defaultValue){b.setValue(b.defaultValue)}else{b.targetControl.val("")}b.targetControl.unbind("paste");b.targetControl.on("paste",function(f){var e=f.originalEvent.clipboardData.getData("text");b.setValue(e);return false});b.targetControl.unbind("focusin.Core.Widgets.DecimalPicker");b.targetControl.on("focusin.Core.Widgets.DecimalPicker",function(){if(b.showThousandsSeparator){b.targetControl.val(Core.Functions.Decimal.localizeFloat(b.getValue(),b.maxDecimalDigitCount,false))}if(!b.enabledZero&&parseFloat(b.targetControl.val())==0){b.targetControl.val("")}});b.targetControl.unbind("blur.Core.Widgets.DecimalPicker");b.targetControl.on("blur.Core.Widgets.DecimalPicker",function(){if(b.showThousandsSeparator){b.targetControl.val(Core.Functions.Decimal.localizeFloat(b.getValue(),b.maxDecimalDigitCount,true))}if(!b.enabledZero&&parseFloat(b.targetControl.val())==0){b.targetControl.val("")}});b.targetControl.unbind("change.Core.Widgets.DecimalPicker");b.targetControl.on("change.Core.Widgets.DecimalPicker",function(){b.onChange()});b.targetControl.unbind("keydown.Core.Widgets.DecimalPicker");b.targetControl.on("keydown.Core.Widgets.DecimalPicker",function(h){if(h.keyCode==a){h.preventDefault();h.stopPropagation()}else{var k=b.targetControl.val();var f=b.doGetCaretPosition(b.targetControl.get(0));var g=k.indexOf(Core.Functions.Decimal.getSystemDecimalSeparator());var i=g>=0&&g<f;var l=k.split(Core.Functions.Decimal.getSystemDecimalSeparator());var j=((l[1]&&l[1].length>=b.maxDecimalDigitCount)||!b.maxDecimalDigitCount);if(j&&i&&b.isKeyCodeNumeric(h)){h.preventDefault()}}});b.targetControl.unbind("keyup.Core.Widgets.DecimalPicker");b.targetControl.on("keyup.Core.Widgets.DecimalPicker",function(){b.onKeyUp()});b.isKeyCodeNumeric=function(f){return(!f.shiftKey&&!f.altKey)&&((f.keyCode>=Core.eKeyCode.Key_0&&f.keyCode<=Core.eKeyCode.Key_9)||(f.keyCode>=Core.eKeyCode.Keypad_0&&f.keyCode<=Core.eKeyCode.Keypad_9))};b.doGetCaretPosition=function(f){var e=0;if(document.selection){var g=document.selection.createRange();g.moveStart("character",-f.value.length);e=g.text.length}else{if(f.selectionStart||f.selectionStart=="0"){e=f.selectionDirection=="backward"?f.selectionStart:f.selectionEnd}}return e}};Core.Controls.DecimalSeparatorWarning=function(b){var a=this;a.targetControl=$(b);a.icon=null;a.targetControl.on("keydown.CF.Widgets.DecimalSeparatorWarning",function(c){if($.inArray(c.keyCode,[Core.eKeyCode.Dot,Core.eKeyCode.Keypad_Dot,Core.eKeyCode.Comma])>-1&&!Core.Functions.Decimal.isDecimalSeparatorValid(c.keyCode)){if(a.icon==null){var d="";d+='Utilice "'+(c.keyCode==Core.eKeyCode.Comma?".":",")+'" como separador decimal';a.icon=Core.Controls.icon(a.targetControl,{icon:Core.Controls.icons.information,textLabel:d,iconPosition:null})}}else{if(a.icon!=null){a.icon.destroy();a.icon=null}}});a.destroy=function(){a.targetControl.off("keypress.CF.Widgets.DecimalSeparatorWarning");if(a.icon!=null){a.icon.destroy()}}};Core.Controls.DetalleAperturaCuenta=function(b){var a=this;a.overlayElement=null;a.idAperturaCuenta=null;$.extend(true,a,b);a.show=function(){var c=new Core.Ajax.ServerRequest({secureRequest:true,showOverlay:true,overlayElement:a.overlayElement,requestUrl:"apertura/cuenta/detalle/"+a.idAperturaCuenta,requestType:"GET"});c.onSuccess=function(g){var d="No hay detalles para informar.";if(g.detalle.length>0){d="<table class='table table-striped'>";d+="<thead><tr><th>Fecha</th><th>Versión</th><th>Estado</th><th>Tiempo</th><th>Usuario</th><th></th></tr></thead>";d+="<tbody>";for(var f=0;f<g.detalle.length;f++){d+="<tr>";d+="<td>"+g.detalle[f].Fecha.substr(0,16)+"</td>";d+="<td>"+g.detalle[f].Version+"</td>";d+="<td>"+g.detalle[f].Estado+"</td>";d+="<td>"+g.detalle[f].Tiempo+"</td>";d+="<td>"+g.detalle[f].Usuario+"</td>";d+="<td>";if(g.detalle[f].descargar){d+='<button type="button" onclick="Core.Controls.DetalleAperturaCuenta.descargar('+a.idAperturaCuenta+","+g.detalle[f].Version+');" "title="Descargar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>'}if(g.detalle[f].imprimir){d+='<button type="button" onclick="Core.Controls.DetalleAperturaCuenta.imprimir('+a.idAperturaCuenta+","+g.detalle[f].Version+');" title="Imprimir" class="btn-sm balanz-button"><span class="glyphicon glyphicon-print"></span></button>'}d+="</td>";d+="</tr>"}d+="</tbody>";d+="</table>"}var e=new Core.Controls.Dialog("Detalles ID Apertura Cuenta: "+a.idAperturaCuenta,d,{displayButtons:{close:true,accept:false}});e.show()};c.request()}};Core.Controls.DetalleAperturaCuenta.descargar=function(a,b){Core.Functions.File.download($(".default-modal").find(".modal-body"),Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"apertura/cuenta/zip/"+a+"?version="+b,function(){})};Core.Controls.DetalleAperturaCuenta.imprimir=function(a,b){Core.Functions.File.download($(".default-modal").find(".modal-body"),Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"apertura/cuenta/pdf/"+a+"?version="+b,function(){})};Core.Controls.DetalleOrdenTesoreria=function(b){var a=this;a.divModal=$(".div-detalle-orden-tesoreria");a.lblTitle=null;a.lblID=null;a.lblFechaEmision=null;a.lblFechaLiquidacion=null;a.lblOperacion=null;a.divComitente=null;a.divCuentaCambio=null;a.lblComitente=null;a.lblCuentaCambio=null;a.lblDescripcionCuenta=null;a.lblMoneda=null;a.lblMonto=null;a.showBanco=true;a.divBanco=null;a.lblBanco=null;a.showCBU=true;a.divCBU=null;a.lblCBU=null;a.showCuit=true;a.divCuit=null;a.lblCuit=null;a.showTitular=true;a.divTitular=null;a.lblTitular=null;a.showObservacion=true;a.divObservacion=null;a.lblObservacion=null;a.orden=null;a.ordenDetails=null;a.overlayElement=null;$.extend(true,a,b);a.show=function(){var c=new Core.Ajax.ServerRequest({showOverlay:true,overlayElement:a.overlayElement,secureRequest:true,requestUrl:"ordenes/backoffice/orden/tesoreria/"+a.orden.idCuenta+"/"+a.orden.idOrden,requestType:"GET"});c.onSuccess=function(d){a.ordenDetails=d;a.lblTitle=a.divModal.find(".title");a.lblTitle.text("Detalles Orden: "+a.ordenDetails.id);a.lblID=a.divModal.find(".label-orden-id");a.lblID.text(Core.Functions.grid.formatIntegerNumber(a.ordenDetails.id));a.lblFechaEmision=a.divModal.find(".label-orden-fecha-emision");a.lblFechaEmision.text((a.ordenDetails.fechaEmision)?a.ordenDetails.fechaEmision.substr(0,10):"");a.lblFechaLiquidacion=a.divModal.find(".label-orden-fecha-liquidacion");a.lblFechaLiquidacion.text((a.ordenDetails.fechaLiquidacion)?a.ordenDetails.fechaLiquidacion.substr(0,10):"");a.lblOperacion=a.divModal.find(".label-orden-operacion");a.lblOperacion.text((a.ordenDetails.operacion)?a.ordenDetails.operacion:"");a.divComitente=a.divModal.find(".div-orden-comitente");a.lblComitente=a.divModal.find(".label-orden-comitente");a.lblComitente.text((a.ordenDetails.numComitente)?Core.Functions.grid.formatIntegerNumber(a.ordenDetails.numComitente):"");a.divComitente.hide();if(a.ordenDetails.numComitente){a.divComitente.show()}a.divCuentaCambio=a.divModal.find(".div-orden-cuenta-cambio");a.lblCuentaCambio=a.divModal.find(".label-orden-cuenta-cambio");a.lblCuentaCambio.text((a.ordenDetails.numCuentaCambio)?Core.Functions.grid.formatIntegerNumber(a.ordenDetails.numCuentaCambio):"");a.divCuentaCambio.hide();if(a.ordenDetails.numCuentaCambio){a.divCuentaCambio.show()}a.lblDescripcionCuenta=a.divModal.find(".label-orden-descripcion-cuenta");a.lblDescripcionCuenta.text((a.ordenDetails.descripcionCuenta)?a.ordenDetails.descripcionCuenta:"");a.lblMoneda=a.divModal.find(".label-orden-moneda");a.lblMoneda.text((a.ordenDetails.moneda)?a.ordenDetails.moneda:"");a.lblMonto=a.divModal.find(".label-orden-monto");a.lblMonto.text((a.ordenDetails.monto)?Core.Functions.grid.formatNumber(a.ordenDetails.monto):"");a.divBanco=a.divModal.find(".div-orden-banco");a.lblBanco=a.divModal.find(".label-orden-banco");a.lblBanco.text((a.ordenDetails.banco)?a.ordenDetails.banco:"");a.divBanco.hide();if(a.showBanco){a.divBanco.show()}a.divCBU=a.divModal.find(".div-orden-cbu");a.lblCBU=a.divModal.find(".label-orden-cbu");a.lblCBU.text((a.ordenDetails.CBU)?a.ordenDetails.CBU.trim():"");a.divCBU.hide();if(a.showCBU){a.divCBU.show()}a.divCuit=a.divModal.find(".div-orden-cuit");a.lblCuit=a.divModal.find(".label-orden-cuit");a.lblCuit.text((a.ordenDetails.CUIT)?a.ordenDetails.CUIT.trim():"");a.divCuit.hide();if(a.showCuit){a.divCuit.show()}a.divTitular=a.divModal.find(".div-orden-titular");a.lblTitular=a.divModal.find(".label-orden-titular");a.lblTitular.text((a.ordenDetails.titular)?a.ordenDetails.titular:"");a.divTitular.hide();if(a.showTitular){a.divTitular.show()}a.divSWIFT=a.divModal.find(".div-orden-swift");a.lblSWIFT=a.divModal.find(".label-orden-swift");a.lblSWIFT.text((a.ordenDetails.SWIFT)?a.ordenDetails.SWIFT:"");a.divSWIFT.hide();if(a.ordenDetails.TipoCuentaBancaria==Core.Enums.eTipoCuentaBancaria.Exterior){a.divSWIFT.show()}a.divABA=a.divModal.find(".div-orden-aba");a.lblABA=a.divModal.find(".label-orden-aba");a.lblABA.text((a.ordenDetails.ABA)?a.ordenDetails.ABA:"");a.divABA.hide();if(a.ordenDetails.TipoCuentaBancaria==Core.Enums.eTipoCuentaBancaria.Exterior){a.divABA.show()}a.divAccountNumber=a.divModal.find(".div-orden-account-number");a.lblAccountNumber=a.divModal.find(".label-orden-account-number");a.lblAccountNumber.text((a.ordenDetails.AccountNumber)?a.ordenDetails.AccountNumber:"");a.divAccountNumber.hide();if(a.ordenDetails.TipoCuentaBancaria==Core.Enums.eTipoCuentaBancaria.Exterior){a.divAccountNumber.show()}a.divIBAN=a.divModal.find(".div-orden-iban");a.lblIBAN=a.divModal.find(".label-orden-iban");a.lblIBAN.text((a.ordenDetails.IBAN)?a.ordenDetails.IBAN:"");a.divIBAN.hide();if(a.ordenDetails.TipoCuentaBancaria==Core.Enums.eTipoCuentaBancaria.Exterior){a.divIBAN.show()}a.divBeneficiary=a.divModal.find(".div-orden-beneficiary");a.lblBeneficiary=a.divModal.find(".label-orden-beneficiary");a.lblBeneficiary.text((a.ordenDetails.Beneficiary)?a.ordenDetails.Beneficiary:"");a.divBeneficiary.hide();if(a.ordenDetails.TipoCuentaBancaria==Core.Enums.eTipoCuentaBancaria.Exterior){a.divBeneficiary.show()}a.divFFC=a.divModal.find(".div-orden-ffc");a.lblFFC=a.divModal.find(".label-orden-ffc");a.lblFFC.text((a.ordenDetails.FFC)?a.ordenDetails.FFC:"");a.divFFC.hide();if(a.ordenDetails.TipoCuentaBancaria==Core.Enums.eTipoCuentaBancaria.Exterior){a.divFFC.show()}a.divObservacion=a.divModal.find(".div-orden-observacion");a.lblObservacion=a.divModal.find(".label-orden-observacion");a.lblObservacion.text((a.ordenDetails.observacion)?a.ordenDetails.observacion:"");a.divObservacion.hide();if(a.showObservacion){a.divObservacion.show()}a.divModal.modal({show:true})};c.request()}};Core.Controls.Dialog=function(d,a,c){var b=this;b.displayButtons={close:true,accept:true};b.onClosed=function(){b.destroy()};b.divModal=$(".default-modal");$.extend(true,b,c);b.show=function(){var e=function(f,g){if(g){b.divModal.find("."+f).show()}else{b.divModal.find("."+f).hide()}};b.divModal.find(".modal-title").html(d);b.divModal.find(".modal-body").html(a);e("close-btn",b.displayButtons.close);e("accept-btn",b.displayButtons.accept);b.divModal.unbind("hidden.bs.modal");b.divModal.on("hidden.bs.modal",b.onClosed);b.divModal.modal({show:true})};b.destroy=function(){b.divModal.find(".modal-body").html("")}};Core.Controls.FileUpload=function(a,c){var b=this;b.divContainer=a;b.urlMethod=null;b.title="Seleccionar Archivo";b.fileTypesDescription="";b.fileTypes={};b.maxSize=null;b.onLoad=function(d){};b.onError=function(){};b.onFileChange=function(){};$.extend(true,b,c);b.inputFile=$('<input type="file" class="form-control" title="'+b.title+'" />').appendTo(b.divContainer);b.progressBar=$('<progress min="0" max="100" value="0" />').appendTo(b.divContainer);b.progressBar.hide();b.inputFile.on("change",function(g){b.onFileChange();var j=g.target.files;for(var k=0,h;h=j[k];k++){if(!b.fileTypes[h.type]){b.clear();var l=new Core.Controls.Dialog("Aviso","<p>El archivo seleccionado debe ser: "+b.fileTypesDescription+".</p>",{displayButtons:{close:true,accept:false}}).show();return}if(h.size>b.maxSize){b.clear();var l=new Core.Controls.Dialog("Aviso","<p>El tamaño permitido es de hasta "+((b.maxSize==10485760)?"10":"50")+" Mb.</p>",{displayButtons:{close:true,accept:false}}).show();return}b.progressBar.value=0;b.progressBar.textContent=0;b.progressBar.show();var m=new XMLHttpRequest();m.upload.onprogress=function(f){if(f.lengthComputable){b.progressBar.attr("value",(f.loaded/f.total)*100)}};m.onload=function(f){b.progressBar.hide();if(m.status==200){var i=JSON.parse(m.responseText);b.onLoad(i)}else{b.clear();b.onError()}};m.onerror=function(f){b.progressBar.hide();b.clear();b.onError()};try{m.open("POST",Core.Origin+Core.Functions.Context.getPathname()+b.urlMethod,true);m.setRequestHeader("Authorization",Core.Objects.Context.Token);m.setRequestHeader("Accept","application/json");m.setRequestHeader("Content-Type",b.fileTypes[h.type]);m.send(h)}catch(d){b.progressBar.hide();b.clear();b.onError()}}});b.clear=function(){b.inputFile.val("")};b.destroy=function(){b.inputFile.remove();b.progressBar.remove()}};Core.Controls.Header=function(container,parameters){var me=this;var REFRESH_TIME_NOTIFICATIONS=600000;var REFRESH_TIME_MESSAGES=60000;$.extend(true,me,parameters);me.container=$(container);me.ddlAccounts=null;me.divAccounts=null;me.btnHome=null;me.descriptionAsesor=null;me.lblNotificationsCount=null;me.ddlNotifications=null;me.asesor={lblName:null,lblNumber:null,btnNumber:null,btnEmail:null};me.selectedIdAccount=null;me.divDescriptionAccount=null;me.lblAccountDesription=null;me.btnAccountDescriptionDetails=null;me.onChangeCallback=$.noop;me.actualNamespace=null;me.actualNamespaceParameters=null;var ulDropDownMenu=null;me.ulMenu=container.find("#topMain");me.ddlProfiles=null;me.timerIdNotifications=null;me.timerIdMessages=null;me.init=function(loadAccounts,idDefaultAccount,idDefaultProfile,callback,namespace,namespaceParameters){me.onChangeCallback=callback;me.actualNamespace=namespace;me.actualNamespaceParameters=namespaceParameters;me.ddlAccounts=container.find(".dropdown-accounts");me.divAccounts=container.find(".div-header-accounts");me.imgInternationalAccount=container.find(".img-label-internacional");me.imgInternationalAccount.hide();me.btnHome=container.find(".logo");me.descriptionAsesor=container.find(".description-asesor");me.asesor.lblName=container.find(".asesor-name");me.asesor.lblNumber=container.find(".asesor-number");me.asesor.btnNumber=container.find(".asesor-tel");me.asesor.btnEmail=container.find(".asesor-email");me.ddlProfiles=$(".profiles-menu");me.ddlNotifications=$(".notifications-menu");me.divDescriptionAccount=container.find(".div-description-account");me.lblAccountDesription=container.find(".description-account");me.btnAccountDescriptionDetails=container.find(".btn-description-account-details");me.lblNotificationsCount=container.find(".reminder-notifications-count");me.idDefaultAccount=idDefaultAccount;me.idDefaultProfile=idDefaultProfile;me.timerIdNotifications=null;me.timerIdMessages=null;me.btnHome.on("click",function(){$(window).off("unload");$(window).off("beforeunload");window.location.href=Core.Functions.Context.getPathname()});container.find(".profile-image").attr("src",Core.Objects.Context.Avatar);var path=Core.Functions.Context.Profiles.getPagePathByNamespace(me.actualNamespace,Core.Objects.Context.Profiles[me.idDefaultProfile]);if(path&&(!history.state||me.actualNamespace!=history.state.namespace)){var parameters="";if(me.actualNamespaceParameters){for(var key in me.actualNamespaceParameters){parameters+=(((parameters=="")?"?":"&")+key+"="+me.actualNamespaceParameters[key])}}history.pushState({namespace:me.actualNamespace,namespaceParameters:me.actualNamespaceParameters,idProfile:idDefaultProfile},"",(Core.Functions.Context.getPathname()+path+parameters).replaceAll("//","/"))}if(Core.Objects.Context.Configuration.idAplicacion!=1&&loadAccounts&&(!Core.Objects.Accounts||!Core.Objects.Accounts.length)){Core.Objects.Accounts=[]}if(loadAccounts&&!Core.Objects.Accounts){var sr=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"cuentas/"+encodeURIComponent(Core.Objects.Context.IdPersona),requestType:"GET"});sr.onSuccess=function(responseCuentas){Core.Objects.Accounts=responseCuentas.cuentas};sr.request()}me.divFaqs=container.find(".div-faqs");me.divFaqs.find("a").on("click",function(){var idAccount=me.selectedIdAccount?me.selectedIdAccount:me.idDefaultAccount;Core.Business.Faqs.init(idAccount,me.idDefaultProfile)});me.divFaqs.hide();if(Core.Objects.Context.Configuration.idAplicacion==0||Core.Objects.Context.Configuration.idAplicacion==3){me.divFaqs.show()}me.lblReminderMessagesCount=container.find(".reminder-mensages-count");me.divReminderMessages=container.find(".div-reminder-messages");me.divReminderMessages.find("i").on("click",function(){var idAccount=me.selectedIdAccount?me.selectedIdAccount:me.idDefaultAccount;Core.Business.Mensajeria.init(idAccount,me.idDefaultProfile)});me.divReminderMessages.hide();if(Core.Objects.Context.Configuration.idAplicacion==0&&Core.Functions.Context.Profiles.existPageInMenu("homeMensajeria",Core.Objects.Context.Profiles[me.idDefaultProfile])){me.divReminderMessages.show();me.loadMessages();me.timerIdMessages=window.setInterval(function(){me.loadMessages()},REFRESH_TIME_MESSAGES);Core.Objects.Context.Timers.push(me.timerIdMessages)}goon();function goon(){me.loadNotifications(function(){var myInterval=window.setInterval(function(){if(!loadAccounts||Core.Objects.Accounts){window.clearInterval(myInterval);if(loadAccounts){me.loadAccounts()}else{me.hideAccounts();var defaultAccount=null;if(Core.Objects.Accounts!=null){defaultAccount=$.grep(Core.Objects.Accounts,function(obj,index){return obj.idCuenta==me.idDefaultAccount})[0]}me.initRenderMenu(me.idDefaultProfile,defaultAccount);me.onChangeCallback();me.checkNotifications()}me.loadDdlProfiles();me.loadDdlNotifications(false);me.ddlProfiles.hide();me.ddlNotifications.hide();$("body").on("click",function(){me.ddlProfiles.hide();me.ddlNotifications.hide()});if(Core.Objects.Context.Configuration.idAplicacion==1||!loadAccounts){me.divDescriptionAccount.hide()}if(Core.Objects.Context.Configuration.idAplicacion==14){me.hideAccounts()}}},50)});me.timerIdNotifications=window.setInterval(function(){me.loadNotifications(function(){me.loadDdlNotifications(false)})},REFRESH_TIME_NOTIFICATIONS);Core.Objects.Context.Timers.push(me.timerIdNotifications)}};me.iconsByProfileId={homeAsesores:"glyphicon glyphicon-home",transaccional:"glyphicon glyphicon-flash",minutas:"glyphicon glyphicon-download-alt",administracion:"glyphicon glyphicon-tasks"};me.iconsTestInversorByPerfil=["<span class='glyphicon glyphicon-user red pull-right'></span>","<span class='pull-right'><img src='/images/ico-conservador.png' width='20'></span>","<span class='pull-right'><img src='/images/ico-moderado.png' width='20'></span>","<span class='pull-right'><img src='/images/ico-agresivo.png' width='20'></span>","<span class='glyphicon glyphicon-user red pull-right'></span>","<span class='pull-right'><img src='/images/ico-muyagresivo.png' width='20'></span>","<span class='pull-right'><img src='/images/ico-calificado.png' width='20'></span>"];me.loadDdlProfiles=function(){var DIVIDER="<li class='divider'></li>";var STRONG_DIVIDER="<li class='divider strong-divider'></li>";var options="";options+="<li><a><span class='glyphicon pull-right'><img src="+Core.Objects.Context.Avatar+" width='20'></span><strong>"+Core.Objects.Context.Nombre+"</strong></a>";options+=DIVIDER;options+="<li><a onclick='Core.Business.Logout.logout()'><span class='glyphicon glyphicon-log-out pull-right'></span>Cerrar Sesión</a></li>";options+=DIVIDER;var idAccount=me.selectedIdAccount?me.selectedIdAccount:me.idDefaultAccount;options+="<li><a onclick='Core.Business.AccountSettings.init("+idAccount+", "+me.idDefaultProfile+")'><span class='glyphicon glyphicon-cog pull-right'></span>Configuracion de Cuenta</a></li>";if(Core.Objects.Context.Profiles[0]&&Core.Objects.Context.Profiles[0].opciones&&Core.Objects.Context.Profiles[0].opciones.habilitarBetaTest){options+=DIVIDER;options+="<li><a onclick='Core.Functions.BetaVersion.load()'><span class='glyphicon glyphicon-cog pull-right'></span>Beta</a></li>"}options+=STRONG_DIVIDER;options+=Core.Objects.Context.Profiles.map(function(profile,index){var iconClass=me.iconsByProfileId[profile.id];return"<li><a data-profile-index='"+index+"' class='profile-change'><span class='"+iconClass+" pull-right'></span>"+profile.texto+"</a></li>"}).join(DIVIDER);options+=DIVIDER;if(Core.Objects.Context.TestInversor){options+="<li><a onclick='Core.Business.TestInversorNotificacion.init("+idAccount+", "+me.idDefaultProfile+")'>"+me.iconsTestInversorByPerfil[Core.Objects.Context.TestInversor.personal[0].idPerfil]+"Perfil del Inversor</a></li>";options+=DIVIDER}me.ddlProfiles.find("ul").html(options);me.bindProfileEvents()};me.loadDdlNotifications=function(showNotifications){me.lblNotificationsCount.hide();var idAccount=me.selectedIdAccount?me.selectedIdAccount:me.idDefaultAccount;var DIVIDER="<li class='divider'></li>";var notifications="<li><div class='text-right'><a><img src='/images/ico-campana-configuracion.png' width='25' onclick='Core.Business.ConfiguracionAlertas.init("+idAccount+", "+me.idDefaultProfile+")'></img></a></div></li>";if(Core.Objects.Context.Notifications.length>0){me.lblNotificationsCount.text(Core.Objects.Context.Notifications.length);notifications+=Core.Objects.Context.Notifications.map(function(notification,index){return"<li><div class='dropdown-messages-box'><div class='style-scope ytd-notification-renderer float-left "+((notification.estado)?"visto":"new")+"'></div><a class='dropdown-item float-left dropdown-item-notification' id-notification='"+notification.idnotificacion+"'><img class='rounded-circle' src='"+notification.icono+"'/></a><div class='media-body'><a class='close btn-delete-notification' data-dismiss='alert' id-notification='"+notification.idnotificacion+"'>×</a><div class='dropdown-item-notification' id-notification='"+notification.idnotificacion+"'>"+notification.texto+"<br><small class='text-muted'>"+notification.fecha.substr(0,16).replace("T"," ")+"</small></div></div></div></li>"}).join(DIVIDER);me.lblNotificationsCount.show()}else{notifications+="<li><div class='text-center link-block'><strong>No hay Notificaciones</strong></div></li>"}notifications+=DIVIDER;notifications+="<li><div class='text-center link-block'><a class='dropdown-item' onclick='Core.Business.Notificaciones.init("+idAccount+", "+me.idDefaultProfile+")'><strong>VER TODAS</strong></a></div></li>";me.ddlNotifications.find("ul").html(notifications);if(showNotifications){me.ddlNotifications.show()}me.bindNotificationsEvents()};me.bindProfileEvents=function(){me.ddlProfiles.off("click").on("click",".profile-change",function(){var index=$(this).attr("data-profile-index");var idAccount=me.selectedIdAccount?me.selectedIdAccount:me.idDefaultAccount;Core.Business.Login.redirectToInitialPage(Core.Objects.Context.Profiles[index],idAccount,index)});container.find(".open-profiles").on("click",function(e){var offset=$(this).offset();me.ddlProfiles.css({display:"block",left:offset.left-me.ddlProfiles.width()+$(this).width(),top:offset.top+$(this).height()});me.ddlNotifications.hide();return false})};me.bindNotificationsEvents=function(){me.ddlNotifications.off("click");me.ddlNotifications.on("click",".btn-delete-notification",function(){var idNotification=$(this).attr("id-notification");var notification=$.grep(Core.Objects.Context.Notifications,function(obj,index){return obj.idnotificacion==idNotification})[0];if(notification){me.deleteNotification(notification,function(notification){me.loadDdlNotifications(true)})}});me.ddlNotifications.on("click",".dropdown-item-notification",function(){var idNotification=$(this).attr("id-notification");var notification=$.grep(Core.Objects.Context.Notifications,function(obj,index){return obj.idnotificacion==idNotification})[0];if(notification){if(notification.auto){me.deleteNotification(notification,me.executeNotification)}else{me.executeNotification(notification)}}});container.find(".reminder-notifications i").off("click");container.find(".reminder-notifications i").on("click",function(e){if(Core.Functions.isMobile){var idAccount=me.selectedIdAccount?me.selectedIdAccount:me.idDefaultAccount;Core.Business.Notificaciones.init(idAccount,me.idDefaultProfile)}else{var offset=$(".open-profiles :visible").offset();var reminder=$(".reminder-notifications :visible");me.ddlNotifications.css({display:"block",left:offset.left-me.ddlNotifications.width()+reminder.width(),top:offset.top+reminder.height()});me.ddlProfiles.hide()}return false})};me.showMenuItem=function(menu,selectedAccount){return(!selectedAccount||((selectedAccount.NumComitente!=""&&selectedAccount.idNegocio==1&&(!menu.hasOwnProperty("opciones")||!menu.opciones.hasOwnProperty("showOnlyIfAccountHasNumComitente")||menu.opciones.showOnlyIfAccountHasNumComitente))||(selectedAccount.NumCuotapartista!=""&&(!menu.hasOwnProperty("opciones")||!menu.opciones.hasOwnProperty("showOnlyIfAccountHasNumCuotapartista")||menu.opciones.showOnlyIfAccountHasNumCuotapartista))||(selectedAccount.NumCambio!=""&&(!menu.hasOwnProperty("opciones")||!menu.opciones.hasOwnProperty("showOnlyIfAccountHasNumCambio")||menu.opciones.showOnlyIfAccountHasNumCambio))||(selectedAccount.NumComitente!=""&&selectedAccount.idNegocio==5&&(!menu.hasOwnProperty("opciones")||!menu.opciones.hasOwnProperty("showOnlyIfAccountIsBCI")||menu.opciones.showOnlyIfAccountIsBCI))))};me.initRenderMenu=function(idDefaultProfile,selectedAccount){me.ulMenu.empty();if(Core.Objects.Context.Profiles[idDefaultProfile].menu){for(var i=0;i<Core.Objects.Context.Profiles[idDefaultProfile].menu.length;i++){var menu=Core.Objects.Context.Profiles[idDefaultProfile].menu[i];if(me.showMenuItem(menu,selectedAccount)){me.renderMenu(me.ulMenu,menu,idDefaultProfile,selectedAccount)}}}else{$(".open-menu-btn").hide()}window.onpopstate=function(e){if(e.state&&e.state.namespace){var idAccount=me.selectedIdAccount?me.selectedIdAccount:me.idDefaultAccount;if(e.state.namespaceParameters){eval(e.state.namespace+".init("+idAccount+","+(e.state.idProfile?e.state.idProfile:0)+","+JSON.stringify(e.state.namespaceParameters)+");")}else{eval(e.state.namespace+".init("+idAccount+","+(e.state.idProfile?e.state.idProfile:0)+");")}}};$(window).off("beforeunload");$(window).on("beforeunload",function(e){return""});$(window).off("unload");$(window).on("unload",function(){var pathname=window.location.pathname.split("/")[1].replaceAll("/","");pathname=((Core.Functions.Context.whiteList.indexOf(pathname)<0)?"":pathname);if(!(Core.Objects.Context.Configuration&&Core.Objects.Context.Configuration.location&&Core.Objects.Context.Configuration.location.origin==window.location.origin&&Core.Functions.Context.getPathname().replaceAll("/","")==pathname)){if(Core.Objects.Context.WebSocket&&Core.Objects.Context.WebSocket.readyState==1){Core.Objects.Context.WebSocket.close()}var token=Core.Objects.Context.Token;Core.Business.Logout.clearSession();Core.Objects.Context.Token=token;var sr=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"auth/logout",requestType:"POST"});sr.request()}})};me.renderMenu=function(container,option,idDefaultProfile,selectedAccount){var li=$("<li class='dropdown' />").appendTo(container);var btn=null;if(option.menu&&option.menu.length>0){btn=$("<a class='dropdown-toggle'>"+option.texto+((option.opciones&&option.opciones.resaltaropcionmenu)?(" "+option.opciones.resaltaropcionmenu):"")+"</a>").appendTo(li);var ul=$("<ul class='dropdown-menu' />").appendTo(li);for(var i=0;i<option.menu.length;i++){var menu=option.menu[i];if(me.showMenuItem(menu,selectedAccount)){me.renderMenu(ul,menu,idDefaultProfile,selectedAccount)}}}else{btn=$("<a>"+option.texto+((option.opciones&&option.opciones.resaltaropcionmenu)?(" "+option.opciones.resaltaropcionmenu):"")+"</a>").appendTo(li);btn.click(function(){var idAccount=me.selectedIdAccount?me.selectedIdAccount:me.idDefaultAccount;eval(option.namespace+".init("+idAccount+","+idDefaultProfile+");")})}};me.setSelectedAccount=function(account,noExecuteCallback){me.selectedIdAccount=account.idCuenta;Core.Objects.Context.Configuration.lastIdAccount=account.idCuenta;if(!Core.Functions.Validations.isBlockedStorage()&&Core.Functions.Persistence.getStorage()){Core.Functions.Persistence.getStorage().setItem("CoreContext",LZString.compressToUTF16(JSON.stringify(Core.Objects.Context)))}me.asesor.lblName.text(account.NombreAsesor);me.asesor.lblNumber.text(account.TelefonoAsesor);me.asesor.btnNumber.attr("href","tel:"+account.TelefonoAsesor);me.asesor.btnEmail.attr("href","mailto:"+account.EmailAsesor);me.imgInternationalAccount.hide();if(account.idNegocio==Core.Enums.eNegocio.BCI){me.imgInternationalAccount.show()}if(Core.Objects.Context.Configuration.idAplicacion!=1){me.lblAccountDesription.html(account.Descripcion+((account.NumComitente!="")?(" Comitente: "+account.NumComitente):"")+((account.NumCuotapartista!="")?(" Cuotapartista: "+account.NumCuotapartista):"")+". ");me.btnAccountDescriptionDetails.text("Detalles de cuenta.");me.btnAccountDescriptionDetails.on("click",function(){var pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu("homeCuentas",Core.Objects.Context.Profiles[0]);Core.Functions.grid.AccountDetails.showDetailsByIdAccount(account,true,(pageOptions&&pageOptions.actualizarNivelPersonas)?pageOptions.actualizarNivelPersonas:false)})}if(!noExecuteCallback){me.initRenderMenu(me.idDefaultProfile,account);me.onChangeCallback();me.checkNotifications()}};me.loadAccounts=function(){var selectedIndex=0;var accounts=$.grep(Core.Objects.Accounts,function(obj,index){return Core.Objects.Context.Configuration.idAplicacion!=1||!obj.NumCambio});if(me.idDefaultAccount>0){for(var i=0;(i<accounts.length&&selectedIndex==0);i++){if(accounts[i].idCuenta==me.idDefaultAccount){selectedIndex=i}}}if(Core.Objects.Context.Configuration.idAplicacion==1||accounts.length==1){me.ddlAccounts.shieldDropDown({dataSource:{data:accounts},valueTemplate:"{idCuenta}",textTemplate:"{idCuenta} | {Descripcion}",selected:selectedIndex,enabled:true,events:{select:function(e){if(e.index>=0){me.setSelectedAccount(e.item)}}}})}else{var data=accounts[selectedIndex]?[accounts[selectedIndex]]:[];me.ddlAccounts.shieldComboBox({dataSource:{data:data},valueTemplate:"{idCuenta}",textTemplate:"{idCuenta} | {Descripcion}",selected:0,enabled:false,autoComplete:{enabled:false,filter:{and:[{path:"Descripcion",filter:"contains",value:""}]}},events:{select:function(e){if(e.index>=0){me.setSelectedAccount(e.item)}}}})}var selectedAccount=accounts[selectedIndex];if(selectedAccount){me.setSelectedAccount(selectedAccount)}else{me.initRenderMenu(me.idDefaultProfile,null);me.onChangeCallback();me.checkNotifications()}};me.hideAccounts=function(){me.divAccounts.hide();me.descriptionAsesor.hide();me.divDescriptionAccount.hide()};me.checkNotifications=function(){setTimeout(function(){Core.Objects.Context.Notifications.forEach(function(obj,index){if(me.actualNamespace&&obj.forcenamespaces&&obj.forcenamespaces.indexOf(me.actualNamespace)>=0){me.deleteNotification(obj,me.executeNotification)}})},1500)};me.deleteNotification=function(notification,onDelete){var sr=new Core.Ajax.ServerRequest({showOverlay:false,secureRequest:true,requestUrl:"notificaciones/"+encodeURIComponent(notification.idnotificacion),requestType:"POST"});sr.onSuccess=function(){Core.Objects.Context.Notifications=$.grep(Core.Objects.Context.Notifications,function(obj,index){return obj.idnotificacion!=notification.idnotificacion});if(!Core.Functions.Validations.isBlockedStorage()&&Core.Functions.Persistence.getStorage()){Core.Functions.Persistence.getStorage().setItem("CoreContext",LZString.compressToUTF16(JSON.stringify(Core.Objects.Context)))}if(onDelete){onDelete(notification)}};sr.request()};me.executeNotification=function(notification){var idAccount=me.selectedIdAccount?me.selectedIdAccount:me.idDefaultAccount;Core.Functions.Notification.execute(notification,idAccount,me.idDefaultProfile,function(){me.loadDdlNotifications(true)})};me.loadNotifications=function(onLoad){var srNotifications=new Core.Ajax.ServerRequest({showOverlay:false,overlayElement:me.divMain,secureRequest:true,requestUrl:"notificaciones",requestType:"GET"});srNotifications.onSuccess=function(responseNotifications){Core.Objects.Context.Notifications=responseNotifications.notificaciones;if(!Core.Functions.Validations.isBlockedStorage()&&Core.Functions.Persistence.getStorage()){Core.Functions.Persistence.getStorage().setItem("CoreContext",LZString.compressToUTF16(JSON.stringify(Core.Objects.Context)))}if(onLoad){onLoad()}};srNotifications.onError=function(e){if(e.status==403&&e.responseJSON&&e.responseJSON.CodigoError==-1001){Core.Business.Logout.logout()}else{Core.Objects.Context.Notifications=[];if(!Core.Functions.Validations.isBlockedStorage()&&Core.Functions.Persistence.getStorage()){Core.Functions.Persistence.getStorage().setItem("CoreContext",LZString.compressToUTF16(JSON.stringify(Core.Objects.Context)))}if(onLoad){onLoad()}}};srNotifications.request()};me.loadMessages=function(){var srChatFolder=new Core.Ajax.ServerRequest({allowCache:true,showOverlay:false,overlayElement:me.divMain,secureRequest:true,requestUrl:"chatcx/v1/etiqueta/misconversaciones/"+Core.Objects.Context.IdPersona,requestType:"GET"});srChatFolder.onSuccess=function(folderResponse){var srChatMessages=new Core.Ajax.ServerRequest({showOverlay:false,overlayElement:me.divMain,secureRequest:true,requestUrl:"chatcx/v1/conversacion/"+folderResponse.idetiqueta+"/count",requestType:"GET"});srChatMessages.onSuccess=function(messagesResponse){me.lblReminderMessagesCount.text(messagesResponse.conversacionesnoleidas?messagesResponse.conversacionesnoleidas:"")};srChatMessages.onError=function(e){if(e.status==403&&e.responseJSON&&e.responseJSON.CodigoError==-1001){Core.Business.Logout.logout()}};srChatMessages.request()};srChatFolder.onError=function(e){if(e.status==403&&e.responseJSON&&e.responseJSON.CodigoError==-1001){Core.Business.Logout.logout()}};srChatFolder.request()}};Core.Controls.icons={information:'<img alt="Information" src="/images/icons/16x16-circular-mark-information.png" />'};Core.Controls.iconDataKey="core-controls-icon";Core.Controls.icon=function(b,a){if(a=="destroy"){Core.Controls.iconDestroy(b)}else{return new Core.Controls.iconClass(b,a)}};Core.Controls.iconClass=function(c,b){var a=this;a.icon=Core.Controls.icons.information;a.iconPosition={my:"right center",at:"right-2 center"};a.textLabel=null;a.label=null;a.fadeOut=false;a.fadeOutDuration=750;a.onClick=null;$.extend(true,a,b);a.targetControl=$(c);a.container=(function(){var d=a.targetControl.parent();while(d.is("tr")||d.is("tbody")||d.is("thead")||d.is("table")){d=d.parent()}return d})();if(!a.container.hasClass("ui-dialog")){a.container.css({position:"relative"})}Core.Controls.iconDestroy(a.targetControl);a.imgIcon=$(a.icon).appendTo(a.container);a.imgIcon.addClass("core-controls-icon");if(a.iconPosition!=null){a.iconPosition.of=a.targetControl;a.imgIcon.position(a.iconPosition)}if(a.textLabel!=null){a.label=$("<label />").appendTo(a.container);a.label.text(a.textLabel)}if(a.onClick!=null){a.imgIcon.css("cursor","pointer");a.imgIcon.click(function(){a.onClick(a)})}if(a.fadeOut){(function(d){d.imgIcon.fadeOut(d.fadeOutDuration,function(){d.destroy()})})(a)}$.data(a.targetControl.get(0),Core.Controls.iconDataKey,a);a.destroy=function(){if(a.label!=null){a.label.remove();a.label=null}a.imgIcon.remove();$.removeData(a.targetControl.get(0),Core.Controls.iconDataKey)};return a};Core.Controls.iconDestroy=function(b){var a=$.data($(b).get(0),Core.Controls.iconDataKey);if(a!=undefined){a.destroy()}};Core.Controls.ManagerAlertaPrecio=function(b){var a=this;a.divModal=$(".div-manager-alerta-precio");a.overlayElement=null;a.onSuccess=function(){};a.alerta=null;a.cotizacion=null;$.extend(true,a,b);a.show=function(){var c=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,showOverlay:true,requestUrl:"pricealerts/conditions",requestType:"GET"});c.onSuccess=function(d){var e=new Core.Ajax.ServerRequest({overlayElement:a.overlayElement,showOverlay:true,requestUrl:"pricealerts/parameters",requestType:"GET",requestData:{idpersona:Core.Functions.Decimal.parseFloat(Core.Objects.Context.IdPersona)}});e.onSuccess=function(g){a.divAlert=a.divModal.find(".lbl-alert");a.divAlert.slideUp();a.lblTitulo=a.divModal.find(".lbl-title");a.lblTitulo.html("Configurar alerta de precio");a.lblTicker=a.divModal.find(".lbl-ticker");a.lblTicker.text(a.alerta?(a.alerta._Ticker+" "+a.alerta._Plazo):(a.cotizacion.ticker+" "+a.cotizacion.plazo.description));a.lblTickerDescripcion=a.divModal.find(".lbl-ticker-descripcion");a.lblTickerDescripcion.text(a.alerta?a.alerta._TickerDescripcion:a.cotizacion.descripcion);a.lblPrecio=a.divModal.find(".lbl-precio");a.lblPrecio.text(a.alerta?"":("Últ. Precio: "+Core.Functions.grid.formatPrice(a.cotizacion.precio)));a.lblVariacion=a.divModal.find(".lbl-variacion");a.lblVariacion.html(a.alerta?"":("Variación: "+Core.Functions.grid.formatPercentageTwoDecimal(a.cotizacion.variacion)));a.lblCantidadAlertasConfiguradas=a.divModal.find(".label-cantidad-alertas-configuradas");a.lblCantidadAlertasConfiguradas.html(((g&&g.extra_data)?("Tenés configuradas <strong>"+g.extra_data.active_alerts+"</strong> de "+g.extra_data.max_alerts+" alertas"):""));a.divEstadoActiva=a.divModal.find(".div-estado-activa");a.divEstadoActiva.hide();if(a.alerta){a.divEstadoActiva.show()}a.lblEstadoActiva=a.divModal.find(".label-estado-activa");a.chkEstadoActiva=a.divModal.find(".checkbox-estado-activa");a.chkEstadoActiva.unbind("change");a.chkEstadoActiva.on("change",function(){a.setLabels()});a.chkEstadoActiva[0].checked=(a.alerta?a.alerta._Activa:true);Core.Functions.Validations.toggleValidation(a.chkEstadoActiva,false);a.txtDescripcion=a.divModal.find(".textbox-descripcion");a.txtDescripcion.shieldTextBox({value:(a.alerta?a.alerta.description:"")});Core.Functions.Validations.toggleValidation(a.txtDescripcion,false);a.lblCondicion=a.divModal.find(".label-condicion");a.ddlCondicion=a.divModal.find(".dropdown-condicion");a.ddlCondicion.shieldDropDown({dataSource:{data:((d&&d.elements)?d.elements:[])},textTemplate:"{description}",valueTemplate:"{id}",value:(a.alerta?a.alerta.condition.id.toString():""),events:{select:function(h){a.setLabels()}}});Core.Functions.Validations.toggleValidation(a.ddlCondicion,false);a.ddlVariable=a.divModal.find(".dropdown-variable");a.ddlVariable.shieldDropDown({dataSource:{data:((g&&g.elements)?g.elements:[])},textTemplate:"{description}",valueTemplate:"{id}",value:(a.alerta?a.alerta.parameter.id.toString():"")});Core.Functions.Validations.toggleValidation(a.ddlVariable,false);a.txtValor=a.divModal.find(".textbox-valor");new Core.Controls.DecimalPicker(a.txtValor,{maxDecimalDigitCount:4,showThousandsSeparator:true,defaultValue:(a.alerta?a.alerta.amount:"")});Core.Functions.Validations.toggleValidation(a.txtValor,false);var f=[];if(g&&g.extra_data&&g.extra_data.start_time){g.extra_data.start_time.forEach(function(i,h){f.push({value:i})})}a.ddlHorarioActivacion=a.divModal.find(".dropdown-horario-activacion");a.ddlHorarioActivacion.shieldComboBox({dataSource:{data:f},textTemplate:"{value}",valueTemplate:"{value}",value:""});if(a.alerta){a.ddlHorarioActivacion.swidget().value(a.alerta.start_time)}Core.Functions.Validations.toggleValidation(a.ddlHorarioActivacion,false);a.btnConfirmar=a.divModal.find(".btn-confirmar-alerta");a.btnConfirmar.unbind("click");a.btnConfirmar.click(function(){Core.Functions.Validations.toggleValidation(a.chkEstadoActiva,false);Core.Functions.Validations.toggleValidation(a.txtDescripcion,false);Core.Functions.Validations.toggleValidation(a.ddlCondicion,false);Core.Functions.Validations.toggleValidation(a.ddlVariable,false);Core.Functions.Validations.toggleValidation(a.txtValor,false);Core.Functions.Validations.toggleValidation(a.ddlHorarioActivacion,false);a.divAlert.slideUp();if(!a.alerta&&g&&g.extra_data&&g.extra_data.active_alerts>=g.extra_data.max_alerts){a.divAlert.text("Alcanzaste la cantidad máxima de alertas configuradas.");a.divAlert.slideDown();return}var j={value:true};var h={};if(a.alerta){h.id=a.alerta.id}else{h.security_id=a.cotizacion.securityId}h.alert_type="CUSTOM";h.amount=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtValor,j));h.condition_id=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedDropDownValue(a.ddlCondicion,j));h.description=Core.Functions.Validations.getValidatedSwidgetValue(a.txtDescripcion,j);h.frequency="ONCE";h.parameter_id=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedDropDownValue(a.ddlVariable,j));h.idpersona=Core.Functions.Decimal.parseFloat(Core.Objects.Context.IdPersona);h.plazo=a.alerta?a.alerta.term:a.cotizacion.plazo.id.toString();h.state=a.alerta?(a.chkEstadoActiva[0].checked?1:0):1;h.start_time=a.ddlHorarioActivacion.swidget().selectedItem()?a.ddlHorarioActivacion.swidget().selectedItem().value:"";if(j.value){var i=new Core.Ajax.ServerRequest({overlayElement:a.btnConfirmar,requestType:(a.alerta?"PUT":"POST"),requestUrl:"pricealerts/setalert",requestData:h});i.onSuccess=function(k){a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){if(k&&k.Descripcion){new Core.Controls.Dialog("Mensaje",k.Descripcion,{displayButtons:{close:true,accept:false}}).show()}a.onSuccess();a.destroy()});a.divModal.modal("hide")};i.onError=function(l){var k=(l.responseJSON&&l.responseJSON.Descripcion)?l.responseJSON.Descripcion:"Algunos componentes de la página no se cargaron correctamente. Por favor intente mas tarde...";a.divAlert.text(k);a.divAlert.slideDown()};i.request()}});a.setLabels();a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.divModal.modal({show:true})};e.request()};c.request()};a.setLabels=function(){a.lblCondicion.html(a.ddlCondicion.swidget().selectedItem()?a.ddlCondicion.swidget().selectedItem().long_description:"");a.lblEstadoActiva.text(a.chkEstadoActiva[0].checked?"Activa":"Inactiva")};a.destroy=function(){a.txtDescripcion.swidget().destroy();a.ddlCondicion.swidget().destroy();a.ddlVariable.swidget().destroy();a.ddlHorarioActivacion.swidget().destroy()}};Core.Controls.ManagerAltaCuenta=function(b){var a=this;a.id="homeAltaCuenta";a.idDefaultProfile=null;a.idDefaultAccount=null;a.chkTipoCuentaFisica=null;a.chkTipoCuentaJuridica=null;a.show=function(){$("html, body").animate({scrollTop:$(".cuenta").offset().top},1000);a.idAperturaCuenta=0;a.versionActual=0;a.idNegocioDefault=Core.Enums.eNegocio.BCV;$.extend(true,a,b);a.parameters=b;a.divTipoCuenta=a.container.find(".div-tipo-cuenta");a.chkTipoCuentaFisica=a.container.find(".chk-tipo-cuenta-fisica");a.chkTipoCuentaJuridica=a.container.find(".chk-tipo-cuenta-juridica");a.initControls()};a.initControls=function(){a.divTipoCuenta.hide();if(!a.chkTipoCuentaFisica.swidget()){a.chkTipoCuentaFisica.shieldRadioButton({label:"Física",events:{click:function(c){a.setControls()}}})}Core.Functions.Validations.toggleValidation(a.chkTipoCuentaFisica,false);if(!a.chkTipoCuentaJuridica.swidget()){a.chkTipoCuentaJuridica.shieldRadioButton({label:"Jurídica",events:{click:function(c){a.setControls()}}})}Core.Functions.Validations.toggleValidation(a.chkTipoCuentaJuridica,false);a.getData()};a.getData=function(){a.parameters.dataCuenta=null;a.parameters.dataParametros=null;a.parameters.dataParametrosUsuario=null;var c=new Core.Ajax.ServerRequest({allowCache:true,secureRequest:true,requestUrl:"apertura/cuenta/parametrosusuario",requestType:"GET"});c.onSuccess=function(d){a.parameters.dataParametrosUsuario=d;var e=new Core.Ajax.ServerRequest({allowCache:true,secureRequest:true,requestUrl:"apertura/cuenta/parametros",requestType:"GET"});e.onSuccess=function(f){a.parameters.dataParametros=f;if(a.idAperturaCuenta>0){var g=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"apertura/cuenta/caso/"+a.idAperturaCuenta+((a.versionActual)?("?version="+a.versionActual):""),requestType:"GET"});g.onSuccess=function(h){a.parameters.dataCuenta=h;a.loadControls()};g.request()}else{a.loadControls()}};e.request()};c.request()};a.loadControls=function(){a.divTipoCuenta.hide();if(a.parameters.dataCuenta==null&&a.idNegocioDefault==Core.Enums.eNegocio.BCV){a.divTipoCuenta.show()}var c=a.chkTipoCuentaJuridica.swidget().initialOptions;c.checked=(a.parameters.dataCuenta!=null&&a.parameters.dataCuenta.datos[0].EsJuridica==1)?true:false;a.chkTipoCuentaJuridica.swidget().refresh(c);var c=a.chkTipoCuentaFisica.swidget().initialOptions;c.checked=(a.parameters.dataCuenta==null||(a.parameters.dataCuenta!=null&&a.parameters.dataCuenta.datos[0].EsJuridica==0))?true:false;a.chkTipoCuentaFisica.swidget().refresh(c);a.setControls()};a.setControls=function(){if(a.idNegocioDefault==Core.Enums.eNegocio.BCI||(a.parameters.dataCuenta&&a.parameters.dataCuenta.datos[0].idNegocio==Core.Enums.eNegocio.BCI)){if(a.chkTipoCuentaJuridica.swidget().checked()){new Core.Controls.ManagerAltaCuentaBCIJuridica(a.parameters).show()}else{new Core.Controls.ManagerAltaCuentaBCIFisica(a.parameters).show()}}else{if(a.chkTipoCuentaJuridica.swidget().checked()){new Core.Controls.ManagerAltaCuentaJuridica(a.parameters).show()}else{new Core.Controls.ManagerAltaCuentaFisica(a.parameters).show()}}}};Core.Business.eAmountRange={None:0,Hasta200:1,Entre200Y700:2,MasDe700:3,MasDe200:4};Core.Business.eTipoIdentificacionFiscal={None:0,CUIT:1,CUIL:2,CIE:3,CDI:4};Core.Business.eGenero={Femenino:0,Masculino:1};Core.Business.eEstadoCivil={None:0,Soltero:1,Casado:2,Divorciado:3,Separado:4,Viudo:5};Core.Business.eCanal={None:0,Web:1,PorFuncionarios:2,PorEmpleados:3,PorGestionComercial:4,Otro:5};Core.Business.eTipoFirma={None:0,Indistinta:1,Conjunta:2};Core.Business.eCaracterInvocado={None:0,Titular:1,Apoderado:2,Representante:3,Autorizado:4};Core.Business.eTipoDocumento={DNI:1,CI:2,LE:3,LC:4,PAS:5,Extranjero:6};Core.Business.eCondicionIVA={ConsumidorFinal:1,Exento:2,NoResponsable:3,ResponsableInscripto:4,ResponsableMonotributo:5,ResponsableInscriptoBanco:7,NoCategorizado:8};Core.Controls.ManagerAltaCuentaBCIFisica=function(b){var a=this;a.id="homeAltaCuenta";a.idDefaultProfile=null;a.idDefaultAccount=null;a.divInformes=null;a.divReadOnly=null;a.divVersion=null;a.ddlVersion=null;a.divAltaCuenta=null;a.divManagerPersona=null;a.divMatrizRiesgo=null;a.divAsesor=null;a.ddlAsesor=null;a.divContainerEstado=null;a.divDescripcionEstado=null;a.lblEstado=null;a.ddlEstado=null;a.divTipoFirma=null;a.chkTipoFirmaConjunta=null;a.chkTipoFirmaIndistinta=null;a.divIngresoAsesorFinanciero=null;a.txtIngresoAsesorFinanciero=null;a.chkIngresoAsesorFinanciero=null;a.txtUsuarioAsignado=null;a.divMontoInvertir=null;a.divMontoInvertirContainer=null;a.lblMontoInvertirAlert=null;a.divIngresosAnuales=null;a.divIngresosAnualesContainer=null;a.lblIngresosAnualesAlert=null;a.divPatrimonioNeto=null;a.divPatrimonioNetoContainer=null;a.lblPatrimonioNetoAlert=null;a.divOrigenPatrimonio=null;a.chkOrigenPatrimonioActividadPrincipal=null;a.chkOrigenPatrimonioVentaBienes=null;a.chkOrigenPatrimonioHerencia=null;a.chkOrigenPatrimonioOtro=null;a.divOrigenPatrimonioOtroDetalle=null;a.txtOrigenPatrimonioOtroDetalle=null;a.divConvenioComitenteAAGI=null;a.chkConvenioComitenteAAGI=null;a.divCanal=null;a.divCanalContainer=null;a.divCanalOtroDetalle=null;a.txtCanalOtroDetalle=null;a.divArancel=null;a.ddlArancel=null;a.divComoLlegoABalanz=null;a.txtComoLlegoABalanz=null;a.divTipoInversion=null;a.chkTipoInversionAcciones=null;a.chkTipoInversionOpciones=null;a.chkTipoInversionFondos=null;a.chkTipoInversionBonos=null;a.chkTipoInversionFuturos=null;a.chkTipoInversionOtro=null;a.divTipoInversionOtroDetalle=null;a.txtTipoInversionOtroDetalle=null;a.divPlazoInversion=null;a.txtPlazoInversion=null;a.divContainerPerfilCuenta=null;a.divNivelRiesgo=null;a.ddlNivelRiesgo=null;a.divDescripcionActividadCliente=null;a.txtReferenciaBancariaNombre=null;a.txtReferenciaBancariaApellido=null;a.ddlReferenciaBancariaCargo=null;a.txtReferenciaBancariaInstitucion=null;a.txtReferenciaBancariaTelefono=null;a.txtReferenciaBancariaEmail=null;a.txtReferenciaBancariaDomicilio=null;a.txtReferenciaBancariaCiudad=null;a.ddlReferenciaBancariaPais=null;a.txtContactoFallecimientoNombre=null;a.txtContactoFallecimientoApellido=null;a.txtContactoFallecimientoParentesco=null;a.txtContactoFallecimientoTelefono=null;a.txtContactoFallecimientoEmail=null;a.txtContactoFallecimientoDomicilio=null;a.txtContactoFallecimientoCiudad=null;a.ddlContactoFallecimientoPais=null;a.btnGuardarYCerrar=null;a.btnAvanzarImportacion=null;a.btnFormularioVacio=null;a.btnVolver=null;a.btnNuevaPersona=null;a.gridPersonas=null;a.btnAgregarArchivo=null;a.gridArchivos=null;a.divContainerObservaciones=null;a.gridObservaciones=null;a.btnAgregarObservacion=null;a.divAlert=null;a.detalleDisponible=null;a.dataCuenta=null;a.dataParametros=null;a.dataParametrosUsuario=null;a.personas=[];a.archivos=[];a.observaciones=[];a.idAperturaCuenta=null;a.aperturaCuenta=null;a.versionActual=null;a.optionsApertura=null;a.readOnly=null;a.pageOptions=null;a.namespaceActivo="";a.onClose=function(){};a.onSave=function(c,d){};a.show=function(){$("html, body").animate({scrollTop:$(".cuenta").offset().top},1000);a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu("matrizDeRiesgo",Core.Objects.Context.Profiles[0]);a.idAperturaCuenta=0;a.versionActual=0;a.maxVersion=0;a.optionsApertura=null;a.readOnly=false;a.aperturaCuenta=null;a.namespaceActivo="";a.dataParametros=null;a.dataParametrosUsuario=null;a.dataCuenta=null;$.extend(true,a,b);a.divAltaCuenta=a.container.find(".div-alta-cuenta");a.divManagerPersona=a.container.find(".div-manager-titular-autorizado");a.divMatrizRiesgo=a.container.find(".div-container-matriz-riesgo");a.divManagerAltaCuenta=a.container.find(".div-manager-alta-cuenta");a.divManagerAltaCuenta.html("");a.divManagerAltaCuenta.load("/Pages/manager-cuenta-bci-fisica.html",function(c,d,e){if(d=="success"){a.divAltaCuenta.show();a.divManagerPersona.hide();a.divMatrizRiesgo.hide();a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[a.idDefaultProfile]);a.titlePage=a.divManagerAltaCuenta.find(".title-page");a.titlePage.text((a.idAperturaCuenta)?("Cuenta BCI: "+a.idAperturaCuenta):"Alta Cuenta BCI");a.divDescripcionCuenta=a.divManagerAltaCuenta.find(".div-descripcion-cuenta");a.lblDescripcionCuenta=a.divManagerAltaCuenta.find(".lbl-descripcion-cuenta");a.divComitenteCuotapartistaCuenta=a.divManagerAltaCuenta.find(".div-comitente-coutapartista-cuenta");a.lblComitenteCuotapartistaCuenta=a.divManagerAltaCuenta.find(".lbl-comitente-coutapartista-cuenta");a.divDescripcionCuenta.hide();a.divComitenteCuotapartistaCuenta.hide();a.divReadOnly=a.divManagerAltaCuenta.find(".div-read-only");a.divInformes=a.divManagerAltaCuenta.find(".div-cuenta-informes");a.divVersion=a.divManagerAltaCuenta.find(".div-version");a.ddlVersion=a.divManagerAltaCuenta.find(".dropdown-version");a.divAsesor=a.divManagerAltaCuenta.find(".div-asesor");a.divAsesor=a.divManagerAltaCuenta.find(".div-asesor");a.ddlAsesor=a.divManagerAltaCuenta.find(".dropdown-asesor");a.divUsarFirmaDigital=a.divManagerAltaCuenta.find(".div-usar-firma-digital");a.chkUsarFirmaDigital=a.divManagerAltaCuenta.find(".checkbox-usar-firma-digital");a.divContainerEstado=a.divManagerAltaCuenta.find(".div-container-estado");a.ddlEstado=a.divManagerAltaCuenta.find(".dropdown-estado");a.lblEstadoCuenta=a.divManagerAltaCuenta.find(".lbl-estado-cuenta");a.divDescripcionEstado=a.divManagerAltaCuenta.find(".div-descripcion-estado");a.divTipoFirma=a.divManagerAltaCuenta.find(".div-tipo-firma");a.chkTipoFirmaConjunta=a.divManagerAltaCuenta.find(".chk-tipo-firma-conjunta");a.chkTipoFirmaIndistinta=a.divManagerAltaCuenta.find(".chk-tipo-firma-indistinta");a.chkIngresoAsesorFinanciero=a.divManagerAltaCuenta.find(".checkbox-ingreso-asesor-financiero");a.txtIngresoAsesorFinanciero=a.divManagerAltaCuenta.find(".textbox-ingreso-asesor-financiero");a.divIngresoAsesorFinanciero=a.divManagerAltaCuenta.find(".div-ingreso-asesor-financiero");a.divMontoInvertir=a.divManagerAltaCuenta.find(".div-monto-invertir");a.divMontoInvertirContainer=a.divManagerAltaCuenta.find(".div-monto-invertir-container");a.lblMontoInvertirAlert=a.divManagerAltaCuenta.find(".lbl-monto-invertir-alert");a.lblMontoInvertirAlert.html("");a.divIngresosAnuales=a.divManagerAltaCuenta.find(".div-ingresos-anuales");a.divIngresosAnualesContainer=a.divManagerAltaCuenta.find(".div-ingresos-anuales-container");a.lblIngresosAnualesAlert=a.divManagerAltaCuenta.find(".lbl-ingresos-anuales-alert");a.lblIngresosAnualesAlert.html("");a.divPatrimonioNeto=a.divManagerAltaCuenta.find(".div-patrimonio-neto");a.divPatrimonioNetoContainer=a.divManagerAltaCuenta.find(".div-patrimonio-neto-container");a.lblPatrimonioNetoAlert=a.divManagerAltaCuenta.find(".lbl-patrimonio-neto-alert");a.lblPatrimonioNetoAlert.html("");a.divExperienciaInversionesNivel=a.divManagerAltaCuenta.find(".div-experiencia-inversiones-nivel");a.divExperienciaInversionesNivelContainer=a.divManagerAltaCuenta.find(".div-experiencia-inversiones-nivel-container");a.lblExperienciaInversionesNivelAlert=a.divManagerAltaCuenta.find(".lbl-experiencia-inversiones-nivel-alert");a.lblExperienciaInversionesNivelAlert.html("");a.divExperienciaInversiones=a.divManagerAltaCuenta.find(".div-experiencia-inversiones");a.chkExperienciaInversionesBonos=a.divManagerAltaCuenta.find(".chk-experiencia-inversiones-bonos");a.chkExperienciaInversionesAcciones=a.divManagerAltaCuenta.find(".chk-experiencia-inversiones-acciones");a.chkExperienciaInversionesFondos=a.divManagerAltaCuenta.find(".chk-experiencia-inversiones-fondos");a.chkExperienciaInversionesOpciones=a.divManagerAltaCuenta.find(".chk-experiencia-inversiones-opciones");a.chkExperienciaInversionesFuturos=a.divManagerAltaCuenta.find(".chk-experiencia-inversiones-futuros");a.chkExperienciaInversionesOtro=a.divManagerAltaCuenta.find(".chk-experiencia-inversiones-otro");a.divExperienciaInversionesOtroDetalle=a.divManagerAltaCuenta.find(".div-experiencia-inversiones-otro-detalle");a.txtExperienciaInversionesOtroDetalle=a.divManagerAltaCuenta.find(".textbox-experiencia-inversiones-otro-detalle");a.divRelacionInversionPatrimonio=a.divManagerAltaCuenta.find(".div-relacion-inversion-patrimonio");a.divRelacionInversionPatrimonioContainer=a.divManagerAltaCuenta.find(".div-relacion-inversion-patrimonio-container");a.lblRelacionInversionPatrimonioAlert=a.divManagerAltaCuenta.find(".lbl-relacion-inversion-patrimonio-alert");a.lblRelacionInversionPatrimonioAlert.html("");a.divObjetivoInversion=a.divManagerAltaCuenta.find(".div-objetivo-inversion");a.divObjetivoInversionContainer=a.divManagerAltaCuenta.find(".div-objetivo-inversion-container");a.lblObjetivoInversionAlert=a.divManagerAltaCuenta.find(".lbl-objetivo-inversion-alert");a.lblObjetivoInversionAlert.html("");a.divObjetivoInversionDetallePeriodo=a.divManagerAltaCuenta.find(".div-objetivo-inversion-detalle-periodo");a.txtObjetivoInversionDetallePeriodo=a.divManagerAltaCuenta.find(".textbox-objetivo-inversion-detalle-periodo");a.divNivelToleranciaRiesgo=a.divManagerAltaCuenta.find(".div-nivel-tolerancia-riesgo");a.divNivelToleranciaRiesgoContainer=a.divManagerAltaCuenta.find(".div-nivel-tolerancia-riesgo-container");a.lblNivelToleranciaRiesgoAlert=a.divManagerAltaCuenta.find(".lbl-nivel-tolerancia-riesgo-alert");a.lblNivelToleranciaRiesgoAlert.html("");a.divOrigenPatrimonio=a.divManagerAltaCuenta.find(".div-origen-patrimonio");a.chkOrigenPatrimonioActividadPrincipal=a.divManagerAltaCuenta.find(".chk-origen-patrimonio-actividad-principal");a.chkOrigenPatrimonioVentaBienes=a.divManagerAltaCuenta.find(".chk-origen-patrimonio-venta-bienes");a.chkOrigenPatrimonioHerencia=a.divManagerAltaCuenta.find(".chk-origen-patrimonio-herencia");a.chkOrigenPatrimonioOtro=a.divManagerAltaCuenta.find(".chk-origen-patrimonio-otro");a.divOrigenPatrimonioOtroDetalle=a.divManagerAltaCuenta.find(".div-otro-patrimonio-detalle");a.txtOrigenPatrimonioOtroDetalle=a.divManagerAltaCuenta.find(".textbox-otro-patrimonio-detalle");a.chkFondeoCuentaTransferenciaTitulosCuentaInversion=a.divManagerAltaCuenta.find(".chk-fondeo-cuenta-transferencia-titulos-cuenta-inversion");a.chkFondeoCuentaTransferenciaDineroCuentaInversion=a.divManagerAltaCuenta.find(".chk-fondeo-cuenta-transferencia-dinero-cuenta-inversion");a.chkFondeoCuentaTransferenciaDineroBanco=a.divManagerAltaCuenta.find(".chk-fondeo-cuenta-transferencia-dinero-banco");a.chkFondeoCuentaOtro=a.divManagerAltaCuenta.find(".chk-fondeo-cuenta-otro");a.divFondeoCuentaOtroDetalle=a.divManagerAltaCuenta.find(".div-fondeo-cuenta-otro-detalle");a.txtFondeoCuentaOtroDetalle=a.divManagerAltaCuenta.find(".textbox-fondeo-cuenta-otro-detalle");a.txtCantidadTransferenciasHaciaCuentaPorAnio=a.divManagerAltaCuenta.find(".textbox-cantidad-transferencias-hacia-su-cuenta-por-anio");a.txtPaisesCuentaOrigen=a.divManagerAltaCuenta.find(".textbox-paises-cuentas-origen");a.txtCantidadTransferenciasDesdeCuentaPorAnio=a.divManagerAltaCuenta.find(".textbox-cantidad-transferencias-desde-su-cuenta-por-anio");a.txtPaisesCuentaDestino=a.divManagerAltaCuenta.find(".textbox-paises-cuentas-destino");a.divConvenioComitenteAAGI=a.divManagerAltaCuenta.find(".div-convenio-comitente-aagi");a.chkConvenioComitenteAAGI=a.divManagerAltaCuenta.find(".checkbox-convenio-comitente-aagi");a.divCanal=a.divManagerAltaCuenta.find(".div-canal");a.divCanalContainer=a.divManagerAltaCuenta.find(".div-canal-container");a.divCanalOtroDetalle=a.divManagerAltaCuenta.find(".div-canal-otro-detalle");a.txtCanalOtroDetalle=a.divManagerAltaCuenta.find(".textbox-canal-otro-detalle");a.divArancel=a.divManagerAltaCuenta.find(".div-arancel");a.ddlArancel=a.divManagerAltaCuenta.find(".dropdown-arancel");a.divContainerPerfilCuenta=a.divManagerAltaCuenta.find(".div-container-perfil-cuenta");a.divNivelRiesgo=a.divManagerAltaCuenta.find(".div-nivel-riesgo");a.ddlNivelRiesgo=a.divManagerAltaCuenta.find(".dropdown-nivel-riesgo");a.divComoLlegoABalanz=a.divManagerAltaCuenta.find(".div-como-llego-a-balanz");a.txtComoLlegoABalanz=a.divManagerAltaCuenta.find(".textbox-como-llego-a-balanz");a.txtUsuarioAsignado=a.divManagerAltaCuenta.find(".textbox-usuario-asignado");a.divTipoInversion=a.divManagerAltaCuenta.find(".div-tipo-inversion");a.chkTipoInversionAcciones=a.divManagerAltaCuenta.find(".chk-tipo-inversion-acciones");a.chkTipoInversionOpciones=a.divManagerAltaCuenta.find(".chk-tipo-inversion-opciones");a.chkTipoInversionFondos=a.divManagerAltaCuenta.find(".chk-tipo-inversion-fondos");a.chkTipoInversionBonos=a.divManagerAltaCuenta.find(".chk-tipo-inversion-bonos");a.chkTipoInversionFuturos=a.divManagerAltaCuenta.find(".chk-tipo-inversion-futuros");a.chkTipoInversionOtro=a.divManagerAltaCuenta.find(".chk-tipo-inversion-otro");a.divTipoInversionOtroDetalle=a.divManagerAltaCuenta.find(".div-tipo-inversion-otro-detalle");a.txtTipoInversionOtroDetalle=a.divManagerAltaCuenta.find(".textbox-tipo-inversion-otro-detalle");a.divPlazoInversion=a.divManagerAltaCuenta.find(".div-plazo-inversion");a.txtPlazoInversion=a.divManagerAltaCuenta.find(".textbox-plazo-inversion");a.divDescripcionActividadCliente=a.divManagerAltaCuenta.find(".div-descripcion-actividad-cliente");a.txtDescripcionActividadCliente=a.divManagerAltaCuenta.find(".textbox-descripcion-actividad-cliente");a.txtDepositoInicialDolares=a.divManagerAltaCuenta.find(".textbox-deposito-inicial-dolares");a.chkCambiosSignificativosPatrimonio=a.divManagerAltaCuenta.find(".checkbox-cambios-significativos-patrimonio");a.divCambiosSignificativosPatrimonioDetalle=a.divManagerAltaCuenta.find(".div-cambios-significativos-patrimonio-detalle");a.txtCambiosSignificativosPatrimonioDetalle=a.divManagerAltaCuenta.find(".textbox-cambios-significativos-patrimonio-detalle");a.txtReferenciaBancariaNombre=a.divManagerAltaCuenta.find(".textbox-referencia-bancaria-nombre");a.txtReferenciaBancariaApellido=a.divManagerAltaCuenta.find(".textbox-referencia-bancaria-apellido");a.ddlReferenciaBancariaCargo=a.divManagerAltaCuenta.find(".dropdown-referencia-bancaria-cargo");a.txtReferenciaBancariaInstitucion=a.divManagerAltaCuenta.find(".textbox-referencia-bancaria-institucion");a.txtReferenciaBancariaTelefono=a.divManagerAltaCuenta.find(".textbox-referencia-bancaria-telefono");a.txtReferenciaBancariaEmail=a.divManagerAltaCuenta.find(".textbox-referencia-bancaria-email");a.txtReferenciaBancariaDomicilio=a.divManagerAltaCuenta.find(".textbox-referencia-bancaria-domicilio");a.txtReferenciaBancariaCiudad=a.divManagerAltaCuenta.find(".textbox-referencia-bancaria-ciudad");a.ddlReferenciaBancariaPais=a.divManagerAltaCuenta.find(".dropdown-referencia-bancaria-pais");a.txtContactoFallecimientoNombre=a.divManagerAltaCuenta.find(".textbox-contacto-fallecimiento-nombre");a.txtContactoFallecimientoApellido=a.divManagerAltaCuenta.find(".textbox-contacto-fallecimiento-apellido");a.txtContactoFallecimientoParentesco=a.divManagerAltaCuenta.find(".textbox-contacto-fallecimiento-parentesco");a.txtContactoFallecimientoTelefono=a.divManagerAltaCuenta.find(".textbox-contacto-fallecimiento-telefono");a.txtContactoFallecimientoEmail=a.divManagerAltaCuenta.find(".textbox-contacto-fallecimiento-email");a.txtContactoFallecimientoDomicilio=a.divManagerAltaCuenta.find(".textbox-contacto-fallecimiento-domicilio");a.txtContactoFallecimientoCiudad=a.divManagerAltaCuenta.find(".textbox-contacto-fallecimiento-ciudad");a.ddlContactoFallecimientoPais=a.divManagerAltaCuenta.find(".dropdown-contacto-fallecimiento-pais");a.divContainerObservaciones=a.divManagerAltaCuenta.find(".div-container-observaciones");a.gridObservaciones=a.divManagerAltaCuenta.find(".div-observaciones");a.btnAgregarObservacion=a.divManagerAltaCuenta.find(".btn-agregar-observacion");a.btnNuevaPersona=a.divManagerAltaCuenta.find(".btn-nueva-persona");a.btnAgregarArchivo=a.divManagerAltaCuenta.find(".btn-agregar-archivo");a.btnGuardarYCerrar=a.divManagerAltaCuenta.find(".btn-guardar-cerrar");a.btnAvanzarImportacion=a.divManagerAltaCuenta.find(".btn-avanzar-importacion");a.btnRefirmar=a.divManagerAltaCuenta.find(".btn-refirmar");a.btnAnularFirma=a.divManagerAltaCuenta.find(".btn-anular-firma");a.btnFormularioVacio=a.divManagerAltaCuenta.find(".btn-formulario-vacio");a.btnVolver=a.divManagerAltaCuenta.find(".btn-volver");a.gridPersonas=a.divManagerAltaCuenta.find(".div-personas");a.gridArchivos=a.divManagerAltaCuenta.find(".div-archivos");a.divAlert=a.divManagerAltaCuenta.find(".div-alert");a.divAlert.slideUp();a.initControls()}})};a.initControls=function(){a.divReadOnly.hide();if(a.readOnly){a.divReadOnly.show();a.divVersion.show();if(a.namespaceActivo=="OpenManagerAltaCuenta"){a.divVersion.hide()}}a.divContainerPerfilCuenta.hide();if(Core.Objects.Context.Configuration.idAplicacion==3){a.divContainerPerfilCuenta.show()}a.btnAgregarArchivo.show();a.btnNuevaPersona.show();a.btnGuardarYCerrar.show();if(!a.idAperturaCuenta){a.btnFormularioVacio.show()}else{a.btnFormularioVacio.hide()}a.btnAgregarObservacion.show();if(a.readOnly){a.btnAgregarArchivo.hide();a.btnNuevaPersona.hide();a.btnGuardarYCerrar.hide();a.btnFormularioVacio.hide();a.btnAgregarObservacion.hide()}a.btnVolver.show();if(a.namespaceActivo=="OpenManagerAltaCuenta"){a.btnVolver.hide()}a.btnRefirmar.hide();if(!a.readOnly&&a.dataCuenta&&a.dataCuenta.datos[0].refirmar){a.btnRefirmar.show()}a.btnAnularFirma.hide();if(!a.readOnly&&a.dataCuenta&&a.dataCuenta.datos[0].anularFirma){a.btnAnularFirma.show()}a.btnAvanzarImportacion.hide();if(!a.readOnly&&a.idAperturaCuenta&&a.dataCuenta!=null&&a.optionsApertura&&a.optionsApertura.verBotonFF&&a.optionsApertura.verBotonFF!=""){var d=a.optionsApertura.verBotonFF.split(",");if($.grep(d,function(f,g){return f!=""&&f==a.dataCuenta.datos[0].idEstadoAperturaCuenta})[0]){a.btnAvanzarImportacion.show()}}a.divContainerObservaciones.show();a.divContainerEstado.show();a.divDescripcionEstado.show();if(!a.idAperturaCuenta){a.divContainerObservaciones.hide();a.divContainerEstado.hide();a.divDescripcionEstado.hide()}a.divAltaCuenta.show();a.divManagerPersona.hide();a.divMatrizRiesgo.hide();a.ddlVersion.shieldDropDown({dataSource:{data:[]},valueTemplate:"{version}",textTemplate:"{version}",events:{select:function(f){var g=a.ddlVersion.swidget().selectedItem().version;a.destroy(false);var e=new Core.Controls.ManagerAltaCuenta({idAperturaCuenta:a.idAperturaCuenta,versionActual:g,optionsApertura:a.optionsApertura,readOnly:a.readOnly,maxVersion:a.maxVersion,namespaceActivo:a.namespaceActivo,onClose:a.onClose,onSave:a.onSave,container:a.container,idDefaultProfile:a.idDefaultProfile,idDefaultAccount:a.idDefaultAccount}).show()}}});Core.Functions.Validations.toggleValidation(a.ddlVersion,false);a.ddlEstado.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idEstadoAperturaCuenta}",textTemplate:"{Nombre}",events:{select:function(e){a.lblEstadoCuenta.text(a.ddlEstado.swidget().selectedItem().Nombre)}}});Core.Functions.Validations.toggleValidation(a.ddlEstado,false);a.ddlAsesor.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idPersona}",textTemplate:"{Nombre}",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}}});Core.Functions.Validations.toggleValidation(a.ddlAsesor,false);a.chkUsarFirmaDigital.shieldCheckBox({label:"Usar firma digital"});Core.Functions.Validations.toggleValidation(a.chkUsarFirmaDigital,false);a.chkIngresoAsesorFinanciero.shieldCheckBox({label:"Asesor financiero, productor o referido",enabled:false,events:{click:function(f){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.chkIngresoAsesorFinanciero,false);a.txtIngresoAsesorFinanciero.shieldTextBox({value:"",enabled:false});Core.Functions.Validations.toggleValidation(a.txtIngresoAsesorFinanciero,false);if(!a.chkTipoFirmaConjunta.swidget()){a.chkTipoFirmaConjunta.shieldRadioButton({label:"Conjunta"})}Core.Functions.Validations.toggleValidation(a.chkTipoFirmaConjunta,false);if(!a.chkTipoFirmaIndistinta.swidget()){a.chkTipoFirmaIndistinta.shieldRadioButton({label:"Indistinta"})}Core.Functions.Validations.toggleValidation(a.chkTipoFirmaIndistinta,false);a.chkOrigenPatrimonioActividadPrincipal.shieldCheckBox({label:"Actividad Principal"});Core.Functions.Validations.toggleValidation(a.chkOrigenPatrimonioActividadPrincipal,false);a.chkOrigenPatrimonioVentaBienes.shieldCheckBox({label:"Venta de Bienes"});Core.Functions.Validations.toggleValidation(a.chkOrigenPatrimonioVentaBienes,false);a.chkOrigenPatrimonioHerencia.shieldCheckBox({label:"Herencia"});Core.Functions.Validations.toggleValidation(a.chkOrigenPatrimonioHerencia,false);a.chkOrigenPatrimonioOtro.shieldCheckBox({label:"Otro",events:{click:function(f){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.chkOrigenPatrimonioOtro,false);a.txtOrigenPatrimonioOtroDetalle.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtOrigenPatrimonioOtroDetalle,false);a.chkFondeoCuentaTransferenciaTitulosCuentaInversion.shieldCheckBox({label:"Transferencia de títulos desde otra cuenta de inversión propia"});Core.Functions.Validations.toggleValidation(a.chkFondeoCuentaTransferenciaTitulosCuentaInversion,false);a.chkFondeoCuentaTransferenciaDineroCuentaInversion.shieldCheckBox({label:"Transferencia de dinero desde otra cuenta de inversión propia"});Core.Functions.Validations.toggleValidation(a.chkFondeoCuentaTransferenciaDineroCuentaInversion,false);a.chkFondeoCuentaTransferenciaDineroBanco.shieldCheckBox({label:"Transferencia de dinero desde una cuenta bancaria propia"});Core.Functions.Validations.toggleValidation(a.chkFondeoCuentaTransferenciaDineroBanco,false);a.chkFondeoCuentaOtro.shieldCheckBox({label:"Otro",events:{click:function(f){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.chkFondeoCuentaOtro,false);a.txtFondeoCuentaOtroDetalle.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtFondeoCuentaOtroDetalle,false);a.txtCantidadTransferenciasHaciaCuentaPorAnio.shieldNumericTextBox({min:0,max:99999,step:1});Core.Functions.Validations.toggleValidation(a.txtCantidadTransferenciasHaciaCuentaPorAnio,false);a.txtPaisesCuentaOrigen.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtPaisesCuentaOrigen,false);a.txtCantidadTransferenciasDesdeCuentaPorAnio.shieldNumericTextBox({min:0,max:99999,step:1});Core.Functions.Validations.toggleValidation(a.txtCantidadTransferenciasDesdeCuentaPorAnio,false);a.txtPaisesCuentaDestino.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtPaisesCuentaDestino,false);a.chkConvenioComitenteAAGI.shieldCheckBox({label:"Mandato Discrecional",enabled:false});Core.Functions.Validations.toggleValidation(a.chkConvenioComitenteAAGI,false);a.txtCanalOtroDetalle.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtCanalOtroDetalle,false);a.txtObjetivoInversionDetallePeriodo.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtObjetivoInversionDetallePeriodo,false);a.ddlArancel.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idArancel}",textTemplate:"{Descripcion}",autoComplete:{enabled:false}});Core.Functions.Validations.toggleValidation(a.ddlArancel,false);a.ddlNivelRiesgo.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idRiesgo}",textTemplate:"{RiesgoDescripcion}",enabled:false});Core.Functions.Validations.toggleValidation(a.ddlNivelRiesgo,false);a.txtComoLlegoABalanz.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtComoLlegoABalanz,false);a.txtUsuarioAsignado.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtUsuarioAsignado,false);a.chkTipoInversionAcciones.shieldCheckBox({label:"Acciones"});Core.Functions.Validations.toggleValidation(a.chkTipoInversionAcciones,false);a.chkTipoInversionFondos.shieldCheckBox({label:"Fondos"});Core.Functions.Validations.toggleValidation(a.chkTipoInversionFondos,false);a.chkTipoInversionOpciones.shieldCheckBox({label:"Opciones"});Core.Functions.Validations.toggleValidation(a.chkTipoInversionOpciones,false);a.chkTipoInversionBonos.shieldCheckBox({label:"Bonos"});Core.Functions.Validations.toggleValidation(a.chkTipoInversionBonos,false);a.chkTipoInversionFuturos.shieldCheckBox({label:"Futuros"});Core.Functions.Validations.toggleValidation(a.chkTipoInversionFuturos,false);a.chkTipoInversionOtro.shieldCheckBox({label:"Otro",events:{click:function(f){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.chkTipoInversionOtro,false);a.txtTipoInversionOtroDetalle.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtTipoInversionOtroDetalle,false);a.chkExperienciaInversionesAcciones.shieldCheckBox({label:"Acciones"});Core.Functions.Validations.toggleValidation(a.chkExperienciaInversionesAcciones,false);a.chkExperienciaInversionesFondos.shieldCheckBox({label:"Fondos"});Core.Functions.Validations.toggleValidation(a.chkExperienciaInversionesFondos,false);a.chkExperienciaInversionesOpciones.shieldCheckBox({label:"Opciones"});Core.Functions.Validations.toggleValidation(a.chkExperienciaInversionesOpciones,false);a.chkExperienciaInversionesBonos.shieldCheckBox({label:"Bonos"});Core.Functions.Validations.toggleValidation(a.chkExperienciaInversionesBonos,false);a.chkExperienciaInversionesFuturos.shieldCheckBox({label:"Futuros"});Core.Functions.Validations.toggleValidation(a.chkExperienciaInversionesFuturos,false);a.chkExperienciaInversionesOtro.shieldCheckBox({label:"Otro",events:{click:function(f){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.chkExperienciaInversionesOtro,false);a.txtExperienciaInversionesOtroDetalle.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtExperienciaInversionesOtroDetalle,false);a.txtPlazoInversion.shieldNumericTextBox({min:0,max:99999,step:1});Core.Functions.Validations.toggleValidation(a.txtPlazoInversion,false);a.txtDescripcionActividadCliente.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtDescripcionActividadCliente,false);a.controlDepositoInicialDolares=new Core.Controls.DecimalPicker(a.txtDepositoInicialDolares,{maxDecimalDigitCount:2,showThousandsSeparator:true});Core.Functions.Validations.toggleValidation(a.txtDepositoInicialDolares,false);a.chkCambiosSignificativosPatrimonio.shieldCheckBox({label:"Hubo cambios significativos en su patrimonio en los ultimos 2 años",events:{click:function(f){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.chkCambiosSignificativosPatrimonio,false);a.txtCambiosSignificativosPatrimonioDetalle.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtCambiosSignificativosPatrimonioDetalle,false);a.txtReferenciaBancariaNombre.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtReferenciaBancariaNombre,false);a.txtReferenciaBancariaApellido.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtReferenciaBancariaApellido,false);a.ddlReferenciaBancariaCargo.shieldDropDown({dataSource:{data:[{value:"Oficial de cuentas"},{value:"Otro"}]},valueTemplate:"{value}",textTemplate:"{value}"});Core.Functions.Validations.toggleValidation(a.ddlReferenciaBancariaCargo,false);a.txtReferenciaBancariaInstitucion.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtReferenciaBancariaInstitucion,false);a.txtReferenciaBancariaTelefono.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtReferenciaBancariaTelefono,false);a.txtReferenciaBancariaEmail.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtReferenciaBancariaEmail,false);a.txtReferenciaBancariaDomicilio.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtReferenciaBancariaDomicilio,false);a.txtReferenciaBancariaCiudad.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtReferenciaBancariaCiudad,false);a.ddlReferenciaBancariaPais.shieldComboBox({dataSource:{data:a.dataParametros.paises},valueTemplate:"{idPais}",textTemplate:"{Nombre}",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{blur:function(f){if(a.ddlReferenciaBancariaPais.swidget().selectedItem()==null){a.ddlReferenciaBancariaPais.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlReferenciaBancariaPais,false);a.txtContactoFallecimientoNombre.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtContactoFallecimientoNombre,false);a.txtContactoFallecimientoApellido.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtContactoFallecimientoApellido,false);a.txtContactoFallecimientoParentesco.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtContactoFallecimientoParentesco,false);a.txtContactoFallecimientoTelefono.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtContactoFallecimientoTelefono,false);a.txtContactoFallecimientoEmail.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtContactoFallecimientoEmail,false);a.txtContactoFallecimientoDomicilio.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtContactoFallecimientoDomicilio,false);a.txtContactoFallecimientoCiudad.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtContactoFallecimientoCiudad,false);a.ddlContactoFallecimientoPais.shieldComboBox({dataSource:{data:a.dataParametros.paises},valueTemplate:"{idPais}",textTemplate:"{Nombre}",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{blur:function(f){if(a.ddlContactoFallecimientoPais.swidget().selectedItem()==null){a.ddlContactoFallecimientoPais.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlContactoFallecimientoPais,false);a.btnAgregarArchivo.unbind("click");a.btnAgregarArchivo.on("click",function(){var e=new Core.Controls.ManagerAltaCuentaNuevoArchivo({onSave:function(g){a.archivos.push({urlArchivo:g.file.urlArchivo,idTipoArchivo:g.idTipoArchivo,Tipo:g.Tipo,Fecha:g.Fecha,Comentario:g.comentarios});var f=a.gridArchivos.swidget().initialOptions;f.dataSource.data=a.archivos;a.gridArchivos.swidget().refresh(f)},tiposArchivos:((a.dataParametros!=null)?$.grep(a.dataParametros.TiposArchivos,function(g,f){return g.Fisica&&g.BCI}):[])}).show()});a.btnNuevaPersona.unbind("click");a.btnNuevaPersona.on("click",function(){a.divAltaCuenta.hide();a.divManagerPersona.show();a.divMatrizRiesgo.hide();var e=new Core.Controls.ManagerPersonaBCI({container:a.divManagerPersona,divMatrizRiesgo:a.divMatrizRiesgo,namespaceActivo:a.namespaceActivo,idTipoValidacion:(a.dataCuenta&&a.ddlEstado.swidget().selectedItem())?a.ddlEstado.swidget().selectedItem().idTipoValidacion:0,dataParametros:a.dataParametros,dataParametrosUsuario:a.dataParametrosUsuario,optionsApertura:a.optionsApertura,idAperturaCuenta:a.idAperturaCuenta,esCuentaJuridica:false,onSave:function(g){var f=a.getMaxNumero(g.tipo);if(a.isAperturaWeb()&&g.tipo==Core.Business.eTipoPersonaCuenta.Titular&&f<=4){f=4}g.numero=f+1;a.personas.push(g);a.refreshPersonas();a.setNivelDeRiesgo();return true},onClose:function(){a.divAltaCuenta.show();a.divManagerPersona.hide();a.divMatrizRiesgo.hide()}}).show()});a.btnAgregarObservacion.unbind("click");a.btnAgregarObservacion.on("click",function(){new Core.Controls.Prompt("Nueva Observación","Ingrese la observación",{onAccepted:function(e){var f=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"apertura/cuenta/observacion/"+a.idAperturaCuenta,requestType:"POST",requestData:{observacion:e}});f.onSuccess=function(h){a.observaciones=h.observaciones;var g=a.gridObservaciones.swidget().initialOptions;g.dataSource.data=a.observaciones;a.gridObservaciones.swidget().refresh(g)};f.request()}}).show()});a.btnVolver.unbind("click");a.btnVolver.on("click",function(){a.destroy(true)});a.btnGuardarYCerrar.unbind("click");a.btnGuardarYCerrar.on("click",function(){var e=a.getRequestData(a.ddlEstado.swidget().selectedItem());if(e!=null){var f=new Core.Ajax.ServerRequest({showOverlay:true,requestUrl:"apertura/cuenta",requestType:"POST",requestData:e});f.onSuccess=function(g){if(a.onSave){a.onSave(g.idAperturaCuenta,g.version)}a.destroy(true)};f.request()}else{$("html, body").animate({scrollTop:$(".cuenta").offset().top},1000)}});a.btnRefirmar.unbind("click");a.btnRefirmar.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea Reenviar el mail de firma? Esta acción reenviará los mails con los links para la firma digital a todos aquellos destinatarios que aún no hayan firmado.",{onAccepted:function(){var e=new Core.Ajax.ServerRequest({overlayElement:a.btnRefirmar,secureRequest:true,requestUrl:"apertura/cuenta/refirmar",requestType:"POST",requestData:{idAperturaCuenta:a.idAperturaCuenta}});e.onSuccess=function(){if(a.onSave){a.onSave(a.dataCuenta.datos[0].idAperturaCuenta,a.dataCuenta.datos[0].version)}a.destroy(true)};e.request()}}).show()});a.btnAnularFirma.unbind("click");a.btnAnularFirma.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea Anular la Firma de esta Apertura? Esta acción desestimará la última firma completa que tenga esta apertura, requiriendo que se deba volver a firmar por el cliente.",{onAccepted:function(){var e=new Core.Ajax.ServerRequest({overlayElement:a.btnAnularFirma,secureRequest:true,requestUrl:"apertura/cuenta/anularfirma",requestType:"POST",requestData:{idAperturaCuenta:a.idAperturaCuenta}});e.onSuccess=function(f){new Core.Controls.Dialog("Aviso",(f.Descripcion?f.Descripcion:"Operación realizada con éxito."),{displayButtons:{close:true,accept:false}}).show()};e.request()}}).show()});a.btnAvanzarImportacion.unbind("click");a.btnAvanzarImportacion.on("click",function(){new Core.Controls.Confirmation("Confirmación","Atención: Esta apertura será enviada al Importador. Se le generarán Matrices a todas las Personas que aún no tengan una creada y se pasará automáticamente de estado. Estas seguro que querés continuar?",{onAccepted:function(){var e=a.getRequestData({idEstadoAperturaCuenta:6,idTipoValidacion:1});if(e!=null){var f=new Core.Ajax.ServerRequest({showOverlay:true,requestUrl:"apertura/cuenta?ff=1",requestType:"POST",requestData:e});f.onSuccess=function(g){if(a.onSave){a.onSave(g.idAperturaCuenta,g.version)}a.destroy(true)};f.request()}else{$("html, body").animate({scrollTop:$(".cuenta").offset().top},1000)}}}).show()});a.btnFormularioVacio.unbind("click");a.btnFormularioVacio.on("click",function(){if(a.dataParametrosUsuario&&a.dataParametrosUsuario.Links&&a.dataParametrosUsuario.Links[0].FormularioVacioBCI){window.open(a.dataParametrosUsuario.Links[0].FormularioVacioBCI,"_blank")}});var c=[{width:"25%",field:"nombre",title:"Nombre",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"25%",field:"apellido",title:"Apellido",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"25%",field:"tipo",title:"Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,g){if(f.tipo==Core.Business.eTipoPersonaCuenta.Titular){e.html("<span>Titular</span>")}else{e.html("<span>Autorizado</span>")}}},{width:"25%",field:"numero",title:"Número",headerAttributes:Core.Functions.grid.getCellOddClass()},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){if(f.tienePruebaDeVida){var g=$('<button disabled type="button" title="Prueba de Vida" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/prueba-de-vida.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color",f.tienePruebaDeVida)}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){if(f.tieneMatchCara){var g=$('<button disabled type="button" title="Match de Cara" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/match-cara.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color",f.tieneMatchCara);if(a.optionsApertura&&a.optionsApertura.consultaICAR){g.removeAttr("disabled");g.on("click",function(){Core.Functions.ExternalServices.Icar.showReport(g,a.idAperturaCuenta,f.tipo,f.numero)})}}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){if(f.tieneDatosPrecargados){var g=$('<button disabled type="button" title="Datos Precargados" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/datos-precargados.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color",f.tieneDatosPrecargados);if(a.optionsApertura&&a.optionsApertura.consultaICAR){g.removeAttr("disabled");g.on("click",function(){Core.Functions.ExternalServices.Icar.showReport(g,a.idAperturaCuenta,f.tipo,f.numero)})}}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){if(f.tieneReuters){var g=$('<button disabled type="button" title="Reuters" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/reuters-logo.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color",f.tieneReuters);if(a.optionsApertura&&a.optionsApertura.consultaReuters){g.removeAttr("disabled");g.on("click",function(){Core.Functions.ExternalServices.Reuters.showReport(g,f.documento,encodeURIComponent(f.nombre.toLowerCase()+" "+f.apellido.toLowerCase()),f.sexo,f.fechaNacimiento,f.nacionalidad)})}}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){if(f.tieneNOSIS){var g=$('<button disabled type="button" title="Nosis" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/nosis-logo.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color",f.tieneNOSIS);if(a.optionsApertura&&a.optionsApertura.consultaNosis){g.removeAttr("disabled");g.on("click",function(){Core.Functions.ExternalServices.Nosis.showReport(g,f.cuit_cuil)})}}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){if(f.tieneRenaper){var g=$('<button disabled type="button" title="Renaper" class="btn-sm balanz-button"style="border:3px solid; background-color:#fff;"><img src="/images/renaper-logo.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color",f.tieneRenaper);if(a.optionsApertura&&a.optionsApertura.consultaRenaper){g.removeAttr("disabled");g.on("click",function(){Core.Functions.ExternalServices.Renaper.showReport(g,f.documento,f.idTipoDocumento,f.sexo)})}}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){if(f.tieneUIF){var g=$('<button disabled type="button" title="UIF" class="btn-sm balanz-button"style="border:3px solid; background-color:#fff;"><img src="/images/uif-logo.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color",f.tieneUIF);if(a.optionsApertura&&a.optionsApertura.consultaUIF){g.removeAttr("disabled");g.on("click",function(){Core.Functions.ExternalServices.UIF.showReport(g,f.cuit_cuil)})}}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){var g=$('<button disabled type="button" title="Google" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/google-logo.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color","lightgreen");if(a.optionsApertura&&a.optionsApertura.consultaGoogle){g.removeAttr("disabled");g.on("click",function(){var j="http://www.google.com/search?q="+f.nombre+"+"+f.apellido;window.open(j,"_blank");overlay=new Core.Controls.Overlay(a.btnAgregarArchivo,{});var i=new XMLHttpRequest();i.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"webshot?url="+encodeURIComponent(encodeURIComponent(j)),true);i.responseType="blob";i.setRequestHeader("Content-Type","application/json;charset=UTF-8");i.setRequestHeader("Authorization",Core.Objects.Context.Token);i.onerror=function(k){var l=new Core.Controls.Dialog("Error","No se ha podido descargar la imagen",{displayButtons:{close:true,accept:false}});l.show();overlay.destroy();return};i.onload=function(k){if(i.status==200){var n=new XMLHttpRequest();n.onload=function(p){var o=new Core.Controls.ManagerAltaCuentaNuevoArchivo({onSave:function(r){a.archivos.push({urlArchivo:r.file.urlArchivo,idTipoArchivo:r.idTipoArchivo,Tipo:r.Tipo,Fecha:r.Fecha,Comentario:r.comentarios});var q=a.gridArchivos.swidget().initialOptions;q.dataSource.data=a.archivos;a.gridArchivos.swidget().refresh(q)},tiposArchivos:((a.dataParametros!=null)?$.grep(a.dataParametros.TiposArchivos,function(r,q){return r.Fisica&&r.BCI}):[]),idTipoArchivoDefault:"7",comentariosDefault:"Google Search "+f.nombre+" "+f.apellido,file:JSON.parse(n.responseText)}).show();overlay.destroy()};n.onerror=function(o){var p=new Core.Controls.Dialog("Error","No se ha podido adjuntar la foto",{displayButtons:{close:true,accept:false}});p.show();overlay.destroy();return};var m=new Blob([i.response],{type:"image/png"});n.open("POST",Core.Origin+Core.PrefixUrl+"upload/documento/7",true);n.setRequestHeader("Authorization",Core.Objects.Context.Token);n.setRequestHeader("Accept","application/json");n.setRequestHeader("Content-Type","image/png");n.send(m)}else{var l=new Core.Controls.Dialog("Error","No se ha podido descargar la imagen",{displayButtons:{close:true,accept:false}});l.show();overlay.destroy()}};i.send()})}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(f,g,h){var e=$('<button type="button" title="Editar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(f);e.on("click",function(){a.divAltaCuenta.hide();a.divManagerPersona.show();a.divMatrizRiesgo.hide();var i=new Core.Controls.ManagerPersonaBCI({container:a.divManagerPersona,divMatrizRiesgo:a.divMatrizRiesgo,namespaceActivo:a.namespaceActivo,idTipoValidacion:(a.dataCuenta&&a.ddlEstado.swidget().selectedItem())?a.ddlEstado.swidget().selectedItem().idTipoValidacion:0,persona:a.personas[h],dataParametros:a.dataParametros,dataParametrosUsuario:a.dataParametrosUsuario,optionsApertura:a.optionsApertura,idAperturaCuenta:a.idAperturaCuenta,readOnly:a.readOnly,esCuentaJuridica:false,onSave:function(j){a.personas[h]=j;if(!a.isAperturaWeb()){a.refreshNumeroPersonas()}a.refreshPersonas();a.setNivelDeRiesgo();return true},onClose:function(){a.divAltaCuenta.show();a.divManagerPersona.hide();a.divMatrizRiesgo.hide()}}).show()})}}];if(!a.readOnly){c.push({width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(f,g,h){if(!a.isAperturaWeb()||!(g.tipo==Core.Business.eTipoPersonaCuenta.Titular&&g.numero==1)||a.namespaceActivo=="Legajos"){var e=$('<button type="button" title="Eliminar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(f);e.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar la persona: "+g.nombre+" "+g.apellido+"?",{onAccepted:function(){a.personas.remove(a.personas[h]);if(!a.isAperturaWeb()){a.refreshNumeroPersonas()}a.refreshPersonas()}}).show()})}}})}a.gridPersonas.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:c});a.gridArchivos.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},columns:[{width:"25%",field:"Fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"25%",field:"Tipo",title:"Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"50%",field:"Comentario",title:"Comentario",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:100,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(g,h,i){if(a.namespaceActivo!="ReporteAperturas"||(a.optionsApertura&&a.optionsApertura.descargarArchivosApertura)){var e=$('<button type="button" title="Descargar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>').appendTo(g);e.on("click",function(){window.open(Core.Origin+Core.Functions.Context.getPathname()+h.urlArchivo)})}if(!a.readOnly){var f=$('<button type="button" title="Eliminar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(g);f.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar el archivo?",{onAccepted:function(){a.archivos=$.grep(a.archivos,function(l,k){return l.urlArchivo!=h.urlArchivo||l.Fecha!=h.Fecha||l.Tipo!=h.Tipo||l.Comentario!=h.Comentario});var j=a.gridArchivos.swidget().initialOptions;j.dataSource.data=a.archivos;a.gridArchivos.swidget().refresh(j)}}).show()})}}}]});a.gridObservaciones.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},columns:[{width:"25%",field:"Fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"25%",field:"username",title:"Usuario",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"50%",field:"Observacion",title:"Observación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString}]});a.getData()};a.setNivelDeRiesgo=function(){var d=0;for(var c=0;c<a.personas.length;c++){if(a.personas[c].idRiesgo>d){d=a.personas[c].idRiesgo}}var e=a.ddlNivelRiesgo.swidget().initialOptions;e.value=(d?d.toString():"");a.ddlNivelRiesgo.swidget().refresh(e)};a.getData=function(){a.personas=a.dataCuenta!=null?a.dataCuenta.personas:[];a.archivos=a.dataCuenta!=null?a.dataCuenta.archivos:[];a.observaciones=a.dataCuenta!=null?a.dataCuenta.observaciones:[];a.loadControls()};a.loadControls=function(){if(a.readOnly){var I=[];for(var o=1;o<=a.maxVersion;o++){I.push({version:o})}var A=a.ddlVersion.swidget().initialOptions;A.dataSource.data=I;A.value=a.versionActual.toString();a.ddlVersion.swidget().refresh(A)}a.divMontoInvertirContainer.html("");a.dataParametros.MontoAInvertir.forEach(function(L,K){if(L.habilitado&&L.PA){var J=$("<div></div>").appendTo(a.divMontoInvertirContainer);var i=$('<input class="form-control sui-input monto-a-invertir-option" type="radio" name="MontoAInvertir" idMontoAInvertir="'+L.MontoAInvertir+'">').appendTo(J);i.shieldRadioButton({label:L.Descripcion})}});a.divCanalContainer.html("");if(a.dataParametrosUsuario&&a.dataParametrosUsuario.canalDeVenta){a.dataParametrosUsuario.canalDeVenta.forEach(function(K,J){var i=$('<input type="radio" class="form-control sui-input chk-canal-option" name="option-canal" idCanalDeVenta="'+K.idCanalDeVenta+'">').appendTo(a.divCanalContainer);i.shieldRadioButton({label:K.Descripcion,events:{click:function(L){a.setControls()}}})})}a.divIngresosAnualesContainer.html("");a.dataParametros.IngresosAnuales.forEach(function(L,K){if(L.habilitado&&L.PA){var J=$("<div></div>").appendTo(a.divIngresosAnualesContainer);var i=$('<input class="form-control sui-input ingresos-anuales-option" type="radio" name="IngresosAnuales" idIngresosAnuales="'+L.IngresosAnuales+'" id="ingresosAnuales_'+L.IngresosAnuales+'">').appendTo(J);i.shieldRadioButton({label:L.Descripcion})}});a.divPatrimonioNetoContainer.html("");a.dataParametros.PatrimoniosNetos.forEach(function(L,K){if(L.habilitado&&L.PA){var J=$("<div></div>").appendTo(a.divPatrimonioNetoContainer);var i=$('<input class="form-control sui-input patrimonio-neto-option" type="radio" name="PatrimonioNeto" idPatromonioNeto="'+L.PatrimonioNeto+'" id="patrimonioNeto_'+L.PatrimonioNeto+'">').appendTo(J);i.shieldRadioButton({label:L.Descripcion})}});a.divExperienciaInversionesNivelContainer.html("");a.dataParametros.NivelesExperienciaInversiones.forEach(function(L,K){if(L.habilitado&&L.PA){var J=$("<div></div>").appendTo(a.divExperienciaInversionesNivelContainer);var i=$('<input class="form-control sui-input experiencia-inversiones-nivel-option" type="radio" name="ExperienciaInversionesNivel" idNivelExperienciaInversion="'+L.idNivelExperienciaInversion+'" id="nivelExperienciaInversion'+L.idRelacionInversionPatrimonio+'">').appendTo(J);i.shieldRadioButton({label:L.Descripcion})}});a.divRelacionInversionPatrimonioContainer.html("");a.dataParametros.RelacionesInversionPatrimonio.forEach(function(L,K){if(L.habilitado&&L.PA){var J=$("<div></div>").appendTo(a.divRelacionInversionPatrimonioContainer);var i=$('<input class="form-control sui-input relacion-inversion-patrimonio-option" type="radio" name="RelacionInversionPatrimonio" idRelacionInversionPatrimonio="'+L.idRelacionInversionPatrimonio+'" id="relacionInversionPatrimonio'+L.idRelacionInversionPatrimonio+'">').appendTo(J);i.shieldRadioButton({label:L.Descripcion})}});a.divObjetivoInversionContainer.html("");a.dataParametros.ObjetivosDeInversion.forEach(function(L,K){if(L.habilitado&&L.PA){var J=$("<div></div>").appendTo(a.divObjetivoInversionContainer);var i=$('<input class="form-control sui-input objetivo-inversion-option" type="radio" name="ObjetivoInversion" idObjetivoInversion="'+L.idObjetivoInversion+'" id="objetivoInversion'+L.idObjetivoInversion+'">').appendTo(J);i.shieldRadioButton({label:L.Descripcion,events:{click:function(M){a.setControls()}}})}});a.divNivelToleranciaRiesgoContainer.html("");a.dataParametros.NivelesToleranciaAlRiesgo.forEach(function(L,K){if(L.habilitado&&L.PA){var J=$("<div></div>").appendTo(a.divNivelToleranciaRiesgoContainer);var i=$('<input class="form-control sui-input nivel-tolerancia-riesgo-option" type="radio" name="NivelToleranciaRiesgo" idNivelToleranciaAlRiesgo="'+L.idNivelToleranciaAlRiesgo+'" id="nivelToleranciaAlRiesgo'+L.idNivelToleranciaAlRiesgo+'">').appendTo(J);i.shieldRadioButton({label:L.Descripcion})}});var A=a.ddlAsesor.swidget().initialOptions;A.dataSource.data=(a.dataParametrosUsuario!=null)?a.dataParametrosUsuario.asesores:[];if(a.dataCuenta!=null&&a.dataCuenta.datos[0].idPersonaAsesor!=null){A.value=a.dataCuenta.datos[0].idPersonaAsesor.toString()}a.ddlAsesor.swidget().refresh(A);var A=a.ddlEstado.swidget().initialOptions;A.dataSource.data=(a.dataCuenta!=null)?a.dataCuenta.estados:[];if(a.dataCuenta!=null&&a.dataCuenta.datos[0].idEstadoAperturaCuenta!=null){A.value=a.dataCuenta.datos[0].idEstadoAperturaCuenta.toString()}a.ddlEstado.swidget().refresh(A);if(a.ddlEstado.swidget().selectedItem()){a.lblEstadoCuenta.text(a.ddlEstado.swidget().selectedItem().Nombre)}var F=a.chkTipoFirmaConjunta.swidget().initialOptions;F.checked=(a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoFirma==Core.Business.eTipoFirma.Conjunta)?true:false;a.chkTipoFirmaConjunta.swidget().refresh(F);var F=a.chkTipoFirmaIndistinta.swidget().initialOptions;F.checked=(a.dataCuenta==null||(a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoFirma==Core.Business.eTipoFirma.Indistinta))?true:false;a.chkTipoFirmaIndistinta.swidget().refresh(F);a.chkIngresoAsesorFinanciero.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].contactoOriginal)?true:false));a.chkUsarFirmaDigital.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].UsarFirmaDigital)?true:false));a.divUsarFirmaDigital.hide();if(a.dataCuenta!=null&&a.dataCuenta.datos[0].habilitarFirmaDigital){a.divUsarFirmaDigital.show()}var A=a.txtIngresoAsesorFinanciero.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].contactoOriginal)?a.dataCuenta.datos[0].contactoOriginal:"";a.txtIngresoAsesorFinanciero.swidget().refresh(A);if(a.dataCuenta!=null){var g=$(".monto-a-invertir-option");var C=false;for(var o=0;o<g.length;o++){var c=$(g[o]);var F=c.swidget().initialOptions;F.checked=(c.attr("idMontoAInvertir")==a.dataCuenta.datos[0].montoAInvertir);if(!C){C=(c.attr("idMontoAInvertir")==a.dataCuenta.datos[0].montoAInvertir)}c.swidget().refresh(F)}if(!C&&a.dataCuenta.datos[0].montoAInvertirDescripcion){a.lblMontoInvertirAlert.html("<br />(El cliente eligió: "+a.dataCuenta.datos[0].montoAInvertirDescripcion+")")}var f=$(".ingresos-anuales-option");var z=false;for(var o=0;o<f.length;o++){var c=$(f[o]);var F=c.swidget().initialOptions;F.checked=(c.attr("idIngresosAnuales")==a.dataCuenta.datos[0].ingresosAnuales);if(!z){z=(c.attr("idIngresosAnuales")==a.dataCuenta.datos[0].ingresosAnuales)}c.swidget().refresh(F)}if(!z&&a.dataCuenta.datos[0].ingresosAnualesDescripcion){a.lblIngresosAnualesAlert.html("<br />(El cliente eligió: "+a.dataCuenta.datos[0].ingresosAnualesDescripcion+")")}var k=$(".patrimonio-neto-option");var G=false;for(var o=0;o<k.length;o++){var c=$(k[o]);var F=c.swidget().initialOptions;F.checked=(c.attr("idPatromonioNeto")==a.dataCuenta.datos[0].patrimonioNeto);if(!G){G=(c.attr("idPatromonioNeto")==a.dataCuenta.datos[0].patrimonioNeto)}c.swidget().refresh(F)}if(!G&&a.dataCuenta.datos[0].patrimonioNetoDescripcion){a.lblPatrimonioNetoAlert.html("<br />(El cliente eligió: "+a.dataCuenta.datos[0].patrimonioNetoDescripcion+")")}var e=$(".experiencia-inversiones-nivel-option");var n=false;for(var o=0;o<e.length;o++){var c=$(e[o]);var F=c.swidget().initialOptions;F.checked=(c.attr("idNivelExperienciaInversion")==a.dataCuenta.datos[0].idNivelExperienciaInversion);if(!n){n=(c.attr("idNivelExperienciaInversion")==a.dataCuenta.datos[0].idNivelExperienciaInversion)}c.swidget().refresh(F)}if(!n&&a.dataCuenta.datos[0].idNivelExperienciaInversion){a.lblExperienciaInversionesNivelAlert.html("<br />(El cliente eligió: "+a.dataCuenta.datos[0].nivelExperienciaInversionDescripcion+")")}var l=$(".relacion-inversion-patrimonio-option");var H=false;for(var o=0;o<l.length;o++){var c=$(l[o]);var F=c.swidget().initialOptions;F.checked=(c.attr("idRelacionInversionPatrimonio")==a.dataCuenta.datos[0].idRelacionInversionPatrimonio);if(!H){H=(c.attr("idRelacionInversionPatrimonio")==a.dataCuenta.datos[0].idRelacionInversionPatrimonio)}c.swidget().refresh(F)}if(!H&&a.dataCuenta.datos[0].idRelacionInversionPatrimonio){a.lblRelacionInversionPatrimonioAlert.html("<br />(El cliente eligió: "+a.dataCuenta.datos[0].relacionInversionPatrimonioDescripcion+")")}var j=$(".objetivo-inversion-option");var E=false;for(var o=0;o<j.length;o++){var c=$(j[o]);var F=c.swidget().initialOptions;F.checked=(c.attr("idObjetivoInversion")==a.dataCuenta.datos[0].idObjetivoInversion);if(!E){E=(c.attr("idObjetivoInversion")==a.dataCuenta.datos[0].idObjetivoInversion)}c.swidget().refresh(F)}if(!E&&a.dataCuenta.datos[0].idObjetivoInversion){a.lblObjetivoInversionAlert.html("<br />(El cliente eligió: "+a.dataCuenta.datos[0].objetivoInversionDescripcion+")")}var h=$(".nivel-tolerancia-riesgo-option");var D=false;for(var o=0;o<h.length;o++){var c=$(h[o]);var F=c.swidget().initialOptions;F.checked=(c.attr("idNivelToleranciaAlRiesgo")==a.dataCuenta.datos[0].idNivelToleranciaAlRiesgo);if(!D){D=(c.attr("idNivelToleranciaAlRiesgo")==a.dataCuenta.datos[0].idNivelToleranciaAlRiesgo)}c.swidget().refresh(F)}if(!D&&a.dataCuenta.datos[0].idNivelToleranciaAlRiesgo){a.lblNivelToleranciaRiesgoAlert.html("<br />(El cliente eligió: "+a.dataCuenta.datos[0].nivelToleranciaAlRiesgoDescripcion+")")}var d=$(".chk-canal-option");for(var o=0;o<d.length;o++){var c=$(d[o]);var F=c.swidget().initialOptions;F.checked=(c.attr("idCanalDeVenta")==a.dataCuenta.datos[0].idCanal);c.swidget().refresh(F)}}a.chkOrigenPatrimonioActividadPrincipal.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].patrimonioActividadPrincipal)?true:false));a.chkOrigenPatrimonioHerencia.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].patrimonioHerencia)?true:false));a.chkOrigenPatrimonioVentaBienes.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].patrimonioVentaDeBienes)?true:false));a.chkOrigenPatrimonioOtro.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].patrimonioOtro)?true:false));var A=a.txtOrigenPatrimonioOtroDetalle.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].patrimonioOtro)?a.dataCuenta.datos[0].patrimonioOtro:"";a.txtOrigenPatrimonioOtroDetalle.swidget().refresh(A);a.chkFondeoCuentaTransferenciaTitulosCuentaInversion.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].FondeoCuentaTransferenciaTitulosCuentaInversion)?true:false));a.chkFondeoCuentaTransferenciaDineroCuentaInversion.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].FondeoCuentaTransferenciaDineroCuentaInversion)?true:false));a.chkFondeoCuentaTransferenciaDineroBanco.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].FondeoCuentaTransferenciaDineroBanco)?true:false));a.chkFondeoCuentaOtro.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].FondeoCuentaOtros)?true:false));var A=a.txtFondeoCuentaOtroDetalle.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].FondeoCuentaOtros)?a.dataCuenta.datos[0].FondeoCuentaOtros:"";a.txtFondeoCuentaOtroDetalle.swidget().refresh(A);var A=a.txtCantidadTransferenciasDesdeCuentaPorAnio.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].CantidadTransferenciaDesdeCuentaInversion)?a.dataCuenta.datos[0].CantidadTransferenciaDesdeCuentaInversion:"";a.txtCantidadTransferenciasDesdeCuentaPorAnio.swidget().refresh(A);var A=a.txtPaisesCuentaOrigen.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].PaisesOrigenTransferencias)?a.dataCuenta.datos[0].PaisesOrigenTransferencias:"";a.txtPaisesCuentaOrigen.swidget().refresh(A);var A=a.txtCantidadTransferenciasHaciaCuentaPorAnio.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].CantidadTransferenciaHaciaCuentaInversion)?a.dataCuenta.datos[0].CantidadTransferenciaHaciaCuentaInversion:"";a.txtCantidadTransferenciasHaciaCuentaPorAnio.swidget().refresh(A);var A=a.txtPaisesCuentaDestino.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].PaisesDestinoTransferencias)?a.dataCuenta.datos[0].PaisesDestinoTransferencias:"";a.txtPaisesCuentaDestino.swidget().refresh(A);a.chkConvenioComitenteAAGI.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].AceptoMandatoDiscrecional)?true:false));a.divConvenioComitenteAAGI.hide();if(a.dataCuenta!=null&&a.dataCuenta.datos[0].SolicitarMandatoDiscrecional){a.divConvenioComitenteAAGI.show()}var A=a.txtCanalOtroDetalle.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].canalOtro)?a.dataCuenta.datos[0].canalOtro:"";a.txtCanalOtroDetalle.swidget().refresh(A);var A=a.txtObjetivoInversionDetallePeriodo.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].ObjetivoInversionPeriodoDetalle)?a.dataCuenta.datos[0].ObjetivoInversionPeriodoDetalle:"";a.txtObjetivoInversionDetallePeriodo.swidget().refresh(A);var A=a.ddlArancel.swidget().initialOptions;A.dataSource.data=(a.dataParametrosUsuario!=null)?$.grep(a.dataParametrosUsuario.aranceles,function(J,i){return J.idNegocio==Core.Enums.eNegocio.BCI}):[];if(a.dataCuenta!=null&&a.dataCuenta.datos[0].idArancel!=null){A.value=a.dataCuenta.datos[0].idArancel.toString()}a.ddlArancel.swidget().refresh(A);var A=a.ddlNivelRiesgo.swidget().initialOptions;A.dataSource.data=(a.dataParametrosUsuario!=null)?a.dataParametrosUsuario.riesgo:[];if(a.dataCuenta!=null&&a.dataCuenta.datos[0].idNivelDeRiesgo!=null){A.value=a.dataCuenta.datos[0].idNivelDeRiesgo.toString()}a.ddlNivelRiesgo.swidget().refresh(A);var A=a.txtComoLlegoABalanz.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].comoLlegoABalanz)?a.dataCuenta.datos[0].comoLlegoABalanz:"";a.txtComoLlegoABalanz.swidget().refresh(A);var A=a.txtDescripcionActividadCliente.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].descripcionActividadCliente)?a.dataCuenta.datos[0].descripcionActividadCliente:"";a.txtDescripcionActividadCliente.swidget().refresh(A);var A=a.txtUsuarioAsignado.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].usuarioAsignado)?a.dataCuenta.datos[0].usuarioAsignado:"";a.txtUsuarioAsignado.swidget().refresh(A);a.controlDepositoInicialDolares.setValue((a.dataCuenta!=null&&a.dataCuenta.datos[0].DepositoInicialDolares)?a.dataCuenta.datos[0].DepositoInicialDolares:"");a.chkCambiosSignificativosPatrimonio.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].CambiosSignificativosPatrimonio)?true:false));var A=a.txtCambiosSignificativosPatrimonioDetalle.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].CambiosSignificativosPatrimonio)?a.dataCuenta.datos[0].CambiosSignificativosPatrimonio:"";a.txtCambiosSignificativosPatrimonioDetalle.swidget().refresh(A);var A=a.txtReferenciaBancariaNombre.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].ReferenciaBancariaNombre)?a.dataCuenta.datos[0].ReferenciaBancariaNombre:"";a.txtReferenciaBancariaNombre.swidget().refresh(A);var A=a.txtReferenciaBancariaApellido.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].ReferenciaBancariaApellido)?a.dataCuenta.datos[0].ReferenciaBancariaApellido:"";a.txtReferenciaBancariaApellido.swidget().refresh(A);var A=a.ddlReferenciaBancariaCargo.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].ReferenciaBancariaCargo)?a.dataCuenta.datos[0].ReferenciaBancariaCargo:"";a.ddlReferenciaBancariaCargo.swidget().refresh(A);var A=a.txtReferenciaBancariaInstitucion.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].ReferenciaBancariaInstitucion)?a.dataCuenta.datos[0].ReferenciaBancariaInstitucion:"";a.txtReferenciaBancariaInstitucion.swidget().refresh(A);var A=a.txtReferenciaBancariaEmail.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].ReferenciaBancariaEMail)?a.dataCuenta.datos[0].ReferenciaBancariaEMail:"";a.txtReferenciaBancariaEmail.swidget().refresh(A);var A=a.txtReferenciaBancariaTelefono.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].ReferenciaBancariaTelefono)?a.dataCuenta.datos[0].ReferenciaBancariaTelefono:"";a.txtReferenciaBancariaTelefono.swidget().refresh(A);var A=a.txtReferenciaBancariaDomicilio.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].ReferenciaBancariaDomicilioCalle)?a.dataCuenta.datos[0].ReferenciaBancariaDomicilioCalle:"";a.txtReferenciaBancariaDomicilio.swidget().refresh(A);var A=a.txtReferenciaBancariaCiudad.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].ReferenciaBancariaDomicilioCiudad)?a.dataCuenta.datos[0].ReferenciaBancariaDomicilioCiudad:"";a.txtReferenciaBancariaCiudad.swidget().refresh(A);var A=a.ddlReferenciaBancariaPais.swidget().initialOptions;A.dataSource.data=(a.dataParametros!=null)?a.dataParametros.paises:[];A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].ReferenciaBancariaDomicilioidPais)?a.dataCuenta.datos[0].ReferenciaBancariaDomicilioidPais:"";a.ddlReferenciaBancariaPais.swidget().refresh(A);var A=a.txtContactoFallecimientoNombre.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].ContactoFallecimientoNombre)?a.dataCuenta.datos[0].ContactoFallecimientoNombre:"";a.txtContactoFallecimientoNombre.swidget().refresh(A);var A=a.txtContactoFallecimientoApellido.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].ContactoFallecimientoApellido)?a.dataCuenta.datos[0].ContactoFallecimientoApellido:"";a.txtContactoFallecimientoApellido.swidget().refresh(A);var A=a.txtContactoFallecimientoParentesco.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].ContactoFallecimientoParentesco)?a.dataCuenta.datos[0].ContactoFallecimientoParentesco:"";a.txtContactoFallecimientoParentesco.swidget().refresh(A);var A=a.txtContactoFallecimientoEmail.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].ContactoFallecimientoEMail)?a.dataCuenta.datos[0].ContactoFallecimientoEMail:"";a.txtContactoFallecimientoEmail.swidget().refresh(A);var A=a.txtContactoFallecimientoTelefono.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].ContactoFallecimientoTelefono)?a.dataCuenta.datos[0].ContactoFallecimientoTelefono:"";a.txtContactoFallecimientoTelefono.swidget().refresh(A);var A=a.txtContactoFallecimientoDomicilio.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].ContactoFallecimientoDomicilioCalle)?a.dataCuenta.datos[0].ContactoFallecimientoDomicilioCalle:"";a.txtContactoFallecimientoDomicilio.swidget().refresh(A);var A=a.txtContactoFallecimientoCiudad.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].ContactoFallecimientoDomicilioCiudad)?a.dataCuenta.datos[0].ContactoFallecimientoDomicilioCiudad:"";a.txtContactoFallecimientoCiudad.swidget().refresh(A);var A=a.ddlContactoFallecimientoPais.swidget().initialOptions;A.dataSource.data=(a.dataParametros!=null)?a.dataParametros.paises:[];A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].ContactoFallecimientoDomicilioidPais)?a.dataCuenta.datos[0].ContactoFallecimientoDomicilioidPais:"";a.ddlContactoFallecimientoPais.swidget().refresh(A);a.chkTipoInversionAcciones.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionAcciones)?true:false));a.chkTipoInversionOpciones.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionOpciones)?true:false));a.chkTipoInversionFondos.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionFondos)?true:false));a.chkTipoInversionBonos.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionTitulosPublicos)?true:false));a.chkTipoInversionFuturos.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionFuturos)?true:false));a.chkTipoInversionOtro.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionOtros)?true:false));var A=a.txtTipoInversionOtroDetalle.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionOtros)?a.dataCuenta.datos[0].tipoInversionOtros:"";a.txtTipoInversionOtroDetalle.swidget().refresh(A);a.chkExperienciaInversionesAcciones.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].ExperienciaEnInversionesAcciones)?true:false));a.chkExperienciaInversionesOpciones.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].ExperienciaEnInversionesOpciones)?true:false));a.chkExperienciaInversionesFondos.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].ExperienciaEnInversionesFondos)?true:false));a.chkExperienciaInversionesBonos.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].ExperienciaEnInversionesBonos)?true:false));a.chkExperienciaInversionesFuturos.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].ExperienciaEnInversionesFuturos)?true:false));a.chkExperienciaInversionesOtro.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].ExperienciaEnInversionesOtros)?true:false));var A=a.txtExperienciaInversionesOtroDetalle.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].ExperienciaEnInversionesOtros)?a.dataCuenta.datos[0].ExperienciaEnInversionesOtros:"";a.txtExperienciaInversionesOtroDetalle.swidget().refresh(A);var A=a.txtPlazoInversion.swidget().initialOptions;A.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].plazoAproxInversion)?a.dataCuenta.datos[0].plazoAproxInversion:"";a.txtPlazoInversion.swidget().refresh(A);a.setControls();var A=a.gridPersonas.swidget().initialOptions;A.dataSource.data=a.personas;a.gridPersonas.swidget().refresh(A);var A=a.gridArchivos.swidget().initialOptions;A.dataSource.data=a.archivos;a.gridArchivos.swidget().refresh(A);var A=a.gridObservaciones.swidget().initialOptions;A.dataSource.data=a.observaciones;a.gridObservaciones.swidget().refresh(A);a.divInformes.html("");if(a.aperturaCuenta){var B=$("<label>Resumen de la Cuenta:  </label>").appendTo(a.divInformes);if(a.aperturaCuenta.tienePruebaDeVida){var u=$('<button disabled style="border:3px solid; background-color:#fff;" type="button" title="Prueba de Vida" class="btn-sm balanz-button"><img src="/images/prueba-de-vida.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);u.css("border-color",a.aperturaCuenta.tienePruebaDeVida)}if(a.aperturaCuenta.tieneMatchCara){var r=$('<button disabled type="button" title="Match de Cara" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/match-cara.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);r.css("border-color",a.aperturaCuenta.tieneMatchCara)}if(a.aperturaCuenta.tieneDatosPrecargados){var p=$('<button disabled type="button" title="Datos Precargados" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/datos-precargados.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);p.css("border-color",a.aperturaCuenta.tieneDatosPrecargados)}if(a.aperturaCuenta.tieneReuters){var w=$('<button disabled style="border:3px solid; background-color:#fff;" type="button" title="Reuters" class="btn-sm balanz-button"><img src="/images/reuters-logo.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);w.css("border-color",a.aperturaCuenta.tieneReuters)}if(a.aperturaCuenta.tieneNOSIS){var t=$('<button disabled style="border:3px solid; background-color:#fff;" type="button" title="Nosis" class="btn-sm balanz-button"><img src="/images/nosis-logo.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);t.css("border-color",a.aperturaCuenta.tieneNOSIS)}if(a.aperturaCuenta.tieneRenaper){var v=$('<button disabled style="border:3px solid; background-color:#fff;" type="button" title="Renaper" class="btn-sm balanz-button"><img src="/images/renaper-logo.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);v.css("border-color",a.aperturaCuenta.tieneRenaper)}if(a.aperturaCuenta.tieneUIF){var x=$('<button disabled style="border:3px solid; background-color:#fff;" type="button" title="UIF" class="btn-sm balanz-button"><img src="/images/uif-logo.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);x.css("border-color",a.aperturaCuenta.tieneUIF)}if(a.aperturaCuenta.motorDecision){var s=$('<button style="border:3px solid; background-color:transparent; border-color:transparent;" type="button" title="Motor decisión" class="btn-sm balanz-button"></button>').appendTo(a.divInformes);var y=$('<img src="/images/circ-trans.png" style="width:20px; height:20px;" />').appendTo(s);y.css("background-color",a.aperturaCuenta.motorDecision);s.on("click",function(){Core.Functions.ExternalServices.MotorDecision.showReport(s,a.idAperturaCuenta)})}}if(a.dataCuenta&&a.dataCuenta.datos[0].tieneDocusign){var q=$('<button disabled style="border:3px solid; background-color:#fff;" type="button" title="DocuSign" class="btn-sm balanz-button"><img src="'+(a.dataCuenta.datos[0].tieneDocusign=="disabled"?"/images/docusign-logo-inactivo.png":"/images/docusign-logo.png")+'" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);q.css("border-color",(a.dataCuenta.datos[0].tieneDocusign=="disabled"?"lightgray":a.dataCuenta.datos[0].tieneDocusign));if(a.optionsApertura&&a.optionsApertura.consultaDocusign&&a.dataCuenta.datos[0].tieneDocusign!="disabled"){q.removeAttr("disabled");q.on("click",function(){if(a.dataCuenta!=null){Core.Functions.ExternalServices.DocuSign.showReport(q,a.dataCuenta.datos[0].idAperturaCuenta)}})}}if(a.namespaceActivo=="Legajos"||a.namespaceActivo=="OpenManagerAltaCuenta"){var m=(a.dataCuenta!=null&&a.dataCuenta.datos[0].NumComitente)?("Comitente: "+a.dataCuenta.datos[0].NumComitente):"";m+=(a.dataCuenta!=null&&a.dataCuenta.datos[0].NumCuotapartista)?((m?" || ":"")+("Cuotapartista: "+a.dataCuenta.datos[0].NumCuotapartista)):"";a.lblComitenteCuotapartistaCuenta.text(m);a.lblDescripcionCuenta.text((a.dataCuenta!=null&&a.dataCuenta.datos[0].DescripcionCuenta)?a.dataCuenta.datos[0].DescripcionCuenta:"");a.divDescripcionCuenta.show();a.divComitenteCuotapartistaCuenta.show()}};a.getRequestData=function(c){Core.Functions.Validations.toggleValidation(a.ddlAsesor,false);Core.Functions.Validations.toggleValidation(a.ddlEstado,false);Core.Functions.Validations.toggleValidation(a.txtOrigenPatrimonioOtroDetalle,false);Core.Functions.Validations.toggleValidation(a.txtFondeoCuentaOtroDetalle,false);Core.Functions.Validations.toggleValidation(a.txtCantidadTransferenciasDesdeCuentaPorAnio,false);Core.Functions.Validations.toggleValidation(a.txtPaisesCuentaOrigen,false);Core.Functions.Validations.toggleValidation(a.txtCantidadTransferenciasHaciaCuentaPorAnio,false);Core.Functions.Validations.toggleValidation(a.txtPaisesCuentaDestino,false);Core.Functions.Validations.toggleValidation(a.txtCanalOtroDetalle,false);Core.Functions.Validations.toggleValidation(a.txtObjetivoInversionDetallePeriodo,false);Core.Functions.Validations.toggleValidation(a.ddlArancel,false);Core.Functions.Validations.toggleValidation(a.ddlNivelRiesgo,false);Core.Functions.Validations.toggleValidation(a.txtComoLlegoABalanz,false);Core.Functions.Validations.toggleValidation(a.txtUsuarioAsignado,false);Core.Functions.Validations.toggleValidation(a.txtTipoInversionOtroDetalle,false);Core.Functions.Validations.toggleValidation(a.txtExperienciaInversionesOtroDetalle,false);Core.Functions.Validations.toggleValidation(a.txtPlazoInversion,false);Core.Functions.Validations.toggleValidation(a.txtDescripcionActividadCliente,false);Core.Functions.Validations.toggleValidation(a.txtDepositoInicialDolares,false);Core.Functions.Validations.toggleValidation(a.txtCambiosSignificativosPatrimonioDetalle,false);Core.Functions.Validations.toggleValidation(a.txtReferenciaBancariaNombre,false);Core.Functions.Validations.toggleValidation(a.txtReferenciaBancariaApellido,false);Core.Functions.Validations.toggleValidation(a.ddlReferenciaBancariaCargo,false);Core.Functions.Validations.toggleValidation(a.txtReferenciaBancariaInstitucion,false);Core.Functions.Validations.toggleValidation(a.txtReferenciaBancariaTelefono,false);Core.Functions.Validations.toggleValidation(a.txtReferenciaBancariaEmail,false);Core.Functions.Validations.toggleValidation(a.txtReferenciaBancariaDomicilio,false);Core.Functions.Validations.toggleValidation(a.txtReferenciaBancariaCiudad,false);Core.Functions.Validations.toggleValidation(a.ddlReferenciaBancariaPais,false);a.divAlert.slideUp();if(!a.dataCuenta||!c||(c.idTipoValidacion==0)){return a.getRequestDataNoValidated(c)}else{return a.getRequestDataValidated(c)}};a.getRequestDataNoValidated=function(c){var d={};d.tipoFirma=a.getSelectedTipoFirma();d.montoAInvertir=a.getSelectedMontoAInvertir();d.ingresosAnuales=a.getSelectedIngresosAnuales();d.patrimonioNeto=a.getSelectedPatrimonioNeto();d.idNivelExperienciaInversion=a.getSelectedNivelExperienciaInversion();d.idRelacionInversionPatrimonio=a.getSelectedRelacionInversionPatrimonio();d.idObjetivoInversion=a.getSelectedObjetivoInversion();if(d.idObjetivoInversion==Core.Business.eAmountRange.Hasta200){d.ObjetivoInversionPeriodoDetalle=a.txtObjetivoInversionDetallePeriodo.val()}d.idNivelToleranciaAlRiesgo=a.getSelectedNivelToleranciaAlRiesgo();d.patrimonioActividadPrincipal=a.chkOrigenPatrimonioActividadPrincipal.swidget().checked()?1:0;d.patrimonioVentaDeBienes=a.chkOrigenPatrimonioVentaBienes.swidget().checked()?1:0;d.patrimonioHerencia=a.chkOrigenPatrimonioHerencia.swidget().checked()?1:0;d.patrimonioOtro=a.getOrigenPatrimonioOtro();d.FondeoCuentaTransferenciaTitulosCuentaInversion=a.chkFondeoCuentaTransferenciaTitulosCuentaInversion.swidget().checked()?1:0;d.FondeoCuentaTransferenciaDineroCuentaInversion=a.chkFondeoCuentaTransferenciaDineroCuentaInversion.swidget().checked()?1:0;d.FondeoCuentaTransferenciaDineroBanco=a.chkFondeoCuentaTransferenciaDineroBanco.swidget().checked()?1:0;d.FondeoCuentaOtros=a.chkFondeoCuentaOtro.swidget().checked()?a.txtFondeoCuentaOtroDetalle.val():"";d.CantidadTransferenciaHaciaCuentaInversion=a.txtCantidadTransferenciasHaciaCuentaPorAnio.val();d.PaisesOrigenTransferencias=a.txtPaisesCuentaOrigen.val();d.CantidadTransferenciaDesdeCuentaInversion=a.txtCantidadTransferenciasDesdeCuentaPorAnio.val();d.PaisesDestinoTransferencias=a.txtPaisesCuentaDestino.val();d.DepositoInicialDolares=Core.Functions.Decimal.parseFloat(a.txtDepositoInicialDolares.val());d.CambiosSignificativosPatrimonio=a.chkCambiosSignificativosPatrimonio.swidget().checked()?a.txtCambiosSignificativosPatrimonioDetalle.val():"";d.idCanal=a.getSelectedCanal();if(d.idCanal==Core.Business.eCanal.Otro){d.canalOtro=a.getCanalOtro()}d.comoLlegoABalanz=a.txtComoLlegoABalanz.val();d.descripcionActividadCliente=a.txtDescripcionActividadCliente.val();d.ReferenciaBancariaNombre=a.txtReferenciaBancariaNombre.val();d.ReferenciaBancariaApellido=a.txtReferenciaBancariaApellido.val();d.ReferenciaBancariaCargo=((a.ddlReferenciaBancariaCargo.swidget().selectedItem())?a.ddlReferenciaBancariaCargo.swidget().selectedItem().idArancel:null);d.ReferenciaBancariaInstitucion=a.txtReferenciaBancariaInstitucion.val();d.ReferenciaBancariaTelefono=a.txtReferenciaBancariaTelefono.val();d.ReferenciaBancariaEMail=a.txtReferenciaBancariaEmail.val();d.ReferenciaBancariaDomicilioCalle=a.txtReferenciaBancariaDomicilio.val();d.ReferenciaBancariaDomicilioCiudad=a.txtReferenciaBancariaCiudad.val();d.ReferenciaBancariaDomicilioidPais=((a.ddlReferenciaBancariaPais.swidget().selectedItem())?a.ddlReferenciaBancariaPais.swidget().selectedItem().idPais:null);d.ContactoFallecimientoNombre=a.txtContactoFallecimientoNombre.val();d.ContactoFallecimientoApellido=a.txtContactoFallecimientoApellido.val();d.ContactoFallecimientoParentesco=a.txtContactoFallecimientoParentesco.val();d.ContactoFallecimientoTelefono=a.txtContactoFallecimientoTelefono.val();d.ContactoFallecimientoEMail=a.txtContactoFallecimientoEmail.val();d.ContactoFallecimientoDomicilioCalle=a.txtContactoFallecimientoDomicilio.val();d.ContactoFallecimientoDomicilioCiudad=a.txtContactoFallecimientoCiudad.val();d.ContactoFallecimientoDomicilioidPais=((a.ddlContactoFallecimientoPais.swidget().selectedItem())?a.ddlContactoFallecimientoPais.swidget().selectedItem().idPais:null);d.usuarioAsignado=a.txtUsuarioAsignado.val();d.tipoInversionAcciones=a.chkTipoInversionAcciones.swidget().checked()?1:0;d.tipoInversionOpciones=a.chkTipoInversionOpciones.swidget().checked()?1:0;d.tipoInversionFondos=a.chkTipoInversionFondos.swidget().checked()?1:0;d.tipoInversionTitulosPublicos=a.chkTipoInversionBonos.swidget().checked()?1:0;d.tipoInversionFuturos=a.chkTipoInversionFuturos.swidget().checked()?1:0;d.tipoInversionOtros=a.getTipoInversionOtro();d.ExperienciaEnInversionesAcciones=a.chkExperienciaInversionesAcciones.swidget().checked()?1:0;d.ExperienciaEnInversionesOpciones=a.chkExperienciaInversionesOpciones.swidget().checked()?1:0;d.ExperienciaEnInversionesFondos=a.chkExperienciaInversionesFondos.swidget().checked()?1:0;d.ExperienciaEnInversionesBonos=a.chkExperienciaInversionesBonos.swidget().checked()?1:0;d.ExperienciaEnInversionesFuturos=a.chkExperienciaInversionesFuturos.swidget().checked()?1:0;d.ExperienciaEnInversionesOtros=a.getExperienciaInversionesOtro();d.plazoAproxInversion=a.txtPlazoInversion.val();d.idArancel=((a.ddlArancel.swidget().selectedItem())?a.ddlArancel.swidget().selectedItem().idArancel:null);d.idPersonaAsesor=((a.ddlAsesor.swidget().selectedItem())?a.ddlAsesor.swidget().selectedItem().idPersona:null);d.UsarFirmaDigital=a.chkUsarFirmaDigital.swidget().checked()?1:0;if(Core.Objects.Context.Configuration.idAplicacion==3){d.idNivelDeRiesgo=((a.ddlNivelRiesgo.swidget().selectedItem())?a.ddlNivelRiesgo.swidget().selectedItem().idRiesgo:null)}else{d.idNivelDeRiesgo=(a.dataCuenta)?a.dataCuenta.datos[0].idNivelDeRiesgo:null}if(a.dataCuenta!=null){d.idEstadoAperturaCuenta=((c)?c.idEstadoAperturaCuenta:null);d.idAperturaCuenta=a.dataCuenta.datos[0].idAperturaCuenta;d.version=a.dataCuenta.datos[0].version;d.hash=a.dataCuenta.datos[0].hash;d.AceptoTyC=a.dataCuenta.datos[0].AceptoTyC;d.idPaso=a.dataCuenta.datos[0].idPaso;d.idSubPaso=a.dataCuenta.datos[0].idSubPaso;d.nombreOriginal=a.dataCuenta.datos[0].nombreOriginal;d.emailOriginal=a.dataCuenta.datos[0].emailOriginal;d.idCuentaExistente=a.dataCuenta.datos[0].idCuentaExistente;d.idExterno=a.dataCuenta.datos[0].idExterno;d.AceptoMandatoDiscrecional=a.dataCuenta.datos[0].AceptoMandatoDiscrecional;d.SolicitarMandatoDiscrecional=a.dataCuenta.datos[0].SolicitarMandatoDiscrecional}else{d.idNegocio=Core.Enums.eNegocio.BCI}d.personas=a.personas;d.archivos=a.archivos;d.observaciones=a.observaciones;d.contactoOriginal=a.chkIngresoAsesorFinanciero.swidget().checked()?a.txtIngresoAsesorFinanciero.val():"";d.cuentaComitente=1;d.cuentaCuotapartista=0;return d};a.getRequestDataValidated=function(d){var g={value:true};var f={};f.tipoFirma=a.getSelectedTipoFirma(g);f.montoAInvertir=a.getSelectedMontoAInvertir(g);f.ingresosAnuales=a.getSelectedIngresosAnuales(g);f.patrimonioNeto=a.getSelectedPatrimonioNeto(g);f.idNivelExperienciaInversion=a.getSelectedNivelExperienciaInversion(g);f.idRelacionInversionPatrimonio=a.getSelectedRelacionInversionPatrimonio(g);f.idObjetivoInversion=a.getSelectedObjetivoInversion(g);if(f.idObjetivoInversion==Core.Business.eAmountRange.Hasta200){f.ObjetivoInversionPeriodoDetalle=Core.Functions.Validations.getValidatedSwidgetValue(a.txtObjetivoInversionDetallePeriodo,g)}f.idNivelToleranciaAlRiesgo=a.getSelectedNivelToleranciaAlRiesgo(g);f.patrimonioActividadPrincipal=a.chkOrigenPatrimonioActividadPrincipal.swidget().checked()?1:0;f.patrimonioVentaDeBienes=a.chkOrigenPatrimonioVentaBienes.swidget().checked()?1:0;f.patrimonioHerencia=a.chkOrigenPatrimonioHerencia.swidget().checked()?1:0;f.patrimonioOtro=a.getOrigenPatrimonioOtro(g);f.FondeoCuentaTransferenciaTitulosCuentaInversion=a.chkFondeoCuentaTransferenciaTitulosCuentaInversion.swidget().checked()?1:0;f.FondeoCuentaTransferenciaDineroCuentaInversion=a.chkFondeoCuentaTransferenciaDineroCuentaInversion.swidget().checked()?1:0;f.FondeoCuentaTransferenciaDineroBanco=a.chkFondeoCuentaTransferenciaDineroBanco.swidget().checked()?1:0;f.FondeoCuentaOtros=a.chkFondeoCuentaOtro.swidget().checked()?Core.Functions.Validations.getValidatedSwidgetValue(a.txtFondeoCuentaOtroDetalle,g):"";f.CantidadTransferenciaHaciaCuentaInversion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtCantidadTransferenciasHaciaCuentaPorAnio,g);f.PaisesOrigenTransferencias=Core.Functions.Validations.getValidatedSwidgetValue(a.txtPaisesCuentaOrigen,g);f.CantidadTransferenciaDesdeCuentaInversion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtCantidadTransferenciasDesdeCuentaPorAnio,g);f.PaisesDestinoTransferencias=Core.Functions.Validations.getValidatedSwidgetValue(a.txtPaisesCuentaDestino,g);f.DepositoInicialDolares=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtDepositoInicialDolares,g));f.CambiosSignificativosPatrimonio=a.chkCambiosSignificativosPatrimonio.swidget().checked()?Core.Functions.Validations.getValidatedSwidgetValue(a.txtCambiosSignificativosPatrimonioDetalle,g):"";f.idCanal=a.getSelectedCanal(g);if(f.idCanal==Core.Business.eCanal.Otro){f.canalOtro=a.getCanalOtro(g)}f.comoLlegoABalanz=Core.Functions.Validations.getValidatedSwidgetValue(a.txtComoLlegoABalanz,g);f.descripcionActividadCliente=Core.Functions.Validations.getValidatedSwidgetValue(a.txtDescripcionActividadCliente,g);f.ReferenciaBancariaNombre=Core.Functions.Validations.getValidatedSwidgetValue(a.txtReferenciaBancariaNombre,g);f.ReferenciaBancariaApellido=Core.Functions.Validations.getValidatedSwidgetValue(a.txtReferenciaBancariaApellido,g);f.ReferenciaBancariaCargo=Core.Functions.Validations.getValidatedDropDownValue(a.ddlReferenciaBancariaCargo,g);f.ReferenciaBancariaInstitucion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtReferenciaBancariaInstitucion,g);f.ReferenciaBancariaTelefono=Core.Functions.Validations.getValidatedSwidgetValue(a.txtReferenciaBancariaTelefono,g);f.ReferenciaBancariaEMail=Core.Functions.Validations.getValidatedSwidgetValue(a.txtReferenciaBancariaEmail,g);f.ReferenciaBancariaDomicilioCalle=Core.Functions.Validations.getValidatedSwidgetValue(a.txtReferenciaBancariaDomicilio,g);f.ReferenciaBancariaDomicilioCiudad=Core.Functions.Validations.getValidatedSwidgetValue(a.txtReferenciaBancariaCiudad,g);f.ReferenciaBancariaDomicilioidPais=Core.Functions.Validations.getValidatedDropDownValue(a.ddlReferenciaBancariaPais,g);f.ContactoFallecimientoNombre=a.txtContactoFallecimientoNombre.val();f.ContactoFallecimientoApellido=a.txtContactoFallecimientoApellido.val();f.ContactoFallecimientoParentesco=a.txtContactoFallecimientoParentesco.val();f.ContactoFallecimientoTelefono=a.txtContactoFallecimientoTelefono.val();f.ContactoFallecimientoEMail=a.txtContactoFallecimientoEmail.val();f.ContactoFallecimientoDomicilioCalle=a.txtContactoFallecimientoDomicilio.val();f.ContactoFallecimientoDomicilioCiudad=a.txtContactoFallecimientoCiudad.val();f.ContactoFallecimientoDomicilioidPais=((a.ddlContactoFallecimientoPais.swidget().selectedItem())?a.ddlContactoFallecimientoPais.swidget().selectedItem().idPais:null);f.usuarioAsignado=a.txtUsuarioAsignado.val();f.tipoInversionAcciones=a.chkTipoInversionAcciones.swidget().checked()?1:0;f.tipoInversionOpciones=a.chkTipoInversionOpciones.swidget().checked()?1:0;f.tipoInversionFondos=a.chkTipoInversionFondos.swidget().checked()?1:0;f.tipoInversionTitulosPublicos=a.chkTipoInversionBonos.swidget().checked()?1:0;f.tipoInversionFuturos=a.chkTipoInversionFuturos.swidget().checked()?1:0;f.tipoInversionOtros=a.getTipoInversionOtro(g);f.ExperienciaEnInversionesAcciones=a.chkExperienciaInversionesAcciones.swidget().checked()?1:0;f.ExperienciaEnInversionesOpciones=a.chkExperienciaInversionesOpciones.swidget().checked()?1:0;f.ExperienciaEnInversionesFondos=a.chkExperienciaInversionesFondos.swidget().checked()?1:0;f.ExperienciaEnInversionesBonos=a.chkExperienciaInversionesBonos.swidget().checked()?1:0;f.ExperienciaEnInversionesFuturos=a.chkExperienciaInversionesFuturos.swidget().checked()?1:0;f.ExperienciaEnInversionesOtros=a.getExperienciaInversionesOtro(g);f.plazoAproxInversion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtPlazoInversion,g);f.idPersonaAsesor=Core.Functions.Validations.getValidatedDropDownValue(a.ddlAsesor,g);f.idArancel=Core.Functions.Validations.getValidatedDropDownValue(a.ddlArancel,g);f.UsarFirmaDigital=a.chkUsarFirmaDigital.swidget().checked()?1:0;if(Core.Objects.Context.Configuration.idAplicacion==3){if(d.idTipoValidacion>=10){f.idNivelDeRiesgo=Core.Functions.Validations.getValidatedDropDownValue(a.ddlNivelRiesgo,g)}else{f.idNivelDeRiesgo=((a.ddlNivelRiesgo.swidget().selectedItem())?a.ddlNivelRiesgo.swidget().selectedItem().idRiesgo:null)}}else{f.idNivelDeRiesgo=(a.dataCuenta)?a.dataCuenta.datos[0].idNivelDeRiesgo:null}if(a.dataCuenta!=null){f.idEstadoAperturaCuenta=d?d.idEstadoAperturaCuenta:0;if(!d){Core.Functions.Validations.toggleValidation(a.ddlEstado,true);g.value=false}else{Core.Functions.Validations.toggleValidation(a.ddlEstado,false)}f.idAperturaCuenta=a.dataCuenta.datos[0].idAperturaCuenta;f.version=a.dataCuenta.datos[0].version;f.hash=a.dataCuenta.datos[0].hash;f.AceptoTyC=a.dataCuenta.datos[0].AceptoTyC;f.idPaso=a.dataCuenta.datos[0].idPaso;f.idSubPaso=a.dataCuenta.datos[0].idSubPaso;f.nombreOriginal=a.dataCuenta.datos[0].nombreOriginal;f.emailOriginal=a.dataCuenta.datos[0].emailOriginal;f.idCuentaExistente=a.dataCuenta.datos[0].idCuentaExistente;f.idExterno=a.dataCuenta.datos[0].idExterno;f.AceptoMandatoDiscrecional=a.dataCuenta.datos[0].AceptoMandatoDiscrecional;f.SolicitarMandatoDiscrecional=a.dataCuenta.datos[0].SolicitarMandatoDiscrecional}else{f.idNegocio=Core.Enums.eNegocio.BCI}if(!f.tipoInversionAcciones&&!f.tipoInversionTitulosPublicos&&!f.tipoInversionFideicomisos&&!f.tipoInversionOpciones&&!f.tipoInversionFondos&&!f.tipoInversionOtros&&!f.tipoInversionChequePagoDiferido&&!f.tipoInversionFuturos&&!f.tipoInversionObligacionesNegociables&&!f.tipoInversionTitulosPublicos){g.value=false;a.divAlert.text("Debe seleccionar el tipo de inversión.");a.divAlert.slideDown()}if(!f.ExperienciaEnInversionesAcciones&&!f.ExperienciaEnInversionesOpciones&&!f.ExperienciaEnInversionesFondos&&!f.ExperienciaEnInversionesBonos&&!f.ExperienciaEnInversionesFuturos&&!f.ExperienciaEnInversionesOtros){g.value=false;a.divAlert.text("Debe seleccionar la experiencia en inversión.");a.divAlert.slideDown()}if(a.chkIngresoAsesorFinanciero.swidget().checked()&&(!a.txtIngresoAsesorFinanciero.val()||!a.isValidEmailAddress(a.txtIngresoAsesorFinanciero.val()))){g.value=false;a.divAlert.text("Debe ingresar el email del contacto.");a.divAlert.slideDown()}else{f.contactoOriginal=a.chkIngresoAsesorFinanciero.swidget().checked()?a.txtIngresoAsesorFinanciero.val():""}f.cuentaComitente=1;f.cuentaCuotapartista=0;var c=new Core.Controls.ManagerPersonaBCI({esCuentaJuridica:false,dataParametros:a.dataParametros});f.personas=a.personas;f.archivos=a.archivos;f.observaciones=a.observaciones;for(var e=0;e<a.personas.length;e++){if(!c.isValidPerson(a.personas[e],d.idTipoValidacion)){g.value=false;a.divAlert.text("Revise los datos de la persona: "+((a.personas[e].tipo==Core.Business.eTipoPersonaCuenta.Titular)?"Titular":"Autorizado")+" "+a.personas[e].numero+".");a.divAlert.slideDown()}}if(g.value){return f}else{null}};a.getOrigenPatrimonioOtro=function(c){if(!a.chkOrigenPatrimonioOtro.swidget().checked()){return""}else{if(a.txtOrigenPatrimonioOtroDetalle.swidget().value()!=""){return a.txtOrigenPatrimonioOtroDetalle.swidget().value()}else{if(!c){return""}else{c.value=false;a.divAlert.text("Debe ingresar el detalle del origen del patrimonio.");a.divAlert.slideDown();return""}}}};a.getSelectedTipoFirma=function(c){if(a.chkTipoFirmaConjunta.swidget().checked()){return Core.Business.eTipoFirma.Conjunta}else{if(a.chkTipoFirmaIndistinta.swidget().checked()){return Core.Business.eTipoFirma.Indistinta}else{if(!c){return Core.Business.eTipoFirma.Indistinta}else{c.value=false;a.divAlert.text("Debe seleccionar el tipo de firma.");a.divAlert.slideDown();return Core.Business.eTipoFirma.Indistinta}}}};a.getTipoInversionOtro=function(c){if(!a.chkTipoInversionOtro.swidget().checked()){return""}else{if(a.txtTipoInversionOtroDetalle.swidget().value()!=""){return a.txtTipoInversionOtroDetalle.swidget().value()}else{if(!c){return""}else{c.value=false;a.divAlert.text("Debe ingresar el detalle del tipo de inversión.");a.divAlert.slideDown();return""}}}};a.getExperienciaInversionesOtro=function(c){if(!a.chkExperienciaInversionesOtro.swidget().checked()){return""}else{if(a.txtExperienciaInversionesOtroDetalle.swidget().value()!=""){return a.txtExperienciaInversionesOtroDetalle.swidget().value()}else{if(!c){return""}else{c.value=false;a.divAlert.text("Debe ingresar el detalle de la experiencia en inversión.");a.divAlert.slideDown();return""}}}};a.getSelectedCanal=function(f){var d=$(".chk-canal-option");for(var e=0;e<d.length;e++){var c=$(d[e]);if(c.swidget().checked()){return c.attr("idCanalDeVenta")}}if(!f){return Core.Business.eCanal.None}else{f.value=false;a.divAlert.text("Debe seleccionar el canal.");a.divAlert.slideDown();return Core.Business.eCanal.None}};a.getCanalOtro=function(c){if(a.txtCanalOtroDetalle.swidget().value()!=""){return a.txtCanalOtroDetalle.swidget().value()}else{if(!c){return""}else{c.value=false;a.divAlert.text("Debe ingresar el detalle del canal.");a.divAlert.slideDown();return""}}};a.getSelectedMontoAInvertir=function(f){var d=$(".monto-a-invertir-option");for(var e=0;e<d.length;e++){var c=$(d[e]);if(c.swidget().checked()){return c.attr("idMontoAInvertir")}}if(a.namespaceActivo=="Legajos"&&a.dataCuenta!=null){return a.dataCuenta.datos[0].montoAInvertir}if(!f){return Core.Business.eAmountRange.Hasta200}else{f.value=false;a.divAlert.text("Debe seleccionar el monto a invertir");a.divAlert.slideDown();return Core.Business.eAmountRange.Hasta200}};a.getSelectedIngresosAnuales=function(f){var d=$(".ingresos-anuales-option");for(var e=0;e<d.length;e++){var c=$(d[e]);if(c.swidget().checked()){return c.attr("idIngresosAnuales")}}if(a.namespaceActivo=="Legajos"&&a.dataCuenta!=null){return a.dataCuenta.datos[0].ingresosAnuales}if(!f){return Core.Business.eAmountRange.Hasta200}else{f.value=false;a.divAlert.text("Debe seleccionarlos ingresos anuales");a.divAlert.slideDown();return Core.Business.eAmountRange.Hasta200}};a.getSelectedPatrimonioNeto=function(f){var d=$(".patrimonio-neto-option");for(var e=0;e<d.length;e++){var c=$(d[e]);if(c.swidget().checked()){return c.attr("idPatromonioNeto")}}if(a.namespaceActivo=="Legajos"&&a.dataCuenta!=null){return a.dataCuenta.datos[0].patrimonioNeto}if(!f){return Core.Business.eAmountRange.Entre200Y700}else{f.value=false;a.divAlert.text("Debe seleccionar el patrimonio neto");a.divAlert.slideDown();return Core.Business.eAmountRange.Entre200Y700}};a.getSelectedNivelExperienciaInversion=function(f){var d=$(".experiencia-inversiones-nivel-option");for(var e=0;e<d.length;e++){var c=$(d[e]);if(c.swidget().checked()){return c.attr("idNivelExperienciaInversion")}}if(a.namespaceActivo=="Legajos"&&a.dataCuenta!=null){return a.dataCuenta.datos[0].idNivelExperienciaInversion}if(!f){return Core.Business.eAmountRange.Hasta200}else{f.value=false;a.divAlert.text("Debe seleccionar el nivel de experiencia de inversión");a.divAlert.slideDown();return Core.Business.eAmountRange.Hasta200}};a.getSelectedRelacionInversionPatrimonio=function(f){var d=$(".relacion-inversion-patrimonio-option");for(var e=0;e<d.length;e++){var c=$(d[e]);if(c.swidget().checked()){return c.attr("idRelacionInversionPatrimonio")}}if(a.namespaceActivo=="Legajos"&&a.dataCuenta!=null){return a.dataCuenta.datos[0].idRelacionInversionPatrimonio}if(!f){return Core.Business.eAmountRange.Hasta200}else{f.value=false;a.divAlert.text("Debe seleccionar la relación de inversión patrimonio");a.divAlert.slideDown();return Core.Business.eAmountRange.Hasta200}};a.getSelectedObjetivoInversion=function(f){var d=$(".objetivo-inversion-option");for(var e=0;e<d.length;e++){var c=$(d[e]);if(c.swidget().checked()){return c.attr("idObjetivoInversion")}}if(a.namespaceActivo=="Legajos"&&a.dataCuenta!=null){return a.dataCuenta.datos[0].idObjetivoInversion}if(!f){return Core.Business.eAmountRange.None}else{f.value=false;a.divAlert.text("Debe seleccionar el objetivo de inversión");a.divAlert.slideDown();return Core.Business.eAmountRange.Hasta200}};a.getSelectedNivelToleranciaAlRiesgo=function(f){var d=$(".nivel-tolerancia-riesgo-option");for(var e=0;e<d.length;e++){var c=$(d[e]);if(c.swidget().checked()){return c.attr("idNivelToleranciaAlRiesgo")}}if(a.namespaceActivo=="Legajos"&&a.dataCuenta!=null){return a.dataCuenta.datos[0].idNivelToleranciaAlRiesgo}if(!f){return Core.Business.eAmountRange.Hasta200}else{f.value=false;a.divAlert.text("Debe seleccionar el nivel de tolerancia al riesgo");a.divAlert.slideDown();return Core.Business.eAmountRange.Hasta200}};a.getMaxNumero=function(f){var c=$.grep(a.personas,function(h,g){return h.tipo==f});var e=0;for(var d=0;d<c.length;d++){if(c[d].numero>e){e=c[d].numero}}return e};a.refreshNumeroPersonas=function(){var e=0;var c=0;for(var d=0;d<a.personas.length;d++){if(a.personas[d].tipo==Core.Business.eTipoPersonaCuenta.Titular){e++;a.personas[d].numero=e}else{c++;a.personas[d].numero=c}}};a.refreshPersonas=function(){var c=a.gridPersonas.swidget().initialOptions;c.dataSource.data=a.personas;a.gridPersonas.swidget().refresh(c)};a.setControls=function(){a.divOrigenPatrimonioOtroDetalle.hide();if(a.chkOrigenPatrimonioOtro.swidget().checked()){a.divOrigenPatrimonioOtroDetalle.show()}a.divFondeoCuentaOtroDetalle.hide();if(a.chkFondeoCuentaOtro.swidget().checked()){a.divFondeoCuentaOtroDetalle.show()}a.divCanalOtroDetalle.hide();if(a.getSelectedCanal()==Core.Business.eCanal.Otro){a.divCanalOtroDetalle.show()}a.divObjetivoInversionDetallePeriodo.hide();if(a.getSelectedObjetivoInversion()==Core.Business.eAmountRange.Hasta200){a.divObjetivoInversionDetallePeriodo.show()}a.divTipoInversionOtroDetalle.hide();if(a.chkTipoInversionOtro.swidget().checked()){a.divTipoInversionOtroDetalle.show()}a.divExperienciaInversionesOtroDetalle.hide();if(a.chkExperienciaInversionesOtro.swidget().checked()){a.divExperienciaInversionesOtroDetalle.show()}a.divIngresoAsesorFinanciero.hide();if(a.chkIngresoAsesorFinanciero.swidget().checked()){a.divIngresoAsesorFinanciero.show()}a.divCambiosSignificativosPatrimonioDetalle.hide();if(a.chkCambiosSignificativosPatrimonio.swidget().checked()){a.divCambiosSignificativosPatrimonioDetalle.show()}};a.isAperturaWeb=function(){var c=$.grep(a.personas,function(e,d){return e.tipo==Core.Business.eTipoPersonaCuenta.Titular&&e.numero==1})[0];return(c&&((c.idArchivoDNIDorso&&c.idArchivoDNIDorso>0)||(c.idArchivoDNIFrente&&c.idArchivoDNIFrente>0)||(c.idArchivoFoto&&c.idArchivoFoto>0)))};a.isValidEmailAddress=function(c){if(!c){return false}else{var d=/^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i;if(!d.test(c)){return false}return true}};a.destroy=function(c){a.ddlVersion.swidget().destroy();a.ddlEstado.swidget().destroy();a.ddlAsesor.swidget().destroy();a.chkUsarFirmaDigital.swidget().destroy();a.chkIngresoAsesorFinanciero.swidget().destroy();a.txtIngresoAsesorFinanciero.swidget().destroy();a.chkOrigenPatrimonioActividadPrincipal.swidget().destroy();a.chkOrigenPatrimonioVentaBienes.swidget().destroy();a.chkOrigenPatrimonioHerencia.swidget().destroy();a.chkOrigenPatrimonioOtro.swidget().destroy();a.txtOrigenPatrimonioOtroDetalle.swidget().destroy();a.chkFondeoCuentaTransferenciaTitulosCuentaInversion.swidget().destroy();a.chkFondeoCuentaTransferenciaDineroCuentaInversion.swidget().destroy();a.chkFondeoCuentaTransferenciaDineroBanco.swidget().destroy();a.chkFondeoCuentaOtro.swidget().destroy();a.txtFondeoCuentaOtroDetalle.swidget().destroy();a.txtCantidadTransferenciasDesdeCuentaPorAnio.swidget().destroy();a.txtPaisesCuentaOrigen.swidget().destroy();a.txtCantidadTransferenciasHaciaCuentaPorAnio.swidget().destroy();a.txtPaisesCuentaDestino.swidget().destroy();a.chkConvenioComitenteAAGI.swidget().destroy();a.txtCanalOtroDetalle.swidget().destroy();a.txtObjetivoInversionDetallePeriodo.swidget().destroy();a.ddlArancel.swidget().destroy();a.ddlNivelRiesgo.swidget().destroy();a.txtComoLlegoABalanz.swidget().destroy();a.txtUsuarioAsignado.swidget().destroy();a.chkTipoInversionAcciones.swidget().destroy();a.chkTipoInversionFondos.swidget().destroy();a.chkTipoInversionOpciones.swidget().destroy();a.chkTipoInversionBonos.swidget().destroy();a.chkTipoInversionFuturos.swidget().destroy();a.chkTipoInversionOtro.swidget().destroy();a.txtTipoInversionOtroDetalle.swidget().destroy();a.chkExperienciaInversionesAcciones.swidget().destroy();a.chkExperienciaInversionesFondos.swidget().destroy();a.chkExperienciaInversionesOpciones.swidget().destroy();a.chkExperienciaInversionesBonos.swidget().destroy();a.chkExperienciaInversionesFuturos.swidget().destroy();a.chkExperienciaInversionesOtro.swidget().destroy();a.txtExperienciaInversionesOtroDetalle.swidget().destroy();a.txtPlazoInversion.swidget().destroy();a.txtDescripcionActividadCliente.swidget().destroy();a.chkCambiosSignificativosPatrimonio.swidget().destroy();a.txtCambiosSignificativosPatrimonioDetalle.swidget().destroy();a.txtReferenciaBancariaNombre.swidget().destroy();a.txtReferenciaBancariaApellido.swidget().destroy();a.ddlReferenciaBancariaCargo.swidget().destroy();a.txtReferenciaBancariaInstitucion.swidget().destroy();a.txtReferenciaBancariaTelefono.swidget().destroy();a.txtReferenciaBancariaEmail.swidget().destroy();a.txtReferenciaBancariaDomicilio.swidget().destroy();a.txtReferenciaBancariaCiudad.swidget().destroy();a.ddlReferenciaBancariaPais.swidget().destroy();a.txtContactoFallecimientoNombre.swidget().destroy();a.txtContactoFallecimientoApellido.swidget().destroy();a.txtContactoFallecimientoParentesco.swidget().destroy();a.txtContactoFallecimientoTelefono.swidget().destroy();a.txtContactoFallecimientoEmail.swidget().destroy();a.txtContactoFallecimientoDomicilio.swidget().destroy();a.txtContactoFallecimientoCiudad.swidget().destroy();a.ddlContactoFallecimientoPais.swidget().destroy();a.gridPersonas.swidget().destroy();a.gridArchivos.swidget().destroy();a.gridObservaciones.swidget().destroy();a.divManagerAltaCuenta.html("");if(c){a.onClose()}}};Core.Business.eAmountRange={None:0,Hasta200:1,Entre200Y700:2,MasDe700:3,MasDe200:4};Core.Business.eTipoIdentificacionFiscal={None:0,CUIT:1,CUIL:2,CIE:3,CDI:4};Core.Business.eGenero={Femenino:0,Masculino:1};Core.Business.eEstadoCivil={None:0,Soltero:1,Casado:2,Divorciado:3,Separado:4,Viudo:5};Core.Business.eCanal={None:0,Web:1,PorFuncionarios:2,PorEmpleados:3,PorGestionComercial:4,Otro:5};Core.Business.eTipoFirma={None:0,Indistinta:1,Conjunta:2};Core.Business.eCaracterInvocado={None:0,Titular:1,Apoderado:2,Representante:3,Autorizado:4};Core.Business.eTipoDocumento={DNI:1,CI:2,LE:3,LC:4,PAS:5,Extranjero:6};Core.Business.eActividadPrincipalJuridica={Otro:21};Core.Business.eCondicionIVA={ConsumidorFinal:1,Exento:2,NoResponsable:3,ResponsableInscripto:4,ResponsableMonotributo:5,ResponsableInscriptoBanco:7,NoCategorizado:8};Core.Business.eNacionalidad={Argentina:1};Core.Business.eProvincia={BsAs:1,CABA:2};Core.Business.eTipoRegistracion={IGJ:2,DPJ:3,Extranjero:8};Core.Controls.ManagerAltaCuentaBCIJuridica=function(b){var a=this;a.decimalCount=2;a.phoneCodeAr=$.grep(Core.Objects.Contry,function(d,c){return d.iso_code=="AR"})[0].phone_code;a.idPais_Argentina=1;a.id="homeAltaCuenta";a.idDefaultProfile=null;a.idDefaultAccount=null;a.divInformes=null;a.divReadOnly=null;a.divVersion=null;a.ddlVersion=null;a.divAltaCuenta=null;a.divManagerPersona=null;a.divMatrizRiesgo=null;a.divAsesor=null;a.ddlAsesor=null;a.divContainerEstado=null;a.divDescripcionEstado=null;a.lblEstado=null;a.ddlEstado=null;a.divTipoFirma=null;a.chkTipoFirmaConjunta=null;a.chkTipoFirmaIndistinta=null;a.divIngresoAsesorFinanciero=null;a.txtIngresoAsesorFinanciero=null;a.chkIngresoAsesorFinanciero=null;a.txtUsuarioAsignado=null;a.divMontoInvertir=null;a.divMontoInvertirContainer=null;a.lblMontoInvertirAlert=null;a.divIngresosAnuales=null;a.divIngresosAnualesContainer=null;a.lblIngresosAnualesAlert=null;a.divPatrimonioNeto=null;a.divPatrimonioNetoContainer=null;a.lblPatrimonioNetoAlert=null;a.divOrigenPatrimonio=null;a.chkOrigenPatrimonioIngresosOperativos=null;a.chkOrigenPatrimonioAportesCapital=null;a.chkOrigenPatrimonioSuscripcionCuotapartes=null;a.chkOrigenPatrimonioVentaActivosFijos=null;a.chkOrigenPatrimonioDonacion=null;a.chkOrigenPatrimonioInversionesAnteriores=null;a.chkOrigenPatrimonioOtro=null;a.divOrigenPatrimonioOtroDetalle=null;a.txtOrigenPatrimonioOtroDetalle=null;a.divConvenioComitenteAAGI=null;a.chkConvenioComitenteAAGI=null;a.divCanal=null;a.divCanalContainer=null;a.divCanalOtroDetalle=null;a.txtCanalOtroDetalle=null;a.divArancel=null;a.ddlArancel=null;a.divComoLlegoABalanz=null;a.txtComoLlegoABalanz=null;a.divTipoInversion=null;a.chkTipoInversionAcciones=null;a.chkTipoInversionOpciones=null;a.chkTipoInversionFondos=null;a.chkTipoInversionBonos=null;a.chkTipoInversionFuturos=null;a.chkTipoInversionOtro=null;a.divTipoInversionOtroDetalle=null;a.txtTipoInversionOtroDetalle=null;a.divPlazoInversion=null;a.txtPlazoInversion=null;a.divDescripcionActividadCliente=null;a.txtDescripcionActividadCliente=null;a.txtReferenciaBancariaNombre=null;a.txtReferenciaBancariaApellido=null;a.ddlReferenciaBancariaCargo=null;a.txtReferenciaBancariaInstitucion=null;a.txtReferenciaBancariaTelefono=null;a.txtReferenciaBancariaEmail=null;a.txtReferenciaBancariaDomicilio=null;a.txtReferenciaBancariaCiudad=null;a.ddlReferenciaBancariaPais=null;a.ddlPaisTipoIdentificacionFiscal=null;a.ddlTipoIdentificacionFiscal=null;a.txtIdentificacionFiscal=null;a.txtRazonSocial=null;a.ddlNacionalidad=null;a.ddlLugarConstitucion=null;a.ddlTipoRegistracionJuridica=null;a.ddlTipoPersonaJuridica=null;a.txtNumeroInscripcion=null;a.txtFechaConstitucion=null;a.txtTomo=null;a.txtLibro=null;a.divActividadPrincipalCampoAdicional1=null;a.ddlActividadPrincipal=null;a.divActividadPrincipalOtro=null;a.txtActividadPrincipalOtro=null;a.txtSegmentoInversion=null;a.txtNumeroAseguradora=null;a.txtDomicilioLegalCalle=null;a.txtDomicilioLegalNumero=null;a.txtDomicilioLegalPiso=null;a.txtDomicilioLegalDepartamento=null;a.ddlDomicilioLegalPais=null;a.ddlDomicilioLegalProvincia=null;a.txtDomicilioLegalLocalidad=null;a.txtDomicilioLegalCodigoPostal=null;a.ddlEmailNotificacionesCantidad=null;a.txtEmailNotificaciones1=null;a.divEmailNotificaciones1=null;a.txtEmailNotificaciones2=null;a.divEmailNotificaciones2=null;a.txtEmailNotificaciones3=null;a.divEmailNotificaciones3=null;a.txtEmailNotificaciones4=null;a.divEmailNotificaciones4=null;a.txtTelefonoParticularArea=null;a.txtTelefonoParticularNumero=null;a.divTelefonoCelularPais=null;a.divTelefonoCelularArea=null;a.divTelefonoCelularNumero=null;a.ddlTelefonoCelularPais=null;a.txtTelefonoCelularArea=null;a.txtTelefonoCelularNumero=null;a.txtTributaNit1=null;a.txtTributaNit2=null;a.txtTributaNit3=null;a.ddlTributaPais1=null;a.ddlTributaPais2=null;a.ddlTributaPais3=null;a.ddlTributaTipoIdentificadorFiscal1=null;a.ddlTributaTipoIdentificadorFiscal2=null;a.ddlTributaTipoIdentificadorFiscal3=null;a.ddlCantidadResidenciasFiscales=null;a.divResidenciaFiscal1=null;a.divResidenciaFiscal2=null;a.divResidenciaFiscal3=null;a.chkPoseeBeneficiariosEstadounidenses=null;a.divPoseeBeneficiariosEstadounidenses=null;a.divBeneficiariosEstadounidensesCantidad=null;a.ddlBeneficiariosEstadounidensesCantidad=null;a.divBeneficiarioEstadounidense1=null;a.divBeneficiarioEstadounidense2=null;a.divBeneficiarioEstadounidense3=null;a.divBeneficiarioEstadounidense4=null;a.divBeneficiarioEstadounidense5=null;a.divBeneficiarioEstadounidense6=null;a.txtBeneficiarioEstadounidenseNombre1=null;a.txtBeneficiarioEstadounidenseNombre2=null;a.txtBeneficiarioEstadounidenseNombre3=null;a.txtBeneficiarioEstadounidenseNombre4=null;a.txtBeneficiarioEstadounidenseNombre5=null;a.txtBeneficiarioEstadounidenseNombre6=null;a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU1=null;a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU2=null;a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU3=null;a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU4=null;a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU5=null;a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU6=null;a.txtBeneficiarioEstadounidensePorcentajeParticipacion1=null;a.txtBeneficiarioEstadounidensePorcentajeParticipacion2=null;a.txtBeneficiarioEstadounidensePorcentajeParticipacion3=null;a.txtBeneficiarioEstadounidensePorcentajeParticipacion4=null;a.txtBeneficiarioEstadounidensePorcentajeParticipacion5=null;a.txtBeneficiarioEstadounidensePorcentajeParticipacion6=null;a.ddlTipoInstitucionFinancieraExtranjera=null;a.txtInstitucionFinancieraExtranjeraGIIN=null;a.ddlTipoReporteDirectoIRS=null;a.txtReporteDirectoIRSGIIN=null;a.ddlTipoPersonaJuridicaExenta=null;a.txtPersonaEstadounidenseTIN=null;a.divCiudadaniaEEUUCampoAdicional1=null;a.divCiudadaniaEEUUCampoAdicional2=null;a.divCiudadaniaEEUUCampoAdicional3=null;a.divCiudadaniaEEUUCampoAdicional4=null;a.divCiudadaniaEEUUCampoAdicional5=null;a.ddlCiudadaniaEEUU=null;a.divCiudadaniaEEUUDeclaracionJurada=null;a.chkCiudadaniaEEUUDeclaracionJurada=null;a.ddlTipoOcde=null;a.divTipoOcdeDeclaracionJurada=null;a.chkTipoOcdeDeclaracionJurada=null;a.divMontoCompliance=null;a.txtMontoCompliance=null;a.controlMontoCompliance=null;a.ddlRiesgoCliente=null;a.btnGuardarYCerrar=null;a.btnFormularioVacio=null;a.btnVolver=null;a.btnNuevaPersona=null;a.gridPersonas=null;a.btnAgregarArchivo=null;a.gridArchivos=null;a.divContainerObservaciones=null;a.gridObservaciones=null;a.btnAgregarObservacion=null;a.divCalcularMatrizRiesgo=null;a.btnCalcularMatrizRiesgo=null;a.btnConsultarMatrizRiesgo=null;a.divAlert=null;a.detalleDisponible=null;a.dataCuenta=null;a.dataParametros=null;a.dataParametrosUsuario=null;a.personas=[];a.archivos=[];a.observaciones=[];a.idAperturaCuenta=null;a.aperturaCuenta=null;a.versionActual=null;a.optionsApertura=null;a.readOnly=null;a.pageOptions=null;a.namespaceActivo="";a.onClose=function(){};a.onSave=function(c,d){};a.show=function(){a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu("matrizDeRiesgo",Core.Objects.Context.Profiles[0]);a.idAperturaCuenta=0;a.versionActual=0;a.maxVersion=0;a.optionsApertura=null;a.readOnly=false;a.aperturaCuenta=null;a.namespaceActivo="";a.dataParametros=null;a.dataParametrosUsuario=null;a.dataCuenta=null;$.extend(true,a,b);a.divAltaCuenta=a.container.find(".div-alta-cuenta");a.divManagerPersona=a.container.find(".div-manager-titular-autorizado");a.divMatrizRiesgo=a.container.find(".div-container-matriz-riesgo");a.divManagerAltaCuenta=a.container.find(".div-manager-alta-cuenta");a.divManagerAltaCuenta.html("");a.divManagerAltaCuenta.load("/Pages/manager-cuenta-bci-juridica.html",function(c,d,e){if(d=="success"){a.divAltaCuenta.show();a.divManagerPersona.hide();a.divMatrizRiesgo.hide();$("html, body").animate({scrollTop:$(".cuenta").offset().top},1000);a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[a.idDefaultProfile]);a.titlePage=a.divManagerAltaCuenta.find(".title-page");a.titlePage.text((a.idAperturaCuenta)?("Cuenta BCI: "+a.idAperturaCuenta):"Alta Cuenta BCI");a.divDescripcionCuenta=a.divManagerAltaCuenta.find(".div-descripcion-cuenta");a.lblDescripcionCuenta=a.divManagerAltaCuenta.find(".lbl-descripcion-cuenta");a.divComitenteCuotapartistaCuenta=a.divManagerAltaCuenta.find(".div-comitente-coutapartista-cuenta");a.lblComitenteCuotapartistaCuenta=a.divManagerAltaCuenta.find(".lbl-comitente-coutapartista-cuenta");a.divDescripcionCuenta.hide();a.divComitenteCuotapartistaCuenta.hide();a.divContainerEstado=a.divManagerAltaCuenta.find(".div-container-estado");a.ddlEstado=a.divManagerAltaCuenta.find(".dropdown-estado");a.lblEstadoCuenta=a.divManagerAltaCuenta.find(".lbl-estado-cuenta");a.divDescripcionEstado=a.divManagerAltaCuenta.find(".div-descripcion-estado");a.divReadOnly=a.divManagerAltaCuenta.find(".div-read-only");a.divInformes=a.divManagerAltaCuenta.find(".div-cuenta-informes");a.divVersion=a.divManagerAltaCuenta.find(".div-version");a.ddlVersion=a.divManagerAltaCuenta.find(".dropdown-version");a.divAsesor=a.divManagerAltaCuenta.find(".div-asesor");a.divUsarFirmaDigital=a.divManagerAltaCuenta.find(".div-usar-firma-digital");a.chkUsarFirmaDigital=a.divManagerAltaCuenta.find(".checkbox-usar-firma-digital");a.ddlAsesor=a.divManagerAltaCuenta.find(".dropdown-asesor");a.divDescripcionEstado=a.divManagerAltaCuenta.find(".div-descripcion-estado");a.divTipoFirma=a.divManagerAltaCuenta.find(".div-tipo-firma");a.chkTipoFirmaConjunta=a.divManagerAltaCuenta.find(".chk-tipo-firma-conjunta");a.chkTipoFirmaIndistinta=a.divManagerAltaCuenta.find(".chk-tipo-firma-indistinta");a.chkIngresoAsesorFinanciero=a.divManagerAltaCuenta.find(".checkbox-ingreso-asesor-financiero");a.txtIngresoAsesorFinanciero=a.divManagerAltaCuenta.find(".textbox-ingreso-asesor-financiero");a.divIngresoAsesorFinanciero=a.divManagerAltaCuenta.find(".div-ingreso-asesor-financiero");a.divMontoInvertir=a.divManagerAltaCuenta.find(".div-monto-invertir");a.divMontoInvertirContainer=a.divManagerAltaCuenta.find(".div-monto-invertir-container");a.lblMontoInvertirAlert=a.divManagerAltaCuenta.find(".lbl-monto-invertir-alert");a.lblMontoInvertirAlert.html("");a.divIngresosAnuales=a.divManagerAltaCuenta.find(".div-ingresos-anuales");a.divIngresosAnualesContainer=a.divManagerAltaCuenta.find(".div-ingresos-anuales-container");a.lblIngresosAnualesAlert=a.divManagerAltaCuenta.find(".lbl-ingresos-anuales-alert");a.lblIngresosAnualesAlert.html("");a.divPatrimonioNeto=a.divManagerAltaCuenta.find(".div-patrimonio-neto");a.divPatrimonioNetoContainer=a.divManagerAltaCuenta.find(".div-patrimonio-neto-container");a.lblPatrimonioNetoAlert=a.divManagerAltaCuenta.find(".lbl-patrimonio-neto-alert");a.lblPatrimonioNetoAlert.html("");a.divExperienciaInversionesNivel=a.divManagerAltaCuenta.find(".div-experiencia-inversiones-nivel");a.divExperienciaInversionesNivelContainer=a.divManagerAltaCuenta.find(".div-experiencia-inversiones-nivel-container");a.lblExperienciaInversionesNivelAlert=a.divManagerAltaCuenta.find(".lbl-experiencia-inversiones-nivel-alert");a.lblExperienciaInversionesNivelAlert.html("");a.divExperienciaInversiones=a.divManagerAltaCuenta.find(".div-experiencia-inversiones");a.chkExperienciaInversionesBonos=a.divManagerAltaCuenta.find(".chk-experiencia-inversiones-bonos");a.chkExperienciaInversionesAcciones=a.divManagerAltaCuenta.find(".chk-experiencia-inversiones-acciones");a.chkExperienciaInversionesFondos=a.divManagerAltaCuenta.find(".chk-experiencia-inversiones-fondos");a.chkExperienciaInversionesOpciones=a.divManagerAltaCuenta.find(".chk-experiencia-inversiones-opciones");a.chkExperienciaInversionesFuturos=a.divManagerAltaCuenta.find(".chk-experiencia-inversiones-futuros");a.chkExperienciaInversionesOtro=a.divManagerAltaCuenta.find(".chk-experiencia-inversiones-otro");a.divExperienciaInversionesOtroDetalle=a.divManagerAltaCuenta.find(".div-experiencia-inversiones-otro-detalle");a.txtExperienciaInversionesOtroDetalle=a.divManagerAltaCuenta.find(".textbox-experiencia-inversiones-otro-detalle");a.divRelacionInversionPatrimonio=a.divManagerAltaCuenta.find(".div-relacion-inversion-patrimonio");a.divRelacionInversionPatrimonioContainer=a.divManagerAltaCuenta.find(".div-relacion-inversion-patrimonio-container");a.lblRelacionInversionPatrimonioAlert=a.divManagerAltaCuenta.find(".lbl-relacion-inversion-patrimonio-alert");a.lblRelacionInversionPatrimonioAlert.html("");a.divObjetivoInversion=a.divManagerAltaCuenta.find(".div-objetivo-inversion");a.divObjetivoInversionContainer=a.divManagerAltaCuenta.find(".div-objetivo-inversion-container");a.lblObjetivoInversionAlert=a.divManagerAltaCuenta.find(".lbl-objetivo-inversion-alert");a.lblObjetivoInversionAlert.html("");a.divObjetivoInversionDetallePeriodo=a.divManagerAltaCuenta.find(".div-objetivo-inversion-detalle-periodo");a.txtObjetivoInversionDetallePeriodo=a.divManagerAltaCuenta.find(".textbox-objetivo-inversion-detalle-periodo");a.divNivelToleranciaRiesgo=a.divManagerAltaCuenta.find(".div-nivel-tolerancia-riesgo");a.divNivelToleranciaRiesgoContainer=a.divManagerAltaCuenta.find(".div-nivel-tolerancia-riesgo-container");a.lblNivelToleranciaRiesgoAlert=a.divManagerAltaCuenta.find(".lbl-nivel-tolerancia-riesgo-alert");a.lblNivelToleranciaRiesgoAlert.html("");a.divOrigenPatrimonio=a.divManagerAltaCuenta.find(".div-origen-patrimonio");a.chkOrigenPatrimonioIngresosOperativos=a.divManagerAltaCuenta.find(".chk-origen-patrimonio-ingresos-operativos");a.chkOrigenPatrimonioAportesCapital=a.divManagerAltaCuenta.find(".chk-origen-patrimonio-aportes-capital");a.chkOrigenPatrimonioSuscripcionCuotapartes=a.divManagerAltaCuenta.find(".chk-origen-patrimonio-suscripcion-cuotapartes");a.chkOrigenPatrimonioVentaActivosFijos=a.divManagerAltaCuenta.find(".chk-origen-patrimonio-venta-activos-fijos");a.chkOrigenPatrimonioDonacion=a.divManagerAltaCuenta.find(".chk-origen-patrimonio-donacion");a.chkOrigenPatrimonioInversionesAnteriores=a.divManagerAltaCuenta.find(".chk-origen-patrimonio-inversiones-anteriores");a.chkOrigenPatrimonioOtro=a.divManagerAltaCuenta.find(".chk-origen-patrimonio-otro");a.divOrigenPatrimonioOtroDetalle=a.divManagerAltaCuenta.find(".div-otro-patrimonio-detalle");a.txtOrigenPatrimonioOtroDetalle=a.divManagerAltaCuenta.find(".textbox-otro-patrimonio-detalle");a.chkFondeoCuentaTransferenciaTitulosCuentaInversion=a.divManagerAltaCuenta.find(".chk-fondeo-cuenta-transferencia-titulos-cuenta-inversion");a.chkFondeoCuentaTransferenciaDineroCuentaInversion=a.divManagerAltaCuenta.find(".chk-fondeo-cuenta-transferencia-dinero-cuenta-inversion");a.chkFondeoCuentaTransferenciaDineroBanco=a.divManagerAltaCuenta.find(".chk-fondeo-cuenta-transferencia-dinero-banco");a.chkFondeoCuentaOtro=a.divManagerAltaCuenta.find(".chk-fondeo-cuenta-otro");a.divFondeoCuentaOtroDetalle=a.divManagerAltaCuenta.find(".div-fondeo-cuenta-otro-detalle");a.txtFondeoCuentaOtroDetalle=a.divManagerAltaCuenta.find(".textbox-fondeo-cuenta-otro-detalle");a.txtCantidadTransferenciasHaciaCuentaPorAnio=a.divManagerAltaCuenta.find(".textbox-cantidad-transferencias-hacia-su-cuenta-por-anio");a.txtPaisesCuentaOrigen=a.divManagerAltaCuenta.find(".textbox-paises-cuentas-origen");a.txtCantidadTransferenciasDesdeCuentaPorAnio=a.divManagerAltaCuenta.find(".textbox-cantidad-transferencias-desde-su-cuenta-por-anio");a.txtPaisesCuentaDestino=a.divManagerAltaCuenta.find(".textbox-paises-cuentas-destino");a.divConvenioComitenteAAGI=a.divManagerAltaCuenta.find(".div-convenio-comitente-aagi");a.chkConvenioComitenteAAGI=a.divManagerAltaCuenta.find(".checkbox-convenio-comitente-aagi");a.divCanal=a.divManagerAltaCuenta.find(".div-canal");a.divCanalContainer=a.divManagerAltaCuenta.find(".div-canal-container");a.divCanalOtroDetalle=a.divManagerAltaCuenta.find(".div-canal-otro-detalle");a.txtCanalOtroDetalle=a.divManagerAltaCuenta.find(".textbox-canal-otro-detalle");a.divArancel=a.divManagerAltaCuenta.find(".div-arancel");a.ddlArancel=a.divManagerAltaCuenta.find(".dropdown-arancel");a.divComoLlegoABalanz=a.divManagerAltaCuenta.find(".div-como-llego-a-balanz");a.txtComoLlegoABalanz=a.divManagerAltaCuenta.find(".textbox-como-llego-a-balanz");a.txtUsuarioAsignado=a.divManagerAltaCuenta.find(".textbox-usuario-asignado");a.divTipoInversion=a.divManagerAltaCuenta.find(".div-tipo-inversion");a.chkTipoInversionAcciones=a.divManagerAltaCuenta.find(".chk-tipo-inversion-acciones");a.chkTipoInversionOpciones=a.divManagerAltaCuenta.find(".chk-tipo-inversion-opciones");a.chkTipoInversionFondos=a.divManagerAltaCuenta.find(".chk-tipo-inversion-fondos");a.chkTipoInversionBonos=a.divManagerAltaCuenta.find(".chk-tipo-inversion-bonos");a.chkTipoInversionFuturos=a.divManagerAltaCuenta.find(".chk-tipo-inversion-futuros");a.chkTipoInversionOtro=a.divManagerAltaCuenta.find(".chk-tipo-inversion-otro");a.divTipoInversionOtroDetalle=a.divManagerAltaCuenta.find(".div-tipo-inversion-otro-detalle");a.txtTipoInversionOtroDetalle=a.divManagerAltaCuenta.find(".textbox-tipo-inversion-otro-detalle");a.divPlazoInversion=a.divManagerAltaCuenta.find(".div-plazo-inversion");a.txtPlazoInversion=a.divManagerAltaCuenta.find(".textbox-plazo-inversion");a.divDescripcionActividadCliente=a.divManagerAltaCuenta.find(".div-descripcion-actividad-cliente");a.txtDescripcionActividadCliente=a.divManagerAltaCuenta.find(".textbox-descripcion-actividad-cliente");a.chkCambiosSignificativosPatrimonio=a.divManagerAltaCuenta.find(".checkbox-cambios-significativos-patrimonio");a.divCambiosSignificativosPatrimonioDetalle=a.divManagerAltaCuenta.find(".div-cambios-significativos-patrimonio-detalle");a.txtCambiosSignificativosPatrimonioDetalle=a.divManagerAltaCuenta.find(".textbox-cambios-significativos-patrimonio-detalle");a.txtReferenciaBancariaNombre=a.divManagerAltaCuenta.find(".textbox-referencia-bancaria-nombre");a.txtReferenciaBancariaApellido=a.divManagerAltaCuenta.find(".textbox-referencia-bancaria-apellido");a.ddlReferenciaBancariaCargo=a.divManagerAltaCuenta.find(".dropdown-referencia-bancaria-cargo");a.txtReferenciaBancariaInstitucion=a.divManagerAltaCuenta.find(".textbox-referencia-bancaria-institucion");a.txtReferenciaBancariaTelefono=a.divManagerAltaCuenta.find(".textbox-referencia-bancaria-telefono");a.txtReferenciaBancariaEmail=a.divManagerAltaCuenta.find(".textbox-referencia-bancaria-email");a.txtReferenciaBancariaDomicilio=a.divManagerAltaCuenta.find(".textbox-referencia-bancaria-domicilio");a.txtReferenciaBancariaCiudad=a.divManagerAltaCuenta.find(".textbox-referencia-bancaria-ciudad");a.ddlReferenciaBancariaPais=a.divManagerAltaCuenta.find(".dropdown-referencia-bancaria-pais");a.chkOrdenesComunicacionesEscrito=a.divManagerAltaCuenta.find(".checkbox-ordenes-comunicaciones-escrito");a.chkOrdenesComunicacionesEmail=a.divManagerAltaCuenta.find(".checkbox-ordenes-comunicaciones-email");a.divOrdenesComunicacionesEmail=a.divManagerAltaCuenta.find(".div-ordenes-comunicaciones-email");a.txtOrdenesComunicacionesEmail=a.divManagerAltaCuenta.find(".textbox-ordenes-comunicaciones-email");a.chkOrdenesComunicacionesConvenioOperacion=a.divManagerAltaCuenta.find(".checkbox-ordenes-comunicaciones-convenio-operacion");a.ddlPaisTipoIdentificacionFiscal=a.divManagerAltaCuenta.find(".dropdown-pais-tipo-identificacion-fiscal");a.ddlTipoIdentificacionFiscal=a.divManagerAltaCuenta.find(".dropdown-tipo-identificacion-fiscal");a.txtIdentificacionFiscal=a.divManagerAltaCuenta.find(".textbox-identificacion-fiscal");a.txtRazonSocial=a.divManagerAltaCuenta.find(".textbox-razon-social");a.txtNombreComercial=a.divManagerAltaCuenta.find(".textbox-nombre-comercial");a.ddlNacionalidad=a.divManagerAltaCuenta.find(".dropdown-nacionalidad");a.ddlLugarConstitucion=a.divManagerAltaCuenta.find(".dropdown-lugar-constitucion");a.ddlTipoPersonaJuridica=a.divManagerAltaCuenta.find(".dropdown-tipo-persona-juridica");a.ddlTipoRegistracionJuridica=a.divManagerAltaCuenta.find(".dropdown-tipo-registracion-juridica");a.txtNumeroInscripcion=a.divManagerAltaCuenta.find(".textbox-numero-inscripcion");a.txtFechaConstitucion=a.divManagerAltaCuenta.find(".date-picker-fecha-constitucion");a.txtTomo=a.divManagerAltaCuenta.find(".textbox-tomo");a.txtLibro=a.divManagerAltaCuenta.find(".textbox-libro");a.divActividadPrincipalCampoAdicional1=a.divManagerAltaCuenta.find(".div-actividad-principal-campo-adicional-1");a.ddlActividadPrincipal=a.divManagerAltaCuenta.find(".dropdown-actividad-principal");a.divActividadPrincipalOtro=a.divManagerAltaCuenta.find(".div-actividad-principal-otro");a.txtActividadPrincipalOtro=a.divManagerAltaCuenta.find(".textbox-actividad-principal-otro");a.txtSegmentoInversion=a.divManagerAltaCuenta.find(".textbox-segmento-inversion");a.txtNumeroAseguradora=a.divManagerAltaCuenta.find(".textbox-numero-aseguradora");a.txtDomicilioLegalCalle=a.divManagerAltaCuenta.find(".textbox-domicilio-legal-calle");a.txtDomicilioLegalNumero=a.divManagerAltaCuenta.find(".textbox-domicilio-legal-numero");a.txtDomicilioLegalPiso=a.divManagerAltaCuenta.find(".textbox-domicilio-legal-piso");a.txtDomicilioLegalDepartamento=a.divManagerAltaCuenta.find(".textbox-domicilio-legal-departamento");a.ddlDomicilioLegalPais=a.divManagerAltaCuenta.find(".dropdown-domicilio-legal-pais");a.ddlDomicilioLegalProvincia=a.divManagerAltaCuenta.find(".dropdown-domicilio-legal-provincia");a.txtDomicilioLegalLocalidad=a.divManagerAltaCuenta.find(".textbox-domicilio-legal-localidad");a.txtDomicilioLegalCodigoPostal=a.divManagerAltaCuenta.find(".textbox-domicilio-legal-codigo-postal");a.ddlEmailNotificacionesCantidad=a.divManagerAltaCuenta.find(".dropdown-email-notificaciones-cantidad");a.txtEmailNotificaciones1=a.divManagerAltaCuenta.find(".textbox-email-notificaciones-1");a.divEmailNotificaciones1=a.divManagerAltaCuenta.find(".div-email-notificaciones-1");a.txtEmailNotificaciones2=a.divManagerAltaCuenta.find(".textbox-email-notificaciones-2");a.divEmailNotificaciones2=a.divManagerAltaCuenta.find(".div-email-notificaciones-2");a.txtEmailNotificaciones3=a.divManagerAltaCuenta.find(".textbox-email-notificaciones-3");a.divEmailNotificaciones3=a.divManagerAltaCuenta.find(".div-email-notificaciones-3");a.txtEmailNotificaciones4=a.divManagerAltaCuenta.find(".textbox-email-notificaciones-4");a.divEmailNotificaciones4=a.divManagerAltaCuenta.find(".div-email-notificaciones-4");a.txtTelefonoParticularArea=a.divManagerAltaCuenta.find(".textbox-telefono-particular-area");a.txtTelefonoParticularNumero=a.divManagerAltaCuenta.find(".textbox-telefono-particular-numero");a.divTelefonoCelularPais=a.divManagerAltaCuenta.find(".div-telefono-celular-pais");a.divTelefonoCelularArea=a.divManagerAltaCuenta.find(".div-telefono-celular-area");a.divTelefonoCelularNumero=a.divManagerAltaCuenta.find(".div-telefono-celular-numero");a.ddlTelefonoCelularPais=a.divManagerAltaCuenta.find(".dropdown-telefono-celular-pais");a.txtTelefonoCelularArea=a.divManagerAltaCuenta.find(".textbox-telefono-celular-area");a.txtTelefonoCelularNumero=a.divManagerAltaCuenta.find(".textbox-telefono-celular-numero");a.txtTributaNit1=a.divManagerAltaCuenta.find(".textbox-tributa-nit-1");a.txtTributaNit2=a.divManagerAltaCuenta.find(".textbox-tributa-nit-2");a.txtTributaNit3=a.divManagerAltaCuenta.find(".textbox-tributa-nit-3");a.ddlTributaPais1=a.divManagerAltaCuenta.find(".dropdown-tributa-pais-1");a.ddlTributaPais2=a.divManagerAltaCuenta.find(".dropdown-tributa-pais-2");a.ddlTributaPais3=a.divManagerAltaCuenta.find(".dropdown-tributa-pais-3");a.ddlTributaTipoIdentificadorFiscal1=a.divManagerAltaCuenta.find(".dropdown-tributa-tipo-identificacion-fiscal-1");a.ddlTributaTipoIdentificadorFiscal2=a.divManagerAltaCuenta.find(".dropdown-tributa-tipo-identificacion-fiscal-2");a.ddlTributaTipoIdentificadorFiscal3=a.divManagerAltaCuenta.find(".dropdown-tributa-tipo-identificacion-fiscal-3");a.ddlCantidadResidenciasFiscales=a.divManagerAltaCuenta.find(".dropdown-cantidad-residencias-fiscales");a.divResidenciaFiscal1=a.divManagerAltaCuenta.find(".div-residencia-fiscal-1");a.divResidenciaFiscal2=a.divManagerAltaCuenta.find(".div-residencia-fiscal-2");a.divResidenciaFiscal3=a.divManagerAltaCuenta.find(".div-residencia-fiscal-3");a.chkPoseeBeneficiariosEstadounidenses=a.divManagerAltaCuenta.find(".checkbox-beneficiarios-estadounidenses");a.ddlBeneficiariosEstadounidensesCantidad=a.divManagerAltaCuenta.find(".dropdown-cantidad-beneficiarios-estadounidenses");a.divPoseeBeneficiariosEstadounidenses=a.divManagerAltaCuenta.find(".div-posee-beneficiarios-estadounidenses");a.divBeneficiariosEstadounidensesCantidad=a.divManagerAltaCuenta.find(".div-cantidad-beneficiarios-estadounidenses");a.divBeneficiarioEstadounidense1=a.divManagerAltaCuenta.find(".div-beneficiario-estadounidense-1");a.divBeneficiarioEstadounidense2=a.divManagerAltaCuenta.find(".div-beneficiario-estadounidense-2");a.divBeneficiarioEstadounidense3=a.divManagerAltaCuenta.find(".div-beneficiario-estadounidense-3");a.divBeneficiarioEstadounidense4=a.divManagerAltaCuenta.find(".div-beneficiario-estadounidense-4");a.divBeneficiarioEstadounidense5=a.divManagerAltaCuenta.find(".div-beneficiario-estadounidense-5");a.divBeneficiarioEstadounidense6=a.divManagerAltaCuenta.find(".div-beneficiario-estadounidense-6");a.txtBeneficiarioEstadounidenseNombre1=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-nombre-1");a.txtBeneficiarioEstadounidenseNombre2=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-nombre-2");a.txtBeneficiarioEstadounidenseNombre3=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-nombre-3");a.txtBeneficiarioEstadounidenseNombre4=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-nombre-4");a.txtBeneficiarioEstadounidenseNombre5=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-nombre-5");a.txtBeneficiarioEstadounidenseNombre6=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-nombre-6");a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU1=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-id-contribuyente-eeuu-1");a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU2=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-id-contribuyente-eeuu-2");a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU3=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-id-contribuyente-eeuu-3");a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU4=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-id-contribuyente-eeuu-4");a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU5=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-id-contribuyente-eeuu-5");a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU6=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-id-contribuyente-eeuu-6");a.txtBeneficiarioEstadounidensePorcentajeParticipacion1=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-porcentaje-participacion-1");a.txtBeneficiarioEstadounidensePorcentajeParticipacion2=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-porcentaje-participacion-2");a.txtBeneficiarioEstadounidensePorcentajeParticipacion3=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-porcentaje-participacion-3");a.txtBeneficiarioEstadounidensePorcentajeParticipacion4=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-porcentaje-participacion-4");a.txtBeneficiarioEstadounidensePorcentajeParticipacion5=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-porcentaje-participacion-5");a.txtBeneficiarioEstadounidensePorcentajeParticipacion6=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-porcentaje-participacion-6");a.ddlTipoInstitucionFinancieraExtranjera=a.divManagerAltaCuenta.find(".dropdown-tipo-institucion-financiera-extranjera");a.txtInstitucionFinancieraExtranjeraGIIN=a.divManagerAltaCuenta.find(".textbox-institucion-financiera-extranjera-giin");a.ddlTipoReporteDirectoIRS=a.divManagerAltaCuenta.find(".dropdown-tipo-reporte-directo-irs");a.txtReporteDirectoIRSGIIN=a.divManagerAltaCuenta.find(".textbox-reporte-directo-irs-giin");a.ddlTipoPersonaJuridicaExenta=a.divManagerAltaCuenta.find(".dropdown-tipo-persona-juridica-exenta");a.txtPersonaEstadounidenseTIN=a.divManagerAltaCuenta.find(".textbox-persona-estadounidense-tin");a.divCiudadaniaEEUUCampoAdicional1=a.divManagerAltaCuenta.find(".div-ciudadania-estadounidense-campo-adicional-1");a.divCiudadaniaEEUUCampoAdicional2=a.divManagerAltaCuenta.find(".div-ciudadania-estadounidense-campo-adicional-2");a.divCiudadaniaEEUUCampoAdicional3=a.divManagerAltaCuenta.find(".div-ciudadania-estadounidense-campo-adicional-3");a.divCiudadaniaEEUUCampoAdicional4=a.divManagerAltaCuenta.find(".div-ciudadania-estadounidense-campo-adicional-4");a.divCiudadaniaEEUUCampoAdicional5=a.divManagerAltaCuenta.find(".div-ciudadania-estadounidense-campo-adicional-5");a.ddlCiudadaniaEEUU=a.divManagerAltaCuenta.find(".dropdown-ciudadania-eeuu");a.divCiudadaniaEEUUDeclaracionJurada=a.divManagerAltaCuenta.find(".div-ciudadania-estadounidense-declaracion-jurada");a.chkCiudadaniaEEUUDeclaracionJurada=a.divManagerAltaCuenta.find(".checkbox-ciudadania-estadounidense-declaracion-jurada");a.ddlTipoEntidadCRS=a.divManagerAltaCuenta.find(".dropdown-tipo-entidad-crs");a.divTipoEntidadCRSEntidadInversion=a.divManagerAltaCuenta.find(".div-tipo-entidad-crs-entidad-inversion");a.ddlTipoEntidadCRSEntidadInversion=a.divManagerAltaCuenta.find(".dropdown-tipo-entidad-crs-entidad-inversion");a.divTipoEntidadCRSGiin=a.divManagerAltaCuenta.find(".div-tipo-entidad-crs-giin");a.txtTipoEntidadCRSGiin=a.divManagerAltaCuenta.find(".textbox-tipo-entidad-crs-giin");a.divTipoEntidadCRSMercadoDondeCotiza=a.divManagerAltaCuenta.find(".div-tipo-entidad-crs-mercado-donde-cotiza");a.txtTipoEntidadCRSMercadoDondeCotiza=a.divManagerAltaCuenta.find(".textbox-tipo-entidad-crs-mercado-donde-cotiza");a.divTipoEntidadCRSCompaniaPublicaRelacionada=a.divManagerAltaCuenta.find(".div-tipo-entidad-crs-compania-publica-relacionada");a.txtTipoEntidadCRSCompaniaPublicaRelacionada=a.divManagerAltaCuenta.find(".textbox-tipo-entidad-crs-compania-publica-relacionada");a.divTipoEntidadCRSNombreApellido=a.divManagerAltaCuenta.find(".div-tipo-entidad-crs-nombre-apellido");a.txtTipoEntidadCRSNombreApellido=a.divManagerAltaCuenta.find(".textbox-tipo-entidad-crs-nombre-apellido");a.ddlTipoOcde=a.divManagerAltaCuenta.find(".dropdown-tipo-ocde");a.divTipoOcdeDeclaracionJurada=a.divManagerAltaCuenta.find(".div-tipo-ocde-declaracion-jurada");a.chkTipoOcdeDeclaracionJurada=a.divManagerAltaCuenta.find(".checkbox-tipo-ocde-declaracion-jurada");a.divMontoCompliance=a.container.find(".div-monto-compliance");a.txtMontoCompliance=a.container.find(".textbox-monto-compliance");a.controlMontoCompliance=null;a.ddlRiesgoCliente=a.container.find(".dropdown-riesgo-cliente");a.btnNuevaPersona=a.divManagerAltaCuenta.find(".btn-nueva-persona");a.btnAgregarArchivo=a.divManagerAltaCuenta.find(".btn-agregar-archivo");a.divContainerObservaciones=a.divManagerAltaCuenta.find(".div-container-observaciones");a.gridObservaciones=a.divManagerAltaCuenta.find(".div-observaciones");a.btnAgregarObservacion=a.divManagerAltaCuenta.find(".btn-agregar-observacion");a.btnGuardarYCerrar=a.divManagerAltaCuenta.find(".btn-guardar-cerrar");a.btnRefirmar=a.divManagerAltaCuenta.find(".btn-refirmar");a.btnAnularFirma=a.divManagerAltaCuenta.find(".btn-anular-firma");a.btnFormularioVacio=a.divManagerAltaCuenta.find(".btn-formulario-vacio");a.btnVolver=a.divManagerAltaCuenta.find(".btn-volver");a.gridPersonas=a.divManagerAltaCuenta.find(".div-personas");a.gridArchivos=a.divManagerAltaCuenta.find(".div-archivos");a.btnCalcularMatrizRiesgo=a.container.find(".btn-calcular-matriz-riesgo");a.btnConsultarMatrizRiesgo=a.container.find(".btn-consultar-matriz-riesgo");a.divCalcularMatrizRiesgo=a.container.find(".div-calcular-matriz-riesgo");a.divAlert=a.divManagerAltaCuenta.find(".div-alert");a.divAlert.slideUp();a.initControls()}})};a.initControls=function(){a.divReadOnly.hide();if(a.readOnly){a.divReadOnly.show();a.divVersion.show();if(a.namespaceActivo=="OpenManagerAltaCuenta"){a.divVersion.hide()}}a.divContainerEstado.show();a.divDescripcionEstado.show();a.divContainerObservaciones.show();a.divDescripcionEstado.show();if(!a.idAperturaCuenta){a.btnFormularioVacio.show();a.divContainerEstado.hide();a.divDescripcionEstado.hide();a.divContainerObservaciones.hide();a.divDescripcionEstado.hide()}else{a.btnFormularioVacio.hide()}a.btnAgregarArchivo.show();a.btnNuevaPersona.show();a.btnGuardarYCerrar.show();a.btnAgregarObservacion.show();if(a.readOnly){a.btnAgregarArchivo.hide();a.btnNuevaPersona.hide();a.btnGuardarYCerrar.hide();a.btnFormularioVacio.hide();a.btnAgregarObservacion.hide()}a.btnVolver.show();if(a.namespaceActivo=="OpenManagerAltaCuenta"){a.btnVolver.hide()}a.btnRefirmar.hide();if(!a.readOnly&&a.dataCuenta&&a.dataCuenta.datos[0].refirmar){a.btnRefirmar.show()}a.btnAnularFirma.hide();if(!a.readOnly&&a.dataCuenta&&a.dataCuenta.datos[0].anularFirma){a.btnAnularFirma.show()}a.divAltaCuenta.show();a.divManagerPersona.hide();a.divMatrizRiesgo.hide();a.ddlVersion.shieldDropDown({dataSource:{data:[]},valueTemplate:"{version}",textTemplate:"{version}",events:{select:function(f){var g=a.ddlVersion.swidget().selectedItem().version;a.destroy(false);var e=new Core.Controls.ManagerAltaCuenta({idAperturaCuenta:a.idAperturaCuenta,versionActual:g,optionsApertura:a.optionsApertura,readOnly:a.readOnly,maxVersion:a.maxVersion,namespaceActivo:a.namespaceActivo,onClose:a.onClose,onSave:a.onSave,container:a.container,idDefaultProfile:a.idDefaultProfile,idDefaultAccount:a.idDefaultAccount}).show()}}});Core.Functions.Validations.toggleValidation(a.ddlVersion,false);a.ddlEstado.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idEstadoAperturaCuenta}",textTemplate:"{Nombre}",events:{select:function(e){a.lblEstadoCuenta.text(a.ddlEstado.swidget().selectedItem().Nombre)}}});Core.Functions.Validations.toggleValidation(a.ddlEstado,false);a.ddlAsesor.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idPersona}",textTemplate:"{Nombre}",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}}});Core.Functions.Validations.toggleValidation(a.ddlAsesor,false);a.chkIngresoAsesorFinanciero.shieldCheckBox({label:"Asesor financiero, productor o referido",enabled:false,events:{click:function(f){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.chkIngresoAsesorFinanciero,false);a.txtIngresoAsesorFinanciero.shieldTextBox({value:"",enabled:false});Core.Functions.Validations.toggleValidation(a.txtIngresoAsesorFinanciero,false);if(!a.chkTipoFirmaConjunta.swidget()){a.chkTipoFirmaConjunta.shieldRadioButton({label:"Conjunta"})}Core.Functions.Validations.toggleValidation(a.chkTipoFirmaConjunta,false);if(!a.chkTipoFirmaIndistinta.swidget()){a.chkTipoFirmaIndistinta.shieldRadioButton({label:"Indistinta"})}Core.Functions.Validations.toggleValidation(a.chkTipoFirmaIndistinta,false);a.chkOrigenPatrimonioIngresosOperativos.shieldCheckBox({label:"Ingresos Operativos"});Core.Functions.Validations.toggleValidation(a.chkOrigenPatrimonioIngresosOperativos,false);a.chkOrigenPatrimonioAportesCapital.shieldCheckBox({label:"Aportes de Capital"});Core.Functions.Validations.toggleValidation(a.chkOrigenPatrimonioAportesCapital,false);a.chkOrigenPatrimonioSuscripcionCuotapartes.shieldCheckBox({label:"Suscripción de Cuotapartes"});Core.Functions.Validations.toggleValidation(a.chkOrigenPatrimonioSuscripcionCuotapartes,false);a.chkOrigenPatrimonioVentaActivosFijos.shieldCheckBox({label:"Venta de Activos Fijos"});Core.Functions.Validations.toggleValidation(a.chkOrigenPatrimonioVentaActivosFijos,false);a.chkOrigenPatrimonioDonacion.shieldCheckBox({label:"Donación"});Core.Functions.Validations.toggleValidation(a.chkOrigenPatrimonioDonacion,false);a.chkOrigenPatrimonioInversionesAnteriores.shieldCheckBox({label:"Inversiones Anteriores"});Core.Functions.Validations.toggleValidation(a.chkOrigenPatrimonioInversionesAnteriores,false);a.chkOrigenPatrimonioOtro.shieldCheckBox({label:"Otro",events:{click:function(f){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.chkOrigenPatrimonioOtro,false);a.txtOrigenPatrimonioOtroDetalle.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtOrigenPatrimonioOtroDetalle,false);a.chkFondeoCuentaTransferenciaTitulosCuentaInversion.shieldCheckBox({label:"Transferencia de títulos desde otra cuenta de inversión propia"});Core.Functions.Validations.toggleValidation(a.chkFondeoCuentaTransferenciaTitulosCuentaInversion,false);a.chkFondeoCuentaTransferenciaDineroCuentaInversion.shieldCheckBox({label:"Transferencia de dinero desde otra cuenta de inversión propia"});Core.Functions.Validations.toggleValidation(a.chkFondeoCuentaTransferenciaDineroCuentaInversion,false);a.chkFondeoCuentaTransferenciaDineroBanco.shieldCheckBox({label:"Transferencia de dinero desde una cuenta bancaria propia"});Core.Functions.Validations.toggleValidation(a.chkFondeoCuentaTransferenciaDineroBanco,false);a.chkFondeoCuentaOtro.shieldCheckBox({label:"Otro",events:{click:function(f){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.chkFondeoCuentaOtro,false);a.txtFondeoCuentaOtroDetalle.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtFondeoCuentaOtroDetalle,false);a.txtCantidadTransferenciasHaciaCuentaPorAnio.shieldNumericTextBox({min:0,max:99999,step:1});Core.Functions.Validations.toggleValidation(a.txtCantidadTransferenciasHaciaCuentaPorAnio,false);a.txtPaisesCuentaOrigen.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtPaisesCuentaOrigen,false);a.txtCantidadTransferenciasDesdeCuentaPorAnio.shieldNumericTextBox({min:0,max:99999,step:1});Core.Functions.Validations.toggleValidation(a.txtCantidadTransferenciasDesdeCuentaPorAnio,false);a.txtPaisesCuentaDestino.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtPaisesCuentaDestino,false);a.chkConvenioComitenteAAGI.shieldCheckBox({label:"Mandato Discrecional",enabled:false});Core.Functions.Validations.toggleValidation(a.chkConvenioComitenteAAGI,false);a.txtCanalOtroDetalle.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtCanalOtroDetalle,false);a.txtObjetivoInversionDetallePeriodo.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtObjetivoInversionDetallePeriodo,false);a.ddlArancel.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idArancel}",textTemplate:"{Descripcion}",autoComplete:{enabled:false}});Core.Functions.Validations.toggleValidation(a.ddlArancel,false);a.chkUsarFirmaDigital.shieldCheckBox({label:"Usar firma digital"});Core.Functions.Validations.toggleValidation(a.chkUsarFirmaDigital,false);a.txtComoLlegoABalanz.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtComoLlegoABalanz,false);a.txtUsuarioAsignado.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtUsuarioAsignado,false);a.chkTipoInversionAcciones.shieldCheckBox({label:"Acciones"});Core.Functions.Validations.toggleValidation(a.chkTipoInversionAcciones,false);a.chkTipoInversionFondos.shieldCheckBox({label:"Fondos"});Core.Functions.Validations.toggleValidation(a.chkTipoInversionFondos,false);a.chkTipoInversionOpciones.shieldCheckBox({label:"Opciones"});Core.Functions.Validations.toggleValidation(a.chkTipoInversionOpciones,false);a.chkTipoInversionBonos.shieldCheckBox({label:"Bonos"});Core.Functions.Validations.toggleValidation(a.chkTipoInversionBonos,false);a.chkTipoInversionFuturos.shieldCheckBox({label:"Futuros"});Core.Functions.Validations.toggleValidation(a.chkTipoInversionFuturos,false);a.chkTipoInversionOtro.shieldCheckBox({label:"Otro",events:{click:function(f){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.chkTipoInversionOtro,false);a.txtTipoInversionOtroDetalle.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtTipoInversionOtroDetalle,false);a.chkExperienciaInversionesAcciones.shieldCheckBox({label:"Acciones"});Core.Functions.Validations.toggleValidation(a.chkExperienciaInversionesAcciones,false);a.chkExperienciaInversionesFondos.shieldCheckBox({label:"Fondos"});Core.Functions.Validations.toggleValidation(a.chkExperienciaInversionesFondos,false);a.chkExperienciaInversionesOpciones.shieldCheckBox({label:"Opciones"});Core.Functions.Validations.toggleValidation(a.chkExperienciaInversionesOpciones,false);a.chkExperienciaInversionesBonos.shieldCheckBox({label:"Bonos"});Core.Functions.Validations.toggleValidation(a.chkExperienciaInversionesBonos,false);a.chkExperienciaInversionesFuturos.shieldCheckBox({label:"Futuros"});Core.Functions.Validations.toggleValidation(a.chkExperienciaInversionesFuturos,false);a.chkExperienciaInversionesOtro.shieldCheckBox({label:"Otro",events:{click:function(f){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.chkExperienciaInversionesOtro,false);a.txtExperienciaInversionesOtroDetalle.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtExperienciaInversionesOtroDetalle,false);a.txtPlazoInversion.shieldNumericTextBox({min:0,max:99999,step:1});Core.Functions.Validations.toggleValidation(a.txtPlazoInversion,false);a.txtDescripcionActividadCliente.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtDescripcionActividadCliente,false);a.chkCambiosSignificativosPatrimonio.shieldCheckBox({label:"Hubo cambios significativos en su patrimonio en los ultimos 2 años",events:{click:function(f){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.chkCambiosSignificativosPatrimonio,false);a.txtCambiosSignificativosPatrimonioDetalle.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtCambiosSignificativosPatrimonioDetalle,false);a.txtReferenciaBancariaNombre.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtReferenciaBancariaNombre,false);a.txtReferenciaBancariaApellido.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtReferenciaBancariaApellido,false);a.ddlReferenciaBancariaCargo.shieldDropDown({dataSource:{data:[{value:"Oficial de cuentas"},{value:"Otro"}]},valueTemplate:"{value}",textTemplate:"{value}"});Core.Functions.Validations.toggleValidation(a.ddlReferenciaBancariaCargo,false);a.txtReferenciaBancariaInstitucion.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtReferenciaBancariaInstitucion,false);a.txtReferenciaBancariaTelefono.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtReferenciaBancariaTelefono,false);a.txtReferenciaBancariaEmail.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtReferenciaBancariaEmail,false);a.txtReferenciaBancariaDomicilio.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtReferenciaBancariaDomicilio,false);a.txtReferenciaBancariaCiudad.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtReferenciaBancariaCiudad,false);a.ddlReferenciaBancariaPais.shieldComboBox({dataSource:{data:a.dataParametros.paises},valueTemplate:"{idPais}",textTemplate:"{Nombre}",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{blur:function(f){if(a.ddlReferenciaBancariaPais.swidget().selectedItem()==null){a.ddlReferenciaBancariaPais.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlReferenciaBancariaPais,false);a.chkOrdenesComunicacionesEscrito.shieldCheckBox({label:"POR ESCRITO Deberá enviar orden firmada en original ( Las operaicones seran cursadas unicamente una vez recibido el original por BCI )"});Core.Functions.Validations.toggleValidation(a.chkOrdenesComunicacionesEscrito,false);a.chkOrdenesComunicacionesEmail.shieldCheckBox({label:"POR EMAIL Deberá indicar dirección de e mail para tal fin.",events:{click:function(f){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.chkOrdenesComunicacionesEmail,false);a.txtOrdenesComunicacionesEmail.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtOrdenesComunicacionesEmail,false);a.chkOrdenesComunicacionesConvenioOperacion.shieldCheckBox({label:"CONVENIO DE OPERACIÓN Deberá firmar el CONVENIO DE OPERACIÓN."});Core.Functions.Validations.toggleValidation(a.chkOrdenesComunicacionesConvenioOperacion,false);a.ddlPaisTipoIdentificacionFiscal.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idPais}",textTemplate:"{Nombre}",enabled:false,autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{select:function(e){a.setControls()},blur:function(f){if(a.ddlPaisTipoIdentificacionFiscal.swidget().selectedItem()==null){a.ddlPaisTipoIdentificacionFiscal.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlPaisTipoIdentificacionFiscal,false);a.ddlTipoIdentificacionFiscal.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idTipoIdentificadorFiscal}",textTemplate:"{Descripcion}"});Core.Functions.Validations.toggleValidation(a.ddlTipoIdentificacionFiscal,false);a.txtIdentificacionFiscal.shieldTextBox({value:"",events:{blur:function(){for(var e=0;e<a.personas.length;e++){a.personas[e].pepCUIT=a.txtIdentificacionFiscal.val()}}}});Core.Functions.Validations.toggleValidation(a.txtIdentificacionFiscal,false);a.txtRazonSocial.shieldTextBox({value:"",events:{blur:function(){for(var e=0;e<a.personas.length;e++){a.personas[e].pepDenominacion=a.txtRazonSocial.val()}}}});Core.Functions.Validations.toggleValidation(a.txtRazonSocial,false);a.txtNombreComercial.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtNombreComercial,false);a.ddlNacionalidad.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idPais}",textTemplate:"{Nombre}",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{select:function(e){a.setControls()},blur:function(f){if(a.ddlNacionalidad.swidget().selectedItem()==null){a.ddlNacionalidad.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlNacionalidad,false);a.ddlLugarConstitucion.shieldComboBox({dataSource:{data:[]},valueTemplate:"{Nombre}",textTemplate:"{Nombre}",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{select:function(e){a.setControls()},blur:function(f){if(a.ddlLugarConstitucion.swidget().selectedItem()==null){a.ddlLugarConstitucion.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlLugarConstitucion,false);a.ddlTipoPersonaJuridica.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idTipoPersonaJuridica}",textTemplate:"{Descripcion}"});Core.Functions.Validations.toggleValidation(a.ddlTipoPersonaJuridica,false);a.ddlTipoRegistracionJuridica.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idTipoRegistracionJuridica}",textTemplate:"{Descripcion}"});Core.Functions.Validations.toggleValidation(a.ddlTipoRegistracionJuridica,false);a.txtNumeroInscripcion.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtNumeroInscripcion,false);a.txtFechaConstitucion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date()});Core.Functions.Validations.toggleValidation(a.txtFechaConstitucion,false);a.txtLibro.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtLibro,false);a.txtTomo.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtTomo,false);a.ddlActividadPrincipal.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idActividadJuridica}",textTemplate:"{Descripcion}",events:{select:function(e){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.ddlActividadPrincipal,false);a.txtActividadPrincipalOtro.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtActividadPrincipalOtro,false);a.txtSegmentoInversion.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtSegmentoInversion,false);a.txtNumeroAseguradora.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtNumeroAseguradora,false);a.txtDomicilioLegalCalle.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioLegalCalle,false);a.txtDomicilioLegalNumero.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioLegalNumero,false);a.txtDomicilioLegalPiso.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioLegalPiso,false);a.txtDomicilioLegalDepartamento.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioLegalDepartamento,false);a.ddlDomicilioLegalPais.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idPais}",textTemplate:"{Nombre}",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{select:function(e){a.setControls()},blur:function(f){if(a.ddlDomicilioLegalPais.swidget().selectedItem()==null){a.ddlDomicilioLegalPais.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlDomicilioLegalPais,false);a.ddlDomicilioLegalProvincia.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idProvincia}",textTemplate:"{Nombre}",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{blur:function(f){if(a.ddlDomicilioLegalProvincia.swidget().selectedItem()==null){a.ddlDomicilioLegalProvincia.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlDomicilioLegalProvincia,false);a.txtDomicilioLegalLocalidad.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioLegalLocalidad,false);a.txtDomicilioLegalCodigoPostal.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioLegalCodigoPostal,false);a.ddlEmailNotificacionesCantidad.shieldDropDown({dataSource:{data:[{value:1,text:"1"},{value:2,text:"2"},{value:3,text:"3"},{value:4,text:"4"}]},valueTemplate:"{value}",textTemplate:"{text}",events:{select:function(e){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.ddlEmailNotificacionesCantidad,false);a.txtEmailNotificaciones1.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtEmailNotificaciones1,false);a.txtEmailNotificaciones2.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtEmailNotificaciones2,false);a.txtEmailNotificaciones3.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtEmailNotificaciones3,false);a.txtEmailNotificaciones4.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtEmailNotificaciones4,false);a.txtTelefonoParticularArea.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularArea,false);a.txtTelefonoParticularNumero.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularNumero,false);var d=[];Core.Objects.Contry.forEach(function(e){d.push({value:e.phone_code,text:"(+"+e.phone_code+") "+e.name})});a.ddlTelefonoCelularPais.shieldDropDown({dataSource:{data:d},valueTemplate:"{value}",textTemplate:"{text}",value:"",events:{select:function(e){a.setTelefonoCelularControls()},blur:function(f){if(a.ddlTelefonoCelularPais.swidget().selectedItem()==null){a.ddlTelefonoCelularPais.swidget().value(null)}}}});a.txtTelefonoCelularArea.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularArea,false);a.txtTelefonoCelularNumero.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularNumero,false);a.ddlTributaPais1.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idPais}",textTemplate:"{Nombre}",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{select:function(e){a.setControls()},blur:function(f){if(a.ddlTributaPais1.swidget().selectedItem()==null){a.ddlTributaPais1.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlTributaPais1,false);a.ddlTributaPais2.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idPais}",textTemplate:"{Nombre}",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{select:function(e){a.setControls()},blur:function(f){if(a.ddlTributaPais2.swidget().selectedItem()==null){a.ddlTributaPais2.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlTributaPais2,false);a.ddlTributaPais3.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idPais}",textTemplate:"{Nombre}",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{select:function(e){a.setControls()},blur:function(f){if(a.ddlTributaPais3.swidget().selectedItem()==null){a.ddlTributaPais3.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlTributaPais3,false);a.txtTributaNit1.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtTributaNit1,false);a.txtTributaNit2.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtTributaNit2,false);a.txtTributaNit3.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtTributaNit3,false);a.ddlTributaTipoIdentificadorFiscal1.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idTipoIdentificadorFiscal}",textTemplate:"{Descripcion}"});Core.Functions.Validations.toggleValidation(a.ddlTributaTipoIdentificadorFiscal1,false);a.ddlTributaTipoIdentificadorFiscal2.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idTipoIdentificadorFiscal}",textTemplate:"{Descripcion}"});Core.Functions.Validations.toggleValidation(a.ddlTributaTipoIdentificadorFiscal2,false);a.ddlTributaTipoIdentificadorFiscal3.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idTipoIdentificadorFiscal}",textTemplate:"{Descripcion}"});Core.Functions.Validations.toggleValidation(a.ddlTributaTipoIdentificadorFiscal3,false);a.ddlCantidadResidenciasFiscales.shieldDropDown({dataSource:{data:[{value:1,text:"1"},{value:2,text:"2"},{value:3,text:"3"}]},valueTemplate:"{value}",textTemplate:"{text}",events:{select:function(e){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.ddlCantidadResidenciasFiscales,false);a.txtBeneficiarioEstadounidenseNombre1.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseNombre1,false);a.txtBeneficiarioEstadounidenseNombre2.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseNombre2,false);a.txtBeneficiarioEstadounidenseNombre3.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseNombre3,false);a.txtBeneficiarioEstadounidenseNombre4.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseNombre4,false);a.txtBeneficiarioEstadounidenseNombre5.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseNombre5,false);a.txtBeneficiarioEstadounidenseNombre6.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseNombre6,false);a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU1.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU1,false);a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU2.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU2,false);a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU3.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU3,false);a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU4.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU4,false);a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU5.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU5,false);a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU6.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU6,false);a.controlBeneficiarioEstadounidensePorcentajeParticipacion1=new Core.Controls.DecimalPicker(a.txtBeneficiarioEstadounidensePorcentajeParticipacion1,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion1,false);a.controlBeneficiarioEstadounidensePorcentajeParticipacion2=new Core.Controls.DecimalPicker(a.txtBeneficiarioEstadounidensePorcentajeParticipacion2,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion2,false);a.controlBeneficiarioEstadounidensePorcentajeParticipacion3=new Core.Controls.DecimalPicker(a.txtBeneficiarioEstadounidensePorcentajeParticipacion3,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion3,false);a.controlBeneficiarioEstadounidensePorcentajeParticipacion4=new Core.Controls.DecimalPicker(a.txtBeneficiarioEstadounidensePorcentajeParticipacion4,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion4,false);a.controlBeneficiarioEstadounidensePorcentajeParticipacion5=new Core.Controls.DecimalPicker(a.txtBeneficiarioEstadounidensePorcentajeParticipacion5,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion5,false);a.controlBeneficiarioEstadounidensePorcentajeParticipacion6=new Core.Controls.DecimalPicker(a.txtBeneficiarioEstadounidensePorcentajeParticipacion6,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion6,false);a.chkPoseeBeneficiariosEstadounidenses.shieldCheckBox({label:"Posee beneficiarios finales con intereses estadounidenses sustanciales",events:{click:function(f){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.chkPoseeBeneficiariosEstadounidenses,false);a.ddlBeneficiariosEstadounidensesCantidad.shieldDropDown({dataSource:{data:[{value:1,text:"1"},{value:2,text:"2"},{value:3,text:"3"},{value:4,text:"4"},{value:5,text:"5"},{value:6,text:"6"}]},valueTemplate:"{value}",textTemplate:"{text}",events:{select:function(e){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.ddlBeneficiariosEstadounidensesCantidad,false);a.ddlTipoInstitucionFinancieraExtranjera.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idTipoInstitucionFinancieraExtranjera}",textTemplate:"{Descripcion}"});Core.Functions.Validations.toggleValidation(a.ddlTipoInstitucionFinancieraExtranjera,false);a.txtInstitucionFinancieraExtranjeraGIIN.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtInstitucionFinancieraExtranjeraGIIN,false);a.ddlTipoReporteDirectoIRS.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idReporteDirectoIRS}",textTemplate:"{Descripcion}"});Core.Functions.Validations.toggleValidation(a.ddlTipoReporteDirectoIRS,false);a.txtReporteDirectoIRSGIIN.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtReporteDirectoIRSGIIN,false);a.txtPersonaEstadounidenseTIN.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtPersonaEstadounidenseTIN,false);a.ddlTipoPersonaJuridicaExenta.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idPersonaJuridicaExenta}",textTemplate:"{Descripcion}"});Core.Functions.Validations.toggleValidation(a.ddlTipoPersonaJuridicaExenta,false);a.ddlCiudadaniaEEUU.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idTipoFATCA}",textTemplate:"{Descripcion}",events:{select:function(e){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.ddlCiudadaniaEEUU,false);a.ddlTipoEntidadCRS.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idTipoEntidadCRS}",textTemplate:"{Descripcion}",events:{select:function(e){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.ddlTipoEntidadCRS,false);a.ddlTipoEntidadCRSEntidadInversion.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idTipoEntidadCRSTipoEntidadInversion}",textTemplate:"{Descripcion}",events:{select:function(e){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.ddlTipoEntidadCRSEntidadInversion,false);a.txtTipoEntidadCRSGiin.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtTipoEntidadCRSGiin,false);a.txtTipoEntidadCRSMercadoDondeCotiza.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtTipoEntidadCRSMercadoDondeCotiza,false);a.txtTipoEntidadCRSCompaniaPublicaRelacionada.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtTipoEntidadCRSCompaniaPublicaRelacionada,false);a.txtTipoEntidadCRSNombreApellido.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtTipoEntidadCRSNombreApellido,false);a.ddlTipoOcde.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idTipoOCDE}",textTemplate:"{Descripcion}",events:{select:function(e){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.ddlTipoOcde,false);a.controlMontoCompliance=new Core.Controls.DecimalPicker(a.txtMontoCompliance,{maxDecimalDigitCount:2,showThousandsSeparator:false});Core.Functions.Validations.toggleValidation(a.txtMontoCompliance,false);a.divMontoCompliance.hide();if(Core.Objects.Context.Configuration.idAplicacion==3){a.divMontoCompliance.show()}a.ddlRiesgoCliente.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idRiesgo}",textTemplate:"{RiesgoDescripcion}"});Core.Functions.Validations.toggleValidation(a.ddlRiesgoCliente,false);a.btnAgregarArchivo.unbind("click");a.btnAgregarArchivo.on("click",function(){var e=new Core.Controls.ManagerAltaCuentaNuevoArchivo({onSave:function(g){a.archivos.push({urlArchivo:g.file.urlArchivo,idTipoArchivo:g.idTipoArchivo,Tipo:g.Tipo,Fecha:g.Fecha,Comentario:g.comentarios});var f=a.gridArchivos.swidget().initialOptions;f.dataSource.data=a.archivos;a.gridArchivos.swidget().refresh(f)},tiposArchivos:((a.dataParametros!=null)?$.grep(a.dataParametros.TiposArchivos,function(g,f){return g.Juridica&&g.BCI}):[])}).show()});a.btnNuevaPersona.unbind("click");a.btnNuevaPersona.on("click",function(){a.divAltaCuenta.hide();a.divManagerPersona.show();a.divMatrizRiesgo.hide();var e=new Core.Controls.ManagerPersonaBCI({container:a.divManagerPersona,divMatrizRiesgo:a.divMatrizRiesgo,namespaceActivo:a.namespaceActivo,idTipoValidacion:(a.dataCuenta&&a.ddlEstado.swidget().selectedItem())?a.ddlEstado.swidget().selectedItem().idTipoValidacion:0,dataParametros:a.dataParametros,dataParametrosUsuario:a.dataParametrosUsuario,optionsApertura:a.optionsApertura,idAperturaCuenta:a.idAperturaCuenta,esCuentaJuridica:true,defaultPersonaExpuestaDenominacion:a.txtRazonSocial.val(),defaultPersonaExpuestaCuit:a.txtIdentificacionFiscal.val(),onSave:function(h){var g=a.getMaxNumero(h.tipo);h.numero=g+1;a.personas.push(h);var f=a.gridPersonas.swidget().initialOptions;f.dataSource.data=a.personas;a.gridPersonas.swidget().refresh(f);return true},onClose:function(){a.divAltaCuenta.show();a.divManagerPersona.hide();a.divMatrizRiesgo.hide()}}).show()});a.btnCalcularMatrizRiesgo.unbind("click");a.btnCalcularMatrizRiesgo.click(function(){a.divAltaCuenta.hide();a.divManagerPersona.hide();a.divMatrizRiesgo.show();var e=new Core.Controls.ManagerMatrizRiesgoBCI({container:a.divMatrizRiesgo,dataParametrosUsuario:a.dataParametrosUsuario,calcularMatriz:true,consultarMatriz:false,cuilCuit:a.dataCuenta.juridica[0].CUIT,idAperturaCuenta:a.idAperturaCuenta,tipo:0,numero:0,readOnly:a.readOnly,optionsApertura:a.optionsApertura,onSave:function(h,f){a.controlMontoCompliance.setValue(h);if(f){var g=a.ddlRiesgoCliente.swidget().initialOptions;g.value=f.toString();a.ddlRiesgoCliente.swidget().refresh(g)}},onClose:function(){a.divAltaCuenta.show();a.divManagerPersona.hide();a.divMatrizRiesgo.hide()}}).show()});a.btnConsultarMatrizRiesgo.unbind("click");a.btnConsultarMatrizRiesgo.click(function(){a.divAltaCuenta.hide();a.divManagerPersona.hide();a.divMatrizRiesgo.show();var e=new Core.Controls.ManagerMatrizRiesgoBCI({container:a.divMatrizRiesgo,dataParametrosUsuario:a.dataParametrosUsuario,calcularMatriz:false,consultarMatriz:true,cuilCuit:a.dataCuenta.juridica[0].CUIT,idAperturaCuenta:a.idAperturaCuenta,tipo:0,numero:0,readOnly:a.readOnly,optionsApertura:a.optionsApertura,onSave:function(h,f){a.controlMontoCompliance.setValue(h);if(f){var g=a.ddlRiesgoCliente.swidget().initialOptions;g.value=f.toString();a.ddlRiesgoCliente.swidget().refresh(g)}},onClose:function(){a.divAltaCuenta.show();a.divManagerPersona.hide();a.divMatrizRiesgo.hide()}}).show()});a.btnAgregarObservacion.unbind("click");a.btnAgregarObservacion.on("click",function(){new Core.Controls.Prompt("Nueva Observación","Ingrese la observación",{onAccepted:function(e){var f=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"apertura/cuenta/observacion/"+a.idAperturaCuenta,requestType:"POST",requestData:{observacion:e}});f.onSuccess=function(h){a.observaciones=h.observaciones;var g=a.gridObservaciones.swidget().initialOptions;g.dataSource.data=a.observaciones;a.gridObservaciones.swidget().refresh(g)};f.request()}}).show()});a.btnVolver.unbind("click");a.btnVolver.on("click",function(){a.destroy(true)});a.btnGuardarYCerrar.unbind("click");a.btnGuardarYCerrar.on("click",function(){var e=a.getRequestData();if(e!=null){var f=new Core.Ajax.ServerRequest({showOverlay:true,requestUrl:"apertura/cuenta",requestType:"POST",requestData:e});f.onSuccess=function(g){if(a.onSave){a.onSave(g.idAperturaCuenta,g.version)}a.destroy(true)};f.request()}else{$("html, body").animate({scrollTop:$(".cuenta").offset().top},1000)}});a.btnRefirmar.unbind("click");a.btnRefirmar.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea Reenviar el mail de firma? Esta acción reenviará los mails con los links para la firma digital a todos aquellos destinatarios que aún no hayan firmado.",{onAccepted:function(){var e=new Core.Ajax.ServerRequest({overlayElement:a.btnRefirmar,secureRequest:true,requestUrl:"apertura/cuenta/refirmar",requestType:"POST",requestData:{idAperturaCuenta:a.idAperturaCuenta}});e.onSuccess=function(){if(a.onSave){a.onSave(a.dataCuenta.datos[0].idAperturaCuenta,a.dataCuenta.datos[0].version)}a.destroy(true)};e.request()}}).show()});a.btnAnularFirma.unbind("click");a.btnAnularFirma.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea Anular la Firma de esta Apertura? Esta acción desestimará la última firma completa que tenga esta apertura, requiriendo que se deba volver a firmar por el cliente.",{onAccepted:function(){var e=new Core.Ajax.ServerRequest({overlayElement:a.btnAnularFirma,secureRequest:true,requestUrl:"apertura/cuenta/anularfirma",requestType:"POST",requestData:{idAperturaCuenta:a.idAperturaCuenta}});e.onSuccess=function(f){new Core.Controls.Dialog("Aviso",(f.Descripcion?f.Descripcion:"Operación realizada con éxito."),{displayButtons:{close:true,accept:false}}).show()};e.request()}}).show()});a.btnFormularioVacio.unbind("click");a.btnFormularioVacio.on("click",function(){if(a.dataParametrosUsuario&&a.dataParametrosUsuario.Links&&a.dataParametrosUsuario.Links[0].FormularioJuridicaVacio){window.open(a.dataParametrosUsuario.Links[0].FormularioJuridicaVacio,"_blank")}});var c=[{width:"25%",field:"nombre",title:"Nombre",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"25%",field:"apellido",title:"Apellido",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"25%",field:"tipo",title:"Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,g){e.html("<span>"+a.getTipoDescripcion(f.tipo)+"</span>")}},{width:"25%",field:"numero",title:"Número",headerAttributes:Core.Functions.grid.getCellOddClass()},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){if(f.tienePruebaDeVida){var g=$('<button disabled type="button" title="Prueba de Vida" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/prueba-de-vida.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color",f.tienePruebaDeVida)}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){if(f.tieneMatchCara){var g=$('<button disabled type="button" title="Match de Cara" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/match-cara.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color",f.tieneMatchCara);if(a.optionsApertura&&a.optionsApertura.consultaICAR){g.removeAttr("disabled");g.on("click",function(){Core.Functions.ExternalServices.Icar.showReport(g,a.idAperturaCuenta,f.tipo,f.numero)})}}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){if(f.tieneDatosPrecargados){var g=$('<button disabled type="button" title="Datos Precargados" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/datos-precargados.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color",f.tieneDatosPrecargados);if(a.optionsApertura&&a.optionsApertura.consultaICAR){g.removeAttr("disabled");g.on("click",function(){Core.Functions.ExternalServices.Icar.showReport(g,a.idAperturaCuenta,f.tipo,f.numero)})}}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){if(f.tieneReuters){var g=$('<button disabled type="button" title="Reuters" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/reuters-logo.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color",f.tieneReuters);if(a.optionsApertura&&a.optionsApertura.consultaReuters){g.removeAttr("disabled");g.on("click",function(){Core.Functions.ExternalServices.Reuters.showReport(g,f.documento,encodeURIComponent(f.nombre.toLowerCase()+" "+f.apellido.toLowerCase()),f.sexo,f.fechaNacimiento,f.nacionalidad)})}}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){if(f.tieneNOSIS){var g=$('<button disabled type="button" title="Nosis" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/nosis-logo.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color",f.tieneNOSIS);if(a.optionsApertura&&a.optionsApertura.consultaNosis){g.removeAttr("disabled");g.on("click",function(){Core.Functions.ExternalServices.Nosis.showReport(g,f.cuit_cuil)})}}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){if(f.tieneRenaper){var g=$('<button disabled type="button" title="Renaper" class="btn-sm balanz-button"style="border:3px solid; background-color:#fff;"><img src="/images/renaper-logo.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color",f.tieneRenaper);if(a.optionsApertura&&a.optionsApertura.consultaRenaper){g.removeAttr("disabled");g.on("click",function(){Core.Functions.ExternalServices.Renaper.showReport(g,f.documento,f.idTipoDocumento,f.sexo)})}}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){if(f.tieneUIF){var g=$('<button disabled type="button" title="UIF" class="btn-sm balanz-button"style="border:3px solid; background-color:#fff;"><img src="/images/uif-logo.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color",f.tieneUIF);if(a.optionsApertura&&a.optionsApertura.consultaUIF){g.removeAttr("disabled");g.on("click",function(){Core.Functions.ExternalServices.UIF.showReport(g,f.cuit_cuil)})}}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){var g=$('<button disabled type="button" title="Google" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/google-logo.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color","lightgreen");if(a.optionsApertura&&a.optionsApertura.consultaGoogle){g.removeAttr("disabled");g.on("click",function(){a.openUrlGoogle(f.nombre+"+"+f.apellido)})}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(f,g,h){var e=$('<button type="button" title="Editar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(f);e.on("click",function(){a.divAltaCuenta.hide();a.divManagerPersona.show();a.divMatrizRiesgo.hide();var j=a.personas[h];j.pepCUIT=a.txtIdentificacionFiscal.val();j.pepDenominacion=a.txtRazonSocial.val();var i=new Core.Controls.ManagerPersonaBCI({container:a.divManagerPersona,divMatrizRiesgo:a.divMatrizRiesgo,namespaceActivo:a.namespaceActivo,idTipoValidacion:(a.dataCuenta&&a.ddlEstado.swidget().selectedItem())?a.ddlEstado.swidget().selectedItem().idTipoValidacion:0,persona:j,dataParametros:a.dataParametros,dataParametrosUsuario:a.dataParametrosUsuario,optionsApertura:a.optionsApertura,idAperturaCuenta:a.idAperturaCuenta,readOnly:a.readOnly,esCuentaJuridica:true,onSave:function(k){a.personas[h]=k;a.refreshNumeroPersonas();return true},onClose:function(){a.divAltaCuenta.show();a.divManagerPersona.hide();a.divMatrizRiesgo.hide()}}).show()})}}];if(!a.readOnly){c.push({width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(f,g,h){var e=$('<button type="button" title="Eliminar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(f);e.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar la persona: "+g.nombre+" "+g.apellido+"?",{onAccepted:function(){a.personas.remove(a.personas[h]);a.refreshNumeroPersonas()}}).show()})}})}a.gridPersonas.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:c});a.gridArchivos.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},columns:[{width:"25%",field:"Fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"25%",field:"Tipo",title:"Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"50%",field:"Comentario",title:"Comentario",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:100,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(g,h,i){if(a.namespaceActivo!="ReporteAperturas"||(a.optionsApertura&&a.optionsApertura.descargarArchivosApertura)){var e=$('<button type="button" title="Descargar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>').appendTo(g);e.on("click",function(){window.open(Core.Origin+Core.Functions.Context.getPathname()+h.urlArchivo)})}if(!a.readOnly){var f=$('<button type="button" title="Eliminar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(g);f.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar el archivo?",{onAccepted:function(){a.archivos=$.grep(a.archivos,function(l,k){return l.urlArchivo!=h.urlArchivo||l.Fecha!=h.Fecha||l.Tipo!=h.Tipo||l.Comentario!=h.Comentario});var j=a.gridArchivos.swidget().initialOptions;j.dataSource.data=a.archivos;a.gridArchivos.swidget().refresh(j)}}).show()})}}}]});a.gridObservaciones.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},columns:[{width:"25%",field:"Fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"25%",field:"username",title:"Usuario",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"50%",field:"Observacion",title:"Observación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString}]});a.getData()};a.getData=function(){a.personas=a.dataCuenta!=null?a.dataCuenta.personas:[];a.archivos=a.dataCuenta!=null?a.dataCuenta.archivos:[];a.observaciones=a.dataCuenta!=null?a.dataCuenta.observaciones:[];a.loadControls()};a.loadControls=function(){if(a.readOnly){var I=[];for(var p=1;p<=a.maxVersion;p++){I.push({version:p})}var x=a.ddlVersion.swidget().initialOptions;x.dataSource.data=I;x.value=a.versionActual.toString();a.ddlVersion.swidget().refresh(x)}a.divMontoInvertirContainer.html("");a.dataParametros.MontoAInvertirJuridicas.forEach(function(L,K){if(L.habilitado&&L.PA){var J=$("<div></div>").appendTo(a.divMontoInvertirContainer);var i=$('<input class="form-control sui-input monto-a-invertir-juridica-option" type="radio" name="MontoAInvertirJuridica" idMontoAInvertirJuridica="'+L.idMontoAInvertirJuridica+'">').appendTo(J);i.shieldRadioButton({label:L.Descripcion})}});a.divIngresosAnualesContainer.html("");a.dataParametros.IngresosAnuales.forEach(function(L,K){if(L.habilitado&&L.PA){var J=$("<div></div>").appendTo(a.divIngresosAnualesContainer);var i=$('<input class="form-control sui-input ingresos-anuales-option" type="radio" name="IngresosAnuales" idIngresosAnuales="'+L.IngresosAnuales+'" id="ingresosAnuales_'+L.IngresosAnuales+'">').appendTo(J);i.shieldRadioButton({label:L.Descripcion})}});a.divPatrimonioNetoContainer.html("");a.dataParametros.PatrimoniosNetos.forEach(function(L,K){if(L.habilitado&&L.PA){var J=$("<div></div>").appendTo(a.divPatrimonioNetoContainer);var i=$('<input class="form-control sui-input patrimonio-neto-option" type="radio" name="PatrimonioNeto" idPatromonioNeto="'+L.PatrimonioNeto+'" id="patrimonioNeto_'+L.PatrimonioNeto+'">').appendTo(J);i.shieldRadioButton({label:L.Descripcion})}});a.divExperienciaInversionesNivelContainer.html("");a.dataParametros.NivelesExperienciaInversiones.forEach(function(L,K){if(L.habilitado&&L.PA){var J=$("<div></div>").appendTo(a.divExperienciaInversionesNivelContainer);var i=$('<input class="form-control sui-input experiencia-inversiones-nivel-option" type="radio" name="ExperienciaInversionesNivel" idNivelExperienciaInversion="'+L.idNivelExperienciaInversion+'" id="nivelExperienciaInversion'+L.idRelacionInversionPatrimonio+'">').appendTo(J);i.shieldRadioButton({label:L.Descripcion})}});a.divRelacionInversionPatrimonioContainer.html("");a.dataParametros.RelacionesInversionPatrimonio.forEach(function(L,K){if(L.habilitado&&L.PA){var J=$("<div></div>").appendTo(a.divRelacionInversionPatrimonioContainer);var i=$('<input class="form-control sui-input relacion-inversion-patrimonio-option" type="radio" name="RelacionInversionPatrimonio" idRelacionInversionPatrimonio="'+L.idRelacionInversionPatrimonio+'" id="relacionInversionPatrimonio'+L.idRelacionInversionPatrimonio+'">').appendTo(J);i.shieldRadioButton({label:L.Descripcion})}});a.divObjetivoInversionContainer.html("");a.dataParametros.ObjetivosDeInversion.forEach(function(L,K){if(L.habilitado&&L.PA){var J=$("<div></div>").appendTo(a.divObjetivoInversionContainer);var i=$('<input class="form-control sui-input objetivo-inversion-option" type="radio" name="ObjetivoInversion" idObjetivoInversion="'+L.idObjetivoInversion+'" id="objetivoInversion'+L.idObjetivoInversion+'">').appendTo(J);i.shieldRadioButton({label:L.Descripcion,events:{click:function(M){a.setControls()}}})}});a.divNivelToleranciaRiesgoContainer.html("");a.dataParametros.NivelesToleranciaAlRiesgo.forEach(function(L,K){if(L.habilitado&&L.PA){var J=$("<div></div>").appendTo(a.divNivelToleranciaRiesgoContainer);var i=$('<input class="form-control sui-input nivel-tolerancia-riesgo-option" type="radio" name="NivelToleranciaRiesgo" idNivelToleranciaAlRiesgo="'+L.idNivelToleranciaAlRiesgo+'" id="nivelToleranciaAlRiesgo'+L.idNivelToleranciaAlRiesgo+'">').appendTo(J);i.shieldRadioButton({label:L.Descripcion})}});a.divCanalContainer.html("");if(a.dataParametrosUsuario&&a.dataParametrosUsuario.canalDeVenta){a.dataParametrosUsuario.canalDeVenta.forEach(function(K,J){var i=$('<input type="radio" class="form-control sui-input chk-canal-option" name="option-canal" idCanalDeVenta="'+K.idCanalDeVenta+'">').appendTo(a.divCanalContainer);i.shieldRadioButton({label:K.Descripcion,events:{click:function(L){a.setControls()}}})})}var x=a.ddlAsesor.swidget().initialOptions;x.dataSource.data=(a.dataParametrosUsuario!=null)?a.dataParametrosUsuario.asesores:[];if(a.dataCuenta!=null&&a.dataCuenta.datos[0].idPersonaAsesor!=null){x.value=a.dataCuenta.datos[0].idPersonaAsesor.toString()}a.ddlAsesor.swidget().refresh(x);var x=a.ddlEstado.swidget().initialOptions;x.dataSource.data=(a.dataCuenta!=null)?a.dataCuenta.estados:[];if(a.dataCuenta!=null&&a.dataCuenta.datos[0].idEstadoAperturaCuenta!=null){x.value=a.dataCuenta.datos[0].idEstadoAperturaCuenta.toString()}a.ddlEstado.swidget().refresh(x);if(a.ddlEstado.swidget().selectedItem()){a.lblEstadoCuenta.text(a.ddlEstado.swidget().selectedItem().Nombre)}var C=a.chkTipoFirmaConjunta.swidget().initialOptions;C.checked=(a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoFirma==Core.Business.eTipoFirma.Conjunta)?true:false;a.chkTipoFirmaConjunta.swidget().refresh(C);var C=a.chkTipoFirmaIndistinta.swidget().initialOptions;C.checked=(a.dataCuenta==null||(a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoFirma==Core.Business.eTipoFirma.Indistinta))?true:false;a.chkTipoFirmaIndistinta.swidget().refresh(C);a.chkIngresoAsesorFinanciero.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].contactoOriginal)?true:false));a.chkUsarFirmaDigital.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].UsarFirmaDigital)?true:false));a.divUsarFirmaDigital.hide();if(a.dataCuenta!=null&&a.dataCuenta.datos[0].habilitarFirmaDigital){a.divUsarFirmaDigital.show()}var x=a.txtIngresoAsesorFinanciero.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].contactoOriginal)?a.dataCuenta.datos[0].contactoOriginal:"";a.txtIngresoAsesorFinanciero.swidget().refresh(x);if(a.dataCuenta!=null){var g=$(".monto-a-invertir-juridica-option");var z=false;for(var p=0;p<g.length;p++){var c=$(g[p]);var C=c.swidget().initialOptions;C.checked=(c.attr("idMontoAInvertirJuridica")==a.dataCuenta.juridica[0].idMontoAInvertirJuridica);if(!z){z=(c.attr("idMontoAInvertirJuridica")==a.dataCuenta.juridica[0].idMontoAInvertirJuridica)}c.swidget().refresh(C)}if(!z&&a.dataCuenta.juridica[0].montoAInvertirJuridicaDescripcion){a.lblMontoInvertirAlert.html("<br />(El cliente eligió: "+a.dataCuenta.juridica[0].montoAInvertirJuridicaDescripcion+")")}var f=$(".ingresos-anuales-option");var w=false;for(var p=0;p<f.length;p++){var c=$(f[p]);var C=c.swidget().initialOptions;C.checked=(c.attr("idIngresosAnuales")==a.dataCuenta.datos[0].ingresosAnuales);if(!w){w=(c.attr("idIngresosAnuales")==a.dataCuenta.datos[0].ingresosAnuales)}c.swidget().refresh(C)}if(!w&&a.dataCuenta.datos[0].ingresosAnualesDescripcion){a.lblIngresosAnualesAlert.html("<br />(El cliente eligió: "+a.dataCuenta.datos[0].ingresosAnualesDescripcion+")")}var k=$(".patrimonio-neto-option");var D=false;for(var p=0;p<k.length;p++){var c=$(k[p]);var C=c.swidget().initialOptions;C.checked=(c.attr("idPatromonioNeto")==a.dataCuenta.datos[0].patrimonioNeto);if(!D){D=(c.attr("idPatromonioNeto")==a.dataCuenta.datos[0].patrimonioNeto)}c.swidget().refresh(C)}if(!D&&a.dataCuenta.datos[0].patrimonioNetoDescripcion){a.lblPatrimonioNetoAlert.html("<br />(El cliente eligió: "+a.dataCuenta.datos[0].patrimonioNetoDescripcion+")")}var e=$(".experiencia-inversiones-nivel-option");var o=false;for(var p=0;p<e.length;p++){var c=$(e[p]);var C=c.swidget().initialOptions;C.checked=(c.attr("idNivelExperienciaInversion")==a.dataCuenta.datos[0].idNivelExperienciaInversion);if(!o){o=(c.attr("idNivelExperienciaInversion ")==a.dataCuenta.datos[0].idNivelExperienciaInversion)}c.swidget().refresh(C)}if(!o&&a.dataCuenta.datos[0].idNivelExperienciaInversion){a.lblExperienciaInversionesNivelAlert.html("<br />(El cliente eligió: "+a.dataCuenta.datos[0].nivelExperienciaInversionDescripcion+")")}var l=$(".relacion-inversion-patrimonio-option");var E=false;for(var p=0;p<l.length;p++){var c=$(l[p]);var C=c.swidget().initialOptions;C.checked=(c.attr("idRelacionInversionPatrimonio")==a.dataCuenta.datos[0].idRelacionInversionPatrimonio);if(!E){E=(c.attr("idRelacionInversionPatrimonio ")==a.dataCuenta.datos[0].idRelacionInversionPatrimonio)}c.swidget().refresh(C)}if(!E&&a.dataCuenta.datos[0].idRelacionInversionPatrimonio){a.lblRelacionInversionPatrimonioAlert.html("<br />(El cliente eligió: "+a.dataCuenta.datos[0].relacionInversionPatrimonioDescripcion+")")}var j=$(".objetivo-inversion-option");var B=false;for(var p=0;p<j.length;p++){var c=$(j[p]);var C=c.swidget().initialOptions;C.checked=(c.attr("idObjetivoInversion")==a.dataCuenta.datos[0].idObjetivoInversion);if(!B){B=(c.attr("idObjetivoInversion")==a.dataCuenta.datos[0].idObjetivoInversion)}c.swidget().refresh(C)}if(!B&&a.dataCuenta.datos[0].idObjetivoInversion){a.lblObjetivoInversionAlert.html("<br />(El cliente eligió: "+a.dataCuenta.datos[0].objetivoInversionDescripcion+")")}var h=$(".nivel-tolerancia-riesgo-option");var A=false;for(var p=0;p<h.length;p++){var c=$(h[p]);var C=c.swidget().initialOptions;C.checked=(c.attr("idNivelToleranciaAlRiesgo")==a.dataCuenta.datos[0].idNivelToleranciaAlRiesgo);if(!A){A=(c.attr("idNivelToleranciaAlRiesgo")==a.dataCuenta.datos[0].idNivelToleranciaAlRiesgo)}c.swidget().refresh(C)}if(!A&&a.dataCuenta.datos[0].idNivelToleranciaAlRiesgo){a.lblNivelToleranciaRiesgoAlert.html("<br />(El cliente eligió: "+a.dataCuenta.datos[0].nivelToleranciaAlRiesgoDescripcion+")")}var d=$(".chk-canal-option");for(var p=0;p<d.length;p++){var c=$(d[p]);var C=c.swidget().initialOptions;C.checked=(c.attr("idCanalDeVenta")==a.dataCuenta.datos[0].idCanal);c.swidget().refresh(C)}}a.chkOrigenPatrimonioIngresosOperativos.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].PatrimonioIngresosOperativos)?true:false));a.chkOrigenPatrimonioAportesCapital.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].PatrimonioAportesDeCapital)?true:false));a.chkOrigenPatrimonioSuscripcionCuotapartes.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].PatrimonioSuscripcionCuotaspartes)?true:false));a.chkOrigenPatrimonioVentaActivosFijos.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].PatrimonioVentaDeActivosFijos)?true:false));a.chkOrigenPatrimonioDonacion.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].PatrimonioDonacion)?true:false));a.chkOrigenPatrimonioInversionesAnteriores.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].PatrimonioInversionesAnteriores)?true:false));a.chkOrigenPatrimonioOtro.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].patrimonioOtro)?true:false));var x=a.txtOrigenPatrimonioOtroDetalle.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].patrimonioOtro)?a.dataCuenta.datos[0].patrimonioOtro:"";a.txtOrigenPatrimonioOtroDetalle.swidget().refresh(x);a.chkFondeoCuentaTransferenciaTitulosCuentaInversion.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].FondeoCuentaTransferenciaTitulosCuentaInversion)?true:false));a.chkFondeoCuentaTransferenciaDineroCuentaInversion.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].FondeoCuentaTransferenciaDineroCuentaInversion)?true:false));a.chkFondeoCuentaTransferenciaDineroBanco.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].FondeoCuentaTransferenciaDineroBanco)?true:false));a.chkFondeoCuentaOtro.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].FondeoCuentaOtros)?true:false));var x=a.txtFondeoCuentaOtroDetalle.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].FondeoCuentaOtros)?a.dataCuenta.datos[0].FondeoCuentaOtros:"";a.txtFondeoCuentaOtroDetalle.swidget().refresh(x);var x=a.txtCantidadTransferenciasDesdeCuentaPorAnio.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].CantidadTransferenciaDesdeCuentaInversion)?a.dataCuenta.datos[0].CantidadTransferenciaDesdeCuentaInversion:"";a.txtCantidadTransferenciasDesdeCuentaPorAnio.swidget().refresh(x);var x=a.txtPaisesCuentaOrigen.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].PaisesOrigenTransferencias)?a.dataCuenta.datos[0].PaisesOrigenTransferencias:"";a.txtPaisesCuentaOrigen.swidget().refresh(x);var x=a.txtCantidadTransferenciasHaciaCuentaPorAnio.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].CantidadTransferenciaHaciaCuentaInversion)?a.dataCuenta.datos[0].CantidadTransferenciaHaciaCuentaInversion:"";a.txtCantidadTransferenciasHaciaCuentaPorAnio.swidget().refresh(x);var x=a.txtPaisesCuentaDestino.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].PaisesDestinoTransferencias)?a.dataCuenta.datos[0].PaisesDestinoTransferencias:"";a.txtPaisesCuentaDestino.swidget().refresh(x);a.chkConvenioComitenteAAGI.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].AceptoMandatoDiscrecional)?true:false));a.divConvenioComitenteAAGI.hide();if(a.dataCuenta!=null&&a.dataCuenta.datos[0].SolicitarMandatoDiscrecional){a.divConvenioComitenteAAGI.show()}var x=a.txtCanalOtroDetalle.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].canalOtro)?a.dataCuenta.datos[0].canalOtro:"";a.txtCanalOtroDetalle.swidget().refresh(x);var x=a.txtObjetivoInversionDetallePeriodo.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].ObjetivoInversionPeriodoDetalle)?a.dataCuenta.datos[0].ObjetivoInversionPeriodoDetalle:"";a.txtObjetivoInversionDetallePeriodo.swidget().refresh(x);var x=a.ddlArancel.swidget().initialOptions;x.dataSource.data=(a.dataParametrosUsuario!=null)?$.grep(a.dataParametrosUsuario.aranceles,function(J,i){return J.idNegocio==Core.Enums.eNegocio.BCI}):[];if(a.dataCuenta!=null&&a.dataCuenta.datos[0].idArancel!=null){x.value=a.dataCuenta.datos[0].idArancel.toString()}a.ddlArancel.swidget().refresh(x);var x=a.txtComoLlegoABalanz.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].comoLlegoABalanz)?a.dataCuenta.datos[0].comoLlegoABalanz:"";a.txtComoLlegoABalanz.swidget().refresh(x);var x=a.txtDescripcionActividadCliente.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].descripcionActividadCliente)?a.dataCuenta.datos[0].descripcionActividadCliente:"";a.txtDescripcionActividadCliente.swidget().refresh(x);var x=a.txtUsuarioAsignado.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].usuarioAsignado)?a.dataCuenta.datos[0].usuarioAsignado:"";a.txtUsuarioAsignado.swidget().refresh(x);a.chkCambiosSignificativosPatrimonio.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].CambiosSignificativosPatrimonio)?true:false));var x=a.txtCambiosSignificativosPatrimonioDetalle.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].CambiosSignificativosPatrimonio)?a.dataCuenta.datos[0].CambiosSignificativosPatrimonio:"";a.txtCambiosSignificativosPatrimonioDetalle.swidget().refresh(x);var x=a.txtReferenciaBancariaNombre.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].ReferenciaBancariaNombre)?a.dataCuenta.datos[0].ReferenciaBancariaNombre:"";a.txtReferenciaBancariaNombre.swidget().refresh(x);var x=a.txtReferenciaBancariaApellido.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].ReferenciaBancariaApellido)?a.dataCuenta.datos[0].ReferenciaBancariaApellido:"";a.txtReferenciaBancariaApellido.swidget().refresh(x);var x=a.ddlReferenciaBancariaCargo.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].ReferenciaBancariaCargo)?a.dataCuenta.datos[0].ReferenciaBancariaCargo:"";a.ddlReferenciaBancariaCargo.swidget().refresh(x);var x=a.txtReferenciaBancariaInstitucion.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].ReferenciaBancariaInstitucion)?a.dataCuenta.datos[0].ReferenciaBancariaInstitucion:"";a.txtReferenciaBancariaInstitucion.swidget().refresh(x);var x=a.txtReferenciaBancariaEmail.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].ReferenciaBancariaEMail)?a.dataCuenta.datos[0].ReferenciaBancariaEMail:"";a.txtReferenciaBancariaEmail.swidget().refresh(x);var x=a.txtReferenciaBancariaTelefono.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].ReferenciaBancariaTelefono)?a.dataCuenta.datos[0].ReferenciaBancariaTelefono:"";a.txtReferenciaBancariaTelefono.swidget().refresh(x);var x=a.txtReferenciaBancariaDomicilio.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].ReferenciaBancariaDomicilioCalle)?a.dataCuenta.datos[0].ReferenciaBancariaDomicilioCalle:"";a.txtReferenciaBancariaDomicilio.swidget().refresh(x);var x=a.txtReferenciaBancariaCiudad.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].ReferenciaBancariaDomicilioCiudad)?a.dataCuenta.datos[0].ReferenciaBancariaDomicilioCiudad:"";a.txtReferenciaBancariaCiudad.swidget().refresh(x);var x=a.ddlReferenciaBancariaPais.swidget().initialOptions;x.dataSource.data=(a.dataParametros!=null)?a.dataParametros.paises:[];x.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].ReferenciaBancariaDomicilioidPais)?a.dataCuenta.datos[0].ReferenciaBancariaDomicilioidPais:"";a.ddlReferenciaBancariaPais.swidget().refresh(x);a.chkOrdenesComunicacionesEscrito.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].OrdenesYComunicacionesPorEscrito)?true:false));a.chkOrdenesComunicacionesEmail.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].OrdenesYComunicacionesPorMail)?true:false));var x=a.txtOrdenesComunicacionesEmail.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].OrdenesYComunicacionesPorMail)?a.dataCuenta.datos[0].OrdenesYComunicacionesPorMail:"";a.txtOrdenesComunicacionesEmail.swidget().refresh(x);a.chkOrdenesComunicacionesConvenioOperacion.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].OrdenesYComunicacionesConvenioDeOperacion)?true:false));a.chkTipoInversionAcciones.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionAcciones)?true:false));a.chkTipoInversionOpciones.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionOpciones)?true:false));a.chkTipoInversionFondos.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionFondos)?true:false));a.chkTipoInversionBonos.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionTitulosPublicos)?true:false));a.chkTipoInversionFuturos.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionFuturos)?true:false));a.chkTipoInversionOtro.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionOtros)?true:false));var x=a.txtTipoInversionOtroDetalle.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionOtros)?a.dataCuenta.datos[0].tipoInversionOtros:"";a.txtTipoInversionOtroDetalle.swidget().refresh(x);a.chkExperienciaInversionesAcciones.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].ExperienciaEnInversionesAcciones)?true:false));a.chkExperienciaInversionesOpciones.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].ExperienciaEnInversionesOpciones)?true:false));a.chkExperienciaInversionesFondos.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].ExperienciaEnInversionesFondos)?true:false));a.chkExperienciaInversionesBonos.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].ExperienciaEnInversionesBonos)?true:false));a.chkExperienciaInversionesFuturos.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].ExperienciaEnInversionesFuturos)?true:false));a.chkExperienciaInversionesOtro.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].ExperienciaEnInversionesOtros)?true:false));var x=a.txtExperienciaInversionesOtroDetalle.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].ExperienciaEnInversionesOtros)?a.dataCuenta.datos[0].ExperienciaEnInversionesOtros:"";a.txtExperienciaInversionesOtroDetalle.swidget().refresh(x);var x=a.txtPlazoInversion.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].plazoAproxInversion)?a.dataCuenta.datos[0].plazoAproxInversion:"";a.txtPlazoInversion.swidget().refresh(x);var H=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].idTipoIdentificadorFiscal)?$.grep(a.dataParametros.tiposIdentificadoresFiscales,function(J,i){return J.idTipoIdentificadorFiscal==a.dataCuenta.juridica[0].idTipoIdentificadorFiscal})[0]:null;var x=a.ddlPaisTipoIdentificacionFiscal.swidget().initialOptions;x.dataSource.data=(a.dataParametros!=null)?a.dataParametros.paises:[];x.value=(H)?H.idPais.toString():"1";a.ddlPaisTipoIdentificacionFiscal.swidget().refresh(x);var x=a.txtIdentificacionFiscal.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].CUIT)?a.dataCuenta.juridica[0].CUIT:"";a.txtIdentificacionFiscal.swidget().refresh(x);var x=a.txtRazonSocial.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].RazonSocial)?a.dataCuenta.juridica[0].RazonSocial:"";a.txtRazonSocial.swidget().refresh(x);var x=a.txtNombreComercial.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].NombreComercial)?a.dataCuenta.juridica[0].NombreComercial:"";a.txtNombreComercial.swidget().refresh(x);var x=a.ddlNacionalidad.swidget().initialOptions;x.dataSource.data=(a.dataParametros!=null)?a.dataParametros.paises:[];x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].Nacionalidad)?a.dataCuenta.juridica[0].Nacionalidad.toString():"1";a.ddlNacionalidad.swidget().refresh(x);var x=a.ddlTipoRegistracionJuridica.swidget().initialOptions;x.dataSource.data=(a.dataParametros!=null)?a.dataParametros.TiposRegistracionesJuridicas:[];a.ddlTipoRegistracionJuridica.swidget().refresh(x);a.ddlTipoRegistracionJuridica.swidget().value(a.dataCuenta!=null&&a.dataCuenta.juridica[0].idTipoRegistracionJuridica?a.dataCuenta.juridica[0].idTipoRegistracionJuridica.toString():"");var x=a.ddlTipoPersonaJuridica.swidget().initialOptions;x.dataSource.data=(a.dataParametros!=null)?a.dataParametros.TiposPersonasJuridicas:[];a.ddlTipoPersonaJuridica.swidget().refresh(x);a.ddlTipoPersonaJuridica.swidget().value(a.dataCuenta!=null&&a.dataCuenta.juridica[0].idTipoPersonaJuridica?a.dataCuenta.juridica[0].idTipoPersonaJuridica.toString():"");var x=a.txtNumeroInscripcion.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].NroInscripcion)?a.dataCuenta.juridica[0].NroInscripcion:"";a.txtNumeroInscripcion.swidget().refresh(x);var x=a.txtFechaConstitucion.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].FechaConstitucion)?a.getDate(a.dataCuenta.juridica[0].FechaConstitucion):new Date();a.txtFechaConstitucion.swidget().refresh(x);var x=a.txtTomo.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].Tomo)?a.dataCuenta.juridica[0].Tomo:"";a.txtTomo.swidget().refresh(x);var x=a.txtLibro.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].Libro)?a.dataCuenta.juridica[0].Libro:"";a.txtLibro.swidget().refresh(x);var x=a.ddlActividadPrincipal.swidget().initialOptions;x.dataSource.data=(a.dataParametros!=null)?a.dataParametros.actividadesJuridicas.sort(function(i,J){return i.Descripcion>J.Descripcion?1:-1}):[];a.ddlActividadPrincipal.swidget().refresh(x);a.ddlActividadPrincipal.swidget().value(a.dataCuenta!=null&&a.dataCuenta.juridica[0].idActividadJuridica?a.dataCuenta.juridica[0].idActividadJuridica.toString():"");var x=a.txtActividadPrincipalOtro.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].OcupacionDescripcion)?a.dataCuenta.juridica[0].OcupacionDescripcion:"";a.txtActividadPrincipalOtro.swidget().refresh(x);var x=a.txtSegmentoInversion.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].SegmentoInversion)?a.dataCuenta.juridica[0].SegmentoInversion:"";a.txtSegmentoInversion.swidget().refresh(x);var x=a.txtNumeroAseguradora.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].NroAseguradora)?a.dataCuenta.juridica[0].NroAseguradora:"";a.txtNumeroAseguradora.swidget().refresh(x);var x=a.txtDomicilioLegalCalle.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].DomicilioLegalCalle)?a.dataCuenta.juridica[0].DomicilioLegalCalle:"";a.txtDomicilioLegalCalle.swidget().refresh(x);var x=a.txtDomicilioLegalNumero.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].DomicilioLegalNumero)?a.dataCuenta.juridica[0].DomicilioLegalNumero:"";a.txtDomicilioLegalNumero.swidget().refresh(x);var x=a.txtDomicilioLegalPiso.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].DomicilioLegalPiso)?a.dataCuenta.juridica[0].DomicilioLegalPiso:"";a.txtDomicilioLegalPiso.swidget().refresh(x);var x=a.txtDomicilioLegalDepartamento.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].DomicilioLegalDepartamento)?a.dataCuenta.juridica[0].DomicilioLegalDepartamento:"";a.txtDomicilioLegalDepartamento.swidget().refresh(x);var x=a.ddlDomicilioLegalPais.swidget().initialOptions;x.dataSource.data=(a.dataParametros!=null)?a.dataParametros.paises:[];x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].DomicilioLegalidPais)?a.dataCuenta.juridica[0].DomicilioLegalidPais.toString():"1";a.ddlDomicilioLegalPais.swidget().refresh(x);var x=a.txtDomicilioLegalLocalidad.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].DomicilioLegalCiudad)?a.dataCuenta.juridica[0].DomicilioLegalCiudad:"";a.txtDomicilioLegalLocalidad.swidget().refresh(x);var x=a.txtDomicilioLegalCodigoPostal.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].DomicilioLegalCodigoPostal)?a.dataCuenta.juridica[0].DomicilioLegalCodigoPostal:"";a.txtDomicilioLegalCodigoPostal.swidget().refresh(x);var G=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].DomicilioLegalTelefonoFijo)?a.dataCuenta.juridica[0].DomicilioLegalTelefonoFijo.split("-"):[];var x=a.txtTelefonoParticularArea.swidget().initialOptions;x.value=(G.length>1)?G[0]:"";a.txtTelefonoParticularArea.swidget().refresh(x);var x=a.txtTelefonoParticularNumero.swidget().initialOptions;x.value=(G.length>1)?G[1]:((G.length==1)?G[0]:"");a.txtTelefonoParticularNumero.swidget().refresh(x);var F=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].DomicilioLegalTelefonoMovil)?a.dataCuenta.juridica[0].DomicilioLegalTelefonoMovil.split("-"):[];a.ddlTelefonoCelularPais.swidget().value((F.length>0)?F[0].replaceAll("\\+",""):a.phoneCodeAr.toString());a.setTelefonoCelularControls();var x=a.txtTelefonoCelularArea.swidget().initialOptions;x.value=(F.length==3)?F[1]:"";a.txtTelefonoCelularArea.swidget().refresh(x);var x=a.txtTelefonoCelularNumero.swidget().initialOptions;x.value=(F.length==3)?F[2]:((F.length==2)?F[1]:"");a.txtTelefonoCelularNumero.swidget().refresh(x);var n=((a.dataCuenta!=null&&a.dataCuenta.juridica[0].email)?a.dataCuenta.juridica[0].email.split(","):[]);var x=a.txtEmailNotificaciones1.swidget().initialOptions;x.value=n[0]?n[0]:"";a.txtEmailNotificaciones1.swidget().refresh(x);var x=a.txtEmailNotificaciones2.swidget().initialOptions;x.value=n[1]?n[1]:"";a.txtEmailNotificaciones2.swidget().refresh(x);var x=a.txtEmailNotificaciones3.swidget().initialOptions;x.value=n[2]?n[2]:"";a.txtEmailNotificaciones3.swidget().refresh(x);var x=a.txtEmailNotificaciones4.swidget().initialOptions;x.value=n[3]?n[3]:"";a.txtEmailNotificaciones4.swidget().refresh(x);a.ddlEmailNotificacionesCantidad.swidget().value(n.length.toString());if(a.dataCuenta!=null&&a.dataCuenta.juridica[0].tributaEnOtroPais3){a.ddlCantidadResidenciasFiscales.swidget().value("3")}else{if(a.dataCuenta!=null&&a.dataCuenta.juridica[0].tributaEnOtroPais2){a.ddlCantidadResidenciasFiscales.swidget().value("2")}else{a.ddlCantidadResidenciasFiscales.swidget().value("1")}}var H=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].idTipoIdentificadorFiscal1)?$.grep(a.dataParametros.tiposIdentificadoresFiscales,function(J,i){return J.idTipoIdentificadorFiscal==a.dataCuenta.juridica[0].idTipoIdentificadorFiscal1})[0]:null;var x=a.ddlTributaPais1.swidget().initialOptions;x.dataSource.data=(a.dataParametros!=null)?a.dataParametros.paises:[];x.value=(H)?H.idPais.toString():"1";a.ddlTributaPais1.swidget().refresh(x);var H=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].idTipoIdentificadorFiscal2)?$.grep(a.dataParametros.tiposIdentificadoresFiscales,function(J,i){return J.idTipoIdentificadorFiscal==a.dataCuenta.juridica[0].idTipoIdentificadorFiscal2})[0]:null;var x=a.ddlTributaPais2.swidget().initialOptions;x.dataSource.data=(a.dataParametros!=null)?a.dataParametros.paises:[];x.value=(H)?H.idPais.toString():"1";a.ddlTributaPais2.swidget().refresh(x);var H=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].idTipoIdentificadorFiscal3)?$.grep(a.dataParametros.tiposIdentificadoresFiscales,function(J,i){return J.idTipoIdentificadorFiscal==a.dataCuenta.juridica[0].idTipoIdentificadorFiscal3})[0]:null;var x=a.ddlTributaPais3.swidget().initialOptions;x.dataSource.data=(a.dataParametros!=null)?a.dataParametros.paises:[];x.value=(H)?H.idPais.toString():"1";a.ddlTributaPais3.swidget().refresh(x);var x=a.txtTributaNit1.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].NIT1)?a.dataCuenta.juridica[0].NIT1:"";a.txtTributaNit1.swidget().refresh(x);var x=a.txtTributaNit2.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].NIT2)?a.dataCuenta.juridica[0].NIT2:"";a.txtTributaNit2.swidget().refresh(x);var x=a.txtTributaNit3.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].NIT3)?a.dataCuenta.juridica[0].NIT3:"";a.txtTributaNit3.swidget().refresh(x);var x=a.txtBeneficiarioEstadounidenseNombre1.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU1Nombre)?a.dataCuenta.juridica[0].beneficiarioEEUU1Nombre:"";a.txtBeneficiarioEstadounidenseNombre1.swidget().refresh(x);var x=a.txtBeneficiarioEstadounidenseNombre2.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU2Nombre)?a.dataCuenta.juridica[0].beneficiarioEEUU2Nombre:"";a.txtBeneficiarioEstadounidenseNombre2.swidget().refresh(x);var x=a.txtBeneficiarioEstadounidenseNombre3.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU3Nombre)?a.dataCuenta.juridica[0].beneficiarioEEUU3Nombre:"";a.txtBeneficiarioEstadounidenseNombre3.swidget().refresh(x);var x=a.txtBeneficiarioEstadounidenseNombre4.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU4Nombre)?a.dataCuenta.juridica[0].beneficiarioEEUU4Nombre:"";a.txtBeneficiarioEstadounidenseNombre4.swidget().refresh(x);var x=a.txtBeneficiarioEstadounidenseNombre5.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU5Nombre)?a.dataCuenta.juridica[0].beneficiarioEEUU5Nombre:"";a.txtBeneficiarioEstadounidenseNombre5.swidget().refresh(x);var x=a.txtBeneficiarioEstadounidenseNombre6.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU6Nombre)?a.dataCuenta.juridica[0].beneficiarioEEUU6Nombre:"";a.txtBeneficiarioEstadounidenseNombre6.swidget().refresh(x);var x=a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU1.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU1TIN)?a.dataCuenta.juridica[0].beneficiarioEEUU1TIN:"";a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU1.swidget().refresh(x);var x=a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU2.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU2TIN)?a.dataCuenta.juridica[0].beneficiarioEEUU2TIN:"";a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU2.swidget().refresh(x);var x=a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU3.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU3TIN)?a.dataCuenta.juridica[0].beneficiarioEEUU3TIN:"";a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU3.swidget().refresh(x);var x=a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU4.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU4TIN)?a.dataCuenta.juridica[0].beneficiarioEEUU4TIN:"";a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU4.swidget().refresh(x);var x=a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU5.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU5TIN)?a.dataCuenta.juridica[0].beneficiarioEEUU5TIN:"";a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU5.swidget().refresh(x);var x=a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU6.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU6TIN)?a.dataCuenta.juridica[0].beneficiarioEEUU6TIN:"";a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU6.swidget().refresh(x);a.controlBeneficiarioEstadounidensePorcentajeParticipacion1.setValue((a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU1PorcPart)?a.dataCuenta.juridica[0].beneficiarioEEUU1PorcPart:"");a.controlBeneficiarioEstadounidensePorcentajeParticipacion2.setValue((a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU2PorcPart)?a.dataCuenta.juridica[0].beneficiarioEEUU2PorcPart:"");a.controlBeneficiarioEstadounidensePorcentajeParticipacion3.setValue((a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU3PorcPart)?a.dataCuenta.juridica[0].beneficiarioEEUU3PorcPart:"");a.controlBeneficiarioEstadounidensePorcentajeParticipacion4.setValue((a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU4PorcPart)?a.dataCuenta.juridica[0].beneficiarioEEUU4PorcPart:"");a.controlBeneficiarioEstadounidensePorcentajeParticipacion5.setValue((a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU5PorcPart)?a.dataCuenta.juridica[0].beneficiarioEEUU5PorcPart:"");a.controlBeneficiarioEstadounidensePorcentajeParticipacion6.setValue((a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU6PorcPart)?a.dataCuenta.juridica[0].beneficiarioEEUU6PorcPart:"");a.chkPoseeBeneficiariosEstadounidenses.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.juridica[0].tieneBeneficiariosEstadounidenses==1)?true:false));if(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU6Nombre){a.ddlBeneficiariosEstadounidensesCantidad.swidget().value("6")}else{if(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU5Nombre){a.ddlBeneficiariosEstadounidensesCantidad.swidget().value("5")}else{if(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU4Nombre){a.ddlBeneficiariosEstadounidensesCantidad.swidget().value("4")}else{if(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU3Nombre){a.ddlBeneficiariosEstadounidensesCantidad.swidget().value("3")}else{if(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU2Nombre){a.ddlBeneficiariosEstadounidensesCantidad.swidget().value("2")}else{a.ddlBeneficiariosEstadounidensesCantidad.swidget().value("1")}}}}}var x=a.ddlTipoEntidadCRS.swidget().initialOptions;x.dataSource.data=(a.dataParametros!=null)?a.dataParametros.TiposEntidadesCRS:[];a.ddlTipoEntidadCRS.swidget().refresh(x);a.ddlTipoEntidadCRS.swidget().value(a.dataCuenta!=null&&a.dataCuenta.juridica[0].idTipoEntidadCRS?a.dataCuenta.juridica[0].idTipoEntidadCRS.toString():"");var x=a.ddlTipoEntidadCRSEntidadInversion.swidget().initialOptions;x.dataSource.data=(a.dataParametros!=null)?a.dataParametros.TiposEntidadesCRSTiposEntidadesInversion:[];a.ddlTipoEntidadCRSEntidadInversion.swidget().refresh(x);a.ddlTipoEntidadCRSEntidadInversion.swidget().value(a.dataCuenta!=null&&a.dataCuenta.juridica[0].idTipoEntidadCRSTipoEntidadInversion?a.dataCuenta.juridica[0].idTipoEntidadCRSTipoEntidadInversion.toString():"");var x=a.txtTipoEntidadCRSGiin.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].TipoEntidadCRSGIIN)?a.dataCuenta.juridica[0].TipoEntidadCRSGIIN:"";a.txtTipoEntidadCRSGiin.swidget().refresh(x);var x=a.txtTipoEntidadCRSMercadoDondeCotiza.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].TipoEntidadCRSMercadoDondeCotiza)?a.dataCuenta.juridica[0].TipoEntidadCRSMercadoDondeCotiza:"";a.txtTipoEntidadCRSMercadoDondeCotiza.swidget().refresh(x);var x=a.txtTipoEntidadCRSCompaniaPublicaRelacionada.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].TipoEntidadCRSCompaniaPublicaRelacionada)?a.dataCuenta.juridica[0].TipoEntidadCRSCompaniaPublicaRelacionada:"";a.txtTipoEntidadCRSCompaniaPublicaRelacionada.swidget().refresh(x);var x=a.txtTipoEntidadCRSNombreApellido.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].TipoEntidadCRSNombreApellido)?a.dataCuenta.juridica[0].TipoEntidadCRSNombreApellido:"";a.txtTipoEntidadCRSNombreApellido.swidget().refresh(x);var x=a.ddlCiudadaniaEEUU.swidget().initialOptions;x.dataSource.data=(a.dataParametros!=null)?a.dataParametros.TiposFATCA:[];a.ddlCiudadaniaEEUU.swidget().refresh(x);a.ddlCiudadaniaEEUU.swidget().value(a.dataCuenta!=null&&a.dataCuenta.juridica[0].idTipoFATCA?a.dataCuenta.juridica[0].idTipoFATCA.toString():"");a.chkCiudadaniaEEUUDeclaracionJurada[0].checked=(((a.dataCuenta!=null&&a.dataCuenta.juridica[0].DeclaJuradaFATCA==1)?true:false));var x=a.ddlTipoOcde.swidget().initialOptions;x.dataSource.data=(a.dataParametros!=null)?a.dataParametros.TiposOCDE:[];a.ddlTipoOcde.swidget().refresh(x);a.ddlTipoOcde.swidget().value(a.dataCuenta!=null&&a.dataCuenta.juridica[0].idTipoOCDE?a.dataCuenta.juridica[0].idTipoOCDE.toString():"");a.chkTipoOcdeDeclaracionJurada[0].checked=(((a.dataCuenta!=null&&a.dataCuenta.juridica[0].DeclaJuradaOCDE==1)?true:false));var x=a.ddlTipoInstitucionFinancieraExtranjera.swidget().initialOptions;x.dataSource.data=(a.dataParametros!=null)?a.dataParametros.TiposInstitucionesFinancierasExtranjeras:[];a.ddlTipoInstitucionFinancieraExtranjera.swidget().refresh(x);a.ddlTipoInstitucionFinancieraExtranjera.swidget().value(a.dataCuenta!=null&&a.dataCuenta.juridica[0].idInstitucionFinancieraExtranjera?a.dataCuenta.juridica[0].idInstitucionFinancieraExtranjera.toString():"");var x=a.txtInstitucionFinancieraExtranjeraGIIN.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].InstitucionFinancieraExtranjeraGIIN)?a.dataCuenta.juridica[0].InstitucionFinancieraExtranjeraGIIN:"";a.txtInstitucionFinancieraExtranjeraGIIN.swidget().refresh(x);var x=a.ddlTipoReporteDirectoIRS.swidget().initialOptions;x.dataSource.data=(a.dataParametros!=null)?a.dataParametros.TiposReportesDirectosIRS:[];a.ddlTipoReporteDirectoIRS.swidget().refresh(x);a.ddlTipoReporteDirectoIRS.swidget().value(a.dataCuenta!=null&&a.dataCuenta.juridica[0].idReporteDirectoIRS?a.dataCuenta.juridica[0].idReporteDirectoIRS.toString():"");var x=a.txtReporteDirectoIRSGIIN.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].reportaDirectoIRSGIIN)?a.dataCuenta.juridica[0].reportaDirectoIRSGIIN:"";a.txtReporteDirectoIRSGIIN.swidget().refresh(x);var x=a.txtPersonaEstadounidenseTIN.swidget().initialOptions;x.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].esPersonaEstadounidenseTIN)?a.dataCuenta.juridica[0].esPersonaEstadounidenseTIN:"";a.txtPersonaEstadounidenseTIN.swidget().refresh(x);var x=a.ddlTipoPersonaJuridicaExenta.swidget().initialOptions;x.dataSource.data=(a.dataParametros!=null)?a.dataParametros.TiposPersonasJuridicasExentas:[];a.ddlTipoPersonaJuridicaExenta.swidget().refresh(x);a.ddlTipoPersonaJuridicaExenta.swidget().value(a.dataCuenta!=null&&a.dataCuenta.juridica[0].idPersonaJuridicaExenta?a.dataCuenta.juridica[0].idPersonaJuridicaExenta.toString():"");a.controlMontoCompliance.setValue((a.dataCuenta!=null&&a.dataCuenta.juridica[0].montoCompliance)?a.dataCuenta.juridica[0].montoCompliance:"");var x=a.ddlRiesgoCliente.swidget().initialOptions;x.dataSource.data=(a.dataParametros!=null)?a.dataParametrosUsuario.riesgo:[];a.ddlRiesgoCliente.swidget().refresh(x);a.ddlRiesgoCliente.swidget().value(a.dataCuenta!=null&&a.dataCuenta.juridica[0].idRiesgo?a.dataCuenta.juridica[0].idRiesgo.toString():"");a.setControls(true);var x=a.gridPersonas.swidget().initialOptions;x.dataSource.data=a.personas;a.gridPersonas.swidget().refresh(x);var x=a.gridArchivos.swidget().initialOptions;x.dataSource.data=a.archivos;a.gridArchivos.swidget().refresh(x);a.btnConsultarMatrizRiesgo.hide();a.divCalcularMatrizRiesgo.hide();if(a.dataCuenta!=null&&a.dataCuenta.juridica[0].CUIT){if(a.dataCuenta.juridica[0].VersionMatriz&&a.dataCuenta.juridica[0].VersionMatriz>0){a.btnConsultarMatrizRiesgo.show()}else{a.divCalcularMatrizRiesgo.show()}}var x=a.gridObservaciones.swidget().initialOptions;x.dataSource.data=a.observaciones;a.gridObservaciones.swidget().refresh(x);a.divInformes.html("");if(a.dataCuenta){var y=$("<label>Resumen de la Cuenta:  </label>").appendTo(a.divInformes);if(a.dataCuenta.juridica[0].tieneNOSIS){var t=$('<button disabled type="button" title="Nosis" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/nosis-logo.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);t.css("border-color",a.dataCuenta.juridica[0].tieneNOSIS);if(a.optionsApertura&&a.optionsApertura.consultaNosis){t.removeAttr("disabled");t.on("click",function(){if(a.dataCuenta.juridica[0].CUIT){Core.Functions.ExternalServices.Nosis.showReport(t,a.dataCuenta.juridica[0].CUIT)}})}}if(a.dataCuenta.juridica[0].tieneUIF){var u=$('<button disabled type="button" title="UIF" class="btn-sm balanz-button"style="border:3px solid; background-color:#fff;"><img src="/images/uif-logo.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);u.css("border-color",a.dataCuenta.juridica[0].tieneUIF);if(a.optionsApertura&&a.optionsApertura.consultaUIF){u.removeAttr("disabled");u.on("click",function(){if(a.dataCuenta.juridica[0].CUIT){Core.Functions.ExternalServices.UIF.showReport(u,a.dataCuenta.juridica[0].CUIT)}})}}if(a.dataCuenta.datos[0].tieneDocusign){var q=$('<button disabled type="button" title="DocuSign" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="'+(a.dataCuenta.datos[0].tieneDocusign=="disabled"?"/images/docusign-logo-inactivo.png":"/images/docusign-logo.png")+'" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);q.css("border-color",(a.dataCuenta.datos[0].tieneDocusign=="disabled"?"lightgray":a.dataCuenta.datos[0].tieneDocusign));if(a.optionsApertura&&a.optionsApertura.consultaDocusign&&a.dataCuenta.datos[0].tieneDocusign!="disabled"){q.removeAttr("disabled");q.on("click",function(){if(a.dataCuenta!=null){Core.Functions.ExternalServices.DocuSign.showReport(q,a.dataCuenta.datos[0].idAperturaCuenta)}})}}var r=$('<button type="button" title="Google" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/google-logo.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);r.css("border-color","lightgreen");r.on("click",function(){a.openUrlGoogle(a.dataCuenta.juridica[0].RazonSocial+" "+a.dataCuenta.juridica[0].CUIT)});if(a.aperturaCuenta&&a.aperturaCuenta.motorDecision){var s=$('<button style="border:3px solid; background-color:transparent; border-color:transparent;" type="button" title="Motor decisión" class="btn-sm balanz-button"></button>').appendTo(a.divInformes);var v=$('<img src="/images/circ-trans.png" style="width:20px; height:20px;" />').appendTo(s);v.css("background-color",a.aperturaCuenta.motorDecision);s.on("click",function(){Core.Functions.ExternalServices.MotorDecision.showReport(s,a.idAperturaCuenta)})}}if(a.namespaceActivo=="Legajos"||a.namespaceActivo=="OpenManagerAltaCuenta"){var m=(a.dataCuenta!=null&&a.dataCuenta.datos[0].NumComitente)?("Comitente: "+a.dataCuenta.datos[0].NumComitente):"";m+=(a.dataCuenta!=null&&a.dataCuenta.datos[0].NumCuotapartista)?((m?" || ":"")+("Cuotapartista: "+a.dataCuenta.datos[0].NumCuotapartista)):"";a.lblComitenteCuotapartistaCuenta.text(m);a.lblDescripcionCuenta.text((a.dataCuenta!=null&&a.dataCuenta.datos[0].DescripcionCuenta)?a.dataCuenta.datos[0].DescripcionCuenta:"");a.divDescripcionCuenta.show();a.divComitenteCuotapartistaCuenta.show()}};a.openUrlGoogle=function(d){var e="http://www.google.com/search?q="+d;window.open(e,"_blank");overlay=new Core.Controls.Overlay(a.btnAgregarArchivo,{});var c=new XMLHttpRequest();c.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"webshot?url="+encodeURIComponent(encodeURIComponent(e)),true);c.responseType="blob";c.setRequestHeader("Content-Type","application/json;charset=UTF-8");c.setRequestHeader("Authorization",Core.Objects.Context.Token);c.onerror=function(f){var g=new Core.Controls.Dialog("Error","No se ha podido descargar la imagen",{displayButtons:{close:true,accept:false}});g.show();overlay.destroy();return};c.onload=function(f){if(c.status==200){var i=new XMLHttpRequest();i.onload=function(k){var j=new Core.Controls.ManagerAltaCuentaNuevoArchivo({onSave:function(m){a.archivos.push({urlArchivo:m.file.urlArchivo,idTipoArchivo:m.idTipoArchivo,Tipo:m.Tipo,Fecha:m.Fecha,Comentario:m.comentarios});var l=a.gridArchivos.swidget().initialOptions;l.dataSource.data=a.archivos;a.gridArchivos.swidget().refresh(l)},tiposArchivos:((a.dataParametros!=null)?$.grep(a.dataParametros.TiposArchivos,function(m,l){return m.Juridica&&m.BCI}):[]),idTipoArchivoDefault:"7",comentariosDefault:"Google Search "+d,file:JSON.parse(i.responseText)}).show();overlay.destroy()};i.onerror=function(j){var k=new Core.Controls.Dialog("Error","No se ha podido adjuntar la foto",{displayButtons:{close:true,accept:false}});k.show();overlay.destroy();return};var h=new Blob([c.response],{type:"image/png"});i.open("POST",Core.Origin+Core.PrefixUrl+"upload/documento/7",true);i.setRequestHeader("Authorization",Core.Objects.Context.Token);i.setRequestHeader("Accept","application/json");i.setRequestHeader("Content-Type","image/png");i.send(h)}else{var g=new Core.Controls.Dialog("Error","No se ha podido descargar la imagen",{displayButtons:{close:true,accept:false}});g.show();overlay.destroy()}};c.send()};a.getRequestData=function(){Core.Functions.Validations.toggleValidation(a.ddlEstado,false);Core.Functions.Validations.toggleValidation(a.ddlAsesor,false);Core.Functions.Validations.toggleValidation(a.txtOrigenPatrimonioOtroDetalle,false);Core.Functions.Validations.toggleValidation(a.txtFondeoCuentaOtroDetalle,false);Core.Functions.Validations.toggleValidation(a.txtCantidadTransferenciasDesdeCuentaPorAnio,false);Core.Functions.Validations.toggleValidation(a.txtPaisesCuentaOrigen,false);Core.Functions.Validations.toggleValidation(a.txtCantidadTransferenciasHaciaCuentaPorAnio,false);Core.Functions.Validations.toggleValidation(a.txtPaisesCuentaDestino,false);Core.Functions.Validations.toggleValidation(a.txtCanalOtroDetalle,false);Core.Functions.Validations.toggleValidation(a.txtObjetivoInversionDetallePeriodo,false);Core.Functions.Validations.toggleValidation(a.ddlArancel,false);Core.Functions.Validations.toggleValidation(a.txtComoLlegoABalanz,false);Core.Functions.Validations.toggleValidation(a.txtUsuarioAsignado,false);Core.Functions.Validations.toggleValidation(a.txtTipoInversionOtroDetalle,false);Core.Functions.Validations.toggleValidation(a.txtExperienciaInversionesOtroDetalle,false);Core.Functions.Validations.toggleValidation(a.txtPlazoInversion,false);Core.Functions.Validations.toggleValidation(a.txtDescripcionActividadCliente,false);Core.Functions.Validations.toggleValidation(a.txtCambiosSignificativosPatrimonioDetalle,false);Core.Functions.Validations.toggleValidation(a.txtReferenciaBancariaNombre,false);Core.Functions.Validations.toggleValidation(a.txtReferenciaBancariaApellido,false);Core.Functions.Validations.toggleValidation(a.ddlReferenciaBancariaCargo,false);Core.Functions.Validations.toggleValidation(a.txtReferenciaBancariaInstitucion,false);Core.Functions.Validations.toggleValidation(a.txtReferenciaBancariaTelefono,false);Core.Functions.Validations.toggleValidation(a.txtReferenciaBancariaEmail,false);Core.Functions.Validations.toggleValidation(a.txtReferenciaBancariaDomicilio,false);Core.Functions.Validations.toggleValidation(a.txtReferenciaBancariaCiudad,false);Core.Functions.Validations.toggleValidation(a.ddlReferenciaBancariaPais,false);Core.Functions.Validations.toggleValidation(a.txtOrdenesComunicacionesEmail,false);Core.Functions.Validations.toggleValidation(a.txtIngresoAsesorFinanciero,false);Core.Functions.Validations.toggleValidation(a.ddlPaisTipoIdentificacionFiscal,false);Core.Functions.Validations.toggleValidation(a.ddlTipoIdentificacionFiscal,false);Core.Functions.Validations.toggleValidation(a.txtIdentificacionFiscal,false);Core.Functions.Validations.toggleValidation(a.txtRazonSocial,false);Core.Functions.Validations.toggleValidation(a.txtNombreComercial,false);Core.Functions.Validations.toggleValidation(a.ddlNacionalidad,false);Core.Functions.Validations.toggleValidation(a.ddlLugarConstitucion,false);Core.Functions.Validations.toggleValidation(a.ddlTipoPersonaJuridica,false);Core.Functions.Validations.toggleValidation(a.ddlTipoRegistracionJuridica,false);Core.Functions.Validations.toggleValidation(a.txtNumeroInscripcion,false);Core.Functions.Validations.toggleValidation(a.txtFechaConstitucion,false);Core.Functions.Validations.toggleValidation(a.txtLibro,false);Core.Functions.Validations.toggleValidation(a.txtTomo,false);Core.Functions.Validations.toggleValidation(a.ddlActividadPrincipal,false);Core.Functions.Validations.toggleValidation(a.txtActividadPrincipalOtro,false);Core.Functions.Validations.toggleValidation(a.txtSegmentoInversion,false);Core.Functions.Validations.toggleValidation(a.txtNumeroAseguradora,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioLegalCalle,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioLegalNumero,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioLegalPiso,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioLegalDepartamento,false);Core.Functions.Validations.toggleValidation(a.ddlDomicilioLegalPais,false);Core.Functions.Validations.toggleValidation(a.ddlDomicilioLegalProvincia,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioLegalLocalidad,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioLegalCodigoPostal,false);Core.Functions.Validations.toggleValidation(a.ddlEmailNotificacionesCantidad,false);Core.Functions.Validations.toggleValidation(a.txtEmailNotificaciones1,false);Core.Functions.Validations.toggleValidation(a.txtEmailNotificaciones2,false);Core.Functions.Validations.toggleValidation(a.txtEmailNotificaciones3,false);Core.Functions.Validations.toggleValidation(a.txtEmailNotificaciones4,false);Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularArea,false);Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularNumero,false);Core.Functions.Validations.toggleValidation(a.ddlTelefonoCelularPais,false);Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularArea,false);Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularNumero,false);Core.Functions.Validations.toggleValidation(a.ddlTributaPais1,false);Core.Functions.Validations.toggleValidation(a.ddlTributaPais2,false);Core.Functions.Validations.toggleValidation(a.ddlTributaPais3,false);Core.Functions.Validations.toggleValidation(a.txtTributaNit1,false);Core.Functions.Validations.toggleValidation(a.txtTributaNit2,false);Core.Functions.Validations.toggleValidation(a.txtTributaNit3,false);Core.Functions.Validations.toggleValidation(a.ddlTributaTipoIdentificadorFiscal1,false);Core.Functions.Validations.toggleValidation(a.ddlTributaTipoIdentificadorFiscal2,false);Core.Functions.Validations.toggleValidation(a.ddlTributaTipoIdentificadorFiscal3,false);Core.Functions.Validations.toggleValidation(a.ddlCantidadResidenciasFiscales,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseNombre1,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseNombre2,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseNombre3,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseNombre4,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseNombre5,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseNombre6,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU1,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU2,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU3,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU4,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU5,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU6,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion1,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion2,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion3,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion4,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion5,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion6,false);Core.Functions.Validations.toggleValidation(a.ddlBeneficiariosEstadounidensesCantidad,false);Core.Functions.Validations.toggleValidation(a.ddlTipoInstitucionFinancieraExtranjera,false);Core.Functions.Validations.toggleValidation(a.txtInstitucionFinancieraExtranjeraGIIN,false);Core.Functions.Validations.toggleValidation(a.ddlTipoReporteDirectoIRS,false);Core.Functions.Validations.toggleValidation(a.txtReporteDirectoIRSGIIN,false);Core.Functions.Validations.toggleValidation(a.txtPersonaEstadounidenseTIN,false);Core.Functions.Validations.toggleValidation(a.ddlTipoPersonaJuridicaExenta,false);Core.Functions.Validations.toggleValidation(a.ddlCiudadaniaEEUU,false);Core.Functions.Validations.toggleValidation(a.ddlTipoEntidadCRS,false);Core.Functions.Validations.toggleValidation(a.ddlTipoEntidadCRSEntidadInversion,false);Core.Functions.Validations.toggleValidation(a.txtTipoEntidadCRSGiin,false);Core.Functions.Validations.toggleValidation(a.txtTipoEntidadCRSMercadoDondeCotiza,false);Core.Functions.Validations.toggleValidation(a.txtTipoEntidadCRSCompaniaPublicaRelacionada,false);Core.Functions.Validations.toggleValidation(a.txtTipoEntidadCRSNombreApellido,false);Core.Functions.Validations.toggleValidation(a.ddlTipoOcde,false);a.divAlert.slideUp();if(!a.dataCuenta||!a.ddlEstado.swidget().selectedItem()||(a.ddlEstado.swidget().selectedItem().idTipoValidacion==0)){return a.getRequestDataNoValidated()}else{return a.getRequestDataValidated()}};a.getRequestDataNoValidated=function(){var d={value:true};var c={};c.EsJuridica=1;c.tipoFirma=a.getSelectedTipoFirma();c.PatrimonioIngresosOperativos=a.chkOrigenPatrimonioIngresosOperativos.swidget().checked()?1:0;c.PatrimonioAportesDeCapital=a.chkOrigenPatrimonioAportesCapital.swidget().checked()?1:0;c.PatrimonioSuscripcionCuotaspartes=a.chkOrigenPatrimonioSuscripcionCuotapartes.swidget().checked()?1:0;c.PatrimonioVentaDeActivosFijos=a.chkOrigenPatrimonioVentaActivosFijos.swidget().checked()?1:0;c.PatrimonioDonacion=a.chkOrigenPatrimonioDonacion.swidget().checked()?1:0;c.PatrimonioInversionesAnteriores=a.chkOrigenPatrimonioInversionesAnteriores.swidget().checked()?1:0;c.patrimonioOtro=a.getOrigenPatrimonioOtro();c.FondeoCuentaTransferenciaTitulosCuentaInversion=a.chkFondeoCuentaTransferenciaTitulosCuentaInversion.swidget().checked()?1:0;c.FondeoCuentaTransferenciaDineroCuentaInversion=a.chkFondeoCuentaTransferenciaDineroCuentaInversion.swidget().checked()?1:0;c.FondeoCuentaTransferenciaDineroBanco=a.chkFondeoCuentaTransferenciaDineroBanco.swidget().checked()?1:0;c.FondeoCuentaOtros=a.chkFondeoCuentaOtro.swidget().checked()?a.txtFondeoCuentaOtroDetalle.val():"";c.CantidadTransferenciaHaciaCuentaInversion=a.txtCantidadTransferenciasHaciaCuentaPorAnio.val();c.PaisesOrigenTransferencias=a.txtPaisesCuentaOrigen.val();c.CantidadTransferenciaDesdeCuentaInversion=a.txtCantidadTransferenciasDesdeCuentaPorAnio.val();c.PaisesDestinoTransferencias=a.txtPaisesCuentaDestino.val();c.idCanal=a.getSelectedCanal();if(c.idCanal==Core.Business.eCanal.Otro){c.canalOtro=a.getCanalOtro()}c.comoLlegoABalanz=a.txtComoLlegoABalanz.val();c.descripcionActividadCliente=a.txtDescripcionActividadCliente.val();c.CambiosSignificativosPatrimonio=a.chkCambiosSignificativosPatrimonio.swidget().checked()?a.txtCambiosSignificativosPatrimonioDetalle.val():"";c.ReferenciaBancariaNombre=a.txtReferenciaBancariaNombre.val();c.ReferenciaBancariaApellido=a.txtReferenciaBancariaApellido.val();c.ReferenciaBancariaCargo=((a.ddlReferenciaBancariaCargo.swidget().selectedItem())?a.ddlReferenciaBancariaCargo.swidget().selectedItem().idArancel:null);c.ReferenciaBancariaInstitucion=a.txtReferenciaBancariaInstitucion.val();c.ReferenciaBancariaTelefono=a.txtReferenciaBancariaTelefono.val();c.ReferenciaBancariaEMail=a.txtReferenciaBancariaEmail.val();c.ReferenciaBancariaDomicilioCalle=a.txtReferenciaBancariaDomicilio.val();c.ReferenciaBancariaDomicilioCiudad=a.txtReferenciaBancariaCiudad.val();c.ReferenciaBancariaDomicilioidPais=((a.ddlReferenciaBancariaPais.swidget().selectedItem())?a.ddlReferenciaBancariaPais.swidget().selectedItem().idPais:null);c.OrdenesYComunicacionesPorEscrito=a.chkOrdenesComunicacionesEscrito.swidget().checked()?1:0;c.OrdenesYComunicacionesPorMail=a.chkOrdenesComunicacionesEmail.swidget().checked()?a.txtOrdenesComunicacionesEmail.val():"";c.OrdenesYComunicacionesConvenioDeOperacion=a.chkOrdenesComunicacionesConvenioOperacion.swidget().checked()?1:0;c.usuarioAsignado=a.txtUsuarioAsignado.val();c.tipoInversionAcciones=a.chkTipoInversionAcciones.swidget().checked()?1:0;c.tipoInversionOpciones=a.chkTipoInversionOpciones.swidget().checked()?1:0;c.tipoInversionFondos=a.chkTipoInversionFondos.swidget().checked()?1:0;c.tipoInversionTitulosPublicos=a.chkTipoInversionBonos.swidget().checked()?1:0;c.tipoInversionFuturos=a.chkTipoInversionFuturos.swidget().checked()?1:0;c.tipoInversionOtros=a.getTipoInversionOtro();c.ExperienciaEnInversionesAcciones=a.chkExperienciaInversionesAcciones.swidget().checked()?1:0;c.ExperienciaEnInversionesOpciones=a.chkExperienciaInversionesOpciones.swidget().checked()?1:0;c.ExperienciaEnInversionesFondos=a.chkExperienciaInversionesFondos.swidget().checked()?1:0;c.ExperienciaEnInversionesBonos=a.chkExperienciaInversionesBonos.swidget().checked()?1:0;c.ExperienciaEnInversionesFuturos=a.chkExperienciaInversionesFuturos.swidget().checked()?1:0;c.ExperienciaEnInversionesOtros=a.getExperienciaInversionesOtro();c.plazoAproxInversion=a.txtPlazoInversion.val();c.idArancel=((a.ddlArancel.swidget().selectedItem())?a.ddlArancel.swidget().selectedItem().idArancel:null);c.idPersonaAsesor=((a.ddlAsesor.swidget().selectedItem())?a.ddlAsesor.swidget().selectedItem().idPersona:null);c.UsarFirmaDigital=a.chkUsarFirmaDigital.swidget().checked()?1:0;if(a.dataCuenta!=null){c.idEstadoAperturaCuenta=((a.ddlEstado.swidget().selectedItem())?a.ddlEstado.swidget().selectedItem().idEstadoAperturaCuenta:null);c.idAperturaCuenta=a.dataCuenta.datos[0].idAperturaCuenta;c.version=a.dataCuenta.datos[0].version;c.hash=a.dataCuenta.datos[0].hash;c.AceptoTyC=a.dataCuenta.datos[0].AceptoTyC;c.idPaso=a.dataCuenta.datos[0].idPaso;c.idSubPaso=a.dataCuenta.datos[0].idSubPaso;c.nombreOriginal=a.dataCuenta.datos[0].nombreOriginal;c.emailOriginal=a.dataCuenta.datos[0].emailOriginal;c.idCuentaExistente=a.dataCuenta.datos[0].idCuentaExistente;c.idExterno=a.dataCuenta.datos[0].idExterno;c.AceptoMandatoDiscrecional=a.dataCuenta.datos[0].AceptoMandatoDiscrecional;c.SolicitarMandatoDiscrecional=a.dataCuenta.datos[0].SolicitarMandatoDiscrecional}else{c.idNegocio=Core.Enums.eNegocio.BCI}c.juridica=a.dataCuenta!=null&&a.dataCuenta.juridica?a.dataCuenta.juridica:[{}];c.juridica[0].idMontoAInvertirJuridica=a.getSelectedMontoAInvertir();c.juridica[0].ingresosAnuales=a.getSelectedIngresosAnuales();c.juridica[0].patrimonioNeto=a.getSelectedPatrimonioNeto();c.juridica[0].idNivelExperienciaInversion=a.getSelectedNivelExperienciaInversion();c.juridica[0].idRelacionInversionPatrimonio=a.getSelectedRelacionInversionPatrimonio();c.juridica[0].idObjetivoInversion=a.getSelectedObjetivoInversion();if(c.juridica[0].idObjetivoInversion==Core.Business.eAmountRange.Hasta200){c.juridica[0].ObjetivoInversionPeriodoDetalle=a.txtObjetivoInversionDetallePeriodo.val()}c.juridica[0].idNivelToleranciaAlRiesgo=a.getSelectedNivelToleranciaAlRiesgo();c.juridica[0].idTipoIdentificadorFiscal=((a.ddlTipoIdentificacionFiscal.swidget().selectedItem())?a.ddlTipoIdentificacionFiscal.swidget().selectedItem().idTipoIdentificadorFiscal:null);c.juridica[0].CUIT=a.txtIdentificacionFiscal.val();c.juridica[0].RazonSocial=a.txtRazonSocial.val();c.juridica[0].NombreComercial=a.txtNombreComercial.val();c.juridica[0].Nacionalidad=((a.ddlNacionalidad.swidget().selectedItem())?a.ddlNacionalidad.swidget().selectedItem().idPais:null);c.juridica[0].LugarConstitucion=((a.ddlLugarConstitucion.swidget().selectedItem())?a.ddlLugarConstitucion.swidget().selectedItem().Nombre:null);c.juridica[0].idTipoPersonaJuridica=((a.ddlTipoPersonaJuridica.swidget().selectedItem())?a.ddlTipoPersonaJuridica.swidget().selectedItem().idTipoPersonaJuridica:null);c.juridica[0].idTipoRegistracionJuridica=((a.ddlTipoRegistracionJuridica.swidget().selectedItem())?a.ddlTipoRegistracionJuridica.swidget().selectedItem().idTipoRegistracionJuridica:null);c.juridica[0].NroInscripcion=a.txtNumeroInscripcion.val();c.juridica[0].FechaConstitucion=Core.Functions.Date.getDateAsString(a.txtFechaConstitucion.swidget().value());c.juridica[0].Libro=a.txtLibro.val();c.juridica[0].Tomo=a.txtTomo.val();c.juridica[0].idActividadJuridica=((a.ddlActividadPrincipal.swidget().selectedItem())?a.ddlActividadPrincipal.swidget().selectedItem().idActividadJuridica:null);if(a.ddlActividadPrincipal.swidget().selectedItem()&&a.ddlActividadPrincipal.swidget().selectedItem().idActividadJuridica==Core.Business.eActividadPrincipalJuridica.Otro){c.juridica[0].OcupacionDescripcion=a.txtActividadPrincipalOtro.val()}if(a.ddlActividadPrincipal.swidget().selectedItem()&&a.ddlActividadPrincipal.swidget().selectedItem().TipoCampoAdicional==1){c.juridica[0].SegmentoInversion=a.txtSegmentoInversion.val();c.juridica[0].NroAseguradora=a.txtNumeroAseguradora.val()}c.juridica[0].DomicilioLegalCalle=a.txtDomicilioLegalCalle.val();c.juridica[0].DomicilioLegalNumero=a.txtDomicilioLegalNumero.val();c.juridica[0].DomicilioLegalPiso=a.txtDomicilioLegalPiso.val();c.juridica[0].DomicilioLegalDepartamento=a.txtDomicilioLegalDepartamento.val();c.juridica[0].DomicilioLegalidPais=((a.ddlDomicilioLegalPais.swidget().selectedItem())?a.ddlDomicilioLegalPais.swidget().selectedItem().idPais:null);c.juridica[0].DomicilioLegalidProvincia=((a.ddlDomicilioLegalProvincia.swidget().selectedItem())?a.ddlDomicilioLegalProvincia.swidget().selectedItem().idProvincia:null);c.juridica[0].DomicilioLegalCiudad=a.txtDomicilioLegalLocalidad.val();c.juridica[0].DomicilioLegalCodigoPostal=a.txtDomicilioLegalCodigoPostal.val();c.juridica[0].email="";if(a.ddlEmailNotificacionesCantidad.swidget().selectedItem()){if(a.ddlEmailNotificacionesCantidad.swidget().selectedItem().value>=1){c.juridica[0].email=a.txtEmailNotificaciones1.val()}if(a.ddlEmailNotificacionesCantidad.swidget().selectedItem().value>=2){c.juridica[0].email+=(","+a.txtEmailNotificaciones2.val())}if(a.ddlEmailNotificacionesCantidad.swidget().selectedItem().value>=3){c.juridica[0].email+=(","+a.txtEmailNotificaciones3.val())}if(a.ddlEmailNotificacionesCantidad.swidget().selectedItem().value==4){c.juridica[0].email+=(","+a.txtEmailNotificaciones4.val())}}c.juridica[0].DomicilioLegalTelefonoFijo=a.txtTelefonoParticularArea.swidget().value()+"-"+a.txtTelefonoParticularNumero.swidget().value();if((a.txtTelefonoParticularArea.swidget().value()||a.txtTelefonoParticularNumero.swidget().value())&&!a.isValidPhone(c.juridica[0].DomicilioLegalTelefonoFijo)){Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularArea,true);Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularNumero,true);d.value=false;a.divAlert.text("El teléfono ingresado no es válido.");a.divAlert.slideDown()}if(a.txtTelefonoParticularArea.swidget().value()&&!Core.Functions.Validations.isNumeric(a.txtTelefonoParticularArea.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularArea,true);d.value=false;if(a.txtTelefonoParticularArea.swidget().value()){a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}}if(a.txtTelefonoParticularNumero.swidget().value()&&!Core.Functions.Validations.isNumeric(a.txtTelefonoParticularNumero.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularNumero,true);d.value=false;if(a.txtTelefonoParticularNumero.swidget().value()){a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}}if(a.ddlTelefonoCelularPais.swidget().selectedItem()!=null&&a.ddlTelefonoCelularPais.swidget().selectedItem().value==a.phoneCodeAr){c.juridica[0].DomicilioLegalTelefonoMovil="+"+a.ddlTelefonoCelularPais.swidget().selectedItem().value+"-"+a.txtTelefonoCelularArea.swidget().value()+"-"+a.txtTelefonoCelularNumero.swidget().value()}else{c.juridica[0].DomicilioLegalTelefonoMovil="+"+a.ddlTelefonoCelularPais.swidget().selectedItem().value+"-"+a.txtTelefonoCelularNumero.swidget().value()}if(((a.ddlTelefonoCelularPais.swidget().selectedItem().value==a.phoneCodeAr&&a.txtTelefonoCelularArea.swidget().value())||a.txtTelefonoCelularNumero.swidget().value())&&!a.isValidPhone(c.juridica[0].DomicilioLegalTelefonoMovil)){Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularArea,true);Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularNumero,true);d.value=false;a.divAlert.text("El teléfono ingresado no es válido.");a.divAlert.slideDown()}if(a.ddlTelefonoCelularPais.swidget().selectedItem().value==a.phoneCodeAr&&(a.txtTelefonoCelularArea.swidget().value()&&!Core.Functions.Validations.isNumeric(a.txtTelefonoCelularArea.swidget().value()))){Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularArea,true);d.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(a.txtTelefonoCelularNumero.swidget().value()&&!Core.Functions.Validations.isNumeric(a.txtTelefonoCelularNumero.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularNumero,true);d.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}c.juridica[0].tributaEnOtroPais1=0;c.juridica[0].tributaEnOtroPais2=0;c.juridica[0].tributaEnOtroPais3=0;if(a.ddlCantidadResidenciasFiscales.swidget().selectedItem()){if(a.ddlCantidadResidenciasFiscales.swidget().selectedItem().value>=1){c.juridica[0].idTipoIdentificadorFiscal1=((a.ddlTributaTipoIdentificadorFiscal1.swidget().selectedItem())?a.ddlTributaTipoIdentificadorFiscal1.swidget().selectedItem().idTipoIdentificadorFiscal:null);c.juridica[0].NIT1=a.txtTributaNit1.val();c.juridica[0].tributaEnOtroPais1=1}if(a.ddlCantidadResidenciasFiscales.swidget().selectedItem().value>=2){c.juridica[0].idTipoIdentificadorFiscal2=((a.ddlTributaTipoIdentificadorFiscal2.swidget().selectedItem())?a.ddlTributaTipoIdentificadorFiscal2.swidget().selectedItem().idTipoIdentificadorFiscal:null);c.juridica[0].NIT2=a.txtTributaNit2.val();c.juridica[0].tributaEnOtroPais2=1}if(a.ddlCantidadResidenciasFiscales.swidget().selectedItem().value>=3){c.juridica[0].idTipoIdentificadorFiscal3=((a.ddlTributaTipoIdentificadorFiscal3.swidget().selectedItem())?a.ddlTributaTipoIdentificadorFiscal3.swidget().selectedItem().idTipoIdentificadorFiscal:null);c.juridica[0].NIT3=a.txtTributaNit3.val();c.juridica[0].tributaEnOtroPais3=1}}c.juridica[0].idTipoOCDE=((a.ddlTipoOcde.swidget().selectedItem())?a.ddlTipoOcde.swidget().selectedItem().idTipoOCDE:null);c.juridica[0].idTipoFATCA=((a.ddlCiudadaniaEEUU.swidget().selectedItem())?a.ddlCiudadaniaEEUU.swidget().selectedItem().idTipoFATCA:null);if(a.ddlCiudadaniaEEUU.swidget().selectedItem()){if(a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==1||a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==5){c.juridica[0].tieneBeneficiariosEstadounidenses=a.chkPoseeBeneficiariosEstadounidenses.swidget().checked()?1:0;if(a.chkPoseeBeneficiariosEstadounidenses.swidget().checked()){if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem()){if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=1){c.juridica[0].beneficiarioEEUU1Nombre=a.txtBeneficiarioEstadounidenseNombre1.val();c.juridica[0].beneficiarioEEUU1TIN=a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU1.val();c.juridica[0].beneficiarioEEUU1PorcPart=Core.Functions.Decimal.parseFloat(a.txtBeneficiarioEstadounidensePorcentajeParticipacion1.val())}if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=2){c.juridica[0].beneficiarioEEUU2Nombre=a.txtBeneficiarioEstadounidenseNombre2.val();c.juridica[0].beneficiarioEEUU2TIN=a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU2.val();c.juridica[0].beneficiarioEEUU2PorcPart=Core.Functions.Decimal.parseFloat(a.txtBeneficiarioEstadounidensePorcentajeParticipacion2.val())}if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=3){c.juridica[0].beneficiarioEEUU3Nombre=a.txtBeneficiarioEstadounidenseNombre3.val();c.juridica[0].beneficiarioEEUU3TIN=a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU3.val();c.juridica[0].beneficiarioEEUU3PorcPart=Core.Functions.Decimal.parseFloat(a.txtBeneficiarioEstadounidensePorcentajeParticipacion3.val())}if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=4){c.juridica[0].beneficiarioEEUU4Nombre=a.txtBeneficiarioEstadounidenseNombre4.val();c.juridica[0].beneficiarioEEUU4TIN=a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU4.val();c.juridica[0].beneficiarioEEUU4PorcPart=Core.Functions.Decimal.parseFloat(a.txtBeneficiarioEstadounidensePorcentajeParticipacion4.val())}if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=5){c.juridica[0].beneficiarioEEUU5Nombre=a.txtBeneficiarioEstadounidenseNombre5.val();c.juridica[0].beneficiarioEEUU5TIN=a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU5.val();c.juridica[0].beneficiarioEEUU5PorcPart=Core.Functions.Decimal.parseFloat(a.txtBeneficiarioEstadounidensePorcentajeParticipacion5.val())}if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=6){c.juridica[0].beneficiarioEEUU6Nombre=a.txtBeneficiarioEstadounidenseNombre6.val();c.juridica[0].beneficiarioEEUU6TIN=a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU6.val();c.juridica[0].beneficiarioEEUU6PorcPart=Core.Functions.Decimal.parseFloat(a.txtBeneficiarioEstadounidensePorcentajeParticipacion6.val())}}}}if(a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==2){c.juridica[0].idInstitucionFinancieraExtranjera=((a.ddlTipoInstitucionFinancieraExtranjera.swidget().selectedItem())?a.ddlTipoInstitucionFinancieraExtranjera.swidget().selectedItem().idTipoInstitucionFinancieraExtranjera:null);c.juridica[0].InstitucionFinancieraExtranjeraGIIN=a.txtInstitucionFinancieraExtranjeraGIIN.val()}if(a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==3){c.juridica[0].idPersonaJuridicaExenta=((a.ddlTipoPersonaJuridicaExenta.swidget().selectedItem())?a.ddlTipoPersonaJuridicaExenta.swidget().selectedItem().idPersonaJuridicaExenta:null)}if(a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==4){c.juridica[0].idReporteDirectoIRS=((a.ddlTipoReporteDirectoIRS.swidget().selectedItem())?a.ddlTipoReporteDirectoIRS.swidget().selectedItem().idReporteDirectoIRS:null);c.juridica[0].reportaDirectoIRSGIIN=a.txtReporteDirectoIRSGIIN.val()}if(a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==5){c.juridica[0].esPersonaEstadounidenseTIN=a.txtPersonaEstadounidenseTIN.val()}}c.juridica[0].idTipoEntidadCRS=((a.ddlTipoEntidadCRS.swidget().selectedItem())?a.ddlTipoEntidadCRS.swidget().selectedItem().idTipoEntidadCRS:null);if(a.ddlTipoEntidadCRS.swidget().selectedItem()){if(a.ddlTipoEntidadCRS.swidget().selectedItem().idTipoEntidadCRS==1){c.juridica[0].idTipoEntidadCRSTipoEntidadInversion=((a.ddlTipoEntidadCRSEntidadInversion.swidget().selectedItem())?a.ddlTipoEntidadCRSEntidadInversion.swidget().selectedItem().idTipoEntidadCRSTipoEntidadInversion:null);c.juridica[0].TipoEntidadCRSGIIN=a.txtTipoEntidadCRSGiin.val();if(a.ddlTipoEntidadCRSEntidadInversion.swidget().selectedItem()&&a.ddlTipoEntidadCRSEntidadInversion.swidget().selectedItem().idTipoEntidadCRSTipoEntidadInversion==1){c.juridica[0].TipoEntidadCRSNombreApellido=a.txtTipoEntidadCRSNombreApellido.val()}}if(a.ddlTipoEntidadCRS.swidget().selectedItem().idTipoEntidadCRS==2){c.juridica[0].TipoEntidadCRSGIIN=a.txtTipoEntidadCRSGiin.val()}if(a.ddlTipoEntidadCRS.swidget().selectedItem().idTipoEntidadCRS==3){c.juridica[0].TipoEntidadCRSMercadoDondeCotiza=a.txtTipoEntidadCRSMercadoDondeCotiza.val();c.juridica[0].TipoEntidadCRSCompaniaPublicaRelacionada=a.txtTipoEntidadCRSCompaniaPublicaRelacionada.val()}if(a.ddlTipoEntidadCRS.swidget().selectedItem().idTipoEntidadCRS==7){c.juridica[0].TipoEntidadCRSNombreApellido=a.txtTipoEntidadCRSNombreApellido.val()}}if(Core.Objects.Context.Configuration.idAplicacion==3){c.juridica[0].montoCompliance=a.txtMontoCompliance.val();c.juridica[0].idRiesgo=a.ddlRiesgoCliente.swidget().value()}else{c.juridica[0].montoCompliance=a.dataCuenta!=null?a.dataCuenta.juridica[0].montoCompliance:"";c.juridica[0].idRiesgo=a.dataCuenta!=null?a.dataCuenta.juridica[0].idRiesgo:null}c.personas=a.personas;c.archivos=a.archivos;c.observaciones=a.observaciones;c.contactoOriginal=a.chkIngresoAsesorFinanciero.swidget().checked()?a.txtIngresoAsesorFinanciero.val():"";c.cuentaComitente=1;c.cuentaCuotapartista=0;if(d.value){return c}else{return null}};a.getRequestDataValidated=function(){var g={value:true};var f={};f.EsJuridica=1;f.tipoFirma=a.getSelectedTipoFirma(g);f.PatrimonioIngresosOperativos=a.chkOrigenPatrimonioIngresosOperativos.swidget().checked()?1:0;f.PatrimonioAportesDeCapital=a.chkOrigenPatrimonioAportesCapital.swidget().checked()?1:0;f.PatrimonioSuscripcionCuotaspartes=a.chkOrigenPatrimonioSuscripcionCuotapartes.swidget().checked()?1:0;f.PatrimonioVentaDeActivosFijos=a.chkOrigenPatrimonioVentaActivosFijos.swidget().checked()?1:0;f.PatrimonioDonacion=a.chkOrigenPatrimonioDonacion.swidget().checked()?1:0;f.PatrimonioInversionesAnteriores=a.chkOrigenPatrimonioInversionesAnteriores.swidget().checked()?1:0;f.patrimonioOtro=a.getOrigenPatrimonioOtro(g);f.FondeoCuentaTransferenciaTitulosCuentaInversion=a.chkFondeoCuentaTransferenciaTitulosCuentaInversion.swidget().checked()?1:0;f.FondeoCuentaTransferenciaDineroCuentaInversion=a.chkFondeoCuentaTransferenciaDineroCuentaInversion.swidget().checked()?1:0;f.FondeoCuentaTransferenciaDineroBanco=a.chkFondeoCuentaTransferenciaDineroBanco.swidget().checked()?1:0;f.FondeoCuentaOtros=a.chkFondeoCuentaOtro.swidget().checked()?Core.Functions.Validations.getValidatedSwidgetValue(a.txtFondeoCuentaOtroDetalle,g):"";f.CantidadTransferenciaHaciaCuentaInversion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtCantidadTransferenciasHaciaCuentaPorAnio,g);f.PaisesOrigenTransferencias=Core.Functions.Validations.getValidatedSwidgetValue(a.txtPaisesCuentaOrigen,g);f.CantidadTransferenciaDesdeCuentaInversion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtCantidadTransferenciasDesdeCuentaPorAnio,g);f.PaisesDestinoTransferencias=Core.Functions.Validations.getValidatedSwidgetValue(a.txtPaisesCuentaDestino,g);f.idCanal=a.getSelectedCanal(g);if(f.idCanal==Core.Business.eCanal.Otro){f.canalOtro=a.getCanalOtro(g)}f.comoLlegoABalanz=Core.Functions.Validations.getValidatedSwidgetValue(a.txtComoLlegoABalanz,g);f.descripcionActividadCliente=Core.Functions.Validations.getValidatedSwidgetValue(a.txtDescripcionActividadCliente,g);f.CambiosSignificativosPatrimonio=a.chkCambiosSignificativosPatrimonio.swidget().checked()?Core.Functions.Validations.getValidatedSwidgetValue(a.txtCambiosSignificativosPatrimonioDetalle,g):"";f.ReferenciaBancariaNombre=Core.Functions.Validations.getValidatedSwidgetValue(a.txtReferenciaBancariaNombre,g);f.ReferenciaBancariaApellido=Core.Functions.Validations.getValidatedSwidgetValue(a.txtReferenciaBancariaApellido,g);f.ReferenciaBancariaCargo=Core.Functions.Validations.getValidatedDropDownValue(a.ddlReferenciaBancariaCargo,g);f.ReferenciaBancariaInstitucion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtReferenciaBancariaInstitucion,g);f.ReferenciaBancariaTelefono=Core.Functions.Validations.getValidatedSwidgetValue(a.txtReferenciaBancariaTelefono,g);f.ReferenciaBancariaEMail=Core.Functions.Validations.getValidatedSwidgetValue(a.txtReferenciaBancariaEmail,g);f.ReferenciaBancariaDomicilioCalle=Core.Functions.Validations.getValidatedSwidgetValue(a.txtReferenciaBancariaDomicilio,g);f.ReferenciaBancariaDomicilioCiudad=Core.Functions.Validations.getValidatedSwidgetValue(a.txtReferenciaBancariaCiudad,g);f.ReferenciaBancariaDomicilioidPais=Core.Functions.Validations.getValidatedDropDownValue(a.ddlReferenciaBancariaPais,g);f.OrdenesYComunicacionesPorEscrito=a.chkOrdenesComunicacionesEscrito.swidget().checked()?1:0;f.OrdenesYComunicacionesPorMail=a.chkOrdenesComunicacionesEmail.swidget().checked()?Core.Functions.Validations.getValidatedSwidgetValue(a.txtOrdenesComunicacionesEmail,g):"";f.OrdenesYComunicacionesConvenioDeOperacion=a.chkOrdenesComunicacionesConvenioOperacion.swidget().checked()?1:0;f.usuarioAsignado=a.txtUsuarioAsignado.val();f.tipoInversionAcciones=a.chkTipoInversionAcciones.swidget().checked()?1:0;f.tipoInversionOpciones=a.chkTipoInversionOpciones.swidget().checked()?1:0;f.tipoInversionFondos=a.chkTipoInversionFondos.swidget().checked()?1:0;f.tipoInversionTitulosPublicos=a.chkTipoInversionBonos.swidget().checked()?1:0;f.tipoInversionFuturos=a.chkTipoInversionFuturos.swidget().checked()?1:0;f.tipoInversionOtros=a.getTipoInversionOtro(g);f.ExperienciaEnInversionesAcciones=a.chkExperienciaInversionesAcciones.swidget().checked()?1:0;f.ExperienciaEnInversionesOpciones=a.chkExperienciaInversionesOpciones.swidget().checked()?1:0;f.ExperienciaEnInversionesFondos=a.chkExperienciaInversionesFondos.swidget().checked()?1:0;f.ExperienciaEnInversionesBonos=a.chkExperienciaInversionesBonos.swidget().checked()?1:0;f.ExperienciaEnInversionesFuturos=a.chkExperienciaInversionesFuturos.swidget().checked()?1:0;f.ExperienciaEnInversionesOtros=a.getExperienciaInversionesOtro(g);f.plazoAproxInversion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtPlazoInversion,g);f.idPersonaAsesor=Core.Functions.Validations.getValidatedDropDownValue(a.ddlAsesor,g);f.idArancel=Core.Functions.Validations.getValidatedDropDownValue(a.ddlArancel,g);f.UsarFirmaDigital=a.chkUsarFirmaDigital.swidget().checked()?1:0;if(a.dataCuenta!=null){f.idEstadoAperturaCuenta=Core.Functions.Validations.getValidatedDropDownValue(a.ddlEstado,g);f.idAperturaCuenta=a.dataCuenta.datos[0].idAperturaCuenta;f.version=a.dataCuenta.datos[0].version;f.hash=a.dataCuenta.datos[0].hash;f.AceptoTyC=a.dataCuenta.datos[0].AceptoTyC;f.idPaso=a.dataCuenta.datos[0].idPaso;f.idSubPaso=a.dataCuenta.datos[0].idSubPaso;f.nombreOriginal=a.dataCuenta.datos[0].nombreOriginal;f.emailOriginal=a.dataCuenta.datos[0].emailOriginal;f.idCuentaExistente=a.dataCuenta.datos[0].idCuentaExistente;f.idExterno=a.dataCuenta.datos[0].idExterno;f.AceptoMandatoDiscrecional=a.dataCuenta.datos[0].AceptoMandatoDiscrecional;f.SolicitarMandatoDiscrecional=a.dataCuenta.datos[0].SolicitarMandatoDiscrecional}else{f.idNegocio=Core.Enums.eNegocio.BCI}if(!f.tipoInversionAcciones&&!f.tipoInversionTitulosPublicos&&!f.tipoInversionFideicomisos&&!f.tipoInversionOpciones&&!f.tipoInversionFondos&&!f.tipoInversionOtros&&!f.tipoInversionChequePagoDiferido&&!f.tipoInversionFuturos&&!f.tipoInversionObligacionesNegociables&&!f.tipoInversionTitulosPublicos){g.value=false;a.divAlert.text("Debe seleccionar el tipo de inversión.");a.divAlert.slideDown()}if(!f.ExperienciaEnInversionesAcciones&&!f.ExperienciaEnInversionesOpciones&&!f.ExperienciaEnInversionesFondos&&!f.ExperienciaEnInversionesBonos&&!f.ExperienciaEnInversionesFuturos&&!f.ExperienciaEnInversionesOtros){g.value=false;a.divAlert.text("Debe seleccionar la experiencia en inversión.");a.divAlert.slideDown()}if(a.chkIngresoAsesorFinanciero.swidget().checked()&&(!a.txtIngresoAsesorFinanciero.val()||!a.isValidEmailAddress(a.txtIngresoAsesorFinanciero.val()))){g.value=false;a.divAlert.text("Debe ingresar el email del contacto.");a.divAlert.slideDown()}else{f.contactoOriginal=a.chkIngresoAsesorFinanciero.swidget().checked()?a.txtIngresoAsesorFinanciero.val():""}f.cuentaComitente=1;f.cuentaCuotapartista=0;f.juridica=a.dataCuenta!=null&&a.dataCuenta.juridica?a.dataCuenta.juridica:[{}];f.juridica[0].idMontoAInvertirJuridica=a.getSelectedMontoAInvertir(g);f.juridica[0].ingresosAnuales=a.getSelectedIngresosAnuales(g);f.juridica[0].patrimonioNeto=a.getSelectedPatrimonioNeto(g);f.juridica[0].idNivelExperienciaInversion=a.getSelectedNivelExperienciaInversion(g);f.juridica[0].idRelacionInversionPatrimonio=a.getSelectedRelacionInversionPatrimonio(g);f.juridica[0].idObjetivoInversion=a.getSelectedObjetivoInversion(g);if(f.juridica[0].idObjetivoInversion==Core.Business.eAmountRange.Hasta200){f.juridica[0].ObjetivoInversionPeriodoDetalle=Core.Functions.Validations.getValidatedSwidgetValue(a.txtObjetivoInversionDetallePeriodo,g)}f.juridica[0].idNivelToleranciaAlRiesgo=a.getSelectedNivelToleranciaAlRiesgo(g);f.juridica[0].idTipoIdentificadorFiscal=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoIdentificacionFiscal,g);f.juridica[0].CUIT=Core.Functions.Validations.getValidatedSwidgetValue(a.txtIdentificacionFiscal,g);if(a.ddlPaisTipoIdentificacionFiscal.swidget().value()==a.idPais_Argentina&&(!Core.Functions.Validations.isNumeric(a.txtIdentificacionFiscal.val())||!Core.Functions.Validations.isCuit(a.txtIdentificacionFiscal.val()))){Core.Functions.Validations.toggleValidation(a.txtIdentificacionFiscal,true);g.value=false;a.divAlert.text("Debe ingresar un identificador fiscal válido.");a.divAlert.slideDown()}f.juridica[0].RazonSocial=Core.Functions.Validations.getValidatedSwidgetValue(a.txtRazonSocial,g);f.juridica[0].NombreComercial=a.txtNombreComercial.val();f.juridica[0].Nacionalidad=Core.Functions.Validations.getValidatedDropDownValue(a.ddlNacionalidad,g);f.juridica[0].LugarConstitucion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlLugarConstitucion,g);f.juridica[0].idTipoPersonaJuridica=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoPersonaJuridica,g);f.juridica[0].idTipoRegistracionJuridica=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoRegistracionJuridica,g);f.juridica[0].NroInscripcion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtNumeroInscripcion,g);f.juridica[0].FechaConstitucion=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaConstitucion,g));f.juridica[0].Libro=Core.Functions.Validations.getValidatedSwidgetValue(a.txtLibro,g);f.juridica[0].Tomo=Core.Functions.Validations.getValidatedSwidgetValue(a.txtTomo,g);f.juridica[0].idActividadJuridica=Core.Functions.Validations.getValidatedDropDownValue(a.ddlActividadPrincipal,g);if(a.ddlActividadPrincipal.swidget().selectedItem()&&a.ddlActividadPrincipal.swidget().selectedItem().idActividadJuridica==Core.Business.eActividadPrincipalJuridica.Otro){f.juridica[0].OcupacionDescripcion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtActividadPrincipalOtro,g)}if(a.ddlActividadPrincipal.swidget().selectedItem()&&a.ddlActividadPrincipal.swidget().selectedItem().TipoCampoAdicional==1){f.juridica[0].SegmentoInversion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtSegmentoInversion,g);f.juridica[0].NroAseguradora=Core.Functions.Validations.getValidatedSwidgetValue(a.txtNumeroAseguradora,g)}f.juridica[0].DomicilioLegalCalle=Core.Functions.Validations.getValidatedSwidgetValue(a.txtDomicilioLegalCalle,g);f.juridica[0].DomicilioLegalNumero=Core.Functions.Validations.getValidatedSwidgetValue(a.txtDomicilioLegalNumero,g);f.juridica[0].DomicilioLegalPiso=a.txtDomicilioLegalPiso.val();f.juridica[0].DomicilioLegalDepartamento=a.txtDomicilioLegalDepartamento.val();f.juridica[0].DomicilioLegalidPais=Core.Functions.Validations.getValidatedDropDownValue(a.ddlDomicilioLegalPais,g);f.juridica[0].DomicilioLegalidProvincia=Core.Functions.Validations.getValidatedDropDownValue(a.ddlDomicilioLegalProvincia,g);f.juridica[0].DomicilioLegalCiudad=Core.Functions.Validations.getValidatedSwidgetValue(a.txtDomicilioLegalLocalidad,g);f.juridica[0].DomicilioLegalCodigoPostal=Core.Functions.Validations.getValidatedSwidgetValue(a.txtDomicilioLegalCodigoPostal,g);f.juridica[0].email="";if(a.ddlEmailNotificacionesCantidad.swidget().selectedItem()){if(a.ddlEmailNotificacionesCantidad.swidget().selectedItem().value>=1){f.juridica[0].email=Core.Functions.Validations.getValidatedSwidgetValue(a.txtEmailNotificaciones1,g)}if(a.ddlEmailNotificacionesCantidad.swidget().selectedItem().value>=2){f.juridica[0].email+=(","+Core.Functions.Validations.getValidatedSwidgetValue(a.txtEmailNotificaciones2,g))}if(a.ddlEmailNotificacionesCantidad.swidget().selectedItem().value>=3){f.juridica[0].email+=(","+Core.Functions.Validations.getValidatedSwidgetValue(a.txtEmailNotificaciones3,g))}if(a.ddlEmailNotificacionesCantidad.swidget().selectedItem().value==4){f.juridica[0].email+=(","+Core.Functions.Validations.getValidatedSwidgetValue(a.txtEmailNotificaciones4,g))}}f.juridica[0].DomicilioLegalTelefonoFijo=a.txtTelefonoParticularArea.swidget().value()+"-"+a.txtTelefonoParticularNumero.swidget().value();if(!a.isValidPhone(f.juridica[0].DomicilioLegalTelefonoFijo)){Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularArea,true);Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularNumero,true);g.value=false;a.divAlert.text("El teléfono ingresado no es válido.");a.divAlert.slideDown()}if(!a.txtTelefonoParticularArea.swidget().value()||!Core.Functions.Validations.isNumeric(a.txtTelefonoParticularArea.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularArea,true);g.value=false;if(a.txtTelefonoParticularArea.swidget().value()){a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}}if(!a.txtTelefonoParticularNumero.swidget().value()||!Core.Functions.Validations.isNumeric(a.txtTelefonoParticularNumero.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularNumero,true);g.value=false;if(a.txtTelefonoParticularNumero.swidget().value()){a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}}if(a.ddlTelefonoCelularPais.swidget().selectedItem()!=null&&a.ddlTelefonoCelularPais.swidget().selectedItem().value==a.phoneCodeAr){f.juridica[0].DomicilioLegalTelefonoMovil="+"+a.ddlTelefonoCelularPais.swidget().selectedItem().value+"-"+a.txtTelefonoCelularArea.swidget().value()+"-"+a.txtTelefonoCelularNumero.swidget().value()}else{f.juridica[0].DomicilioLegalTelefonoMovil="+"+a.ddlTelefonoCelularPais.swidget().selectedItem().value+"-"+a.txtTelefonoCelularNumero.swidget().value()}if(((a.ddlTelefonoCelularPais.swidget().selectedItem().value==a.phoneCodeAr&&a.txtTelefonoCelularArea.swidget().value())||a.txtTelefonoCelularNumero.swidget().value())&&!a.isValidPhone(f.juridica[0].DomicilioLegalTelefonoMovil)){Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularArea,true);Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularNumero,true);g.value=false;a.divAlert.text("El teléfono ingresado no es válido.");a.divAlert.slideDown()}if(a.ddlTelefonoCelularPais.swidget().selectedItem().value==a.phoneCodeAr&&(a.txtTelefonoCelularArea.swidget().value()&&!Core.Functions.Validations.isNumeric(a.txtTelefonoCelularArea.swidget().value()))){Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularArea,true);g.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(a.txtTelefonoCelularNumero.swidget().value()&&!Core.Functions.Validations.isNumeric(a.txtTelefonoCelularNumero.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularNumero,true);g.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}f.juridica[0].tributaEnOtroPais1=0;f.juridica[0].tributaEnOtroPais2=0;f.juridica[0].tributaEnOtroPais3=0;if(a.ddlCantidadResidenciasFiscales.swidget().selectedItem()){f.juridica[0].idTipoIdentificadorFiscal1=0;f.juridica[0].NIT1="";if(a.ddlCantidadResidenciasFiscales.swidget().selectedItem().value>=1){f.juridica[0].idTipoIdentificadorFiscal1=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTributaTipoIdentificadorFiscal1,g);f.juridica[0].NIT1=Core.Functions.Validations.getValidatedSwidgetValue(a.txtTributaNit1,g);f.juridica[0].tributaEnOtroPais1=1;if(a.ddlTributaPais1.swidget().value()==a.idPais_Argentina&&(!Core.Functions.Validations.isNumeric(a.txtTributaNit1.val())||!Core.Functions.Validations.isCuit(a.txtTributaNit1.val()))){Core.Functions.Validations.toggleValidation(a.txtTributaNit1,true);g.value=false;a.divAlert.text("Debe ingresar un identificador fiscal válido.");a.divAlert.slideDown()}}f.juridica[0].idTipoIdentificadorFiscal2=0;f.juridica[0].NIT2="";if(a.ddlCantidadResidenciasFiscales.swidget().selectedItem().value>=2){f.juridica[0].idTipoIdentificadorFiscal2=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTributaTipoIdentificadorFiscal2,g);f.juridica[0].NIT2=Core.Functions.Validations.getValidatedSwidgetValue(a.txtTributaNit2,g);f.juridica[0].tributaEnOtroPais2=1;if(a.ddlTributaPais2.swidget().value()==a.idPais_Argentina&&(!Core.Functions.Validations.isNumeric(a.txtTributaNit2.val())||!Core.Functions.Validations.isCuit(a.txtTributaNit2.val()))){Core.Functions.Validations.toggleValidation(a.txtTributaNit2,true);g.value=false;a.divAlert.text("Debe ingresar un identificador fiscal válido.");a.divAlert.slideDown()}}f.juridica[0].idTipoIdentificadorFiscal3=0;f.juridica[0].NIT3="";if(a.ddlCantidadResidenciasFiscales.swidget().selectedItem().value>=3){f.juridica[0].idTipoIdentificadorFiscal3=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTributaTipoIdentificadorFiscal3,g);f.juridica[0].NIT3=Core.Functions.Validations.getValidatedSwidgetValue(a.txtTributaNit3,g);f.juridica[0].tributaEnOtroPais3=1;if(a.ddlTributaPais3.swidget().value()==a.idPais_Argentina&&(!Core.Functions.Validations.isNumeric(a.txtTributaNit3.val())||!Core.Functions.Validations.isCuit(a.txtTributaNit3.val()))){Core.Functions.Validations.toggleValidation(a.txtTributaNit3,true);g.value=false;a.divAlert.text("Debe ingresar un identificador fiscal válido.");a.divAlert.slideDown()}}}f.juridica[0].idTipoOCDE=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOcde,g);f.juridica[0].idTipoFATCA=Core.Functions.Validations.getValidatedDropDownValue(a.ddlCiudadaniaEEUU,g);if(a.ddlCiudadaniaEEUU.swidget().selectedItem()){if(a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==1||a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==5){f.juridica[0].tieneBeneficiariosEstadounidenses=a.chkPoseeBeneficiariosEstadounidenses.swidget().checked()?1:0;if(a.chkPoseeBeneficiariosEstadounidenses.swidget().checked()){if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem()){var e=0;f.juridica[0].beneficiarioEEUU1Nombre="";f.juridica[0].beneficiarioEEUU1TIN="";f.juridica[0].beneficiarioEEUU1PorcPart=0;if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=1){f.juridica[0].beneficiarioEEUU1Nombre=Core.Functions.Validations.getValidatedSwidgetValue(a.txtBeneficiarioEstadounidenseNombre1,g);f.juridica[0].beneficiarioEEUU1TIN=Core.Functions.Validations.getValidatedSwidgetValue(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU1,g);f.juridica[0].beneficiarioEEUU1PorcPart=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtBeneficiarioEstadounidensePorcentajeParticipacion1,g));e+=f.juridica[0].beneficiarioEEUU1PorcPart}f.juridica[0].beneficiarioEEUU2Nombre="";f.juridica[0].beneficiarioEEUU2TIN="";f.juridica[0].beneficiarioEEUU2PorcPart=0;if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=2){f.juridica[0].beneficiarioEEUU2Nombre=Core.Functions.Validations.getValidatedSwidgetValue(a.txtBeneficiarioEstadounidenseNombre2,g);f.juridica[0].beneficiarioEEUU2TIN=Core.Functions.Validations.getValidatedSwidgetValue(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU2,g);f.juridica[0].beneficiarioEEUU2PorcPart=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtBeneficiarioEstadounidensePorcentajeParticipacion2,g));e+=f.juridica[0].beneficiarioEEUU2PorcPart}f.juridica[0].beneficiarioEEUU3Nombre="";f.juridica[0].beneficiarioEEUU3TIN="";f.juridica[0].beneficiarioEEUU3PorcPart=0;if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=3){f.juridica[0].beneficiarioEEUU3Nombre=Core.Functions.Validations.getValidatedSwidgetValue(a.txtBeneficiarioEstadounidenseNombre3,g);f.juridica[0].beneficiarioEEUU3TIN=Core.Functions.Validations.getValidatedSwidgetValue(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU3,g);f.juridica[0].beneficiarioEEUU3PorcPart=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtBeneficiarioEstadounidensePorcentajeParticipacion3,g));e+=f.juridica[0].beneficiarioEEUU3PorcPart}f.juridica[0].beneficiarioEEUU4Nombre="";f.juridica[0].beneficiarioEEUU4TIN="";f.juridica[0].beneficiarioEEUU4PorcPart=0;if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=4){f.juridica[0].beneficiarioEEUU4Nombre=Core.Functions.Validations.getValidatedSwidgetValue(a.txtBeneficiarioEstadounidenseNombre4,g);f.juridica[0].beneficiarioEEUU4TIN=Core.Functions.Validations.getValidatedSwidgetValue(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU4,g);f.juridica[0].beneficiarioEEUU4PorcPart=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtBeneficiarioEstadounidensePorcentajeParticipacion4,g));e+=f.juridica[0].beneficiarioEEUU4PorcPart}f.juridica[0].beneficiarioEEUU5Nombre="";f.juridica[0].beneficiarioEEUU5TIN="";f.juridica[0].beneficiarioEEUU5PorcPart=0;if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=5){f.juridica[0].beneficiarioEEUU5Nombre=Core.Functions.Validations.getValidatedSwidgetValue(a.txtBeneficiarioEstadounidenseNombre5,g);f.juridica[0].beneficiarioEEUU5TIN=Core.Functions.Validations.getValidatedSwidgetValue(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU5,g);f.juridica[0].beneficiarioEEUU5PorcPart=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtBeneficiarioEstadounidensePorcentajeParticipacion5,g));e+=f.juridica[0].beneficiarioEEUU5PorcPart}f.juridica[0].beneficiarioEEUU6Nombre="";f.juridica[0].beneficiarioEEUU6TIN="";f.juridica[0].beneficiarioEEUU6PorcPart=0;if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=6){f.juridica[0].beneficiarioEEUU6Nombre=Core.Functions.Validations.getValidatedSwidgetValue(a.txtBeneficiarioEstadounidenseNombre6,g);f.juridica[0].beneficiarioEEUU6TIN=Core.Functions.Validations.getValidatedSwidgetValue(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU6,g);f.juridica[0].beneficiarioEEUU6PorcPart=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtBeneficiarioEstadounidensePorcentajeParticipacion6,g));e+=f.juridica[0].beneficiarioEEUU6PorcPart}if(e>100){Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion1,true);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion2,true);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion3,true);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion4,true);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion5,true);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion6,true);g.value=false;a.divAlert.text("Los porcentajes de participación ingresados no deben superar el 100%.");a.divAlert.slideDown()}}}}if(a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==2){f.juridica[0].idInstitucionFinancieraExtranjera=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoInstitucionFinancieraExtranjera,g);f.juridica[0].InstitucionFinancieraExtranjeraGIIN=Core.Functions.Validations.getValidatedSwidgetValue(a.txtInstitucionFinancieraExtranjeraGIIN,g)}if(a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==3){f.juridica[0].idPersonaJuridicaExenta=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoPersonaJuridicaExenta,g)}if(a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==4){f.juridica[0].idReporteDirectoIRS=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoReporteDirectoIRS,g);f.juridica[0].reportaDirectoIRSGIIN=Core.Functions.Validations.getValidatedSwidgetValue(a.txtReporteDirectoIRSGIIN,g)}if(a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==5){f.juridica[0].esPersonaEstadounidenseTIN=Core.Functions.Validations.getValidatedSwidgetValue(a.txtPersonaEstadounidenseTIN,g)}}f.juridica[0].idTipoEntidadCRS=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoEntidadCRS,g);if(a.ddlTipoEntidadCRS.swidget().selectedItem()){if(a.ddlTipoEntidadCRS.swidget().selectedItem().idTipoEntidadCRS==1){f.juridica[0].idTipoEntidadCRSTipoEntidadInversion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoEntidadCRSEntidadInversion,g);f.juridica[0].TipoEntidadCRSGIIN=Core.Functions.Validations.getValidatedSwidgetValue(a.txtTipoEntidadCRSGiin,g);if(a.ddlTipoEntidadCRSEntidadInversion.swidget().selectedItem()&&a.ddlTipoEntidadCRSEntidadInversion.swidget().selectedItem().idTipoEntidadCRSTipoEntidadInversion==1){f.juridica[0].TipoEntidadCRSNombreApellido=Core.Functions.Validations.getValidatedSwidgetValue(a.txtTipoEntidadCRSNombreApellido,g)}}if(a.ddlTipoEntidadCRS.swidget().selectedItem().idTipoEntidadCRS==2){f.juridica[0].TipoEntidadCRSGIIN=Core.Functions.Validations.getValidatedSwidgetValue(a.txtTipoEntidadCRSGiin,g)}if(a.ddlTipoEntidadCRS.swidget().selectedItem().idTipoEntidadCRS==3){f.juridica[0].TipoEntidadCRSMercadoDondeCotiza=Core.Functions.Validations.getValidatedSwidgetValue(a.txtTipoEntidadCRSMercadoDondeCotiza,g);f.juridica[0].TipoEntidadCRSCompaniaPublicaRelacionada=Core.Functions.Validations.getValidatedSwidgetValue(a.txtTipoEntidadCRSCompaniaPublicaRelacionada,g)}if(a.ddlTipoEntidadCRS.swidget().selectedItem().idTipoEntidadCRS==7){f.juridica[0].TipoEntidadCRSNombreApellido=Core.Functions.Validations.getValidatedSwidgetValue(a.txtTipoEntidadCRSNombreApellido,g)}}if(Core.Objects.Context.Configuration.idAplicacion==3){if(a.idTipoValidacion>=10){f.juridica[0].montoCompliance=Core.Functions.Validations.getValidatedNumericInputValue(a.txtMontoCompliance,g);f.juridica[0].idRiesgo=Core.Functions.Validations.getValidatedDropDownValue(a.ddlRiesgoCliente,g)}else{f.juridica[0].montoCompliance=a.txtMontoCompliance.val();f.juridica[0].idRiesgo=a.ddlRiesgoCliente.swidget().value()}}else{f.juridica[0].montoCompliance=a.dataCuenta!=null?a.dataCuenta.juridica[0].montoCompliance:"";f.juridica[0].idRiesgo=a.dataCuenta!=null?a.dataCuenta.juridica[0].idRiesgo:null}var c=new Core.Controls.ManagerPersonaBCI({esCuentaJuridica:true,dataParametros:a.dataParametros});f.personas=a.personas;f.archivos=a.archivos;f.observaciones=a.observaciones;for(var d=0;d<a.personas.length;d++){if(!c.isValidPerson(a.personas[d],a.ddlEstado.swidget().selectedItem().idTipoValidacion)){g.value=false;a.divAlert.text("Revise los datos de la persona: "+a.getTipoDescripcion(a.personas[d].tipo)+" "+a.personas[d].numero+".");a.divAlert.slideDown()}}if(g.value){return f}else{null}};a.getOrigenPatrimonioOtro=function(c){if(!a.chkOrigenPatrimonioOtro.swidget().checked()){return""}else{if(a.txtOrigenPatrimonioOtroDetalle.swidget().value()!=""){return a.txtOrigenPatrimonioOtroDetalle.swidget().value()}else{if(!c){return""}else{c.value=false;a.divAlert.text("Debe ingresar el detalle del origen del patrimonio.");a.divAlert.slideDown();return""}}}};a.getSelectedTipoFirma=function(c){if(a.chkTipoFirmaConjunta.swidget().checked()){return Core.Business.eTipoFirma.Conjunta}else{if(a.chkTipoFirmaIndistinta.swidget().checked()){return Core.Business.eTipoFirma.Indistinta}else{if(!c){return Core.Business.eTipoFirma.Indistinta}else{c.value=false;a.divAlert.text("Debe seleccionar el tipo de firma.");a.divAlert.slideDown();return Core.Business.eTipoFirma.Indistinta}}}};a.getTipoInversionOtro=function(c){if(!a.chkTipoInversionOtro.swidget().checked()){return""}else{if(a.txtTipoInversionOtroDetalle.swidget().value()!=""){return a.txtTipoInversionOtroDetalle.swidget().value()}else{if(!c){return""}else{c.value=false;a.divAlert.text("Debe ingresar el detalle del tipo de inversión.");a.divAlert.slideDown();return""}}}};a.getExperienciaInversionesOtro=function(c){if(!a.chkExperienciaInversionesOtro.swidget().checked()){return""}else{if(a.txtExperienciaInversionesOtroDetalle.swidget().value()!=""){return a.txtExperienciaInversionesOtroDetalle.swidget().value()}else{if(!c){return""}else{c.value=false;a.divAlert.text("Debe ingresar el detalle de la experiencia en inversión.");a.divAlert.slideDown();return""}}}};a.getSelectedCanal=function(f){var d=$(".chk-canal-option");for(var e=0;e<d.length;e++){var c=$(d[e]);if(c.swidget().checked()){return c.attr("idCanalDeVenta")}}if(!f){return Core.Business.eCanal.None}else{f.value=false;a.divAlert.text("Debe seleccionar el canal.");a.divAlert.slideDown();return Core.Business.eCanal.None}};a.getCanalOtro=function(c){if(a.txtCanalOtroDetalle.swidget().value()!=""){return a.txtCanalOtroDetalle.swidget().value()}else{if(!c){return""}else{c.value=false;a.divAlert.text("Debe ingresar el detalle del canal.");a.divAlert.slideDown();return""}}};a.getSelectedMontoAInvertir=function(f){var d=$(".monto-a-invertir-juridica-option");for(var e=0;e<d.length;e++){var c=$(d[e]);if(c.swidget().checked()){return c.attr("idMontoAInvertirJuridica")}}if(a.namespaceActivo=="Legajos"&&a.dataCuenta!=null){return a.dataCuenta.juridica[0].idMontoAInvertirJuridica}if(!f){return Core.Business.eAmountRange.Hasta200}else{f.value=false;a.divAlert.text("Debe seleccionar el monto a invertir");a.divAlert.slideDown();return Core.Business.eAmountRange.Hasta200}};a.getSelectedIngresosAnuales=function(f){var d=$(".ingresos-anuales-option");for(var e=0;e<d.length;e++){var c=$(d[e]);if(c.swidget().checked()){return c.attr("idIngresosAnuales")}}if(a.namespaceActivo=="Legajos"&&a.dataCuenta!=null){return a.dataCuenta.juridica[0].ingresosAnuales}if(!f){return Core.Business.eAmountRange.Hasta200}else{f.value=false;a.divAlert.text("Debe seleccionarlos ingresos anuales");a.divAlert.slideDown();return Core.Business.eAmountRange.Hasta200}};a.getSelectedPatrimonioNeto=function(f){var d=$(".patrimonio-neto-option");for(var e=0;e<d.length;e++){var c=$(d[e]);if(c.swidget().checked()){return c.attr("idPatromonioNeto")}}if(a.namespaceActivo=="Legajos"&&a.dataCuenta!=null){return a.dataCuenta.juridica[0].patrimonioNeto}if(!f){return Core.Business.eAmountRange.Entre200Y700}else{f.value=false;a.divAlert.text("Debe seleccionar el patrimonio neto");a.divAlert.slideDown();return Core.Business.eAmountRange.Entre200Y700}};a.getSelectedNivelExperienciaInversion=function(f){var d=$(".experiencia-inversiones-nivel-option");for(var e=0;e<d.length;e++){var c=$(d[e]);if(c.swidget().checked()){return c.attr("idNivelExperienciaInversion")}}if(a.namespaceActivo=="Legajos"&&a.dataCuenta!=null){return a.dataCuenta.juridica[0].idNivelExperienciaInversion}if(!f){return Core.Business.eAmountRange.Hasta200}else{f.value=false;a.divAlert.text("Debe seleccionar el nivel de experiencia de inversión");a.divAlert.slideDown();return Core.Business.eAmountRange.Hasta200}};a.getSelectedRelacionInversionPatrimonio=function(f){var d=$(".relacion-inversion-patrimonio-option");for(var e=0;e<d.length;e++){var c=$(d[e]);if(c.swidget().checked()){return c.attr("idRelacionInversionPatrimonio")}}if(a.namespaceActivo=="Legajos"&&a.dataCuenta!=null){return a.dataCuenta.juridica[0].idRelacionInversionPatrimonio}if(!f){return Core.Business.eAmountRange.Hasta200}else{f.value=false;a.divAlert.text("Debe seleccionar la relación de inversión patrimonio");a.divAlert.slideDown();return Core.Business.eAmountRange.Hasta200}};a.getSelectedObjetivoInversion=function(f){var d=$(".objetivo-inversion-option");for(var e=0;e<d.length;e++){var c=$(d[e]);if(c.swidget().checked()){return c.attr("idObjetivoInversion")}}if(a.namespaceActivo=="Legajos"&&a.dataCuenta!=null){return a.dataCuenta.juridica[0].idObjetivoInversion}if(!f){return Core.Business.eAmountRange.None}else{f.value=false;a.divAlert.text("Debe seleccionar el objetivo de inversión");a.divAlert.slideDown();return Core.Business.eAmountRange.Hasta200}};a.getSelectedNivelToleranciaAlRiesgo=function(f){var d=$(".nivel-tolerancia-riesgo-option");for(var e=0;e<d.length;e++){var c=$(d[e]);if(c.swidget().checked()){return c.attr("idNivelToleranciaAlRiesgo")}}if(a.namespaceActivo=="Legajos"&&a.dataCuenta!=null){return a.dataCuenta.juridica[0].idNivelToleranciaAlRiesgo}if(!f){return Core.Business.eAmountRange.Hasta200}else{f.value=false;a.divAlert.text("Debe seleccionar el nivel de tolerancia al riesgo");a.divAlert.slideDown();return Core.Business.eAmountRange.Hasta200}};a.setProvincias=function(d,c,g){var f=$.grep(a.dataParametros.provincias,function(i,h){return i.idPais==d});var e=c.swidget().initialOptions;e.dataSource.data=f;if(g!=null){e.value=g}else{e.value=c.swidget().value()}c.swidget().refresh(e)};a.setTiposIdentificadoresFiscales=function(d,c,g){var f=$.grep(a.dataParametros.tiposIdentificadoresFiscales,function(i,h){return i.idPais==d&&i.Juridica});var e=c.swidget().initialOptions;e.dataSource.data=f;if(g!=null){e.value=g}c.swidget().refresh(e)};a.getMaxNumero=function(f){var c=$.grep(a.personas,function(h,g){return h.tipo==f});var e=0;for(var d=0;d<c.length;d++){if(c[d].numero>e){e=c[d].numero}}return e};a.refreshNumeroPersonas=function(){var k=0;var e=0;var c=0;var d=0;var g=0;var f=0;for(var h=0;h<a.personas.length;h++){if(a.personas[h].tipo==Core.Business.eTipoPersonaCuenta.Titular){k++;a.personas[h].numero=k}else{if(a.personas[h].tipo==Core.Business.eTipoPersonaCuenta.Autorizado){e++;a.personas[h].numero=e}else{if(a.personas[h].tipo==Core.Business.eTipoPersonaCuenta.Accionista){c++;a.personas[h].numero=c}else{if(a.personas[h].tipo==Core.Business.eTipoPersonaCuenta.Apoderado){d++;a.personas[h].numero=d}else{if(a.personas[h].tipo==Core.Business.eTipoPersonaCuenta.Firmante){g++;a.personas[h].numero=g}else{if(a.personas[h].tipo==Core.Business.eTipoPersonaCuenta.BeneficiarioFinal){f++;a.personas[h].numero=f}}}}}}}var j=a.gridPersonas.swidget().initialOptions;j.dataSource.data=a.personas;a.gridPersonas.swidget().refresh(j)};a.getTipoDescripcion=function(c){if(c==Core.Business.eTipoPersonaCuenta.Titular){return"Titular"}else{if(c==Core.Business.eTipoPersonaCuenta.Autorizado){return"Autorizado"}else{if(c==Core.Business.eTipoPersonaCuenta.Firmante){return"Firmante"}else{if(c==Core.Business.eTipoPersonaCuenta.Apoderado){return"Apoderado"}else{if(c==Core.Business.eTipoPersonaCuenta.Accionista){return"Accionista"}else{if(c==Core.Business.eTipoPersonaCuenta.BeneficiarioFinal){return"Beneficiario Final"}else{return""}}}}}}};a.setControls=function(c){a.setProvincias(a.ddlDomicilioLegalPais.swidget().value(),a.ddlDomicilioLegalProvincia,(c&&a.dataCuenta!=null&&a.dataCuenta.juridica[0].DomicilioLegalidProvincia!=null)?a.dataCuenta.juridica[0].DomicilioLegalidProvincia.toString():null);a.setProvincias(a.ddlNacionalidad.swidget().value(),a.ddlLugarConstitucion,(c&&a.dataCuenta!=null&&a.dataCuenta.juridica[0].LugarConstitucion!=null)?a.dataCuenta.juridica[0].LugarConstitucion.toString():null);a.setTiposIdentificadoresFiscales(a.ddlPaisTipoIdentificacionFiscal.swidget().value(),a.ddlTipoIdentificacionFiscal,(c&&a.dataCuenta!=null&&a.dataCuenta.juridica[0].idTipoIdentificadorFiscal!=null)?a.dataCuenta.juridica[0].idTipoIdentificadorFiscal.toString():null);a.setTiposIdentificadoresFiscales(a.ddlTributaPais1.swidget().value(),a.ddlTributaTipoIdentificadorFiscal1,(c&&a.dataCuenta!=null&&a.dataCuenta.juridica[0].idTipoIdentificadorFiscal1!=null)?a.dataCuenta.juridica[0].idTipoIdentificadorFiscal1.toString():null);a.setTiposIdentificadoresFiscales(a.ddlTributaPais2.swidget().value(),a.ddlTributaTipoIdentificadorFiscal2,(c&&a.dataCuenta!=null&&a.dataCuenta.juridica[0].idTipoIdentificadorFiscal2!=null)?a.dataCuenta.juridica[0].idTipoIdentificadorFiscal2.toString():null);a.setTiposIdentificadoresFiscales(a.ddlTributaPais3.swidget().value(),a.ddlTributaTipoIdentificadorFiscal3,(c&&a.dataCuenta!=null&&a.dataCuenta.juridica[0].idTipoIdentificadorFiscal3!=null)?a.dataCuenta.juridica[0].idTipoIdentificadorFiscal3.toString():null);a.divOrigenPatrimonioOtroDetalle.hide();if(a.chkOrigenPatrimonioOtro.swidget().checked()){a.divOrigenPatrimonioOtroDetalle.show()}a.divFondeoCuentaOtroDetalle.hide();if(a.chkFondeoCuentaOtro.swidget().checked()){a.divFondeoCuentaOtroDetalle.show()}a.divCanalOtroDetalle.hide();if(a.getSelectedCanal()==Core.Business.eCanal.Otro){a.divCanalOtroDetalle.show()}a.divObjetivoInversionDetallePeriodo.hide();if(a.getSelectedObjetivoInversion()==Core.Business.eAmountRange.Hasta200){a.divObjetivoInversionDetallePeriodo.show()}a.divTipoInversionOtroDetalle.hide();if(a.chkTipoInversionOtro.swidget().checked()){a.divTipoInversionOtroDetalle.show()}a.divExperienciaInversionesOtroDetalle.hide();if(a.chkExperienciaInversionesOtro.swidget().checked()){a.divExperienciaInversionesOtroDetalle.show()}a.divCambiosSignificativosPatrimonioDetalle.hide();if(a.chkCambiosSignificativosPatrimonio.swidget().checked()){a.divCambiosSignificativosPatrimonioDetalle.show()}a.divIngresoAsesorFinanciero.hide();if(a.chkIngresoAsesorFinanciero.swidget().checked()){a.divIngresoAsesorFinanciero.show()}a.divActividadPrincipalOtro.hide();if(a.ddlActividadPrincipal.swidget().selectedItem()&&a.ddlActividadPrincipal.swidget().selectedItem().idActividadJuridica==Core.Business.eActividadPrincipalJuridica.Otro){a.divActividadPrincipalOtro.show()}a.divActividadPrincipalCampoAdicional1.hide();if(a.ddlActividadPrincipal.swidget().selectedItem()&&a.ddlActividadPrincipal.swidget().selectedItem().TipoCampoAdicional==1){a.divActividadPrincipalCampoAdicional1.show()}a.divResidenciaFiscal1.hide();a.divResidenciaFiscal2.hide();a.divResidenciaFiscal3.hide();if(a.ddlCantidadResidenciasFiscales.swidget().selectedItem()){if(a.ddlCantidadResidenciasFiscales.swidget().selectedItem().value>=1){a.divResidenciaFiscal1.show()}if(a.ddlCantidadResidenciasFiscales.swidget().selectedItem().value>=2){a.divResidenciaFiscal2.show()}if(a.ddlCantidadResidenciasFiscales.swidget().selectedItem().value>=3){a.divResidenciaFiscal3.show()}}a.divTipoOcdeDeclaracionJurada.hide();if(a.ddlTipoOcde.swidget().selectedItem()&&a.ddlTipoOcde.swidget().selectedItem().idTipoOCDE==5){a.divTipoOcdeDeclaracionJurada.show()}a.divCiudadaniaEEUUCampoAdicional1.hide();a.divCiudadaniaEEUUCampoAdicional2.hide();a.divCiudadaniaEEUUCampoAdicional3.hide();a.divCiudadaniaEEUUCampoAdicional4.hide();a.divCiudadaniaEEUUCampoAdicional5.hide();a.divCiudadaniaEEUUDeclaracionJurada.hide();if(a.ddlCiudadaniaEEUU.swidget().selectedItem()){if(a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==1||a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==5){a.divPoseeBeneficiariosEstadounidenses.show();if(a.chkPoseeBeneficiariosEstadounidenses.swidget().checked()){a.divBeneficiariosEstadounidensesCantidad.show();a.divCiudadaniaEEUUDeclaracionJurada.show();if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem()){if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=1){a.divBeneficiarioEstadounidense1.show()}if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=2){a.divBeneficiarioEstadounidense2.show()}if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=3){a.divBeneficiarioEstadounidense3.show()}if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=4){a.divBeneficiarioEstadounidense4.show()}if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=5){a.divBeneficiarioEstadounidense5.show()}if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=6){a.divBeneficiarioEstadounidense6.show()}}}}if(a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==2){a.divCiudadaniaEEUUCampoAdicional2.show()}if(a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==3){a.divCiudadaniaEEUUCampoAdicional3.show()}if(a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==4){a.divCiudadaniaEEUUCampoAdicional4.show()}if(a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==5){a.divCiudadaniaEEUUCampoAdicional5.show()}}a.divTipoEntidadCRSEntidadInversion.hide();a.divTipoEntidadCRSGiin.hide();a.divTipoEntidadCRSMercadoDondeCotiza.hide();a.divTipoEntidadCRSCompaniaPublicaRelacionada.hide();a.divTipoEntidadCRSNombreApellido.hide();if(a.ddlTipoEntidadCRS.swidget().selectedItem()){if(a.ddlTipoEntidadCRS.swidget().selectedItem().idTipoEntidadCRS==1){a.divTipoEntidadCRSEntidadInversion.show();a.divTipoEntidadCRSGiin.show();if(a.ddlTipoEntidadCRSEntidadInversion.swidget().selectedItem()&&a.ddlTipoEntidadCRSEntidadInversion.swidget().selectedItem().idTipoEntidadCRSTipoEntidadInversion==1){a.divTipoEntidadCRSNombreApellido.show()}}if(a.ddlTipoEntidadCRS.swidget().selectedItem().idTipoEntidadCRS==2){a.divTipoEntidadCRSGiin.show()}if(a.ddlTipoEntidadCRS.swidget().selectedItem().idTipoEntidadCRS==3){a.divTipoEntidadCRSMercadoDondeCotiza.show();a.divTipoEntidadCRSCompaniaPublicaRelacionada.show()}if(a.ddlTipoEntidadCRS.swidget().selectedItem().idTipoEntidadCRS==7){a.divTipoEntidadCRSNombreApellido.show()}}a.ddlTipoRegistracionJuridica.swidget().enabled(true);if(a.ddlNacionalidad.swidget().selectedItem()){if(a.ddlNacionalidad.swidget().selectedItem().idPais==Core.Business.eNacionalidad.Argentina){if(a.ddlLugarConstitucion.swidget().selectedItem()){if(a.ddlLugarConstitucion.swidget().selectedItem().idProvincia==Core.Business.eProvincia.CABA||a.ddlLugarConstitucion.swidget().selectedItem().idProvincia==Core.Business.eProvincia.BsAs){a.ddlTipoRegistracionJuridica.swidget().enabled(false);a.ddlTipoRegistracionJuridica.swidget().value(a.ddlLugarConstitucion.swidget().selectedItem().idProvincia==Core.Business.eProvincia.CABA?Core.Business.eTipoRegistracion.IGJ.toString():Core.Business.eTipoRegistracion.DPJ.toString())}}}else{a.ddlTipoRegistracionJuridica.swidget().enabled(false);a.ddlTipoRegistracionJuridica.swidget().value(Core.Business.eTipoRegistracion.Extranjero.toString())}}a.divEmailNotificaciones1.hide();a.divEmailNotificaciones2.hide();a.divEmailNotificaciones3.hide();a.divEmailNotificaciones4.hide();if(a.ddlEmailNotificacionesCantidad.swidget().selectedItem()){if(a.ddlEmailNotificacionesCantidad.swidget().selectedItem().value>=1){a.divEmailNotificaciones1.show()}if(a.ddlEmailNotificacionesCantidad.swidget().selectedItem().value>=2){a.divEmailNotificaciones2.show()}if(a.ddlEmailNotificacionesCantidad.swidget().selectedItem().value>=3){a.divEmailNotificaciones3.show()}if(a.ddlEmailNotificacionesCantidad.swidget().selectedItem().value==4){a.divEmailNotificaciones4.show()}}a.divOrdenesComunicacionesEmail.hide();if(a.chkOrdenesComunicacionesEmail.swidget().checked()){a.divOrdenesComunicacionesEmail.show()}};a.getDate=function(c){var d=c.substr(6,2);var e=c.substr(4,2);var g=c.substr(0,4);var f=new Date();f.setDate(1);f.setYear(g);f.setMonth(e-1);f.setDate(d);return f};a.isValidEmailAddress=function(c){if(!c){return false}else{var d=/^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i;if(!d.test(c)){return false}return true}};a.isValidPhone=function(c){var e=c.replaceAll("-","");var d=/^[0-9+]+$/;if(!d.test(e)||e.length<10||e.length>17){return false}return true};a.setTelefonoCelularControls=function(){a.divTelefonoCelularArea.hide();a.txtTelefonoCelularArea.val("");a.divTelefonoCelularNumero.removeClass("col-lg-3");a.divTelefonoCelularNumero.removeClass("col-md-3");a.divTelefonoCelularNumero.addClass("col-lg-4");a.divTelefonoCelularNumero.addClass("col-md-4");if(a.ddlTelefonoCelularPais.swidget().selectedItem().value==a.phoneCodeAr){a.divTelefonoCelularNumero.removeClass("col-lg-4");a.divTelefonoCelularNumero.removeClass("col-md-4");a.divTelefonoCelularNumero.addClass("col-lg-3");a.divTelefonoCelularNumero.addClass("col-md-3");a.divTelefonoCelularArea.show()}};a.destroy=function(c){a.ddlEstado.swidget().destroy();a.ddlVersion.swidget().destroy();a.ddlAsesor.swidget().destroy();a.chkUsarFirmaDigital.swidget().destroy();a.chkIngresoAsesorFinanciero.swidget().destroy();a.txtIngresoAsesorFinanciero.swidget().destroy();a.chkOrigenPatrimonioIngresosOperativos.swidget().destroy();a.chkOrigenPatrimonioAportesCapital.swidget().destroy();a.chkOrigenPatrimonioSuscripcionCuotapartes.swidget().destroy();a.chkOrigenPatrimonioVentaActivosFijos.swidget().destroy();a.chkOrigenPatrimonioDonacion.swidget().destroy();a.chkOrigenPatrimonioInversionesAnteriores.swidget().destroy();a.chkOrigenPatrimonioOtro.swidget().destroy();a.txtOrigenPatrimonioOtroDetalle.swidget().destroy();a.chkFondeoCuentaTransferenciaTitulosCuentaInversion.swidget().destroy();a.chkFondeoCuentaTransferenciaDineroCuentaInversion.swidget().destroy();a.chkFondeoCuentaTransferenciaDineroBanco.swidget().destroy();a.chkFondeoCuentaOtro.swidget().destroy();a.txtFondeoCuentaOtroDetalle.swidget().destroy();a.txtCantidadTransferenciasDesdeCuentaPorAnio.swidget().destroy();a.txtPaisesCuentaOrigen.swidget().destroy();a.txtCantidadTransferenciasHaciaCuentaPorAnio.swidget().destroy();a.txtPaisesCuentaDestino.swidget().destroy();a.chkConvenioComitenteAAGI.swidget().destroy();a.txtCanalOtroDetalle.swidget().destroy();a.txtObjetivoInversionDetallePeriodo.swidget().destroy();a.ddlArancel.swidget().destroy();a.txtComoLlegoABalanz.swidget().destroy();a.txtUsuarioAsignado.swidget().destroy();a.chkTipoInversionAcciones.swidget().destroy();a.chkTipoInversionFondos.swidget().destroy();a.chkTipoInversionOpciones.swidget().destroy();a.chkTipoInversionBonos.swidget().destroy();a.chkTipoInversionFuturos.swidget().destroy();a.chkTipoInversionOtro.swidget().destroy();a.txtTipoInversionOtroDetalle.swidget().destroy();a.chkExperienciaInversionesAcciones.swidget().destroy();a.chkExperienciaInversionesFondos.swidget().destroy();a.chkExperienciaInversionesOpciones.swidget().destroy();a.chkExperienciaInversionesBonos.swidget().destroy();a.chkExperienciaInversionesFuturos.swidget().destroy();a.chkExperienciaInversionesOtro.swidget().destroy();a.txtExperienciaInversionesOtroDetalle.swidget().destroy();a.txtPlazoInversion.swidget().destroy();a.txtDescripcionActividadCliente.swidget().destroy();a.chkCambiosSignificativosPatrimonio.swidget().destroy();a.txtCambiosSignificativosPatrimonioDetalle.swidget().destroy();a.txtReferenciaBancariaNombre.swidget().destroy();a.txtReferenciaBancariaApellido.swidget().destroy();a.ddlReferenciaBancariaCargo.swidget().destroy();a.txtReferenciaBancariaInstitucion.swidget().destroy();a.txtReferenciaBancariaTelefono.swidget().destroy();a.txtReferenciaBancariaEmail.swidget().destroy();a.txtReferenciaBancariaDomicilio.swidget().destroy();a.txtReferenciaBancariaCiudad.swidget().destroy();a.ddlReferenciaBancariaPais.swidget().destroy();a.chkOrdenesComunicacionesEscrito.swidget().destroy();a.chkOrdenesComunicacionesEmail.swidget().destroy();a.txtOrdenesComunicacionesEmail.swidget().destroy();a.chkOrdenesComunicacionesConvenioOperacion.swidget().destroy();a.ddlPaisTipoIdentificacionFiscal.swidget().destroy();a.ddlTipoIdentificacionFiscal.swidget().destroy();a.txtIdentificacionFiscal.swidget().destroy();a.txtNombreComercial.swidget().destroy();a.txtRazonSocial.swidget().destroy();a.ddlNacionalidad.swidget().destroy();a.ddlLugarConstitucion.swidget().destroy();a.ddlTipoPersonaJuridica.swidget().destroy();a.ddlTipoRegistracionJuridica.swidget().destroy();a.txtNumeroInscripcion.swidget().destroy();a.txtFechaConstitucion.swidget().destroy();a.txtTomo.swidget().destroy();a.txtLibro.swidget().destroy();a.ddlActividadPrincipal.swidget().destroy();a.txtActividadPrincipalOtro.swidget().destroy();a.txtSegmentoInversion.swidget().destroy();a.txtNumeroAseguradora.swidget().destroy();a.ddlTipoPersonaJuridicaExenta.swidget().destroy();a.ddlCiudadaniaEEUU.swidget().destroy();a.ddlTipoOcde.swidget().destroy();a.ddlTipoEntidadCRS.swidget().destroy();a.ddlTipoEntidadCRSEntidadInversion.swidget().destroy();a.txtTipoEntidadCRSGiin.swidget().destroy();a.txtTipoEntidadCRSMercadoDondeCotiza.swidget().destroy();a.txtTipoEntidadCRSCompaniaPublicaRelacionada.swidget().destroy();a.txtTipoEntidadCRSNombreApellido.swidget().destroy();a.chkPoseeBeneficiariosEstadounidenses.swidget().destroy();a.ddlBeneficiariosEstadounidensesCantidad.swidget().destroy();a.txtDomicilioLegalPiso.swidget().destroy();a.txtDomicilioLegalCalle.swidget().destroy();a.txtDomicilioLegalNumero.swidget().destroy();a.txtDomicilioLegalDepartamento.swidget().destroy();a.ddlDomicilioLegalPais.swidget().destroy();a.ddlDomicilioLegalProvincia.swidget().destroy();a.txtDomicilioLegalLocalidad.swidget().destroy();a.txtDomicilioLegalCodigoPostal.swidget().destroy();a.txtTelefonoParticularArea.swidget().destroy();a.txtTelefonoParticularNumero.swidget().destroy();a.ddlTelefonoCelularPais.swidget().destroy();a.txtTelefonoCelularArea.swidget().destroy();a.txtTelefonoCelularNumero.swidget().destroy();a.ddlEmailNotificacionesCantidad.swidget().destroy();a.txtEmailNotificaciones1.swidget().destroy();a.txtEmailNotificaciones2.swidget().destroy();a.txtEmailNotificaciones3.swidget().destroy();a.txtEmailNotificaciones4.swidget().destroy();a.ddlCantidadResidenciasFiscales.swidget().destroy();a.txtTributaNit1.swidget().destroy();a.txtTributaNit2.swidget().destroy();a.txtTributaNit3.swidget().destroy();a.ddlTributaPais1.swidget().destroy();a.ddlTributaPais2.swidget().destroy();a.ddlTributaPais3.swidget().destroy();a.ddlTributaTipoIdentificadorFiscal1.swidget().destroy();a.ddlTributaTipoIdentificadorFiscal2.swidget().destroy();a.ddlTributaTipoIdentificadorFiscal3.swidget().destroy();a.txtBeneficiarioEstadounidenseNombre1.swidget().destroy();a.txtBeneficiarioEstadounidenseNombre2.swidget().destroy();a.txtBeneficiarioEstadounidenseNombre3.swidget().destroy();a.txtBeneficiarioEstadounidenseNombre4.swidget().destroy();a.txtBeneficiarioEstadounidenseNombre5.swidget().destroy();a.txtBeneficiarioEstadounidenseNombre6.swidget().destroy();a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU1.swidget().destroy();a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU2.swidget().destroy();a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU3.swidget().destroy();a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU4.swidget().destroy();a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU5.swidget().destroy();a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU6.swidget().destroy();a.ddlTipoInstitucionFinancieraExtranjera.swidget().destroy();a.txtInstitucionFinancieraExtranjeraGIIN.swidget().destroy();a.ddlTipoReporteDirectoIRS.swidget().destroy();a.txtReporteDirectoIRSGIIN.swidget().destroy();a.txtPersonaEstadounidenseTIN.swidget().destroy();a.gridPersonas.swidget().destroy();a.gridArchivos.swidget().destroy();a.gridObservaciones.swidget().destroy();a.ddlRiesgoCliente.swidget().destroy();a.divManagerAltaCuenta.html("");if(c){a.onClose()}}};Core.Business.eAmountRange={None:0,Hasta200:1,Entre200Y700:2,MasDe700:3,MasDe200:4};Core.Business.eTipoIdentificacionFiscal={None:0,CUIT:1,CUIL:2,CIE:3,CDI:4};Core.Business.eGenero={Femenino:0,Masculino:1};Core.Business.eEstadoCivil={None:0,Soltero:1,Casado:2,Divorciado:3,Separado:4,Viudo:5};Core.Business.eCanal={None:0,Web:1,PorFuncionarios:2,PorEmpleados:3,PorGestionComercial:4,Otro:5};Core.Business.eTipoFirma={None:0,Indistinta:1,Conjunta:2};Core.Business.eCaracterInvocado={None:0,Titular:1,Apoderado:2,Representante:3,Autorizado:4};Core.Business.eTipoDocumento={DNI:1,CI:2,LE:3,LC:4,PAS:5,Extranjero:6};Core.Business.eCondicionIVA={ConsumidorFinal:1,Exento:2,NoResponsable:3,ResponsableInscripto:4,ResponsableMonotributo:5,ResponsableInscriptoBanco:7,NoCategorizado:8};Core.Controls.ManagerAltaCuentaFisica=function(b){var a=this;a.id="homeAltaCuenta";a.idDefaultProfile=null;a.idDefaultAccount=null;a.divInformes=null;a.divReadOnly=null;a.divVersion=null;a.ddlVersion=null;a.divAltaCuenta=null;a.divManagerPersona=null;a.divMatrizRiesgo=null;a.divAsesor=null;a.ddlAsesor=null;a.divContainerEstado=null;a.divDescripcionEstado=null;a.lblEstado=null;a.ddlEstado=null;a.divTipoFirma=null;a.chkTipoFirmaConjunta=null;a.chkTipoFirmaIndistinta=null;a.divIngresoAsesorFinanciero=null;a.txtIngresoAsesorFinanciero=null;a.chkIngresoAsesorFinanciero=null;a.divCuentas=null;a.chkCuentasComitente=null;a.chkCuentasCuotapartista=null;a.txtUsuarioAsignado=null;a.divMontoInvertir=null;a.divMontoInvertirContainer=null;a.lblMontoInvertirAlert=null;a.divIngresosAnuales=null;a.divIngresosAnualesContainer=null;a.lblIngresosAnualesAlert=null;a.divPatrimonioNeto=null;a.divPatrimonioNetoContainer=null;a.lblPatrimonioNetoAlert=null;a.divOrigenPatrimonio=null;a.chkOrigenPatrimonioActividadPrincipal=null;a.chkOrigenPatrimonioVentaBienes=null;a.chkOrigenPatrimonioHerencia=null;a.chkOrigenPatrimonioOtro=null;a.divOrigenPatrimonioOtroDetalle=null;a.txtOrigenPatrimonioOtroDetalle=null;a.divConvenioComitenteAAGI=null;a.chkConvenioComitenteAAGI=null;a.divCanal=null;a.divCanalContainer=null;a.divCanalOtroDetalle=null;a.txtCanalOtroDetalle=null;a.divArancel=null;a.ddlArancel=null;a.divComoLlegoABalanz=null;a.txtComoLlegoABalanz=null;a.divTipoInversion=null;a.chkTipoInversionAcciones=null;a.chkTipoInversionTitulosPublicos=null;a.chkTipoInversionFideicomisos=null;a.chkTipoInversionOpciones=null;a.chkTipoInversionFondos=null;a.chkTipoInversionOperacionesCambioUSD=null;a.chkTipoInversionObligacionesNegociables=null;a.chkTipoInversionFuturos=null;a.chkTipoInversionChequePagoDiferido=null;a.chkTipoInversionOtro=null;a.divTipoInversionOtroDetalle=null;a.txtTipoInversionOtroDetalle=null;a.divPlazoInversion=null;a.txtPlazoInversion=null;a.divContainerPerfilCuenta=null;a.divNivelRiesgo=null;a.ddlNivelRiesgo=null;a.divDescripcionActividadCliente=null;a.txtDescripcionActividadCliente=null;a.btnGuardarYCerrar=null;a.btnAvanzarImportacion=null;a.btnFormularioVacio=null;a.btnVolver=null;a.btnNuevaPersona=null;a.gridPersonas=null;a.btnAgregarArchivo=null;a.gridArchivos=null;a.divContainerObservaciones=null;a.gridObservaciones=null;a.btnAgregarObservacion=null;a.divAlert=null;a.detalleDisponible=null;a.dataCuenta=null;a.dataParametros=null;a.dataParametrosUsuario=null;a.personas=[];a.archivos=[];a.observaciones=[];a.idAperturaCuenta=null;a.aperturaCuenta=null;a.versionActual=null;a.optionsApertura=null;a.readOnly=null;a.pageOptions=null;a.namespaceActivo="";a.onClose=function(){};a.onSave=function(c,d){};a.show=function(){$("html, body").animate({scrollTop:$(".cuenta").offset().top},1000);a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu("matrizDeRiesgo",Core.Objects.Context.Profiles[0]);a.idAperturaCuenta=0;a.versionActual=0;a.maxVersion=0;a.optionsApertura=null;a.readOnly=false;a.aperturaCuenta=null;a.namespaceActivo="";a.dataParametros=null;a.dataParametrosUsuario=null;a.dataCuenta=null;$.extend(true,a,b);a.divAltaCuenta=a.container.find(".div-alta-cuenta");a.divManagerPersona=a.container.find(".div-manager-titular-autorizado");a.divMatrizRiesgo=a.container.find(".div-container-matriz-riesgo");a.divManagerAltaCuenta=a.container.find(".div-manager-alta-cuenta");a.divManagerAltaCuenta.html("");a.divManagerAltaCuenta.load("/Pages/manager-cuenta-fisica.html",function(c,d,e){if(d=="success"){a.divAltaCuenta.show();a.divManagerPersona.hide();a.divMatrizRiesgo.hide();a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[a.idDefaultProfile]);a.titlePage=a.divManagerAltaCuenta.find(".title-page");a.titlePage.text((a.idAperturaCuenta)?("Cuenta: "+a.idAperturaCuenta):"Alta Cuenta");a.divDescripcionCuenta=a.divManagerAltaCuenta.find(".div-descripcion-cuenta");a.lblDescripcionCuenta=a.divManagerAltaCuenta.find(".lbl-descripcion-cuenta");a.divComitenteCuotapartistaCuenta=a.divManagerAltaCuenta.find(".div-comitente-coutapartista-cuenta");a.lblComitenteCuotapartistaCuenta=a.divManagerAltaCuenta.find(".lbl-comitente-coutapartista-cuenta");a.divDescripcionCuenta.hide();a.divComitenteCuotapartistaCuenta.hide();a.divReadOnly=a.divManagerAltaCuenta.find(".div-read-only");a.divInformes=a.divManagerAltaCuenta.find(".div-cuenta-informes");a.divVersion=a.divManagerAltaCuenta.find(".div-version");a.ddlVersion=a.divManagerAltaCuenta.find(".dropdown-version");a.divAsesor=a.divManagerAltaCuenta.find(".div-asesor");a.divAsesor=a.divManagerAltaCuenta.find(".div-asesor");a.divUsarFirmaDigital=a.divManagerAltaCuenta.find(".div-usar-firma-digital");a.chkUsarFirmaDigital=a.divManagerAltaCuenta.find(".checkbox-usar-firma-digital");a.ddlAsesor=a.divManagerAltaCuenta.find(".dropdown-asesor");a.divContainerEstado=a.divManagerAltaCuenta.find(".div-container-estado");a.ddlEstado=a.divManagerAltaCuenta.find(".dropdown-estado");a.lblEstadoCuenta=a.divManagerAltaCuenta.find(".lbl-estado-cuenta");a.divDescripcionEstado=a.divManagerAltaCuenta.find(".div-descripcion-estado");a.divTipoFirma=a.divManagerAltaCuenta.find(".div-tipo-firma");a.chkTipoFirmaConjunta=a.divManagerAltaCuenta.find(".chk-tipo-firma-conjunta");a.chkTipoFirmaIndistinta=a.divManagerAltaCuenta.find(".chk-tipo-firma-indistinta");a.chkIngresoAsesorFinanciero=a.divManagerAltaCuenta.find(".checkbox-ingreso-asesor-financiero");a.txtIngresoAsesorFinanciero=a.divManagerAltaCuenta.find(".textbox-ingreso-asesor-financiero");a.divIngresoAsesorFinanciero=a.divManagerAltaCuenta.find(".div-ingreso-asesor-financiero");a.divCuentas=a.divManagerAltaCuenta.find(".div-cuentas");a.chkCuentasComitente=a.divManagerAltaCuenta.find(".chk-cuentas-comitente");a.chkCuentasCuotapartista=a.divManagerAltaCuenta.find(".chk-cuentas-cuotapartista");a.divMontoInvertir=a.divManagerAltaCuenta.find(".div-monto-invertir");a.divMontoInvertirContainer=a.divManagerAltaCuenta.find(".div-monto-invertir-container");a.lblMontoInvertirAlert=a.divManagerAltaCuenta.find(".lbl-monto-invertir-alert");a.lblMontoInvertirAlert.html("");a.divIngresosAnuales=a.divManagerAltaCuenta.find(".div-ingresos-anuales");a.divIngresosAnualesContainer=a.divManagerAltaCuenta.find(".div-ingresos-anuales-container");a.lblIngresosAnualesAlert=a.divManagerAltaCuenta.find(".lbl-ingresos-anuales-alert");a.lblIngresosAnualesAlert.html("");a.divPatrimonioNeto=a.divManagerAltaCuenta.find(".div-patrimonio-neto");a.divPatrimonioNetoContainer=a.divManagerAltaCuenta.find(".div-patrimonio-neto-container");a.lblPatrimonioNetoAlert=a.divManagerAltaCuenta.find(".lbl-patrimonio-neto-alert");a.lblPatrimonioNetoAlert.html("");a.divOrigenPatrimonio=a.divManagerAltaCuenta.find(".div-origen-patrimonio");a.chkOrigenPatrimonioActividadPrincipal=a.divManagerAltaCuenta.find(".chk-origen-patrimonio-actividad-principal");a.chkOrigenPatrimonioVentaBienes=a.divManagerAltaCuenta.find(".chk-origen-patrimonio-venta-bienes");a.chkOrigenPatrimonioHerencia=a.divManagerAltaCuenta.find(".chk-origen-patrimonio-herencia");a.chkOrigenPatrimonioOtro=a.divManagerAltaCuenta.find(".chk-origen-patrimonio-otro");a.divOrigenPatrimonioOtroDetalle=a.divManagerAltaCuenta.find(".div-otro-patrimonio-detalle");a.txtOrigenPatrimonioOtroDetalle=a.divManagerAltaCuenta.find(".textbox-otro-patrimonio-detalle");a.divConvenioComitenteAAGI=a.divManagerAltaCuenta.find(".div-convenio-comitente-aagi");a.chkConvenioComitenteAAGI=a.divManagerAltaCuenta.find(".checkbox-convenio-comitente-aagi");a.divCanal=a.divManagerAltaCuenta.find(".div-canal");a.divCanalContainer=a.divManagerAltaCuenta.find(".div-canal-container");a.divCanalOtroDetalle=a.divManagerAltaCuenta.find(".div-canal-otro-detalle");a.txtCanalOtroDetalle=a.divManagerAltaCuenta.find(".textbox-canal-otro-detalle");a.divArancel=a.divManagerAltaCuenta.find(".div-arancel");a.ddlArancel=a.divManagerAltaCuenta.find(".dropdown-arancel");a.divContainerPerfilCuenta=a.divManagerAltaCuenta.find(".div-container-perfil-cuenta");a.divNivelRiesgo=a.divManagerAltaCuenta.find(".div-nivel-riesgo");a.ddlNivelRiesgo=a.divManagerAltaCuenta.find(".dropdown-nivel-riesgo");a.divComoLlegoABalanz=a.divManagerAltaCuenta.find(".div-como-llego-a-balanz");a.txtComoLlegoABalanz=a.divManagerAltaCuenta.find(".textbox-como-llego-a-balanz");a.txtUsuarioAsignado=a.divManagerAltaCuenta.find(".textbox-usuario-asignado");a.divTipoInversion=a.divManagerAltaCuenta.find(".div-tipo-inversion");a.chkTipoInversionAcciones=a.divManagerAltaCuenta.find(".chk-tipo-inversion-acciones");a.chkTipoInversionTitulosPublicos=a.divManagerAltaCuenta.find(".chk-tipo-inversion-titulos-publicos");a.chkTipoInversionFideicomisos=a.divManagerAltaCuenta.find(".chk-tipo-inversion-fideicomisos");a.chkTipoInversionOpciones=a.divManagerAltaCuenta.find(".chk-tipo-inversion-opciones");a.chkTipoInversionFondos=a.divManagerAltaCuenta.find(".chk-tipo-inversion-fondos");a.chkTipoInversionOperacionesCambioUSD=a.divManagerAltaCuenta.find(".chk-tipo-inversion-operaciones-cambio-usd");a.chkTipoInversionObligacionesNegociables=a.divManagerAltaCuenta.find(".chk-tipo-inversion-obligaciones-negociables");a.chkTipoInversionFuturos=a.divManagerAltaCuenta.find(".chk-tipo-inversion-futuros");a.chkTipoInversionChequePagoDiferido=a.divManagerAltaCuenta.find(".chk-tipo-inversion-cheque-pago-diferido");a.chkTipoInversionOtro=a.divManagerAltaCuenta.find(".chk-tipo-inversion-otro");a.divTipoInversionOtroDetalle=a.divManagerAltaCuenta.find(".div-tipo-inversion-otro-detalle");a.txtTipoInversionOtroDetalle=a.divManagerAltaCuenta.find(".textbox-tipo-inversion-otro-detalle");a.divPlazoInversion=a.divManagerAltaCuenta.find(".div-plazo-inversion");a.txtPlazoInversion=a.divManagerAltaCuenta.find(".textbox-plazo-inversion");a.divDescripcionActividadCliente=a.divManagerAltaCuenta.find(".div-descripcion-actividad-cliente");a.txtDescripcionActividadCliente=a.divManagerAltaCuenta.find(".textbox-descripcion-actividad-cliente");a.divContainerObservaciones=a.divManagerAltaCuenta.find(".div-container-observaciones");a.gridObservaciones=a.divManagerAltaCuenta.find(".div-observaciones");a.btnAgregarObservacion=a.divManagerAltaCuenta.find(".btn-agregar-observacion");a.btnNuevaPersona=a.divManagerAltaCuenta.find(".btn-nueva-persona");a.btnAgregarArchivo=a.divManagerAltaCuenta.find(".btn-agregar-archivo");a.btnGuardarYCerrar=a.divManagerAltaCuenta.find(".btn-guardar-cerrar");a.btnAvanzarImportacion=a.divManagerAltaCuenta.find(".btn-avanzar-importacion");a.btnRefirmar=a.divManagerAltaCuenta.find(".btn-refirmar");a.btnAnularFirma=a.divManagerAltaCuenta.find(".btn-anular-firma");a.btnFormularioVacio=a.divManagerAltaCuenta.find(".btn-formulario-vacio");a.btnVolver=a.divManagerAltaCuenta.find(".btn-volver");a.gridPersonas=a.divManagerAltaCuenta.find(".div-personas");a.gridArchivos=a.divManagerAltaCuenta.find(".div-archivos");a.divAlert=a.divManagerAltaCuenta.find(".div-alert");a.divAlert.slideUp();a.initControls()}})};a.initControls=function(){a.divReadOnly.hide();if(a.readOnly){a.divReadOnly.show();a.divVersion.show();if(a.namespaceActivo=="OpenManagerAltaCuenta"){a.divVersion.hide()}}a.divContainerPerfilCuenta.hide();if(Core.Objects.Context.Configuration.idAplicacion==3){a.divContainerPerfilCuenta.show()}a.btnAgregarArchivo.show();a.btnNuevaPersona.show();a.btnGuardarYCerrar.show();if(!a.idAperturaCuenta){a.btnFormularioVacio.show()}else{a.btnFormularioVacio.hide()}a.btnAgregarObservacion.show();if(a.readOnly){a.btnAgregarArchivo.hide();a.btnNuevaPersona.hide();a.btnGuardarYCerrar.hide();a.btnFormularioVacio.hide();a.btnAgregarObservacion.hide()}a.btnVolver.show();if(a.namespaceActivo=="OpenManagerAltaCuenta"){a.btnVolver.hide()}a.btnRefirmar.hide();if(!a.readOnly&&a.dataCuenta&&a.dataCuenta.datos[0].refirmar){a.btnRefirmar.show()}a.btnAnularFirma.hide();if(!a.readOnly&&a.dataCuenta&&a.dataCuenta.datos[0].anularFirma){a.btnAnularFirma.show()}a.btnAvanzarImportacion.hide();if(!a.readOnly&&a.idAperturaCuenta&&a.dataCuenta!=null&&a.optionsApertura&&a.optionsApertura.verBotonFF&&a.optionsApertura.verBotonFF!=""){var d=a.optionsApertura.verBotonFF.split(",");if($.grep(d,function(f,g){return f!=""&&f==a.dataCuenta.datos[0].idEstadoAperturaCuenta})[0]){a.btnAvanzarImportacion.show()}}a.divContainerObservaciones.show();a.divContainerEstado.show();a.divDescripcionEstado.show();if(!a.idAperturaCuenta){a.divContainerObservaciones.hide();a.divContainerEstado.hide();a.divDescripcionEstado.hide()}a.divAltaCuenta.show();a.divManagerPersona.hide();a.divMatrizRiesgo.hide();a.ddlVersion.shieldDropDown({dataSource:{data:[]},valueTemplate:"{version}",textTemplate:"{version}",events:{select:function(f){var g=a.ddlVersion.swidget().selectedItem().version;a.destroy(false);var e=new Core.Controls.ManagerAltaCuenta({idAperturaCuenta:a.idAperturaCuenta,versionActual:g,optionsApertura:a.optionsApertura,readOnly:a.readOnly,maxVersion:a.maxVersion,namespaceActivo:a.namespaceActivo,onClose:a.onClose,onSave:a.onSave,container:a.container,idDefaultProfile:a.idDefaultProfile,idDefaultAccount:a.idDefaultAccount}).show()}}});Core.Functions.Validations.toggleValidation(a.ddlVersion,false);a.ddlEstado.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idEstadoAperturaCuenta}",textTemplate:"{Nombre}",events:{select:function(e){a.lblEstadoCuenta.text(a.ddlEstado.swidget().selectedItem().Nombre)}}});Core.Functions.Validations.toggleValidation(a.ddlEstado,false);a.ddlAsesor.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idPersona}",textTemplate:"{Nombre}",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}}});Core.Functions.Validations.toggleValidation(a.ddlAsesor,false);a.chkUsarFirmaDigital.shieldCheckBox({label:"Usar firma digital"});Core.Functions.Validations.toggleValidation(a.chkUsarFirmaDigital,false);a.chkIngresoAsesorFinanciero.shieldCheckBox({label:"Asesor financiero, productor o referido",enabled:false,events:{click:function(f){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.chkIngresoAsesorFinanciero,false);a.txtIngresoAsesorFinanciero.shieldTextBox({value:"",enabled:false});Core.Functions.Validations.toggleValidation(a.txtIngresoAsesorFinanciero,false);a.chkCuentasComitente.shieldCheckBox({label:"Comitente"});Core.Functions.Validations.toggleValidation(a.chkCuentasComitente,false);a.chkCuentasCuotapartista.shieldCheckBox({label:"Cuotapartista"});Core.Functions.Validations.toggleValidation(a.chkCuentasCuotapartista,false);if(!a.chkTipoFirmaConjunta.swidget()){a.chkTipoFirmaConjunta.shieldRadioButton({label:"Conjunta"})}Core.Functions.Validations.toggleValidation(a.chkTipoFirmaConjunta,false);if(!a.chkTipoFirmaIndistinta.swidget()){a.chkTipoFirmaIndistinta.shieldRadioButton({label:"Indistinta"})}Core.Functions.Validations.toggleValidation(a.chkTipoFirmaIndistinta,false);a.chkOrigenPatrimonioActividadPrincipal.shieldCheckBox({label:"Actividad Principal"});Core.Functions.Validations.toggleValidation(a.chkOrigenPatrimonioActividadPrincipal,false);a.chkOrigenPatrimonioVentaBienes.shieldCheckBox({label:"Venta de Bienes"});Core.Functions.Validations.toggleValidation(a.chkOrigenPatrimonioVentaBienes,false);a.chkOrigenPatrimonioHerencia.shieldCheckBox({label:"Herencia"});Core.Functions.Validations.toggleValidation(a.chkOrigenPatrimonioHerencia,false);a.chkOrigenPatrimonioOtro.shieldCheckBox({label:"Otro",events:{click:function(f){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.chkOrigenPatrimonioOtro,false);a.txtOrigenPatrimonioOtroDetalle.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtOrigenPatrimonioOtroDetalle,false);a.chkConvenioComitenteAAGI.shieldCheckBox({label:"Mandato Discrecional",enabled:false});Core.Functions.Validations.toggleValidation(a.chkConvenioComitenteAAGI,false);a.txtCanalOtroDetalle.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtCanalOtroDetalle,false);a.ddlArancel.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idArancel}",textTemplate:"{Descripcion}",autoComplete:{enabled:false}});Core.Functions.Validations.toggleValidation(a.ddlArancel,false);a.ddlNivelRiesgo.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idRiesgo}",textTemplate:"{RiesgoDescripcion}",enabled:false});Core.Functions.Validations.toggleValidation(a.ddlNivelRiesgo,false);a.txtComoLlegoABalanz.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtComoLlegoABalanz,false);a.txtUsuarioAsignado.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtUsuarioAsignado,false);a.chkTipoInversionAcciones.shieldCheckBox({label:"Acciones"});Core.Functions.Validations.toggleValidation(a.chkTipoInversionAcciones,false);a.chkTipoInversionTitulosPublicos.shieldCheckBox({label:"Títulos Públicos"});Core.Functions.Validations.toggleValidation(a.chkTipoInversionTitulosPublicos,false);a.chkTipoInversionFideicomisos.shieldCheckBox({label:"Fideicomisos"});Core.Functions.Validations.toggleValidation(a.chkTipoInversionFideicomisos,false);a.chkTipoInversionFondos.shieldCheckBox({label:"Fondos"});Core.Functions.Validations.toggleValidation(a.chkTipoInversionFondos,false);a.chkTipoInversionOpciones.shieldCheckBox({label:"Opciones"});Core.Functions.Validations.toggleValidation(a.chkTipoInversionOpciones,false);a.chkTipoInversionOperacionesCambioUSD.shieldCheckBox({label:"Cambio (U$D)"});Core.Functions.Validations.toggleValidation(a.chkTipoInversionOperacionesCambioUSD,false);a.chkTipoInversionFuturos.shieldCheckBox({label:"Futuros"});Core.Functions.Validations.toggleValidation(a.chkTipoInversionFuturos,false);a.chkTipoInversionObligacionesNegociables.shieldCheckBox({label:"ONs"});Core.Functions.Validations.toggleValidation(a.chkTipoInversionObligacionesNegociables,false);a.chkTipoInversionChequePagoDiferido.shieldCheckBox({label:"Cheque Dif. / Fact. Créd. Electrónica"});Core.Functions.Validations.toggleValidation(a.chkTipoInversionChequePagoDiferido,false);a.chkTipoInversionOtro.shieldCheckBox({label:"Otro",events:{click:function(f){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.chkTipoInversionOtro,false);a.txtTipoInversionOtroDetalle.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtTipoInversionOtroDetalle,false);a.txtPlazoInversion.shieldNumericTextBox({min:0,max:99999,step:1});Core.Functions.Validations.toggleValidation(a.txtPlazoInversion,false);a.txtDescripcionActividadCliente.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtDescripcionActividadCliente,false);a.btnAgregarArchivo.unbind("click");a.btnAgregarArchivo.on("click",function(){var e=new Core.Controls.ManagerAltaCuentaNuevoArchivo({onSave:function(g){a.archivos.push({urlArchivo:g.file.urlArchivo,idTipoArchivo:g.idTipoArchivo,Tipo:g.Tipo,Fecha:g.Fecha,Comentario:g.comentarios});var f=a.gridArchivos.swidget().initialOptions;f.dataSource.data=a.archivos;a.gridArchivos.swidget().refresh(f)},tiposArchivos:((a.dataParametros!=null)?$.grep(a.dataParametros.TiposArchivos,function(g,f){return g.Fisica&&g.BCV}):[])}).show()});a.btnNuevaPersona.unbind("click");a.btnNuevaPersona.on("click",function(){a.divAltaCuenta.hide();a.divManagerPersona.show();a.divMatrizRiesgo.hide();var e=new Core.Controls.ManagerPersona({container:a.divManagerPersona,divMatrizRiesgo:a.divMatrizRiesgo,namespaceActivo:a.namespaceActivo,idTipoValidacion:(a.dataCuenta&&a.ddlEstado.swidget().selectedItem())?a.ddlEstado.swidget().selectedItem().idTipoValidacion:0,dataParametros:a.dataParametros,dataParametrosUsuario:a.dataParametrosUsuario,optionsApertura:a.optionsApertura,idAperturaCuenta:a.idAperturaCuenta,esCuentaJuridica:false,onSave:function(g){var f=a.getMaxNumero(g.tipo);if(a.isAperturaWeb()&&g.tipo==Core.Business.eTipoPersonaCuenta.Titular&&f<=4){f=4}g.numero=f+1;a.personas.push(g);a.refreshPersonas();a.setNivelDeRiesgo();return true},onClose:function(){a.divAltaCuenta.show();a.divManagerPersona.hide();a.divMatrizRiesgo.hide()}}).show()});a.btnAgregarObservacion.unbind("click");a.btnAgregarObservacion.on("click",function(){new Core.Controls.Prompt("Nueva Observación","Ingrese la observación",{onAccepted:function(e){var f=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"apertura/cuenta/observacion/"+a.idAperturaCuenta,requestType:"POST",requestData:{observacion:e}});f.onSuccess=function(h){a.observaciones=h.observaciones;var g=a.gridObservaciones.swidget().initialOptions;g.dataSource.data=a.observaciones;a.gridObservaciones.swidget().refresh(g)};f.request()}}).show()});a.btnVolver.unbind("click");a.btnVolver.on("click",function(){a.destroy(true)});a.btnGuardarYCerrar.unbind("click");a.btnGuardarYCerrar.on("click",function(){var e=a.getRequestData(a.ddlEstado.swidget().selectedItem());if(e!=null){var f=new Core.Ajax.ServerRequest({showOverlay:true,requestUrl:"apertura/cuenta",requestType:"POST",requestData:e});f.onSuccess=function(g){if(a.onSave){a.onSave(g.idAperturaCuenta,g.version)}a.destroy(true)};f.request()}else{$("html, body").animate({scrollTop:$(".cuenta").offset().top},1000)}});a.btnRefirmar.unbind("click");a.btnRefirmar.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea Reenviar el mail de firma? Esta acción reenviará los mails con los links para la firma digital a todos aquellos destinatarios que aún no hayan firmado.",{onAccepted:function(){var e=new Core.Ajax.ServerRequest({overlayElement:a.btnRefirmar,secureRequest:true,requestUrl:"apertura/cuenta/refirmar",requestType:"POST",requestData:{idAperturaCuenta:a.idAperturaCuenta}});e.onSuccess=function(){if(a.onSave){a.onSave(a.dataCuenta.datos[0].idAperturaCuenta,a.dataCuenta.datos[0].version)}a.destroy(true)};e.request()}}).show()});a.btnAnularFirma.unbind("click");a.btnAnularFirma.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea Anular la Firma de esta Apertura? Esta acción desestimará la última firma completa que tenga esta apertura, requiriendo que se deba volver a firmar por el cliente.",{onAccepted:function(){var e=new Core.Ajax.ServerRequest({overlayElement:a.btnAnularFirma,secureRequest:true,requestUrl:"apertura/cuenta/anularfirma",requestType:"POST",requestData:{idAperturaCuenta:a.idAperturaCuenta}});e.onSuccess=function(f){new Core.Controls.Dialog("Aviso",(f.Descripcion?f.Descripcion:"Operación realizada con éxito."),{displayButtons:{close:true,accept:false}}).show()};e.request()}}).show()});a.btnAvanzarImportacion.unbind("click");a.btnAvanzarImportacion.on("click",function(){new Core.Controls.Confirmation("Confirmación","Atención: Esta apertura será enviada al Importador. Se le generarán Matrices a todas las Personas que aún no tengan una creada y se pasará automáticamente de estado. Estas seguro que querés continuar?",{onAccepted:function(){var e=a.getRequestData({idEstadoAperturaCuenta:6,idTipoValidacion:1});if(e!=null){var f=new Core.Ajax.ServerRequest({showOverlay:true,requestUrl:"apertura/cuenta?ff=1",requestType:"POST",requestData:e});f.onSuccess=function(g){if(a.onSave){a.onSave(g.idAperturaCuenta,g.version)}a.destroy(true)};f.request()}else{$("html, body").animate({scrollTop:$(".cuenta").offset().top},1000)}}}).show()});a.btnFormularioVacio.unbind("click");a.btnFormularioVacio.on("click",function(){if(a.dataParametrosUsuario&&a.dataParametrosUsuario.Links&&a.dataParametrosUsuario.Links[0].FormularioVacio){window.open(a.dataParametrosUsuario.Links[0].FormularioVacio,"_blank")}});var c=[{width:"25%",field:"nombre",title:"Nombre",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"25%",field:"apellido",title:"Apellido",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"25%",field:"tipo",title:"Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,g){if(f.tipo==Core.Business.eTipoPersonaCuenta.Titular){e.html("<span>Titular</span>")}else{e.html("<span>Autorizado</span>")}}},{width:"25%",field:"numero",title:"Número",headerAttributes:Core.Functions.grid.getCellOddClass()},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){if(f.tienePruebaDeVida){var g=$('<button disabled type="button" title="Prueba de Vida" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/prueba-de-vida.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color",f.tienePruebaDeVida)}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){if(f.tieneMatchCara){var g=$('<button disabled type="button" title="Match de Cara" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/match-cara.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color",f.tieneMatchCara);if(a.optionsApertura&&a.optionsApertura.consultaICAR){g.removeAttr("disabled");g.on("click",function(){Core.Functions.ExternalServices.Icar.showReport(g,a.idAperturaCuenta,f.tipo,f.numero)})}}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){if(f.tieneDatosPrecargados){var g=$('<button disabled type="button" title="Datos Precargados" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/datos-precargados.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color",f.tieneDatosPrecargados);if(a.optionsApertura&&a.optionsApertura.consultaICAR){g.removeAttr("disabled");g.on("click",function(){Core.Functions.ExternalServices.Icar.showReport(g,a.idAperturaCuenta,f.tipo,f.numero)})}}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){if(f.tieneReuters){var g=$('<button disabled type="button" title="Reuters" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/reuters-logo.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color",f.tieneReuters);if(a.optionsApertura&&a.optionsApertura.consultaReuters){g.removeAttr("disabled");g.on("click",function(){Core.Functions.ExternalServices.Reuters.showReport(g,f.documento,encodeURIComponent(f.nombre.toLowerCase()+" "+f.apellido.toLowerCase()),f.sexo,f.fechaNacimiento,f.nacionalidad)})}}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){if(f.tieneNOSIS){var g=$('<button disabled type="button" title="Nosis" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/nosis-logo.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color",f.tieneNOSIS);if(a.optionsApertura&&a.optionsApertura.consultaNosis){g.removeAttr("disabled");g.on("click",function(){Core.Functions.ExternalServices.Nosis.showReport(g,f.cuit_cuil)})}}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){if(f.tieneRenaper){var g=$('<button disabled type="button" title="Renaper" class="btn-sm balanz-button"style="border:3px solid; background-color:#fff;"><img src="/images/renaper-logo.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color",f.tieneRenaper);if(a.optionsApertura&&a.optionsApertura.consultaRenaper){g.removeAttr("disabled");g.on("click",function(){Core.Functions.ExternalServices.Renaper.showReport(g,f.documento,f.idTipoDocumento,f.sexo)})}}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){if(f.tieneUIF){var g=$('<button disabled type="button" title="UIF" class="btn-sm balanz-button"style="border:3px solid; background-color:#fff;"><img src="/images/uif-logo.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color",f.tieneUIF);if(a.optionsApertura&&a.optionsApertura.consultaUIF){g.removeAttr("disabled");g.on("click",function(){Core.Functions.ExternalServices.UIF.showReport(g,f.cuit_cuil)})}}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){var g=$('<button disabled type="button" title="Google" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/google-logo.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color","lightgreen");if(a.optionsApertura&&a.optionsApertura.consultaGoogle){g.removeAttr("disabled");g.on("click",function(){var j="http://www.google.com/search?q="+f.nombre+"+"+f.apellido;window.open(j,"_blank");overlay=new Core.Controls.Overlay(a.btnAgregarArchivo,{});var i=new XMLHttpRequest();i.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"webshot?url="+encodeURIComponent(encodeURIComponent(j)),true);i.responseType="blob";i.setRequestHeader("Content-Type","application/json;charset=UTF-8");i.setRequestHeader("Authorization",Core.Objects.Context.Token);i.onerror=function(k){var l=new Core.Controls.Dialog("Error","No se ha podido descargar la imagen",{displayButtons:{close:true,accept:false}});l.show();overlay.destroy();return};i.onload=function(k){if(i.status==200){var n=new XMLHttpRequest();n.onload=function(p){var o=new Core.Controls.ManagerAltaCuentaNuevoArchivo({onSave:function(r){a.archivos.push({urlArchivo:r.file.urlArchivo,idTipoArchivo:r.idTipoArchivo,Tipo:r.Tipo,Fecha:r.Fecha,Comentario:r.comentarios});var q=a.gridArchivos.swidget().initialOptions;q.dataSource.data=a.archivos;a.gridArchivos.swidget().refresh(q)},tiposArchivos:((a.dataParametros!=null)?$.grep(a.dataParametros.TiposArchivos,function(r,q){return r.Fisica&&r.BCV}):[]),idTipoArchivoDefault:"7",comentariosDefault:"Google Search "+f.nombre+" "+f.apellido,file:JSON.parse(n.responseText)}).show();overlay.destroy()};n.onerror=function(o){var p=new Core.Controls.Dialog("Error","No se ha podido adjuntar la foto",{displayButtons:{close:true,accept:false}});p.show();overlay.destroy();return};var m=new Blob([i.response],{type:"image/png"});n.open("POST",Core.Origin+Core.PrefixUrl+"upload/documento/7",true);n.setRequestHeader("Authorization",Core.Objects.Context.Token);n.setRequestHeader("Accept","application/json");n.setRequestHeader("Content-Type","image/png");n.send(m)}else{var l=new Core.Controls.Dialog("Error","No se ha podido descargar la imagen",{displayButtons:{close:true,accept:false}});l.show();overlay.destroy()}};i.send()})}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(f,g,h){var e=$('<button type="button" title="Editar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(f);e.on("click",function(){a.divAltaCuenta.hide();a.divManagerPersona.show();a.divMatrizRiesgo.hide();var i=new Core.Controls.ManagerPersona({container:a.divManagerPersona,divMatrizRiesgo:a.divMatrizRiesgo,namespaceActivo:a.namespaceActivo,idTipoValidacion:(a.dataCuenta&&a.ddlEstado.swidget().selectedItem())?a.ddlEstado.swidget().selectedItem().idTipoValidacion:0,persona:a.personas[h],dataParametros:a.dataParametros,dataParametrosUsuario:a.dataParametrosUsuario,optionsApertura:a.optionsApertura,idAperturaCuenta:a.idAperturaCuenta,readOnly:a.readOnly,esCuentaJuridica:false,onSave:function(j){a.personas[h]=j;if(!a.isAperturaWeb()){a.refreshNumeroPersonas()}a.refreshPersonas();a.setNivelDeRiesgo();return true},onClose:function(){a.divAltaCuenta.show();a.divManagerPersona.hide();a.divMatrizRiesgo.hide()}}).show()})}}];if(!a.readOnly){c.push({width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(f,g,h){if(!a.isAperturaWeb()||!(g.tipo==Core.Business.eTipoPersonaCuenta.Titular&&g.numero==1)||a.namespaceActivo=="Legajos"){var e=$('<button type="button" title="Eliminar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(f);e.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar la persona: "+g.nombre+" "+g.apellido+"?",{onAccepted:function(){a.personas.remove(a.personas[h]);if(!a.isAperturaWeb()){a.refreshNumeroPersonas()}a.refreshPersonas()}}).show()})}}})}a.gridPersonas.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:c});a.gridArchivos.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},columns:[{width:"25%",field:"Fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"25%",field:"Tipo",title:"Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"50%",field:"Comentario",title:"Comentario",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:100,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(g,h,i){if(a.namespaceActivo!="ReporteAperturas"||(a.optionsApertura&&a.optionsApertura.descargarArchivosApertura)){var e=$('<button type="button" title="Descargar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>').appendTo(g);e.on("click",function(){window.open(Core.Origin+Core.Functions.Context.getPathname()+h.urlArchivo)})}if(!a.readOnly){var f=$('<button type="button" title="Eliminar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(g);f.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar el archivo?",{onAccepted:function(){a.archivos=$.grep(a.archivos,function(l,k){return l.urlArchivo!=h.urlArchivo||l.Fecha!=h.Fecha||l.Tipo!=h.Tipo||l.Comentario!=h.Comentario});var j=a.gridArchivos.swidget().initialOptions;j.dataSource.data=a.archivos;a.gridArchivos.swidget().refresh(j)}}).show()})}}}]});a.gridObservaciones.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},columns:[{width:"25%",field:"Fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"25%",field:"username",title:"Usuario",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"50%",field:"Observacion",title:"Observación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString}]});a.getData()};a.setNivelDeRiesgo=function(){var d=0;for(var c=0;c<a.personas.length;c++){if(a.personas[c].idRiesgo>d){d=a.personas[c].idRiesgo}}var e=a.ddlNivelRiesgo.swidget().initialOptions;e.value=(d?d.toString():"");a.ddlNivelRiesgo.swidget().refresh(e)};a.getData=function(){a.personas=a.dataCuenta!=null?a.dataCuenta.personas:[];a.archivos=a.dataCuenta!=null?a.dataCuenta.archivos:[];a.observaciones=a.dataCuenta!=null?a.dataCuenta.observaciones:[];a.loadControls()};a.loadControls=function(){if(a.readOnly){var A=[];for(var j=1;j<=a.maxVersion;j++){A.push({version:j})}var v=a.ddlVersion.swidget().initialOptions;v.dataSource.data=A;v.value=a.versionActual.toString();a.ddlVersion.swidget().refresh(v)}a.divMontoInvertirContainer.html("");a.dataParametros.MontoAInvertir.forEach(function(D,C){if(D.habilitado&&D.AR){var B=$("<div></div>").appendTo(a.divMontoInvertirContainer);var i=$('<input class="form-control sui-input monto-a-invertir-option" type="radio" name="MontoAInvertir" idMontoAInvertir="'+D.MontoAInvertir+'">').appendTo(B);i.shieldRadioButton({label:D.Descripcion})}});a.divCanalContainer.html("");if(a.dataParametrosUsuario&&a.dataParametrosUsuario.canalDeVenta){a.dataParametrosUsuario.canalDeVenta.forEach(function(C,B){var i=$('<input type="radio" class="form-control sui-input chk-canal-option" name="option-canal" idCanalDeVenta="'+C.idCanalDeVenta+'">').appendTo(a.divCanalContainer);i.shieldRadioButton({label:C.Descripcion,events:{click:function(D){a.setControls()}}})})}a.divIngresosAnualesContainer.html("");a.dataParametros.IngresosAnuales.forEach(function(D,C){if(D.habilitado&&D.AR){var B=$("<div></div>").appendTo(a.divIngresosAnualesContainer);var i=$('<input class="form-control sui-input ingresos-anuales-option" type="radio" name="IngresosAnuales" idIngresosAnuales="'+D.IngresosAnuales+'" id="ingresosAnuales_'+D.IngresosAnuales+'">').appendTo(B);i.shieldRadioButton({label:D.Descripcion})}});a.divPatrimonioNetoContainer.html("");a.dataParametros.PatrimoniosNetos.forEach(function(D,C){if(D.habilitado&&D.AR){var B=$("<div></div>").appendTo(a.divPatrimonioNetoContainer);var i=$('<input class="form-control sui-input patrimonio-neto-option" type="radio" name="PatrimonioNeto" idPatromonioNeto="'+D.PatrimonioNeto+'" id="patrimonioNeto_'+D.PatrimonioNeto+'">').appendTo(B);i.shieldRadioButton({label:D.Descripcion})}});var v=a.ddlAsesor.swidget().initialOptions;v.dataSource.data=(a.dataParametrosUsuario!=null)?a.dataParametrosUsuario.asesores:[];if(a.dataCuenta!=null&&a.dataCuenta.datos[0].idPersonaAsesor!=null){v.value=a.dataCuenta.datos[0].idPersonaAsesor.toString()}a.ddlAsesor.swidget().refresh(v);var v=a.ddlEstado.swidget().initialOptions;v.dataSource.data=(a.dataCuenta!=null)?a.dataCuenta.estados:[];if(a.dataCuenta!=null&&a.dataCuenta.datos[0].idEstadoAperturaCuenta!=null){v.value=a.dataCuenta.datos[0].idEstadoAperturaCuenta.toString()}a.ddlEstado.swidget().refresh(v);if(a.ddlEstado.swidget().selectedItem()){a.lblEstadoCuenta.text(a.ddlEstado.swidget().selectedItem().Nombre)}var y=a.chkTipoFirmaConjunta.swidget().initialOptions;y.checked=(a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoFirma==Core.Business.eTipoFirma.Conjunta)?true:false;a.chkTipoFirmaConjunta.swidget().refresh(y);var y=a.chkTipoFirmaIndistinta.swidget().initialOptions;y.checked=(a.dataCuenta==null||(a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoFirma==Core.Business.eTipoFirma.Indistinta))?true:false;a.chkTipoFirmaIndistinta.swidget().refresh(y);a.chkCuentasComitente.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].cuentaComitente)?true:false));a.chkCuentasCuotapartista.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].cuentaCuotapartista)?true:false));a.chkIngresoAsesorFinanciero.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].contactoOriginal)?true:false));a.chkUsarFirmaDigital.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].UsarFirmaDigital)?true:false));a.divUsarFirmaDigital.hide();if(a.dataCuenta!=null&&a.dataCuenta.datos[0].habilitarFirmaDigital){a.divUsarFirmaDigital.show()}var v=a.txtIngresoAsesorFinanciero.swidget().initialOptions;v.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].contactoOriginal)?a.dataCuenta.datos[0].contactoOriginal:"";a.txtIngresoAsesorFinanciero.swidget().refresh(v);if(a.dataCuenta!=null){var f=$(".monto-a-invertir-option");var x=false;for(var j=0;j<f.length;j++){var c=$(f[j]);var y=c.swidget().initialOptions;y.checked=(c.attr("idMontoAInvertir")==a.dataCuenta.datos[0].montoAInvertir);if(!x){x=(c.attr("idMontoAInvertir")==a.dataCuenta.datos[0].montoAInvertir)}c.swidget().refresh(y)}if(!x&&a.dataCuenta.datos[0].montoAInvertirDescripcion){a.lblMontoInvertirAlert.html("<br />(El cliente eligió: "+a.dataCuenta.datos[0].montoAInvertirDescripcion+")")}var e=$(".ingresos-anuales-option");var u=false;for(var j=0;j<e.length;j++){var c=$(e[j]);var y=c.swidget().initialOptions;y.checked=(c.attr("idIngresosAnuales")==a.dataCuenta.datos[0].ingresosAnuales);if(!u){u=(c.attr("idIngresosAnuales")==a.dataCuenta.datos[0].ingresosAnuales)}c.swidget().refresh(y)}if(!u&&a.dataCuenta.datos[0].ingresosAnualesDescripcion){a.lblIngresosAnualesAlert.html("<br />(El cliente eligió: "+a.dataCuenta.datos[0].ingresosAnualesDescripcion+")")}var g=$(".patrimonio-neto-option");var z=false;for(var j=0;j<g.length;j++){var c=$(g[j]);var y=c.swidget().initialOptions;y.checked=(c.attr("idPatromonioNeto")==a.dataCuenta.datos[0].patrimonioNeto);if(!z){z=(c.attr("idPatromonioNeto")==a.dataCuenta.datos[0].patrimonioNeto)}c.swidget().refresh(y)}if(!z&&a.dataCuenta.datos[0].patrimonioNetoDescripcion){a.lblPatrimonioNetoAlert.html("<br />(El cliente eligió: "+a.dataCuenta.datos[0].patrimonioNetoDescripcion+")")}var d=$(".chk-canal-option");for(var j=0;j<d.length;j++){var c=$(d[j]);var y=c.swidget().initialOptions;y.checked=(c.attr("idCanalDeVenta")==a.dataCuenta.datos[0].idCanal);c.swidget().refresh(y)}}a.chkOrigenPatrimonioActividadPrincipal.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].patrimonioActividadPrincipal)?true:false));a.chkOrigenPatrimonioHerencia.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].patrimonioHerencia)?true:false));a.chkOrigenPatrimonioVentaBienes.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].patrimonioVentaDeBienes)?true:false));a.chkOrigenPatrimonioOtro.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].patrimonioOtro)?true:false));var v=a.txtOrigenPatrimonioOtroDetalle.swidget().initialOptions;v.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].patrimonioOtro)?a.dataCuenta.datos[0].patrimonioOtro:"";a.txtOrigenPatrimonioOtroDetalle.swidget().refresh(v);a.chkConvenioComitenteAAGI.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].AceptoMandatoDiscrecional)?true:false));a.divConvenioComitenteAAGI.hide();if(a.dataCuenta!=null&&a.dataCuenta.datos[0].SolicitarMandatoDiscrecional){a.divConvenioComitenteAAGI.show()}var v=a.txtCanalOtroDetalle.swidget().initialOptions;v.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].canalOtro)?a.dataCuenta.datos[0].canalOtro:"";a.txtCanalOtroDetalle.swidget().refresh(v);var v=a.ddlArancel.swidget().initialOptions;v.dataSource.data=(a.dataParametrosUsuario!=null)?$.grep(a.dataParametrosUsuario.aranceles,function(B,i){return B.idNegocio==Core.Enums.eNegocio.BCV}):[];if(a.dataCuenta!=null&&a.dataCuenta.datos[0].idArancel!=null){v.value=a.dataCuenta.datos[0].idArancel.toString()}a.ddlArancel.swidget().refresh(v);var v=a.ddlNivelRiesgo.swidget().initialOptions;v.dataSource.data=(a.dataParametrosUsuario!=null)?a.dataParametrosUsuario.riesgo:[];if(a.dataCuenta!=null&&a.dataCuenta.datos[0].idNivelDeRiesgo!=null){v.value=a.dataCuenta.datos[0].idNivelDeRiesgo.toString()}a.ddlNivelRiesgo.swidget().refresh(v);var v=a.txtComoLlegoABalanz.swidget().initialOptions;v.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].comoLlegoABalanz)?a.dataCuenta.datos[0].comoLlegoABalanz:"";a.txtComoLlegoABalanz.swidget().refresh(v);var v=a.txtDescripcionActividadCliente.swidget().initialOptions;v.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].descripcionActividadCliente)?a.dataCuenta.datos[0].descripcionActividadCliente:"";a.txtDescripcionActividadCliente.swidget().refresh(v);var v=a.txtUsuarioAsignado.swidget().initialOptions;v.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].usuarioAsignado)?a.dataCuenta.datos[0].usuarioAsignado:"";a.txtUsuarioAsignado.swidget().refresh(v);a.chkTipoInversionAcciones.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionAcciones)?true:false));a.chkTipoInversionTitulosPublicos.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionTitulosPublicos)?true:false));a.chkTipoInversionFideicomisos.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionFideicomisos)?true:false));a.chkTipoInversionOpciones.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionOpciones)?true:false));a.chkTipoInversionFondos.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionFondos)?true:false));a.chkTipoInversionOperacionesCambioUSD.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionOperacionesCambioUSD)?true:false));a.chkTipoInversionObligacionesNegociables.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionObligacionesNegociables)?true:false));a.chkTipoInversionFuturos.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionFuturos)?true:false));a.chkTipoInversionChequePagoDiferido.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionChequePagoDiferido)?true:false));a.chkTipoInversionOtro.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionOtros)?true:false));var v=a.txtTipoInversionOtroDetalle.swidget().initialOptions;v.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionOtros)?a.dataCuenta.datos[0].tipoInversionOtros:"";a.txtTipoInversionOtroDetalle.swidget().refresh(v);var v=a.txtPlazoInversion.swidget().initialOptions;v.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].plazoAproxInversion)?a.dataCuenta.datos[0].plazoAproxInversion:"";a.txtPlazoInversion.swidget().refresh(v);a.setControls();var v=a.gridPersonas.swidget().initialOptions;v.dataSource.data=a.personas;a.gridPersonas.swidget().refresh(v);var v=a.gridArchivos.swidget().initialOptions;v.dataSource.data=a.archivos;a.gridArchivos.swidget().refresh(v);var v=a.gridObservaciones.swidget().initialOptions;v.dataSource.data=a.observaciones;a.gridObservaciones.swidget().refresh(v);a.divInformes.html("");if(a.dataCuenta&&a.dataCuenta.datos[0].validacionManual){var l=$('<label class="left" style="color:red;">Apertura Manual</label>').appendTo(a.divInformes)}if(a.aperturaCuenta){var w=$("<label>Resumen de la Cuenta:  </label>").appendTo(a.divInformes);if(a.aperturaCuenta.tienePruebaDeVida){var p=$('<button disabled style="border:3px solid; background-color:#fff;" type="button" title="Prueba de Vida" class="btn-sm balanz-button"><img src="/images/prueba-de-vida.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);p.css("border-color",a.aperturaCuenta.tienePruebaDeVida)}if(a.aperturaCuenta.tieneMatchCara){var m=$('<button disabled type="button" title="Match de Cara" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/match-cara.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);m.css("border-color",a.aperturaCuenta.tieneMatchCara)}if(a.aperturaCuenta.tieneDatosPrecargados){var k=$('<button disabled type="button" title="Datos Precargados" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/datos-precargados.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);k.css("border-color",a.aperturaCuenta.tieneDatosPrecargados)}if(a.aperturaCuenta.tieneReuters){var r=$('<button disabled style="border:3px solid; background-color:#fff;" type="button" title="Reuters" class="btn-sm balanz-button"><img src="/images/reuters-logo.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);r.css("border-color",a.aperturaCuenta.tieneReuters)}if(a.aperturaCuenta.tieneNOSIS){var o=$('<button disabled style="border:3px solid; background-color:#fff;" type="button" title="Nosis" class="btn-sm balanz-button"><img src="/images/nosis-logo.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);o.css("border-color",a.aperturaCuenta.tieneNOSIS)}if(a.aperturaCuenta.tieneRenaper){var q=$('<button disabled style="border:3px solid; background-color:#fff;" type="button" title="Renaper" class="btn-sm balanz-button"><img src="/images/renaper-logo.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);q.css("border-color",a.aperturaCuenta.tieneRenaper)}if(a.aperturaCuenta.tieneUIF){var s=$('<button disabled style="border:3px solid; background-color:#fff;" type="button" title="UIF" class="btn-sm balanz-button"><img src="/images/uif-logo.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);s.css("border-color",a.aperturaCuenta.tieneUIF)}if(a.aperturaCuenta.motorDecision){var n=$('<button style="border:3px solid; background-color:transparent; border-color:transparent;" type="button" title="Motor decisión" class="btn-sm balanz-button"></button>').appendTo(a.divInformes);var t=$('<img src="/images/circ-trans.png" style="width:20px; height:20px;" />').appendTo(n);t.css("background-color",a.aperturaCuenta.motorDecision);n.on("click",function(){Core.Functions.ExternalServices.MotorDecision.showReport(n,a.idAperturaCuenta)})}}if(a.dataCuenta&&a.dataCuenta.datos[0].tieneDocusign){var l=$('<button disabled style="border:3px solid; background-color:#fff;" type="button" title="DocuSign" class="btn-sm balanz-button"><img src="'+(a.dataCuenta.datos[0].tieneDocusign=="disabled"?"/images/docusign-logo-inactivo.png":"/images/docusign-logo.png")+'" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);l.css("border-color",(a.dataCuenta.datos[0].tieneDocusign=="disabled"?"lightgray":a.dataCuenta.datos[0].tieneDocusign));if(a.optionsApertura&&a.optionsApertura.consultaDocusign&&a.dataCuenta.datos[0].tieneDocusign!="disabled"){l.removeAttr("disabled");l.on("click",function(){if(a.dataCuenta!=null){Core.Functions.ExternalServices.DocuSign.showReport(l,a.dataCuenta.datos[0].idAperturaCuenta)}})}}if(a.namespaceActivo=="Legajos"||a.namespaceActivo=="OpenManagerAltaCuenta"){var h=(a.dataCuenta!=null&&a.dataCuenta.datos[0].NumComitente)?("Comitente: "+a.dataCuenta.datos[0].NumComitente):"";h+=(a.dataCuenta!=null&&a.dataCuenta.datos[0].NumCuotapartista)?((h?" || ":"")+("Cuotapartista: "+a.dataCuenta.datos[0].NumCuotapartista)):"";a.lblComitenteCuotapartistaCuenta.text(h);a.lblDescripcionCuenta.text((a.dataCuenta!=null&&a.dataCuenta.datos[0].DescripcionCuenta)?a.dataCuenta.datos[0].DescripcionCuenta:"");a.divDescripcionCuenta.show();a.divComitenteCuotapartistaCuenta.show()}};a.getRequestData=function(c){Core.Functions.Validations.toggleValidation(a.ddlAsesor,false);Core.Functions.Validations.toggleValidation(a.ddlEstado,false);Core.Functions.Validations.toggleValidation(a.txtOrigenPatrimonioOtroDetalle,false);Core.Functions.Validations.toggleValidation(a.txtCanalOtroDetalle,false);Core.Functions.Validations.toggleValidation(a.ddlArancel,false);Core.Functions.Validations.toggleValidation(a.ddlNivelRiesgo,false);Core.Functions.Validations.toggleValidation(a.txtComoLlegoABalanz,false);Core.Functions.Validations.toggleValidation(a.txtUsuarioAsignado,false);Core.Functions.Validations.toggleValidation(a.txtTipoInversionOtroDetalle,false);Core.Functions.Validations.toggleValidation(a.txtPlazoInversion,false);Core.Functions.Validations.toggleValidation(a.txtDescripcionActividadCliente,false);a.divAlert.slideUp();if(!a.dataCuenta||!c||(c.idTipoValidacion==0)){return a.getRequestDataNoValidated(c)}else{return a.getRequestDataValidated(c)}};a.getRequestDataNoValidated=function(c){var d={};d.tipoFirma=a.getSelectedTipoFirma();d.montoAInvertir=a.getSelectedMontoAInvertir();d.ingresosAnuales=a.getSelectedIngresosAnuales();d.patrimonioNeto=a.getSelectedPatrimonioNeto();d.patrimonioActividadPrincipal=a.chkOrigenPatrimonioActividadPrincipal.swidget().checked()?1:0;d.patrimonioVentaDeBienes=a.chkOrigenPatrimonioVentaBienes.swidget().checked()?1:0;d.patrimonioHerencia=a.chkOrigenPatrimonioHerencia.swidget().checked()?1:0;d.patrimonioOtro=a.getOrigenPatrimonioOtro();d.idCanal=a.getSelectedCanal();if(d.idCanal==Core.Business.eCanal.Otro){d.canalOtro=a.getCanalOtro()}d.comoLlegoABalanz=a.txtComoLlegoABalanz.val();d.descripcionActividadCliente=a.txtDescripcionActividadCliente.val();d.usuarioAsignado=a.txtUsuarioAsignado.val();d.tipoInversionAcciones=a.chkTipoInversionAcciones.swidget().checked()?1:0;d.tipoInversionTitulosPublicos=a.chkTipoInversionTitulosPublicos.swidget().checked()?1:0;d.tipoInversionFideicomisos=a.chkTipoInversionFideicomisos.swidget().checked()?1:0;d.tipoInversionOpciones=a.chkTipoInversionOpciones.swidget().checked()?1:0;d.tipoInversionFondos=a.chkTipoInversionFondos.swidget().checked()?1:0;d.tipoInversionOperacionesCambioUSD=a.chkTipoInversionOperacionesCambioUSD.swidget().checked()?1:0;d.tipoInversionObligacionesNegociables=a.chkTipoInversionObligacionesNegociables.swidget().checked()?1:0;d.tipoInversionFuturos=a.chkTipoInversionFuturos.swidget().checked()?1:0;d.tipoInversionChequePagoDiferido=a.chkTipoInversionChequePagoDiferido.swidget().checked()?1:0;d.tipoInversionOtros=a.getTipoInversionOtro();d.plazoAproxInversion=a.txtPlazoInversion.val();d.idArancel=((a.ddlArancel.swidget().selectedItem())?a.ddlArancel.swidget().selectedItem().idArancel:null);d.idPersonaAsesor=((a.ddlAsesor.swidget().selectedItem())?a.ddlAsesor.swidget().selectedItem().idPersona:null);d.UsarFirmaDigital=a.chkUsarFirmaDigital.swidget().checked()?1:0;if(Core.Objects.Context.Configuration.idAplicacion==3){d.idNivelDeRiesgo=((a.ddlNivelRiesgo.swidget().selectedItem())?a.ddlNivelRiesgo.swidget().selectedItem().idRiesgo:null)}else{d.idNivelDeRiesgo=(a.dataCuenta)?a.dataCuenta.datos[0].idNivelDeRiesgo:null}if(a.dataCuenta!=null){d.idEstadoAperturaCuenta=((c)?c.idEstadoAperturaCuenta:null);d.idAperturaCuenta=a.dataCuenta.datos[0].idAperturaCuenta;d.version=a.dataCuenta.datos[0].version;d.hash=a.dataCuenta.datos[0].hash;d.AceptoTyC=a.dataCuenta.datos[0].AceptoTyC;d.idPaso=a.dataCuenta.datos[0].idPaso;d.idSubPaso=a.dataCuenta.datos[0].idSubPaso;d.nombreOriginal=a.dataCuenta.datos[0].nombreOriginal;d.emailOriginal=a.dataCuenta.datos[0].emailOriginal;d.idCuentaExistente=a.dataCuenta.datos[0].idCuentaExistente;d.idExterno=a.dataCuenta.datos[0].idExterno;d.AceptoMandatoDiscrecional=a.dataCuenta.datos[0].AceptoMandatoDiscrecional;d.SolicitarMandatoDiscrecional=a.dataCuenta.datos[0].SolicitarMandatoDiscrecional}d.personas=a.personas;d.archivos=a.archivos;d.observaciones=a.observaciones;d.contactoOriginal=a.chkIngresoAsesorFinanciero.swidget().checked()?a.txtIngresoAsesorFinanciero.val():"";d.cuentaComitente=a.chkCuentasComitente.swidget().checked()?1:0;d.cuentaCuotapartista=a.chkCuentasCuotapartista.swidget().checked()?1:0;return d};a.getRequestDataValidated=function(d){var g={value:true};var f={};f.tipoFirma=a.getSelectedTipoFirma(g);f.montoAInvertir=a.getSelectedMontoAInvertir(g);f.ingresosAnuales=a.getSelectedIngresosAnuales(g);f.patrimonioNeto=a.getSelectedPatrimonioNeto(g);f.patrimonioActividadPrincipal=a.chkOrigenPatrimonioActividadPrincipal.swidget().checked()?1:0;f.patrimonioVentaDeBienes=a.chkOrigenPatrimonioVentaBienes.swidget().checked()?1:0;f.patrimonioHerencia=a.chkOrigenPatrimonioHerencia.swidget().checked()?1:0;f.patrimonioOtro=a.getOrigenPatrimonioOtro(g);f.idCanal=a.getSelectedCanal(g);if(f.idCanal==Core.Business.eCanal.Otro){f.canalOtro=a.getCanalOtro(g)}f.comoLlegoABalanz=Core.Functions.Validations.getValidatedSwidgetValue(a.txtComoLlegoABalanz,g);f.descripcionActividadCliente=Core.Functions.Validations.getValidatedSwidgetValue(a.txtDescripcionActividadCliente,g);f.usuarioAsignado=a.txtUsuarioAsignado.val();f.tipoInversionAcciones=a.chkTipoInversionAcciones.swidget().checked()?1:0;f.tipoInversionTitulosPublicos=a.chkTipoInversionTitulosPublicos.swidget().checked()?1:0;f.tipoInversionFideicomisos=a.chkTipoInversionFideicomisos.swidget().checked()?1:0;f.tipoInversionOpciones=a.chkTipoInversionOpciones.swidget().checked()?1:0;f.tipoInversionFondos=a.chkTipoInversionFondos.swidget().checked()?1:0;f.tipoInversionOperacionesCambioUSD=a.chkTipoInversionOperacionesCambioUSD.swidget().checked()?1:0;f.tipoInversionObligacionesNegociables=a.chkTipoInversionObligacionesNegociables.swidget().checked()?1:0;f.tipoInversionFuturos=a.chkTipoInversionFuturos.swidget().checked()?1:0;f.tipoInversionChequePagoDiferido=a.chkTipoInversionChequePagoDiferido.swidget().checked()?1:0;f.tipoInversionOtros=a.getTipoInversionOtro(g);f.plazoAproxInversion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtPlazoInversion,g);f.idPersonaAsesor=Core.Functions.Validations.getValidatedDropDownValue(a.ddlAsesor,g);f.idArancel=(a.chkCuentasComitente.swidget().checked()?Core.Functions.Validations.getValidatedDropDownValue(a.ddlArancel,g):((a.ddlArancel.swidget().selectedItem())?a.ddlArancel.swidget().selectedItem().idArancel:null));f.UsarFirmaDigital=a.chkUsarFirmaDigital.swidget().checked()?1:0;if(Core.Objects.Context.Configuration.idAplicacion==3){if(d.idTipoValidacion>=10){f.idNivelDeRiesgo=Core.Functions.Validations.getValidatedDropDownValue(a.ddlNivelRiesgo,g)}else{f.idNivelDeRiesgo=((a.ddlNivelRiesgo.swidget().selectedItem())?a.ddlNivelRiesgo.swidget().selectedItem().idRiesgo:null)}}else{f.idNivelDeRiesgo=(a.dataCuenta)?a.dataCuenta.datos[0].idNivelDeRiesgo:null}if(a.dataCuenta!=null){f.idEstadoAperturaCuenta=d?d.idEstadoAperturaCuenta:0;if(!d){Core.Functions.Validations.toggleValidation(a.ddlEstado,true);g.value=false}else{Core.Functions.Validations.toggleValidation(a.ddlEstado,false)}f.idAperturaCuenta=a.dataCuenta.datos[0].idAperturaCuenta;f.version=a.dataCuenta.datos[0].version;f.hash=a.dataCuenta.datos[0].hash;f.AceptoTyC=a.dataCuenta.datos[0].AceptoTyC;f.idPaso=a.dataCuenta.datos[0].idPaso;f.idSubPaso=a.dataCuenta.datos[0].idSubPaso;f.nombreOriginal=a.dataCuenta.datos[0].nombreOriginal;f.emailOriginal=a.dataCuenta.datos[0].emailOriginal;f.idCuentaExistente=a.dataCuenta.datos[0].idCuentaExistente;f.idExterno=a.dataCuenta.datos[0].idExterno;f.AceptoMandatoDiscrecional=a.dataCuenta.datos[0].AceptoMandatoDiscrecional;f.SolicitarMandatoDiscrecional=a.dataCuenta.datos[0].SolicitarMandatoDiscrecional}if(!f.tipoInversionAcciones&&!f.tipoInversionTitulosPublicos&&!f.tipoInversionFideicomisos&&!f.tipoInversionOpciones&&!f.tipoInversionFondos&&!f.tipoInversionOtros&&!f.tipoInversionChequePagoDiferido&&!f.tipoInversionFuturos&&!f.tipoInversionObligacionesNegociables&&!f.tipoInversionOperacionesCambioUSD){g.value=false;a.divAlert.text("Debe seleccionar el tipo de inversión.");a.divAlert.slideDown()}if(a.chkIngresoAsesorFinanciero.swidget().checked()&&(!a.txtIngresoAsesorFinanciero.val()||!a.isValidEmailAddress(a.txtIngresoAsesorFinanciero.val()))){g.value=false;a.divAlert.text("Debe ingresar el email del contacto.");a.divAlert.slideDown()}else{f.contactoOriginal=a.chkIngresoAsesorFinanciero.swidget().checked()?a.txtIngresoAsesorFinanciero.val():""}if(!a.chkCuentasComitente.swidget().checked()&&!a.chkCuentasCuotapartista.swidget().checked()){g.value=false;a.divAlert.text("Debe seleccionar el tipo de cuenta.");a.divAlert.slideDown()}else{f.cuentaComitente=a.chkCuentasComitente.swidget().checked()?1:0;f.cuentaCuotapartista=a.chkCuentasCuotapartista.swidget().checked()?1:0}var c=new Core.Controls.ManagerPersona({esCuentaJuridica:false,dataParametros:a.dataParametros});f.personas=a.personas;f.archivos=a.archivos;f.observaciones=a.observaciones;for(var e=0;e<a.personas.length;e++){if(!c.isValidPerson(a.personas[e],d.idTipoValidacion)){g.value=false;a.divAlert.text("Revise los datos de la persona: "+((a.personas[e].tipo==Core.Business.eTipoPersonaCuenta.Titular)?"Titular":"Autorizado")+" "+a.personas[e].numero+".");a.divAlert.slideDown()}}if(g.value){return f}else{null}};a.getOrigenPatrimonioOtro=function(c){if(!a.chkOrigenPatrimonioOtro.swidget().checked()){return""}else{if(a.txtOrigenPatrimonioOtroDetalle.swidget().value()!=""){return a.txtOrigenPatrimonioOtroDetalle.swidget().value()}else{if(!c){return""}else{c.value=false;a.divAlert.text("Debe ingresar el detalle del origen del patrimonio.");a.divAlert.slideDown();return""}}}};a.getSelectedTipoFirma=function(c){if(a.chkTipoFirmaConjunta.swidget().checked()){return Core.Business.eTipoFirma.Conjunta}else{if(a.chkTipoFirmaIndistinta.swidget().checked()){return Core.Business.eTipoFirma.Indistinta}else{if(!c){return Core.Business.eTipoFirma.Indistinta}else{c.value=false;a.divAlert.text("Debe seleccionar el tipo de firma.");a.divAlert.slideDown();return Core.Business.eTipoFirma.Indistinta}}}};a.getTipoInversionOtro=function(c){if(!a.chkTipoInversionOtro.swidget().checked()){return""}else{if(a.txtTipoInversionOtroDetalle.swidget().value()!=""){return a.txtTipoInversionOtroDetalle.swidget().value()}else{if(!c){return""}else{c.value=false;a.divAlert.text("Debe ingresar el detalle del tipo de inversión.");a.divAlert.slideDown();return""}}}};a.getSelectedCanal=function(f){var d=$(".chk-canal-option");for(var e=0;e<d.length;e++){var c=$(d[e]);if(c.swidget().checked()){return c.attr("idCanalDeVenta")}}if(!f){return Core.Business.eCanal.None}else{f.value=false;a.divAlert.text("Debe seleccionar el canal.");a.divAlert.slideDown();return Core.Business.eCanal.None}};a.getCanalOtro=function(c){if(a.txtCanalOtroDetalle.swidget().value()!=""){return a.txtCanalOtroDetalle.swidget().value()}else{if(!c){return""}else{c.value=false;a.divAlert.text("Debe ingresar el detalle del canal.");a.divAlert.slideDown();return""}}};a.getSelectedMontoAInvertir=function(f){var d=$(".monto-a-invertir-option");for(var e=0;e<d.length;e++){var c=$(d[e]);if(c.swidget().checked()){return c.attr("idMontoAInvertir")}}if(a.namespaceActivo=="Legajos"&&a.dataCuenta!=null){return a.dataCuenta.datos[0].montoAInvertir}if(!f){return Core.Business.eAmountRange.Hasta200}else{f.value=false;a.divAlert.text("Debe seleccionar el monto a invertir");a.divAlert.slideDown();return Core.Business.eAmountRange.Hasta200}};a.getSelectedIngresosAnuales=function(f){var d=$(".ingresos-anuales-option");for(var e=0;e<d.length;e++){var c=$(d[e]);if(c.swidget().checked()){return c.attr("idIngresosAnuales")}}if(a.namespaceActivo=="Legajos"&&a.dataCuenta!=null){return a.dataCuenta.datos[0].ingresosAnuales}if(!f){return Core.Business.eAmountRange.Hasta200}else{f.value=false;a.divAlert.text("Debe seleccionarlos ingresos anuales");a.divAlert.slideDown();return Core.Business.eAmountRange.Hasta200}};a.getSelectedPatrimonioNeto=function(f){var d=$(".patrimonio-neto-option");for(var e=0;e<d.length;e++){var c=$(d[e]);if(c.swidget().checked()){return c.attr("idPatromonioNeto")}}if(a.namespaceActivo=="Legajos"&&a.dataCuenta!=null){return a.dataCuenta.datos[0].patrimonioNeto}if(!f){return Core.Business.eAmountRange.Entre200Y700}else{f.value=false;a.divAlert.text("Debe seleccionar el patrimonio neto");a.divAlert.slideDown();return Core.Business.eAmountRange.Entre200Y700}};a.getMaxNumero=function(f){var c=$.grep(a.personas,function(h,g){return h.tipo==f});var e=0;for(var d=0;d<c.length;d++){if(c[d].numero>e){e=c[d].numero}}return e};a.refreshNumeroPersonas=function(){var e=0;var c=0;for(var d=0;d<a.personas.length;d++){if(a.personas[d].tipo==Core.Business.eTipoPersonaCuenta.Titular){e++;a.personas[d].numero=e}else{c++;a.personas[d].numero=c}}};a.refreshPersonas=function(){var c=a.gridPersonas.swidget().initialOptions;c.dataSource.data=a.personas;a.gridPersonas.swidget().refresh(c)};a.setControls=function(){a.divOrigenPatrimonioOtroDetalle.hide();if(a.chkOrigenPatrimonioOtro.swidget().checked()){a.divOrigenPatrimonioOtroDetalle.show()}a.divCanalOtroDetalle.hide();if(a.getSelectedCanal()==Core.Business.eCanal.Otro){a.divCanalOtroDetalle.show()}a.divTipoInversionOtroDetalle.hide();if(a.chkTipoInversionOtro.swidget().checked()){a.divTipoInversionOtroDetalle.show()}a.divIngresoAsesorFinanciero.hide();if(a.chkIngresoAsesorFinanciero.swidget().checked()){a.divIngresoAsesorFinanciero.show()}};a.isAperturaWeb=function(){var c=$.grep(a.personas,function(e,d){return e.tipo==Core.Business.eTipoPersonaCuenta.Titular&&e.numero==1})[0];return(c&&((c.idArchivoDNIDorso&&c.idArchivoDNIDorso>0)||(c.idArchivoDNIFrente&&c.idArchivoDNIFrente>0)||(c.idArchivoFoto&&c.idArchivoFoto>0)))};a.isValidEmailAddress=function(c){if(!c){return false}else{var d=/^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i;if(!d.test(c)){return false}return true}};a.destroy=function(c){a.ddlVersion.swidget().destroy();a.ddlEstado.swidget().destroy();a.ddlAsesor.swidget().destroy();a.chkUsarFirmaDigital.swidget().destroy();a.chkIngresoAsesorFinanciero.swidget().destroy();a.txtIngresoAsesorFinanciero.swidget().destroy();a.chkCuentasComitente.swidget().destroy();a.chkCuentasCuotapartista.swidget().destroy();a.chkOrigenPatrimonioActividadPrincipal.swidget().destroy();a.chkOrigenPatrimonioVentaBienes.swidget().destroy();a.chkOrigenPatrimonioHerencia.swidget().destroy();a.chkOrigenPatrimonioOtro.swidget().destroy();a.txtOrigenPatrimonioOtroDetalle.swidget().destroy();a.chkConvenioComitenteAAGI.swidget().destroy();a.txtCanalOtroDetalle.swidget().destroy();a.ddlArancel.swidget().destroy();a.ddlNivelRiesgo.swidget().destroy();a.txtComoLlegoABalanz.swidget().destroy();a.txtUsuarioAsignado.swidget().destroy();a.chkTipoInversionAcciones.swidget().destroy();a.chkTipoInversionTitulosPublicos.swidget().destroy();a.chkTipoInversionFideicomisos.swidget().destroy();a.chkTipoInversionFondos.swidget().destroy();a.chkTipoInversionOpciones.swidget().destroy();a.chkTipoInversionOperacionesCambioUSD.swidget().destroy();a.chkTipoInversionFuturos.swidget().destroy();a.chkTipoInversionObligacionesNegociables.swidget().destroy();a.chkTipoInversionChequePagoDiferido.swidget().destroy();a.chkTipoInversionOtro.swidget().destroy();a.txtTipoInversionOtroDetalle.swidget().destroy();a.txtPlazoInversion.swidget().destroy();a.txtDescripcionActividadCliente.swidget().destroy();a.gridPersonas.swidget().destroy();a.gridArchivos.swidget().destroy();a.gridObservaciones.swidget().destroy();a.divManagerAltaCuenta.html("");if(c){a.onClose()}}};Core.Business.eAmountRange={None:0,Hasta200:1,Entre200Y700:2,MasDe700:3,MasDe200:4};Core.Business.eTipoIdentificacionFiscal={None:0,CUIT:1,CUIL:2,CIE:3,CDI:4};Core.Business.eGenero={Femenino:0,Masculino:1};Core.Business.eEstadoCivil={None:0,Soltero:1,Casado:2,Divorciado:3,Separado:4,Viudo:5};Core.Business.eCanal={None:0,Web:1,PorFuncionarios:2,PorEmpleados:3,PorGestionComercial:4,Otro:5};Core.Business.eTipoFirma={None:0,Indistinta:1,Conjunta:2};Core.Business.eCaracterInvocado={None:0,Titular:1,Apoderado:2,Representante:3,Autorizado:4};Core.Business.eTipoDocumento={DNI:1,CI:2,LE:3,LC:4,PAS:5,Extranjero:6};Core.Business.eActividadPrincipalJuridica={Otro:21};Core.Business.eCondicionIVA={ConsumidorFinal:1,Exento:2,NoResponsable:3,ResponsableInscripto:4,ResponsableMonotributo:5,ResponsableInscriptoBanco:7,NoCategorizado:8};Core.Business.eNacionalidad={Argentina:1};Core.Business.eProvincia={BsAs:1,CABA:2};Core.Business.eTipoRegistracion={IGJ:2,DPJ:3,Extranjero:8};Core.Controls.ManagerAltaCuentaJuridica=function(b){var a=this;a.decimalCount=2;a.phoneCodeAr=$.grep(Core.Objects.Contry,function(d,c){return d.iso_code=="AR"})[0].phone_code;a.idPais_Argentina=1;a.id="homeAltaCuenta";a.idDefaultProfile=null;a.idDefaultAccount=null;a.divInformes=null;a.divReadOnly=null;a.divVersion=null;a.ddlVersion=null;a.divAltaCuenta=null;a.divManagerPersona=null;a.divMatrizRiesgo=null;a.divAsesor=null;a.ddlAsesor=null;a.divContainerEstado=null;a.divDescripcionEstado=null;a.lblEstado=null;a.ddlEstado=null;a.divTipoFirma=null;a.chkTipoFirmaConjunta=null;a.chkTipoFirmaIndistinta=null;a.divIngresoAsesorFinanciero=null;a.txtIngresoAsesorFinanciero=null;a.chkIngresoAsesorFinanciero=null;a.divCuentas=null;a.chkCuentasComitente=null;a.chkCuentasCuotapartista=null;a.txtUsuarioAsignado=null;a.divMontoInvertir=null;a.divMontoInvertirContainer=null;a.lblMontoInvertirAlert=null;a.divOrigenPatrimonio=null;a.chkOrigenPatrimonioActividadPrincipal=null;a.chkOrigenPatrimonioVentaBienes=null;a.chkOrigenPatrimonioOtro=null;a.divOrigenPatrimonioOtroDetalle=null;a.txtOrigenPatrimonioOtroDetalle=null;a.divConvenioComitenteAAGI=null;a.chkConvenioComitenteAAGI=null;a.divCanal=null;a.divCanalContainer=null;a.divCanalOtroDetalle=null;a.txtCanalOtroDetalle=null;a.divArancel=null;a.ddlArancel=null;a.divComoLlegoABalanz=null;a.txtComoLlegoABalanz=null;a.divTipoInversion=null;a.chkTipoInversionAcciones=null;a.chkTipoInversionTitulosPublicos=null;a.chkTipoInversionFideicomisos=null;a.chkTipoInversionOpciones=null;a.chkTipoInversionFondos=null;a.chkTipoInversionOperacionesCambioUSD=null;a.chkTipoInversionObligacionesNegociables=null;a.chkTipoInversionFuturos=null;a.chkTipoInversionChequePagoDiferido=null;a.chkTipoInversionOtro=null;a.divTipoInversionOtroDetalle=null;a.txtTipoInversionOtroDetalle=null;a.divPlazoInversion=null;a.txtPlazoInversion=null;a.divDescripcionActividadCliente=null;a.txtDescripcionActividadCliente=null;a.ddlPaisTipoIdentificacionFiscal=null;a.ddlTipoIdentificacionFiscal=null;a.txtIdentificacionFiscal=null;a.txtRazonSocial=null;a.ddlNacionalidad=null;a.ddlLugarConstitucion=null;a.ddlTipoRegistracionJuridica=null;a.ddlTipoPersonaJuridica=null;a.txtNumeroInscripcion=null;a.txtFechaConstitucion=null;a.txtTomo=null;a.txtLibro=null;a.divActividadPrincipalCampoAdicional1=null;a.ddlActividadPrincipal=null;a.divActividadPrincipalOtro=null;a.txtActividadPrincipalOtro=null;a.txtSegmentoInversion=null;a.txtNumeroAseguradora=null;a.ddlCondicionIva=null;a.ddlInscripcionGanancias=null;a.txtDomicilioLegalCalle=null;a.txtDomicilioLegalNumero=null;a.txtDomicilioLegalPiso=null;a.txtDomicilioLegalDepartamento=null;a.ddlDomicilioLegalPais=null;a.ddlDomicilioLegalProvincia=null;a.txtDomicilioLegalLocalidad=null;a.txtDomicilioLegalCodigoPostal=null;a.ddlEmailNotificacionesCantidad=null;a.txtEmailNotificaciones1=null;a.divEmailNotificaciones1=null;a.txtEmailNotificaciones2=null;a.divEmailNotificaciones2=null;a.txtEmailNotificaciones3=null;a.divEmailNotificaciones3=null;a.txtEmailNotificaciones4=null;a.divEmailNotificaciones4=null;a.txtTelefonoParticularArea=null;a.txtTelefonoParticularNumero=null;a.divTelefonoCelularPais=null;a.divTelefonoCelularArea=null;a.divTelefonoCelularNumero=null;a.ddlTelefonoCelularPais=null;a.txtTelefonoCelularArea=null;a.txtTelefonoCelularNumero=null;a.txtTributaNit1=null;a.txtTributaNit2=null;a.txtTributaNit3=null;a.ddlTributaPais1=null;a.ddlTributaPais2=null;a.ddlTributaPais3=null;a.ddlTributaTipoIdentificadorFiscal1=null;a.ddlTributaTipoIdentificadorFiscal2=null;a.ddlTributaTipoIdentificadorFiscal3=null;a.ddlCantidadResidenciasFiscales=null;a.divResidenciaFiscal1=null;a.divResidenciaFiscal2=null;a.divResidenciaFiscal3=null;a.chkPoseeBeneficiariosEstadounidenses=null;a.divPoseeBeneficiariosEstadounidenses=null;a.divBeneficiariosEstadounidensesCantidad=null;a.ddlBeneficiariosEstadounidensesCantidad=null;a.divBeneficiarioEstadounidense1=null;a.divBeneficiarioEstadounidense2=null;a.divBeneficiarioEstadounidense3=null;a.divBeneficiarioEstadounidense4=null;a.divBeneficiarioEstadounidense5=null;a.divBeneficiarioEstadounidense6=null;a.txtBeneficiarioEstadounidenseNombre1=null;a.txtBeneficiarioEstadounidenseNombre2=null;a.txtBeneficiarioEstadounidenseNombre3=null;a.txtBeneficiarioEstadounidenseNombre4=null;a.txtBeneficiarioEstadounidenseNombre5=null;a.txtBeneficiarioEstadounidenseNombre6=null;a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU1=null;a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU2=null;a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU3=null;a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU4=null;a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU5=null;a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU6=null;a.txtBeneficiarioEstadounidensePorcentajeParticipacion1=null;a.txtBeneficiarioEstadounidensePorcentajeParticipacion2=null;a.txtBeneficiarioEstadounidensePorcentajeParticipacion3=null;a.txtBeneficiarioEstadounidensePorcentajeParticipacion4=null;a.txtBeneficiarioEstadounidensePorcentajeParticipacion5=null;a.txtBeneficiarioEstadounidensePorcentajeParticipacion6=null;a.ddlTipoInstitucionFinancieraExtranjera=null;a.txtInstitucionFinancieraExtranjeraGIIN=null;a.ddlTipoReporteDirectoIRS=null;a.txtReporteDirectoIRSGIIN=null;a.ddlTipoPersonaJuridicaExenta=null;a.txtPersonaEstadounidenseTIN=null;a.divCiudadaniaEEUUCampoAdicional1=null;a.divCiudadaniaEEUUCampoAdicional2=null;a.divCiudadaniaEEUUCampoAdicional3=null;a.divCiudadaniaEEUUCampoAdicional4=null;a.divCiudadaniaEEUUCampoAdicional5=null;a.ddlCiudadaniaEEUU=null;a.divCiudadaniaEEUUDeclaracionJurada=null;a.chkCiudadaniaEEUUDeclaracionJurada=null;a.ddlTipoOcde=null;a.divTipoOcdeDeclaracionJurada=null;a.chkTipoOcdeDeclaracionJurada=null;a.chkSujetoObligado=null;a.divMontoCompliance=null;a.controlMontoCompliance=null;a.txtMontoCompliance=null;a.ddlRiesgoCliente=null;a.btnGuardarYCerrar=null;a.btnFormularioVacio=null;a.btnVolver=null;a.btnNuevaPersona=null;a.gridPersonas=null;a.btnAgregarArchivo=null;a.gridArchivos=null;a.divContainerObservaciones=null;a.gridObservaciones=null;a.btnAgregarObservacion=null;a.divCalcularMatrizRiesgo=null;a.btnCalcularMatrizRiesgo=null;a.btnConsultarMatrizRiesgo=null;a.divAlert=null;a.detalleDisponible=null;a.dataCuenta=null;a.dataParametros=null;a.dataParametrosUsuario=null;a.personas=[];a.archivos=[];a.observaciones=[];a.idAperturaCuenta=null;a.aperturaCuenta=null;a.versionActual=null;a.optionsApertura=null;a.readOnly=null;a.pageOptions=null;a.namespaceActivo="";a.onClose=function(){};a.onSave=function(c,d){};a.show=function(){a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu("matrizDeRiesgo",Core.Objects.Context.Profiles[0]);a.idAperturaCuenta=0;a.versionActual=0;a.maxVersion=0;a.optionsApertura=null;a.readOnly=false;a.aperturaCuenta=null;a.namespaceActivo="";a.dataParametros=null;a.dataParametrosUsuario=null;a.dataCuenta=null;$.extend(true,a,b);a.divAltaCuenta=a.container.find(".div-alta-cuenta");a.divManagerPersona=a.container.find(".div-manager-titular-autorizado");a.divMatrizRiesgo=a.container.find(".div-container-matriz-riesgo");a.divManagerAltaCuenta=a.container.find(".div-manager-alta-cuenta");a.divManagerAltaCuenta.html("");a.divManagerAltaCuenta.load("/Pages/manager-cuenta-juridica.html",function(c,d,e){if(d=="success"){a.divAltaCuenta.show();a.divManagerPersona.hide();a.divMatrizRiesgo.hide();$("html, body").animate({scrollTop:$(".cuenta").offset().top},1000);a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu(a.id,Core.Objects.Context.Profiles[a.idDefaultProfile]);a.titlePage=a.divManagerAltaCuenta.find(".title-page");a.titlePage.text((a.idAperturaCuenta)?("Cuenta: "+a.idAperturaCuenta):"Alta Cuenta");a.divDescripcionCuenta=a.divManagerAltaCuenta.find(".div-descripcion-cuenta");a.lblDescripcionCuenta=a.divManagerAltaCuenta.find(".lbl-descripcion-cuenta");a.divComitenteCuotapartistaCuenta=a.divManagerAltaCuenta.find(".div-comitente-coutapartista-cuenta");a.lblComitenteCuotapartistaCuenta=a.divManagerAltaCuenta.find(".lbl-comitente-coutapartista-cuenta");a.divDescripcionCuenta.hide();a.divComitenteCuotapartistaCuenta.hide();a.divContainerEstado=a.divManagerAltaCuenta.find(".div-container-estado");a.ddlEstado=a.divManagerAltaCuenta.find(".dropdown-estado");a.lblEstadoCuenta=a.divManagerAltaCuenta.find(".lbl-estado-cuenta");a.divDescripcionEstado=a.divManagerAltaCuenta.find(".div-descripcion-estado");a.divReadOnly=a.divManagerAltaCuenta.find(".div-read-only");a.divInformes=a.divManagerAltaCuenta.find(".div-cuenta-informes");a.divVersion=a.divManagerAltaCuenta.find(".div-version");a.ddlVersion=a.divManagerAltaCuenta.find(".dropdown-version");a.divAsesor=a.divManagerAltaCuenta.find(".div-asesor");a.ddlAsesor=a.divManagerAltaCuenta.find(".dropdown-asesor");a.divUsarFirmaDigital=a.divManagerAltaCuenta.find(".div-usar-firma-digital");a.chkUsarFirmaDigital=a.divManagerAltaCuenta.find(".checkbox-usar-firma-digital");a.divDescripcionEstado=a.divManagerAltaCuenta.find(".div-descripcion-estado");a.divTipoFirma=a.divManagerAltaCuenta.find(".div-tipo-firma");a.chkTipoFirmaConjunta=a.divManagerAltaCuenta.find(".chk-tipo-firma-conjunta");a.chkTipoFirmaIndistinta=a.divManagerAltaCuenta.find(".chk-tipo-firma-indistinta");a.chkIngresoAsesorFinanciero=a.divManagerAltaCuenta.find(".checkbox-ingreso-asesor-financiero");a.txtIngresoAsesorFinanciero=a.divManagerAltaCuenta.find(".textbox-ingreso-asesor-financiero");a.divIngresoAsesorFinanciero=a.divManagerAltaCuenta.find(".div-ingreso-asesor-financiero");a.divCuentas=a.divManagerAltaCuenta.find(".div-cuentas");a.chkCuentasComitente=a.divManagerAltaCuenta.find(".chk-cuentas-comitente");a.chkCuentasCuotapartista=a.divManagerAltaCuenta.find(".chk-cuentas-cuotapartista");a.divMontoInvertir=a.divManagerAltaCuenta.find(".div-monto-invertir");a.divMontoInvertirContainer=a.divManagerAltaCuenta.find(".div-monto-invertir-container");a.lblMontoInvertirAlert=a.divManagerAltaCuenta.find(".lbl-monto-invertir-alert");a.lblMontoInvertirAlert.html("");a.divOrigenPatrimonio=a.divManagerAltaCuenta.find(".div-origen-patrimonio");a.chkOrigenPatrimonioActividadPrincipal=a.divManagerAltaCuenta.find(".chk-origen-patrimonio-actividad-principal");a.chkOrigenPatrimonioVentaBienes=a.divManagerAltaCuenta.find(".chk-origen-patrimonio-venta-bienes");a.chkOrigenPatrimonioOtro=a.divManagerAltaCuenta.find(".chk-origen-patrimonio-otro");a.divOrigenPatrimonioOtroDetalle=a.divManagerAltaCuenta.find(".div-otro-patrimonio-detalle");a.txtOrigenPatrimonioOtroDetalle=a.divManagerAltaCuenta.find(".textbox-otro-patrimonio-detalle");a.divConvenioComitenteAAGI=a.divManagerAltaCuenta.find(".div-convenio-comitente-aagi");a.chkConvenioComitenteAAGI=a.divManagerAltaCuenta.find(".checkbox-convenio-comitente-aagi");a.divCanal=a.divManagerAltaCuenta.find(".div-canal");a.divCanalContainer=a.divManagerAltaCuenta.find(".div-canal-container");a.divCanalOtroDetalle=a.divManagerAltaCuenta.find(".div-canal-otro-detalle");a.txtCanalOtroDetalle=a.divManagerAltaCuenta.find(".textbox-canal-otro-detalle");a.divArancel=a.divManagerAltaCuenta.find(".div-arancel");a.ddlArancel=a.divManagerAltaCuenta.find(".dropdown-arancel");a.divComoLlegoABalanz=a.divManagerAltaCuenta.find(".div-como-llego-a-balanz");a.txtComoLlegoABalanz=a.divManagerAltaCuenta.find(".textbox-como-llego-a-balanz");a.txtUsuarioAsignado=a.divManagerAltaCuenta.find(".textbox-usuario-asignado");a.divTipoInversion=a.divManagerAltaCuenta.find(".div-tipo-inversion");a.chkTipoInversionAcciones=a.divManagerAltaCuenta.find(".chk-tipo-inversion-acciones");a.chkTipoInversionTitulosPublicos=a.divManagerAltaCuenta.find(".chk-tipo-inversion-titulos-publicos");a.chkTipoInversionFideicomisos=a.divManagerAltaCuenta.find(".chk-tipo-inversion-fideicomisos");a.chkTipoInversionOpciones=a.divManagerAltaCuenta.find(".chk-tipo-inversion-opciones");a.chkTipoInversionFondos=a.divManagerAltaCuenta.find(".chk-tipo-inversion-fondos");a.chkTipoInversionOperacionesCambioUSD=a.divManagerAltaCuenta.find(".chk-tipo-inversion-operaciones-cambio-usd");a.chkTipoInversionObligacionesNegociables=a.divManagerAltaCuenta.find(".chk-tipo-inversion-obligaciones-negociables");a.chkTipoInversionFuturos=a.divManagerAltaCuenta.find(".chk-tipo-inversion-futuros");a.chkTipoInversionChequePagoDiferido=a.divManagerAltaCuenta.find(".chk-tipo-inversion-cheque-pago-diferido");a.chkTipoInversionOtro=a.divManagerAltaCuenta.find(".chk-tipo-inversion-otro");a.divTipoInversionOtroDetalle=a.divManagerAltaCuenta.find(".div-tipo-inversion-otro-detalle");a.txtTipoInversionOtroDetalle=a.divManagerAltaCuenta.find(".textbox-tipo-inversion-otro-detalle");a.divPlazoInversion=a.divManagerAltaCuenta.find(".div-plazo-inversion");a.txtPlazoInversion=a.divManagerAltaCuenta.find(".textbox-plazo-inversion");a.divDescripcionActividadCliente=a.divManagerAltaCuenta.find(".div-descripcion-actividad-cliente");a.txtDescripcionActividadCliente=a.divManagerAltaCuenta.find(".textbox-descripcion-actividad-cliente");a.ddlPaisTipoIdentificacionFiscal=a.divManagerAltaCuenta.find(".dropdown-pais-tipo-identificacion-fiscal");a.ddlTipoIdentificacionFiscal=a.divManagerAltaCuenta.find(".dropdown-tipo-identificacion-fiscal");a.txtIdentificacionFiscal=a.divManagerAltaCuenta.find(".textbox-identificacion-fiscal");a.txtRazonSocial=a.divManagerAltaCuenta.find(".textbox-razon-social");a.ddlNacionalidad=a.divManagerAltaCuenta.find(".dropdown-nacionalidad");a.ddlLugarConstitucion=a.divManagerAltaCuenta.find(".dropdown-lugar-constitucion");a.ddlTipoPersonaJuridica=a.divManagerAltaCuenta.find(".dropdown-tipo-persona-juridica");a.ddlTipoRegistracionJuridica=a.divManagerAltaCuenta.find(".dropdown-tipo-registracion-juridica");a.txtNumeroInscripcion=a.divManagerAltaCuenta.find(".textbox-numero-inscripcion");a.txtFechaConstitucion=a.divManagerAltaCuenta.find(".date-picker-fecha-constitucion");a.txtTomo=a.divManagerAltaCuenta.find(".textbox-tomo");a.txtLibro=a.divManagerAltaCuenta.find(".textbox-libro");a.divActividadPrincipalCampoAdicional1=a.divManagerAltaCuenta.find(".div-actividad-principal-campo-adicional-1");a.ddlActividadPrincipal=a.divManagerAltaCuenta.find(".dropdown-actividad-principal");a.divActividadPrincipalOtro=a.divManagerAltaCuenta.find(".div-actividad-principal-otro");a.txtActividadPrincipalOtro=a.divManagerAltaCuenta.find(".textbox-actividad-principal-otro");a.txtSegmentoInversion=a.divManagerAltaCuenta.find(".textbox-segmento-inversion");a.txtNumeroAseguradora=a.divManagerAltaCuenta.find(".textbox-numero-aseguradora");a.ddlCondicionIva=a.divManagerAltaCuenta.find(".dropdown-condicion-iva");a.ddlInscripcionGanancias=a.divManagerAltaCuenta.find(".dropdown-inscripcion-ganancias");a.txtDomicilioLegalCalle=a.divManagerAltaCuenta.find(".textbox-domicilio-legal-calle");a.txtDomicilioLegalNumero=a.divManagerAltaCuenta.find(".textbox-domicilio-legal-numero");a.txtDomicilioLegalPiso=a.divManagerAltaCuenta.find(".textbox-domicilio-legal-piso");a.txtDomicilioLegalDepartamento=a.divManagerAltaCuenta.find(".textbox-domicilio-legal-departamento");a.ddlDomicilioLegalPais=a.divManagerAltaCuenta.find(".dropdown-domicilio-legal-pais");a.ddlDomicilioLegalProvincia=a.divManagerAltaCuenta.find(".dropdown-domicilio-legal-provincia");a.txtDomicilioLegalLocalidad=a.divManagerAltaCuenta.find(".textbox-domicilio-legal-localidad");a.txtDomicilioLegalCodigoPostal=a.divManagerAltaCuenta.find(".textbox-domicilio-legal-codigo-postal");a.ddlEmailNotificacionesCantidad=a.divManagerAltaCuenta.find(".dropdown-email-notificaciones-cantidad");a.txtEmailNotificaciones1=a.divManagerAltaCuenta.find(".textbox-email-notificaciones-1");a.divEmailNotificaciones1=a.divManagerAltaCuenta.find(".div-email-notificaciones-1");a.txtEmailNotificaciones2=a.divManagerAltaCuenta.find(".textbox-email-notificaciones-2");a.divEmailNotificaciones2=a.divManagerAltaCuenta.find(".div-email-notificaciones-2");a.txtEmailNotificaciones3=a.divManagerAltaCuenta.find(".textbox-email-notificaciones-3");a.divEmailNotificaciones3=a.divManagerAltaCuenta.find(".div-email-notificaciones-3");a.txtEmailNotificaciones4=a.divManagerAltaCuenta.find(".textbox-email-notificaciones-4");a.divEmailNotificaciones4=a.divManagerAltaCuenta.find(".div-email-notificaciones-4");a.txtTelefonoParticularArea=a.divManagerAltaCuenta.find(".textbox-telefono-particular-area");a.txtTelefonoParticularNumero=a.divManagerAltaCuenta.find(".textbox-telefono-particular-numero");a.divTelefonoCelularPais=a.divManagerAltaCuenta.find(".div-telefono-celular-pais");a.divTelefonoCelularArea=a.divManagerAltaCuenta.find(".div-telefono-celular-area");a.divTelefonoCelularNumero=a.divManagerAltaCuenta.find(".div-telefono-celular-numero");a.ddlTelefonoCelularPais=a.divManagerAltaCuenta.find(".dropdown-telefono-celular-pais");a.txtTelefonoCelularArea=a.divManagerAltaCuenta.find(".textbox-telefono-celular-area");a.txtTelefonoCelularNumero=a.divManagerAltaCuenta.find(".textbox-telefono-celular-numero");a.txtTributaNit1=a.divManagerAltaCuenta.find(".textbox-tributa-nit-1");a.txtTributaNit2=a.divManagerAltaCuenta.find(".textbox-tributa-nit-2");a.txtTributaNit3=a.divManagerAltaCuenta.find(".textbox-tributa-nit-3");a.ddlTributaPais1=a.divManagerAltaCuenta.find(".dropdown-tributa-pais-1");a.ddlTributaPais2=a.divManagerAltaCuenta.find(".dropdown-tributa-pais-2");a.ddlTributaPais3=a.divManagerAltaCuenta.find(".dropdown-tributa-pais-3");a.ddlTributaTipoIdentificadorFiscal1=a.divManagerAltaCuenta.find(".dropdown-tributa-tipo-identificacion-fiscal-1");a.ddlTributaTipoIdentificadorFiscal2=a.divManagerAltaCuenta.find(".dropdown-tributa-tipo-identificacion-fiscal-2");a.ddlTributaTipoIdentificadorFiscal3=a.divManagerAltaCuenta.find(".dropdown-tributa-tipo-identificacion-fiscal-3");a.ddlCantidadResidenciasFiscales=a.divManagerAltaCuenta.find(".dropdown-cantidad-residencias-fiscales");a.divResidenciaFiscal1=a.divManagerAltaCuenta.find(".div-residencia-fiscal-1");a.divResidenciaFiscal2=a.divManagerAltaCuenta.find(".div-residencia-fiscal-2");a.divResidenciaFiscal3=a.divManagerAltaCuenta.find(".div-residencia-fiscal-3");a.chkPoseeBeneficiariosEstadounidenses=a.divManagerAltaCuenta.find(".checkbox-beneficiarios-estadounidenses");a.ddlBeneficiariosEstadounidensesCantidad=a.divManagerAltaCuenta.find(".dropdown-cantidad-beneficiarios-estadounidenses");a.divPoseeBeneficiariosEstadounidenses=a.divManagerAltaCuenta.find(".div-posee-beneficiarios-estadounidenses");a.divBeneficiariosEstadounidensesCantidad=a.divManagerAltaCuenta.find(".div-cantidad-beneficiarios-estadounidenses");a.divBeneficiarioEstadounidense1=a.divManagerAltaCuenta.find(".div-beneficiario-estadounidense-1");a.divBeneficiarioEstadounidense2=a.divManagerAltaCuenta.find(".div-beneficiario-estadounidense-2");a.divBeneficiarioEstadounidense3=a.divManagerAltaCuenta.find(".div-beneficiario-estadounidense-3");a.divBeneficiarioEstadounidense4=a.divManagerAltaCuenta.find(".div-beneficiario-estadounidense-4");a.divBeneficiarioEstadounidense5=a.divManagerAltaCuenta.find(".div-beneficiario-estadounidense-5");a.divBeneficiarioEstadounidense6=a.divManagerAltaCuenta.find(".div-beneficiario-estadounidense-6");a.txtBeneficiarioEstadounidenseNombre1=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-nombre-1");a.txtBeneficiarioEstadounidenseNombre2=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-nombre-2");a.txtBeneficiarioEstadounidenseNombre3=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-nombre-3");a.txtBeneficiarioEstadounidenseNombre4=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-nombre-4");a.txtBeneficiarioEstadounidenseNombre5=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-nombre-5");a.txtBeneficiarioEstadounidenseNombre6=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-nombre-6");a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU1=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-id-contribuyente-eeuu-1");a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU2=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-id-contribuyente-eeuu-2");a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU3=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-id-contribuyente-eeuu-3");a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU4=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-id-contribuyente-eeuu-4");a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU5=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-id-contribuyente-eeuu-5");a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU6=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-id-contribuyente-eeuu-6");a.txtBeneficiarioEstadounidensePorcentajeParticipacion1=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-porcentaje-participacion-1");a.txtBeneficiarioEstadounidensePorcentajeParticipacion2=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-porcentaje-participacion-2");a.txtBeneficiarioEstadounidensePorcentajeParticipacion3=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-porcentaje-participacion-3");a.txtBeneficiarioEstadounidensePorcentajeParticipacion4=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-porcentaje-participacion-4");a.txtBeneficiarioEstadounidensePorcentajeParticipacion5=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-porcentaje-participacion-5");a.txtBeneficiarioEstadounidensePorcentajeParticipacion6=a.divManagerAltaCuenta.find(".textbox-beneficiario-estadounidense-porcentaje-participacion-6");a.ddlTipoInstitucionFinancieraExtranjera=a.divManagerAltaCuenta.find(".dropdown-tipo-institucion-financiera-extranjera");a.txtInstitucionFinancieraExtranjeraGIIN=a.divManagerAltaCuenta.find(".textbox-institucion-financiera-extranjera-giin");a.ddlTipoReporteDirectoIRS=a.divManagerAltaCuenta.find(".dropdown-tipo-reporte-directo-irs");a.txtReporteDirectoIRSGIIN=a.divManagerAltaCuenta.find(".textbox-reporte-directo-irs-giin");a.ddlTipoPersonaJuridicaExenta=a.divManagerAltaCuenta.find(".dropdown-tipo-persona-juridica-exenta");a.txtPersonaEstadounidenseTIN=a.divManagerAltaCuenta.find(".textbox-persona-estadounidense-tin");a.divCiudadaniaEEUUCampoAdicional1=a.divManagerAltaCuenta.find(".div-ciudadania-estadounidense-campo-adicional-1");a.divCiudadaniaEEUUCampoAdicional2=a.divManagerAltaCuenta.find(".div-ciudadania-estadounidense-campo-adicional-2");a.divCiudadaniaEEUUCampoAdicional3=a.divManagerAltaCuenta.find(".div-ciudadania-estadounidense-campo-adicional-3");a.divCiudadaniaEEUUCampoAdicional4=a.divManagerAltaCuenta.find(".div-ciudadania-estadounidense-campo-adicional-4");a.divCiudadaniaEEUUCampoAdicional5=a.divManagerAltaCuenta.find(".div-ciudadania-estadounidense-campo-adicional-5");a.ddlCiudadaniaEEUU=a.divManagerAltaCuenta.find(".dropdown-ciudadania-eeuu");a.divCiudadaniaEEUUDeclaracionJurada=a.divManagerAltaCuenta.find(".div-ciudadania-estadounidense-declaracion-jurada");a.chkCiudadaniaEEUUDeclaracionJurada=a.divManagerAltaCuenta.find(".checkbox-ciudadania-estadounidense-declaracion-jurada");a.ddlTipoOcde=a.divManagerAltaCuenta.find(".dropdown-tipo-ocde");a.divTipoOcdeDeclaracionJurada=a.divManagerAltaCuenta.find(".div-tipo-ocde-declaracion-jurada");a.chkTipoOcdeDeclaracionJurada=a.divManagerAltaCuenta.find(".checkbox-tipo-ocde-declaracion-jurada");a.chkSujetoObligado=a.divManagerAltaCuenta.find(".checkbox-sujeto-obligado");a.divMontoCompliance=a.container.find(".div-monto-compliance");a.txtMontoCompliance=a.container.find(".textbox-monto-compliance");a.controlMontoCompliance=null;a.ddlRiesgoCliente=a.container.find(".dropdown-riesgo-cliente");a.btnNuevaPersona=a.divManagerAltaCuenta.find(".btn-nueva-persona");a.btnAgregarArchivo=a.divManagerAltaCuenta.find(".btn-agregar-archivo");a.divContainerObservaciones=a.divManagerAltaCuenta.find(".div-container-observaciones");a.gridObservaciones=a.divManagerAltaCuenta.find(".div-observaciones");a.btnAgregarObservacion=a.divManagerAltaCuenta.find(".btn-agregar-observacion");a.btnGuardarYCerrar=a.divManagerAltaCuenta.find(".btn-guardar-cerrar");a.btnRefirmar=a.divManagerAltaCuenta.find(".btn-refirmar");a.btnAnularFirma=a.divManagerAltaCuenta.find(".btn-anular-firma");a.btnFormularioVacio=a.divManagerAltaCuenta.find(".btn-formulario-vacio");a.btnVolver=a.divManagerAltaCuenta.find(".btn-volver");a.gridPersonas=a.divManagerAltaCuenta.find(".div-personas");a.gridArchivos=a.divManagerAltaCuenta.find(".div-archivos");a.btnCalcularMatrizRiesgo=a.container.find(".btn-calcular-matriz-riesgo");a.btnConsultarMatrizRiesgo=a.container.find(".btn-consultar-matriz-riesgo");a.divCalcularMatrizRiesgo=a.container.find(".div-calcular-matriz-riesgo");a.divAlert=a.divManagerAltaCuenta.find(".div-alert");a.divAlert.slideUp();a.initControls()}})};a.initControls=function(){a.divReadOnly.hide();if(a.readOnly){a.divReadOnly.show();a.divVersion.show();if(a.namespaceActivo=="OpenManagerAltaCuenta"){a.divVersion.hide()}}a.divContainerEstado.show();a.divDescripcionEstado.show();a.divContainerObservaciones.show();a.divDescripcionEstado.show();if(!a.idAperturaCuenta){a.btnFormularioVacio.show();a.divContainerEstado.hide();a.divDescripcionEstado.hide();a.divContainerObservaciones.hide();a.divDescripcionEstado.hide()}else{a.btnFormularioVacio.hide()}a.btnAgregarArchivo.show();a.btnNuevaPersona.show();a.btnGuardarYCerrar.show();a.btnAgregarObservacion.show();if(a.readOnly){a.btnAgregarArchivo.hide();a.btnNuevaPersona.hide();a.btnGuardarYCerrar.hide();a.btnFormularioVacio.hide();a.btnAgregarObservacion.hide()}a.btnVolver.show();if(a.namespaceActivo=="OpenManagerAltaCuenta"){a.btnVolver.hide()}a.btnRefirmar.hide();if(!a.readOnly&&a.dataCuenta&&a.dataCuenta.datos[0].refirmar){a.btnRefirmar.show()}a.btnAnularFirma.hide();if(!a.readOnly&&a.dataCuenta&&a.dataCuenta.datos[0].anularFirma){a.btnAnularFirma.show()}a.divAltaCuenta.show();a.divManagerPersona.hide();a.divMatrizRiesgo.hide();a.ddlVersion.shieldDropDown({dataSource:{data:[]},valueTemplate:"{version}",textTemplate:"{version}",events:{select:function(f){var g=a.ddlVersion.swidget().selectedItem().version;a.destroy(false);var e=new Core.Controls.ManagerAltaCuenta({idAperturaCuenta:a.idAperturaCuenta,versionActual:g,optionsApertura:a.optionsApertura,readOnly:a.readOnly,maxVersion:a.maxVersion,namespaceActivo:a.namespaceActivo,onClose:a.onClose,onSave:a.onSave,container:a.container,idDefaultProfile:a.idDefaultProfile,idDefaultAccount:a.idDefaultAccount}).show()}}});Core.Functions.Validations.toggleValidation(a.ddlVersion,false);a.ddlEstado.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idEstadoAperturaCuenta}",textTemplate:"{Nombre}",events:{select:function(e){a.lblEstadoCuenta.text(a.ddlEstado.swidget().selectedItem().Nombre)}}});Core.Functions.Validations.toggleValidation(a.ddlEstado,false);a.ddlAsesor.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idPersona}",textTemplate:"{Nombre}",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}}});Core.Functions.Validations.toggleValidation(a.ddlAsesor,false);a.chkUsarFirmaDigital.shieldCheckBox({label:"Usar firma digital"});Core.Functions.Validations.toggleValidation(a.chkUsarFirmaDigital,false);a.chkIngresoAsesorFinanciero.shieldCheckBox({label:"Asesor financiero, productor o referido",enabled:false,events:{click:function(f){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.chkIngresoAsesorFinanciero,false);a.txtIngresoAsesorFinanciero.shieldTextBox({value:"",enabled:false});Core.Functions.Validations.toggleValidation(a.txtIngresoAsesorFinanciero,false);a.chkCuentasComitente.shieldCheckBox({label:"Comitente"});Core.Functions.Validations.toggleValidation(a.chkCuentasComitente,false);a.chkCuentasCuotapartista.shieldCheckBox({label:"Cuotapartista"});Core.Functions.Validations.toggleValidation(a.chkCuentasCuotapartista,false);if(!a.chkTipoFirmaConjunta.swidget()){a.chkTipoFirmaConjunta.shieldRadioButton({label:"Conjunta"})}Core.Functions.Validations.toggleValidation(a.chkTipoFirmaConjunta,false);if(!a.chkTipoFirmaIndistinta.swidget()){a.chkTipoFirmaIndistinta.shieldRadioButton({label:"Indistinta"})}Core.Functions.Validations.toggleValidation(a.chkTipoFirmaIndistinta,false);a.chkOrigenPatrimonioActividadPrincipal.shieldCheckBox({label:"Actividad Principal"});Core.Functions.Validations.toggleValidation(a.chkOrigenPatrimonioActividadPrincipal,false);a.chkOrigenPatrimonioVentaBienes.shieldCheckBox({label:"Venta de Bienes"});Core.Functions.Validations.toggleValidation(a.chkOrigenPatrimonioVentaBienes,false);a.chkOrigenPatrimonioOtro.shieldCheckBox({label:"Otro",events:{click:function(f){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.chkOrigenPatrimonioOtro,false);a.txtOrigenPatrimonioOtroDetalle.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtOrigenPatrimonioOtroDetalle,false);a.chkConvenioComitenteAAGI.shieldCheckBox({label:"Mandato Discrecional",enabled:false});Core.Functions.Validations.toggleValidation(a.chkConvenioComitenteAAGI,false);a.txtCanalOtroDetalle.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtCanalOtroDetalle,false);a.ddlArancel.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idArancel}",textTemplate:"{Descripcion}",autoComplete:{enabled:false}});Core.Functions.Validations.toggleValidation(a.ddlArancel,false);a.txtComoLlegoABalanz.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtComoLlegoABalanz,false);a.txtUsuarioAsignado.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtUsuarioAsignado,false);a.chkTipoInversionAcciones.shieldCheckBox({label:"Acciones"});Core.Functions.Validations.toggleValidation(a.chkTipoInversionAcciones,false);a.chkTipoInversionTitulosPublicos.shieldCheckBox({label:"Títulos Públicos"});Core.Functions.Validations.toggleValidation(a.chkTipoInversionTitulosPublicos,false);a.chkTipoInversionFideicomisos.shieldCheckBox({label:"Fideicomisos"});Core.Functions.Validations.toggleValidation(a.chkTipoInversionFideicomisos,false);a.chkTipoInversionFondos.shieldCheckBox({label:"Fondos"});Core.Functions.Validations.toggleValidation(a.chkTipoInversionFondos,false);a.chkTipoInversionOpciones.shieldCheckBox({label:"Opciones"});Core.Functions.Validations.toggleValidation(a.chkTipoInversionOpciones,false);a.chkTipoInversionOperacionesCambioUSD.shieldCheckBox({label:"Cambio (U$D)"});Core.Functions.Validations.toggleValidation(a.chkTipoInversionOperacionesCambioUSD,false);a.chkTipoInversionFuturos.shieldCheckBox({label:"Futuros"});Core.Functions.Validations.toggleValidation(a.chkTipoInversionFuturos,false);a.chkTipoInversionObligacionesNegociables.shieldCheckBox({label:"ONs"});Core.Functions.Validations.toggleValidation(a.chkTipoInversionObligacionesNegociables,false);a.chkTipoInversionChequePagoDiferido.shieldCheckBox({label:"Cheque Dif. / Fact. Créd. Electrónica"});Core.Functions.Validations.toggleValidation(a.chkTipoInversionChequePagoDiferido,false);a.chkTipoInversionOtro.shieldCheckBox({label:"Otro",events:{click:function(f){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.chkTipoInversionOtro,false);a.txtTipoInversionOtroDetalle.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtTipoInversionOtroDetalle,false);a.txtPlazoInversion.shieldNumericTextBox({min:0,max:99999,step:1});Core.Functions.Validations.toggleValidation(a.txtPlazoInversion,false);a.txtDescripcionActividadCliente.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtDescripcionActividadCliente,false);a.ddlPaisTipoIdentificacionFiscal.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idPais}",textTemplate:"{Nombre}",enabled:false,autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{select:function(e){a.setControls()},blur:function(f){if(a.ddlPaisTipoIdentificacionFiscal.swidget().selectedItem()==null){a.ddlPaisTipoIdentificacionFiscal.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlPaisTipoIdentificacionFiscal,false);a.ddlTipoIdentificacionFiscal.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idTipoIdentificadorFiscal}",textTemplate:"{Descripcion}"});Core.Functions.Validations.toggleValidation(a.ddlTipoIdentificacionFiscal,false);a.txtIdentificacionFiscal.shieldTextBox({value:"",events:{blur:function(){for(var e=0;e<a.personas.length;e++){a.personas[e].pepCUIT=a.txtIdentificacionFiscal.val()}}}});Core.Functions.Validations.toggleValidation(a.txtIdentificacionFiscal,false);a.txtRazonSocial.shieldTextBox({value:"",events:{blur:function(){for(var e=0;e<a.personas.length;e++){a.personas[e].pepDenominacion=a.txtRazonSocial.val()}}}});Core.Functions.Validations.toggleValidation(a.txtRazonSocial,false);a.ddlNacionalidad.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idPais}",textTemplate:"{Nombre}",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{select:function(e){a.setControls()},blur:function(f){if(a.ddlNacionalidad.swidget().selectedItem()==null){a.ddlNacionalidad.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlNacionalidad,false);a.ddlLugarConstitucion.shieldComboBox({dataSource:{data:[]},valueTemplate:"{Nombre}",textTemplate:"{Nombre}",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{select:function(e){a.setControls()},blur:function(f){if(a.ddlLugarConstitucion.swidget().selectedItem()==null){a.ddlLugarConstitucion.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlLugarConstitucion,false);a.ddlTipoPersonaJuridica.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idTipoPersonaJuridica}",textTemplate:"{Descripcion}"});Core.Functions.Validations.toggleValidation(a.ddlTipoPersonaJuridica,false);a.ddlTipoRegistracionJuridica.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idTipoRegistracionJuridica}",textTemplate:"{Descripcion}"});Core.Functions.Validations.toggleValidation(a.ddlTipoRegistracionJuridica,false);a.txtNumeroInscripcion.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtNumeroInscripcion,false);a.txtFechaConstitucion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:new Date(),max:new Date()});Core.Functions.Validations.toggleValidation(a.txtFechaConstitucion,false);a.txtLibro.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtLibro,false);a.txtTomo.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtTomo,false);a.ddlActividadPrincipal.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idActividadJuridica}",textTemplate:"{Descripcion}",events:{select:function(e){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.ddlActividadPrincipal,false);a.txtActividadPrincipalOtro.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtActividadPrincipalOtro,false);a.txtSegmentoInversion.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtSegmentoInversion,false);a.txtNumeroAseguradora.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtNumeroAseguradora,false);a.ddlCondicionIva.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idTipoContribuyente}",textTemplate:"{Descripcion}"});Core.Functions.Validations.toggleValidation(a.ddlCondicionIva,false);a.ddlInscripcionGanancias.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idInscripcionGanancia}",textTemplate:"{Descripcion}"});Core.Functions.Validations.toggleValidation(a.ddlCondicionIva,false);a.txtDomicilioLegalCalle.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioLegalCalle,false);a.txtDomicilioLegalNumero.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioLegalNumero,false);a.txtDomicilioLegalPiso.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioLegalPiso,false);a.txtDomicilioLegalDepartamento.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioLegalDepartamento,false);a.ddlDomicilioLegalPais.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idPais}",textTemplate:"{Nombre}",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{select:function(e){a.setControls()},blur:function(f){if(a.ddlDomicilioLegalPais.swidget().selectedItem()==null){a.ddlDomicilioLegalPais.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlDomicilioLegalPais,false);a.ddlDomicilioLegalProvincia.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idProvincia}",textTemplate:"{Nombre}",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{blur:function(f){if(a.ddlDomicilioLegalProvincia.swidget().selectedItem()==null){a.ddlDomicilioLegalProvincia.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlDomicilioLegalProvincia,false);a.txtDomicilioLegalLocalidad.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioLegalLocalidad,false);a.txtDomicilioLegalCodigoPostal.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioLegalCodigoPostal,false);a.ddlEmailNotificacionesCantidad.shieldDropDown({dataSource:{data:[{value:1,text:"1"},{value:2,text:"2"},{value:3,text:"3"},{value:4,text:"4"}]},valueTemplate:"{value}",textTemplate:"{text}",events:{select:function(e){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.ddlEmailNotificacionesCantidad,false);a.txtEmailNotificaciones1.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtEmailNotificaciones1,false);a.txtEmailNotificaciones2.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtEmailNotificaciones2,false);a.txtEmailNotificaciones3.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtEmailNotificaciones3,false);a.txtEmailNotificaciones4.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtEmailNotificaciones4,false);a.txtTelefonoParticularArea.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularArea,false);a.txtTelefonoParticularNumero.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularNumero,false);var d=[];Core.Objects.Contry.forEach(function(e){d.push({value:e.phone_code,text:"(+"+e.phone_code+") "+e.name})});a.ddlTelefonoCelularPais.shieldDropDown({dataSource:{data:d},valueTemplate:"{value}",textTemplate:"{text}",value:"",events:{select:function(e){a.setTelefonoCelularControls()},blur:function(f){if(a.ddlTelefonoCelularPais.swidget().selectedItem()==null){a.ddlTelefonoCelularPais.swidget().value(null)}}}});a.txtTelefonoCelularArea.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularArea,false);a.txtTelefonoCelularNumero.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularNumero,false);a.ddlTributaPais1.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idPais}",textTemplate:"{Nombre}",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{select:function(e){a.setControls()},blur:function(f){if(a.ddlTributaPais1.swidget().selectedItem()==null){a.ddlTributaPais1.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlTributaPais1,false);a.ddlTributaPais2.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idPais}",textTemplate:"{Nombre}",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{select:function(e){a.setControls()},blur:function(f){if(a.ddlTributaPais2.swidget().selectedItem()==null){a.ddlTributaPais2.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlTributaPais2,false);a.ddlTributaPais3.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idPais}",textTemplate:"{Nombre}",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{select:function(e){a.setControls()},blur:function(f){if(a.ddlTributaPais3.swidget().selectedItem()==null){a.ddlTributaPais3.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlTributaPais3,false);a.txtTributaNit1.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtTributaNit1,false);a.txtTributaNit2.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtTributaNit2,false);a.txtTributaNit3.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtTributaNit3,false);a.ddlTributaTipoIdentificadorFiscal1.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idTipoIdentificadorFiscal}",textTemplate:"{Descripcion}"});Core.Functions.Validations.toggleValidation(a.ddlTributaTipoIdentificadorFiscal1,false);a.ddlTributaTipoIdentificadorFiscal2.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idTipoIdentificadorFiscal}",textTemplate:"{Descripcion}"});Core.Functions.Validations.toggleValidation(a.ddlTributaTipoIdentificadorFiscal2,false);a.ddlTributaTipoIdentificadorFiscal3.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idTipoIdentificadorFiscal}",textTemplate:"{Descripcion}"});Core.Functions.Validations.toggleValidation(a.ddlTributaTipoIdentificadorFiscal3,false);a.ddlCantidadResidenciasFiscales.shieldDropDown({dataSource:{data:[{value:1,text:"1"},{value:2,text:"2"},{value:3,text:"3"}]},valueTemplate:"{value}",textTemplate:"{text}",events:{select:function(e){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.ddlCantidadResidenciasFiscales,false);a.txtBeneficiarioEstadounidenseNombre1.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseNombre1,false);a.txtBeneficiarioEstadounidenseNombre2.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseNombre2,false);a.txtBeneficiarioEstadounidenseNombre3.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseNombre3,false);a.txtBeneficiarioEstadounidenseNombre4.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseNombre4,false);a.txtBeneficiarioEstadounidenseNombre5.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseNombre5,false);a.txtBeneficiarioEstadounidenseNombre6.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseNombre6,false);a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU1.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU1,false);a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU2.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU2,false);a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU3.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU3,false);a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU4.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU4,false);a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU5.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU5,false);a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU6.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU6,false);a.controlBeneficiarioEstadounidensePorcentajeParticipacion1=new Core.Controls.DecimalPicker(a.txtBeneficiarioEstadounidensePorcentajeParticipacion1,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion1,false);a.controlBeneficiarioEstadounidensePorcentajeParticipacion2=new Core.Controls.DecimalPicker(a.txtBeneficiarioEstadounidensePorcentajeParticipacion2,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion2,false);a.controlBeneficiarioEstadounidensePorcentajeParticipacion3=new Core.Controls.DecimalPicker(a.txtBeneficiarioEstadounidensePorcentajeParticipacion3,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion3,false);a.controlBeneficiarioEstadounidensePorcentajeParticipacion4=new Core.Controls.DecimalPicker(a.txtBeneficiarioEstadounidensePorcentajeParticipacion4,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion4,false);a.controlBeneficiarioEstadounidensePorcentajeParticipacion5=new Core.Controls.DecimalPicker(a.txtBeneficiarioEstadounidensePorcentajeParticipacion5,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion5,false);a.controlBeneficiarioEstadounidensePorcentajeParticipacion6=new Core.Controls.DecimalPicker(a.txtBeneficiarioEstadounidensePorcentajeParticipacion6,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true});Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion6,false);a.chkPoseeBeneficiariosEstadounidenses.shieldCheckBox({label:"Posee beneficiarios finales con intereses estadounidenses sustanciales",events:{click:function(f){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.chkPoseeBeneficiariosEstadounidenses,false);a.ddlBeneficiariosEstadounidensesCantidad.shieldDropDown({dataSource:{data:[{value:1,text:"1"},{value:2,text:"2"},{value:3,text:"3"},{value:4,text:"4"},{value:5,text:"5"},{value:6,text:"6"}]},valueTemplate:"{value}",textTemplate:"{text}",events:{select:function(e){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.ddlBeneficiariosEstadounidensesCantidad,false);a.ddlTipoInstitucionFinancieraExtranjera.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idTipoInstitucionFinancieraExtranjera}",textTemplate:"{Descripcion}"});Core.Functions.Validations.toggleValidation(a.ddlTipoInstitucionFinancieraExtranjera,false);a.txtInstitucionFinancieraExtranjeraGIIN.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtInstitucionFinancieraExtranjeraGIIN,false);a.ddlTipoReporteDirectoIRS.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idReporteDirectoIRS}",textTemplate:"{Descripcion}"});Core.Functions.Validations.toggleValidation(a.ddlTipoReporteDirectoIRS,false);a.txtReporteDirectoIRSGIIN.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtReporteDirectoIRSGIIN,false);a.txtPersonaEstadounidenseTIN.shieldTextBox({value:""});Core.Functions.Validations.toggleValidation(a.txtPersonaEstadounidenseTIN,false);a.ddlTipoPersonaJuridicaExenta.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idPersonaJuridicaExenta}",textTemplate:"{Descripcion}"});Core.Functions.Validations.toggleValidation(a.ddlTipoPersonaJuridicaExenta,false);a.ddlCiudadaniaEEUU.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idTipoFATCA}",textTemplate:"{Descripcion}",events:{select:function(e){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.ddlCiudadaniaEEUU,false);a.ddlTipoOcde.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idTipoOCDE}",textTemplate:"{Descripcion}",events:{select:function(e){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.ddlTipoOcde,false);a.chkSujetoObligado.shieldCheckBox({label:"Sujeto Obligado ante la UIF (Unidad de Información Financiera)."});Core.Functions.Validations.toggleValidation(a.chkSujetoObligado,false);a.controlMontoCompliance=new Core.Controls.DecimalPicker(a.txtMontoCompliance,{maxDecimalDigitCount:2,showThousandsSeparator:false});Core.Functions.Validations.toggleValidation(a.txtMontoCompliance,false);a.divMontoCompliance.hide();if(Core.Objects.Context.Configuration.idAplicacion==3){a.divMontoCompliance.show()}a.ddlRiesgoCliente.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idRiesgo}",textTemplate:"{RiesgoDescripcion}"});Core.Functions.Validations.toggleValidation(a.ddlRiesgoCliente,false);a.btnAgregarArchivo.unbind("click");a.btnAgregarArchivo.on("click",function(){var e=new Core.Controls.ManagerAltaCuentaNuevoArchivo({onSave:function(g){a.archivos.push({urlArchivo:g.file.urlArchivo,idTipoArchivo:g.idTipoArchivo,Tipo:g.Tipo,Fecha:g.Fecha,Comentario:g.comentarios});var f=a.gridArchivos.swidget().initialOptions;f.dataSource.data=a.archivos;a.gridArchivos.swidget().refresh(f)},tiposArchivos:((a.dataParametros!=null)?$.grep(a.dataParametros.TiposArchivos,function(g,f){return g.Juridica&&g.BCV}):[])}).show()});a.btnNuevaPersona.unbind("click");a.btnNuevaPersona.on("click",function(){a.divAltaCuenta.hide();a.divManagerPersona.show();a.divMatrizRiesgo.hide();var e=new Core.Controls.ManagerPersona({container:a.divManagerPersona,divMatrizRiesgo:a.divMatrizRiesgo,namespaceActivo:a.namespaceActivo,idTipoValidacion:(a.dataCuenta&&a.ddlEstado.swidget().selectedItem())?a.ddlEstado.swidget().selectedItem().idTipoValidacion:0,dataParametros:a.dataParametros,dataParametrosUsuario:a.dataParametrosUsuario,optionsApertura:a.optionsApertura,idAperturaCuenta:a.idAperturaCuenta,esCuentaJuridica:true,defaultPersonaExpuestaDenominacion:a.txtRazonSocial.val(),defaultPersonaExpuestaCuit:a.txtIdentificacionFiscal.val(),onSave:function(h){var g=a.getMaxNumero(h.tipo);h.numero=g+1;a.personas.push(h);var f=a.gridPersonas.swidget().initialOptions;f.dataSource.data=a.personas;a.gridPersonas.swidget().refresh(f);return true},onClose:function(){a.divAltaCuenta.show();a.divManagerPersona.hide();a.divMatrizRiesgo.hide()}}).show()});a.btnCalcularMatrizRiesgo.unbind("click");a.btnCalcularMatrizRiesgo.click(function(){a.divAltaCuenta.hide();a.divManagerPersona.hide();a.divMatrizRiesgo.show();var e=new Core.Controls.ManagerMatrizRiesgo({container:a.divMatrizRiesgo,dataParametrosUsuario:a.dataParametrosUsuario,calcularMatriz:true,consultarMatriz:false,cuilCuit:a.dataCuenta.juridica[0].CUIT,idAperturaCuenta:a.idAperturaCuenta,tipo:0,numero:0,readOnly:a.readOnly,optionsApertura:a.optionsApertura,onSave:function(h,f){a.controlMontoCompliance.setValue(h);if(f){var g=a.ddlRiesgoCliente.swidget().initialOptions;g.value=f.toString();a.ddlRiesgoCliente.swidget().refresh(g)}},onClose:function(){a.divAltaCuenta.show();a.divManagerPersona.hide();a.divMatrizRiesgo.hide()}}).show()});a.btnConsultarMatrizRiesgo.unbind("click");a.btnConsultarMatrizRiesgo.click(function(){a.divAltaCuenta.hide();a.divManagerPersona.hide();a.divMatrizRiesgo.show();var e=new Core.Controls.ManagerMatrizRiesgo({container:a.divMatrizRiesgo,dataParametrosUsuario:a.dataParametrosUsuario,calcularMatriz:false,consultarMatriz:true,cuilCuit:a.dataCuenta.juridica[0].CUIT,idAperturaCuenta:a.idAperturaCuenta,tipo:0,numero:0,readOnly:a.readOnly,optionsApertura:a.optionsApertura,onSave:function(h,f){a.controlMontoCompliance.setValue(h);if(f){var g=a.ddlRiesgoCliente.swidget().initialOptions;g.value=f.toString();a.ddlRiesgoCliente.swidget().refresh(g)}},onClose:function(){a.divAltaCuenta.show();a.divManagerPersona.hide();a.divMatrizRiesgo.hide()}}).show()});a.btnAgregarObservacion.unbind("click");a.btnAgregarObservacion.on("click",function(){new Core.Controls.Prompt("Nueva Observación","Ingrese la observación",{onAccepted:function(e){var f=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"apertura/cuenta/observacion/"+a.idAperturaCuenta,requestType:"POST",requestData:{observacion:e}});f.onSuccess=function(h){a.observaciones=h.observaciones;var g=a.gridObservaciones.swidget().initialOptions;g.dataSource.data=a.observaciones;a.gridObservaciones.swidget().refresh(g)};f.request()}}).show()});a.btnVolver.unbind("click");a.btnVolver.on("click",function(){a.destroy(true)});a.btnGuardarYCerrar.unbind("click");a.btnGuardarYCerrar.on("click",function(){var e=a.getRequestData();if(e!=null){var f=new Core.Ajax.ServerRequest({showOverlay:true,requestUrl:"apertura/cuenta",requestType:"POST",requestData:e});f.onSuccess=function(g){if(a.onSave){a.onSave(g.idAperturaCuenta,g.version)}a.destroy(true)};f.request()}else{$("html, body").animate({scrollTop:$(".cuenta").offset().top},1000)}});a.btnRefirmar.unbind("click");a.btnRefirmar.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea Reenviar el mail de firma? Esta acción reenviará los mails con los links para la firma digital a todos aquellos destinatarios que aún no hayan firmado.",{onAccepted:function(){var e=new Core.Ajax.ServerRequest({overlayElement:a.btnRefirmar,secureRequest:true,requestUrl:"apertura/cuenta/refirmar",requestType:"POST",requestData:{idAperturaCuenta:a.idAperturaCuenta}});e.onSuccess=function(){if(a.onSave){a.onSave(a.dataCuenta.datos[0].idAperturaCuenta,a.dataCuenta.datos[0].version)}a.destroy(true)};e.request()}}).show()});a.btnAnularFirma.unbind("click");a.btnAnularFirma.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea Anular la Firma de esta Apertura? Esta acción desestimará la última firma completa que tenga esta apertura, requiriendo que se deba volver a firmar por el cliente.",{onAccepted:function(){var e=new Core.Ajax.ServerRequest({overlayElement:a.btnAnularFirma,secureRequest:true,requestUrl:"apertura/cuenta/anularfirma",requestType:"POST",requestData:{idAperturaCuenta:a.idAperturaCuenta}});e.onSuccess=function(f){new Core.Controls.Dialog("Aviso",(f.Descripcion?f.Descripcion:"Operación realizada con éxito."),{displayButtons:{close:true,accept:false}}).show()};e.request()}}).show()});a.btnFormularioVacio.unbind("click");a.btnFormularioVacio.on("click",function(){if(a.dataParametrosUsuario&&a.dataParametrosUsuario.Links&&a.dataParametrosUsuario.Links[0].FormularioJuridicaVacio){window.open(a.dataParametrosUsuario.Links[0].FormularioJuridicaVacio,"_blank")}});var c=[{width:"25%",field:"nombre",title:"Nombre",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"25%",field:"apellido",title:"Apellido",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"25%",field:"tipo",title:"Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,g){e.html("<span>"+a.getTipoDescripcion(f.tipo)+"</span>")}},{width:"25%",field:"numero",title:"Número",headerAttributes:Core.Functions.grid.getCellOddClass()},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){if(f.tienePruebaDeVida){var g=$('<button disabled type="button" title="Prueba de Vida" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/prueba-de-vida.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color",f.tienePruebaDeVida)}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){if(f.tieneMatchCara){var g=$('<button disabled type="button" title="Match de Cara" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/match-cara.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color",f.tieneMatchCara);if(a.optionsApertura&&a.optionsApertura.consultaICAR){g.removeAttr("disabled");g.on("click",function(){Core.Functions.ExternalServices.Icar.showReport(g,a.idAperturaCuenta,f.tipo,f.numero)})}}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){if(f.tieneDatosPrecargados){var g=$('<button disabled type="button" title="Datos Precargados" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/datos-precargados.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color",f.tieneDatosPrecargados);if(a.optionsApertura&&a.optionsApertura.consultaICAR){g.removeAttr("disabled");g.on("click",function(){Core.Functions.ExternalServices.Icar.showReport(g,a.idAperturaCuenta,f.tipo,f.numero)})}}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){if(f.tieneReuters){var g=$('<button disabled type="button" title="Reuters" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/reuters-logo.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color",f.tieneReuters);if(a.optionsApertura&&a.optionsApertura.consultaReuters){g.removeAttr("disabled");g.on("click",function(){Core.Functions.ExternalServices.Reuters.showReport(g,f.documento,encodeURIComponent(f.nombre.toLowerCase()+" "+f.apellido.toLowerCase()),f.sexo,f.fechaNacimiento,f.nacionalidad)})}}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){if(f.tieneNOSIS){var g=$('<button disabled type="button" title="Nosis" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/nosis-logo.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color",f.tieneNOSIS);if(a.optionsApertura&&a.optionsApertura.consultaNosis){g.removeAttr("disabled");g.on("click",function(){Core.Functions.ExternalServices.Nosis.showReport(g,f.cuit_cuil)})}}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){if(f.tieneRenaper){var g=$('<button disabled type="button" title="Renaper" class="btn-sm balanz-button"style="border:3px solid; background-color:#fff;"><img src="/images/renaper-logo.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color",f.tieneRenaper);if(a.optionsApertura&&a.optionsApertura.consultaRenaper){g.removeAttr("disabled");g.on("click",function(){Core.Functions.ExternalServices.Renaper.showReport(g,f.documento,f.idTipoDocumento,f.sexo)})}}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){if(f.tieneUIF){var g=$('<button disabled type="button" title="UIF" class="btn-sm balanz-button"style="border:3px solid; background-color:#fff;"><img src="/images/uif-logo.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color",f.tieneUIF);if(a.optionsApertura&&a.optionsApertura.consultaUIF){g.removeAttr("disabled");g.on("click",function(){Core.Functions.ExternalServices.UIF.showReport(g,f.cuit_cuil)})}}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(e,f,h){var g=$('<button disabled type="button" title="Google" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/google-logo.png" style="width:20px; height:20px;" /></button>').appendTo(e);g.css("border-color","lightgreen");if(a.optionsApertura&&a.optionsApertura.consultaGoogle){g.removeAttr("disabled");g.on("click",function(){a.openUrlGoogle(f.nombre+"+"+f.apellido)})}}},{width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(f,g,h){var e=$('<button type="button" title="Editar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(f);e.on("click",function(){a.divAltaCuenta.hide();a.divManagerPersona.show();a.divMatrizRiesgo.hide();var j=a.personas[h];j.pepCUIT=a.txtIdentificacionFiscal.val();j.pepDenominacion=a.txtRazonSocial.val();var i=new Core.Controls.ManagerPersona({container:a.divManagerPersona,divMatrizRiesgo:a.divMatrizRiesgo,namespaceActivo:a.namespaceActivo,idTipoValidacion:(a.dataCuenta&&a.ddlEstado.swidget().selectedItem())?a.ddlEstado.swidget().selectedItem().idTipoValidacion:0,persona:j,dataParametros:a.dataParametros,dataParametrosUsuario:a.dataParametrosUsuario,optionsApertura:a.optionsApertura,idAperturaCuenta:a.idAperturaCuenta,readOnly:a.readOnly,esCuentaJuridica:true,onSave:function(k){a.personas[h]=k;a.refreshNumeroPersonas();return true},onClose:function(){a.divAltaCuenta.show();a.divManagerPersona.hide();a.divMatrizRiesgo.hide()}}).show()})}}];if(!a.readOnly){c.push({width:45,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(f,g,h){var e=$('<button type="button" title="Eliminar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(f);e.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar la persona: "+g.nombre+" "+g.apellido+"?",{onAccepted:function(){a.personas.remove(a.personas[h]);a.refreshNumeroPersonas()}}).show()})}})}a.gridPersonas.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:c});a.gridArchivos.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},columns:[{width:"25%",field:"Fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"25%",field:"Tipo",title:"Tipo",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"50%",field:"Comentario",title:"Comentario",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:100,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(g,h,i){if(a.namespaceActivo!="ReporteAperturas"||(a.optionsApertura&&a.optionsApertura.descargarArchivosApertura)){var e=$('<button type="button" title="Descargar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-download-alt"></span></button>').appendTo(g);e.on("click",function(){window.open(Core.Origin+Core.Functions.Context.getPathname()+h.urlArchivo)})}if(!a.readOnly){var f=$('<button type="button" title="Eliminar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(g);f.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar el archivo?",{onAccepted:function(){a.archivos=$.grep(a.archivos,function(l,k){return l.urlArchivo!=h.urlArchivo||l.Fecha!=h.Fecha||l.Tipo!=h.Tipo||l.Comentario!=h.Comentario});var j=a.gridArchivos.swidget().initialOptions;j.dataSource.data=a.archivos;a.gridArchivos.swidget().refresh(j)}}).show()})}}}]});a.gridObservaciones.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},paging:{pageSize:30,pageLinksCount:10},columns:[{width:"25%",field:"Fecha",title:"Fecha",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:"25%",field:"username",title:"Usuario",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString},{width:"50%",field:"Observacion",title:"Observación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString}]});a.getData()};a.getData=function(){a.personas=a.dataCuenta!=null?a.dataCuenta.personas:[];a.archivos=a.dataCuenta!=null?a.dataCuenta.archivos:[];a.observaciones=a.dataCuenta!=null?a.dataCuenta.observaciones:[];a.loadControls()};a.loadControls=function(){if(a.readOnly){var w=[];for(var h=1;h<=a.maxVersion;h++){w.push({version:h})}var p=a.ddlVersion.swidget().initialOptions;p.dataSource.data=w;p.value=a.versionActual.toString();a.ddlVersion.swidget().refresh(p)}a.divMontoInvertirContainer.html("");a.dataParametros.MontoAInvertirJuridicas.forEach(function(z,y){if(z.habilitado&&z.AR){var x=$("<div></div>").appendTo(a.divMontoInvertirContainer);var i=$('<input class="form-control sui-input monto-a-invertir-juridica-option" type="radio" name="MontoAInvertirJuridica" idMontoAInvertirJuridica="'+z.idMontoAInvertirJuridica+'">').appendTo(x);i.shieldRadioButton({label:z.Descripcion})}});a.divCanalContainer.html("");if(a.dataParametrosUsuario&&a.dataParametrosUsuario.canalDeVenta){a.dataParametrosUsuario.canalDeVenta.forEach(function(y,x){var i=$('<input type="radio" class="form-control sui-input chk-canal-option" name="option-canal" idCanalDeVenta="'+y.idCanalDeVenta+'">').appendTo(a.divCanalContainer);i.shieldRadioButton({label:y.Descripcion,events:{click:function(z){a.setControls()}}})})}var p=a.ddlAsesor.swidget().initialOptions;p.dataSource.data=(a.dataParametrosUsuario!=null)?a.dataParametrosUsuario.asesores:[];if(a.dataCuenta!=null&&a.dataCuenta.datos[0].idPersonaAsesor!=null){p.value=a.dataCuenta.datos[0].idPersonaAsesor.toString()}a.ddlAsesor.swidget().refresh(p);var p=a.ddlEstado.swidget().initialOptions;p.dataSource.data=(a.dataCuenta!=null)?a.dataCuenta.estados:[];if(a.dataCuenta!=null&&a.dataCuenta.datos[0].idEstadoAperturaCuenta!=null){p.value=a.dataCuenta.datos[0].idEstadoAperturaCuenta.toString()}a.ddlEstado.swidget().refresh(p);if(a.ddlEstado.swidget().selectedItem()){a.lblEstadoCuenta.text(a.ddlEstado.swidget().selectedItem().Nombre)}var s=a.chkTipoFirmaConjunta.swidget().initialOptions;s.checked=(a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoFirma==Core.Business.eTipoFirma.Conjunta)?true:false;a.chkTipoFirmaConjunta.swidget().refresh(s);var s=a.chkTipoFirmaIndistinta.swidget().initialOptions;s.checked=(a.dataCuenta==null||(a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoFirma==Core.Business.eTipoFirma.Indistinta))?true:false;a.chkTipoFirmaIndistinta.swidget().refresh(s);a.chkCuentasComitente.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].cuentaComitente)?true:false));a.chkCuentasCuotapartista.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].cuentaCuotapartista)?true:false));a.chkIngresoAsesorFinanciero.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].contactoOriginal)?true:false));a.chkUsarFirmaDigital.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].UsarFirmaDigital)?true:false));a.divUsarFirmaDigital.hide();if(a.dataCuenta!=null&&a.dataCuenta.datos[0].habilitarFirmaDigital){a.divUsarFirmaDigital.show()}var p=a.txtIngresoAsesorFinanciero.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].contactoOriginal)?a.dataCuenta.datos[0].contactoOriginal:"";a.txtIngresoAsesorFinanciero.swidget().refresh(p);if(a.dataCuenta!=null){var e=$(".monto-a-invertir-juridica-option");var r=false;for(var h=0;h<e.length;h++){var c=$(e[h]);var s=c.swidget().initialOptions;s.checked=(c.attr("idMontoAInvertirJuridica")==a.dataCuenta.juridica[0].idMontoAInvertirJuridica);if(!r){r=(c.attr("idMontoAInvertirJuridica")==a.dataCuenta.juridica[0].idMontoAInvertirJuridica)}c.swidget().refresh(s)}if(!r&&a.dataCuenta.juridica[0].montoAInvertirJuridicaDescripcion){a.lblMontoInvertirAlert.html("<br />(El cliente eligió: "+a.dataCuenta.juridica[0].montoAInvertirJuridicaDescripcion+")")}var d=$(".chk-canal-option");for(var h=0;h<d.length;h++){var c=$(d[h]);var s=c.swidget().initialOptions;s.checked=(c.attr("idCanalDeVenta")==a.dataCuenta.datos[0].idCanal);c.swidget().refresh(s)}}a.chkOrigenPatrimonioActividadPrincipal.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].patrimonioActividadPrincipal)?true:false));a.chkOrigenPatrimonioVentaBienes.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].patrimonioVentaDeBienes)?true:false));a.chkOrigenPatrimonioOtro.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].patrimonioOtro)?true:false));var p=a.txtOrigenPatrimonioOtroDetalle.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].patrimonioOtro)?a.dataCuenta.datos[0].patrimonioOtro:"";a.txtOrigenPatrimonioOtroDetalle.swidget().refresh(p);a.chkConvenioComitenteAAGI.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].AceptoMandatoDiscrecional)?true:false));a.divConvenioComitenteAAGI.hide();if(a.dataCuenta!=null&&a.dataCuenta.datos[0].SolicitarMandatoDiscrecional){a.divConvenioComitenteAAGI.show()}var p=a.txtCanalOtroDetalle.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].canalOtro)?a.dataCuenta.datos[0].canalOtro:"";a.txtCanalOtroDetalle.swidget().refresh(p);var p=a.ddlArancel.swidget().initialOptions;p.dataSource.data=(a.dataParametrosUsuario!=null)?$.grep(a.dataParametrosUsuario.aranceles,function(x,i){return x.idNegocio==Core.Enums.eNegocio.BCV}):[];if(a.dataCuenta!=null&&a.dataCuenta.datos[0].idArancel!=null){p.value=a.dataCuenta.datos[0].idArancel.toString()}a.ddlArancel.swidget().refresh(p);var p=a.txtComoLlegoABalanz.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].comoLlegoABalanz)?a.dataCuenta.datos[0].comoLlegoABalanz:"";a.txtComoLlegoABalanz.swidget().refresh(p);var p=a.txtDescripcionActividadCliente.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].descripcionActividadCliente)?a.dataCuenta.datos[0].descripcionActividadCliente:"";a.txtDescripcionActividadCliente.swidget().refresh(p);var p=a.txtUsuarioAsignado.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].usuarioAsignado)?a.dataCuenta.datos[0].usuarioAsignado:"";a.txtUsuarioAsignado.swidget().refresh(p);a.chkTipoInversionAcciones.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionAcciones)?true:false));a.chkTipoInversionTitulosPublicos.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionTitulosPublicos)?true:false));a.chkTipoInversionFideicomisos.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionFideicomisos)?true:false));a.chkTipoInversionOpciones.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionOpciones)?true:false));a.chkTipoInversionFondos.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionFondos)?true:false));a.chkTipoInversionOperacionesCambioUSD.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionOperacionesCambioUSD)?true:false));a.chkTipoInversionObligacionesNegociables.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionObligacionesNegociables)?true:false));a.chkTipoInversionFuturos.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionFuturos)?true:false));a.chkTipoInversionChequePagoDiferido.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionChequePagoDiferido)?true:false));a.chkTipoInversionOtro.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionOtros)?true:false));var p=a.txtTipoInversionOtroDetalle.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].tipoInversionOtros)?a.dataCuenta.datos[0].tipoInversionOtros:"";a.txtTipoInversionOtroDetalle.swidget().refresh(p);var p=a.txtPlazoInversion.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.datos[0].plazoAproxInversion)?a.dataCuenta.datos[0].plazoAproxInversion:"";a.txtPlazoInversion.swidget().refresh(p);var v=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].idTipoIdentificadorFiscal)?$.grep(a.dataParametros.tiposIdentificadoresFiscales,function(x,i){return x.idTipoIdentificadorFiscal==a.dataCuenta.juridica[0].idTipoIdentificadorFiscal})[0]:null;var p=a.ddlPaisTipoIdentificacionFiscal.swidget().initialOptions;p.dataSource.data=(a.dataParametros!=null)?a.dataParametros.paises:[];p.value=(v)?v.idPais.toString():"1";a.ddlPaisTipoIdentificacionFiscal.swidget().refresh(p);var p=a.txtIdentificacionFiscal.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].CUIT)?a.dataCuenta.juridica[0].CUIT:"";a.txtIdentificacionFiscal.swidget().refresh(p);var p=a.txtRazonSocial.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].RazonSocial)?a.dataCuenta.juridica[0].RazonSocial:"";a.txtRazonSocial.swidget().refresh(p);var p=a.ddlNacionalidad.swidget().initialOptions;p.dataSource.data=(a.dataParametros!=null)?a.dataParametros.paises:[];p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].Nacionalidad)?a.dataCuenta.juridica[0].Nacionalidad.toString():"1";a.ddlNacionalidad.swidget().refresh(p);var p=a.ddlTipoRegistracionJuridica.swidget().initialOptions;p.dataSource.data=(a.dataParametros!=null)?a.dataParametros.TiposRegistracionesJuridicas:[];a.ddlTipoRegistracionJuridica.swidget().refresh(p);a.ddlTipoRegistracionJuridica.swidget().value(a.dataCuenta!=null&&a.dataCuenta.juridica[0].idTipoRegistracionJuridica?a.dataCuenta.juridica[0].idTipoRegistracionJuridica.toString():"");var p=a.ddlTipoPersonaJuridica.swidget().initialOptions;p.dataSource.data=(a.dataParametros!=null)?a.dataParametros.TiposPersonasJuridicas:[];a.ddlTipoPersonaJuridica.swidget().refresh(p);a.ddlTipoPersonaJuridica.swidget().value(a.dataCuenta!=null&&a.dataCuenta.juridica[0].idTipoPersonaJuridica?a.dataCuenta.juridica[0].idTipoPersonaJuridica.toString():"");var p=a.txtNumeroInscripcion.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].NroInscripcion)?a.dataCuenta.juridica[0].NroInscripcion:"";a.txtNumeroInscripcion.swidget().refresh(p);var p=a.txtFechaConstitucion.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].FechaConstitucion)?a.getDate(a.dataCuenta.juridica[0].FechaConstitucion):new Date();a.txtFechaConstitucion.swidget().refresh(p);var p=a.txtTomo.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].Tomo)?a.dataCuenta.juridica[0].Tomo:"";a.txtTomo.swidget().refresh(p);var p=a.txtLibro.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].Libro)?a.dataCuenta.juridica[0].Libro:"";a.txtLibro.swidget().refresh(p);var p=a.ddlActividadPrincipal.swidget().initialOptions;p.dataSource.data=(a.dataParametros!=null)?a.dataParametros.actividadesJuridicas.sort(function(i,x){return i.Descripcion>x.Descripcion?1:-1}):[];a.ddlActividadPrincipal.swidget().refresh(p);a.ddlActividadPrincipal.swidget().value(a.dataCuenta!=null&&a.dataCuenta.juridica[0].idActividadJuridica?a.dataCuenta.juridica[0].idActividadJuridica.toString():"");var p=a.txtActividadPrincipalOtro.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].OcupacionDescripcion)?a.dataCuenta.juridica[0].OcupacionDescripcion:"";a.txtActividadPrincipalOtro.swidget().refresh(p);var p=a.txtSegmentoInversion.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].SegmentoInversion)?a.dataCuenta.juridica[0].SegmentoInversion:"";a.txtSegmentoInversion.swidget().refresh(p);var p=a.txtNumeroAseguradora.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].NroAseguradora)?a.dataCuenta.juridica[0].NroAseguradora:"";a.txtNumeroAseguradora.swidget().refresh(p);var p=a.ddlCondicionIva.swidget().initialOptions;p.dataSource.data=(a.dataParametros!=null)?$.grep(a.dataParametros.tipoContribuyentes,function(y,x){return y.EsJuridica}):[];a.ddlCondicionIva.swidget().refresh(p);a.ddlCondicionIva.swidget().value(a.dataCuenta!=null&&a.dataCuenta.juridica[0].idTipoContribuyente?a.dataCuenta.juridica[0].idTipoContribuyente.toString():"");var p=a.ddlInscripcionGanancias.swidget().initialOptions;p.dataSource.data=[{idInscripcionGanancia:1,Descripcion:"Inscripto"},{idInscripcionGanancia:0,Descripcion:"No inscripto"},{idInscripcionGanancia:2,Descripcion:"Exento"}];a.ddlInscripcionGanancias.swidget().refresh(p);a.ddlInscripcionGanancias.swidget().value(a.dataCuenta!=null&&a.dataCuenta.juridica[0].InscripcionGanancias!=null?a.dataCuenta.juridica[0].InscripcionGanancias.toString():"");var p=a.txtDomicilioLegalCalle.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].DomicilioLegalCalle)?a.dataCuenta.juridica[0].DomicilioLegalCalle:"";a.txtDomicilioLegalCalle.swidget().refresh(p);var p=a.txtDomicilioLegalNumero.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].DomicilioLegalNumero)?a.dataCuenta.juridica[0].DomicilioLegalNumero:"";a.txtDomicilioLegalNumero.swidget().refresh(p);var p=a.txtDomicilioLegalPiso.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].DomicilioLegalPiso)?a.dataCuenta.juridica[0].DomicilioLegalPiso:"";a.txtDomicilioLegalPiso.swidget().refresh(p);var p=a.txtDomicilioLegalDepartamento.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].DomicilioLegalDepartamento)?a.dataCuenta.juridica[0].DomicilioLegalDepartamento:"";a.txtDomicilioLegalDepartamento.swidget().refresh(p);var p=a.ddlDomicilioLegalPais.swidget().initialOptions;p.dataSource.data=(a.dataParametros!=null)?a.dataParametros.paises:[];p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].DomicilioLegalidPais)?a.dataCuenta.juridica[0].DomicilioLegalidPais.toString():"1";a.ddlDomicilioLegalPais.swidget().refresh(p);var p=a.txtDomicilioLegalLocalidad.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].DomicilioLegalCiudad)?a.dataCuenta.juridica[0].DomicilioLegalCiudad:"";a.txtDomicilioLegalLocalidad.swidget().refresh(p);var p=a.txtDomicilioLegalCodigoPostal.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].DomicilioLegalCodigoPostal)?a.dataCuenta.juridica[0].DomicilioLegalCodigoPostal:"";a.txtDomicilioLegalCodigoPostal.swidget().refresh(p);var u=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].DomicilioLegalTelefonoFijo)?a.dataCuenta.juridica[0].DomicilioLegalTelefonoFijo.split("-"):[];var p=a.txtTelefonoParticularArea.swidget().initialOptions;p.value=(u.length>1)?u[0]:"";a.txtTelefonoParticularArea.swidget().refresh(p);var p=a.txtTelefonoParticularNumero.swidget().initialOptions;p.value=(u.length>1)?u[1]:((u.length==1)?u[0]:"");a.txtTelefonoParticularNumero.swidget().refresh(p);var t=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].DomicilioLegalTelefonoMovil)?a.dataCuenta.juridica[0].DomicilioLegalTelefonoMovil.split("-"):[];a.ddlTelefonoCelularPais.swidget().value((t.length>0)?t[0].replaceAll("\\+",""):a.phoneCodeAr.toString());a.setTelefonoCelularControls();var p=a.txtTelefonoCelularArea.swidget().initialOptions;p.value=(t.length==3)?t[1]:"";a.txtTelefonoCelularArea.swidget().refresh(p);var p=a.txtTelefonoCelularNumero.swidget().initialOptions;p.value=(t.length==3)?t[2]:((t.length==2)?t[1]:"");a.txtTelefonoCelularNumero.swidget().refresh(p);var g=((a.dataCuenta!=null&&a.dataCuenta.juridica[0].email)?a.dataCuenta.juridica[0].email.split(","):[]);var p=a.txtEmailNotificaciones1.swidget().initialOptions;p.value=g[0]?g[0]:"";a.txtEmailNotificaciones1.swidget().refresh(p);var p=a.txtEmailNotificaciones2.swidget().initialOptions;p.value=g[1]?g[1]:"";a.txtEmailNotificaciones2.swidget().refresh(p);var p=a.txtEmailNotificaciones3.swidget().initialOptions;p.value=g[2]?g[2]:"";a.txtEmailNotificaciones3.swidget().refresh(p);var p=a.txtEmailNotificaciones4.swidget().initialOptions;p.value=g[3]?g[3]:"";a.txtEmailNotificaciones4.swidget().refresh(p);a.ddlEmailNotificacionesCantidad.swidget().value(g.length.toString());if(a.dataCuenta!=null&&a.dataCuenta.juridica[0].tributaEnOtroPais3){a.ddlCantidadResidenciasFiscales.swidget().value("3")}else{if(a.dataCuenta!=null&&a.dataCuenta.juridica[0].tributaEnOtroPais2){a.ddlCantidadResidenciasFiscales.swidget().value("2")}else{a.ddlCantidadResidenciasFiscales.swidget().value("1")}}var v=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].idTipoIdentificadorFiscal1)?$.grep(a.dataParametros.tiposIdentificadoresFiscales,function(x,i){return x.idTipoIdentificadorFiscal==a.dataCuenta.juridica[0].idTipoIdentificadorFiscal1})[0]:null;var p=a.ddlTributaPais1.swidget().initialOptions;p.dataSource.data=(a.dataParametros!=null)?a.dataParametros.paises:[];p.value=(v)?v.idPais.toString():"1";a.ddlTributaPais1.swidget().refresh(p);var v=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].idTipoIdentificadorFiscal2)?$.grep(a.dataParametros.tiposIdentificadoresFiscales,function(x,i){return x.idTipoIdentificadorFiscal==a.dataCuenta.juridica[0].idTipoIdentificadorFiscal2})[0]:null;var p=a.ddlTributaPais2.swidget().initialOptions;p.dataSource.data=(a.dataParametros!=null)?a.dataParametros.paises:[];p.value=(v)?v.idPais.toString():"1";a.ddlTributaPais2.swidget().refresh(p);var v=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].idTipoIdentificadorFiscal3)?$.grep(a.dataParametros.tiposIdentificadoresFiscales,function(x,i){return x.idTipoIdentificadorFiscal==a.dataCuenta.juridica[0].idTipoIdentificadorFiscal3})[0]:null;var p=a.ddlTributaPais3.swidget().initialOptions;p.dataSource.data=(a.dataParametros!=null)?a.dataParametros.paises:[];p.value=(v)?v.idPais.toString():"1";a.ddlTributaPais3.swidget().refresh(p);var p=a.txtTributaNit1.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].NIT1)?a.dataCuenta.juridica[0].NIT1:"";a.txtTributaNit1.swidget().refresh(p);var p=a.txtTributaNit2.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].NIT2)?a.dataCuenta.juridica[0].NIT2:"";a.txtTributaNit2.swidget().refresh(p);var p=a.txtTributaNit3.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].NIT3)?a.dataCuenta.juridica[0].NIT3:"";a.txtTributaNit3.swidget().refresh(p);var p=a.txtBeneficiarioEstadounidenseNombre1.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU1Nombre)?a.dataCuenta.juridica[0].beneficiarioEEUU1Nombre:"";a.txtBeneficiarioEstadounidenseNombre1.swidget().refresh(p);var p=a.txtBeneficiarioEstadounidenseNombre2.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU2Nombre)?a.dataCuenta.juridica[0].beneficiarioEEUU2Nombre:"";a.txtBeneficiarioEstadounidenseNombre2.swidget().refresh(p);var p=a.txtBeneficiarioEstadounidenseNombre3.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU3Nombre)?a.dataCuenta.juridica[0].beneficiarioEEUU3Nombre:"";a.txtBeneficiarioEstadounidenseNombre3.swidget().refresh(p);var p=a.txtBeneficiarioEstadounidenseNombre4.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU4Nombre)?a.dataCuenta.juridica[0].beneficiarioEEUU4Nombre:"";a.txtBeneficiarioEstadounidenseNombre4.swidget().refresh(p);var p=a.txtBeneficiarioEstadounidenseNombre5.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU5Nombre)?a.dataCuenta.juridica[0].beneficiarioEEUU5Nombre:"";a.txtBeneficiarioEstadounidenseNombre5.swidget().refresh(p);var p=a.txtBeneficiarioEstadounidenseNombre6.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU6Nombre)?a.dataCuenta.juridica[0].beneficiarioEEUU6Nombre:"";a.txtBeneficiarioEstadounidenseNombre6.swidget().refresh(p);var p=a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU1.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU1TIN)?a.dataCuenta.juridica[0].beneficiarioEEUU1TIN:"";a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU1.swidget().refresh(p);var p=a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU2.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU2TIN)?a.dataCuenta.juridica[0].beneficiarioEEUU2TIN:"";a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU2.swidget().refresh(p);var p=a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU3.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU3TIN)?a.dataCuenta.juridica[0].beneficiarioEEUU3TIN:"";a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU3.swidget().refresh(p);var p=a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU4.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU4TIN)?a.dataCuenta.juridica[0].beneficiarioEEUU4TIN:"";a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU4.swidget().refresh(p);var p=a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU5.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU5TIN)?a.dataCuenta.juridica[0].beneficiarioEEUU5TIN:"";a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU5.swidget().refresh(p);var p=a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU6.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU6TIN)?a.dataCuenta.juridica[0].beneficiarioEEUU6TIN:"";a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU6.swidget().refresh(p);a.controlBeneficiarioEstadounidensePorcentajeParticipacion1.setValue((a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU1PorcPart)?a.dataCuenta.juridica[0].beneficiarioEEUU1PorcPart:"");a.controlBeneficiarioEstadounidensePorcentajeParticipacion2.setValue((a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU2PorcPart)?a.dataCuenta.juridica[0].beneficiarioEEUU2PorcPart:"");a.controlBeneficiarioEstadounidensePorcentajeParticipacion3.setValue((a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU3PorcPart)?a.dataCuenta.juridica[0].beneficiarioEEUU3PorcPart:"");a.controlBeneficiarioEstadounidensePorcentajeParticipacion4.setValue((a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU4PorcPart)?a.dataCuenta.juridica[0].beneficiarioEEUU4PorcPart:"");a.controlBeneficiarioEstadounidensePorcentajeParticipacion5.setValue((a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU5PorcPart)?a.dataCuenta.juridica[0].beneficiarioEEUU5PorcPart:"");a.controlBeneficiarioEstadounidensePorcentajeParticipacion6.setValue((a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU6PorcPart)?a.dataCuenta.juridica[0].beneficiarioEEUU6PorcPart:"");a.chkPoseeBeneficiariosEstadounidenses.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.juridica[0].tieneBeneficiariosEstadounidenses==1)?true:false));if(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU6Nombre){a.ddlBeneficiariosEstadounidensesCantidad.swidget().value("6")}else{if(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU5Nombre){a.ddlBeneficiariosEstadounidensesCantidad.swidget().value("5")}else{if(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU4Nombre){a.ddlBeneficiariosEstadounidensesCantidad.swidget().value("4")}else{if(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU3Nombre){a.ddlBeneficiariosEstadounidensesCantidad.swidget().value("3")}else{if(a.dataCuenta!=null&&a.dataCuenta.juridica[0].beneficiarioEEUU2Nombre){a.ddlBeneficiariosEstadounidensesCantidad.swidget().value("2")}else{a.ddlBeneficiariosEstadounidensesCantidad.swidget().value("1")}}}}}var p=a.ddlCiudadaniaEEUU.swidget().initialOptions;p.dataSource.data=(a.dataParametros!=null)?a.dataParametros.TiposFATCA:[];a.ddlCiudadaniaEEUU.swidget().refresh(p);a.ddlCiudadaniaEEUU.swidget().value(a.dataCuenta!=null&&a.dataCuenta.juridica[0].idTipoFATCA?a.dataCuenta.juridica[0].idTipoFATCA.toString():"");a.chkCiudadaniaEEUUDeclaracionJurada[0].checked=(((a.dataCuenta!=null&&a.dataCuenta.juridica[0].DeclaJuradaFATCA==1)?true:false));var p=a.ddlTipoOcde.swidget().initialOptions;p.dataSource.data=(a.dataParametros!=null)?a.dataParametros.TiposOCDE:[];a.ddlTipoOcde.swidget().refresh(p);a.ddlTipoOcde.swidget().value(a.dataCuenta!=null&&a.dataCuenta.juridica[0].idTipoOCDE?a.dataCuenta.juridica[0].idTipoOCDE.toString():"");a.chkTipoOcdeDeclaracionJurada[0].checked=(((a.dataCuenta!=null&&a.dataCuenta.juridica[0].DeclaJuradaOCDE==1)?true:false));var p=a.ddlTipoInstitucionFinancieraExtranjera.swidget().initialOptions;p.dataSource.data=(a.dataParametros!=null)?a.dataParametros.TiposInstitucionesFinancierasExtranjeras:[];a.ddlTipoInstitucionFinancieraExtranjera.swidget().refresh(p);a.ddlTipoInstitucionFinancieraExtranjera.swidget().value(a.dataCuenta!=null&&a.dataCuenta.juridica[0].idInstitucionFinancieraExtranjera?a.dataCuenta.juridica[0].idInstitucionFinancieraExtranjera.toString():"");var p=a.txtInstitucionFinancieraExtranjeraGIIN.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].InstitucionFinancieraExtranjeraGIIN)?a.dataCuenta.juridica[0].InstitucionFinancieraExtranjeraGIIN:"";a.txtInstitucionFinancieraExtranjeraGIIN.swidget().refresh(p);var p=a.ddlTipoReporteDirectoIRS.swidget().initialOptions;p.dataSource.data=(a.dataParametros!=null)?a.dataParametros.TiposReportesDirectosIRS:[];a.ddlTipoReporteDirectoIRS.swidget().refresh(p);a.ddlTipoReporteDirectoIRS.swidget().value(a.dataCuenta!=null&&a.dataCuenta.juridica[0].idReporteDirectoIRS?a.dataCuenta.juridica[0].idReporteDirectoIRS.toString():"");var p=a.txtReporteDirectoIRSGIIN.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].reportaDirectoIRSGIIN)?a.dataCuenta.juridica[0].reportaDirectoIRSGIIN:"";a.txtReporteDirectoIRSGIIN.swidget().refresh(p);var p=a.txtPersonaEstadounidenseTIN.swidget().initialOptions;p.value=(a.dataCuenta!=null&&a.dataCuenta.juridica[0].esPersonaEstadounidenseTIN)?a.dataCuenta.juridica[0].esPersonaEstadounidenseTIN:"";a.txtPersonaEstadounidenseTIN.swidget().refresh(p);var p=a.ddlTipoPersonaJuridicaExenta.swidget().initialOptions;p.dataSource.data=(a.dataParametros!=null)?a.dataParametros.TiposPersonasJuridicasExentas:[];a.ddlTipoPersonaJuridicaExenta.swidget().refresh(p);a.ddlTipoPersonaJuridicaExenta.swidget().value(a.dataCuenta!=null&&a.dataCuenta.juridica[0].idPersonaJuridicaExenta?a.dataCuenta.juridica[0].idPersonaJuridicaExenta.toString():"");a.chkSujetoObligado.swidget().checked(((a.dataCuenta!=null&&a.dataCuenta.juridica[0].EsSujetoObligado)?true:false));a.controlMontoCompliance.setValue((a.dataCuenta!=null&&a.dataCuenta.juridica[0].montoCompliance)?a.dataCuenta.juridica[0].montoCompliance:"");var p=a.ddlRiesgoCliente.swidget().initialOptions;p.dataSource.data=(a.dataParametros!=null)?a.dataParametrosUsuario.riesgo:[];a.ddlRiesgoCliente.swidget().refresh(p);a.ddlRiesgoCliente.swidget().value(a.dataCuenta!=null&&a.dataCuenta.juridica[0].idRiesgo?a.dataCuenta.juridica[0].idRiesgo.toString():"");a.setControls(true);var p=a.gridPersonas.swidget().initialOptions;p.dataSource.data=a.personas;a.gridPersonas.swidget().refresh(p);var p=a.gridArchivos.swidget().initialOptions;p.dataSource.data=a.archivos;a.gridArchivos.swidget().refresh(p);a.btnConsultarMatrizRiesgo.hide();a.divCalcularMatrizRiesgo.hide();if(a.dataCuenta!=null&&a.dataCuenta.juridica[0].CUIT){if(a.dataCuenta.juridica[0].VersionMatriz&&a.dataCuenta.juridica[0].VersionMatriz>0){a.btnConsultarMatrizRiesgo.show()}else{a.divCalcularMatrizRiesgo.show()}}var p=a.gridObservaciones.swidget().initialOptions;p.dataSource.data=a.observaciones;a.gridObservaciones.swidget().refresh(p);a.divInformes.html("");if(a.dataCuenta){var q=$("<label>Resumen de la Cuenta:  </label>").appendTo(a.divInformes);if(a.dataCuenta.juridica[0].tieneNOSIS){var m=$('<button disabled type="button" title="Nosis" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/nosis-logo.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);m.css("border-color",a.dataCuenta.juridica[0].tieneNOSIS);if(a.optionsApertura&&a.optionsApertura.consultaNosis){m.removeAttr("disabled");m.on("click",function(){if(a.dataCuenta.juridica[0].CUIT){Core.Functions.ExternalServices.Nosis.showReport(m,a.dataCuenta.juridica[0].CUIT)}})}}if(a.dataCuenta.juridica[0].tieneUIF){var n=$('<button disabled type="button" title="UIF" class="btn-sm balanz-button"style="border:3px solid; background-color:#fff;"><img src="/images/uif-logo.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);n.css("border-color",a.dataCuenta.juridica[0].tieneUIF);if(a.optionsApertura&&a.optionsApertura.consultaUIF){n.removeAttr("disabled");n.on("click",function(){if(a.dataCuenta.juridica[0].CUIT){Core.Functions.ExternalServices.UIF.showReport(n,a.dataCuenta.juridica[0].CUIT)}})}}if(a.dataCuenta.datos[0].tieneDocusign){var j=$('<button disabled type="button" title="DocuSign" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="'+(a.dataCuenta.datos[0].tieneDocusign=="disabled"?"/images/docusign-logo-inactivo.png":"/images/docusign-logo.png")+'" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);j.css("border-color",(a.dataCuenta.datos[0].tieneDocusign=="disabled"?"lightgray":a.dataCuenta.datos[0].tieneDocusign));if(a.optionsApertura&&a.optionsApertura.consultaDocusign&&a.dataCuenta.datos[0].tieneDocusign!="disabled"){j.removeAttr("disabled");j.on("click",function(){if(a.dataCuenta!=null){Core.Functions.ExternalServices.DocuSign.showReport(j,a.dataCuenta.datos[0].idAperturaCuenta)}})}}var k=$('<button type="button" title="Google" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/google-logo.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);k.css("border-color","lightgreen");k.on("click",function(){a.openUrlGoogle(a.dataCuenta.juridica[0].RazonSocial+" "+a.dataCuenta.juridica[0].CUIT)});if(a.aperturaCuenta&&a.aperturaCuenta.motorDecision){var l=$('<button style="border:3px solid; background-color:transparent; border-color:transparent;" type="button" title="Motor decisión" class="btn-sm balanz-button"></button>').appendTo(a.divInformes);var o=$('<img src="/images/circ-trans.png" style="width:20px; height:20px;" />').appendTo(l);o.css("background-color",a.aperturaCuenta.motorDecision);l.on("click",function(){Core.Functions.ExternalServices.MotorDecision.showReport(l,a.idAperturaCuenta)})}}if(a.namespaceActivo=="Legajos"||a.namespaceActivo=="OpenManagerAltaCuenta"){var f=(a.dataCuenta!=null&&a.dataCuenta.datos[0].NumComitente)?("Comitente: "+a.dataCuenta.datos[0].NumComitente):"";f+=(a.dataCuenta!=null&&a.dataCuenta.datos[0].NumCuotapartista)?((f?" || ":"")+("Cuotapartista: "+a.dataCuenta.datos[0].NumCuotapartista)):"";a.lblComitenteCuotapartistaCuenta.text(f);a.lblDescripcionCuenta.text((a.dataCuenta!=null&&a.dataCuenta.datos[0].DescripcionCuenta)?a.dataCuenta.datos[0].DescripcionCuenta:"");a.divDescripcionCuenta.show();a.divComitenteCuotapartistaCuenta.show()}};a.openUrlGoogle=function(d){var e="http://www.google.com/search?q="+d;window.open(e,"_blank");overlay=new Core.Controls.Overlay(a.btnAgregarArchivo,{});var c=new XMLHttpRequest();c.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"webshot?url="+encodeURIComponent(encodeURIComponent(e)),true);c.responseType="blob";c.setRequestHeader("Content-Type","application/json;charset=UTF-8");c.setRequestHeader("Authorization",Core.Objects.Context.Token);c.onerror=function(f){var g=new Core.Controls.Dialog("Error","No se ha podido descargar la imagen",{displayButtons:{close:true,accept:false}});g.show();overlay.destroy();return};c.onload=function(f){if(c.status==200){var i=new XMLHttpRequest();i.onload=function(k){var j=new Core.Controls.ManagerAltaCuentaNuevoArchivo({onSave:function(m){a.archivos.push({urlArchivo:m.file.urlArchivo,idTipoArchivo:m.idTipoArchivo,Tipo:m.Tipo,Fecha:m.Fecha,Comentario:m.comentarios});var l=a.gridArchivos.swidget().initialOptions;l.dataSource.data=a.archivos;a.gridArchivos.swidget().refresh(l)},tiposArchivos:((a.dataParametros!=null)?$.grep(a.dataParametros.TiposArchivos,function(m,l){return m.Juridica&&m.BCV}):[]),idTipoArchivoDefault:"7",comentariosDefault:"Google Search "+d,file:JSON.parse(i.responseText)}).show();overlay.destroy()};i.onerror=function(j){var k=new Core.Controls.Dialog("Error","No se ha podido adjuntar la foto",{displayButtons:{close:true,accept:false}});k.show();overlay.destroy();return};var h=new Blob([c.response],{type:"image/png"});i.open("POST",Core.Origin+Core.PrefixUrl+"upload/documento/7",true);i.setRequestHeader("Authorization",Core.Objects.Context.Token);i.setRequestHeader("Accept","application/json");i.setRequestHeader("Content-Type","image/png");i.send(h)}else{var g=new Core.Controls.Dialog("Error","No se ha podido descargar la imagen",{displayButtons:{close:true,accept:false}});g.show();overlay.destroy()}};c.send()};a.getRequestData=function(){Core.Functions.Validations.toggleValidation(a.ddlEstado,false);Core.Functions.Validations.toggleValidation(a.ddlAsesor,false);Core.Functions.Validations.toggleValidation(a.txtOrigenPatrimonioOtroDetalle,false);Core.Functions.Validations.toggleValidation(a.txtCanalOtroDetalle,false);Core.Functions.Validations.toggleValidation(a.ddlArancel,false);Core.Functions.Validations.toggleValidation(a.txtComoLlegoABalanz,false);Core.Functions.Validations.toggleValidation(a.txtUsuarioAsignado,false);Core.Functions.Validations.toggleValidation(a.txtTipoInversionOtroDetalle,false);Core.Functions.Validations.toggleValidation(a.txtPlazoInversion,false);Core.Functions.Validations.toggleValidation(a.txtDescripcionActividadCliente,false);Core.Functions.Validations.toggleValidation(a.txtIngresoAsesorFinanciero,false);Core.Functions.Validations.toggleValidation(a.ddlPaisTipoIdentificacionFiscal,false);Core.Functions.Validations.toggleValidation(a.ddlTipoIdentificacionFiscal,false);Core.Functions.Validations.toggleValidation(a.txtIdentificacionFiscal,false);Core.Functions.Validations.toggleValidation(a.txtRazonSocial,false);Core.Functions.Validations.toggleValidation(a.ddlNacionalidad,false);Core.Functions.Validations.toggleValidation(a.ddlLugarConstitucion,false);Core.Functions.Validations.toggleValidation(a.ddlTipoPersonaJuridica,false);Core.Functions.Validations.toggleValidation(a.ddlTipoRegistracionJuridica,false);Core.Functions.Validations.toggleValidation(a.txtNumeroInscripcion,false);Core.Functions.Validations.toggleValidation(a.txtFechaConstitucion,false);Core.Functions.Validations.toggleValidation(a.txtLibro,false);Core.Functions.Validations.toggleValidation(a.txtTomo,false);Core.Functions.Validations.toggleValidation(a.ddlActividadPrincipal,false);Core.Functions.Validations.toggleValidation(a.txtActividadPrincipalOtro,false);Core.Functions.Validations.toggleValidation(a.txtSegmentoInversion,false);Core.Functions.Validations.toggleValidation(a.txtNumeroAseguradora,false);Core.Functions.Validations.toggleValidation(a.ddlCondicionIva,false);Core.Functions.Validations.toggleValidation(a.ddlInscripcionGanancias,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioLegalCalle,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioLegalNumero,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioLegalPiso,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioLegalDepartamento,false);Core.Functions.Validations.toggleValidation(a.ddlDomicilioLegalPais,false);Core.Functions.Validations.toggleValidation(a.ddlDomicilioLegalProvincia,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioLegalLocalidad,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioLegalCodigoPostal,false);Core.Functions.Validations.toggleValidation(a.ddlEmailNotificacionesCantidad,false);Core.Functions.Validations.toggleValidation(a.txtEmailNotificaciones1,false);Core.Functions.Validations.toggleValidation(a.txtEmailNotificaciones2,false);Core.Functions.Validations.toggleValidation(a.txtEmailNotificaciones3,false);Core.Functions.Validations.toggleValidation(a.txtEmailNotificaciones4,false);Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularArea,false);Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularNumero,false);Core.Functions.Validations.toggleValidation(a.ddlTelefonoCelularPais,false);Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularArea,false);Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularNumero,false);Core.Functions.Validations.toggleValidation(a.ddlTributaPais1,false);Core.Functions.Validations.toggleValidation(a.ddlTributaPais2,false);Core.Functions.Validations.toggleValidation(a.ddlTributaPais3,false);Core.Functions.Validations.toggleValidation(a.txtTributaNit1,false);Core.Functions.Validations.toggleValidation(a.txtTributaNit2,false);Core.Functions.Validations.toggleValidation(a.txtTributaNit3,false);Core.Functions.Validations.toggleValidation(a.ddlTributaTipoIdentificadorFiscal1,false);Core.Functions.Validations.toggleValidation(a.ddlTributaTipoIdentificadorFiscal2,false);Core.Functions.Validations.toggleValidation(a.ddlTributaTipoIdentificadorFiscal3,false);Core.Functions.Validations.toggleValidation(a.ddlCantidadResidenciasFiscales,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseNombre1,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseNombre2,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseNombre3,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseNombre4,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseNombre5,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseNombre6,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU1,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU2,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU3,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU4,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU5,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU6,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion1,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion2,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion3,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion4,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion5,false);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion6,false);Core.Functions.Validations.toggleValidation(a.ddlBeneficiariosEstadounidensesCantidad,false);Core.Functions.Validations.toggleValidation(a.ddlTipoInstitucionFinancieraExtranjera,false);Core.Functions.Validations.toggleValidation(a.txtInstitucionFinancieraExtranjeraGIIN,false);Core.Functions.Validations.toggleValidation(a.ddlTipoReporteDirectoIRS,false);Core.Functions.Validations.toggleValidation(a.txtReporteDirectoIRSGIIN,false);Core.Functions.Validations.toggleValidation(a.txtPersonaEstadounidenseTIN,false);Core.Functions.Validations.toggleValidation(a.ddlTipoPersonaJuridicaExenta,false);Core.Functions.Validations.toggleValidation(a.ddlCiudadaniaEEUU,false);Core.Functions.Validations.toggleValidation(a.ddlTipoOcde,false);a.divAlert.slideUp();if(!a.dataCuenta||!a.ddlEstado.swidget().selectedItem()||(a.ddlEstado.swidget().selectedItem().idTipoValidacion==0)){return a.getRequestDataNoValidated()}else{return a.getRequestDataValidated()}};a.getRequestDataNoValidated=function(){var d={value:true};var c={};c.EsJuridica=1;c.tipoFirma=a.getSelectedTipoFirma();c.patrimonioActividadPrincipal=a.chkOrigenPatrimonioActividadPrincipal.swidget().checked()?1:0;c.patrimonioVentaDeBienes=a.chkOrigenPatrimonioVentaBienes.swidget().checked()?1:0;c.patrimonioOtro=a.getOrigenPatrimonioOtro();c.idCanal=a.getSelectedCanal();if(c.idCanal==Core.Business.eCanal.Otro){c.canalOtro=a.getCanalOtro()}c.comoLlegoABalanz=a.txtComoLlegoABalanz.val();c.descripcionActividadCliente=a.txtDescripcionActividadCliente.val();c.usuarioAsignado=a.txtUsuarioAsignado.val();c.tipoInversionAcciones=a.chkTipoInversionAcciones.swidget().checked()?1:0;c.tipoInversionTitulosPublicos=a.chkTipoInversionTitulosPublicos.swidget().checked()?1:0;c.tipoInversionFideicomisos=a.chkTipoInversionFideicomisos.swidget().checked()?1:0;c.tipoInversionOpciones=a.chkTipoInversionOpciones.swidget().checked()?1:0;c.tipoInversionFondos=a.chkTipoInversionFondos.swidget().checked()?1:0;c.tipoInversionOperacionesCambioUSD=a.chkTipoInversionOperacionesCambioUSD.swidget().checked()?1:0;c.tipoInversionObligacionesNegociables=a.chkTipoInversionObligacionesNegociables.swidget().checked()?1:0;c.tipoInversionFuturos=a.chkTipoInversionFuturos.swidget().checked()?1:0;c.tipoInversionChequePagoDiferido=a.chkTipoInversionChequePagoDiferido.swidget().checked()?1:0;c.tipoInversionOtros=a.getTipoInversionOtro();c.plazoAproxInversion=a.txtPlazoInversion.val();c.idArancel=((a.ddlArancel.swidget().selectedItem())?a.ddlArancel.swidget().selectedItem().idArancel:null);c.idPersonaAsesor=((a.ddlAsesor.swidget().selectedItem())?a.ddlAsesor.swidget().selectedItem().idPersona:null);c.UsarFirmaDigital=a.chkUsarFirmaDigital.swidget().checked()?1:0;if(a.dataCuenta!=null){c.idEstadoAperturaCuenta=((a.ddlEstado.swidget().selectedItem())?a.ddlEstado.swidget().selectedItem().idEstadoAperturaCuenta:null);c.idAperturaCuenta=a.dataCuenta.datos[0].idAperturaCuenta;c.version=a.dataCuenta.datos[0].version;c.hash=a.dataCuenta.datos[0].hash;c.AceptoTyC=a.dataCuenta.datos[0].AceptoTyC;c.idPaso=a.dataCuenta.datos[0].idPaso;c.idSubPaso=a.dataCuenta.datos[0].idSubPaso;c.nombreOriginal=a.dataCuenta.datos[0].nombreOriginal;c.emailOriginal=a.dataCuenta.datos[0].emailOriginal;c.idCuentaExistente=a.dataCuenta.datos[0].idCuentaExistente;c.idExterno=a.dataCuenta.datos[0].idExterno;c.AceptoMandatoDiscrecional=a.dataCuenta.datos[0].AceptoMandatoDiscrecional;c.SolicitarMandatoDiscrecional=a.dataCuenta.datos[0].SolicitarMandatoDiscrecional}c.juridica=a.dataCuenta!=null&&a.dataCuenta.juridica?a.dataCuenta.juridica:[{}];c.juridica[0].idMontoAInvertirJuridica=a.getSelectedMontoAInvertir();c.juridica[0].idTipoIdentificadorFiscal=((a.ddlTipoIdentificacionFiscal.swidget().selectedItem())?a.ddlTipoIdentificacionFiscal.swidget().selectedItem().idTipoIdentificadorFiscal:null);c.juridica[0].CUIT=a.txtIdentificacionFiscal.val();c.juridica[0].RazonSocial=a.txtRazonSocial.val();c.juridica[0].Nacionalidad=((a.ddlNacionalidad.swidget().selectedItem())?a.ddlNacionalidad.swidget().selectedItem().idPais:null);c.juridica[0].LugarConstitucion=((a.ddlLugarConstitucion.swidget().selectedItem())?a.ddlLugarConstitucion.swidget().selectedItem().Nombre:null);c.juridica[0].idTipoPersonaJuridica=((a.ddlTipoPersonaJuridica.swidget().selectedItem())?a.ddlTipoPersonaJuridica.swidget().selectedItem().idTipoPersonaJuridica:null);c.juridica[0].idTipoRegistracionJuridica=((a.ddlTipoRegistracionJuridica.swidget().selectedItem())?a.ddlTipoRegistracionJuridica.swidget().selectedItem().idTipoRegistracionJuridica:null);c.juridica[0].NroInscripcion=a.txtNumeroInscripcion.val();c.juridica[0].FechaConstitucion=Core.Functions.Date.getDateAsString(a.txtFechaConstitucion.swidget().value());c.juridica[0].Libro=a.txtLibro.val();c.juridica[0].Tomo=a.txtTomo.val();c.juridica[0].idActividadJuridica=((a.ddlActividadPrincipal.swidget().selectedItem())?a.ddlActividadPrincipal.swidget().selectedItem().idActividadJuridica:null);if(a.ddlActividadPrincipal.swidget().selectedItem()&&a.ddlActividadPrincipal.swidget().selectedItem().idActividadJuridica==Core.Business.eActividadPrincipalJuridica.Otro){c.juridica[0].OcupacionDescripcion=a.txtActividadPrincipalOtro.val()}if(a.ddlActividadPrincipal.swidget().selectedItem()&&a.ddlActividadPrincipal.swidget().selectedItem().TipoCampoAdicional==1){c.juridica[0].SegmentoInversion=a.txtSegmentoInversion.val();c.juridica[0].NroAseguradora=a.txtNumeroAseguradora.val()}c.juridica[0].idTipoContribuyente=((a.ddlCondicionIva.swidget().selectedItem())?a.ddlCondicionIva.swidget().selectedItem().idTipoContribuyente:null);c.juridica[0].InscripcionGanancias=((a.ddlInscripcionGanancias.swidget().selectedItem())?a.ddlInscripcionGanancias.swidget().selectedItem().idInscripcionGanancia:null);c.juridica[0].EsSujetoObligado=a.chkSujetoObligado.swidget().checked()?1:0;c.juridica[0].DomicilioLegalCalle=a.txtDomicilioLegalCalle.val();c.juridica[0].DomicilioLegalNumero=a.txtDomicilioLegalNumero.val();c.juridica[0].DomicilioLegalPiso=a.txtDomicilioLegalPiso.val();c.juridica[0].DomicilioLegalDepartamento=a.txtDomicilioLegalDepartamento.val();c.juridica[0].DomicilioLegalidPais=((a.ddlDomicilioLegalPais.swidget().selectedItem())?a.ddlDomicilioLegalPais.swidget().selectedItem().idPais:null);c.juridica[0].DomicilioLegalidProvincia=((a.ddlDomicilioLegalProvincia.swidget().selectedItem())?a.ddlDomicilioLegalProvincia.swidget().selectedItem().idProvincia:null);c.juridica[0].DomicilioLegalCiudad=a.txtDomicilioLegalLocalidad.val();c.juridica[0].DomicilioLegalCodigoPostal=a.txtDomicilioLegalCodigoPostal.val();c.juridica[0].email="";if(a.ddlEmailNotificacionesCantidad.swidget().selectedItem()){if(a.ddlEmailNotificacionesCantidad.swidget().selectedItem().value>=1){c.juridica[0].email=a.txtEmailNotificaciones1.val()}if(a.ddlEmailNotificacionesCantidad.swidget().selectedItem().value>=2){c.juridica[0].email+=(","+a.txtEmailNotificaciones2.val())}if(a.ddlEmailNotificacionesCantidad.swidget().selectedItem().value>=3){c.juridica[0].email+=(","+a.txtEmailNotificaciones3.val())}if(a.ddlEmailNotificacionesCantidad.swidget().selectedItem().value==4){c.juridica[0].email+=(","+a.txtEmailNotificaciones4.val())}}c.juridica[0].DomicilioLegalTelefonoFijo=a.txtTelefonoParticularArea.swidget().value()+"-"+a.txtTelefonoParticularNumero.swidget().value();if((a.txtTelefonoParticularArea.swidget().value()||a.txtTelefonoParticularNumero.swidget().value())&&!a.isValidPhone(c.juridica[0].DomicilioLegalTelefonoFijo)){Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularArea,true);Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularNumero,true);d.value=false;a.divAlert.text("El teléfono ingresado no es válido.");a.divAlert.slideDown()}if(a.txtTelefonoParticularArea.swidget().value()&&!Core.Functions.Validations.isNumeric(a.txtTelefonoParticularArea.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularArea,true);d.value=false;if(a.txtTelefonoParticularArea.swidget().value()){a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}}if(a.txtTelefonoParticularNumero.swidget().value()&&!Core.Functions.Validations.isNumeric(a.txtTelefonoParticularNumero.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularNumero,true);d.value=false;if(a.txtTelefonoParticularNumero.swidget().value()){a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}}if(a.ddlTelefonoCelularPais.swidget().selectedItem()!=null&&a.ddlTelefonoCelularPais.swidget().selectedItem().value==a.phoneCodeAr){c.juridica[0].DomicilioLegalTelefonoMovil="+"+a.ddlTelefonoCelularPais.swidget().selectedItem().value+"-"+a.txtTelefonoCelularArea.swidget().value()+"-"+a.txtTelefonoCelularNumero.swidget().value()}else{c.juridica[0].DomicilioLegalTelefonoMovil="+"+a.ddlTelefonoCelularPais.swidget().selectedItem().value+"-"+a.txtTelefonoCelularNumero.swidget().value()}if(((a.ddlTelefonoCelularPais.swidget().selectedItem().value==a.phoneCodeAr&&a.txtTelefonoCelularArea.swidget().value())||a.txtTelefonoCelularNumero.swidget().value())&&!a.isValidPhone(c.juridica[0].DomicilioLegalTelefonoMovil)){Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularArea,true);Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularNumero,true);d.value=false;a.divAlert.text("El teléfono ingresado no es válido.");a.divAlert.slideDown()}if(a.ddlTelefonoCelularPais.swidget().selectedItem().value==a.phoneCodeAr&&(a.txtTelefonoCelularArea.swidget().value()&&!Core.Functions.Validations.isNumeric(a.txtTelefonoCelularArea.swidget().value()))){Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularArea,true);d.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(a.txtTelefonoCelularNumero.swidget().value()&&!Core.Functions.Validations.isNumeric(a.txtTelefonoCelularNumero.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularNumero,true);d.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}c.juridica[0].tributaEnOtroPais1=0;c.juridica[0].tributaEnOtroPais2=0;c.juridica[0].tributaEnOtroPais3=0;if(a.ddlCantidadResidenciasFiscales.swidget().selectedItem()){if(a.ddlCantidadResidenciasFiscales.swidget().selectedItem().value>=1){c.juridica[0].idTipoIdentificadorFiscal1=((a.ddlTributaTipoIdentificadorFiscal1.swidget().selectedItem())?a.ddlTributaTipoIdentificadorFiscal1.swidget().selectedItem().idTipoIdentificadorFiscal:null);c.juridica[0].NIT1=a.txtTributaNit1.val();c.juridica[0].tributaEnOtroPais1=1}if(a.ddlCantidadResidenciasFiscales.swidget().selectedItem().value>=2){c.juridica[0].idTipoIdentificadorFiscal2=((a.ddlTributaTipoIdentificadorFiscal2.swidget().selectedItem())?a.ddlTributaTipoIdentificadorFiscal2.swidget().selectedItem().idTipoIdentificadorFiscal:null);c.juridica[0].NIT2=a.txtTributaNit2.val();c.juridica[0].tributaEnOtroPais2=1}if(a.ddlCantidadResidenciasFiscales.swidget().selectedItem().value>=3){c.juridica[0].idTipoIdentificadorFiscal3=((a.ddlTributaTipoIdentificadorFiscal3.swidget().selectedItem())?a.ddlTributaTipoIdentificadorFiscal3.swidget().selectedItem().idTipoIdentificadorFiscal:null);c.juridica[0].NIT3=a.txtTributaNit3.val();c.juridica[0].tributaEnOtroPais3=1}}c.juridica[0].idTipoOCDE=((a.ddlTipoOcde.swidget().selectedItem())?a.ddlTipoOcde.swidget().selectedItem().idTipoOCDE:null);c.juridica[0].idTipoFATCA=((a.ddlCiudadaniaEEUU.swidget().selectedItem())?a.ddlCiudadaniaEEUU.swidget().selectedItem().idTipoFATCA:null);if(a.ddlCiudadaniaEEUU.swidget().selectedItem()){if(a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==1||a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==5){c.juridica[0].tieneBeneficiariosEstadounidenses=a.chkPoseeBeneficiariosEstadounidenses.swidget().checked()?1:0;if(a.chkPoseeBeneficiariosEstadounidenses.swidget().checked()){if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem()){if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=1){c.juridica[0].beneficiarioEEUU1Nombre=a.txtBeneficiarioEstadounidenseNombre1.val();c.juridica[0].beneficiarioEEUU1TIN=a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU1.val();c.juridica[0].beneficiarioEEUU1PorcPart=Core.Functions.Decimal.parseFloat(a.txtBeneficiarioEstadounidensePorcentajeParticipacion1.val())}if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=2){c.juridica[0].beneficiarioEEUU2Nombre=a.txtBeneficiarioEstadounidenseNombre2.val();c.juridica[0].beneficiarioEEUU2TIN=a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU2.val();c.juridica[0].beneficiarioEEUU2PorcPart=Core.Functions.Decimal.parseFloat(a.txtBeneficiarioEstadounidensePorcentajeParticipacion2.val())}if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=3){c.juridica[0].beneficiarioEEUU3Nombre=a.txtBeneficiarioEstadounidenseNombre3.val();c.juridica[0].beneficiarioEEUU3TIN=a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU3.val();c.juridica[0].beneficiarioEEUU3PorcPart=Core.Functions.Decimal.parseFloat(a.txtBeneficiarioEstadounidensePorcentajeParticipacion3.val())}if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=4){c.juridica[0].beneficiarioEEUU4Nombre=a.txtBeneficiarioEstadounidenseNombre4.val();c.juridica[0].beneficiarioEEUU4TIN=a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU4.val();c.juridica[0].beneficiarioEEUU4PorcPart=Core.Functions.Decimal.parseFloat(a.txtBeneficiarioEstadounidensePorcentajeParticipacion4.val())}if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=5){c.juridica[0].beneficiarioEEUU5Nombre=a.txtBeneficiarioEstadounidenseNombre5.val();c.juridica[0].beneficiarioEEUU5TIN=a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU5.val();c.juridica[0].beneficiarioEEUU5PorcPart=Core.Functions.Decimal.parseFloat(a.txtBeneficiarioEstadounidensePorcentajeParticipacion5.val())}if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=6){c.juridica[0].beneficiarioEEUU6Nombre=a.txtBeneficiarioEstadounidenseNombre6.val();c.juridica[0].beneficiarioEEUU6TIN=a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU6.val();c.juridica[0].beneficiarioEEUU6PorcPart=Core.Functions.Decimal.parseFloat(a.txtBeneficiarioEstadounidensePorcentajeParticipacion6.val())}}}}if(a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==2){c.juridica[0].idInstitucionFinancieraExtranjera=((a.ddlTipoInstitucionFinancieraExtranjera.swidget().selectedItem())?a.ddlTipoInstitucionFinancieraExtranjera.swidget().selectedItem().idTipoInstitucionFinancieraExtranjera:null);c.juridica[0].InstitucionFinancieraExtranjeraGIIN=a.txtInstitucionFinancieraExtranjeraGIIN.val()}if(a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==3){c.juridica[0].idPersonaJuridicaExenta=((a.ddlTipoPersonaJuridicaExenta.swidget().selectedItem())?a.ddlTipoPersonaJuridicaExenta.swidget().selectedItem().idPersonaJuridicaExenta:null)}if(a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==4){c.juridica[0].idReporteDirectoIRS=((a.ddlTipoReporteDirectoIRS.swidget().selectedItem())?a.ddlTipoReporteDirectoIRS.swidget().selectedItem().idReporteDirectoIRS:null);c.juridica[0].reportaDirectoIRSGIIN=a.txtReporteDirectoIRSGIIN.val()}if(a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==5){c.juridica[0].esPersonaEstadounidenseTIN=a.txtPersonaEstadounidenseTIN.val()}}if(Core.Objects.Context.Configuration.idAplicacion==3){c.juridica[0].montoCompliance=a.txtMontoCompliance.val();c.juridica[0].idRiesgo=a.ddlRiesgoCliente.swidget().value()}else{c.juridica[0].montoCompliance=a.dataCuenta!=null?a.dataCuenta.juridica[0].montoCompliance:"";c.juridica[0].idRiesgo=a.dataCuenta!=null?a.dataCuenta.juridica[0].idRiesgo:null}c.personas=a.personas;c.archivos=a.archivos;c.observaciones=a.observaciones;c.contactoOriginal=a.chkIngresoAsesorFinanciero.swidget().checked()?a.txtIngresoAsesorFinanciero.val():"";c.cuentaComitente=a.chkCuentasComitente.swidget().checked()?1:0;c.cuentaCuotapartista=a.chkCuentasCuotapartista.swidget().checked()?1:0;if(d.value){return c}else{return null}};a.getRequestDataValidated=function(){var g={value:true};var f={};f.EsJuridica=1;f.tipoFirma=a.getSelectedTipoFirma(g);f.patrimonioActividadPrincipal=a.chkOrigenPatrimonioActividadPrincipal.swidget().checked()?1:0;f.patrimonioVentaDeBienes=a.chkOrigenPatrimonioVentaBienes.swidget().checked()?1:0;f.patrimonioOtro=a.getOrigenPatrimonioOtro(g);f.idCanal=a.getSelectedCanal(g);if(f.idCanal==Core.Business.eCanal.Otro){f.canalOtro=a.getCanalOtro(g)}f.comoLlegoABalanz=Core.Functions.Validations.getValidatedSwidgetValue(a.txtComoLlegoABalanz,g);f.descripcionActividadCliente=Core.Functions.Validations.getValidatedSwidgetValue(a.txtDescripcionActividadCliente,g);f.usuarioAsignado=a.txtUsuarioAsignado.val();f.tipoInversionAcciones=a.chkTipoInversionAcciones.swidget().checked()?1:0;f.tipoInversionTitulosPublicos=a.chkTipoInversionTitulosPublicos.swidget().checked()?1:0;f.tipoInversionFideicomisos=a.chkTipoInversionFideicomisos.swidget().checked()?1:0;f.tipoInversionOpciones=a.chkTipoInversionOpciones.swidget().checked()?1:0;f.tipoInversionFondos=a.chkTipoInversionFondos.swidget().checked()?1:0;f.tipoInversionOperacionesCambioUSD=a.chkTipoInversionOperacionesCambioUSD.swidget().checked()?1:0;f.tipoInversionObligacionesNegociables=a.chkTipoInversionObligacionesNegociables.swidget().checked()?1:0;f.tipoInversionFuturos=a.chkTipoInversionFuturos.swidget().checked()?1:0;f.tipoInversionChequePagoDiferido=a.chkTipoInversionChequePagoDiferido.swidget().checked()?1:0;f.tipoInversionOtros=a.getTipoInversionOtro(g);f.plazoAproxInversion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtPlazoInversion,g);f.idPersonaAsesor=Core.Functions.Validations.getValidatedDropDownValue(a.ddlAsesor,g);f.idArancel=(a.chkCuentasComitente.swidget().checked()?Core.Functions.Validations.getValidatedDropDownValue(a.ddlArancel,g):((a.ddlArancel.swidget().selectedItem())?a.ddlArancel.swidget().selectedItem().idArancel:null));f.UsarFirmaDigital=a.chkUsarFirmaDigital.swidget().checked()?1:0;if(a.dataCuenta!=null){f.idEstadoAperturaCuenta=Core.Functions.Validations.getValidatedDropDownValue(a.ddlEstado,g);f.idAperturaCuenta=a.dataCuenta.datos[0].idAperturaCuenta;f.version=a.dataCuenta.datos[0].version;f.hash=a.dataCuenta.datos[0].hash;f.AceptoTyC=a.dataCuenta.datos[0].AceptoTyC;f.idPaso=a.dataCuenta.datos[0].idPaso;f.idSubPaso=a.dataCuenta.datos[0].idSubPaso;f.nombreOriginal=a.dataCuenta.datos[0].nombreOriginal;f.emailOriginal=a.dataCuenta.datos[0].emailOriginal;f.idCuentaExistente=a.dataCuenta.datos[0].idCuentaExistente;f.idExterno=a.dataCuenta.datos[0].idExterno;f.AceptoMandatoDiscrecional=a.dataCuenta.datos[0].AceptoMandatoDiscrecional;f.SolicitarMandatoDiscrecional=a.dataCuenta.datos[0].SolicitarMandatoDiscrecional}if(!f.tipoInversionAcciones&&!f.tipoInversionTitulosPublicos&&!f.tipoInversionFideicomisos&&!f.tipoInversionOpciones&&!f.tipoInversionFondos&&!f.tipoInversionOtros&&!f.tipoInversionChequePagoDiferido&&!f.tipoInversionFuturos&&!f.tipoInversionObligacionesNegociables&&!f.tipoInversionOperacionesCambioUSD){g.value=false;a.divAlert.text("Debe seleccionar el tipo de inversión.");a.divAlert.slideDown()}if(a.chkIngresoAsesorFinanciero.swidget().checked()&&(!a.txtIngresoAsesorFinanciero.val()||!a.isValidEmailAddress(a.txtIngresoAsesorFinanciero.val()))){g.value=false;a.divAlert.text("Debe ingresar el email del contacto.");a.divAlert.slideDown()}else{f.contactoOriginal=a.chkIngresoAsesorFinanciero.swidget().checked()?a.txtIngresoAsesorFinanciero.val():""}if(!a.chkCuentasComitente.swidget().checked()&&!a.chkCuentasCuotapartista.swidget().checked()){g.value=false;a.divAlert.text("Debe seleccionar el tipo de cuenta.");a.divAlert.slideDown()}else{f.cuentaComitente=a.chkCuentasComitente.swidget().checked()?1:0;f.cuentaCuotapartista=a.chkCuentasCuotapartista.swidget().checked()?1:0}f.juridica=a.dataCuenta!=null&&a.dataCuenta.juridica?a.dataCuenta.juridica:[{}];f.juridica[0].idMontoAInvertirJuridica=a.getSelectedMontoAInvertir(g);f.juridica[0].idTipoIdentificadorFiscal=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoIdentificacionFiscal,g);f.juridica[0].CUIT=Core.Functions.Validations.getValidatedSwidgetValue(a.txtIdentificacionFiscal,g);if(a.ddlPaisTipoIdentificacionFiscal.swidget().value()==a.idPais_Argentina&&(!Core.Functions.Validations.isNumeric(a.txtIdentificacionFiscal.val())||!Core.Functions.Validations.isCuit(a.txtIdentificacionFiscal.val()))){Core.Functions.Validations.toggleValidation(a.txtIdentificacionFiscal,true);g.value=false;a.divAlert.text("Debe ingresar un identificador fiscal válido.");a.divAlert.slideDown()}f.juridica[0].RazonSocial=Core.Functions.Validations.getValidatedSwidgetValue(a.txtRazonSocial,g);f.juridica[0].Nacionalidad=Core.Functions.Validations.getValidatedDropDownValue(a.ddlNacionalidad,g);f.juridica[0].LugarConstitucion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlLugarConstitucion,g);f.juridica[0].idTipoPersonaJuridica=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoPersonaJuridica,g);f.juridica[0].idTipoRegistracionJuridica=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoRegistracionJuridica,g);f.juridica[0].NroInscripcion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtNumeroInscripcion,g);f.juridica[0].FechaConstitucion=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaConstitucion,g));f.juridica[0].Libro=Core.Functions.Validations.getValidatedSwidgetValue(a.txtLibro,g);f.juridica[0].Tomo=Core.Functions.Validations.getValidatedSwidgetValue(a.txtTomo,g);f.juridica[0].idActividadJuridica=Core.Functions.Validations.getValidatedDropDownValue(a.ddlActividadPrincipal,g);if(a.ddlActividadPrincipal.swidget().selectedItem()&&a.ddlActividadPrincipal.swidget().selectedItem().idActividadJuridica==Core.Business.eActividadPrincipalJuridica.Otro){f.juridica[0].OcupacionDescripcion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtActividadPrincipalOtro,g)}if(a.ddlActividadPrincipal.swidget().selectedItem()&&a.ddlActividadPrincipal.swidget().selectedItem().TipoCampoAdicional==1){f.juridica[0].SegmentoInversion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtSegmentoInversion,g);f.juridica[0].NroAseguradora=Core.Functions.Validations.getValidatedSwidgetValue(a.txtNumeroAseguradora,g)}f.juridica[0].idTipoContribuyente=Core.Functions.Validations.getValidatedDropDownValue(a.ddlCondicionIva,g);f.juridica[0].InscripcionGanancias=((a.ddlInscripcionGanancias.swidget().selectedItem())?a.ddlInscripcionGanancias.swidget().selectedItem().idInscripcionGanancia:null);if(!a.ddlInscripcionGanancias.swidget().selectedItem()){g.value=false;Core.Functions.Validations.toggleValidation(a.ddlInscripcionGanancias,true)}f.juridica[0].EsSujetoObligado=a.chkSujetoObligado.swidget().checked()?1:0;f.juridica[0].DomicilioLegalCalle=Core.Functions.Validations.getValidatedSwidgetValue(a.txtDomicilioLegalCalle,g);f.juridica[0].DomicilioLegalNumero=Core.Functions.Validations.getValidatedSwidgetValue(a.txtDomicilioLegalNumero,g);f.juridica[0].DomicilioLegalPiso=a.txtDomicilioLegalPiso.val();f.juridica[0].DomicilioLegalDepartamento=a.txtDomicilioLegalDepartamento.val();f.juridica[0].DomicilioLegalidPais=Core.Functions.Validations.getValidatedDropDownValue(a.ddlDomicilioLegalPais,g);f.juridica[0].DomicilioLegalidProvincia=Core.Functions.Validations.getValidatedDropDownValue(a.ddlDomicilioLegalProvincia,g);f.juridica[0].DomicilioLegalCiudad=Core.Functions.Validations.getValidatedSwidgetValue(a.txtDomicilioLegalLocalidad,g);f.juridica[0].DomicilioLegalCodigoPostal=Core.Functions.Validations.getValidatedSwidgetValue(a.txtDomicilioLegalCodigoPostal,g);f.juridica[0].email="";if(a.ddlEmailNotificacionesCantidad.swidget().selectedItem()){if(a.ddlEmailNotificacionesCantidad.swidget().selectedItem().value>=1){f.juridica[0].email=Core.Functions.Validations.getValidatedSwidgetValue(a.txtEmailNotificaciones1,g)}if(a.ddlEmailNotificacionesCantidad.swidget().selectedItem().value>=2){f.juridica[0].email+=(","+Core.Functions.Validations.getValidatedSwidgetValue(a.txtEmailNotificaciones2,g))}if(a.ddlEmailNotificacionesCantidad.swidget().selectedItem().value>=3){f.juridica[0].email+=(","+Core.Functions.Validations.getValidatedSwidgetValue(a.txtEmailNotificaciones3,g))}if(a.ddlEmailNotificacionesCantidad.swidget().selectedItem().value==4){f.juridica[0].email+=(","+Core.Functions.Validations.getValidatedSwidgetValue(a.txtEmailNotificaciones4,g))}}f.juridica[0].DomicilioLegalTelefonoFijo=a.txtTelefonoParticularArea.swidget().value()+"-"+a.txtTelefonoParticularNumero.swidget().value();if(!a.isValidPhone(f.juridica[0].DomicilioLegalTelefonoFijo)){Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularArea,true);Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularNumero,true);g.value=false;a.divAlert.text("El teléfono ingresado no es válido.");a.divAlert.slideDown()}if(!a.txtTelefonoParticularArea.swidget().value()||!Core.Functions.Validations.isNumeric(a.txtTelefonoParticularArea.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularArea,true);g.value=false;if(a.txtTelefonoParticularArea.swidget().value()){a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}}if(!a.txtTelefonoParticularNumero.swidget().value()||!Core.Functions.Validations.isNumeric(a.txtTelefonoParticularNumero.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularNumero,true);g.value=false;if(a.txtTelefonoParticularNumero.swidget().value()){a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}}if(a.ddlTelefonoCelularPais.swidget().selectedItem()!=null&&a.ddlTelefonoCelularPais.swidget().selectedItem().value==a.phoneCodeAr){f.juridica[0].DomicilioLegalTelefonoMovil="+"+a.ddlTelefonoCelularPais.swidget().selectedItem().value+"-"+a.txtTelefonoCelularArea.swidget().value()+"-"+a.txtTelefonoCelularNumero.swidget().value()}else{f.juridica[0].DomicilioLegalTelefonoMovil="+"+a.ddlTelefonoCelularPais.swidget().selectedItem().value+"-"+a.txtTelefonoCelularNumero.swidget().value()}if(((a.ddlTelefonoCelularPais.swidget().selectedItem().value==a.phoneCodeAr&&a.txtTelefonoCelularArea.swidget().value())||a.txtTelefonoCelularNumero.swidget().value())&&!a.isValidPhone(f.juridica[0].DomicilioLegalTelefonoMovil)){Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularArea,true);Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularNumero,true);g.value=false;a.divAlert.text("El teléfono ingresado no es válido.");a.divAlert.slideDown()}if(a.ddlTelefonoCelularPais.swidget().selectedItem().value==a.phoneCodeAr&&(a.txtTelefonoCelularArea.swidget().value()&&!Core.Functions.Validations.isNumeric(a.txtTelefonoCelularArea.swidget().value()))){Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularArea,true);g.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(a.txtTelefonoCelularNumero.swidget().value()&&!Core.Functions.Validations.isNumeric(a.txtTelefonoCelularNumero.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularNumero,true);g.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}f.juridica[0].tributaEnOtroPais1=0;f.juridica[0].tributaEnOtroPais2=0;f.juridica[0].tributaEnOtroPais3=0;if(a.ddlCantidadResidenciasFiscales.swidget().selectedItem()){f.juridica[0].idTipoIdentificadorFiscal1=0;f.juridica[0].NIT1="";if(a.ddlCantidadResidenciasFiscales.swidget().selectedItem().value>=1){f.juridica[0].idTipoIdentificadorFiscal1=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTributaTipoIdentificadorFiscal1,g);f.juridica[0].NIT1=Core.Functions.Validations.getValidatedSwidgetValue(a.txtTributaNit1,g);f.juridica[0].tributaEnOtroPais1=1;if(a.ddlTributaPais1.swidget().value()==a.idPais_Argentina&&(!Core.Functions.Validations.isNumeric(a.txtTributaNit1.val())||!Core.Functions.Validations.isCuit(a.txtTributaNit1.val()))){Core.Functions.Validations.toggleValidation(a.txtTributaNit1,true);g.value=false;a.divAlert.text("Debe ingresar un identificador fiscal válido.");a.divAlert.slideDown()}}f.juridica[0].idTipoIdentificadorFiscal2=0;f.juridica[0].NIT2="";if(a.ddlCantidadResidenciasFiscales.swidget().selectedItem().value>=2){f.juridica[0].idTipoIdentificadorFiscal2=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTributaTipoIdentificadorFiscal2,g);f.juridica[0].NIT2=Core.Functions.Validations.getValidatedSwidgetValue(a.txtTributaNit2,g);f.juridica[0].tributaEnOtroPais2=1;if(a.ddlTributaPais2.swidget().value()==a.idPais_Argentina&&(!Core.Functions.Validations.isNumeric(a.txtTributaNit2.val())||!Core.Functions.Validations.isCuit(a.txtTributaNit2.val()))){Core.Functions.Validations.toggleValidation(a.txtTributaNit2,true);g.value=false;a.divAlert.text("Debe ingresar un identificador fiscal válido.");a.divAlert.slideDown()}}f.juridica[0].idTipoIdentificadorFiscal3=0;f.juridica[0].NIT3="";if(a.ddlCantidadResidenciasFiscales.swidget().selectedItem().value>=3){f.juridica[0].idTipoIdentificadorFiscal3=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTributaTipoIdentificadorFiscal3,g);f.juridica[0].NIT3=Core.Functions.Validations.getValidatedSwidgetValue(a.txtTributaNit3,g);f.juridica[0].tributaEnOtroPais3=1;if(a.ddlTributaPais3.swidget().value()==a.idPais_Argentina&&(!Core.Functions.Validations.isNumeric(a.txtTributaNit3.val())||!Core.Functions.Validations.isCuit(a.txtTributaNit3.val()))){Core.Functions.Validations.toggleValidation(a.txtTributaNit3,true);g.value=false;a.divAlert.text("Debe ingresar un identificador fiscal válido.");a.divAlert.slideDown()}}}f.juridica[0].idTipoOCDE=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOcde,g);f.juridica[0].idTipoFATCA=Core.Functions.Validations.getValidatedDropDownValue(a.ddlCiudadaniaEEUU,g);if(a.ddlCiudadaniaEEUU.swidget().selectedItem()){if(a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==1||a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==5){f.juridica[0].tieneBeneficiariosEstadounidenses=a.chkPoseeBeneficiariosEstadounidenses.swidget().checked()?1:0;if(a.chkPoseeBeneficiariosEstadounidenses.swidget().checked()){if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem()){var e=0;f.juridica[0].beneficiarioEEUU1Nombre="";f.juridica[0].beneficiarioEEUU1TIN="";f.juridica[0].beneficiarioEEUU1PorcPart=0;if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=1){f.juridica[0].beneficiarioEEUU1Nombre=Core.Functions.Validations.getValidatedSwidgetValue(a.txtBeneficiarioEstadounidenseNombre1,g);f.juridica[0].beneficiarioEEUU1TIN=Core.Functions.Validations.getValidatedSwidgetValue(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU1,g);f.juridica[0].beneficiarioEEUU1PorcPart=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtBeneficiarioEstadounidensePorcentajeParticipacion1,g));e+=f.juridica[0].beneficiarioEEUU1PorcPart}f.juridica[0].beneficiarioEEUU2Nombre="";f.juridica[0].beneficiarioEEUU2TIN="";f.juridica[0].beneficiarioEEUU2PorcPart=0;if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=2){f.juridica[0].beneficiarioEEUU2Nombre=Core.Functions.Validations.getValidatedSwidgetValue(a.txtBeneficiarioEstadounidenseNombre2,g);f.juridica[0].beneficiarioEEUU2TIN=Core.Functions.Validations.getValidatedSwidgetValue(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU2,g);f.juridica[0].beneficiarioEEUU2PorcPart=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtBeneficiarioEstadounidensePorcentajeParticipacion2,g));e+=f.juridica[0].beneficiarioEEUU2PorcPart}f.juridica[0].beneficiarioEEUU3Nombre="";f.juridica[0].beneficiarioEEUU3TIN="";f.juridica[0].beneficiarioEEUU3PorcPart=0;if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=3){f.juridica[0].beneficiarioEEUU3Nombre=Core.Functions.Validations.getValidatedSwidgetValue(a.txtBeneficiarioEstadounidenseNombre3,g);f.juridica[0].beneficiarioEEUU3TIN=Core.Functions.Validations.getValidatedSwidgetValue(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU3,g);f.juridica[0].beneficiarioEEUU3PorcPart=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtBeneficiarioEstadounidensePorcentajeParticipacion3,g));e+=f.juridica[0].beneficiarioEEUU3PorcPart}f.juridica[0].beneficiarioEEUU4Nombre="";f.juridica[0].beneficiarioEEUU4TIN="";f.juridica[0].beneficiarioEEUU4PorcPart=0;if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=4){f.juridica[0].beneficiarioEEUU4Nombre=Core.Functions.Validations.getValidatedSwidgetValue(a.txtBeneficiarioEstadounidenseNombre4,g);f.juridica[0].beneficiarioEEUU4TIN=Core.Functions.Validations.getValidatedSwidgetValue(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU4,g);f.juridica[0].beneficiarioEEUU4PorcPart=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtBeneficiarioEstadounidensePorcentajeParticipacion4,g));e+=f.juridica[0].beneficiarioEEUU4PorcPart}f.juridica[0].beneficiarioEEUU5Nombre="";f.juridica[0].beneficiarioEEUU5TIN="";f.juridica[0].beneficiarioEEUU5PorcPart=0;if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=5){f.juridica[0].beneficiarioEEUU5Nombre=Core.Functions.Validations.getValidatedSwidgetValue(a.txtBeneficiarioEstadounidenseNombre5,g);f.juridica[0].beneficiarioEEUU5TIN=Core.Functions.Validations.getValidatedSwidgetValue(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU5,g);f.juridica[0].beneficiarioEEUU5PorcPart=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtBeneficiarioEstadounidensePorcentajeParticipacion5,g));e+=f.juridica[0].beneficiarioEEUU5PorcPart}f.juridica[0].beneficiarioEEUU6Nombre="";f.juridica[0].beneficiarioEEUU6TIN="";f.juridica[0].beneficiarioEEUU6PorcPart=0;if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=6){f.juridica[0].beneficiarioEEUU6Nombre=Core.Functions.Validations.getValidatedSwidgetValue(a.txtBeneficiarioEstadounidenseNombre6,g);f.juridica[0].beneficiarioEEUU6TIN=Core.Functions.Validations.getValidatedSwidgetValue(a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU6,g);f.juridica[0].beneficiarioEEUU6PorcPart=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtBeneficiarioEstadounidensePorcentajeParticipacion6,g));e+=f.juridica[0].beneficiarioEEUU6PorcPart}if(e>100){Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion1,true);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion2,true);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion3,true);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion4,true);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion5,true);Core.Functions.Validations.toggleValidation(a.txtBeneficiarioEstadounidensePorcentajeParticipacion6,true);g.value=false;a.divAlert.text("Los porcentajes de participación ingresados no deben superar el 100%.");a.divAlert.slideDown()}}}}if(a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==2){f.juridica[0].idInstitucionFinancieraExtranjera=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoInstitucionFinancieraExtranjera,g);f.juridica[0].InstitucionFinancieraExtranjeraGIIN=Core.Functions.Validations.getValidatedSwidgetValue(a.txtInstitucionFinancieraExtranjeraGIIN,g)}if(a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==3){f.juridica[0].idPersonaJuridicaExenta=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoPersonaJuridicaExenta,g)}if(a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==4){f.juridica[0].idReporteDirectoIRS=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoReporteDirectoIRS,g);f.juridica[0].reportaDirectoIRSGIIN=Core.Functions.Validations.getValidatedSwidgetValue(a.txtReporteDirectoIRSGIIN,g)}if(a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==5){f.juridica[0].esPersonaEstadounidenseTIN=Core.Functions.Validations.getValidatedSwidgetValue(a.txtPersonaEstadounidenseTIN,g)}}if(Core.Objects.Context.Configuration.idAplicacion==3){if(a.idTipoValidacion>=10){f.juridica[0].montoCompliance=Core.Functions.Validations.getValidatedNumericInputValue(a.txtMontoCompliance,g);f.juridica[0].idRiesgo=Core.Functions.Validations.getValidatedDropDownValue(a.ddlRiesgoCliente,g)}else{f.juridica[0].montoCompliance=a.txtMontoCompliance.val();f.juridica[0].idRiesgo=a.ddlRiesgoCliente.swidget().value()}}else{f.juridica[0].montoCompliance=a.dataCuenta!=null?a.dataCuenta.juridica[0].montoCompliance:"";f.juridica[0].idRiesgo=a.dataCuenta!=null?a.dataCuenta.juridica[0].idRiesgo:null}var c=new Core.Controls.ManagerPersona({esCuentaJuridica:true,dataParametros:a.dataParametros});f.personas=a.personas;f.archivos=a.archivos;f.observaciones=a.observaciones;for(var d=0;d<a.personas.length;d++){if(!c.isValidPerson(a.personas[d],a.ddlEstado.swidget().selectedItem().idTipoValidacion)){g.value=false;a.divAlert.text("Revise los datos de la persona: "+a.getTipoDescripcion(a.personas[d].tipo)+" "+a.personas[d].numero+".");a.divAlert.slideDown()}}if(g.value){return f}else{null}};a.getOrigenPatrimonioOtro=function(c){if(!a.chkOrigenPatrimonioOtro.swidget().checked()){return""}else{if(a.txtOrigenPatrimonioOtroDetalle.swidget().value()!=""){return a.txtOrigenPatrimonioOtroDetalle.swidget().value()}else{if(!c){return""}else{c.value=false;a.divAlert.text("Debe ingresar el detalle del origen del patrimonio.");a.divAlert.slideDown();return""}}}};a.getSelectedTipoFirma=function(c){if(a.chkTipoFirmaConjunta.swidget().checked()){return Core.Business.eTipoFirma.Conjunta}else{if(a.chkTipoFirmaIndistinta.swidget().checked()){return Core.Business.eTipoFirma.Indistinta}else{if(!c){return Core.Business.eTipoFirma.Indistinta}else{c.value=false;a.divAlert.text("Debe seleccionar el tipo de firma.");a.divAlert.slideDown();return Core.Business.eTipoFirma.Indistinta}}}};a.getTipoInversionOtro=function(c){if(!a.chkTipoInversionOtro.swidget().checked()){return""}else{if(a.txtTipoInversionOtroDetalle.swidget().value()!=""){return a.txtTipoInversionOtroDetalle.swidget().value()}else{if(!c){return""}else{c.value=false;a.divAlert.text("Debe ingresar el detalle del tipo de inversión.");a.divAlert.slideDown();return""}}}};a.getSelectedCanal=function(f){var d=$(".chk-canal-option");for(var e=0;e<d.length;e++){var c=$(d[e]);if(c.swidget().checked()){return c.attr("idCanalDeVenta")}}if(!f){return Core.Business.eCanal.None}else{f.value=false;a.divAlert.text("Debe seleccionar el canal.");a.divAlert.slideDown();return Core.Business.eCanal.None}};a.getCanalOtro=function(c){if(a.txtCanalOtroDetalle.swidget().value()!=""){return a.txtCanalOtroDetalle.swidget().value()}else{if(!c){return""}else{c.value=false;a.divAlert.text("Debe ingresar el detalle del canal.");a.divAlert.slideDown();return""}}};a.getSelectedMontoAInvertir=function(f){var d=$(".monto-a-invertir-juridica-option");for(var e=0;e<d.length;e++){var c=$(d[e]);if(c.swidget().checked()){return c.attr("idMontoAInvertirJuridica")}}if(a.namespaceActivo=="Legajos"&&a.dataCuenta!=null){return a.dataCuenta.juridica[0].idMontoAInvertirJuridica}if(!f){return Core.Business.eAmountRange.Hasta200}else{f.value=false;a.divAlert.text("Debe seleccionar el monto a invertir");a.divAlert.slideDown();return Core.Business.eAmountRange.Hasta200}};a.setProvincias=function(d,c,g){var f=$.grep(a.dataParametros.provincias,function(i,h){return i.idPais==d});var e=c.swidget().initialOptions;e.dataSource.data=f;if(g!=null){e.value=g}else{e.value=c.swidget().value()}c.swidget().refresh(e)};a.setTiposIdentificadoresFiscales=function(d,c,g){var f=$.grep(a.dataParametros.tiposIdentificadoresFiscales,function(i,h){return i.idPais==d&&i.Juridica});var e=c.swidget().initialOptions;e.dataSource.data=f;if(g!=null){e.value=g}c.swidget().refresh(e)};a.getMaxNumero=function(f){var c=$.grep(a.personas,function(h,g){return h.tipo==f});var e=0;for(var d=0;d<c.length;d++){if(c[d].numero>e){e=c[d].numero}}return e};a.refreshNumeroPersonas=function(){var k=0;var e=0;var c=0;var d=0;var g=0;var f=0;for(var h=0;h<a.personas.length;h++){if(a.personas[h].tipo==Core.Business.eTipoPersonaCuenta.Titular){k++;a.personas[h].numero=k}else{if(a.personas[h].tipo==Core.Business.eTipoPersonaCuenta.Autorizado){e++;a.personas[h].numero=e}else{if(a.personas[h].tipo==Core.Business.eTipoPersonaCuenta.Accionista){c++;a.personas[h].numero=c}else{if(a.personas[h].tipo==Core.Business.eTipoPersonaCuenta.Apoderado){d++;a.personas[h].numero=d}else{if(a.personas[h].tipo==Core.Business.eTipoPersonaCuenta.Firmante){g++;a.personas[h].numero=g}else{if(a.personas[h].tipo==Core.Business.eTipoPersonaCuenta.BeneficiarioFinal){f++;a.personas[h].numero=f}}}}}}}var j=a.gridPersonas.swidget().initialOptions;j.dataSource.data=a.personas;a.gridPersonas.swidget().refresh(j)};a.getTipoDescripcion=function(c){if(c==Core.Business.eTipoPersonaCuenta.Titular){return"Titular"}else{if(c==Core.Business.eTipoPersonaCuenta.Autorizado){return"Autorizado"}else{if(c==Core.Business.eTipoPersonaCuenta.Firmante){return"Firmante"}else{if(c==Core.Business.eTipoPersonaCuenta.Apoderado){return"Apoderado"}else{if(c==Core.Business.eTipoPersonaCuenta.Accionista){return"Accionista"}else{if(c==Core.Business.eTipoPersonaCuenta.BeneficiarioFinal){return"Beneficiario Final"}else{return""}}}}}}};a.setControls=function(c){a.setProvincias(a.ddlDomicilioLegalPais.swidget().value(),a.ddlDomicilioLegalProvincia,(c&&a.dataCuenta!=null&&a.dataCuenta.juridica[0].DomicilioLegalidProvincia!=null)?a.dataCuenta.juridica[0].DomicilioLegalidProvincia.toString():null);a.setProvincias(a.ddlNacionalidad.swidget().value(),a.ddlLugarConstitucion,(c&&a.dataCuenta!=null&&a.dataCuenta.juridica[0].LugarConstitucion!=null)?a.dataCuenta.juridica[0].LugarConstitucion.toString():null);a.setTiposIdentificadoresFiscales(a.ddlPaisTipoIdentificacionFiscal.swidget().value(),a.ddlTipoIdentificacionFiscal,(c&&a.dataCuenta!=null&&a.dataCuenta.juridica[0].idTipoIdentificadorFiscal!=null)?a.dataCuenta.juridica[0].idTipoIdentificadorFiscal.toString():null);a.setTiposIdentificadoresFiscales(a.ddlTributaPais1.swidget().value(),a.ddlTributaTipoIdentificadorFiscal1,(c&&a.dataCuenta!=null&&a.dataCuenta.juridica[0].idTipoIdentificadorFiscal1!=null)?a.dataCuenta.juridica[0].idTipoIdentificadorFiscal1.toString():null);a.setTiposIdentificadoresFiscales(a.ddlTributaPais2.swidget().value(),a.ddlTributaTipoIdentificadorFiscal2,(c&&a.dataCuenta!=null&&a.dataCuenta.juridica[0].idTipoIdentificadorFiscal2!=null)?a.dataCuenta.juridica[0].idTipoIdentificadorFiscal2.toString():null);a.setTiposIdentificadoresFiscales(a.ddlTributaPais3.swidget().value(),a.ddlTributaTipoIdentificadorFiscal3,(c&&a.dataCuenta!=null&&a.dataCuenta.juridica[0].idTipoIdentificadorFiscal3!=null)?a.dataCuenta.juridica[0].idTipoIdentificadorFiscal3.toString():null);a.divOrigenPatrimonioOtroDetalle.hide();if(a.chkOrigenPatrimonioOtro.swidget().checked()){a.divOrigenPatrimonioOtroDetalle.show()}a.divCanalOtroDetalle.hide();if(a.getSelectedCanal()==Core.Business.eCanal.Otro){a.divCanalOtroDetalle.show()}a.divTipoInversionOtroDetalle.hide();if(a.chkTipoInversionOtro.swidget().checked()){a.divTipoInversionOtroDetalle.show()}a.divIngresoAsesorFinanciero.hide();if(a.chkIngresoAsesorFinanciero.swidget().checked()){a.divIngresoAsesorFinanciero.show()}a.divActividadPrincipalOtro.hide();if(a.ddlActividadPrincipal.swidget().selectedItem()&&a.ddlActividadPrincipal.swidget().selectedItem().idActividadJuridica==Core.Business.eActividadPrincipalJuridica.Otro){a.divActividadPrincipalOtro.show()}a.divActividadPrincipalCampoAdicional1.hide();if(a.ddlActividadPrincipal.swidget().selectedItem()&&a.ddlActividadPrincipal.swidget().selectedItem().TipoCampoAdicional==1){a.divActividadPrincipalCampoAdicional1.show()}a.divResidenciaFiscal1.hide();a.divResidenciaFiscal2.hide();a.divResidenciaFiscal3.hide();if(a.ddlCantidadResidenciasFiscales.swidget().selectedItem()){if(a.ddlCantidadResidenciasFiscales.swidget().selectedItem().value>=1){a.divResidenciaFiscal1.show()}if(a.ddlCantidadResidenciasFiscales.swidget().selectedItem().value>=2){a.divResidenciaFiscal2.show()}if(a.ddlCantidadResidenciasFiscales.swidget().selectedItem().value>=3){a.divResidenciaFiscal3.show()}}a.divTipoOcdeDeclaracionJurada.hide();if(a.ddlTipoOcde.swidget().selectedItem()&&a.ddlTipoOcde.swidget().selectedItem().idTipoOCDE==5){a.divTipoOcdeDeclaracionJurada.show()}a.divCiudadaniaEEUUCampoAdicional1.hide();a.divCiudadaniaEEUUCampoAdicional2.hide();a.divCiudadaniaEEUUCampoAdicional3.hide();a.divCiudadaniaEEUUCampoAdicional4.hide();a.divCiudadaniaEEUUCampoAdicional5.hide();a.divCiudadaniaEEUUDeclaracionJurada.hide();if(a.ddlCiudadaniaEEUU.swidget().selectedItem()){if(a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==1||a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==5){a.divPoseeBeneficiariosEstadounidenses.show();if(a.chkPoseeBeneficiariosEstadounidenses.swidget().checked()){a.divBeneficiariosEstadounidensesCantidad.show();a.divCiudadaniaEEUUDeclaracionJurada.show();if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem()){if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=1){a.divBeneficiarioEstadounidense1.show()}if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=2){a.divBeneficiarioEstadounidense2.show()}if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=3){a.divBeneficiarioEstadounidense3.show()}if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=4){a.divBeneficiarioEstadounidense4.show()}if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=5){a.divBeneficiarioEstadounidense5.show()}if(a.ddlBeneficiariosEstadounidensesCantidad.swidget().selectedItem().value>=6){a.divBeneficiarioEstadounidense6.show()}}}}if(a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==2){a.divCiudadaniaEEUUCampoAdicional2.show()}if(a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==3){a.divCiudadaniaEEUUCampoAdicional3.show()}if(a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==4){a.divCiudadaniaEEUUCampoAdicional4.show()}if(a.ddlCiudadaniaEEUU.swidget().selectedItem().TipoCampoAdicional==5){a.divCiudadaniaEEUUCampoAdicional5.show()}}a.ddlTipoRegistracionJuridica.swidget().enabled(true);if(a.ddlNacionalidad.swidget().selectedItem()){if(a.ddlNacionalidad.swidget().selectedItem().idPais==Core.Business.eNacionalidad.Argentina){if(a.ddlLugarConstitucion.swidget().selectedItem()){if(a.ddlLugarConstitucion.swidget().selectedItem().idProvincia==Core.Business.eProvincia.CABA||a.ddlLugarConstitucion.swidget().selectedItem().idProvincia==Core.Business.eProvincia.BsAs){a.ddlTipoRegistracionJuridica.swidget().enabled(false);a.ddlTipoRegistracionJuridica.swidget().value(a.ddlLugarConstitucion.swidget().selectedItem().idProvincia==Core.Business.eProvincia.CABA?Core.Business.eTipoRegistracion.IGJ.toString():Core.Business.eTipoRegistracion.DPJ.toString())}}}else{a.ddlTipoRegistracionJuridica.swidget().enabled(false);a.ddlTipoRegistracionJuridica.swidget().value(Core.Business.eTipoRegistracion.Extranjero.toString())}}a.divEmailNotificaciones1.hide();a.divEmailNotificaciones2.hide();a.divEmailNotificaciones3.hide();a.divEmailNotificaciones4.hide();if(a.ddlEmailNotificacionesCantidad.swidget().selectedItem()){if(a.ddlEmailNotificacionesCantidad.swidget().selectedItem().value>=1){a.divEmailNotificaciones1.show()}if(a.ddlEmailNotificacionesCantidad.swidget().selectedItem().value>=2){a.divEmailNotificaciones2.show()}if(a.ddlEmailNotificacionesCantidad.swidget().selectedItem().value>=3){a.divEmailNotificaciones3.show()}if(a.ddlEmailNotificacionesCantidad.swidget().selectedItem().value==4){a.divEmailNotificaciones4.show()}}};a.getDate=function(c){var d=c.substr(6,2);var e=c.substr(4,2);var g=c.substr(0,4);var f=new Date();f.setDate(1);f.setYear(g);f.setMonth(e-1);f.setDate(d);return f};a.isValidEmailAddress=function(c){if(!c){return false}else{var d=/^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i;if(!d.test(c)){return false}return true}};a.isValidPhone=function(c){var e=c.replaceAll("-","");var d=/^[0-9+]+$/;if(!d.test(e)||e.length<10||e.length>17){return false}return true};a.setTelefonoCelularControls=function(){a.divTelefonoCelularArea.hide();a.txtTelefonoCelularArea.val("");a.divTelefonoCelularNumero.removeClass("col-lg-3");a.divTelefonoCelularNumero.removeClass("col-md-3");a.divTelefonoCelularNumero.addClass("col-lg-4");a.divTelefonoCelularNumero.addClass("col-md-4");if(a.ddlTelefonoCelularPais.swidget().selectedItem().value==a.phoneCodeAr){a.divTelefonoCelularNumero.removeClass("col-lg-4");a.divTelefonoCelularNumero.removeClass("col-md-4");a.divTelefonoCelularNumero.addClass("col-lg-3");a.divTelefonoCelularNumero.addClass("col-md-3");a.divTelefonoCelularArea.show()}};a.destroy=function(c){a.ddlEstado.swidget().destroy();a.ddlVersion.swidget().destroy();a.ddlAsesor.swidget().destroy();a.chkIngresoAsesorFinanciero.swidget().destroy();a.txtIngresoAsesorFinanciero.swidget().destroy();a.chkUsarFirmaDigital.swidget().destroy();a.chkCuentasComitente.swidget().destroy();a.chkCuentasCuotapartista.swidget().destroy();a.chkOrigenPatrimonioActividadPrincipal.swidget().destroy();a.chkOrigenPatrimonioVentaBienes.swidget().destroy();a.chkOrigenPatrimonioOtro.swidget().destroy();a.txtOrigenPatrimonioOtroDetalle.swidget().destroy();a.chkConvenioComitenteAAGI.swidget().destroy();a.txtCanalOtroDetalle.swidget().destroy();a.ddlArancel.swidget().destroy();a.txtComoLlegoABalanz.swidget().destroy();a.txtUsuarioAsignado.swidget().destroy();a.chkTipoInversionAcciones.swidget().destroy();a.chkTipoInversionTitulosPublicos.swidget().destroy();a.chkTipoInversionFideicomisos.swidget().destroy();a.chkTipoInversionFondos.swidget().destroy();a.chkTipoInversionOpciones.swidget().destroy();a.chkTipoInversionOperacionesCambioUSD.swidget().destroy();a.chkTipoInversionFuturos.swidget().destroy();a.chkTipoInversionObligacionesNegociables.swidget().destroy();a.chkTipoInversionChequePagoDiferido.swidget().destroy();a.chkTipoInversionOtro.swidget().destroy();a.txtTipoInversionOtroDetalle.swidget().destroy();a.txtPlazoInversion.swidget().destroy();a.txtDescripcionActividadCliente.swidget().destroy();a.ddlPaisTipoIdentificacionFiscal.swidget().destroy();a.ddlTipoIdentificacionFiscal.swidget().destroy();a.txtIdentificacionFiscal.swidget().destroy();a.txtRazonSocial.swidget().destroy();a.ddlNacionalidad.swidget().destroy();a.ddlLugarConstitucion.swidget().destroy();a.ddlTipoPersonaJuridica.swidget().destroy();a.ddlTipoRegistracionJuridica.swidget().destroy();a.txtNumeroInscripcion.swidget().destroy();a.txtFechaConstitucion.swidget().destroy();a.txtTomo.swidget().destroy();a.txtLibro.swidget().destroy();a.ddlActividadPrincipal.swidget().destroy();a.txtActividadPrincipalOtro.swidget().destroy();a.txtSegmentoInversion.swidget().destroy();a.txtNumeroAseguradora.swidget().destroy();a.ddlCondicionIva.swidget().destroy();a.ddlTipoPersonaJuridicaExenta.swidget().destroy();a.ddlCiudadaniaEEUU.swidget().destroy();a.ddlTipoOcde.swidget().destroy();a.ddlInscripcionGanancias.swidget().destroy();a.chkPoseeBeneficiariosEstadounidenses.swidget().destroy();a.ddlBeneficiariosEstadounidensesCantidad.swidget().destroy();a.txtDomicilioLegalPiso.swidget().destroy();a.txtDomicilioLegalCalle.swidget().destroy();a.txtDomicilioLegalNumero.swidget().destroy();a.txtDomicilioLegalDepartamento.swidget().destroy();a.ddlDomicilioLegalPais.swidget().destroy();a.ddlDomicilioLegalProvincia.swidget().destroy();a.txtDomicilioLegalLocalidad.swidget().destroy();a.txtDomicilioLegalCodigoPostal.swidget().destroy();a.txtTelefonoParticularArea.swidget().destroy();a.txtTelefonoParticularNumero.swidget().destroy();a.ddlTelefonoCelularPais.swidget().destroy();a.txtTelefonoCelularArea.swidget().destroy();a.txtTelefonoCelularNumero.swidget().destroy();a.ddlEmailNotificacionesCantidad.swidget().destroy();a.txtEmailNotificaciones1.swidget().destroy();a.txtEmailNotificaciones2.swidget().destroy();a.txtEmailNotificaciones3.swidget().destroy();a.txtEmailNotificaciones4.swidget().destroy();a.ddlCantidadResidenciasFiscales.swidget().destroy();a.txtTributaNit1.swidget().destroy();a.txtTributaNit2.swidget().destroy();a.txtTributaNit3.swidget().destroy();a.ddlTributaPais1.swidget().destroy();a.ddlTributaPais2.swidget().destroy();a.ddlTributaPais3.swidget().destroy();a.ddlTributaTipoIdentificadorFiscal1.swidget().destroy();a.ddlTributaTipoIdentificadorFiscal2.swidget().destroy();a.ddlTributaTipoIdentificadorFiscal3.swidget().destroy();a.txtBeneficiarioEstadounidenseNombre1.swidget().destroy();a.txtBeneficiarioEstadounidenseNombre2.swidget().destroy();a.txtBeneficiarioEstadounidenseNombre3.swidget().destroy();a.txtBeneficiarioEstadounidenseNombre4.swidget().destroy();a.txtBeneficiarioEstadounidenseNombre5.swidget().destroy();a.txtBeneficiarioEstadounidenseNombre6.swidget().destroy();a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU1.swidget().destroy();a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU2.swidget().destroy();a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU3.swidget().destroy();a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU4.swidget().destroy();a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU5.swidget().destroy();a.txtBeneficiarioEstadounidenseIdContribuyenteEEUU6.swidget().destroy();a.ddlTipoInstitucionFinancieraExtranjera.swidget().destroy();a.txtInstitucionFinancieraExtranjeraGIIN.swidget().destroy();a.ddlTipoReporteDirectoIRS.swidget().destroy();a.txtReporteDirectoIRSGIIN.swidget().destroy();a.txtPersonaEstadounidenseTIN.swidget().destroy();a.chkSujetoObligado.swidget().destroy();a.gridPersonas.swidget().destroy();a.gridArchivos.swidget().destroy();a.gridObservaciones.swidget().destroy();a.ddlRiesgoCliente.swidget().destroy();a.divManagerAltaCuenta.html("");if(c){a.onClose()}}};Core.Controls.ManagerAltaCuentaNuevoArchivo=function(b){var a=this;a.divModal=$(".div-modal-agregar-archivo");a.divTipoArchivo=null;a.ddlTipoArchivo=null;a.divComentario=null;a.txtComentario=null;a.btnConfirmarArchivo=null;a.onSave=null;a.tiposArchivos=null;a.divContainerUploadFile=null;a.lblUploadFile=null;a.divUploadFile=null;a.fileUploadArchivo=null;a.fileUpload=null;a.idTipoArchivoDefault="";a.comentariosDefault="";a.file=null;$.extend(true,a,b);a.show=function(){a.divComentario=a.divModal.find(".div-archivo-comentario");a.txtComentario=a.divModal.find(".textbox-archivo-comentario");a.txtComentario.shieldTextBox({value:a.comentariosDefault});a.divComentario.hide();a.divTipoArchivo=a.divModal.find(".div-tipo-archivo");a.ddlTipoArchivo=a.divModal.find(".dropdown-tipo-archivo");a.divContainerUploadFile=a.divModal.find(".div-container-upload-file");a.divContainerUploadFile.hide();a.lblUploadFile=a.divModal.find(".label-upload-file");a.lblUploadFile.text((a.file)?"Archivo: Google Search":"Archivo (seleccionar o arrastrar)");a.divUploadFile=a.divModal.find(".div-upload-file");a.divUploadFile.show();if(a.file){a.divUploadFile.hide()}Core.Functions.Validations.toggleValidation(a.ddlTipoArchivo,false);Core.Functions.Validations.toggleValidation(a.txtComentario,false);a.ddlTipoArchivo.shieldComboBox({dataSource:{data:a.tiposArchivos},valueTemplate:"{idTipoArchivo}",textTemplate:"{Descripcion}",enabled:(a.file==null),autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""}]}},events:{select:function(c){a.ddlTipoArchivoChange()}},value:a.idTipoArchivoDefault});a.fileUploadArchivo=new Core.Controls.FileUpload(a.divUploadFile,{title:"Seleccionar o Arrastrar Archivo",maxSize:((Core.Objects.Context.Configuration.idAplicacion==0||Core.Objects.Context.Configuration.idAplicacion==2||Core.Objects.Context.Configuration.idAplicacion==3)?52428800:10485760),onLoad:function(c){a.fileUpload=c},onFileChange:function(){a.fileUpload=null},onError:function(){a.fileUpload=null;var c=new Core.Controls.Dialog("Error","No se ha podido adjuntar la foto",{displayButtons:{close:true,accept:false}});c.show();return}});a.fileUploadArchivo.inputFile.css("height","75px");a.btnConfirmarArchivo=a.divModal.find(".btn-confirmar");a.btnConfirmarArchivo.hide();a.btnConfirmarArchivo.unbind("click");a.btnConfirmarArchivo.click(function(){Core.Functions.Validations.toggleValidation(a.ddlTipoArchivo,false);Core.Functions.Validations.toggleValidation(a.txtComentario,false);if(!a.ddlTipoArchivo.swidget().selectedItem()){Core.Functions.Validations.toggleValidation(a.ddlTipoArchivo,true);return}if(!a.fileUpload&&!a.file){var c=new Core.Controls.Dialog("Error","Debe adjuntar un archivo.",{displayButtons:{close:true,accept:false}});c.show();return}a.onSave({file:((a.file)?a.file:a.fileUpload),idTipoArchivo:a.ddlTipoArchivo.swidget().selectedItem().idTipoArchivo,Tipo:a.ddlTipoArchivo.swidget().selectedItem().Descripcion,comentarios:a.txtComentario.swidget().value(),Fecha:Core.Functions.Date.getDisplayDate(new Date())});a.divModal.modal("hide")});a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});if(a.ddlTipoArchivo.swidget().selectedItem()){a.ddlTipoArchivoChange()}a.divModal.modal({show:true})};a.ddlTipoArchivoChange=function(){a.fileUpload=null;a.fileUploadArchivo.clear();a.divContainerUploadFile.hide();a.btnConfirmarArchivo.hide();a.divComentario.hide();if(a.ddlTipoArchivo.swidget().selectedItem()){a.divContainerUploadFile.show();var c={};a.ddlTipoArchivo.swidget().selectedItem().ContentTypeList.split(",").forEach(function(e,d){c[e]=e});a.fileUploadArchivo.fileTypes=c;a.fileUploadArchivo.fileTypesDescription=a.ddlTipoArchivo.swidget().selectedItem().FileExtensionList;a.fileUploadArchivo.urlMethod=Core.PrefixUrl+"upload/documento/"+a.ddlTipoArchivo.swidget().selectedItem().idTipoArchivo;a.btnConfirmarArchivo.show();a.divComentario.show()}};a.destroy=function(){a.fileUploadArchivo.destroy();a.txtComentario.swidget().destroy();a.ddlTipoArchivo.swidget().destroy()}};Core.Controls.ManagerMatrizRiesgo=function(b){var a=this;a.decimalCount=2;a.onSave=function(d,c){};a.onClose=function(){};a.container=null;a.dataParametrosUsuario=null;a.dataParametros=null;a.calcularMatrizManual=false;a.calcularMatriz=true;a.consultarMatriz=false;a.cuilCuit=null;a.idAperturaCuenta=null;a.tipo=null;a.numero=null;a.readOnly=null;a.origenApertura=true;a.optionsApertura=null;a.showTitle=true;$.extend(true,a,b);a.resultadoMatriz=null;a.dataMatriz=null;a.divAlert=null;a.txtDescripcion=null;a.txtIdentificacionFiscal=null;a.txtClienteDesde=null;a.txtFechaEmision=null;a.lblNseDescripcion=null;a.lblNseValor=null;a.divDataBienesPersonalesGanancias=null;a.divDataCertificacionIngresosAnuales=null;a.divDataAutonomoResponsableInscripto=null;a.divDataReciboSueldoJubilacion=null;a.divDataInscripcionMonotributo=null;a.divDataEstadoContable=null;a.divTipoPersona=null;a.chkTipoPersonaFisica=null;a.chkTipoPersonaJuridica=null;a.chkBienesPersonalesGanancias=null;a.chkCertificacionIngresosAnuales=null;a.chkAutonomoResponsableInscripto=null;a.chkGrupoActividadesSociedadesComercialesCiviles=null;a.chkGrupoActividadesLocacionesPrestacionesServicios=null;a.chkGrupoActividadesRestoDeActividades=null;a.chkGrupoActividadesAfiliacionesVoluntarias=null;a.chkGrupoActividadesMenores=null;a.chkGrupoActividadesJubilados=null;a.chkGrupoActividadesAmasDeCasa=null;a.chkReciboSueldoJubilacion=null;a.chkInscripcionMonotributo=null;a.chkEstadoContable=null;a.chkCalculoRiesgoSujetoObligadoNo=null;a.chkCalculoRiesgoSujetoObligadoSi=null;a.chkCalculoRiesgoPEPNo=null;a.chkCalculoRiesgoPEPSi=null;a.chkCalculoRiesgoAntiguedadMenor24MesesNo=null;a.chkCalculoRiesgoAntiguedadMenor24MesesSi=null;a.chkCalculoRiesgoPresentaInusualidadesDesfavorablesNo=null;a.chkCalculoRiesgoPresentaInusualidadesDesfavorablesSi=null;a.chkCalculoRiesgoPresentoDocumentacionRespaldoNo=null;a.chkCalculoRiesgoPresentoDocumentacionRespaldoSi=null;a.chkCalculoRiesgoProveedorDelEstadoNo=null;a.chkCalculoRiesgoProveedorDelEstadoSi=null;a.chkCalculoRiesgoNoticiasAdversasPlaftNo=null;a.chkCalculoRiesgoNoticiasAdversasPlaftSi=null;a.chkCalculoRiesgoEsTerroristaNo=null;a.chkCalculoRiesgoEsTerroristaSi=null;a.dateBienesPersonalesFechaDeclaracionJurada=null;a.dateIngresosAnualesFechaDeclaracionJurada=null;a.dateAutonomoResponsableInscriptoFechaAltaImpuesto=null;a.dateReciboSueldoJubilacionFechaIngreso=null;a.dateInscripcionMonotributoFechaAltaCategoria=null;a.dateEstadoContableFechaBalance=null;a.lblWarningDateBienesPersonalesFechaDeclaracionJurada=null;a.lblWarningDateIngresosAnualesFechaDeclaracionJurada=null;a.lblWarningDateAutonomoResponsableInscriptoFechaAltaImpuesto=null;a.lblWarningDateReciboSueldoJubilacionFechaIngreso=null;a.lblWarningDateInscripcionMonotributoFechaAltaCategoria=null;a.lblWarningDateEstadoContableFechaBalance=null;a.txtBienesPersonalesPatrimonioNetoTotal=null;a.txtBienesPersonalesDineroEfectivo=null;a.txtBienesPersonalesExcentos=null;a.txtBienesPersonalesPerfilTransaccional=null;a.txtCertificacionIngresosAnualesResultadoNeto=null;a.txtCertificacionIngresosAnualesPerfilTransaccional=null;a.txtAutonomoResponsableInscriptoCategoria=null;a.txtAutonomoResponsableInscriptoIngresosMensuales=null;a.txtAutonomoResponsableInscriptoPerfilTransaccional=null;a.txtReciboSueldoJubilacionNetoRecibido=null;a.txtReciboSueldoJubilacionPerfilTransaccional=null;a.txtInscripcionMonotributoCategoria=null;a.txtInscripcionMonotributoPerfilTransaccional=null;a.txtEstadoContableActivoCorriente=null;a.txtEstadoContablePasivoCorriente=null;a.txtEstadoContableVentasNetas=null;a.txtEstadoContablePerfilTransaccional=null;a.ddlCalculoRiesgoGeografiaAltoRiesgo=null;a.divCalculoRiesgoConexionSustancialGeografiaAltoRiesgo=null;a.ddlCalculoRiesgoConexionSustancialGeografiaAltoRiesgo=null;a.ddlCalculoRiesgoProductosInvertir=null;a.ddlCalculoRiesgoCanalVenta=null;a.txtCalculoRiesgoGeografiaAltoRiesgoDescripcion=null;a.divCalculoRiesgoActividadAltoRiesgo=null;a.ddlCalculoRiesgoActividadAltoRiesgo=null;a.txtCalculoRiesgoActividadAltoRiesgoDescripcion=null;a.txtCalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion=null;a.txtCalculoRiesgoSujetoObligadoDescripcion=null;a.txtCalculoRiesgoPEPDescripcion=null;a.txtCalculoRiesgoAntiguedadMenor24MesesDescripcion=null;a.txtCalculoRiesgoPresentaInusualidadesDesfavorablesDescripcion=null;a.txtCalculoRiesgoProductosInvertirDescripcion=null;a.txtCalculoRiesgoCanalVentaDescripcion=null;a.txtMaterialidadCuentaDescripcion=null;a.txtCalculoRiesgoPresentoDocumentacionRespaldoDescripcion=null;a.txtCalculoRiesgoProveedorDelEstadoDescripcion=null;a.txtCalculoRiesgoNoticasAdversasPlaftDescripcion=null;a.txtCalculoRiesgoEsTerroristaDescripcion=null;a.divCalculoRiesgoTipoPersonaJuridica=null;a.btnCalculoRiesgoTipoPersonaJuridica=null;a.ddlCalculoRiesgoTipoPersonaJuridica=null;a.txtCalculoRiesgoTipoPersonaJuridicaDescripcion=null;a.lblWarningPerfilTransaccionalResultante=null;a.lblWatningRecalcularRiesgo=null;a.txtPerfilTransaccionalTotal=null;a.txtMaterialidadCuenta=null;a.divVersion=null;a.divContainerDataMatrizRiesgo=null;a.ddlVersion=null;a.lblResultado=null;a.txtObservaciones=null;a.btnVolver=null;a.btnGuardarYCerrar=null;a.btnCalcular=null;a.btnGenerarNueva=null;a.btnDescargarMatriz=null;a.btnRefrescarPerfilTransaccional=null;a.divInformes=null;a.btnNosis=null;a.ultimaVersion=null;a.show=function(){$("html, body").animate({scrollTop:$(".cuenta").offset().top},1000);a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu("matrizDeRiesgo",Core.Objects.Context.Profiles[0]);a.container.html("");a.container.load("/Pages/manager-matriz-de-riesgo.html",function(c,d,e){if(d=="success"){a.ultimaVersion=null;a.divTitle=a.container.find(".div-title");a.divTitle.show();if(!a.showTitle){a.divTitle.hide()}a.title=a.container.find(".title-manager-matriz-riesgo");a.title.text("Alta Cuenta / Perfil del Cliente");a.txtDescripcion=a.container.find(".textbox-descripcion-matriz-riesgo");a.txtIdentificacionFiscal=a.container.find(".textbox-identificacion-fiscal-matriz-riesgo");a.txtClienteDesde=a.container.find(".textbox-cliente-desde-matriz-riesgo");a.txtFechaEmision=a.container.find(".textbox-fecha-emision-matriz-riesgo");a.lblNseDescripcion=a.container.find(".lbl-nse-descripcion-matriz-riesgo");a.lblNseValor=a.container.find(".textbox-nse-valor-matriz-riesgo");a.divTipoPersona=a.container.find(".div-tipo-persona-matriz-riesgo");a.chkTipoPersonaFisica=a.container.find(".chk-tipo-persona-fisica-matriz-riesgo");a.chkTipoPersonaJuridica=a.container.find(".chk-tipo-persona-juridica-matriz-riesgo");a.divDataBienesPersonalesGanancias=a.container.find(".div-data-bienes-personales-ganancias-matriz-riesgo");a.divDataCertificacionIngresosAnuales=a.container.find(".div-data-certificacion-ingresos-anuales-matriz-riesgo");a.divDataAutonomoResponsableInscripto=a.container.find(".div-data-autonomo-responsable-inscripto-matriz-riesgo");a.divDataReciboSueldoJubilacion=a.container.find(".div-data-recibo-sueldo-jubilacion-matriz-riesgo");a.divDataInscripcionMonotributo=a.container.find(".div-data-inscripcion-monotributo-matriz-riesgo");a.divDataEstadoContable=a.container.find(".div-data-estado-contable-matriz-riesgo");a.chkBienesPersonalesGanancias=a.container.find(".chk-bienes-personales-ganancias-matriz-riesgo");a.chkCertificacionIngresosAnuales=a.container.find(".chk-certificacion-ingresos-anuales-matriz-riesgo");a.chkAutonomoResponsableInscripto=a.container.find(".chk-autonomo-responsable-inscripto-matriz-riesgo");a.chkGrupoActividadesSociedadesComercialesCiviles=a.container.find(".chk-grupo-actividades-sociedades-comerciales-civiles-matriz-riesgo");a.chkGrupoActividadesLocacionesPrestacionesServicios=a.container.find(".chk-grupo-actividades-locaciones-prestaciones-servicios-matriz-riesgo");a.chkGrupoActividadesRestoDeActividades=a.container.find(".chk-grupo-actividades-resto-actividades-matriz-riesgo");a.chkGrupoActividadesAfiliacionesVoluntarias=a.container.find(".chk-grupo-actividades-afiliaciones-voluntarias-matriz-riesgo");a.chkGrupoActividadesMenores=a.container.find(".chk-grupo-actividades-menores-matriz-riesgo");a.chkGrupoActividadesJubilados=a.container.find(".chk-grupo-actividades-jubilados-matriz-riesgo");a.chkGrupoActividadesAmasDeCasa=a.container.find(".chk-grupo-actividades-amas-de-casa-matriz-riesgo");a.chkReciboSueldoJubilacion=a.container.find(".chk-recibo-sueldo-jubilacion-matriz-riesgo");a.chkInscripcionMonotributo=a.container.find(".chk-inscripcion-monotributo-matriz-riesgo");a.chkEstadoContable=a.container.find(".chk-estado-contable-matriz-riesgo");a.chkCalculoRiesgoSujetoObligadoNo=a.container.find(".chk-calculo-riesgo-sujeto-obligado-matriz-riesgo-no");a.chkCalculoRiesgoSujetoObligadoSi=a.container.find(".chk-calculo-riesgo-sujeto-obligado-matriz-riesgo-si");a.chkCalculoRiesgoPEPNo=a.container.find(".chk-calculo-riesgo-pep-matriz-riesgo-no");a.chkCalculoRiesgoPEPSi=a.container.find(".chk-calculo-riesgo-pep-matriz-riesgo-si");a.chkCalculoRiesgoAntiguedadMenor24MesesNo=a.container.find(".chk-calculo-riesgo-antiguedad-menor-24-meses-matriz-riesgo-no");a.chkCalculoRiesgoAntiguedadMenor24MesesSi=a.container.find(".chk-calculo-riesgo-antiguedad-menor-24-meses-matriz-riesgo-si");a.chkCalculoRiesgoPresentaInusualidadesDesfavorablesNo=a.container.find(".chk-calculo-riesgo-presenta-inusualidades-desfavorables-matriz-riesgo-no");a.chkCalculoRiesgoPresentaInusualidadesDesfavorablesSi=a.container.find(".chk-calculo-riesgo-presenta-inusualidades-desfavorables-matriz-riesgo-si");a.chkCalculoRiesgoPresentoDocumentacionRespaldoNo=a.container.find(".chk-calculo-riesgo-presento-documentacion-respaldo-matriz-riesgo-no");a.chkCalculoRiesgoPresentoDocumentacionRespaldoSi=a.container.find(".chk-calculo-riesgo-presento-documentacion-respaldo-matriz-riesgo-si");a.chkCalculoRiesgoProveedorDelEstadoNo=a.container.find(".chk-calculo-riesgo-proveedor-del-estado-matriz-riesgo-no");a.chkCalculoRiesgoProveedorDelEstadoSi=a.container.find(".chk-calculo-riesgo-proveedor-del-estado-matriz-riesgo-si");a.chkCalculoRiesgoNoticiasAdversasPlaftNo=a.container.find(".chk-calculo-riesgo-noticias-adversas-plaft-matriz-riesgo-no");a.chkCalculoRiesgoNoticiasAdversasPlaftSi=a.container.find(".chk-calculo-riesgo-noticias-adversas-plaft-matriz-riesgo-si");a.chkCalculoRiesgoEsTerroristaNo=a.container.find(".chk-calculo-riesgo-es-terrorista-matriz-riesgo-no");a.chkCalculoRiesgoEsTerroristaSi=a.container.find(".chk-calculo-riesgo-es-terrorista-matriz-riesgo-si");a.lblWarningDateBienesPersonalesFechaDeclaracionJurada=a.container.find(".lbl-warning-bienes-personales-fecha-declaracion-jurada-matriz-riesgo");a.lblWarningDateIngresosAnualesFechaDeclaracionJurada=a.container.find(".lbl-warning-ingresos-anuales-fecha-declaracion-jurada-matriz-riesgo");a.lblWarningDateAutonomoResponsableInscriptoFechaAltaImpuesto=a.container.find(".lbl-warning-autonomo-responsable-inscripto-fecha-alta-impuesto-matriz-riesgo");a.lblWarningDateReciboSueldoJubilacionFechaIngreso=a.container.find(".lbl-warning-recibo-sueldo-jubilacion-fecha-ingreso-matriz-riesgo");a.lblWarningDateInscripcionMonotributoFechaAltaCategoria=a.container.find(".lbl-warning-inscripcion-monotributo-fecha-alta-categoria-monotributo-matriz-riesgo");a.lblWarningDateEstadoContableFechaBalance=a.container.find(".lbl-warning-estado-contable-fecha-balance-matriz-riesgo");a.dateBienesPersonalesFechaDeclaracionJurada=a.container.find(".date-picker-bienes-personales-fecha-declaracion-jurada-matriz-riesgo");a.dateIngresosAnualesFechaDeclaracionJurada=a.container.find(".date-picker-ingresos-anuales-fecha-declaracion-jurada-matriz-riesgo");a.dateAutonomoResponsableInscriptoFechaAltaImpuesto=a.container.find(".date-picker-autonomo-responsable-inscripto-fecha-alta-impuesto-matriz-riesgo");a.dateReciboSueldoJubilacionFechaIngreso=a.container.find(".date-picker-recibo-sueldo-jubilacion-fecha-ingreso-matriz-riesgo");a.dateInscripcionMonotributoFechaAltaCategoria=a.container.find(".date-picker-inscripcion-monotributo-fecha-alta-categoria-monotributo-matriz-riesgo");a.dateEstadoContableFechaBalance=a.container.find(".date-picker-estado-contable-fecha-balance-matriz-riesgo");a.txtBienesPersonalesPatrimonioNetoTotal=a.container.find(".textbox-bienes-personales-patrimonio-neto-total-matriz-riesgo");a.txtBienesPersonalesDineroEfectivo=a.container.find(".textbox-bienes-personales-dinero-efectivo-matriz-riesgo");a.txtBienesPersonalesExcentos=a.container.find(".textbox-bienes-personales-excentos-matriz-riesgo");a.txtBienesPersonalesPerfilTransaccional=a.container.find(".textbox-bienes-personales-perfil-transaccional-matriz-riesgo");a.txtCertificacionIngresosAnualesResultadoNeto=a.container.find(".textbox-certificacion-ingresos-anuales-resultado-neto-matriz-riesgo");a.txtCertificacionIngresosAnualesPerfilTransaccional=a.container.find(".textbox-certificacion-ingresos-anuales-perfil-transaccional-matriz-riesgo");a.txtAutonomoResponsableInscriptoCategoria=a.container.find(".textbox-autonomo-responsable-inscripto-categoria-matriz-riesgo");a.txtAutonomoResponsableInscriptoIngresosMensuales=a.container.find(".textbox-autonomo-responsable-inscripto-ingresos-mensuales-matriz-riesgo");a.txtAutonomoResponsableInscriptoPerfilTransaccional=a.container.find(".textbox-autonomo-responsable-inscripto-perfil-transaccional-matriz-riesgo");a.txtReciboSueldoJubilacionNetoRecibido=a.container.find(".textbox-recibo-sueldo-jubilacion-neto-recibido-matriz-riesgo");a.txtReciboSueldoJubilacionPerfilTransaccional=a.container.find(".textbox-recibo-sueldo-jubilacion-perfil-transaccional-matriz-riesgo");a.txtInscripcionMonotributoCategoria=a.container.find(".textbox-inscripcion-monotributo-categoria-matriz-riesgo");a.txtInscripcionMonotributoPerfilTransaccional=a.container.find(".textbox-inscripcion-monotributo-perfil-transaccional-matriz-riesgo");a.txtEstadoContableActivoCorriente=a.container.find(".textbox-estado-contable-activo-corriente-matriz-riesgo");a.txtEstadoContablePasivoCorriente=a.container.find(".textbox-estado-contable-pasivo-corriente-matriz-riesgo");a.txtEstadoContableVentasNetas=a.container.find(".textbox-estado-contable-ventas-netas-matriz-riesgo");a.txtEstadoContablePerfilTransaccional=a.container.find(".textbox-estado-contable-perfil-transaccional-matriz-riesgo");a.ddlCalculoRiesgoGeografiaAltoRiesgo=a.container.find(".dropdown-calculo-riesgo-geografia-alto-riesgo-matriz-riesgo");a.divCalculoRiesgoConexionSustancialGeografiaAltoRiesgo=a.container.find(".div-calculo-riesgo-conexion-sustancial-geografia-alto-riesgo-matriz-riesgo");a.ddlCalculoRiesgoConexionSustancialGeografiaAltoRiesgo=a.container.find(".dropdown-calculo-riesgo-conexion-sustancial-geografia-alto-riesgo-matriz-riesgo");a.ddlCalculoRiesgoProductosInvertir=a.container.find(".dropdown-calculo-riesgo-productos-invertir-matriz-riesgo");a.ddlCalculoRiesgoCanalVenta=a.container.find(".dropdown-calculo-riesgo-canal-venta-matriz-riesgo");a.divVersion=a.container.find(".div-version-matriz-riesgo");a.ddlVersion=a.container.find(".dropdown-version-matriz-riesgo");a.divCalculoRiesgoTipoPersonaJuridica=a.container.find(".div-calculo-riesgo-tipo-persona-juridica-matriz-riesgo");a.btnCalculoRiesgoTipoPersonaJuridica=a.container.find(".btn-calculo-riesgo-tipo-persona-juridica-matriz-riesgo");a.ddlCalculoRiesgoTipoPersonaJuridica=a.container.find(".dropdown-calculo-riesgo-tipo-persona-juridica-matriz-riesgo");a.txtCalculoRiesgoTipoPersonaJuridicaDescripcion=a.container.find(".textbox-calculo-riesgo-tipo-persona-juridica-descripcion-matriz-riesgo");a.divContainerDataMatrizRiesgo=a.container.find(".div-container-data-matriz-riesgo");a.txtCalculoRiesgoGeografiaAltoRiesgoDescripcion=a.container.find(".textbox-calculo-riesgo-geografia-alto-riesgo-descripcion-matriz-riesgo");a.divCalculoRiesgoActividadAltoRiesgo=a.container.find(".div-calculo-riesgo-actividad-alto-riesgo-matriz-riesgo");a.divCalculoRiesgoActividadAltoRiesgo.hide();if(a.calcularMatrizManual){a.divCalculoRiesgoActividadAltoRiesgo.show()}a.ddlCalculoRiesgoActividadAltoRiesgo=a.container.find(".dropdown-calculo-riesgo-actividad-alto-riesgo-matriz-riesgo");a.txtCalculoRiesgoActividadAltoRiesgoDescripcion=a.container.find(".textbox-calculo-riesgo-actividad-alto-riesgo-descripcion-matriz-riesgo");a.txtCalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion=a.container.find(".textbox-calculo-riesgo-conexion-sustancial-geografia-alto-riesgo-descripcion-matriz-riesgo");a.txtCalculoRiesgoSujetoObligadoDescripcion=a.container.find(".textbox-calculo-riesgo-sujeto-obligado-descripcion-matriz-riesgo");a.txtCalculoRiesgoPEPDescripcion=a.container.find(".textbox-calculo-riesgo-pep-descripcion-matriz-riesgo");a.txtCalculoRiesgoAntiguedadMenor24MesesDescripcion=a.container.find(".textbox-calculo-riesgo-antiguedad-menor-24-meses-descripcion-matriz-riesgo");a.txtCalculoRiesgoPresentaInusualidadesDesfavorablesDescripcion=a.container.find(".textbox-calculo-riesgo-presenta-inusualidades-desfavorables-descripcion-matriz-riesgo");a.txtCalculoRiesgoProductosInvertirDescripcion=a.container.find(".textbox-calculo-riesgo-productos-invertir-descripcion-matriz-riesgo");a.txtCalculoRiesgoCanalVentaDescripcion=a.container.find(".textbox-calculo-riesgo-canal-venta-descripcion-matriz-riesgo");a.txtMaterialidadCuentaDescripcion=a.container.find(".textbox-materialidad-cuenta-descripcion-matriz-riesgo");a.txtCalculoRiesgoPresentoDocumentacionRespaldoDescripcion=a.container.find(".textbox-calculo-riesgo-presento-documentacion-respaldo-descripcion-matriz-riesgo");a.txtCalculoRiesgoProveedorDelEstadoDescripcion=a.container.find(".textbox-calculo-riesgo-proveedor-del-estado-descripcion-matriz-riesgo");a.txtCalculoRiesgoNoticasAdversasPlaftDescripcion=a.container.find(".textbox-calculo-riesgo-noticias-adversas-plaft-descripcion-matriz-riesgo");a.txtCalculoRiesgoEsTerroristaDescripcion=a.container.find(".textbox-calculo-riesgo-es-terrorista-descripcion-matriz-riesgo");a.txtObservaciones=a.container.find(".textbox-observaciones-matriz-riesgo");a.txtPerfilTransaccionalTotal=a.container.find(".textbox-perfil-transaccional-total-matriz-riesgo");a.lblWarningPerfilTransaccionalResultante=a.container.find(".lbl-warning-perfil-transaccional-matriz-riesgo");a.lblWatningRecalcularRiesgo=a.container.find(".lbl-warning-recalcular-matriz-riesgo");a.lblWatningRecalcularRiesgo.hide();a.lblResultado=a.container.find(".lbl-resultado-matriz-riesgo");a.txtMaterialidadCuenta=a.container.find(".textbox-materialidad-cuenta-matriz-riesgo");a.btnVolver=a.container.find(".btn-volver-matriz-riesgo");a.btnGuardarYCerrar=a.container.find(".btn-guardar-cerrar-matriz-riesgo");a.btnCalcular=a.container.find(".btn-calcular-matriz-riesgo");a.btnGenerarNueva=a.container.find(".btn-generar-nueva");a.btnDescargarMatriz=a.container.find(".btn-descargar-matriz-riesgo");a.btnRefrescarPerfilTransaccional=a.container.find(".btn-refrescar-perfil-transaccional-matriz-riesgo");a.divAlert=a.container.find(".div-alert-matriz-riesgo");a.divInformes=a.container.find(".div-informes-matriz-riesgo");a.btnNosis=a.container.find(".button-consultar-nosis-matriz-riesgo");a.divAlert.slideUp();a.txtDescripcion.shieldTextBox({enabled:a.calcularMatrizManual});a.txtIdentificacionFiscal.shieldTextBox({enabled:a.calcularMatrizManual});a.txtClienteDesde.shieldTextBox({enabled:a.calcularMatrizManual});a.txtFechaEmision.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],enabled:a.calcularMatrizManual});a.controlNseValor=new Core.Controls.DecimalPicker(a.lblNseValor,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz()}});a.divTipoPersona.removeClass("disabled");if(a.origenApertura){a.divTipoPersona.addClass("disabled")}if(!a.chkTipoPersonaFisica.swidget()){a.chkTipoPersonaFisica.shieldRadioButton({label:"Persona Física",enabled:!a.origenApertura,events:{click:function(f){a.setQuestions();a.setWarningPerfilTransaccionalResultante();a.clearResultadoMatriz()}}})}if(!a.chkTipoPersonaJuridica.swidget()){a.chkTipoPersonaJuridica.shieldRadioButton({label:"Persona Jurídica",enabled:!a.origenApertura,events:{click:function(f){a.setQuestions();a.setWarningPerfilTransaccionalResultante();a.clearResultadoMatriz()}}})}a.chkBienesPersonalesGanancias.shieldCheckBox({label:"Bienes Personales ó Ganancias (Total Patrimonio Neto al cierre)",events:{click:function(f){if(a.chkBienesPersonalesGanancias.swidget().checked()){a.divDataBienesPersonalesGanancias.show()}else{a.divDataBienesPersonalesGanancias.hide()}a.setWarningPerfilTransaccionalResultante();a.clearResultadoMatriz()}}});a.chkCertificacionIngresosAnuales.shieldCheckBox({label:"Certificación de Ingresos anuales ó Ganancias 4ta. Categoría",events:{click:function(f){if(a.chkCertificacionIngresosAnuales.swidget().checked()){a.divDataCertificacionIngresosAnuales.show()}else{a.divDataCertificacionIngresosAnuales.hide()}a.setWarningPerfilTransaccionalResultante();a.clearResultadoMatriz()}}});a.chkAutonomoResponsableInscripto.shieldCheckBox({label:"Autónomo / Responsable Inscripto",events:{click:function(f){if(a.chkAutonomoResponsableInscripto.swidget().checked()){a.divDataAutonomoResponsableInscripto.show()}else{a.divDataAutonomoResponsableInscripto.hide()}a.setWarningPerfilTransaccionalResultante();a.clearResultadoMatriz()}}});a.chkGrupoActividadesSociedadesComercialesCiviles.shieldCheckBox({label:"Dirección, administración, o conducción de sociedades comerciales o civiles, regulares o irregulares, y socios de sociedades de cualquier tipo",events:{click:function(f){a.clearResultadoMatriz()}}});a.chkGrupoActividadesLocacionesPrestacionesServicios.shieldCheckBox({label:"Actividades no incluidas en el punto anterior, que constituyan locaciones o prestaciones de servicios",events:{click:function(f){a.clearResultadoMatriz()}}});a.chkGrupoActividadesRestoDeActividades.shieldCheckBox({label:"Resto de las actividades no  comprendidas en los puntos anteriores",events:{click:function(f){a.clearResultadoMatriz()}}});a.chkGrupoActividadesAfiliacionesVoluntarias.shieldCheckBox({label:"Afiliaciones voluntarias",events:{click:function(f){a.clearResultadoMatriz()}}});a.chkGrupoActividadesMenores.shieldCheckBox({label:"Menores de 18 hasta 21 años",events:{click:function(f){a.clearResultadoMatriz()}}});a.chkGrupoActividadesJubilados.shieldCheckBox({label:"Jubilados por la Ley 24.241",events:{click:function(f){a.clearResultadoMatriz()}}});a.chkGrupoActividadesAmasDeCasa.shieldCheckBox({label:"Amas de casa que opten por el aporte reducido previsto en la Ley 24.828",events:{click:function(f){a.clearResultadoMatriz()}}});a.chkReciboSueldoJubilacion.shieldCheckBox({label:"Recibo de Sueldo / Jubilación",events:{click:function(f){if(a.chkReciboSueldoJubilacion.swidget().checked()){a.divDataReciboSueldoJubilacion.show()}else{a.divDataReciboSueldoJubilacion.hide()}a.setWarningPerfilTransaccionalResultante();a.clearResultadoMatriz()}}});a.chkInscripcionMonotributo.shieldCheckBox({label:"Constancia de Inscripción Monotributo",events:{click:function(f){if(a.chkInscripcionMonotributo.swidget().checked()){a.divDataInscripcionMonotributo.show()}else{a.divDataInscripcionMonotributo.hide()}a.setWarningPerfilTransaccionalResultante();a.clearResultadoMatriz()}}});a.chkEstadoContable.shieldCheckBox({label:"Estados Contables",events:{click:function(f){if(a.chkEstadoContable.swidget().checked()){a.divDataEstadoContable.show()}else{a.divDataEstadoContable.hide()}a.setWarningPerfilTransaccionalResultante();a.clearResultadoMatriz()}}});if(!a.chkCalculoRiesgoSujetoObligadoNo.swidget()){a.chkCalculoRiesgoSujetoObligadoNo.shieldRadioButton({label:"NO",events:{click:function(f){a.clearResultadoMatriz()}}})}if(!a.chkCalculoRiesgoSujetoObligadoSi.swidget()){a.chkCalculoRiesgoSujetoObligadoSi.shieldRadioButton({label:"SI",events:{click:function(f){a.clearResultadoMatriz()}}})}if(!a.chkCalculoRiesgoPEPNo.swidget()){a.chkCalculoRiesgoPEPNo.shieldRadioButton({label:"NO",events:{click:function(f){a.clearResultadoMatriz()}}})}if(!a.chkCalculoRiesgoPEPSi.swidget()){a.chkCalculoRiesgoPEPSi.shieldRadioButton({label:"SI",events:{click:function(f){a.clearResultadoMatriz()}}})}if(!a.chkCalculoRiesgoAntiguedadMenor24MesesNo.swidget()){a.chkCalculoRiesgoAntiguedadMenor24MesesNo.shieldRadioButton({label:"NO",events:{click:function(f){a.clearResultadoMatriz()}}})}if(!a.chkCalculoRiesgoAntiguedadMenor24MesesSi.swidget()){a.chkCalculoRiesgoAntiguedadMenor24MesesSi.shieldRadioButton({label:"SI",events:{click:function(f){a.clearResultadoMatriz()}}})}if(!a.chkCalculoRiesgoPresentaInusualidadesDesfavorablesNo.swidget()){a.chkCalculoRiesgoPresentaInusualidadesDesfavorablesNo.shieldRadioButton({label:"NO",events:{click:function(f){a.clearResultadoMatriz()}}})}if(!a.chkCalculoRiesgoPresentaInusualidadesDesfavorablesSi.swidget()){a.chkCalculoRiesgoPresentaInusualidadesDesfavorablesSi.shieldRadioButton({label:"SI",events:{click:function(f){a.clearResultadoMatriz()}}})}if(!a.chkCalculoRiesgoPresentoDocumentacionRespaldoNo.swidget()){a.chkCalculoRiesgoPresentoDocumentacionRespaldoNo.shieldRadioButton({label:"NO",events:{click:function(f){a.clearResultadoMatriz()}}})}if(!a.chkCalculoRiesgoPresentoDocumentacionRespaldoSi.swidget()){a.chkCalculoRiesgoPresentoDocumentacionRespaldoSi.shieldRadioButton({label:"SI",events:{click:function(f){a.clearResultadoMatriz()}}})}if(!a.chkCalculoRiesgoProveedorDelEstadoNo.swidget()){a.chkCalculoRiesgoProveedorDelEstadoNo.shieldRadioButton({label:"NO",events:{click:function(f){a.clearResultadoMatriz()}}})}if(!a.chkCalculoRiesgoProveedorDelEstadoSi.swidget()){a.chkCalculoRiesgoProveedorDelEstadoSi.shieldRadioButton({label:"SI",events:{click:function(f){a.clearResultadoMatriz()}}})}if(!a.chkCalculoRiesgoNoticiasAdversasPlaftNo.swidget()){a.chkCalculoRiesgoNoticiasAdversasPlaftNo.shieldRadioButton({label:"NO",events:{click:function(f){a.clearResultadoMatriz()}}})}if(!a.chkCalculoRiesgoNoticiasAdversasPlaftSi.swidget()){a.chkCalculoRiesgoNoticiasAdversasPlaftSi.shieldRadioButton({label:"SI",events:{click:function(f){a.clearResultadoMatriz()}}})}if(!a.chkCalculoRiesgoEsTerroristaNo.swidget()){a.chkCalculoRiesgoEsTerroristaNo.shieldRadioButton({label:"NO",events:{click:function(f){a.clearResultadoMatriz()}}})}if(!a.chkCalculoRiesgoEsTerroristaSi.swidget()){a.chkCalculoRiesgoEsTerroristaSi.shieldRadioButton({label:"SI",events:{click:function(f){a.clearResultadoMatriz()}}})}a.dateBienesPersonalesFechaDeclaracionJurada.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],max:new Date(),events:{change:function(f){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}}});a.dateIngresosAnualesFechaDeclaracionJurada.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],max:new Date(),events:{change:function(f){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}}});a.dateAutonomoResponsableInscriptoFechaAltaImpuesto.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],max:new Date(),events:{change:function(f){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}}});a.dateReciboSueldoJubilacionFechaIngreso.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],max:new Date(),events:{change:function(f){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}}});a.dateInscripcionMonotributoFechaAltaCategoria.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],max:new Date(),events:{change:function(f){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}}});a.dateEstadoContableFechaBalance.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],max:new Date(),events:{change:function(f){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}}});a.lblWarningDateBienesPersonalesFechaDeclaracionJurada.text("");a.lblWarningDateIngresosAnualesFechaDeclaracionJurada.text("");a.lblWarningDateAutonomoResponsableInscriptoFechaAltaImpuesto.text("");a.lblWarningDateReciboSueldoJubilacionFechaIngreso.text("");a.lblWarningDateInscripcionMonotributoFechaAltaCategoria.text("");a.lblWarningDateEstadoContableFechaBalance.text("");a.controlBienesPersonalesPatrimonioNetoTotal=new Core.Controls.DecimalPicker(a.txtBienesPersonalesPatrimonioNetoTotal,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}});a.controlBienesPersonalesDineroEfectivo=new Core.Controls.DecimalPicker(a.txtBienesPersonalesDineroEfectivo,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}});a.controlBienesPersonalesExcentos=new Core.Controls.DecimalPicker(a.txtBienesPersonalesExcentos,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}});a.controlBienesPersonalesPerfilTransaccional=new Core.Controls.DecimalPicker(a.txtBienesPersonalesPerfilTransaccional,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz()}});a.controlCertificacionIngresosAnualesResultadoNeto=new Core.Controls.DecimalPicker(a.txtCertificacionIngresosAnualesResultadoNeto,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}});a.controlIngresosAnualesPerfilTransaccional=new Core.Controls.DecimalPicker(a.txtCertificacionIngresosAnualesPerfilTransaccional,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz()}});a.txtAutonomoResponsableInscriptoCategoria.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}}});a.controlAutonomoResponsableInscriptoIngresosMensuales=new Core.Controls.DecimalPicker(a.txtAutonomoResponsableInscriptoIngresosMensuales,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}});a.controlAutonomoResponsableInscriptoPerfilTransaccional=new Core.Controls.DecimalPicker(a.txtAutonomoResponsableInscriptoPerfilTransaccional,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz()}});a.controlReciboSueldoJubilacionNetoRecibido=new Core.Controls.DecimalPicker(a.txtReciboSueldoJubilacionNetoRecibido,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}});a.controlReciboSueldoJubilacionPerfilTransaccional=new Core.Controls.DecimalPicker(a.txtReciboSueldoJubilacionPerfilTransaccional,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz()}});a.txtInscripcionMonotributoCategoria.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}}});a.controlInscripcionMonotributoPerfilTransaccional=new Core.Controls.DecimalPicker(a.txtInscripcionMonotributoPerfilTransaccional,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz()}});a.controlEstadoContableActivoCorriente=a.controlEstadoContableActivoCorriente=new Core.Controls.DecimalPicker(a.txtEstadoContableActivoCorriente,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}});a.controlEstadoContablePasivoCorriente=new Core.Controls.DecimalPicker(a.txtEstadoContablePasivoCorriente,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}});a.controlEstadoContableVentasNetas=new Core.Controls.DecimalPicker(a.txtEstadoContableVentasNetas,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}});a.controlEstadoContablePerfilTransaccional=new Core.Controls.DecimalPicker(a.txtEstadoContablePerfilTransaccional,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz()}});a.controlMaterialidadCuenta=new Core.Controls.DecimalPicker(a.txtMaterialidadCuenta,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz()}});a.ddlCalculoRiesgoGeografiaAltoRiesgo.shieldDropDown({dataSource:{data:a.dataParametrosUsuario.geografiaDeRiesgo},valueTemplate:"{idGeografiaDeRiesgo}",textTemplate:"{Descripcion}",events:{select:function(f){a.clearResultadoMatriz()}}});a.ddlCalculoRiesgoConexionSustancialGeografiaAltoRiesgo.shieldDropDown({dataSource:{data:a.dataParametrosUsuario.geografiaDeRiesgo},valueTemplate:"{idGeografiaDeRiesgo}",textTemplate:"{Descripcion}",events:{select:function(f){a.clearResultadoMatriz()}}});a.ddlCalculoRiesgoTipoPersonaJuridica.shieldDropDown({dataSource:{data:a.dataParametrosUsuario.riesgo},valueTemplate:"{idRiesgo}",textTemplate:"{RiesgoDescripcion}",events:{select:function(f){a.clearResultadoMatriz()}}});a.ddlCalculoRiesgoProductosInvertir.shieldDropDown({dataSource:{data:a.dataParametrosUsuario.riesgoProductosInversion},valueTemplate:"{idRiesgoProductoInversion}",textTemplate:"{RiesgoDescripcion}",events:{select:function(f){a.clearResultadoMatriz()}}});a.ddlCalculoRiesgoCanalVenta.shieldDropDown({dataSource:{data:a.dataParametrosUsuario.canalDeVenta},valueTemplate:"{idCanalDeVenta}",textTemplate:"{Descripcion}",events:{select:function(f){a.clearResultadoMatriz()}}});a.ddlVersion.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idVersion}",textTemplate:"{Descripcion}",events:{select:function(f){a.loadData(a.ddlVersion.swidget().value())}}});a.txtCalculoRiesgoGeografiaAltoRiesgoDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.ddlCalculoRiesgoActividadAltoRiesgo.shieldDropDown({dataSource:{data:[]},valueTemplate:"{value}",textTemplate:"{Descripcion}"});a.txtCalculoRiesgoActividadAltoRiesgoDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.txtCalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.txtCalculoRiesgoTipoPersonaJuridicaDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.txtCalculoRiesgoSujetoObligadoDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.txtCalculoRiesgoPEPDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.txtCalculoRiesgoAntiguedadMenor24MesesDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.txtCalculoRiesgoPresentaInusualidadesDesfavorablesDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.txtCalculoRiesgoProductosInvertirDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.txtCalculoRiesgoCanalVentaDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.txtMaterialidadCuentaDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.txtCalculoRiesgoPresentoDocumentacionRespaldoDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.txtCalculoRiesgoProveedorDelEstadoDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.txtCalculoRiesgoNoticasAdversasPlaftDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.txtCalculoRiesgoEsTerroristaDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.txtObservaciones.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.controlPerfilTransaccionalTotal=new Core.Controls.DecimalPicker(a.txtPerfilTransaccionalTotal,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.controlMaterialidadCuenta.setValue(a.txtPerfilTransaccionalTotal.val());a.clearResultadoMatriz()}});a.btnCalculoRiesgoTipoPersonaJuridica.unbind("click");a.btnCalculoRiesgoTipoPersonaJuridica.click(function(){var g="";g+="<table class='table table-striped'>";g+="<thead><tr><th>Tipo de Jurídica</th><th>Riesgo</th></tr></thead>";g+="<tbody>";g+="<tr>";g+="<td>SAS y Sociedades de Hecho</td>";g+="<td>Medio Bajo</td>";g+="</tr>";g+="<tr>";g+="<td>S.A., S.R.L., Sociedad en Comandita por Acciones, Sociedades Colectivas, UTEs</td>";g+="<td>Medio Bajo</td>";g+="</tr>";g+="<tr>";g+="<td>Asociaciones civiles, mutuales, cooperativas y fundaciones</td>";g+="<td>Medio Bajo</td>";g+="</tr>";g+="<tr>";g+="<td>Entidades públicas y/ó capital mixto, cajas de prevensión</td>";g+="<td>Alto</td>";g+="</tr>";g+="<tr>";g+="<td>Entidades extranjeras</td>";g+="<td>Medio Alto</td>";g+="</tr>";g+="<tr>";g+="<td>Otras</td>";g+="<td>Medio Alto</td>";g+="</tr>";g+="</tbody>";g+="</table>";var f=new Core.Controls.Dialog("Ayuda",g,{displayButtons:{close:true,accept:false}});f.show()});a.btnCalcular.unbind("click");a.btnCalcular.click(function(){var f=a.getData(true,false);if(f){var g=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"matrizderiesgo/calcular/riesgo",requestType:"POST",requestData:f});g.onSuccess=function(h){a.lblResultado.html((h.datos[0]&&h.datos[0].ResultadoRiesgoDescripcion)?h.datos[0].ResultadoRiesgoDescripcion:"");a.resultadoMatriz=h;a.lblWatningRecalcularRiesgo.hide()};g.request()}});a.btnGenerarNueva.unbind("click");a.btnGenerarNueva.click(function(){a.loadData(null,true)});a.btnDescargarMatriz.unbind("click");a.btnDescargarMatriz.click(function(){function g(o){var n=new Blob([o.response],{type:o.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(n);return}var h=window.URL.createObjectURL(n);var m=document.createElement("a");m.href=h;var k=o.getResponseHeader("Content-Disposition").split("; ");var j="filename=matriz.pdf";for(var l=0;l<k.length;l++){if(k[l].indexOf("filename")>=0){j=k[l]}}m.download=j.split("=")[1];m.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(h)}var f=new XMLHttpRequest();f.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"descargar/14/"+a.cuilCuit+"?Version="+a.ddlVersion.swidget().value(),true);f.responseType="blob";f.setRequestHeader("Authorization",Core.Objects.Context.Token);f.onload=function(h){if(f.status==200){g(f)}else{var i=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga de la matriz.</p>",{displayButtons:{close:true,accept:false}});i.show()}};f.send()});a.btnRefrescarPerfilTransaccional.unbind("click");a.btnRefrescarPerfilTransaccional.click(function(){var f=a.getData(false,true);if(f){var g=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"matrizderiesgo/calcular/perfil",requestType:"POST",requestData:f});g.onSuccess=function(h){a.controlBienesPersonalesPerfilTransaccional.setValue((h.datos[0]&&h.datos[0].BsPersPerfilTransaccional)?h.datos[0].BsPersPerfilTransaccional:"");a.controlAutonomoResponsableInscriptoPerfilTransaccional.setValue((h.datos[0]&&h.datos[0].AutonomoPerfilTransaccional)?h.datos[0].AutonomoPerfilTransaccional:"");a.controlEstadoContablePerfilTransaccional.setValue((h.datos[0]&&h.datos[0].EstadosContablesPerfilTransaccional)?h.datos[0].EstadosContablesPerfilTransaccional:"");a.controlIngresosAnualesPerfilTransaccional.setValue((h.datos[0]&&h.datos[0].CertificacionIngresoPerfilTransaccional)?h.datos[0].CertificacionIngresoPerfilTransaccional:"");a.controlInscripcionMonotributoPerfilTransaccional.setValue((h.datos[0]&&h.datos[0].MonotributoPerfilTransaccional)?h.datos[0].MonotributoPerfilTransaccional:"");a.controlReciboSueldoJubilacionPerfilTransaccional.setValue((h.datos[0]&&h.datos[0].ReciboDeSueldoPerfilTransaccional)?h.datos[0].ReciboDeSueldoPerfilTransaccional:"");a.controlPerfilTransaccionalTotal.setValue((h.datos[0]&&h.datos[0].PerfilTransaccionalTotal)?h.datos[0].PerfilTransaccionalTotal:"");a.controlMaterialidadCuenta.setValue(a.txtPerfilTransaccionalTotal.val());a.lblWarningPerfilTransaccionalResultante.html((h.datos[0]&&h.datos[0].TextoPerfilResultante)?('<i class="fa fa-exclamation-triangle" aria-hidden="true"></i> '+h.datos[0].TextoPerfilResultante):"");a.lblWarningDateBienesPersonalesFechaDeclaracionJurada.text((h.datos[0]&&h.datos[0].BsPersFechaVencida)?h.datos[0].BsPersFechaVencida:"");a.lblWarningDateIngresosAnualesFechaDeclaracionJurada.text((h.datos[0]&&h.datos[0].CertificacionIngresoFechaVencida)?h.datos[0].CertificacionIngresoFechaVencida:"");a.lblWarningDateAutonomoResponsableInscriptoFechaAltaImpuesto.text((h.datos[0]&&h.datos[0].AutonomoFechaVencida)?h.datos[0].AutonomoFechaVencida:"");a.lblWarningDateReciboSueldoJubilacionFechaIngreso.text((h.datos[0]&&h.datos[0].ReciboDeSueldoFechaVencida)?h.datos[0].ReciboDeSueldoFechaVencida:"");a.lblWarningDateInscripcionMonotributoFechaAltaCategoria.text((h.datos[0]&&h.datos[0].MonotributoFechaVencida)?h.datos[0].MonotributoFechaVencida:"");a.lblWarningDateEstadoContableFechaBalance.text((h.datos[0]&&h.datos[0].EstadosContablesFechaVencida)?h.datos[0].EstadosContablesFechaVencida:"")};g.request()}});a.btnGuardarYCerrar.unbind("click");a.btnGuardarYCerrar.click(function(){var f=a.getData(false,false);if(f){new Core.Controls.Confirmation("Confirmación","¿Esta seguro que desea generar una nueva versión de la Matriz de Riesgo?",{onAccepted:function(){var g=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"matrizderiesgo/actualizar",requestType:"POST",requestData:f});g.onSuccess=function(){a.onSave(Core.Functions.Decimal.parseFloat(a.txtPerfilTransaccionalTotal.val()),a.resultadoMatriz.datos[0].ResultadoIdRiesgo);a.container.modal("hide");a.destroy()};g.request()}}).show()}});a.btnGuardarYCerrar.hide();a.btnCalcular.hide();a.btnRefrescarPerfilTransaccional.hide();a.btnGenerarNueva.hide();a.btnVolver.unbind("click");a.btnVolver.click(function(){a.container.modal("hide");a.destroy()});a.btnVolver.show();if(!a.origenApertura){a.btnVolver.hide()}a.loadData()}})};a.loadData=function(h,d){var f="matrizderiesgo/";var c=false;if(!a.calcularMatrizManual){if(!d&&(a.consultarMatriz||(h&&h!=a.ultimaVersion))){f+=("datos/"+a.cuilCuit)}else{f+="precargar/";if(a.idAperturaCuenta!=null&&a.tipo!=null&&a.numero!=null){f+=("persona/"+a.idAperturaCuenta+"/"+a.tipo+"/"+a.numero)}else{f+=("cuil/"+a.cuilCuit)}c=true}}a.btnGuardarYCerrar.hide();a.btnCalcular.hide();a.btnRefrescarPerfilTransaccional.hide();a.btnGenerarNueva.hide();if(a.calcularMatrizManual){a.btnRefrescarPerfilTransaccional.show();a.btnCalcular.show()}else{if(!a.readOnly){a.btnGenerarNueva.show();if(c){a.btnGenerarNueva.hide();if(a.pageOptions&&a.pageOptions.matrizDeRiesgoEditar){a.btnGuardarYCerrar.show()}a.btnCalcular.show();a.btnRefrescarPerfilTransaccional.show()}}}a.divContainerDataMatrizRiesgo.show();a.divVersion.show();a.btnDescargarMatriz.show();if(a.calcularMatrizManual||c){a.divVersion.hide();a.btnDescargarMatriz.hide()}if(a.calcularMatrizManual){a.dataMatriz={datos:[]};a.setData()}else{var e={showOverlay:true,secureRequest:true,requestUrl:f,requestType:"GET"};if(h){e.requestData={Version:h}}var g=new Core.Ajax.ServerRequest(e);g.onSuccess=function(l){a.dataMatriz=l;if(!a.ultimaVersion){a.ultimaVersion=l.versiones&&a.dataMatriz.versiones.length?a.dataMatriz.versiones.length:1;var n=[];for(var j=0;j<a.ultimaVersion;j++){var m=l.versiones?a.dataMatriz.versiones[j]:null;n.push({idVersion:(m?m.Version:1),Descripcion:("Versión "+((m)?(m.Version+" | "+m.Usuario+" | "+m.Fecha):"1"))})}var k=a.ddlVersion.swidget().initialOptions;k.dataSource.data=n;k.value=a.ultimaVersion.toString();a.ddlVersion.swidget().refresh(k);if(!a.dataMatriz.datos[0]||!a.dataMatriz.datos[0].CUIT_CUIL||a.dataMatriz.datos[0].CUIT_CUIL==""){a.divVersion.hide();a.btnDescargarMatriz.hide();a.divContainerDataMatrizRiesgo.hide()}}a.setData()};g.request()}};a.setData=function(){a.txtDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].Nombre)?a.dataMatriz.datos[0].Nombre:"");Core.Functions.Validations.toggleValidation(a.txtDescripcion,false);a.txtIdentificacionFiscal.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CUIT_CUIL)?a.dataMatriz.datos[0].CUIT_CUIL:"");Core.Functions.Validations.toggleValidation(a.txtIdentificacionFiscal,false);a.txtClienteDesde.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].Fecha1raApertura)?a.dataMatriz.datos[0].Fecha1raApertura:"");Core.Functions.Validations.toggleValidation(a.txtClienteDesde,false);a.txtFechaEmision.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].FechaEmision)?a.getDate(a.dataMatriz.datos[0].FechaEmision):new Date());Core.Functions.Validations.toggleValidation(a.txtFechaEmision,false);a.lblNseDescripcion.text(((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].NSEValor)?(a.dataMatriz.datos[0].NSEValor+" - "):"Sin información")+((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].NSEAntiguedad)?(a.dataMatriz.datos[0].NSEAntiguedad+"  meses de antigüedad"):""));a.lblResultado.html((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].ResultadoRiesgoDescripcion)?a.dataMatriz.datos[0].ResultadoRiesgoDescripcion:"");if(a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].ResultadoRiesgoDescripcion){a.resultadoMatriz={datos:[{}]};a.resultadoMatriz.datos[0].ResultadoRiesgoDescripcion=a.dataMatriz.datos[0].ResultadoRiesgoDescripcion;a.resultadoMatriz.datos[0].ResultadoRiesgoValor=a.dataMatriz.datos[0].ResultadoRiesgoValor;a.resultadoMatriz.datos[0].ResultadoIdRiesgo=a.dataMatriz.datos[0].ResultadoIdRiesgo;a.lblWatningRecalcularRiesgo.hide()}else{a.resultadoMatriz=null;a.lblWatningRecalcularRiesgo.show()}a.chkTipoPersonaFisica.swidget().checked(false);a.chkTipoPersonaJuridica.swidget().checked(false);a.chkCalculoRiesgoSujetoObligadoSi.swidget().checked(false);a.chkCalculoRiesgoSujetoObligadoNo.swidget().checked(false);a.chkCalculoRiesgoPEPSi.swidget().checked(false);a.chkCalculoRiesgoPEPNo.swidget().checked(false);a.chkCalculoRiesgoAntiguedadMenor24MesesSi.swidget().checked(false);a.chkCalculoRiesgoAntiguedadMenor24MesesNo.swidget().checked(false);a.chkCalculoRiesgoPresentaInusualidadesDesfavorablesSi.swidget().checked(false);a.chkCalculoRiesgoPresentaInusualidadesDesfavorablesNo.swidget().checked(false);a.chkCalculoRiesgoPresentoDocumentacionRespaldoSi.swidget().checked(false);a.chkCalculoRiesgoPresentoDocumentacionRespaldoNo.swidget().checked(false);a.chkCalculoRiesgoNoticiasAdversasPlaftSi.swidget().checked(false);a.chkCalculoRiesgoNoticiasAdversasPlaftNo.swidget().checked(false);a.chkCalculoRiesgoEsTerroristaSi.swidget().checked(false);a.chkCalculoRiesgoEsTerroristaNo.swidget().checked(false);a.chkCalculoRiesgoProveedorDelEstadoNo.swidget().checked(false);a.chkCalculoRiesgoProveedorDelEstadoSi.swidget().checked(false);if(a.dataMatriz.datos[0]){if(a.dataMatriz.datos[0].EsPersonaFisica!=null){if(a.dataMatriz.datos[0].EsPersonaFisica==1){a.chkTipoPersonaFisica.swidget().checked(true)}else{if(a.dataMatriz.datos[0].EsPersonaFisica==0){a.chkTipoPersonaJuridica.swidget().checked(true)}}}if(a.dataMatriz.datos[0].CalculoRiesgoEsSujetoObligado!=null){if(a.dataMatriz.datos[0].CalculoRiesgoEsSujetoObligado==1){a.chkCalculoRiesgoSujetoObligadoSi.swidget().checked(true)}else{if(a.dataMatriz.datos[0].CalculoRiesgoEsSujetoObligado==0){a.chkCalculoRiesgoSujetoObligadoNo.swidget().checked(true)}}}if(a.dataMatriz.datos[0].CalculoRiesgoEsPEP!=null){if(a.dataMatriz.datos[0].CalculoRiesgoEsPEP==1){a.chkCalculoRiesgoPEPSi.swidget().checked(true)}else{if(a.dataMatriz.datos[0].CalculoRiesgoEsPEP==0){a.chkCalculoRiesgoPEPNo.swidget().checked(true)}}}if(a.dataMatriz.datos[0].CalculoRiesgoAntiguedadMenor24Meses!=null){if(a.dataMatriz.datos[0].CalculoRiesgoAntiguedadMenor24Meses==1){a.chkCalculoRiesgoAntiguedadMenor24MesesSi.swidget().checked(true)}else{if(a.dataMatriz.datos[0].CalculoRiesgoAntiguedadMenor24Meses==0){a.chkCalculoRiesgoAntiguedadMenor24MesesNo.swidget().checked(true)}}}if(a.dataMatriz.datos[0].CalculoRiesgoPresentaInusualidadesDesfavorables!=null){if(a.dataMatriz.datos[0].CalculoRiesgoPresentaInusualidadesDesfavorables==1){a.chkCalculoRiesgoPresentaInusualidadesDesfavorablesSi.swidget().checked(true)}else{if(a.dataMatriz.datos[0].CalculoRiesgoPresentaInusualidadesDesfavorables==0){a.chkCalculoRiesgoPresentaInusualidadesDesfavorablesNo.swidget().checked(true)}}}if(a.dataMatriz.datos[0].CalculoRiesgoDocumentacionDeRespaldo!=null){if(a.dataMatriz.datos[0].CalculoRiesgoDocumentacionDeRespaldo==1){a.chkCalculoRiesgoPresentoDocumentacionRespaldoSi.swidget().checked(true)}else{if(a.dataMatriz.datos[0].CalculoRiesgoDocumentacionDeRespaldo==0){a.chkCalculoRiesgoPresentoDocumentacionRespaldoNo.swidget().checked(true)}}}if(a.dataMatriz.datos[0].CalculoRiesgoNoticiasAdversasPLAFT!=null){if(a.dataMatriz.datos[0].CalculoRiesgoNoticiasAdversasPLAFT==1){a.chkCalculoRiesgoNoticiasAdversasPlaftSi.swidget().checked(true)}else{if(a.dataMatriz.datos[0].CalculoRiesgoNoticiasAdversasPLAFT==0){a.chkCalculoRiesgoNoticiasAdversasPlaftNo.swidget().checked(true)}}}if(a.dataMatriz.datos[0].CalculoRiesgoEsTerrorista!=null){if(a.dataMatriz.datos[0].CalculoRiesgoEsTerrorista==1){a.chkCalculoRiesgoEsTerroristaSi.swidget().checked(true)}else{if(a.dataMatriz.datos[0].CalculoRiesgoEsTerrorista==0){a.chkCalculoRiesgoEsTerroristaNo.swidget().checked(true)}}}if(a.dataMatriz.datos[0].CalculoRiesgoEsProveedorDelEstado!=null){if(a.dataMatriz.datos[0].CalculoRiesgoEsProveedorDelEstado==1){a.chkCalculoRiesgoProveedorDelEstadoSi.swidget().checked(true)}else{if(a.dataMatriz.datos[0].CalculoRiesgoEsProveedorDelEstado==0){a.chkCalculoRiesgoProveedorDelEstadoNo.swidget().checked(true)}}}}else{if(a.calcularMatrizManual){a.chkTipoPersonaJuridica.swidget().checked(true)}}a.chkBienesPersonalesGanancias.swidget().checked(false);if(a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].BsPers){a.chkBienesPersonalesGanancias.swidget().checked(true)}if(a.chkBienesPersonalesGanancias.swidget().checked()){a.divDataBienesPersonalesGanancias.show()}else{a.divDataBienesPersonalesGanancias.hide()}a.chkCertificacionIngresosAnuales.swidget().checked(false);if(a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CertificacionIngresos){a.chkCertificacionIngresosAnuales.swidget().checked(true)}if(a.chkCertificacionIngresosAnuales.swidget().checked()){a.divDataCertificacionIngresosAnuales.show()}else{a.divDataCertificacionIngresosAnuales.hide()}a.chkAutonomoResponsableInscripto.swidget().checked(false);if(a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].Autonomo){a.chkAutonomoResponsableInscripto.swidget().checked(true)}if(a.chkAutonomoResponsableInscripto.swidget().checked()){a.divDataAutonomoResponsableInscripto.show()}else{a.divDataAutonomoResponsableInscripto.hide()}a.chkGrupoActividadesSociedadesComercialesCiviles.swidget().checked(false);if(a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].AutonomoActividadSociedades){a.chkGrupoActividadesSociedadesComercialesCiviles.swidget().checked(true)}a.chkGrupoActividadesLocacionesPrestacionesServicios.swidget().checked(false);if(a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].AutonomoActividadLocaciones){a.chkGrupoActividadesLocacionesPrestacionesServicios.swidget().checked(true)}a.chkGrupoActividadesRestoDeActividades.swidget().checked(false);if(a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].AutonomoActividadResto){a.chkGrupoActividadesRestoDeActividades.swidget().checked(true)}a.chkGrupoActividadesAfiliacionesVoluntarias.swidget().checked(false);if(a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].AutonomoActividadAfiliacionesVoluntarias){a.chkGrupoActividadesAfiliacionesVoluntarias.swidget().checked(true)}a.chkGrupoActividadesMenores.swidget().checked(false);if(a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].AutonomoActividadMenor21){a.chkGrupoActividadesMenores.swidget().checked(true)}a.chkGrupoActividadesJubilados.swidget().checked(false);if(a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].AutonomoActividadJubilados){a.chkGrupoActividadesJubilados.swidget().checked(true)}a.chkGrupoActividadesAmasDeCasa.swidget().checked(false);if(a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].AutonomoActividadAmaDeCasa){a.chkGrupoActividadesAmasDeCasa.swidget().checked(true)}a.chkReciboSueldoJubilacion.swidget().checked(false);if(a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].ReciboDeSueldo){a.chkReciboSueldoJubilacion.swidget().checked(true)}if(a.chkReciboSueldoJubilacion.swidget().checked()){a.divDataReciboSueldoJubilacion.show()}else{a.divDataReciboSueldoJubilacion.hide()}a.chkInscripcionMonotributo.swidget().checked(false);if(a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].Monotributo){a.chkInscripcionMonotributo.swidget().checked(true)}if(a.chkInscripcionMonotributo.swidget().checked()){a.divDataInscripcionMonotributo.show()}else{a.divDataInscripcionMonotributo.hide()}a.chkEstadoContable.swidget().checked(false);if(a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].EstadosContables){a.chkEstadoContable.swidget().checked(true)}if(a.chkEstadoContable.swidget().checked()){a.divDataEstadoContable.show()}else{a.divDataEstadoContable.hide()}a.dateBienesPersonalesFechaDeclaracionJurada.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].BsPersFechaDeclaracion)?a.getDate(a.dataMatriz.datos[0].BsPersFechaDeclaracion):new Date());Core.Functions.Validations.toggleValidation(a.dateBienesPersonalesFechaDeclaracionJurada,false);a.dateIngresosAnualesFechaDeclaracionJurada.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CertificacionIngresosFechaDeclaracion)?a.getDate(a.dataMatriz.datos[0].CertificacionIngresosFechaDeclaracion):new Date());Core.Functions.Validations.toggleValidation(a.dateIngresosAnualesFechaDeclaracionJurada,false);a.dateAutonomoResponsableInscriptoFechaAltaImpuesto.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].AutonomoFechaImpuesto)?a.getDate(a.dataMatriz.datos[0].AutonomoFechaImpuesto):new Date());Core.Functions.Validations.toggleValidation(a.dateAutonomoResponsableInscriptoFechaAltaImpuesto,false);a.dateReciboSueldoJubilacionFechaIngreso.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].ReciboDeSueldoFechaIngreso)?a.getDate(a.dataMatriz.datos[0].ReciboDeSueldoFechaIngreso):new Date());Core.Functions.Validations.toggleValidation(a.dateReciboSueldoJubilacionFechaIngreso,false);a.dateInscripcionMonotributoFechaAltaCategoria.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].MonotributoFechaAltaCategoria)?a.getDate(a.dataMatriz.datos[0].MonotributoFechaAltaCategoria):new Date());Core.Functions.Validations.toggleValidation(a.dateInscripcionMonotributoFechaAltaCategoria,false);a.dateEstadoContableFechaBalance.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].EstadosContablesFechaBalance)?a.getDate(a.dataMatriz.datos[0].EstadosContablesFechaBalance):new Date());Core.Functions.Validations.toggleValidation(a.dateEstadoContableFechaBalance,false);a.lblWarningDateBienesPersonalesFechaDeclaracionJurada.text((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].BsPersFechaVencida)?a.dataMatriz.datos[0].BsPersFechaVencida:"");a.lblWarningDateIngresosAnualesFechaDeclaracionJurada.text((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CertificacionIngresoFechaVencida)?a.dataMatriz.datos[0].CertificacionIngresoFechaVencida:"");a.lblWarningDateAutonomoResponsableInscriptoFechaAltaImpuesto.text((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].AutonomoFechaVencida)?a.dataMatriz.datos[0].AutonomoFechaVencida:"");a.lblWarningDateReciboSueldoJubilacionFechaIngreso.text((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].ReciboDeSueldoFechaVencida)?a.dataMatriz.datos[0].ReciboDeSueldoFechaVencida:"");a.lblWarningDateInscripcionMonotributoFechaAltaCategoria.text((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].MonotributoFechaVencida)?a.dataMatriz.datos[0].MonotributoFechaVencida:"");a.lblWarningDateEstadoContableFechaBalance.text((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].EstadosContablesFechaBalance)?a.dataMatriz.datos[0].EstadosContablesFechaBalance:"");a.ddlCalculoRiesgoGeografiaAltoRiesgo.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoEsGeografiaAltoRiesgo!=null)?a.dataMatriz.datos[0].CalculoRiesgoEsGeografiaAltoRiesgo.toString():"");Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoGeografiaAltoRiesgo,false);a.ddlCalculoRiesgoConexionSustancialGeografiaAltoRiesgo.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoConexionSustancialGeografiaAltoRiesgo!=null)?a.dataMatriz.datos[0].CalculoRiesgoConexionSustancialGeografiaAltoRiesgo.toString():"");Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoConexionSustancialGeografiaAltoRiesgo,false);a.ddlCalculoRiesgoTipoPersonaJuridica.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoTipoPersonaJuridica!=null)?a.dataMatriz.datos[0].CalculoRiesgoTipoPersonaJuridica.toString():"");Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoTipoPersonaJuridica,false);a.txtCalculoRiesgoTipoPersonaJuridicaDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoTipoPersonaJuridicaDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoTipoPersonaJuridicaDescripcion:"");Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoTipoPersonaJuridicaDescripcion,false);a.ddlCalculoRiesgoProductosInvertir.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoProductosInversion)?a.dataMatriz.datos[0].CalculoRiesgoProductosInversion.toString():"");Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoProductosInvertir,false);a.ddlCalculoRiesgoCanalVenta.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoCanalDeVenta)?a.dataMatriz.datos[0].CalculoRiesgoCanalDeVenta.toString():"");Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoCanalVenta,false);a.txtCalculoRiesgoGeografiaAltoRiesgoDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoEsGeografiaAltoRiesgoDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoEsGeografiaAltoRiesgoDescripcion:"");a.txtCalculoRiesgoGeografiaAltoRiesgoDescripcion.swidget().enabled((!a.calcularMatrizManual&&a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoEsGeografiaAltoRiesgoDescripcion)?false:true);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoGeografiaAltoRiesgoDescripcion,false);Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoActividadAltoRiesgo,false);a.txtCalculoRiesgoActividadAltoRiesgoDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoEsActividadAltoRiesgoDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoEsActividadAltoRiesgoDescripcion:"");a.txtCalculoRiesgoActividadAltoRiesgoDescripcion.swidget().enabled((!a.calcularMatrizManual&&a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoEsActividadAltoRiesgoDescripcion)?false:true);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoActividadAltoRiesgoDescripcion,false);a.txtCalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion:"");a.txtCalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion.swidget().enabled((!a.calcularMatrizManual&&a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion)?false:true);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion,false);a.txtCalculoRiesgoNoticasAdversasPlaftDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoNoticiasAdversasPLAFTDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoNoticiasAdversasPLAFTDescripcion:"");a.txtCalculoRiesgoNoticasAdversasPlaftDescripcion.swidget().enabled(a.calcularMatrizManual);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoNoticasAdversasPlaftDescripcion,false);a.txtCalculoRiesgoEsTerroristaDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoEsTerroristaDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoEsTerroristaDescripcion:"");a.txtCalculoRiesgoEsTerroristaDescripcion.swidget().enabled(a.calcularMatrizManual);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoEsTerroristaDescripcion,false);a.txtCalculoRiesgoProveedorDelEstadoDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoEsProveedorDelEstadoDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoEsProveedorDelEstadoDescripcion:"");a.txtCalculoRiesgoProveedorDelEstadoDescripcion.swidget().enabled(a.calcularMatrizManual);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoProveedorDelEstadoDescripcion,false);a.txtCalculoRiesgoPresentoDocumentacionRespaldoDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoDocumentacionDeRespaldoDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoDocumentacionDeRespaldoDescripcion:"");a.txtCalculoRiesgoPresentoDocumentacionRespaldoDescripcion.swidget().enabled(a.calcularMatrizManual);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoPresentoDocumentacionRespaldoDescripcion,false);a.txtMaterialidadCuentaDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoMaterialidadDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoMaterialidadDescripcion:"");a.txtMaterialidadCuentaDescripcion.swidget().enabled(a.calcularMatrizManual);Core.Functions.Validations.toggleValidation(a.txtMaterialidadCuentaDescripcion,false);a.txtCalculoRiesgoCanalVentaDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoCanalDeVentaDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoCanalDeVentaDescripcion:"");a.txtCalculoRiesgoCanalVentaDescripcion.swidget().enabled(a.calcularMatrizManual);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoCanalVentaDescripcion,false);a.txtCalculoRiesgoProductosInvertirDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoProductosInversionDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoProductosInversionDescripcion:"");a.txtCalculoRiesgoProductosInvertirDescripcion.swidget().enabled(a.calcularMatrizManual);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoProductosInvertirDescripcion,false);a.txtCalculoRiesgoPresentaInusualidadesDesfavorablesDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoPresentaInusualidadesDesfavorablesDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoPresentaInusualidadesDesfavorablesDescripcion:"");a.txtCalculoRiesgoPresentaInusualidadesDesfavorablesDescripcion.swidget().enabled(a.calcularMatrizManual);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoPresentaInusualidadesDesfavorablesDescripcion,false);a.txtCalculoRiesgoAntiguedadMenor24MesesDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoAntiguedadMenor24MesesDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoAntiguedadMenor24MesesDescripcion:"");a.txtCalculoRiesgoAntiguedadMenor24MesesDescripcion.swidget().enabled(a.calcularMatrizManual);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoAntiguedadMenor24MesesDescripcion,false);a.txtCalculoRiesgoPEPDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoEsPEPDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoEsPEPDescripcion:"");a.txtCalculoRiesgoPEPDescripcion.swidget().enabled(a.calcularMatrizManual);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoPEPDescripcion,false);a.txtCalculoRiesgoSujetoObligadoDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoEsSujetoObligadoDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoEsSujetoObligadoDescripcion:"");a.txtCalculoRiesgoSujetoObligadoDescripcion.swidget().enabled(a.calcularMatrizManual);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoSujetoObligadoDescripcion,false);a.txtObservaciones.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].Observaciones)?a.dataMatriz.datos[0].Observaciones:"");Core.Functions.Validations.toggleValidation(a.txtObservaciones,false);a.txtInscripcionMonotributoCategoria.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].MonotributoCategoria)?a.dataMatriz.datos[0].MonotributoCategoria:"");Core.Functions.Validations.toggleValidation(a.txtInscripcionMonotributoCategoria,false);a.txtAutonomoResponsableInscriptoCategoria.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].AutonomoCategoria)?a.dataMatriz.datos[0].AutonomoCategoria:"");Core.Functions.Validations.toggleValidation(a.txtAutonomoResponsableInscriptoCategoria,false);a.controlBienesPersonalesPatrimonioNetoTotal.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].BsPersTotalPatrimonioNeto)?a.dataMatriz.datos[0].BsPersTotalPatrimonioNeto:"");Core.Functions.Validations.toggleValidation(a.txtBienesPersonalesPatrimonioNetoTotal,false);a.controlBienesPersonalesDineroEfectivo.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].BsPersDineroEnEfectivo)?a.dataMatriz.datos[0].BsPersDineroEnEfectivo:"");Core.Functions.Validations.toggleValidation(a.txtBienesPersonalesDineroEfectivo,false);a.controlBienesPersonalesExcentos.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].BsPersExcentos)?a.dataMatriz.datos[0].BsPersExcentos:"");Core.Functions.Validations.toggleValidation(a.txtBienesPersonalesExcentos,false);a.controlBienesPersonalesPerfilTransaccional.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].BsPersPerfilTransaccional)?a.dataMatriz.datos[0].BsPersPerfilTransaccional:"");Core.Functions.Validations.toggleValidation(a.txtBienesPersonalesPerfilTransaccional,false);a.controlCertificacionIngresosAnualesResultadoNeto.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CertificacionIngresosResultadoNeto)?a.dataMatriz.datos[0].CertificacionIngresosResultadoNeto:"");Core.Functions.Validations.toggleValidation(a.txtCertificacionIngresosAnualesResultadoNeto,false);a.controlIngresosAnualesPerfilTransaccional.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CertificacionIngresoPerfilTransaccional)?a.dataMatriz.datos[0].CertificacionIngresoPerfilTransaccional:"");Core.Functions.Validations.toggleValidation(a.txtCertificacionIngresosAnualesPerfilTransaccional,false);a.controlAutonomoResponsableInscriptoIngresosMensuales.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].AutonomoIngresosMensuales)?a.dataMatriz.datos[0].AutonomoIngresosMensuales:"");Core.Functions.Validations.toggleValidation(a.txtAutonomoResponsableInscriptoIngresosMensuales,false);a.controlAutonomoResponsableInscriptoPerfilTransaccional.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].AutonomoPerfilTransaccional)?a.dataMatriz.datos[0].AutonomoPerfilTransaccional:"");Core.Functions.Validations.toggleValidation(a.txtAutonomoResponsableInscriptoPerfilTransaccional,false);a.controlReciboSueldoJubilacionNetoRecibido.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].ReciboDeSueldoNetoRecibido)?a.dataMatriz.datos[0].ReciboDeSueldoNetoRecibido:"");Core.Functions.Validations.toggleValidation(a.txtReciboSueldoJubilacionNetoRecibido,false);a.controlReciboSueldoJubilacionPerfilTransaccional.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].ReciboDeSueldoPerfilTransaccional)?a.dataMatriz.datos[0].ReciboDeSueldoPerfilTransaccional:"");Core.Functions.Validations.toggleValidation(a.txtReciboSueldoJubilacionPerfilTransaccional,false);a.controlInscripcionMonotributoPerfilTransaccional.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].MonotributoPerfilTransaccional)?a.dataMatriz.datos[0].MonotributoPerfilTransaccional:"");Core.Functions.Validations.toggleValidation(a.txtInscripcionMonotributoPerfilTransaccional,false);a.controlEstadoContableActivoCorriente.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].EstadosContablesActivo)?a.dataMatriz.datos[0].EstadosContablesActivo:"");Core.Functions.Validations.toggleValidation(a.txtEstadoContableActivoCorriente,false);a.controlEstadoContablePasivoCorriente.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].EstadosContablesPasivo)?a.dataMatriz.datos[0].EstadosContablesPasivo:"");Core.Functions.Validations.toggleValidation(a.txtEstadoContablePasivoCorriente,false);a.controlEstadoContableVentasNetas.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].EstadosContablesVentasNetas)?a.dataMatriz.datos[0].EstadosContablesVentasNetas:"");Core.Functions.Validations.toggleValidation(a.txtEstadoContableVentasNetas,false);a.controlEstadoContablePerfilTransaccional.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].EstadosContablesPerfilTransaccional)?a.dataMatriz.datos[0].EstadosContablesPerfilTransaccional:"");Core.Functions.Validations.toggleValidation(a.txtEstadoContablePerfilTransaccional,false);a.controlPerfilTransaccionalTotal.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].PerfilTransaccionalTotal)?a.dataMatriz.datos[0].PerfilTransaccionalTotal:"");Core.Functions.Validations.toggleValidation(a.txtPerfilTransaccionalTotal,false);a.controlMaterialidadCuenta.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].PerfilTransaccionalTotal)?a.dataMatriz.datos[0].PerfilTransaccionalTotal:"");Core.Functions.Validations.toggleValidation(a.txtMaterialidadCuenta,false);if(!a.calcularMatrizManual){a.txtMaterialidadCuenta.addClass("disabled")}a.controlNseValor.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].NSEMonto)?a.dataMatriz.datos[0].NSEMonto:"");a.btnNosis.unbind("click");a.btnNosis.hide();if(a.calcularMatrizManual||(a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CUIT_CUIL)){a.btnNosis.show();a.btnNosis.attr("disabled","disabled");a.btnNosis.css("border-color",a.calcularMatrizManual?"lightgreen":((!a.dataMatriz.datos[0].tieneNOSIS)?"lightcoral":((a.dataMatriz.datos[0].tieneNOSIS=="1")?"lightgreen":a.dataMatriz.datos[0].tieneNOSIS)));if((a.optionsApertura&&a.optionsApertura.consultaNosis)||(a.pageOptions&&a.pageOptions.consultaNosis)){a.btnNosis.removeAttr("disabled");a.btnNosis.on("click",function(){if(a.calcularMatrizManual){Core.Functions.Validations.toggleValidation(a.txtIdentificacionFiscal,false);if(!a.txtIdentificacionFiscal.val()||!Core.Functions.Validations.isNumeric(a.txtIdentificacionFiscal.val())||!Core.Functions.Validations.isCuit(a.txtIdentificacionFiscal.val())){Core.Functions.Validations.toggleValidation(a.txtIdentificacionFiscal,true)}else{Core.Functions.ExternalServices.Nosis.showReport(a.txtIdentificacionFiscal.val())}}else{Core.Functions.ExternalServices.Nosis.showReport(a.btnNosis,a.dataMatriz.datos[0].CUIT_CUIL)}})}}a.setWarningPerfilTransaccionalResultante();a.setQuestions()};a.getData=function(d,e){Core.Functions.Validations.toggleValidation(a.txtDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtIdentificacionFiscal,false);Core.Functions.Validations.toggleValidation(a.txtClienteDesde,false);Core.Functions.Validations.toggleValidation(a.txtFechaEmision,false);Core.Functions.Validations.toggleValidation(a.dateBienesPersonalesFechaDeclaracionJurada,false);Core.Functions.Validations.toggleValidation(a.dateIngresosAnualesFechaDeclaracionJurada,false);Core.Functions.Validations.toggleValidation(a.dateAutonomoResponsableInscriptoFechaAltaImpuesto,false);Core.Functions.Validations.toggleValidation(a.dateReciboSueldoJubilacionFechaIngreso,false);Core.Functions.Validations.toggleValidation(a.dateInscripcionMonotributoFechaAltaCategoria,false);Core.Functions.Validations.toggleValidation(a.dateEstadoContableFechaBalance,false);Core.Functions.Validations.toggleValidation(a.txtBienesPersonalesPatrimonioNetoTotal,false);Core.Functions.Validations.toggleValidation(a.txtBienesPersonalesDineroEfectivo,false);Core.Functions.Validations.toggleValidation(a.txtBienesPersonalesExcentos,false);Core.Functions.Validations.toggleValidation(a.txtBienesPersonalesPerfilTransaccional,false);Core.Functions.Validations.toggleValidation(a.txtCertificacionIngresosAnualesResultadoNeto,false);Core.Functions.Validations.toggleValidation(a.txtCertificacionIngresosAnualesPerfilTransaccional,false);Core.Functions.Validations.toggleValidation(a.txtAutonomoResponsableInscriptoCategoria,false);Core.Functions.Validations.toggleValidation(a.txtAutonomoResponsableInscriptoIngresosMensuales,false);Core.Functions.Validations.toggleValidation(a.txtAutonomoResponsableInscriptoPerfilTransaccional,false);Core.Functions.Validations.toggleValidation(a.txtReciboSueldoJubilacionNetoRecibido,false);Core.Functions.Validations.toggleValidation(a.txtReciboSueldoJubilacionPerfilTransaccional,false);Core.Functions.Validations.toggleValidation(a.txtInscripcionMonotributoCategoria,false);Core.Functions.Validations.toggleValidation(a.txtInscripcionMonotributoPerfilTransaccional,false);Core.Functions.Validations.toggleValidation(a.txtEstadoContableActivoCorriente,false);Core.Functions.Validations.toggleValidation(a.txtEstadoContablePasivoCorriente,false);Core.Functions.Validations.toggleValidation(a.txtEstadoContableVentasNetas,false);Core.Functions.Validations.toggleValidation(a.txtEstadoContablePerfilTransaccional,false);Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoGeografiaAltoRiesgo,false);Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoConexionSustancialGeografiaAltoRiesgo,false);Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoTipoPersonaJuridica,false);Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoProductosInvertir,false);Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoCanalVenta,false);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoGeografiaAltoRiesgoDescripcion,false);Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoActividadAltoRiesgo,false);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoActividadAltoRiesgoDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoTipoPersonaJuridicaDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoNoticasAdversasPlaftDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoEsTerroristaDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoProveedorDelEstadoDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoPresentoDocumentacionRespaldoDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtMaterialidadCuentaDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoCanalVentaDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoProductosInvertirDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoPresentaInusualidadesDesfavorablesDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoAntiguedadMenor24MesesDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoPEPDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoSujetoObligadoDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtObservaciones,false);Core.Functions.Validations.toggleValidation(a.txtPerfilTransaccionalTotal,false);var f={value:true};var c={datos:[{}]};if(a.dataMatriz.datos[0]){if(a.dataMatriz.datos[0].Nombre!=null){c.datos[0].Nombre=a.dataMatriz.datos[0].Nombre}if(a.dataMatriz.datos[0].CUIT_CUIL!=null){c.datos[0].CUIT_CUIL=a.dataMatriz.datos[0].CUIT_CUIL}if(a.dataMatriz.datos[0].Fecha1raApertura!=null){c.datos[0].Fecha1raApertura=a.dataMatriz.datos[0].Fecha1raApertura}if(a.dataMatriz.datos[0].FechaEmision!=null){c.datos[0].FechaEmision=a.dataMatriz.datos[0].FechaEmision}if(a.dataMatriz.datos[0].NSEAntiguedad!=null){c.datos[0].NSEAntiguedad=a.dataMatriz.datos[0].NSEAntiguedad}if(a.dataMatriz.datos[0].NSEMonto!=null){c.datos[0].NSEMonto=a.dataMatriz.datos[0].NSEMonto}if(a.dataMatriz.datos[0].NSEValor!=null){c.datos[0].NSEValor=a.dataMatriz.datos[0].NSEValor}if(a.dataMatriz.datos[0].Version!=null){c.datos[0].Version=a.dataMatriz.datos[0].Version}if(a.dataMatriz.datos[0].VersionCalculo!=null){c.datos[0].VersionCalculo=a.dataMatriz.datos[0].VersionCalculo}if(a.dataMatriz.datos[0].CalculoRiesgoEsActividadAltoRiesgo!=null){c.datos[0].CalculoRiesgoEsActividadAltoRiesgo=a.dataMatriz.datos[0].CalculoRiesgoEsActividadAltoRiesgo}}else{if(a.calcularMatrizManual){if(!a.txtIdentificacionFiscal.val()||!Core.Functions.Validations.isNumeric(a.txtIdentificacionFiscal.val())||!Core.Functions.Validations.isCuit(a.txtIdentificacionFiscal.val())){Core.Functions.Validations.toggleValidation(a.txtIdentificacionFiscal,true);f.value=false}else{c.datos[0].CUIT_CUIL=Core.Functions.Validations.getValidatedSwidgetValue(a.txtIdentificacionFiscal,f)}c.datos[0].NSEMonto=Core.Functions.Decimal.parseFloat(a.lblNseValor.val())}else{c.datos[0].CUIT_CUIL=a.cuilCuit}}c.datos[0].BsPers=a.chkBienesPersonalesGanancias.swidget().checked()?1:0;if(c.datos[0].BsPers){c.datos[0].BsPersFechaDeclaracion=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.dateBienesPersonalesFechaDeclaracionJurada,f));if(a.txtBienesPersonalesPatrimonioNetoTotal.val()){c.datos[0].BsPersTotalPatrimonioNeto=Core.Functions.Decimal.parseFloat(a.txtBienesPersonalesPatrimonioNetoTotal.val())}if(a.txtBienesPersonalesDineroEfectivo.val()){c.datos[0].BsPersDineroEnEfectivo=Core.Functions.Decimal.parseFloat(a.txtBienesPersonalesDineroEfectivo.val())}if(a.txtBienesPersonalesExcentos.val()){c.datos[0].BsPersExcentos=Core.Functions.Decimal.parseFloat(a.txtBienesPersonalesExcentos.val())}if(e){c.datos[0].BsPersPerfilTransaccional=Core.Functions.Decimal.parseFloat(a.txtBienesPersonalesPerfilTransaccional.val())}else{c.datos[0].BsPersPerfilTransaccional=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtBienesPersonalesPerfilTransaccional,f))}}c.datos[0].CertificacionIngresos=a.chkCertificacionIngresosAnuales.swidget().checked()?1:0;if(c.datos[0].CertificacionIngresos){c.datos[0].CertificacionIngresosFechaDeclaracion=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.dateIngresosAnualesFechaDeclaracionJurada,f));if(a.txtCertificacionIngresosAnualesResultadoNeto.val()){c.datos[0].CertificacionIngresosResultadoNeto=Core.Functions.Decimal.parseFloat(a.txtCertificacionIngresosAnualesResultadoNeto.val())}if(e){c.datos[0].CertificacionIngresoPerfilTransaccional=Core.Functions.Decimal.parseFloat(a.txtCertificacionIngresosAnualesPerfilTransaccional.val())}else{c.datos[0].CertificacionIngresoPerfilTransaccional=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtCertificacionIngresosAnualesPerfilTransaccional,f))}}c.datos[0].Autonomo=a.chkAutonomoResponsableInscripto.swidget().checked()?1:0;if(c.datos[0].Autonomo){c.datos[0].AutonomoActividadSociedades=a.chkGrupoActividadesSociedadesComercialesCiviles.swidget().checked()?1:0;c.datos[0].AutonomoActividadLocaciones=a.chkGrupoActividadesLocacionesPrestacionesServicios.swidget().checked()?1:0;c.datos[0].AutonomoActividadResto=a.chkGrupoActividadesRestoDeActividades.swidget().checked()?1:0;c.datos[0].AutonomoActividadAfiliacionesVoluntarias=a.chkGrupoActividadesAfiliacionesVoluntarias.swidget().checked()?1:0;c.datos[0].AutonomoActividadMenor21=a.chkGrupoActividadesMenores.swidget().checked()?1:0;c.datos[0].AutonomoActividadJubilados=a.chkGrupoActividadesJubilados.swidget().checked()?1:0;c.datos[0].AutonomoActividadAmaDeCasa=a.chkGrupoActividadesAmasDeCasa.swidget().checked()?1:0;c.datos[0].AutonomoFechaImpuesto=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.dateAutonomoResponsableInscriptoFechaAltaImpuesto,f));c.datos[0].AutonomoCategoria=Core.Functions.Validations.getValidatedSwidgetValue(a.txtAutonomoResponsableInscriptoCategoria,f);if(a.txtAutonomoResponsableInscriptoIngresosMensuales.val()){c.datos[0].AutonomoIngresosMensuales=Core.Functions.Decimal.parseFloat(a.txtAutonomoResponsableInscriptoIngresosMensuales.val())}if(e){c.datos[0].AutonomoPerfilTransaccional=Core.Functions.Decimal.parseFloat(a.txtAutonomoResponsableInscriptoPerfilTransaccional.val())}else{c.datos[0].AutonomoPerfilTransaccional=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtAutonomoResponsableInscriptoPerfilTransaccional,f))}}c.datos[0].ReciboDeSueldo=a.chkReciboSueldoJubilacion.swidget().checked()?1:0;if(c.datos[0].ReciboDeSueldo){c.datos[0].ReciboDeSueldoFechaIngreso=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.dateReciboSueldoJubilacionFechaIngreso,f));if(a.txtReciboSueldoJubilacionNetoRecibido.val()){c.datos[0].ReciboDeSueldoNetoRecibido=Core.Functions.Decimal.parseFloat(a.txtReciboSueldoJubilacionNetoRecibido.val())}if(e){c.datos[0].ReciboDeSueldoPerfilTransaccional=Core.Functions.Decimal.parseFloat(a.txtReciboSueldoJubilacionPerfilTransaccional.val())}else{c.datos[0].ReciboDeSueldoPerfilTransaccional=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtReciboSueldoJubilacionPerfilTransaccional,f))}}c.datos[0].Monotributo=a.chkInscripcionMonotributo.swidget().checked()?1:0;if(c.datos[0].Monotributo){c.datos[0].MonotributoFechaAltaCategoria=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.dateInscripcionMonotributoFechaAltaCategoria,f));c.datos[0].MonotributoCategoria=Core.Functions.Validations.getValidatedSwidgetValue(a.txtInscripcionMonotributoCategoria,f);if(e){c.datos[0].MonotributoPerfilTransaccional=Core.Functions.Decimal.parseFloat(a.txtInscripcionMonotributoPerfilTransaccional.val())}else{c.datos[0].MonotributoPerfilTransaccional=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtInscripcionMonotributoPerfilTransaccional,f))}}c.datos[0].EstadosContables=a.chkEstadoContable.swidget().checked()?1:0;if(c.datos[0].EstadosContables){c.datos[0].EstadosContablesFechaBalance=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.dateEstadoContableFechaBalance,f));if(a.txtEstadoContableActivoCorriente.val()){c.datos[0].EstadosContablesActivo=Core.Functions.Decimal.parseFloat(a.txtEstadoContableActivoCorriente.val())}if(a.txtEstadoContablePasivoCorriente.val()){c.datos[0].EstadosContablesPasivo=Core.Functions.Decimal.parseFloat(a.txtEstadoContablePasivoCorriente.val())}if(a.txtEstadoContableVentasNetas.val()){c.datos[0].EstadosContablesVentasNetas=Core.Functions.Decimal.parseFloat(a.txtEstadoContableVentasNetas.val())}if(e){c.datos[0].EstadosContablesPerfilTransaccional=Core.Functions.Decimal.parseFloat(a.txtEstadoContablePerfilTransaccional.val())}else{c.datos[0].EstadosContablesPerfilTransaccional=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtEstadoContablePerfilTransaccional,f))}}c.datos[0].EsPersonaFisica=a.getSelectedTipoPersona(a.chkTipoPersonaFisica,a.chkTipoPersonaJuridica,f);if(!e){c.datos[0].CalculoRiesgoEsTerrorista=a.getSelectedOption(a.chkCalculoRiesgoEsTerroristaSi,a.chkCalculoRiesgoEsTerroristaNo,"Debe indicar si se encuentra en la nómina de terrorismo ONU",f);c.datos[0].CalculoRiesgoNoticiasAdversasPLAFT=a.getSelectedOption(a.chkCalculoRiesgoNoticiasAdversasPlaftSi,a.chkCalculoRiesgoNoticiasAdversasPlaftNo,"Debe indicar si presenta noticias adversas plaft",f);c.datos[0].CalculoRiesgoEsProveedorDelEstado=a.getSelectedOption(a.chkCalculoRiesgoProveedorDelEstadoSi,a.chkCalculoRiesgoProveedorDelEstadoNo,"Debe indicar si es proveedor del estado",f);c.datos[0].CalculoRiesgoDocumentacionDeRespaldo=a.getSelectedOption(a.chkCalculoRiesgoPresentoDocumentacionRespaldoSi,a.chkCalculoRiesgoPresentoDocumentacionRespaldoNo,"Debe indicar si presentó documetación de respaldo",f);c.datos[0].CalculoRiesgoPresentaInusualidadesDesfavorables=a.getSelectedOption(a.chkCalculoRiesgoPresentaInusualidadesDesfavorablesSi,a.chkCalculoRiesgoPresentaInusualidadesDesfavorablesNo,"Debe indicar si presenta inusualidades resultas de manera desfavorable",f);c.datos[0].CalculoRiesgoAntiguedadMenor24Meses=a.getSelectedOption(a.chkCalculoRiesgoAntiguedadMenor24MesesSi,a.chkCalculoRiesgoAntiguedadMenor24MesesNo,"Debe indicar si posee antiguedad menor a 24 meses como cliente de Balanz",f);c.datos[0].CalculoRiesgoEsPEP=a.getSelectedOption(a.chkCalculoRiesgoPEPSi,a.chkCalculoRiesgoPEPNo,"Debe indicar si es PEP",f);c.datos[0].CalculoRiesgoEsSujetoObligado=a.getSelectedOption(a.chkCalculoRiesgoSujetoObligadoSi,a.chkCalculoRiesgoSujetoObligadoNo,"Debe indicar si es sujeto obligado según las normas de la UIF, regulado por CNV y/o BCRA y/o SSN",f);if(a.chkTipoPersonaJuridica.swidget().checked()){c.datos[0].CalculoRiesgoConexionSustancialGeografiaAltoRiesgo=Core.Functions.Validations.getValidatedDropDownValue(a.ddlCalculoRiesgoConexionSustancialGeografiaAltoRiesgo,f);c.datos[0].CalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtCalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion,f);c.datos[0].CalculoRiesgoTipoPersonaJuridica=Core.Functions.Validations.getValidatedDropDownValue(a.ddlCalculoRiesgoTipoPersonaJuridica,f);c.datos[0].CalculoRiesgoTipoPersonaJuridicaDescripcion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtCalculoRiesgoTipoPersonaJuridicaDescripcion,f)}c.datos[0].CalculoRiesgoEsGeografiaAltoRiesgo=Core.Functions.Validations.getValidatedDropDownValue(a.ddlCalculoRiesgoGeografiaAltoRiesgo,f);c.datos[0].CalculoRiesgoProductosInversion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlCalculoRiesgoProductosInvertir,f);c.datos[0].CalculoRiesgoCanalDeVenta=Core.Functions.Validations.getValidatedDropDownValue(a.ddlCalculoRiesgoCanalVenta,f);c.datos[0].CalculoRiesgoEsGeografiaAltoRiesgoDescripcion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtCalculoRiesgoGeografiaAltoRiesgoDescripcion,f);c.datos[0].CalculoRiesgoEsActividadAltoRiesgoDescripcion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtCalculoRiesgoActividadAltoRiesgoDescripcion,f);c.datos[0].CalculoRiesgoNoticiasAdversasPLAFTDescripcion=a.txtCalculoRiesgoNoticasAdversasPlaftDescripcion.swidget().value();c.datos[0].CalculoRiesgoEsTerroristaDescripcion=a.txtCalculoRiesgoEsTerroristaDescripcion.swidget().value();c.datos[0].CalculoRiesgoEsProveedorDelEstadoDescripcion=a.txtCalculoRiesgoProveedorDelEstadoDescripcion.swidget().value();c.datos[0].CalculoRiesgoDocumentacionDeRespaldoDescripcion=a.txtCalculoRiesgoPresentoDocumentacionRespaldoDescripcion.swidget().value();c.datos[0].CalculoRiesgoMaterialidadDescripcion=a.txtMaterialidadCuentaDescripcion.swidget().value();c.datos[0].CalculoRiesgoCanalDeVentaDescripcion=a.txtCalculoRiesgoCanalVentaDescripcion.swidget().value();c.datos[0].CalculoRiesgoProductosInversionDescripcion=a.txtCalculoRiesgoProductosInvertirDescripcion.swidget().value();c.datos[0].CalculoRiesgoPresentaInusualidadesDesfavorablesDescripcion=a.txtCalculoRiesgoPresentaInusualidadesDesfavorablesDescripcion.swidget().value();c.datos[0].CalculoRiesgoAntiguedadMenor24MesesDescripcion=a.txtCalculoRiesgoAntiguedadMenor24MesesDescripcion.swidget().value();c.datos[0].CalculoRiesgoEsPEPDescripcion=a.txtCalculoRiesgoPEPDescripcion.swidget().value();c.datos[0].CalculoRiesgoEsSujetoObligadoDescripcion=a.txtCalculoRiesgoSujetoObligadoDescripcion.swidget().value();c.datos[0].Observaciones=a.txtObservaciones.swidget().value();c.datos[0].PerfilTransaccionalTotal=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtPerfilTransaccionalTotal,f));if(a.calcularMatrizManual){if(a.ddlCalculoRiesgoActividadAltoRiesgo.swidget().selectedItem()){c.datos[0].CalculoRiesgoEsActividadAltoRiesgo=a.ddlCalculoRiesgoActividadAltoRiesgo.swidget().selectedItem().idRiesgoActividad}else{Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoActividadAltoRiesgo,true);f.value=false}}if(c.datos[0].CalculoRiesgoEsActividadAltoRiesgo==-1){Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoActividadAltoRiesgoDescripcion,true);new Core.Controls.Dialog("Aviso",c.datos[0].CalculoRiesgoEsActividadAltoRiesgoDescripcion,{displayButtons:{close:true,accept:false}}).show();f.value=false}if(!d){if(a.resultadoMatriz){c.datos[0].ResultadoRiesgoValor=a.resultadoMatriz.datos[0].ResultadoRiesgoValor;c.datos[0].ResultadoRiesgoDescripcion=a.resultadoMatriz.datos[0].ResultadoRiesgoDescripcion;c.datos[0].ResultadoIdRiesgo=a.resultadoMatriz.datos[0].ResultadoIdRiesgo}else{new Core.Controls.Dialog("Aviso","Los datos se han modificado. Calcular el riesgo nuevamente.",{displayButtons:{close:true,accept:false}}).show();f.value=false}}}return f.value?c:null};a.clearResultadoMatriz=function(){a.resultadoMatriz=null;a.lblResultado.html("");a.lblWatningRecalcularRiesgo.show()};a.setQuestions=function(){a.divCalculoRiesgoConexionSustancialGeografiaAltoRiesgo.removeClass("disabled");a.txtCalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion.swidget().enabled(true);a.ddlCalculoRiesgoConexionSustancialGeografiaAltoRiesgo.swidget().enabled(true);a.lblNseValor.val("");a.lblNseValor.attr("disabled","disabled");if(a.chkTipoPersonaFisica.swidget().checked()){a.divCalculoRiesgoConexionSustancialGeografiaAltoRiesgo.addClass("disabled");a.ddlCalculoRiesgoConexionSustancialGeografiaAltoRiesgo.swidget().enabled(false);a.ddlCalculoRiesgoConexionSustancialGeografiaAltoRiesgo.swidget().value("");a.txtCalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion.swidget().enabled(false);a.txtCalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion.swidget().value("");a.controlNseValor.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].NSEMonto)?a.dataMatriz.datos[0].NSEMonto:"");if(a.calcularMatrizManual){a.lblNseValor.removeAttr("disabled");var c=a.ddlCalculoRiesgoActividadAltoRiesgo.swidget().initialOptions;c.valueTemplate="idOcupacion";c.dataSource.data=a.dataParametros?a.dataParametros.ocupaciones:[];a.ddlCalculoRiesgoActividadAltoRiesgo.swidget().refresh(c);a.ddlCalculoRiesgoActividadAltoRiesgo.swidget().value("")}}a.divCalculoRiesgoTipoPersonaJuridica.hide();a.divCalculoRiesgoTipoPersonaJuridica.removeClass("disabled");a.txtCalculoRiesgoTipoPersonaJuridicaDescripcion.swidget().enabled(true);a.ddlCalculoRiesgoTipoPersonaJuridica.swidget().enabled(true);if(a.chkTipoPersonaJuridica.swidget().checked()){a.divCalculoRiesgoTipoPersonaJuridica.show();if(a.ddlCalculoRiesgoTipoPersonaJuridica.swidget().selectedItem()){a.divCalculoRiesgoTipoPersonaJuridica.addClass("disabled");a.txtCalculoRiesgoTipoPersonaJuridicaDescripcion.swidget().enabled(false);a.ddlCalculoRiesgoTipoPersonaJuridica.swidget().enabled(false)}if(a.calcularMatrizManual){var c=a.ddlCalculoRiesgoActividadAltoRiesgo.swidget().initialOptions;c.valueTemplate="idActividadJuridica";c.dataSource.data=a.dataParametros?a.dataParametros.actividadesJuridicas:[];a.ddlCalculoRiesgoActividadAltoRiesgo.swidget().refresh(c);a.ddlCalculoRiesgoActividadAltoRiesgo.swidget().value("")}}a.chkAutonomoResponsableInscripto.swidget().enabled(a.chkTipoPersonaFisica.swidget().checked());if(!a.chkAutonomoResponsableInscripto.swidget().enabled()){a.chkAutonomoResponsableInscripto.swidget().checked(false);a.divDataAutonomoResponsableInscripto.hide()}a.chkReciboSueldoJubilacion.swidget().enabled(a.chkTipoPersonaFisica.swidget().checked());if(!a.chkReciboSueldoJubilacion.swidget().enabled()){a.chkReciboSueldoJubilacion.swidget().checked(false);a.divDataReciboSueldoJubilacion.hide()}a.chkInscripcionMonotributo.swidget().enabled(a.chkTipoPersonaFisica.swidget().checked());if(!a.chkInscripcionMonotributo.swidget().enabled()){a.chkInscripcionMonotributo.swidget().checked(false);a.divDataInscripcionMonotributo.hide()}a.chkEstadoContable.swidget().enabled(a.chkTipoPersonaJuridica.swidget().checked());if(!a.chkEstadoContable.swidget().enabled()){a.chkEstadoContable.swidget().checked(false);a.divDataEstadoContable.hide()}};a.setWarningPerfilTransaccionalResultante=function(){a.lblWarningPerfilTransaccionalResultante.hide();a.txtPerfilTransaccionalTotal.removeClass("warning");if(a.chkTipoPersonaFisica.swidget().checked()&&(a.chkBienesPersonalesGanancias.swidget().checked()||a.chkCertificacionIngresosAnuales.swidget().checked()||a.chkAutonomoResponsableInscripto.swidget().checked()||a.chkReciboSueldoJubilacion.swidget().checked()||a.chkInscripcionMonotributo.swidget().checked()||a.chkEstadoContable.swidget().checked())){a.lblWarningPerfilTransaccionalResultante.show();a.txtPerfilTransaccionalTotal.addClass("warning")}};a.clearPerfilTransaccionalResultante=function(){a.txtPerfilTransaccionalTotal.val("");a.txtMaterialidadCuenta.val("")};a.destroy=function(){a.txtDescripcion.swidget().destroy();a.txtIdentificacionFiscal.swidget().destroy();a.txtFechaEmision.swidget().destroy();a.txtClienteDesde.swidget().destroy();a.chkBienesPersonalesGanancias.swidget().destroy();a.chkCertificacionIngresosAnuales.swidget().destroy();a.chkAutonomoResponsableInscripto.swidget().destroy();a.chkGrupoActividadesSociedadesComercialesCiviles.swidget().destroy();a.chkGrupoActividadesLocacionesPrestacionesServicios.swidget().destroy();a.chkGrupoActividadesRestoDeActividades.swidget().destroy();a.chkGrupoActividadesAfiliacionesVoluntarias.swidget().destroy();a.chkGrupoActividadesMenores.swidget().destroy();a.chkGrupoActividadesJubilados.swidget().destroy();a.chkGrupoActividadesAmasDeCasa.swidget().destroy();a.chkReciboSueldoJubilacion.swidget().destroy();a.chkInscripcionMonotributo.swidget().destroy();a.chkEstadoContable.swidget().destroy();a.dateBienesPersonalesFechaDeclaracionJurada.swidget().destroy();a.dateIngresosAnualesFechaDeclaracionJurada.swidget().destroy();a.dateAutonomoResponsableInscriptoFechaAltaImpuesto.swidget().destroy();a.dateReciboSueldoJubilacionFechaIngreso.swidget().destroy();a.dateInscripcionMonotributoFechaAltaCategoria.swidget().destroy();a.dateEstadoContableFechaBalance.swidget().destroy();a.txtAutonomoResponsableInscriptoCategoria.swidget().destroy();a.ddlCalculoRiesgoCanalVenta.swidget().destroy();a.ddlCalculoRiesgoGeografiaAltoRiesgo.swidget().destroy();a.ddlCalculoRiesgoConexionSustancialGeografiaAltoRiesgo.swidget().destroy();a.ddlCalculoRiesgoTipoPersonaJuridica.swidget().destroy();a.ddlCalculoRiesgoProductosInvertir.swidget().destroy();a.ddlVersion.swidget().destroy();a.txtCalculoRiesgoGeografiaAltoRiesgoDescripcion.swidget().destroy();a.ddlCalculoRiesgoActividadAltoRiesgo.swidget().destroy();a.txtCalculoRiesgoActividadAltoRiesgoDescripcion.swidget().destroy();a.txtCalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion.swidget().destroy();a.txtCalculoRiesgoTipoPersonaJuridicaDescripcion.swidget().destroy();a.txtCalculoRiesgoNoticasAdversasPlaftDescripcion.swidget().destroy();a.txtCalculoRiesgoEsTerroristaDescripcion.swidget().destroy();a.txtCalculoRiesgoProveedorDelEstadoDescripcion.swidget().destroy();a.txtCalculoRiesgoPresentoDocumentacionRespaldoDescripcion.swidget().destroy();a.txtMaterialidadCuentaDescripcion.swidget().destroy();a.txtCalculoRiesgoCanalVentaDescripcion.swidget().destroy();a.txtCalculoRiesgoProductosInvertirDescripcion.swidget().destroy();a.txtCalculoRiesgoPresentaInusualidadesDesfavorablesDescripcion.swidget().destroy();a.txtCalculoRiesgoAntiguedadMenor24MesesDescripcion.swidget().destroy();a.txtCalculoRiesgoPEPDescripcion.swidget().destroy();a.txtCalculoRiesgoSujetoObligadoDescripcion.swidget().destroy();a.txtObservaciones.swidget().destroy();a.container.html("");a.onClose()};a.getDate=function(c){var d=c.substr(8,2);var e=c.substr(5,2);var g=c.substr(0,4);var f=new Date();f.setDate(1);f.setYear(g);f.setMonth(e-1);f.setDate(d);return f};a.getSelectedTipoPersona=function(c,d,e){if(!c.swidget().checked()&&!d.swidget().checked()){new Core.Controls.Dialog("Aviso","Debe indicar si es una persona física o jurídica",{displayButtons:{close:true,accept:false}}).show();e.value=false;return null}else{return c.swidget().checked()?1:0}};a.getSelectedOption=function(d,c,e,f){if(!d.swidget().checked()&&!c.swidget().checked()){new Core.Controls.Dialog("Aviso",e,{displayButtons:{close:true,accept:false}}).show();f.value=false;return null}else{return d.swidget().checked()?1:0}}};Core.Controls.ManagerMatrizRiesgoBCI=function(b){var a=this;a.decimalCount=2;a.onSave=function(d,c){};a.onClose=function(){};a.container=null;a.dataParametrosUsuario=null;a.dataParametros=null;a.calcularMatrizManual=false;a.calcularMatriz=true;a.consultarMatriz=false;a.cuilCuit=null;a.idAperturaCuenta=null;a.tipo=null;a.numero=null;a.readOnly=null;a.origenApertura=true;a.optionsApertura=null;a.showTitle=true;$.extend(true,a,b);a.resultadoMatriz=null;a.dataMatriz=null;a.divAlert=null;a.txtDescripcion=null;a.txtIdentificacionFiscal=null;a.txtClienteDesde=null;a.txtFechaEmision=null;a.lblNseDescripcion=null;a.lblNseValor=null;a.divDataBienesPersonalesGanancias=null;a.divDataCertificacionIngresosAnuales=null;a.divDataAutonomoResponsableInscripto=null;a.divDataReciboSueldoJubilacion=null;a.divDataInscripcionMonotributo=null;a.divDataEstadoContable=null;a.divTipoPersona=null;a.chkTipoPersonaFisica=null;a.chkTipoPersonaJuridica=null;a.chkBienesPersonalesGanancias=null;a.chkCertificacionIngresosAnuales=null;a.chkAutonomoResponsableInscripto=null;a.chkGrupoActividadesSociedadesComercialesCiviles=null;a.chkGrupoActividadesLocacionesPrestacionesServicios=null;a.chkGrupoActividadesRestoDeActividades=null;a.chkGrupoActividadesAfiliacionesVoluntarias=null;a.chkGrupoActividadesMenores=null;a.chkGrupoActividadesJubilados=null;a.chkGrupoActividadesAmasDeCasa=null;a.chkReciboSueldoJubilacion=null;a.chkInscripcionMonotributo=null;a.chkEstadoContable=null;a.chkCalculoRiesgoPEPNo=null;a.chkCalculoRiesgoPEPSi=null;a.chkCalculoRiesgoAntiguedadMenor24MesesNo=null;a.chkCalculoRiesgoAntiguedadMenor24MesesSi=null;a.chkCalculoRiesgoPresentaInusualidadesDesfavorablesNo=null;a.chkCalculoRiesgoPresentaInusualidadesDesfavorablesSi=null;a.chkCalculoRiesgoPresentoDocumentacionRespaldoNo=null;a.chkCalculoRiesgoPresentoDocumentacionRespaldoSi=null;a.chkCalculoRiesgoNoticiasAdversasPlaftNo=null;a.chkCalculoRiesgoNoticiasAdversasPlaftSi=null;a.chkCalculoRiesgoEsTerroristaNo=null;a.chkCalculoRiesgoEsTerroristaSi=null;a.dateBienesPersonalesFechaDeclaracionJurada=null;a.dateIngresosAnualesFechaDeclaracionJurada=null;a.dateAutonomoResponsableInscriptoFechaAltaImpuesto=null;a.dateReciboSueldoJubilacionFechaIngreso=null;a.dateInscripcionMonotributoFechaAltaCategoria=null;a.dateEstadoContableFechaBalance=null;a.lblWarningDateBienesPersonalesFechaDeclaracionJurada=null;a.lblWarningDateIngresosAnualesFechaDeclaracionJurada=null;a.lblWarningDateAutonomoResponsableInscriptoFechaAltaImpuesto=null;a.lblWarningDateReciboSueldoJubilacionFechaIngreso=null;a.lblWarningDateInscripcionMonotributoFechaAltaCategoria=null;a.lblWarningDateEstadoContableFechaBalance=null;a.txtBienesPersonalesPatrimonioNetoTotal=null;a.txtBienesPersonalesDineroEfectivo=null;a.txtBienesPersonalesExcentos=null;a.txtBienesPersonalesPerfilTransaccional=null;a.txtCertificacionIngresosAnualesResultadoNeto=null;a.txtCertificacionIngresosAnualesPerfilTransaccional=null;a.txtAutonomoResponsableInscriptoCategoria=null;a.txtAutonomoResponsableInscriptoIngresosMensuales=null;a.txtAutonomoResponsableInscriptoPerfilTransaccional=null;a.txtReciboSueldoJubilacionNetoRecibido=null;a.txtReciboSueldoJubilacionPerfilTransaccional=null;a.txtInscripcionMonotributoCategoria=null;a.txtInscripcionMonotributoPerfilTransaccional=null;a.txtEstadoContableActivoCorriente=null;a.txtEstadoContablePasivoCorriente=null;a.txtEstadoContableVentasNetas=null;a.txtEstadoContablePerfilTransaccional=null;a.ddlCalculoRiesgoGeografiaAltoRiesgo=null;a.divCalculoRiesgoConexionSustancialGeografiaAltoRiesgo=null;a.ddlCalculoRiesgoConexionSustancialGeografiaAltoRiesgo=null;a.ddlCalculoRiesgoPerfilInversor=null;a.ddlCalculoRiesgoCanalVenta=null;a.txtCalculoRiesgoGeografiaAltoRiesgoDescripcion=null;a.divCalculoRiesgoActividadAltoRiesgo=null;a.ddlCalculoRiesgoActividadAltoRiesgo=null;a.txtCalculoRiesgoActividadAltoRiesgoDescripcion=null;a.txtCalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion=null;a.txtCalculoRiesgoPEPDescripcion=null;a.txtCalculoRiesgoAntiguedadMenor24MesesDescripcion=null;a.txtCalculoRiesgoPresentaInusualidadesDesfavorablesDescripcion=null;a.txtCalculoRiesgoPerfilInversorDescripcion=null;a.txtCalculoRiesgoCanalVentaDescripcion=null;a.txtCalculoRiesgoPresentoDocumentacionRespaldoDescripcion=null;a.txtCalculoRiesgoNoticasAdversasPlaftDescripcion=null;a.txtCalculoRiesgoEsTerroristaDescripcion=null;a.divCalculoRiesgoTipoPersonaJuridica=null;a.btnCalculoRiesgoTipoPersonaJuridica=null;a.ddlCalculoRiesgoTipoPersonaJuridica=null;a.txtCalculoRiesgoTipoPersonaJuridicaDescripcion=null;a.ddlPerfilInversorEdad=null;a.txtPerfilInversorEdadDescripcion=null;a.ddlPerfilInversorNivelExperienciaInversiones=null;a.txtPerfilInversorNivelExperienciaInversionesDescripcion=null;a.ddlPerfilInversorExperienciaInversionesTitulo=null;a.txtPerfilInversorExperienciaInversionesTituloDescripcion=null;a.ddlPerfilInversorRelacionInversionPatrimonio=null;a.txtPerfilInversorRelacionInversionPatrimonioDescripcion=null;a.ddlPerfilInversorMontoOperacionesEstimado=null;a.txtPerfilInversorMontoOperacionesEstimadoDescripcion=null;a.ddlPerfilInversorObjetivoInversion=null;a.txtPerfilInversorObjetivoInversionDescripcion=null;a.ddlPerfilInversorTipoInversion=null;a.txtPerfilInversorTipoInversionDescripcion=null;a.ddlPerfilInversorNivelToleranciaRiesgo=null;a.txtPerfilInversorNivelToleranciaRiesgoDescripcion=null;a.lblWarningPerfilTransaccionalResultante=null;a.lblWatningRecalcularRiesgo=null;a.txtPerfilTransaccionalTotal=null;a.divVersion=null;a.divContainerDataMatrizRiesgo=null;a.ddlVersion=null;a.lblResultado=null;a.txtObservaciones=null;a.btnVolver=null;a.btnGuardarYCerrar=null;a.btnCalcular=null;a.btnGenerarNueva=null;a.btnDescargarMatriz=null;a.btnRefrescarPerfilTransaccional=null;a.divInformes=null;a.btnNosis=null;a.ultimaVersion=null;a.show=function(){$("html, body").animate({scrollTop:$(".cuenta").offset().top},1000);a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu("matrizDeRiesgoBCI",Core.Objects.Context.Profiles[0]);a.container.html("");a.container.load("/Pages/manager-matriz-de-riesgo-bci.html",function(c,d,e){if(d=="success"){a.ultimaVersion=null;a.divTitle=a.container.find(".div-title");a.divTitle.show();if(!a.showTitle){a.divTitle.hide()}a.title=a.container.find(".title-manager-matriz-riesgo");a.title.text("Alta Cuenta / Perfil del Cliente");a.txtDescripcion=a.container.find(".textbox-descripcion-matriz-riesgo");a.txtIdentificacionFiscal=a.container.find(".textbox-identificacion-fiscal-matriz-riesgo");a.txtClienteDesde=a.container.find(".textbox-cliente-desde-matriz-riesgo");a.txtFechaEmision=a.container.find(".textbox-fecha-emision-matriz-riesgo");a.lblNseDescripcion=a.container.find(".lbl-nse-descripcion-matriz-riesgo");a.lblNseValor=a.container.find(".textbox-nse-valor-matriz-riesgo");a.divTipoPersona=a.container.find(".div-tipo-persona-matriz-riesgo");a.chkTipoPersonaFisica=a.container.find(".chk-tipo-persona-fisica-matriz-riesgo");a.chkTipoPersonaJuridica=a.container.find(".chk-tipo-persona-juridica-matriz-riesgo");a.divDataBienesPersonalesGanancias=a.container.find(".div-data-bienes-personales-ganancias-matriz-riesgo");a.divDataCertificacionIngresosAnuales=a.container.find(".div-data-certificacion-ingresos-anuales-matriz-riesgo");a.divDataAutonomoResponsableInscripto=a.container.find(".div-data-autonomo-responsable-inscripto-matriz-riesgo");a.divDataReciboSueldoJubilacion=a.container.find(".div-data-recibo-sueldo-jubilacion-matriz-riesgo");a.divDataInscripcionMonotributo=a.container.find(".div-data-inscripcion-monotributo-matriz-riesgo");a.divDataEstadoContable=a.container.find(".div-data-estado-contable-matriz-riesgo");a.chkBienesPersonalesGanancias=a.container.find(".chk-bienes-personales-ganancias-matriz-riesgo");a.chkCertificacionIngresosAnuales=a.container.find(".chk-certificacion-ingresos-anuales-matriz-riesgo");a.chkAutonomoResponsableInscripto=a.container.find(".chk-autonomo-responsable-inscripto-matriz-riesgo");a.chkGrupoActividadesSociedadesComercialesCiviles=a.container.find(".chk-grupo-actividades-sociedades-comerciales-civiles-matriz-riesgo");a.chkGrupoActividadesLocacionesPrestacionesServicios=a.container.find(".chk-grupo-actividades-locaciones-prestaciones-servicios-matriz-riesgo");a.chkGrupoActividadesRestoDeActividades=a.container.find(".chk-grupo-actividades-resto-actividades-matriz-riesgo");a.chkGrupoActividadesAfiliacionesVoluntarias=a.container.find(".chk-grupo-actividades-afiliaciones-voluntarias-matriz-riesgo");a.chkGrupoActividadesMenores=a.container.find(".chk-grupo-actividades-menores-matriz-riesgo");a.chkGrupoActividadesJubilados=a.container.find(".chk-grupo-actividades-jubilados-matriz-riesgo");a.chkGrupoActividadesAmasDeCasa=a.container.find(".chk-grupo-actividades-amas-de-casa-matriz-riesgo");a.chkReciboSueldoJubilacion=a.container.find(".chk-recibo-sueldo-jubilacion-matriz-riesgo");a.chkInscripcionMonotributo=a.container.find(".chk-inscripcion-monotributo-matriz-riesgo");a.chkEstadoContable=a.container.find(".chk-estado-contable-matriz-riesgo");a.chkCalculoRiesgoPEPNo=a.container.find(".chk-calculo-riesgo-pep-matriz-riesgo-no");a.chkCalculoRiesgoPEPSi=a.container.find(".chk-calculo-riesgo-pep-matriz-riesgo-si");a.chkCalculoRiesgoAntiguedadMenor24MesesNo=a.container.find(".chk-calculo-riesgo-antiguedad-menor-24-meses-matriz-riesgo-no");a.chkCalculoRiesgoAntiguedadMenor24MesesSi=a.container.find(".chk-calculo-riesgo-antiguedad-menor-24-meses-matriz-riesgo-si");a.chkCalculoRiesgoPresentaInusualidadesDesfavorablesNo=a.container.find(".chk-calculo-riesgo-presenta-inusualidades-desfavorables-matriz-riesgo-no");a.chkCalculoRiesgoPresentaInusualidadesDesfavorablesSi=a.container.find(".chk-calculo-riesgo-presenta-inusualidades-desfavorables-matriz-riesgo-si");a.chkCalculoRiesgoPresentoDocumentacionRespaldoNo=a.container.find(".chk-calculo-riesgo-presento-documentacion-respaldo-matriz-riesgo-no");a.chkCalculoRiesgoPresentoDocumentacionRespaldoSi=a.container.find(".chk-calculo-riesgo-presento-documentacion-respaldo-matriz-riesgo-si");a.chkCalculoRiesgoNoticiasAdversasPlaftNo=a.container.find(".chk-calculo-riesgo-noticias-adversas-plaft-matriz-riesgo-no");a.chkCalculoRiesgoNoticiasAdversasPlaftSi=a.container.find(".chk-calculo-riesgo-noticias-adversas-plaft-matriz-riesgo-si");a.chkCalculoRiesgoEsTerroristaNo=a.container.find(".chk-calculo-riesgo-es-terrorista-matriz-riesgo-no");a.chkCalculoRiesgoEsTerroristaSi=a.container.find(".chk-calculo-riesgo-es-terrorista-matriz-riesgo-si");a.lblWarningDateBienesPersonalesFechaDeclaracionJurada=a.container.find(".lbl-warning-bienes-personales-fecha-declaracion-jurada-matriz-riesgo");a.lblWarningDateIngresosAnualesFechaDeclaracionJurada=a.container.find(".lbl-warning-ingresos-anuales-fecha-declaracion-jurada-matriz-riesgo");a.lblWarningDateAutonomoResponsableInscriptoFechaAltaImpuesto=a.container.find(".lbl-warning-autonomo-responsable-inscripto-fecha-alta-impuesto-matriz-riesgo");a.lblWarningDateReciboSueldoJubilacionFechaIngreso=a.container.find(".lbl-warning-recibo-sueldo-jubilacion-fecha-ingreso-matriz-riesgo");a.lblWarningDateInscripcionMonotributoFechaAltaCategoria=a.container.find(".lbl-warning-inscripcion-monotributo-fecha-alta-categoria-monotributo-matriz-riesgo");a.lblWarningDateEstadoContableFechaBalance=a.container.find(".lbl-warning-estado-contable-fecha-balance-matriz-riesgo");a.dateBienesPersonalesFechaDeclaracionJurada=a.container.find(".date-picker-bienes-personales-fecha-declaracion-jurada-matriz-riesgo");a.dateIngresosAnualesFechaDeclaracionJurada=a.container.find(".date-picker-ingresos-anuales-fecha-declaracion-jurada-matriz-riesgo");a.dateAutonomoResponsableInscriptoFechaAltaImpuesto=a.container.find(".date-picker-autonomo-responsable-inscripto-fecha-alta-impuesto-matriz-riesgo");a.dateReciboSueldoJubilacionFechaIngreso=a.container.find(".date-picker-recibo-sueldo-jubilacion-fecha-ingreso-matriz-riesgo");a.dateInscripcionMonotributoFechaAltaCategoria=a.container.find(".date-picker-inscripcion-monotributo-fecha-alta-categoria-monotributo-matriz-riesgo");a.dateEstadoContableFechaBalance=a.container.find(".date-picker-estado-contable-fecha-balance-matriz-riesgo");a.txtBienesPersonalesPatrimonioNetoTotal=a.container.find(".textbox-bienes-personales-patrimonio-neto-total-matriz-riesgo");a.txtBienesPersonalesDineroEfectivo=a.container.find(".textbox-bienes-personales-dinero-efectivo-matriz-riesgo");a.txtBienesPersonalesExcentos=a.container.find(".textbox-bienes-personales-excentos-matriz-riesgo");a.txtBienesPersonalesPerfilTransaccional=a.container.find(".textbox-bienes-personales-perfil-transaccional-matriz-riesgo");a.txtCertificacionIngresosAnualesResultadoNeto=a.container.find(".textbox-certificacion-ingresos-anuales-resultado-neto-matriz-riesgo");a.txtCertificacionIngresosAnualesPerfilTransaccional=a.container.find(".textbox-certificacion-ingresos-anuales-perfil-transaccional-matriz-riesgo");a.txtAutonomoResponsableInscriptoCategoria=a.container.find(".textbox-autonomo-responsable-inscripto-categoria-matriz-riesgo");a.txtAutonomoResponsableInscriptoIngresosMensuales=a.container.find(".textbox-autonomo-responsable-inscripto-ingresos-mensuales-matriz-riesgo");a.txtAutonomoResponsableInscriptoPerfilTransaccional=a.container.find(".textbox-autonomo-responsable-inscripto-perfil-transaccional-matriz-riesgo");a.txtReciboSueldoJubilacionNetoRecibido=a.container.find(".textbox-recibo-sueldo-jubilacion-neto-recibido-matriz-riesgo");a.txtReciboSueldoJubilacionPerfilTransaccional=a.container.find(".textbox-recibo-sueldo-jubilacion-perfil-transaccional-matriz-riesgo");a.txtInscripcionMonotributoCategoria=a.container.find(".textbox-inscripcion-monotributo-categoria-matriz-riesgo");a.txtInscripcionMonotributoPerfilTransaccional=a.container.find(".textbox-inscripcion-monotributo-perfil-transaccional-matriz-riesgo");a.txtEstadoContableActivoCorriente=a.container.find(".textbox-estado-contable-activo-corriente-matriz-riesgo");a.txtEstadoContablePasivoCorriente=a.container.find(".textbox-estado-contable-pasivo-corriente-matriz-riesgo");a.txtEstadoContableVentasNetas=a.container.find(".textbox-estado-contable-ventas-netas-matriz-riesgo");a.txtEstadoContablePerfilTransaccional=a.container.find(".textbox-estado-contable-perfil-transaccional-matriz-riesgo");a.ddlCalculoRiesgoGeografiaAltoRiesgo=a.container.find(".dropdown-calculo-riesgo-geografia-alto-riesgo-matriz-riesgo");a.divCalculoRiesgoConexionSustancialGeografiaAltoRiesgo=a.container.find(".div-calculo-riesgo-conexion-sustancial-geografia-alto-riesgo-matriz-riesgo");a.ddlCalculoRiesgoConexionSustancialGeografiaAltoRiesgo=a.container.find(".dropdown-calculo-riesgo-conexion-sustancial-geografia-alto-riesgo-matriz-riesgo");a.ddlCalculoRiesgoPerfilInversor=a.container.find(".dropdown-calculo-riesgo-perfil-inversor-matriz-riesgo");a.ddlCalculoRiesgoCanalVenta=a.container.find(".dropdown-calculo-riesgo-canal-venta-matriz-riesgo");a.divVersion=a.container.find(".div-version-matriz-riesgo");a.ddlVersion=a.container.find(".dropdown-version-matriz-riesgo");a.divCalculoRiesgoTipoPersonaJuridica=a.container.find(".div-calculo-riesgo-tipo-persona-juridica-matriz-riesgo");a.btnCalculoRiesgoTipoPersonaJuridica=a.container.find(".btn-calculo-riesgo-tipo-persona-juridica-matriz-riesgo");a.ddlCalculoRiesgoTipoPersonaJuridica=a.container.find(".dropdown-calculo-riesgo-tipo-persona-juridica-matriz-riesgo");a.txtCalculoRiesgoTipoPersonaJuridicaDescripcion=a.container.find(".textbox-calculo-riesgo-tipo-persona-juridica-descripcion-matriz-riesgo");a.divContainerDataMatrizRiesgo=a.container.find(".div-container-data-matriz-riesgo");a.txtCalculoRiesgoGeografiaAltoRiesgoDescripcion=a.container.find(".textbox-calculo-riesgo-geografia-alto-riesgo-descripcion-matriz-riesgo");a.divCalculoRiesgoActividadAltoRiesgo=a.container.find(".div-calculo-riesgo-actividad-alto-riesgo-matriz-riesgo");a.divCalculoRiesgoActividadAltoRiesgo.hide();if(a.calcularMatrizManual){a.divCalculoRiesgoActividadAltoRiesgo.show()}a.ddlCalculoRiesgoPaisLocalizacionFuenteIngresos=a.container.find(".dropdown-calculo-riesgo-pais-localizacion-fuente-ingresos-matriz-riesgo");a.txtCalculoRiesgoPaisLocalizacionFuenteIngresosDescripcion=a.container.find(".textbox-calculo-riesgo-pais-localizacion-fuente-ingresos-descripcion-matriz-riesgo");a.ddlCalculoRiesgoPaisLocalizacionActivos=a.container.find(".dropdown-calculo-riesgo-pais-localizacion-activos-matriz-riesgo");a.txtCalculoRiesgoPaisLocalizacionActivosDescripcion=a.container.find(".textbox-calculo-riesgo-pais-localizacion-activos-descripcion-matriz-riesgo");a.ddlCalculoRiesgoFactorDiscrecional=a.container.find(".dropdown-calculo-riesgo-factor-discrecional-matriz-riesgo");a.txtCalculoRiesgoFactorDiscrecionalDescripcion=a.container.find(".textbox-calculo-riesgo-factor-discrecional-descripcion-matriz-riesgo");a.ddlCalculoRiesgoPagoATerceros=a.container.find(".dropdown-calculo-riesgo-pago-terceros-matriz-riesgo");a.txtCalculoRiesgoPagoATercerosDescripcion=a.container.find(".textbox-calculo-riesgo-pago-terceros-descripcion-matriz-riesgo");a.ddlCalculoRiesgoActividadAltoRiesgo=a.container.find(".dropdown-calculo-riesgo-actividad-alto-riesgo-matriz-riesgo");a.txtCalculoRiesgoActividadAltoRiesgoDescripcion=a.container.find(".textbox-calculo-riesgo-actividad-alto-riesgo-descripcion-matriz-riesgo");a.txtCalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion=a.container.find(".textbox-calculo-riesgo-conexion-sustancial-geografia-alto-riesgo-descripcion-matriz-riesgo");a.txtCalculoRiesgoPEPDescripcion=a.container.find(".textbox-calculo-riesgo-pep-descripcion-matriz-riesgo");a.txtCalculoRiesgoAntiguedadMenor24MesesDescripcion=a.container.find(".textbox-calculo-riesgo-antiguedad-menor-24-meses-descripcion-matriz-riesgo");a.txtCalculoRiesgoPresentaInusualidadesDesfavorablesDescripcion=a.container.find(".textbox-calculo-riesgo-presenta-inusualidades-desfavorables-descripcion-matriz-riesgo");a.txtCalculoRiesgoPerfilInversorDescripcion=a.container.find(".textbox-calculo-riesgo-perfil-inversor-descripcion-matriz-riesgo");a.txtCalculoRiesgoCanalVentaDescripcion=a.container.find(".textbox-calculo-riesgo-canal-venta-descripcion-matriz-riesgo");a.txtCalculoRiesgoPresentoDocumentacionRespaldoDescripcion=a.container.find(".textbox-calculo-riesgo-presento-documentacion-respaldo-descripcion-matriz-riesgo");a.txtCalculoRiesgoNoticasAdversasPlaftDescripcion=a.container.find(".textbox-calculo-riesgo-noticias-adversas-plaft-descripcion-matriz-riesgo");a.txtCalculoRiesgoEsTerroristaDescripcion=a.container.find(".textbox-calculo-riesgo-es-terrorista-descripcion-matriz-riesgo");a.ddlPerfilInversorEdad=a.container.find(".dropdown-perfil-inversor-edad-matriz-riesgo");a.txtPerfilInversorEdadDescripcion=a.container.find(".textbox-perfil-inversor-edad-descripcion-matriz-riesgo");a.ddlPerfilInversorNivelExperienciaInversiones=a.container.find(".dropdown-perfil-inversor-nivel-experiencia-inversiones-matriz-riesgo");a.txtPerfilInversorNivelExperienciaInversionesDescripcion=a.container.find(".textbox-perfil-inversor-nivel-experiencia-inversiones-descripcion-matriz-riesgo");a.ddlPerfilInversorExperienciaInversionesTitulo=a.container.find(".dropdown-perfil-inversor-experiencia-inversiones-titulo-matriz-riesgo");a.txtPerfilInversorExperienciaInversionesTituloDescripcion=a.container.find(".textbox-perfil-inversor-experiencia-inversiones-titulo-descripcion-matriz-riesgo");a.ddlPerfilInversorRelacionInversionPatrimonio=a.container.find(".dropdown-perfil-inversor-relacion-inversion-patrimonio-matriz-riesgo");a.txtPerfilInversorRelacionInversionPatrimonioDescripcion=a.container.find(".textbox-perfil-inversor-relacion-inversion-patrimonio-descripcion-matriz-riesgo");a.ddlPerfilInversorMontoOperacionesEstimado=a.container.find(".dropdown-perfil-inversor-monto-operaciones-estimado-matriz-riesgo");a.txtPerfilInversorMontoOperacionesEstimadoDescripcion=a.container.find(".textbox-perfil-inversor-monto-operaciones-estimado-descripcion-matriz-riesgo");a.ddlPerfilInversorObjetivoInversion=a.container.find(".dropdown-perfil-inversor-objetivo-inversion-matriz-riesgo");a.txtPerfilInversorObjetivoInversionDescripcion=a.container.find(".textbox-perfil-inversor-objetivo-inversion-descripcion-matriz-riesgo");a.ddlPerfilInversorTipoInversion=a.container.find(".dropdown-perfil-inversor-tipo-inversion-matriz-riesgo");a.txtPerfilInversorTipoInversionDescripcion=a.container.find(".textbox-perfil-inversor-tipo-inversion-descripcion-matriz-riesgo");a.ddlPerfilInversorNivelToleranciaRiesgo=a.container.find(".dropdown-perfil-inversor-nivel-tolerancia-riesgo-matriz-riesgo");a.txtPerfilInversorNivelToleranciaRiesgoDescripcion=a.container.find(".textbox-perfil-inversor-nivel-tolerancia-riesgo-descripcion-matriz-riesgo");a.txtObservaciones=a.container.find(".textbox-observaciones-matriz-riesgo");a.txtPerfilTransaccionalTotal=a.container.find(".textbox-perfil-transaccional-total-matriz-riesgo");a.lblWarningPerfilTransaccionalResultante=a.container.find(".lbl-warning-perfil-transaccional-matriz-riesgo");a.lblWatningRecalcularRiesgo=a.container.find(".lbl-warning-recalcular-matriz-riesgo");a.lblWatningRecalcularRiesgo.hide();a.lblResultado=a.container.find(".lbl-resultado-matriz-riesgo");a.btnVolver=a.container.find(".btn-volver-matriz-riesgo");a.btnGuardarYCerrar=a.container.find(".btn-guardar-cerrar-matriz-riesgo");a.btnCalcular=a.container.find(".btn-calcular-matriz-riesgo");a.btnGenerarNueva=a.container.find(".btn-generar-nueva");a.btnDescargarMatriz=a.container.find(".btn-descargar-matriz-riesgo");a.btnRefrescarPerfilTransaccional=a.container.find(".btn-refrescar-perfil-transaccional-matriz-riesgo");a.divAlert=a.container.find(".div-alert-matriz-riesgo");a.divInformes=a.container.find(".div-informes-matriz-riesgo");a.btnNosis=a.container.find(".button-consultar-nosis-matriz-riesgo");a.divAlert.slideUp();a.txtDescripcion.shieldTextBox({enabled:a.calcularMatrizManual});a.txtIdentificacionFiscal.shieldTextBox({enabled:a.calcularMatrizManual});a.txtClienteDesde.shieldTextBox({enabled:a.calcularMatrizManual});a.txtFechaEmision.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],enabled:a.calcularMatrizManual});a.controlNseValor=new Core.Controls.DecimalPicker(a.lblNseValor,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz()}});a.divTipoPersona.removeClass("disabled");if(a.origenApertura){a.divTipoPersona.addClass("disabled")}if(!a.chkTipoPersonaFisica.swidget()){a.chkTipoPersonaFisica.shieldRadioButton({label:"Persona Física",enabled:!a.origenApertura,events:{click:function(f){a.setQuestions();a.setWarningPerfilTransaccionalResultante();a.clearResultadoMatriz()}}})}if(!a.chkTipoPersonaJuridica.swidget()){a.chkTipoPersonaJuridica.shieldRadioButton({label:"Persona Jurídica",enabled:!a.origenApertura,events:{click:function(f){a.setQuestions();a.setWarningPerfilTransaccionalResultante();a.clearResultadoMatriz()}}})}a.chkBienesPersonalesGanancias.shieldCheckBox({label:"Bienes Personales ó Ganancias (Total Patrimonio Neto al cierre)",events:{click:function(f){if(a.chkBienesPersonalesGanancias.swidget().checked()){a.divDataBienesPersonalesGanancias.show()}else{a.divDataBienesPersonalesGanancias.hide()}a.setWarningPerfilTransaccionalResultante();a.clearResultadoMatriz()}}});a.chkCertificacionIngresosAnuales.shieldCheckBox({label:"Certificación de Ingresos anuales ó Ganancias 4ta. Categoría",events:{click:function(f){if(a.chkCertificacionIngresosAnuales.swidget().checked()){a.divDataCertificacionIngresosAnuales.show()}else{a.divDataCertificacionIngresosAnuales.hide()}a.setWarningPerfilTransaccionalResultante();a.clearResultadoMatriz()}}});a.chkAutonomoResponsableInscripto.shieldCheckBox({label:"Autónomo / Responsable Inscripto",events:{click:function(f){if(a.chkAutonomoResponsableInscripto.swidget().checked()){a.divDataAutonomoResponsableInscripto.show()}else{a.divDataAutonomoResponsableInscripto.hide()}a.setWarningPerfilTransaccionalResultante();a.clearResultadoMatriz()}}});a.chkGrupoActividadesSociedadesComercialesCiviles.shieldCheckBox({label:"Dirección, administración, o conducción de sociedades comerciales o civiles, regulares o irregulares, y socios de sociedades de cualquier tipo",events:{click:function(f){a.clearResultadoMatriz()}}});a.chkGrupoActividadesLocacionesPrestacionesServicios.shieldCheckBox({label:"Actividades no incluidas en el punto anterior, que constituyan locaciones o prestaciones de servicios",events:{click:function(f){a.clearResultadoMatriz()}}});a.chkGrupoActividadesRestoDeActividades.shieldCheckBox({label:"Resto de las actividades no  comprendidas en los puntos anteriores",events:{click:function(f){a.clearResultadoMatriz()}}});a.chkGrupoActividadesAfiliacionesVoluntarias.shieldCheckBox({label:"Afiliaciones voluntarias",events:{click:function(f){a.clearResultadoMatriz()}}});a.chkGrupoActividadesMenores.shieldCheckBox({label:"Menores de 18 hasta 21 años",events:{click:function(f){a.clearResultadoMatriz()}}});a.chkGrupoActividadesJubilados.shieldCheckBox({label:"Jubilados por la Ley 24.241",events:{click:function(f){a.clearResultadoMatriz()}}});a.chkGrupoActividadesAmasDeCasa.shieldCheckBox({label:"Amas de casa que opten por el aporte reducido previsto en la Ley 24.828",events:{click:function(f){a.clearResultadoMatriz()}}});a.chkReciboSueldoJubilacion.shieldCheckBox({label:"Recibo de Sueldo / Jubilación",events:{click:function(f){if(a.chkReciboSueldoJubilacion.swidget().checked()){a.divDataReciboSueldoJubilacion.show()}else{a.divDataReciboSueldoJubilacion.hide()}a.setWarningPerfilTransaccionalResultante();a.clearResultadoMatriz()}}});a.chkInscripcionMonotributo.shieldCheckBox({label:"Constancia de Inscripción Monotributo",events:{click:function(f){if(a.chkInscripcionMonotributo.swidget().checked()){a.divDataInscripcionMonotributo.show()}else{a.divDataInscripcionMonotributo.hide()}a.setWarningPerfilTransaccionalResultante();a.clearResultadoMatriz()}}});a.chkEstadoContable.shieldCheckBox({label:"Estados Contables",events:{click:function(f){if(a.chkEstadoContable.swidget().checked()){a.divDataEstadoContable.show()}else{a.divDataEstadoContable.hide()}a.setWarningPerfilTransaccionalResultante();a.clearResultadoMatriz()}}});if(!a.chkCalculoRiesgoPEPNo.swidget()){a.chkCalculoRiesgoPEPNo.shieldRadioButton({label:"NO",events:{click:function(f){a.clearResultadoMatriz()}}})}if(!a.chkCalculoRiesgoPEPSi.swidget()){a.chkCalculoRiesgoPEPSi.shieldRadioButton({label:"SI",events:{click:function(f){a.clearResultadoMatriz()}}})}if(!a.chkCalculoRiesgoAntiguedadMenor24MesesNo.swidget()){a.chkCalculoRiesgoAntiguedadMenor24MesesNo.shieldRadioButton({label:"NO",events:{click:function(f){a.clearResultadoMatriz()}}})}if(!a.chkCalculoRiesgoAntiguedadMenor24MesesSi.swidget()){a.chkCalculoRiesgoAntiguedadMenor24MesesSi.shieldRadioButton({label:"SI",events:{click:function(f){a.clearResultadoMatriz()}}})}if(!a.chkCalculoRiesgoPresentaInusualidadesDesfavorablesNo.swidget()){a.chkCalculoRiesgoPresentaInusualidadesDesfavorablesNo.shieldRadioButton({label:"NO",events:{click:function(f){a.clearResultadoMatriz()}}})}if(!a.chkCalculoRiesgoPresentaInusualidadesDesfavorablesSi.swidget()){a.chkCalculoRiesgoPresentaInusualidadesDesfavorablesSi.shieldRadioButton({label:"SI",events:{click:function(f){a.clearResultadoMatriz()}}})}if(!a.chkCalculoRiesgoPresentoDocumentacionRespaldoNo.swidget()){a.chkCalculoRiesgoPresentoDocumentacionRespaldoNo.shieldRadioButton({label:"NO",events:{click:function(f){a.clearResultadoMatriz()}}})}if(!a.chkCalculoRiesgoPresentoDocumentacionRespaldoSi.swidget()){a.chkCalculoRiesgoPresentoDocumentacionRespaldoSi.shieldRadioButton({label:"SI",events:{click:function(f){a.clearResultadoMatriz()}}})}if(!a.chkCalculoRiesgoNoticiasAdversasPlaftNo.swidget()){a.chkCalculoRiesgoNoticiasAdversasPlaftNo.shieldRadioButton({label:"NO",events:{click:function(f){a.clearResultadoMatriz()}}})}if(!a.chkCalculoRiesgoNoticiasAdversasPlaftSi.swidget()){a.chkCalculoRiesgoNoticiasAdversasPlaftSi.shieldRadioButton({label:"SI",events:{click:function(f){a.clearResultadoMatriz()}}})}if(!a.chkCalculoRiesgoEsTerroristaNo.swidget()){a.chkCalculoRiesgoEsTerroristaNo.shieldRadioButton({label:"NO",events:{click:function(f){a.clearResultadoMatriz()}}})}if(!a.chkCalculoRiesgoEsTerroristaSi.swidget()){a.chkCalculoRiesgoEsTerroristaSi.shieldRadioButton({label:"SI",events:{click:function(f){a.clearResultadoMatriz()}}})}a.dateBienesPersonalesFechaDeclaracionJurada.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],max:new Date(),events:{change:function(f){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}}});a.dateIngresosAnualesFechaDeclaracionJurada.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],max:new Date(),events:{change:function(f){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}}});a.dateAutonomoResponsableInscriptoFechaAltaImpuesto.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],max:new Date(),events:{change:function(f){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}}});a.dateReciboSueldoJubilacionFechaIngreso.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],max:new Date(),events:{change:function(f){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}}});a.dateInscripcionMonotributoFechaAltaCategoria.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],max:new Date(),events:{change:function(f){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}}});a.dateEstadoContableFechaBalance.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],max:new Date(),events:{change:function(f){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}}});a.lblWarningDateBienesPersonalesFechaDeclaracionJurada.text("");a.lblWarningDateIngresosAnualesFechaDeclaracionJurada.text("");a.lblWarningDateAutonomoResponsableInscriptoFechaAltaImpuesto.text("");a.lblWarningDateReciboSueldoJubilacionFechaIngreso.text("");a.lblWarningDateInscripcionMonotributoFechaAltaCategoria.text("");a.lblWarningDateEstadoContableFechaBalance.text("");a.controlBienesPersonalesPatrimonioNetoTotal=new Core.Controls.DecimalPicker(a.txtBienesPersonalesPatrimonioNetoTotal,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}});a.controlBienesPersonalesDineroEfectivo=new Core.Controls.DecimalPicker(a.txtBienesPersonalesDineroEfectivo,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}});a.controlBienesPersonalesExcentos=new Core.Controls.DecimalPicker(a.txtBienesPersonalesExcentos,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}});a.controlBienesPersonalesPerfilTransaccional=new Core.Controls.DecimalPicker(a.txtBienesPersonalesPerfilTransaccional,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz()}});a.controlCertificacionIngresosAnualesResultadoNeto=new Core.Controls.DecimalPicker(a.txtCertificacionIngresosAnualesResultadoNeto,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}});a.controlIngresosAnualesPerfilTransaccional=new Core.Controls.DecimalPicker(a.txtCertificacionIngresosAnualesPerfilTransaccional,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz()}});a.txtAutonomoResponsableInscriptoCategoria.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}}});a.controlAutonomoResponsableInscriptoIngresosMensuales=new Core.Controls.DecimalPicker(a.txtAutonomoResponsableInscriptoIngresosMensuales,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}});a.controlAutonomoResponsableInscriptoPerfilTransaccional=new Core.Controls.DecimalPicker(a.txtAutonomoResponsableInscriptoPerfilTransaccional,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz()}});a.controlReciboSueldoJubilacionNetoRecibido=new Core.Controls.DecimalPicker(a.txtReciboSueldoJubilacionNetoRecibido,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}});a.controlReciboSueldoJubilacionPerfilTransaccional=new Core.Controls.DecimalPicker(a.txtReciboSueldoJubilacionPerfilTransaccional,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz()}});a.txtInscripcionMonotributoCategoria.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}}});a.controlInscripcionMonotributoPerfilTransaccional=new Core.Controls.DecimalPicker(a.txtInscripcionMonotributoPerfilTransaccional,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz()}});a.controlEstadoContableActivoCorriente=a.controlEstadoContableActivoCorriente=new Core.Controls.DecimalPicker(a.txtEstadoContableActivoCorriente,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}});a.controlEstadoContablePasivoCorriente=new Core.Controls.DecimalPicker(a.txtEstadoContablePasivoCorriente,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}});a.controlEstadoContableVentasNetas=new Core.Controls.DecimalPicker(a.txtEstadoContableVentasNetas,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz();a.clearPerfilTransaccionalResultante()}});a.controlEstadoContablePerfilTransaccional=new Core.Controls.DecimalPicker(a.txtEstadoContablePerfilTransaccional,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz()}});a.ddlCalculoRiesgoGeografiaAltoRiesgo.shieldDropDown({dataSource:{data:a.dataParametrosUsuario.geografiaDeRiesgo},valueTemplate:"{idGeografiaDeRiesgo}",textTemplate:"{Descripcion}",events:{select:function(f){a.clearResultadoMatriz()}}});a.ddlCalculoRiesgoConexionSustancialGeografiaAltoRiesgo.shieldDropDown({dataSource:{data:a.dataParametrosUsuario.geografiaDeRiesgo},valueTemplate:"{idGeografiaDeRiesgo}",textTemplate:"{Descripcion}",events:{select:function(f){a.clearResultadoMatriz()}}});a.ddlCalculoRiesgoTipoPersonaJuridica.shieldDropDown({dataSource:{data:a.dataParametrosUsuario.riesgo},valueTemplate:"{idRiesgo}",textTemplate:"{RiesgoDescripcion}",events:{select:function(f){a.clearResultadoMatriz()}}});a.ddlCalculoRiesgoPerfilInversor.shieldDropDown({dataSource:{data:a.dataParametrosUsuario.riesgoProductosInversion},valueTemplate:"{idRiesgoProductoInversion}",textTemplate:"{RiesgoDescripcion}",events:{select:function(f){a.clearResultadoMatriz()}}});a.ddlCalculoRiesgoCanalVenta.shieldDropDown({dataSource:{data:a.dataParametrosUsuario.canalDeVenta},valueTemplate:"{idCanalDeVenta}",textTemplate:"{Descripcion}",events:{select:function(f){a.clearResultadoMatriz()}}});a.ddlVersion.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idVersion}",textTemplate:"{Descripcion}",events:{select:function(f){a.loadData(a.ddlVersion.swidget().value())}}});a.txtCalculoRiesgoGeografiaAltoRiesgoDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.ddlCalculoRiesgoPaisLocalizacionFuenteIngresos.shieldDropDown({dataSource:{data:a.dataParametrosUsuario.geografiaDeRiesgo},valueTemplate:"{idGeografiaDeRiesgo}",textTemplate:"{Descripcion}",events:{select:function(f){a.clearResultadoMatriz()}}});a.txtCalculoRiesgoPaisLocalizacionFuenteIngresosDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.ddlCalculoRiesgoPaisLocalizacionActivos.shieldDropDown({dataSource:{data:a.dataParametrosUsuario.geografiaDeRiesgo},valueTemplate:"{idGeografiaDeRiesgo}",textTemplate:"{Descripcion}",events:{select:function(f){a.clearResultadoMatriz()}}});a.txtCalculoRiesgoPaisLocalizacionActivosDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.ddlCalculoRiesgoFactorDiscrecional.shieldDropDown({dataSource:{data:a.dataParametrosUsuario.geografiaDeRiesgo},valueTemplate:"{idGeografiaDeRiesgo}",textTemplate:"{Descripcion}",events:{select:function(f){a.clearResultadoMatriz()}}});a.txtCalculoRiesgoFactorDiscrecionalDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.ddlCalculoRiesgoPagoATerceros.shieldDropDown({dataSource:{data:a.dataParametrosUsuario.geografiaDeRiesgo},valueTemplate:"{idGeografiaDeRiesgo}",textTemplate:"{Descripcion}",events:{select:function(f){a.clearResultadoMatriz()}}});a.txtCalculoRiesgoPagoATercerosDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.ddlCalculoRiesgoActividadAltoRiesgo.shieldDropDown({dataSource:{data:[]},valueTemplate:"{value}",textTemplate:"{Descripcion}"});a.txtCalculoRiesgoActividadAltoRiesgoDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.txtCalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.txtCalculoRiesgoTipoPersonaJuridicaDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.txtCalculoRiesgoPEPDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.txtCalculoRiesgoAntiguedadMenor24MesesDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.txtCalculoRiesgoPresentaInusualidadesDesfavorablesDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.txtCalculoRiesgoPerfilInversorDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.txtCalculoRiesgoCanalVentaDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.txtCalculoRiesgoPresentoDocumentacionRespaldoDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.txtCalculoRiesgoNoticasAdversasPlaftDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.txtCalculoRiesgoEsTerroristaDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.ddlPerfilInversorEdad.shieldDropDown({dataSource:{data:a.dataParametrosUsuario.geografiaDeRiesgo},valueTemplate:"{idGeografiaDeRiesgo}",textTemplate:"{Descripcion}",events:{select:function(f){a.clearResultadoMatriz()}}});a.txtPerfilInversorEdadDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.ddlPerfilInversorNivelExperienciaInversiones.shieldDropDown({dataSource:{data:a.dataParametrosUsuario.geografiaDeRiesgo},valueTemplate:"{idGeografiaDeRiesgo}",textTemplate:"{Descripcion}",events:{select:function(f){a.clearResultadoMatriz()}}});a.txtPerfilInversorNivelExperienciaInversionesDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.ddlPerfilInversorExperienciaInversionesTitulo.shieldDropDown({dataSource:{data:a.dataParametrosUsuario.geografiaDeRiesgo},valueTemplate:"{idGeografiaDeRiesgo}",textTemplate:"{Descripcion}",events:{select:function(f){a.clearResultadoMatriz()}}});a.txtPerfilInversorExperienciaInversionesTituloDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.ddlPerfilInversorRelacionInversionPatrimonio.shieldDropDown({dataSource:{data:a.dataParametrosUsuario.geografiaDeRiesgo},valueTemplate:"{idGeografiaDeRiesgo}",textTemplate:"{Descripcion}",events:{select:function(f){a.clearResultadoMatriz()}}});a.txtPerfilInversorRelacionInversionPatrimonioDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.ddlPerfilInversorMontoOperacionesEstimado.shieldDropDown({dataSource:{data:a.dataParametrosUsuario.geografiaDeRiesgo},valueTemplate:"{idGeografiaDeRiesgo}",textTemplate:"{Descripcion}",events:{select:function(f){a.clearResultadoMatriz()}}});a.txtPerfilInversorMontoOperacionesEstimadoDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.ddlPerfilInversorObjetivoInversion.shieldDropDown({dataSource:{data:a.dataParametrosUsuario.geografiaDeRiesgo},valueTemplate:"{idGeografiaDeRiesgo}",textTemplate:"{Descripcion}",events:{select:function(f){a.clearResultadoMatriz()}}});a.txtPerfilInversorObjetivoInversionDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.ddlPerfilInversorTipoInversion.shieldDropDown({dataSource:{data:a.dataParametrosUsuario.geografiaDeRiesgo},valueTemplate:"{idGeografiaDeRiesgo}",textTemplate:"{Descripcion}",events:{select:function(f){a.clearResultadoMatriz()}}});a.txtPerfilInversorTipoInversionDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.ddlPerfilInversorNivelToleranciaRiesgo.shieldDropDown({dataSource:{data:a.dataParametrosUsuario.geografiaDeRiesgo},valueTemplate:"{idGeografiaDeRiesgo}",textTemplate:"{Descripcion}",events:{select:function(f){a.clearResultadoMatriz()}}});a.txtPerfilInversorNivelToleranciaRiesgoDescripcion.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.txtObservaciones.shieldTextBox({events:{change:function(f){a.clearResultadoMatriz()}}});a.controlPerfilTransaccionalTotal=new Core.Controls.DecimalPicker(a.txtPerfilTransaccionalTotal,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,onChange:function(){a.clearResultadoMatriz()}});a.btnCalculoRiesgoTipoPersonaJuridica.unbind("click");a.btnCalculoRiesgoTipoPersonaJuridica.click(function(){var g="";g+="<table class='table table-striped'>";g+="<thead><tr><th>Tipo de Jurídica</th><th>Riesgo</th></tr></thead>";g+="<tbody>";g+="<tr>";g+="<td>SAS y Sociedades de Hecho</td>";g+="<td>Medio Bajo</td>";g+="</tr>";g+="<tr>";g+="<td>S.A., S.R.L., Sociedad en Comandita por Acciones, Sociedades Colectivas, UTEs</td>";g+="<td>Medio Bajo</td>";g+="</tr>";g+="<tr>";g+="<td>Asociaciones civiles, mutuales, cooperativas y fundaciones</td>";g+="<td>Medio Bajo</td>";g+="</tr>";g+="<tr>";g+="<td>Entidades públicas y/ó capital mixto, cajas de prevensión</td>";g+="<td>Alto</td>";g+="</tr>";g+="<tr>";g+="<td>Entidades extranjeras</td>";g+="<td>Medio Alto</td>";g+="</tr>";g+="<tr>";g+="<td>Otras</td>";g+="<td>Medio Alto</td>";g+="</tr>";g+="</tbody>";g+="</table>";var f=new Core.Controls.Dialog("Ayuda",g,{displayButtons:{close:true,accept:false}});f.show()});a.btnCalcular.unbind("click");a.btnCalcular.click(function(){var f=a.getData(true,false);if(f){var g=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"matrizderiesgo/calcular/riesgo",requestType:"POST",requestData:f});g.onSuccess=function(h){a.lblResultado.html((h.datos[0]&&h.datos[0].ResultadoRiesgoDescripcion)?h.datos[0].ResultadoRiesgoDescripcion:"");a.resultadoMatriz=h;a.lblWatningRecalcularRiesgo.hide()};g.request()}});a.btnGenerarNueva.unbind("click");a.btnGenerarNueva.click(function(){a.loadData(null,true)});a.btnDescargarMatriz.unbind("click");a.btnDescargarMatriz.click(function(){function g(o){var n=new Blob([o.response],{type:o.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(n);return}var h=window.URL.createObjectURL(n);var m=document.createElement("a");m.href=h;var k=o.getResponseHeader("Content-Disposition").split("; ");var j="filename=matriz.pdf";for(var l=0;l<k.length;l++){if(k[l].indexOf("filename")>=0){j=k[l]}}m.download=j.split("=")[1];m.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(h)}var f=new XMLHttpRequest();f.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"descargar/14/"+a.cuilCuit+"?Version="+a.ddlVersion.swidget().value(),true);f.responseType="blob";f.setRequestHeader("Authorization",Core.Objects.Context.Token);f.onload=function(h){if(f.status==200){g(f)}else{var i=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga de la matriz.</p>",{displayButtons:{close:true,accept:false}});i.show()}};f.send()});a.btnRefrescarPerfilTransaccional.unbind("click");a.btnRefrescarPerfilTransaccional.click(function(){var f=a.getData(false,true);if(f){var g=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"matrizderiesgo/calcular/perfil",requestType:"POST",requestData:f});g.onSuccess=function(h){a.controlBienesPersonalesPerfilTransaccional.setValue((h.datos[0]&&h.datos[0].BsPersPerfilTransaccional)?h.datos[0].BsPersPerfilTransaccional:"");a.controlAutonomoResponsableInscriptoPerfilTransaccional.setValue((h.datos[0]&&h.datos[0].AutonomoPerfilTransaccional)?h.datos[0].AutonomoPerfilTransaccional:"");a.controlEstadoContablePerfilTransaccional.setValue((h.datos[0]&&h.datos[0].EstadosContablesPerfilTransaccional)?h.datos[0].EstadosContablesPerfilTransaccional:"");a.controlIngresosAnualesPerfilTransaccional.setValue((h.datos[0]&&h.datos[0].CertificacionIngresoPerfilTransaccional)?h.datos[0].CertificacionIngresoPerfilTransaccional:"");a.controlInscripcionMonotributoPerfilTransaccional.setValue((h.datos[0]&&h.datos[0].MonotributoPerfilTransaccional)?h.datos[0].MonotributoPerfilTransaccional:"");a.controlReciboSueldoJubilacionPerfilTransaccional.setValue((h.datos[0]&&h.datos[0].ReciboDeSueldoPerfilTransaccional)?h.datos[0].ReciboDeSueldoPerfilTransaccional:"");a.controlPerfilTransaccionalTotal.setValue((h.datos[0]&&h.datos[0].PerfilTransaccionalTotal)?h.datos[0].PerfilTransaccionalTotal:"");a.lblWarningPerfilTransaccionalResultante.html((h.datos[0]&&h.datos[0].TextoPerfilResultante)?('<i class="fa fa-exclamation-triangle" aria-hidden="true"></i> '+h.datos[0].TextoPerfilResultante):"");a.lblWarningDateBienesPersonalesFechaDeclaracionJurada.text((h.datos[0]&&h.datos[0].BsPersFechaVencida)?h.datos[0].BsPersFechaVencida:"");a.lblWarningDateIngresosAnualesFechaDeclaracionJurada.text((h.datos[0]&&h.datos[0].CertificacionIngresoFechaVencida)?h.datos[0].CertificacionIngresoFechaVencida:"");a.lblWarningDateAutonomoResponsableInscriptoFechaAltaImpuesto.text((h.datos[0]&&h.datos[0].AutonomoFechaVencida)?h.datos[0].AutonomoFechaVencida:"");a.lblWarningDateReciboSueldoJubilacionFechaIngreso.text((h.datos[0]&&h.datos[0].ReciboDeSueldoFechaVencida)?h.datos[0].ReciboDeSueldoFechaVencida:"");a.lblWarningDateInscripcionMonotributoFechaAltaCategoria.text((h.datos[0]&&h.datos[0].MonotributoFechaVencida)?h.datos[0].MonotributoFechaVencida:"");a.lblWarningDateEstadoContableFechaBalance.text((h.datos[0]&&h.datos[0].EstadosContablesFechaVencida)?h.datos[0].EstadosContablesFechaVencida:"")};g.request()}});a.btnGuardarYCerrar.unbind("click");a.btnGuardarYCerrar.click(function(){var f=a.getData(false,false);if(f){new Core.Controls.Confirmation("Confirmación","¿Esta seguro que desea generar una nueva versión de la Matriz de Riesgo?",{onAccepted:function(){var g=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"matrizderiesgo/actualizar",requestType:"POST",requestData:f});g.onSuccess=function(){a.onSave(Core.Functions.Decimal.parseFloat(a.txtPerfilTransaccionalTotal.val()),a.resultadoMatriz.datos[0].ResultadoIdRiesgo);a.container.modal("hide");a.destroy()};g.request()}}).show()}});a.btnGuardarYCerrar.hide();a.btnCalcular.hide();a.btnRefrescarPerfilTransaccional.hide();a.btnGenerarNueva.hide();a.btnVolver.unbind("click");a.btnVolver.click(function(){a.container.modal("hide");a.destroy()});a.btnVolver.show();if(!a.origenApertura){a.btnVolver.hide()}a.loadData()}})};a.loadData=function(h,d){var f="matrizderiesgo/";var c=false;if(!a.calcularMatrizManual){if(!d&&(a.consultarMatriz||(h&&h!=a.ultimaVersion))){f+=("datos/"+a.cuilCuit)}else{f+="precargar/";if(a.idAperturaCuenta!=null&&a.tipo!=null&&a.numero!=null){f+=("persona/"+a.idAperturaCuenta+"/"+a.tipo+"/"+a.numero)}else{f+=("cuil/"+a.cuilCuit)}c=true}}a.btnGuardarYCerrar.hide();a.btnCalcular.hide();a.btnRefrescarPerfilTransaccional.hide();a.btnGenerarNueva.hide();if(a.calcularMatrizManual){a.btnRefrescarPerfilTransaccional.show();a.btnCalcular.show()}else{if(!a.readOnly){a.btnGenerarNueva.show();if(c){a.btnGenerarNueva.hide();if(a.pageOptions&&a.pageOptions.matrizDeRiesgoEditar){a.btnGuardarYCerrar.show()}a.btnCalcular.show();a.btnRefrescarPerfilTransaccional.show()}}}a.divContainerDataMatrizRiesgo.show();a.divVersion.show();a.btnDescargarMatriz.show();if(a.calcularMatrizManual||c){a.divVersion.hide();a.btnDescargarMatriz.hide()}if(a.calcularMatrizManual){a.dataMatriz={datos:[]};a.setData()}else{var e={showOverlay:true,secureRequest:true,requestUrl:f,requestType:"GET"};if(h){e.requestData={Version:h}}var g=new Core.Ajax.ServerRequest(e);g.onSuccess=function(l){a.dataMatriz=l;if(!a.ultimaVersion){a.ultimaVersion=l.versiones&&a.dataMatriz.versiones.length?a.dataMatriz.versiones.length:1;var n=[];for(var j=0;j<a.ultimaVersion;j++){var m=l.versiones?a.dataMatriz.versiones[j]:null;n.push({idVersion:(m?m.Version:1),Descripcion:("Versión "+((m)?(m.Version+" | "+m.Usuario+" | "+m.Fecha):"1"))})}var k=a.ddlVersion.swidget().initialOptions;k.dataSource.data=n;k.value=a.ultimaVersion.toString();a.ddlVersion.swidget().refresh(k);if(!a.dataMatriz.datos[0]||!a.dataMatriz.datos[0].CUIT_CUIL||a.dataMatriz.datos[0].CUIT_CUIL==""){a.divVersion.hide();a.btnDescargarMatriz.hide();a.divContainerDataMatrizRiesgo.hide()}}a.setData()};g.request()}};a.setData=function(){a.txtDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].Nombre)?a.dataMatriz.datos[0].Nombre:"");Core.Functions.Validations.toggleValidation(a.txtDescripcion,false);a.txtIdentificacionFiscal.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CUIT_CUIL)?a.dataMatriz.datos[0].CUIT_CUIL:"");Core.Functions.Validations.toggleValidation(a.txtIdentificacionFiscal,false);a.txtClienteDesde.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].Fecha1raApertura)?a.dataMatriz.datos[0].Fecha1raApertura:"");Core.Functions.Validations.toggleValidation(a.txtClienteDesde,false);a.txtFechaEmision.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].FechaEmision)?Core.Functions.Date.getDateByString(a.dataMatriz.datos[0].FechaEmision):new Date());Core.Functions.Validations.toggleValidation(a.txtFechaEmision,false);a.lblNseDescripcion.text(((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].NSEValor)?(a.dataMatriz.datos[0].NSEValor+" - "):"Sin información")+((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].NSEAntiguedad)?(a.dataMatriz.datos[0].NSEAntiguedad+"  meses de antigüedad"):""));a.lblResultado.html((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].ResultadoRiesgoDescripcion)?a.dataMatriz.datos[0].ResultadoRiesgoDescripcion:"");if(a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].ResultadoRiesgoDescripcion){a.resultadoMatriz={datos:[{}]};a.resultadoMatriz.datos[0].ResultadoRiesgoDescripcion=a.dataMatriz.datos[0].ResultadoRiesgoDescripcion;a.resultadoMatriz.datos[0].ResultadoRiesgoValor=a.dataMatriz.datos[0].ResultadoRiesgoValor;a.resultadoMatriz.datos[0].ResultadoIdRiesgo=a.dataMatriz.datos[0].ResultadoIdRiesgo;a.lblWatningRecalcularRiesgo.hide()}else{a.resultadoMatriz=null;a.lblWatningRecalcularRiesgo.show()}a.chkTipoPersonaFisica.swidget().checked(false);a.chkTipoPersonaJuridica.swidget().checked(false);a.chkCalculoRiesgoPEPSi.swidget().checked(false);a.chkCalculoRiesgoPEPNo.swidget().checked(false);a.chkCalculoRiesgoAntiguedadMenor24MesesSi.swidget().checked(false);a.chkCalculoRiesgoAntiguedadMenor24MesesNo.swidget().checked(false);a.chkCalculoRiesgoPresentaInusualidadesDesfavorablesSi.swidget().checked(false);a.chkCalculoRiesgoPresentaInusualidadesDesfavorablesNo.swidget().checked(false);a.chkCalculoRiesgoPresentoDocumentacionRespaldoSi.swidget().checked(false);a.chkCalculoRiesgoPresentoDocumentacionRespaldoNo.swidget().checked(false);a.chkCalculoRiesgoNoticiasAdversasPlaftSi.swidget().checked(false);a.chkCalculoRiesgoNoticiasAdversasPlaftNo.swidget().checked(false);a.chkCalculoRiesgoEsTerroristaSi.swidget().checked(false);a.chkCalculoRiesgoEsTerroristaNo.swidget().checked(false);if(a.dataMatriz.datos[0]){if(a.dataMatriz.datos[0].EsPersonaFisica!=null){if(a.dataMatriz.datos[0].EsPersonaFisica==1){a.chkTipoPersonaFisica.swidget().checked(true)}else{if(a.dataMatriz.datos[0].EsPersonaFisica==0){a.chkTipoPersonaJuridica.swidget().checked(true)}}}if(a.dataMatriz.datos[0].CalculoRiesgoEsPEP!=null){if(a.dataMatriz.datos[0].CalculoRiesgoEsPEP==1){a.chkCalculoRiesgoPEPSi.swidget().checked(true)}else{if(a.dataMatriz.datos[0].CalculoRiesgoEsPEP==0){a.chkCalculoRiesgoPEPNo.swidget().checked(true)}}}if(a.dataMatriz.datos[0].CalculoRiesgoAntiguedadMenor24Meses!=null){if(a.dataMatriz.datos[0].CalculoRiesgoAntiguedadMenor24Meses==1){a.chkCalculoRiesgoAntiguedadMenor24MesesSi.swidget().checked(true)}else{if(a.dataMatriz.datos[0].CalculoRiesgoAntiguedadMenor24Meses==0){a.chkCalculoRiesgoAntiguedadMenor24MesesNo.swidget().checked(true)}}}if(a.dataMatriz.datos[0].CalculoRiesgoPresentaInusualidadesDesfavorables!=null){if(a.dataMatriz.datos[0].CalculoRiesgoPresentaInusualidadesDesfavorables==1){a.chkCalculoRiesgoPresentaInusualidadesDesfavorablesSi.swidget().checked(true)}else{if(a.dataMatriz.datos[0].CalculoRiesgoPresentaInusualidadesDesfavorables==0){a.chkCalculoRiesgoPresentaInusualidadesDesfavorablesNo.swidget().checked(true)}}}if(a.dataMatriz.datos[0].CalculoRiesgoDocumentacionDeRespaldo!=null){if(a.dataMatriz.datos[0].CalculoRiesgoDocumentacionDeRespaldo==1){a.chkCalculoRiesgoPresentoDocumentacionRespaldoSi.swidget().checked(true)}else{if(a.dataMatriz.datos[0].CalculoRiesgoDocumentacionDeRespaldo==0){a.chkCalculoRiesgoPresentoDocumentacionRespaldoNo.swidget().checked(true)}}}if(a.dataMatriz.datos[0].CalculoRiesgoNoticiasAdversasPLAFT!=null){if(a.dataMatriz.datos[0].CalculoRiesgoNoticiasAdversasPLAFT==1){a.chkCalculoRiesgoNoticiasAdversasPlaftSi.swidget().checked(true)}else{if(a.dataMatriz.datos[0].CalculoRiesgoNoticiasAdversasPLAFT==0){a.chkCalculoRiesgoNoticiasAdversasPlaftNo.swidget().checked(true)}}}if(a.dataMatriz.datos[0].CalculoRiesgoEsTerrorista!=null){if(a.dataMatriz.datos[0].CalculoRiesgoEsTerrorista==1){a.chkCalculoRiesgoEsTerroristaSi.swidget().checked(true)}else{if(a.dataMatriz.datos[0].CalculoRiesgoEsTerrorista==0){a.chkCalculoRiesgoEsTerroristaNo.swidget().checked(true)}}}}else{if(a.calcularMatrizManual){a.chkTipoPersonaJuridica.swidget().checked(true)}}a.chkBienesPersonalesGanancias.swidget().checked(false);if(a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].BsPers){a.chkBienesPersonalesGanancias.swidget().checked(true)}if(a.chkBienesPersonalesGanancias.swidget().checked()){a.divDataBienesPersonalesGanancias.show()}else{a.divDataBienesPersonalesGanancias.hide()}a.chkCertificacionIngresosAnuales.swidget().checked(false);if(a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CertificacionIngresos){a.chkCertificacionIngresosAnuales.swidget().checked(true)}if(a.chkCertificacionIngresosAnuales.swidget().checked()){a.divDataCertificacionIngresosAnuales.show()}else{a.divDataCertificacionIngresosAnuales.hide()}a.chkAutonomoResponsableInscripto.swidget().checked(false);if(a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].Autonomo){a.chkAutonomoResponsableInscripto.swidget().checked(true)}if(a.chkAutonomoResponsableInscripto.swidget().checked()){a.divDataAutonomoResponsableInscripto.show()}else{a.divDataAutonomoResponsableInscripto.hide()}a.chkGrupoActividadesSociedadesComercialesCiviles.swidget().checked(false);if(a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].AutonomoActividadSociedades){a.chkGrupoActividadesSociedadesComercialesCiviles.swidget().checked(true)}a.chkGrupoActividadesLocacionesPrestacionesServicios.swidget().checked(false);if(a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].AutonomoActividadLocaciones){a.chkGrupoActividadesLocacionesPrestacionesServicios.swidget().checked(true)}a.chkGrupoActividadesRestoDeActividades.swidget().checked(false);if(a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].AutonomoActividadResto){a.chkGrupoActividadesRestoDeActividades.swidget().checked(true)}a.chkGrupoActividadesAfiliacionesVoluntarias.swidget().checked(false);if(a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].AutonomoActividadAfiliacionesVoluntarias){a.chkGrupoActividadesAfiliacionesVoluntarias.swidget().checked(true)}a.chkGrupoActividadesMenores.swidget().checked(false);if(a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].AutonomoActividadMenor21){a.chkGrupoActividadesMenores.swidget().checked(true)}a.chkGrupoActividadesJubilados.swidget().checked(false);if(a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].AutonomoActividadJubilados){a.chkGrupoActividadesJubilados.swidget().checked(true)}a.chkGrupoActividadesAmasDeCasa.swidget().checked(false);if(a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].AutonomoActividadAmaDeCasa){a.chkGrupoActividadesAmasDeCasa.swidget().checked(true)}a.chkReciboSueldoJubilacion.swidget().checked(false);if(a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].ReciboDeSueldo){a.chkReciboSueldoJubilacion.swidget().checked(true)}if(a.chkReciboSueldoJubilacion.swidget().checked()){a.divDataReciboSueldoJubilacion.show()}else{a.divDataReciboSueldoJubilacion.hide()}a.chkInscripcionMonotributo.swidget().checked(false);if(a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].Monotributo){a.chkInscripcionMonotributo.swidget().checked(true)}if(a.chkInscripcionMonotributo.swidget().checked()){a.divDataInscripcionMonotributo.show()}else{a.divDataInscripcionMonotributo.hide()}a.chkEstadoContable.swidget().checked(false);if(a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].EstadosContables){a.chkEstadoContable.swidget().checked(true)}if(a.chkEstadoContable.swidget().checked()){a.divDataEstadoContable.show()}else{a.divDataEstadoContable.hide()}a.dateBienesPersonalesFechaDeclaracionJurada.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].BsPersFechaDeclaracion)?Core.Functions.Date.getDateByString(a.dataMatriz.datos[0].BsPersFechaDeclaracion):new Date());Core.Functions.Validations.toggleValidation(a.dateBienesPersonalesFechaDeclaracionJurada,false);a.dateIngresosAnualesFechaDeclaracionJurada.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CertificacionIngresosFechaDeclaracion)?Core.Functions.Date.getDateByString(a.dataMatriz.datos[0].CertificacionIngresosFechaDeclaracion):new Date());Core.Functions.Validations.toggleValidation(a.dateIngresosAnualesFechaDeclaracionJurada,false);a.dateAutonomoResponsableInscriptoFechaAltaImpuesto.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].AutonomoFechaImpuesto)?Core.Functions.Date.getDateByString(a.dataMatriz.datos[0].AutonomoFechaImpuesto):new Date());Core.Functions.Validations.toggleValidation(a.dateAutonomoResponsableInscriptoFechaAltaImpuesto,false);a.dateReciboSueldoJubilacionFechaIngreso.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].ReciboDeSueldoFechaIngreso)?Core.Functions.Date.getDateByString(a.dataMatriz.datos[0].ReciboDeSueldoFechaIngreso):new Date());Core.Functions.Validations.toggleValidation(a.dateReciboSueldoJubilacionFechaIngreso,false);a.dateInscripcionMonotributoFechaAltaCategoria.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].MonotributoFechaAltaCategoria)?Core.Functions.Date.getDateByString(a.dataMatriz.datos[0].MonotributoFechaAltaCategoria):new Date());Core.Functions.Validations.toggleValidation(a.dateInscripcionMonotributoFechaAltaCategoria,false);a.dateEstadoContableFechaBalance.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].EstadosContablesFechaBalance)?Core.Functions.Date.getDateByString(a.dataMatriz.datos[0].EstadosContablesFechaBalance):new Date());Core.Functions.Validations.toggleValidation(a.dateEstadoContableFechaBalance,false);a.lblWarningDateBienesPersonalesFechaDeclaracionJurada.text((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].BsPersFechaVencida)?a.dataMatriz.datos[0].BsPersFechaVencida:"");a.lblWarningDateIngresosAnualesFechaDeclaracionJurada.text((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CertificacionIngresoFechaVencida)?a.dataMatriz.datos[0].CertificacionIngresoFechaVencida:"");a.lblWarningDateAutonomoResponsableInscriptoFechaAltaImpuesto.text((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].AutonomoFechaVencida)?a.dataMatriz.datos[0].AutonomoFechaVencida:"");a.lblWarningDateReciboSueldoJubilacionFechaIngreso.text((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].ReciboDeSueldoFechaVencida)?a.dataMatriz.datos[0].ReciboDeSueldoFechaVencida:"");a.lblWarningDateInscripcionMonotributoFechaAltaCategoria.text((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].MonotributoFechaVencida)?a.dataMatriz.datos[0].MonotributoFechaVencida:"");a.lblWarningDateEstadoContableFechaBalance.text((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].EstadosContablesFechaBalance)?a.dataMatriz.datos[0].EstadosContablesFechaBalance:"");a.ddlCalculoRiesgoGeografiaAltoRiesgo.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoEsGeografiaAltoRiesgo!=null)?a.dataMatriz.datos[0].CalculoRiesgoEsGeografiaAltoRiesgo.toString():"");Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoGeografiaAltoRiesgo,false);a.ddlCalculoRiesgoConexionSustancialGeografiaAltoRiesgo.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoConexionSustancialGeografiaAltoRiesgo!=null)?a.dataMatriz.datos[0].CalculoRiesgoConexionSustancialGeografiaAltoRiesgo.toString():"");Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoConexionSustancialGeografiaAltoRiesgo,false);a.ddlCalculoRiesgoTipoPersonaJuridica.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoTipoPersonaJuridica!=null)?a.dataMatriz.datos[0].CalculoRiesgoTipoPersonaJuridica.toString():"");Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoTipoPersonaJuridica,false);a.txtCalculoRiesgoTipoPersonaJuridicaDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoTipoPersonaJuridicaDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoTipoPersonaJuridicaDescripcion:"");Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoTipoPersonaJuridicaDescripcion,false);a.ddlCalculoRiesgoPerfilInversor.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoProductosInversion)?a.dataMatriz.datos[0].CalculoRiesgoProductosInversion.toString():"");Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoPerfilInversor,false);a.ddlCalculoRiesgoCanalVenta.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoCanalDeVenta)?a.dataMatriz.datos[0].CalculoRiesgoCanalDeVenta.toString():"");Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoCanalVenta,false);a.ddlCalculoRiesgoPaisLocalizacionFuenteIngresos.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoPaisLocalizacionFuenteIngresos!=null)?a.dataMatriz.datos[0].CalculoRiesgoPaisLocalizacionFuenteIngresos.toString():"");Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoPaisLocalizacionFuenteIngresos,false);a.ddlCalculoRiesgoPaisLocalizacionActivos.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoPaisLocalizacionActivos!=null)?a.dataMatriz.datos[0].CalculoRiesgoPaisLocalizacionActivos.toString():"");Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoPaisLocalizacionActivos,false);a.ddlCalculoRiesgoFactorDiscrecional.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoFactorDiscrecional!=null)?a.dataMatriz.datos[0].CalculoRiesgoFactorDiscrecional.toString():"");Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoFactorDiscrecional,false);a.ddlCalculoRiesgoPagoATerceros.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoPagoATerceros!=null)?a.dataMatriz.datos[0].CalculoRiesgoPagoATerceros.toString():"");Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoPagoATerceros,false);a.txtCalculoRiesgoGeografiaAltoRiesgoDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoEsGeografiaAltoRiesgoDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoEsGeografiaAltoRiesgoDescripcion:"");a.txtCalculoRiesgoGeografiaAltoRiesgoDescripcion.swidget().enabled((!a.calcularMatrizManual&&a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoEsGeografiaAltoRiesgoDescripcion)?false:true);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoGeografiaAltoRiesgoDescripcion,false);a.txtCalculoRiesgoPaisLocalizacionFuenteIngresosDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoPaisLocalizacionFuenteIngresosDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoPaisLocalizacionFuenteIngresosDescripcion:"");a.txtCalculoRiesgoPaisLocalizacionFuenteIngresosDescripcion.swidget().enabled((!a.calcularMatrizManual&&a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoPaisLocalizacionFuenteIngresosDescripcion)?false:true);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoPaisLocalizacionFuenteIngresosDescripcion,false);a.txtCalculoRiesgoPaisLocalizacionActivosDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoPaisLocalizacionActivosDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoPaisLocalizacionActivosDescripcion:"");a.txtCalculoRiesgoPaisLocalizacionActivosDescripcion.swidget().enabled((!a.calcularMatrizManual&&a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoPaisLocalizacionActivosDescripcion)?false:true);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoPaisLocalizacionActivosDescripcion,false);a.txtCalculoRiesgoFactorDiscrecionalDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoFactorDiscrecionalDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoFactorDiscrecionalDescripcion:"");a.txtCalculoRiesgoFactorDiscrecionalDescripcion.swidget().enabled((!a.calcularMatrizManual&&a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoFactorDiscrecionalDescripcion)?false:true);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoFactorDiscrecionalDescripcion,false);a.txtCalculoRiesgoPagoATercerosDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoPagoATercerosDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoPagoATercerosDescripcion:"");a.txtCalculoRiesgoPagoATercerosDescripcion.swidget().enabled((!a.calcularMatrizManual&&a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoPagoATercerosDescripcion)?false:true);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoPagoATercerosDescripcion,false);Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoActividadAltoRiesgo,false);a.txtCalculoRiesgoActividadAltoRiesgoDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoEsActividadAltoRiesgoDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoEsActividadAltoRiesgoDescripcion:"");a.txtCalculoRiesgoActividadAltoRiesgoDescripcion.swidget().enabled((!a.calcularMatrizManual&&a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoEsActividadAltoRiesgoDescripcion)?false:true);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoActividadAltoRiesgoDescripcion,false);a.txtCalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion:"");a.txtCalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion.swidget().enabled((!a.calcularMatrizManual&&a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion)?false:true);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion,false);a.txtCalculoRiesgoNoticasAdversasPlaftDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoNoticiasAdversasPLAFTDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoNoticiasAdversasPLAFTDescripcion:"");a.txtCalculoRiesgoNoticasAdversasPlaftDescripcion.swidget().enabled(a.calcularMatrizManual);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoNoticasAdversasPlaftDescripcion,false);a.txtCalculoRiesgoEsTerroristaDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoEsTerroristaDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoEsTerroristaDescripcion:"");a.txtCalculoRiesgoEsTerroristaDescripcion.swidget().enabled(a.calcularMatrizManual);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoEsTerroristaDescripcion,false);a.txtCalculoRiesgoPresentoDocumentacionRespaldoDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoDocumentacionDeRespaldoDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoDocumentacionDeRespaldoDescripcion:"");a.txtCalculoRiesgoPresentoDocumentacionRespaldoDescripcion.swidget().enabled(a.calcularMatrizManual);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoPresentoDocumentacionRespaldoDescripcion,false);a.txtCalculoRiesgoCanalVentaDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoCanalDeVentaDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoCanalDeVentaDescripcion:"");a.txtCalculoRiesgoCanalVentaDescripcion.swidget().enabled(a.calcularMatrizManual);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoCanalVentaDescripcion,false);a.txtCalculoRiesgoPerfilInversorDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoProductosInversionDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoProductosInversionDescripcion:"");a.txtCalculoRiesgoPerfilInversorDescripcion.swidget().enabled(a.calcularMatrizManual);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoPerfilInversorDescripcion,false);a.txtCalculoRiesgoPresentaInusualidadesDesfavorablesDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoPresentaInusualidadesDesfavorablesDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoPresentaInusualidadesDesfavorablesDescripcion:"");a.txtCalculoRiesgoPresentaInusualidadesDesfavorablesDescripcion.swidget().enabled(a.calcularMatrizManual);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoPresentaInusualidadesDesfavorablesDescripcion,false);a.txtCalculoRiesgoAntiguedadMenor24MesesDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoAntiguedadMenor24MesesDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoAntiguedadMenor24MesesDescripcion:"");a.txtCalculoRiesgoAntiguedadMenor24MesesDescripcion.swidget().enabled(a.calcularMatrizManual);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoAntiguedadMenor24MesesDescripcion,false);a.txtCalculoRiesgoPEPDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CalculoRiesgoEsPEPDescripcion)?a.dataMatriz.datos[0].CalculoRiesgoEsPEPDescripcion:"");a.txtCalculoRiesgoPEPDescripcion.swidget().enabled(a.calcularMatrizManual);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoPEPDescripcion,false);a.ddlPerfilInversorEdad.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].PerfilInversorEdad!=null)?a.dataMatriz.datos[0].PerfilInversorEdad.toString():"");Core.Functions.Validations.toggleValidation(a.ddlPerfilInversorEdad,false);a.txtPerfilInversorEdadDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].PerfilInversorEdadDescripcion)?a.dataMatriz.datos[0].PerfilInversorEdadDescripcion:"");a.txtPerfilInversorEdadDescripcion.swidget().enabled(a.calcularMatrizManual);Core.Functions.Validations.toggleValidation(a.txtPerfilInversorEdadDescripcion,false);a.ddlPerfilInversorNivelExperienciaInversiones.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].PerfilInversorNivelExperienciaInversiones!=null)?a.dataMatriz.datos[0].PerfilInversorNivelExperienciaInversiones.toString():"");Core.Functions.Validations.toggleValidation(a.ddlPerfilInversorNivelExperienciaInversiones,false);a.txtPerfilInversorNivelExperienciaInversionesDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].PerfilInversorNivelExperienciaInversionesDescripcion)?a.dataMatriz.datos[0].PerfilInversorNivelExperienciaInversionesDescripcion:"");a.txtPerfilInversorNivelExperienciaInversionesDescripcion.swidget().enabled(a.calcularMatrizManual);Core.Functions.Validations.toggleValidation(a.txtPerfilInversorNivelExperienciaInversionesDescripcion,false);a.ddlPerfilInversorExperienciaInversionesTitulo.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].PerfilInversorExperienciaInversionesTitulo!=null)?a.dataMatriz.datos[0].PerfilInversorExperienciaInversionesTitulo.toString():"");Core.Functions.Validations.toggleValidation(a.ddlPerfilInversorExperienciaInversionesTitulo,false);a.txtPerfilInversorExperienciaInversionesTituloDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].PerfilInversorExperienciaInversionesTituloDescripcion)?a.dataMatriz.datos[0].PerfilInversorExperienciaInversionesTituloDescripcion:"");a.txtPerfilInversorExperienciaInversionesTituloDescripcion.swidget().enabled(a.calcularMatrizManual);Core.Functions.Validations.toggleValidation(a.txtPerfilInversorExperienciaInversionesTituloDescripcion,false);a.ddlPerfilInversorRelacionInversionPatrimonio.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].PerfilInversorRelacionInversionPatrimonio!=null)?a.dataMatriz.datos[0].PerfilInversorRelacionInversionPatrimonio.toString():"");Core.Functions.Validations.toggleValidation(a.ddlPerfilInversorRelacionInversionPatrimonio,false);a.txtPerfilInversorRelacionInversionPatrimonioDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].PerfilInversorRelacionInversionPatrimonioDescripcion)?a.dataMatriz.datos[0].PerfilInversorRelacionInversionPatrimonioDescripcion:"");a.txtPerfilInversorRelacionInversionPatrimonioDescripcion.swidget().enabled(a.calcularMatrizManual);Core.Functions.Validations.toggleValidation(a.txtPerfilInversorRelacionInversionPatrimonioDescripcion,false);a.ddlPerfilInversorMontoOperacionesEstimado.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].PerfilInversorMontoOperacionesEstimado!=null)?a.dataMatriz.datos[0].PerfilInversorMontoOperacionesEstimado.toString():"");Core.Functions.Validations.toggleValidation(a.ddlPerfilInversorMontoOperacionesEstimado,false);a.txtPerfilInversorMontoOperacionesEstimadoDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].PerfilInversorMontoOperacionesEstimadoDescripcion)?a.dataMatriz.datos[0].PerfilInversorMontoOperacionesEstimadoDescripcion:"");a.txtPerfilInversorMontoOperacionesEstimadoDescripcion.swidget().enabled(a.calcularMatrizManual);Core.Functions.Validations.toggleValidation(a.txtPerfilInversorMontoOperacionesEstimadoDescripcion,false);a.ddlPerfilInversorObjetivoInversion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].PerfilInversorObjetivoInversion!=null)?a.dataMatriz.datos[0].PerfilInversorObjetivoInversion.toString():"");Core.Functions.Validations.toggleValidation(a.ddlPerfilInversorObjetivoInversion,false);a.txtPerfilInversorObjetivoInversionDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].PerfilInversorObjetivoInversionDescripcion)?a.dataMatriz.datos[0].PerfilInversorObjetivoInversionDescripcion:"");a.txtPerfilInversorObjetivoInversionDescripcion.swidget().enabled(a.calcularMatrizManual);Core.Functions.Validations.toggleValidation(a.txtPerfilInversorObjetivoInversionDescripcion,false);a.ddlPerfilInversorTipoInversion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].PerfilInversorTipoInversion!=null)?a.dataMatriz.datos[0].PerfilInversorTipoInversion.toString():"");Core.Functions.Validations.toggleValidation(a.ddlPerfilInversorTipoInversion,false);a.txtPerfilInversorTipoInversionDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].PerfilInversorTipoInversionDescripcion)?a.dataMatriz.datos[0].PerfilInversorTipoInversionDescripcion:"");a.txtPerfilInversorTipoInversionDescripcion.swidget().enabled(a.calcularMatrizManual);Core.Functions.Validations.toggleValidation(a.txtPerfilInversorTipoInversionDescripcion,false);a.ddlPerfilInversorNivelToleranciaRiesgo.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].PerfilInversorNivelToleranciaRiesgo!=null)?a.dataMatriz.datos[0].PerfilInversorNivelToleranciaRiesgo.toString():"");Core.Functions.Validations.toggleValidation(a.ddlPerfilInversorNivelToleranciaRiesgo,false);a.txtPerfilInversorNivelToleranciaRiesgoDescripcion.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].PerfilInversorNivelToleranciaRiesgoDescripcion)?a.dataMatriz.datos[0].PerfilInversorNivelToleranciaRiesgoDescripcion:"");a.txtPerfilInversorNivelToleranciaRiesgoDescripcion.swidget().enabled(a.calcularMatrizManual);Core.Functions.Validations.toggleValidation(a.txtPerfilInversorNivelToleranciaRiesgoDescripcion,false);a.txtObservaciones.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].Observaciones)?a.dataMatriz.datos[0].Observaciones:"");Core.Functions.Validations.toggleValidation(a.txtObservaciones,false);a.txtInscripcionMonotributoCategoria.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].MonotributoCategoria)?a.dataMatriz.datos[0].MonotributoCategoria:"");Core.Functions.Validations.toggleValidation(a.txtInscripcionMonotributoCategoria,false);a.txtAutonomoResponsableInscriptoCategoria.swidget().value((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].AutonomoCategoria)?a.dataMatriz.datos[0].AutonomoCategoria:"");Core.Functions.Validations.toggleValidation(a.txtAutonomoResponsableInscriptoCategoria,false);a.controlBienesPersonalesPatrimonioNetoTotal.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].BsPersTotalPatrimonioNeto)?a.dataMatriz.datos[0].BsPersTotalPatrimonioNeto:"");Core.Functions.Validations.toggleValidation(a.txtBienesPersonalesPatrimonioNetoTotal,false);a.controlBienesPersonalesDineroEfectivo.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].BsPersDineroEnEfectivo)?a.dataMatriz.datos[0].BsPersDineroEnEfectivo:"");Core.Functions.Validations.toggleValidation(a.txtBienesPersonalesDineroEfectivo,false);a.controlBienesPersonalesExcentos.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].BsPersExcentos)?a.dataMatriz.datos[0].BsPersExcentos:"");Core.Functions.Validations.toggleValidation(a.txtBienesPersonalesExcentos,false);a.controlBienesPersonalesPerfilTransaccional.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].BsPersPerfilTransaccional)?a.dataMatriz.datos[0].BsPersPerfilTransaccional:"");Core.Functions.Validations.toggleValidation(a.txtBienesPersonalesPerfilTransaccional,false);a.controlCertificacionIngresosAnualesResultadoNeto.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CertificacionIngresosResultadoNeto)?a.dataMatriz.datos[0].CertificacionIngresosResultadoNeto:"");Core.Functions.Validations.toggleValidation(a.txtCertificacionIngresosAnualesResultadoNeto,false);a.controlIngresosAnualesPerfilTransaccional.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CertificacionIngresoPerfilTransaccional)?a.dataMatriz.datos[0].CertificacionIngresoPerfilTransaccional:"");Core.Functions.Validations.toggleValidation(a.txtCertificacionIngresosAnualesPerfilTransaccional,false);a.controlAutonomoResponsableInscriptoIngresosMensuales.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].AutonomoIngresosMensuales)?a.dataMatriz.datos[0].AutonomoIngresosMensuales:"");Core.Functions.Validations.toggleValidation(a.txtAutonomoResponsableInscriptoIngresosMensuales,false);a.controlAutonomoResponsableInscriptoPerfilTransaccional.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].AutonomoPerfilTransaccional)?a.dataMatriz.datos[0].AutonomoPerfilTransaccional:"");Core.Functions.Validations.toggleValidation(a.txtAutonomoResponsableInscriptoPerfilTransaccional,false);a.controlReciboSueldoJubilacionNetoRecibido.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].ReciboDeSueldoNetoRecibido)?a.dataMatriz.datos[0].ReciboDeSueldoNetoRecibido:"");Core.Functions.Validations.toggleValidation(a.txtReciboSueldoJubilacionNetoRecibido,false);a.controlReciboSueldoJubilacionPerfilTransaccional.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].ReciboDeSueldoPerfilTransaccional)?a.dataMatriz.datos[0].ReciboDeSueldoPerfilTransaccional:"");Core.Functions.Validations.toggleValidation(a.txtReciboSueldoJubilacionPerfilTransaccional,false);a.controlInscripcionMonotributoPerfilTransaccional.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].MonotributoPerfilTransaccional)?a.dataMatriz.datos[0].MonotributoPerfilTransaccional:"");Core.Functions.Validations.toggleValidation(a.txtInscripcionMonotributoPerfilTransaccional,false);a.controlEstadoContableActivoCorriente.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].EstadosContablesActivo)?a.dataMatriz.datos[0].EstadosContablesActivo:"");Core.Functions.Validations.toggleValidation(a.txtEstadoContableActivoCorriente,false);a.controlEstadoContablePasivoCorriente.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].EstadosContablesPasivo)?a.dataMatriz.datos[0].EstadosContablesPasivo:"");Core.Functions.Validations.toggleValidation(a.txtEstadoContablePasivoCorriente,false);a.controlEstadoContableVentasNetas.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].EstadosContablesVentasNetas)?a.dataMatriz.datos[0].EstadosContablesVentasNetas:"");Core.Functions.Validations.toggleValidation(a.txtEstadoContableVentasNetas,false);a.controlEstadoContablePerfilTransaccional.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].EstadosContablesPerfilTransaccional)?a.dataMatriz.datos[0].EstadosContablesPerfilTransaccional:"");Core.Functions.Validations.toggleValidation(a.txtEstadoContablePerfilTransaccional,false);a.controlPerfilTransaccionalTotal.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].PerfilTransaccionalTotal)?a.dataMatriz.datos[0].PerfilTransaccionalTotal:"");Core.Functions.Validations.toggleValidation(a.txtPerfilTransaccionalTotal,false);a.controlNseValor.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].NSEMonto)?a.dataMatriz.datos[0].NSEMonto:"");a.btnNosis.unbind("click");a.btnNosis.hide();if(a.calcularMatrizManual||(a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].CUIT_CUIL)){a.btnNosis.show();a.btnNosis.attr("disabled","disabled");a.btnNosis.css("border-color",a.calcularMatrizManual?"lightgreen":((!a.dataMatriz.datos[0].tieneNOSIS)?"lightcoral":((a.dataMatriz.datos[0].tieneNOSIS=="1")?"lightgreen":a.dataMatriz.datos[0].tieneNOSIS)));if((a.optionsApertura&&a.optionsApertura.consultaNosis)||(a.pageOptions&&a.pageOptions.consultaNosis)){a.btnNosis.removeAttr("disabled");a.btnNosis.on("click",function(){if(a.calcularMatrizManual){Core.Functions.Validations.toggleValidation(a.txtIdentificacionFiscal,false);if(!a.txtIdentificacionFiscal.val()||!Core.Functions.Validations.isNumeric(a.txtIdentificacionFiscal.val())||!Core.Functions.Validations.isCuit(a.txtIdentificacionFiscal.val())){Core.Functions.Validations.toggleValidation(a.txtIdentificacionFiscal,true)}else{Core.Functions.ExternalServices.Nosis.showReport(a.txtIdentificacionFiscal.val())}}else{Core.Functions.ExternalServices.Nosis.showReport(a.btnNosis,a.dataMatriz.datos[0].CUIT_CUIL)}})}}a.setWarningPerfilTransaccionalResultante();a.setQuestions()};a.getData=function(d,e){Core.Functions.Validations.toggleValidation(a.txtDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtIdentificacionFiscal,false);Core.Functions.Validations.toggleValidation(a.txtClienteDesde,false);Core.Functions.Validations.toggleValidation(a.txtFechaEmision,false);Core.Functions.Validations.toggleValidation(a.dateBienesPersonalesFechaDeclaracionJurada,false);Core.Functions.Validations.toggleValidation(a.dateIngresosAnualesFechaDeclaracionJurada,false);Core.Functions.Validations.toggleValidation(a.dateAutonomoResponsableInscriptoFechaAltaImpuesto,false);Core.Functions.Validations.toggleValidation(a.dateReciboSueldoJubilacionFechaIngreso,false);Core.Functions.Validations.toggleValidation(a.dateInscripcionMonotributoFechaAltaCategoria,false);Core.Functions.Validations.toggleValidation(a.dateEstadoContableFechaBalance,false);Core.Functions.Validations.toggleValidation(a.txtBienesPersonalesPatrimonioNetoTotal,false);Core.Functions.Validations.toggleValidation(a.txtBienesPersonalesDineroEfectivo,false);Core.Functions.Validations.toggleValidation(a.txtBienesPersonalesExcentos,false);Core.Functions.Validations.toggleValidation(a.txtBienesPersonalesPerfilTransaccional,false);Core.Functions.Validations.toggleValidation(a.txtCertificacionIngresosAnualesResultadoNeto,false);Core.Functions.Validations.toggleValidation(a.txtCertificacionIngresosAnualesPerfilTransaccional,false);Core.Functions.Validations.toggleValidation(a.txtAutonomoResponsableInscriptoCategoria,false);Core.Functions.Validations.toggleValidation(a.txtAutonomoResponsableInscriptoIngresosMensuales,false);Core.Functions.Validations.toggleValidation(a.txtAutonomoResponsableInscriptoPerfilTransaccional,false);Core.Functions.Validations.toggleValidation(a.txtReciboSueldoJubilacionNetoRecibido,false);Core.Functions.Validations.toggleValidation(a.txtReciboSueldoJubilacionPerfilTransaccional,false);Core.Functions.Validations.toggleValidation(a.txtInscripcionMonotributoCategoria,false);Core.Functions.Validations.toggleValidation(a.txtInscripcionMonotributoPerfilTransaccional,false);Core.Functions.Validations.toggleValidation(a.txtEstadoContableActivoCorriente,false);Core.Functions.Validations.toggleValidation(a.txtEstadoContablePasivoCorriente,false);Core.Functions.Validations.toggleValidation(a.txtEstadoContableVentasNetas,false);Core.Functions.Validations.toggleValidation(a.txtEstadoContablePerfilTransaccional,false);Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoGeografiaAltoRiesgo,false);Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoConexionSustancialGeografiaAltoRiesgo,false);Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoTipoPersonaJuridica,false);Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoPerfilInversor,false);Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoCanalVenta,false);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoGeografiaAltoRiesgoDescripcion,false);Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoPaisLocalizacionActivos,false);Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoPaisLocalizacionFuenteIngresos,false);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoPaisLocalizacionActivosDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoPaisLocalizacionFuenteIngresosDescripcion,false);Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoFactorDiscrecional,false);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoFactorDiscrecionalDescripcion,false);Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoPagoATerceros,false);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoPagoATercerosDescripcion,false);Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoActividadAltoRiesgo,false);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoActividadAltoRiesgoDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoTipoPersonaJuridicaDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoNoticasAdversasPlaftDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoEsTerroristaDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoPresentoDocumentacionRespaldoDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoCanalVentaDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoPerfilInversorDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoPresentaInusualidadesDesfavorablesDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoAntiguedadMenor24MesesDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoPEPDescripcion,false);Core.Functions.Validations.toggleValidation(a.ddlPerfilInversorEdad,false);Core.Functions.Validations.toggleValidation(a.txtPerfilInversorEdadDescripcion,false);Core.Functions.Validations.toggleValidation(a.ddlPerfilInversorNivelExperienciaInversiones,false);Core.Functions.Validations.toggleValidation(a.txtPerfilInversorNivelExperienciaInversionesDescripcion,false);Core.Functions.Validations.toggleValidation(a.ddlPerfilInversorExperienciaInversionesTitulo,false);Core.Functions.Validations.toggleValidation(a.txtPerfilInversorExperienciaInversionesTituloDescripcion,false);Core.Functions.Validations.toggleValidation(a.ddlPerfilInversorRelacionInversionPatrimonio,false);Core.Functions.Validations.toggleValidation(a.txtPerfilInversorRelacionInversionPatrimonioDescripcion,false);Core.Functions.Validations.toggleValidation(a.ddlPerfilInversorMontoOperacionesEstimado,false);Core.Functions.Validations.toggleValidation(a.txtPerfilInversorMontoOperacionesEstimadoDescripcion,false);Core.Functions.Validations.toggleValidation(a.ddlPerfilInversorObjetivoInversion,false);Core.Functions.Validations.toggleValidation(a.txtPerfilInversorObjetivoInversionDescripcion,false);Core.Functions.Validations.toggleValidation(a.ddlPerfilInversorTipoInversion,false);Core.Functions.Validations.toggleValidation(a.txtPerfilInversorTipoInversionDescripcion,false);Core.Functions.Validations.toggleValidation(a.ddlPerfilInversorNivelToleranciaRiesgo,false);Core.Functions.Validations.toggleValidation(a.txtPerfilInversorNivelToleranciaRiesgoDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtObservaciones,false);Core.Functions.Validations.toggleValidation(a.txtPerfilTransaccionalTotal,false);var f={value:true};var c={datos:[{}]};if(a.dataMatriz.datos[0]){if(a.dataMatriz.datos[0].Nombre!=null){c.datos[0].Nombre=a.dataMatriz.datos[0].Nombre}if(a.dataMatriz.datos[0].CUIT_CUIL!=null){c.datos[0].CUIT_CUIL=a.dataMatriz.datos[0].CUIT_CUIL}if(a.dataMatriz.datos[0].Fecha1raApertura!=null){c.datos[0].Fecha1raApertura=a.dataMatriz.datos[0].Fecha1raApertura}if(a.dataMatriz.datos[0].FechaEmision!=null){c.datos[0].FechaEmision=a.dataMatriz.datos[0].FechaEmision}if(a.dataMatriz.datos[0].NSEAntiguedad!=null){c.datos[0].NSEAntiguedad=a.dataMatriz.datos[0].NSEAntiguedad}if(a.dataMatriz.datos[0].NSEMonto!=null){c.datos[0].NSEMonto=a.dataMatriz.datos[0].NSEMonto}if(a.dataMatriz.datos[0].NSEValor!=null){c.datos[0].NSEValor=a.dataMatriz.datos[0].NSEValor}if(a.dataMatriz.datos[0].Version!=null){c.datos[0].Version=a.dataMatriz.datos[0].Version}if(a.dataMatriz.datos[0].VersionCalculo!=null){c.datos[0].VersionCalculo=a.dataMatriz.datos[0].VersionCalculo}if(a.dataMatriz.datos[0].CalculoRiesgoEsActividadAltoRiesgo!=null){c.datos[0].CalculoRiesgoEsActividadAltoRiesgo=a.dataMatriz.datos[0].CalculoRiesgoEsActividadAltoRiesgo}}else{if(a.calcularMatrizManual){if(!a.txtIdentificacionFiscal.val()||!Core.Functions.Validations.isNumeric(a.txtIdentificacionFiscal.val())||!Core.Functions.Validations.isCuit(a.txtIdentificacionFiscal.val())){Core.Functions.Validations.toggleValidation(a.txtIdentificacionFiscal,true);f.value=false}else{c.datos[0].CUIT_CUIL=Core.Functions.Validations.getValidatedSwidgetValue(a.txtIdentificacionFiscal,f)}c.datos[0].NSEMonto=Core.Functions.Decimal.parseFloat(a.lblNseValor.val())}else{c.datos[0].CUIT_CUIL=a.cuilCuit}}c.datos[0].BsPers=a.chkBienesPersonalesGanancias.swidget().checked()?1:0;if(c.datos[0].BsPers){c.datos[0].BsPersFechaDeclaracion=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.dateBienesPersonalesFechaDeclaracionJurada,f));if(a.txtBienesPersonalesPatrimonioNetoTotal.val()){c.datos[0].BsPersTotalPatrimonioNeto=Core.Functions.Decimal.parseFloat(a.txtBienesPersonalesPatrimonioNetoTotal.val())}if(a.txtBienesPersonalesDineroEfectivo.val()){c.datos[0].BsPersDineroEnEfectivo=Core.Functions.Decimal.parseFloat(a.txtBienesPersonalesDineroEfectivo.val())}if(a.txtBienesPersonalesExcentos.val()){c.datos[0].BsPersExcentos=Core.Functions.Decimal.parseFloat(a.txtBienesPersonalesExcentos.val())}if(e){c.datos[0].BsPersPerfilTransaccional=Core.Functions.Decimal.parseFloat(a.txtBienesPersonalesPerfilTransaccional.val())}else{c.datos[0].BsPersPerfilTransaccional=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtBienesPersonalesPerfilTransaccional,f))}}c.datos[0].CertificacionIngresos=a.chkCertificacionIngresosAnuales.swidget().checked()?1:0;if(c.datos[0].CertificacionIngresos){c.datos[0].CertificacionIngresosFechaDeclaracion=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.dateIngresosAnualesFechaDeclaracionJurada,f));if(a.txtCertificacionIngresosAnualesResultadoNeto.val()){c.datos[0].CertificacionIngresosResultadoNeto=Core.Functions.Decimal.parseFloat(a.txtCertificacionIngresosAnualesResultadoNeto.val())}if(e){c.datos[0].CertificacionIngresoPerfilTransaccional=Core.Functions.Decimal.parseFloat(a.txtCertificacionIngresosAnualesPerfilTransaccional.val())}else{c.datos[0].CertificacionIngresoPerfilTransaccional=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtCertificacionIngresosAnualesPerfilTransaccional,f))}}c.datos[0].Autonomo=a.chkAutonomoResponsableInscripto.swidget().checked()?1:0;if(c.datos[0].Autonomo){c.datos[0].AutonomoActividadSociedades=a.chkGrupoActividadesSociedadesComercialesCiviles.swidget().checked()?1:0;c.datos[0].AutonomoActividadLocaciones=a.chkGrupoActividadesLocacionesPrestacionesServicios.swidget().checked()?1:0;c.datos[0].AutonomoActividadResto=a.chkGrupoActividadesRestoDeActividades.swidget().checked()?1:0;c.datos[0].AutonomoActividadAfiliacionesVoluntarias=a.chkGrupoActividadesAfiliacionesVoluntarias.swidget().checked()?1:0;c.datos[0].AutonomoActividadMenor21=a.chkGrupoActividadesMenores.swidget().checked()?1:0;c.datos[0].AutonomoActividadJubilados=a.chkGrupoActividadesJubilados.swidget().checked()?1:0;c.datos[0].AutonomoActividadAmaDeCasa=a.chkGrupoActividadesAmasDeCasa.swidget().checked()?1:0;c.datos[0].AutonomoFechaImpuesto=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.dateAutonomoResponsableInscriptoFechaAltaImpuesto,f));c.datos[0].AutonomoCategoria=Core.Functions.Validations.getValidatedSwidgetValue(a.txtAutonomoResponsableInscriptoCategoria,f);if(a.txtAutonomoResponsableInscriptoIngresosMensuales.val()){c.datos[0].AutonomoIngresosMensuales=Core.Functions.Decimal.parseFloat(a.txtAutonomoResponsableInscriptoIngresosMensuales.val())}if(e){c.datos[0].AutonomoPerfilTransaccional=Core.Functions.Decimal.parseFloat(a.txtAutonomoResponsableInscriptoPerfilTransaccional.val())}else{c.datos[0].AutonomoPerfilTransaccional=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtAutonomoResponsableInscriptoPerfilTransaccional,f))}}c.datos[0].ReciboDeSueldo=a.chkReciboSueldoJubilacion.swidget().checked()?1:0;if(c.datos[0].ReciboDeSueldo){c.datos[0].ReciboDeSueldoFechaIngreso=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.dateReciboSueldoJubilacionFechaIngreso,f));if(a.txtReciboSueldoJubilacionNetoRecibido.val()){c.datos[0].ReciboDeSueldoNetoRecibido=Core.Functions.Decimal.parseFloat(a.txtReciboSueldoJubilacionNetoRecibido.val())}if(e){c.datos[0].ReciboDeSueldoPerfilTransaccional=Core.Functions.Decimal.parseFloat(a.txtReciboSueldoJubilacionPerfilTransaccional.val())}else{c.datos[0].ReciboDeSueldoPerfilTransaccional=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtReciboSueldoJubilacionPerfilTransaccional,f))}}c.datos[0].Monotributo=a.chkInscripcionMonotributo.swidget().checked()?1:0;if(c.datos[0].Monotributo){c.datos[0].MonotributoFechaAltaCategoria=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.dateInscripcionMonotributoFechaAltaCategoria,f));c.datos[0].MonotributoCategoria=Core.Functions.Validations.getValidatedSwidgetValue(a.txtInscripcionMonotributoCategoria,f);if(e){c.datos[0].MonotributoPerfilTransaccional=Core.Functions.Decimal.parseFloat(a.txtInscripcionMonotributoPerfilTransaccional.val())}else{c.datos[0].MonotributoPerfilTransaccional=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtInscripcionMonotributoPerfilTransaccional,f))}}c.datos[0].EstadosContables=a.chkEstadoContable.swidget().checked()?1:0;if(c.datos[0].EstadosContables){c.datos[0].EstadosContablesFechaBalance=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.dateEstadoContableFechaBalance,f));if(a.txtEstadoContableActivoCorriente.val()){c.datos[0].EstadosContablesActivo=Core.Functions.Decimal.parseFloat(a.txtEstadoContableActivoCorriente.val())}if(a.txtEstadoContablePasivoCorriente.val()){c.datos[0].EstadosContablesPasivo=Core.Functions.Decimal.parseFloat(a.txtEstadoContablePasivoCorriente.val())}if(a.txtEstadoContableVentasNetas.val()){c.datos[0].EstadosContablesVentasNetas=Core.Functions.Decimal.parseFloat(a.txtEstadoContableVentasNetas.val())}if(e){c.datos[0].EstadosContablesPerfilTransaccional=Core.Functions.Decimal.parseFloat(a.txtEstadoContablePerfilTransaccional.val())}else{c.datos[0].EstadosContablesPerfilTransaccional=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtEstadoContablePerfilTransaccional,f))}}c.datos[0].EsPersonaFisica=a.getSelectedTipoPersona(a.chkTipoPersonaFisica,a.chkTipoPersonaJuridica,f);if(!e){c.datos[0].CalculoRiesgoEsTerrorista=a.getSelectedOption(a.chkCalculoRiesgoEsTerroristaSi,a.chkCalculoRiesgoEsTerroristaNo,"Debe indicar si se encuentra en la nómina de terrorismo ONU",f);c.datos[0].CalculoRiesgoNoticiasAdversasPLAFT=a.getSelectedOption(a.chkCalculoRiesgoNoticiasAdversasPlaftSi,a.chkCalculoRiesgoNoticiasAdversasPlaftNo,"Debe indicar si presenta noticias adversas plaft",f);c.datos[0].CalculoRiesgoDocumentacionDeRespaldo=a.getSelectedOption(a.chkCalculoRiesgoPresentoDocumentacionRespaldoSi,a.chkCalculoRiesgoPresentoDocumentacionRespaldoNo,"Debe indicar si presentó documetación de respaldo",f);c.datos[0].CalculoRiesgoPresentaInusualidadesDesfavorables=a.getSelectedOption(a.chkCalculoRiesgoPresentaInusualidadesDesfavorablesSi,a.chkCalculoRiesgoPresentaInusualidadesDesfavorablesNo,"Debe indicar si presenta inusualidades resultas de manera desfavorable",f);c.datos[0].CalculoRiesgoAntiguedadMenor24Meses=a.getSelectedOption(a.chkCalculoRiesgoAntiguedadMenor24MesesSi,a.chkCalculoRiesgoAntiguedadMenor24MesesNo,"Debe indicar si posee antiguedad menor a 24 meses como cliente de Balanz",f);c.datos[0].CalculoRiesgoEsPEP=a.getSelectedOption(a.chkCalculoRiesgoPEPSi,a.chkCalculoRiesgoPEPNo,"Debe indicar si es PEP",f);if(a.chkTipoPersonaJuridica.swidget().checked()){c.datos[0].CalculoRiesgoConexionSustancialGeografiaAltoRiesgo=Core.Functions.Validations.getValidatedDropDownValue(a.ddlCalculoRiesgoConexionSustancialGeografiaAltoRiesgo,f);c.datos[0].CalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtCalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion,f);c.datos[0].CalculoRiesgoTipoPersonaJuridica=Core.Functions.Validations.getValidatedDropDownValue(a.ddlCalculoRiesgoTipoPersonaJuridica,f);c.datos[0].CalculoRiesgoTipoPersonaJuridicaDescripcion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtCalculoRiesgoTipoPersonaJuridicaDescripcion,f)}c.datos[0].CalculoRiesgoEsGeografiaAltoRiesgo=Core.Functions.Validations.getValidatedDropDownValue(a.ddlCalculoRiesgoGeografiaAltoRiesgo,f);c.datos[0].CalculoRiesgoProductosInversion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlCalculoRiesgoPerfilInversor,f);c.datos[0].CalculoRiesgoCanalDeVenta=Core.Functions.Validations.getValidatedDropDownValue(a.ddlCalculoRiesgoCanalVenta,f);c.datos[0].CalculoRiesgoEsGeografiaAltoRiesgoDescripcion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtCalculoRiesgoGeografiaAltoRiesgoDescripcion,f);c.datos[0].CalculoRiesgoEsActividadAltoRiesgoDescripcion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtCalculoRiesgoActividadAltoRiesgoDescripcion,f);c.datos[0].CalculoRiesgoPaisLocalizacionFuenteIngresos=Core.Functions.Validations.getValidatedDropDownValue(a.ddlCalculoRiesgoPaisLocalizacionFuenteIngresos,f);c.datos[0].CalculoRiesgoPaisLocalizacionFuenteIngresosDescripcion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtCalculoRiesgoPaisLocalizacionFuenteIngresosDescripcion,f);c.datos[0].CalculoRiesgoPaisLocalizacionActivos=Core.Functions.Validations.getValidatedDropDownValue(a.ddlCalculoRiesgoPaisLocalizacionActivos,f);c.datos[0].CalculoRiesgoPaisLocalizacionActivosDescripcion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtCalculoRiesgoPaisLocalizacionActivosDescripcion,f);c.datos[0].CalculoRiesgoFactorDiscrecional=Core.Functions.Validations.getValidatedDropDownValue(a.ddlCalculoRiesgoFactorDiscrecional,f);c.datos[0].CalculoRiesgoFactorDiscrecionalDescripcion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtCalculoRiesgoFactorDiscrecionalDescripcion,f);c.datos[0].CalculoRiesgoPagoATerceros=Core.Functions.Validations.getValidatedDropDownValue(a.ddlCalculoRiesgoPagoATerceros,f);c.datos[0].CalculoRiesgoPagoATercerosDescripcion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtCalculoRiesgoPagoATercerosDescripcion,f);c.datos[0].CalculoRiesgoNoticiasAdversasPLAFTDescripcion=a.txtCalculoRiesgoNoticasAdversasPlaftDescripcion.swidget().value();c.datos[0].CalculoRiesgoEsTerroristaDescripcion=a.txtCalculoRiesgoEsTerroristaDescripcion.swidget().value();c.datos[0].CalculoRiesgoDocumentacionDeRespaldoDescripcion=a.txtCalculoRiesgoPresentoDocumentacionRespaldoDescripcion.swidget().value();c.datos[0].CalculoRiesgoCanalDeVentaDescripcion=a.txtCalculoRiesgoCanalVentaDescripcion.swidget().value();c.datos[0].CalculoRiesgoProductosInversionDescripcion=a.txtCalculoRiesgoPerfilInversorDescripcion.swidget().value();c.datos[0].CalculoRiesgoPresentaInusualidadesDesfavorablesDescripcion=a.txtCalculoRiesgoPresentaInusualidadesDesfavorablesDescripcion.swidget().value();c.datos[0].CalculoRiesgoAntiguedadMenor24MesesDescripcion=a.txtCalculoRiesgoAntiguedadMenor24MesesDescripcion.swidget().value();c.datos[0].CalculoRiesgoEsPEPDescripcion=a.txtCalculoRiesgoPEPDescripcion.swidget().value();c.datos[0].Observaciones=a.txtObservaciones.swidget().value();c.datos[0].PerfilTransaccionalTotal=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtPerfilTransaccionalTotal,f));c.datos[0].PerfilInversorEdad=Core.Functions.Validations.getValidatedDropDownValue(a.ddlPerfilInversorEdad,f);c.datos[0].PerfilInversorEdadDescripcion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtPerfilInversorEdadDescripcion,f);c.datos[0].PerfilInversorNivelExperienciaInversiones=Core.Functions.Validations.getValidatedDropDownValue(a.ddlPerfilInversorNivelExperienciaInversiones,f);c.datos[0].PerfilInversorNivelExperienciaInversionesDescripcion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtPerfilInversorNivelExperienciaInversionesDescripcion,f);c.datos[0].PerfilInversorExperienciaInversionesTitulo=Core.Functions.Validations.getValidatedDropDownValue(a.ddlPerfilInversorExperienciaInversionesTitulo,f);c.datos[0].PerfilInversorExperienciaInversionesTituloDescripcion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtPerfilInversorExperienciaInversionesTituloDescripcion,f);c.datos[0].PerfilInversorRelacionInversionPatrimonio=Core.Functions.Validations.getValidatedDropDownValue(a.ddlPerfilInversorRelacionInversionPatrimonio,f);c.datos[0].PerfilInversorRelacionInversionPatrimonioDescripcion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtPerfilInversorRelacionInversionPatrimonioDescripcion,f);c.datos[0].PerfilInversorMontoOperacionesEstimado=Core.Functions.Validations.getValidatedDropDownValue(a.ddlPerfilInversorMontoOperacionesEstimado,f);c.datos[0].PerfilInversorMontoOperacionesEstimadoDescripcion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtPerfilInversorMontoOperacionesEstimado,f);c.datos[0].PerfilInversorObjetivoInversion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlPerfilInversorObjetivoInversion,f);c.datos[0].PerfilInversorObjetivoInversionDescripcion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtPerfilInversorObjetivoInversionDescripcion,f);c.datos[0].PerfilInversorTipoInversion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlPerfilInversorTipoInversion,f);c.datos[0].PerfilInversorTipoInversionDescripcion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtPerfilInversorTipoInversionDescripcion,f);c.datos[0].PerfilInversorNivelToleranciaRiesgo=Core.Functions.Validations.getValidatedDropDownValue(a.ddlPerfilInversorNivelToleranciaRiesgoActivos,f);c.datos[0].PerfilInversorNivelToleranciaRiesgoDescripcion=Core.Functions.Validations.getValidatedSwidgetValue(a.txtPerfilInversorNivelToleranciaRiesgoDescripcion,f);if(a.calcularMatrizManual){if(a.ddlCalculoRiesgoActividadAltoRiesgo.swidget().selectedItem()){c.datos[0].CalculoRiesgoEsActividadAltoRiesgo=a.ddlCalculoRiesgoActividadAltoRiesgo.swidget().selectedItem().idRiesgoActividad}else{Core.Functions.Validations.toggleValidation(a.ddlCalculoRiesgoActividadAltoRiesgo,true);f.value=false}}if(c.datos[0].CalculoRiesgoEsActividadAltoRiesgo==-1){Core.Functions.Validations.toggleValidation(a.txtCalculoRiesgoActividadAltoRiesgoDescripcion,true);new Core.Controls.Dialog("Aviso",c.datos[0].CalculoRiesgoEsActividadAltoRiesgoDescripcion,{displayButtons:{close:true,accept:false}}).show();f.value=false}if(!d){if(a.resultadoMatriz){c.datos[0].ResultadoRiesgoValor=a.resultadoMatriz.datos[0].ResultadoRiesgoValor;c.datos[0].ResultadoRiesgoDescripcion=a.resultadoMatriz.datos[0].ResultadoRiesgoDescripcion;c.datos[0].ResultadoIdRiesgo=a.resultadoMatriz.datos[0].ResultadoIdRiesgo}else{new Core.Controls.Dialog("Aviso","Los datos se han modificado. Calcular el riesgo nuevamente.",{displayButtons:{close:true,accept:false}}).show();f.value=false}}}return f.value?c:null};a.clearResultadoMatriz=function(){a.resultadoMatriz=null;a.lblResultado.html("");a.lblWatningRecalcularRiesgo.show()};a.setQuestions=function(){a.divCalculoRiesgoConexionSustancialGeografiaAltoRiesgo.removeClass("disabled");a.txtCalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion.swidget().enabled(true);a.ddlCalculoRiesgoConexionSustancialGeografiaAltoRiesgo.swidget().enabled(true);a.lblNseValor.val("");a.lblNseValor.attr("disabled","disabled");if(a.chkTipoPersonaFisica.swidget().checked()){a.divCalculoRiesgoConexionSustancialGeografiaAltoRiesgo.addClass("disabled");a.ddlCalculoRiesgoConexionSustancialGeografiaAltoRiesgo.swidget().enabled(false);a.ddlCalculoRiesgoConexionSustancialGeografiaAltoRiesgo.swidget().value("");a.txtCalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion.swidget().enabled(false);a.txtCalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion.swidget().value("");a.controlNseValor.setValue((a.dataMatriz.datos[0]&&a.dataMatriz.datos[0].NSEMonto)?a.dataMatriz.datos[0].NSEMonto:"");if(a.calcularMatrizManual){a.lblNseValor.removeAttr("disabled");var c=a.ddlCalculoRiesgoActividadAltoRiesgo.swidget().initialOptions;c.valueTemplate="idOcupacion";c.dataSource.data=a.dataParametros?a.dataParametros.ocupaciones:[];a.ddlCalculoRiesgoActividadAltoRiesgo.swidget().refresh(c);a.ddlCalculoRiesgoActividadAltoRiesgo.swidget().value("")}}a.divCalculoRiesgoTipoPersonaJuridica.hide();a.divCalculoRiesgoTipoPersonaJuridica.removeClass("disabled");a.txtCalculoRiesgoTipoPersonaJuridicaDescripcion.swidget().enabled(true);a.ddlCalculoRiesgoTipoPersonaJuridica.swidget().enabled(true);if(a.chkTipoPersonaJuridica.swidget().checked()){a.divCalculoRiesgoTipoPersonaJuridica.show();if(a.ddlCalculoRiesgoTipoPersonaJuridica.swidget().selectedItem()){a.divCalculoRiesgoTipoPersonaJuridica.addClass("disabled");a.txtCalculoRiesgoTipoPersonaJuridicaDescripcion.swidget().enabled(false);a.ddlCalculoRiesgoTipoPersonaJuridica.swidget().enabled(false)}if(a.calcularMatrizManual){var c=a.ddlCalculoRiesgoActividadAltoRiesgo.swidget().initialOptions;c.valueTemplate="idActividadJuridica";c.dataSource.data=a.dataParametros?a.dataParametros.actividadesJuridicas:[];a.ddlCalculoRiesgoActividadAltoRiesgo.swidget().refresh(c);a.ddlCalculoRiesgoActividadAltoRiesgo.swidget().value("")}}a.chkAutonomoResponsableInscripto.swidget().enabled(a.chkTipoPersonaFisica.swidget().checked());if(!a.chkAutonomoResponsableInscripto.swidget().enabled()){a.chkAutonomoResponsableInscripto.swidget().checked(false);a.divDataAutonomoResponsableInscripto.hide()}a.chkReciboSueldoJubilacion.swidget().enabled(a.chkTipoPersonaFisica.swidget().checked());if(!a.chkReciboSueldoJubilacion.swidget().enabled()){a.chkReciboSueldoJubilacion.swidget().checked(false);a.divDataReciboSueldoJubilacion.hide()}a.chkInscripcionMonotributo.swidget().enabled(a.chkTipoPersonaFisica.swidget().checked());if(!a.chkInscripcionMonotributo.swidget().enabled()){a.chkInscripcionMonotributo.swidget().checked(false);a.divDataInscripcionMonotributo.hide()}a.chkEstadoContable.swidget().enabled(a.chkTipoPersonaJuridica.swidget().checked());if(!a.chkEstadoContable.swidget().enabled()){a.chkEstadoContable.swidget().checked(false);a.divDataEstadoContable.hide()}};a.setWarningPerfilTransaccionalResultante=function(){a.lblWarningPerfilTransaccionalResultante.hide();a.txtPerfilTransaccionalTotal.removeClass("warning");if(a.chkTipoPersonaFisica.swidget().checked()&&(a.chkBienesPersonalesGanancias.swidget().checked()||a.chkCertificacionIngresosAnuales.swidget().checked()||a.chkAutonomoResponsableInscripto.swidget().checked()||a.chkReciboSueldoJubilacion.swidget().checked()||a.chkInscripcionMonotributo.swidget().checked()||a.chkEstadoContable.swidget().checked())){a.lblWarningPerfilTransaccionalResultante.show();a.txtPerfilTransaccionalTotal.addClass("warning")}};a.clearPerfilTransaccionalResultante=function(){a.txtPerfilTransaccionalTotal.val("")};a.destroy=function(){a.txtDescripcion.swidget().destroy();a.txtIdentificacionFiscal.swidget().destroy();a.txtFechaEmision.swidget().destroy();a.txtClienteDesde.swidget().destroy();a.chkBienesPersonalesGanancias.swidget().destroy();a.chkCertificacionIngresosAnuales.swidget().destroy();a.chkAutonomoResponsableInscripto.swidget().destroy();a.chkGrupoActividadesSociedadesComercialesCiviles.swidget().destroy();a.chkGrupoActividadesLocacionesPrestacionesServicios.swidget().destroy();a.chkGrupoActividadesRestoDeActividades.swidget().destroy();a.chkGrupoActividadesAfiliacionesVoluntarias.swidget().destroy();a.chkGrupoActividadesMenores.swidget().destroy();a.chkGrupoActividadesJubilados.swidget().destroy();a.chkGrupoActividadesAmasDeCasa.swidget().destroy();a.chkReciboSueldoJubilacion.swidget().destroy();a.chkInscripcionMonotributo.swidget().destroy();a.chkEstadoContable.swidget().destroy();a.dateBienesPersonalesFechaDeclaracionJurada.swidget().destroy();a.dateIngresosAnualesFechaDeclaracionJurada.swidget().destroy();a.dateAutonomoResponsableInscriptoFechaAltaImpuesto.swidget().destroy();a.dateReciboSueldoJubilacionFechaIngreso.swidget().destroy();a.dateInscripcionMonotributoFechaAltaCategoria.swidget().destroy();a.dateEstadoContableFechaBalance.swidget().destroy();a.txtAutonomoResponsableInscriptoCategoria.swidget().destroy();a.ddlCalculoRiesgoCanalVenta.swidget().destroy();a.ddlCalculoRiesgoGeografiaAltoRiesgo.swidget().destroy();a.ddlCalculoRiesgoConexionSustancialGeografiaAltoRiesgo.swidget().destroy();a.ddlCalculoRiesgoTipoPersonaJuridica.swidget().destroy();a.ddlCalculoRiesgoPerfilInversor.swidget().destroy();a.ddlVersion.swidget().destroy();a.txtCalculoRiesgoGeografiaAltoRiesgoDescripcion.swidget().destroy();a.ddlCalculoRiesgoPaisLocalizacionActivos.swidget().destroy();a.txtCalculoRiesgoPaisLocalizacionActivosDescripcion.swidget().destroy();a.ddlCalculoRiesgoPaisLocalizacionFuenteIngresos.swidget().destroy();a.txtCalculoRiesgoPaisLocalizacionFuenteIngresosDescripcion.swidget().destroy();a.ddlCalculoRiesgoFactorDiscrecional.swidget().destroy();a.txtCalculoRiesgoFactorDiscrecionalDescripcion.swidget().destroy();a.ddlCalculoRiesgoPagoATerceros.swidget().destroy();a.txtCalculoRiesgoPagoATercerosDescripcion.swidget().destroy();a.ddlCalculoRiesgoActividadAltoRiesgo.swidget().destroy();a.txtCalculoRiesgoActividadAltoRiesgoDescripcion.swidget().destroy();a.txtCalculoRiesgoConexionSustancialGeografiaAltoRiesgoDescripcion.swidget().destroy();a.txtCalculoRiesgoTipoPersonaJuridicaDescripcion.swidget().destroy();a.txtCalculoRiesgoNoticasAdversasPlaftDescripcion.swidget().destroy();a.txtCalculoRiesgoEsTerroristaDescripcion.swidget().destroy();a.txtCalculoRiesgoPresentoDocumentacionRespaldoDescripcion.swidget().destroy();a.txtCalculoRiesgoCanalVentaDescripcion.swidget().destroy();a.txtCalculoRiesgoPerfilInversorDescripcion.swidget().destroy();a.txtCalculoRiesgoPresentaInusualidadesDesfavorablesDescripcion.swidget().destroy();a.txtCalculoRiesgoAntiguedadMenor24MesesDescripcion.swidget().destroy();a.txtCalculoRiesgoPEPDescripcion.swidget().destroy();a.ddlPerfilInversorEdad.swidget().destroy();a.txtPerfilInversorEdadDescripcion.swidget().destroy();a.ddlPerfilInversorNivelExperienciaInversiones.swidget().destroy();a.txtPerfilInversorNivelExperienciaInversionesDescripcion.swidget().destroy();a.ddlPerfilInversorExperienciaInversionesTitulo.swidget().destroy();a.txtPerfilInversorExperienciaInversionesTituloDescripcion.swidget().destroy();a.ddlPerfilInversorRelacionInversionPatrimonio.swidget().destroy();a.txtPerfilInversorRelacionInversionPatrimonioDescripcion.swidget().destroy();a.ddlPerfilInversorMontoOperacionesEstimado.swidget().destroy();a.txtPerfilInversorMontoOperacionesEstimadoDescripcion.swidget().destroy();a.ddlPerfilInversorObjetivoInversion.swidget().destroy();a.txtPerfilInversorObjetivoInversionDescripcion.swidget().destroy();a.ddlPerfilInversorTipoInversion.swidget().destroy();a.txtPerfilInversorTipoInversionDescripcion.swidget().destroy();a.ddlPerfilInversorNivelToleranciaRiesgo.swidget().destroy();a.txtPerfilInversorNivelToleranciaRiesgoDescripcion.swidget().destroy();a.txtObservaciones.swidget().destroy();a.container.html("");a.onClose()};a.getSelectedTipoPersona=function(c,d,e){if(!c.swidget().checked()&&!d.swidget().checked()){new Core.Controls.Dialog("Aviso","Debe indicar si es una persona física o jurídica",{displayButtons:{close:true,accept:false}}).show();e.value=false;return null}else{return c.swidget().checked()?1:0}};a.getSelectedOption=function(d,c,e,f){if(!d.swidget().checked()&&!c.swidget().checked()){new Core.Controls.Dialog("Aviso",e,{displayButtons:{close:true,accept:false}}).show();f.value=false;return null}else{return d.swidget().checked()?1:0}}};Core.Controls.ManagerMinuta=function(b){var a=this;a.windowHeight=750;a.windowWidth=525;a.eTipoInstrumento={Bono:0,Accion:1};a.eMercado={Merval:1,Mae:2};a.eTipoContraparte={Agente:1,Comitente:2};a.divManagerMinuta=$(".div-manager-minuta");a.decimalCount=10;a.minuta=null;a.txtDateConcertacion=null;a.ddlPlazo=null;a.ddlTipoContraparte=null;a.txtComitente=null;a.lblDescripcionComitente=null;a.selectedAccount=null;a.txtMonto=null;a.ddlCuenta=null;a.ddlTipoOperacion=null;a.ddlTicker=null;a.txtCantidad=null;a.txtPrecio=null;a.chkInstrumentosAccion=null;a.chkInstrumentosBono=null;a.ddlMoneda=null;a.txtObservaciones=null;a.ddlMercado=null;a.ddlCorredores=null;a.divAplicaComisionesCorredor=null;a.chkAplicaComisionesCorredor=null;a.divAlert=null;a.onSave=null;a.onDestroy=null;a.overlayElement=null;a.btnConfirmar=null;a.btnBuscarCuentas=null;a.manager=null;$.extend(true,a,b);a.show=function(){var c={};c.panel=Core.Enums.ePanel.BonosFull;var d=new Core.Ajax.ServerRequest({allowCache:true,overlayElement:a.overlayElement,showOverlay:true,requestUrl:"especies",requestType:"GET",requestData:c});d.onSuccess=function(e){var f=new Core.Ajax.ServerRequest({allowCache:true,overlayElement:a.overlayElement,showOverlay:true,requestUrl:"corredores",requestType:"GET"});f.onSuccess=function(k){a.manager=a.divManagerMinuta.shieldWindow({title:"Bolsa / Mae",visible:false,height:a.windowHeight,width:a.windowWidth,pinned:false,titleBarButtons:["maximize","close"],position:{left:$(window).width()-a.windowWidth-40,top:$(window).height()-a.windowHeight+$(window).scrollTop()},events:{close:function(l){a.destroy()}}});a.txtDateConcertacion=a.divManagerMinuta.find(".date-picker-minuta-fecha-minuta");a.txtComitente=a.divManagerMinuta.find(".textbox-minuta-comitente");a.lblDescripcionComitente=a.divManagerMinuta.find(".lbl-minuta-descripcion-comitente");a.ddlTipoContraparte=a.divManagerMinuta.find(".dropdown-minuta-tipo-contraparte");a.ddlCuenta=a.divManagerMinuta.find(".dropdown-minuta-vehiculo");a.ddlTipoOperacion=a.divManagerMinuta.find(".dropdown-minuta-tipo-operacion");a.ddlTicker=a.divManagerMinuta.find(".dropdown-minuta-especie");a.txtCantidad=a.divManagerMinuta.find(".textbox-minuta-cantidad");a.txtPrecio=a.divManagerMinuta.find(".textbox-minuta-precio");a.chkInstrumentosBono=a.divManagerMinuta.find(".chk-minuta-instrumento-bono");a.chkInstrumentosAccion=a.divManagerMinuta.find(".chk-minuta-instrumento-accion");a.txtMonto=a.divManagerMinuta.find(".textbox-minuta-monto");a.ddlMoneda=a.divManagerMinuta.find(".dropdown-minuta-moneda");a.txtObservaciones=a.divManagerMinuta.find(".textbox-minuta-observaciones");a.ddlMercado=a.divManagerMinuta.find(".dropdown-minuta-mercado");a.ddlPlazo=a.divManagerMinuta.find(".dropdown-minuta-plazo");a.ddlCorredores=a.divManagerMinuta.find(".dropdown-minuta-corredores");a.divAplicaComisionesCorredor=a.divManagerMinuta.find(".div-minuta-aplica-comisiones-corredor");a.chkAplicaComisionesCorredor=a.divManagerMinuta.find(".checkbox-minuta-aplica-comisiones-corredor");a.divAlert=a.divManagerMinuta.find(".div-minuta-alert");a.divAlert.slideUp();a.btnConfirmar=a.divManagerMinuta.find(".btn-minuta-confirmar");a.btnBuscarCuentas=a.divManagerMinuta.find(".button-buscar-cuentas");var j={format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.minuta&&a.minuta.FechaConcertacion!=null)?a.minuta.FechaConcertacion:new Date(),max:new Date()};a.txtDateConcertacion.shieldDatePicker(j);Core.Functions.Validations.toggleValidation(a.txtDateConcertacion,false);a.ddlTipoContraparte.shieldDropDown({dataSource:{data:[{value:a.eTipoContraparte.Comitente,text:"Comitente"}]},valueTemplate:"{value}",textTemplate:"{text}",value:(a.minuta&&a.minuta.idTipoBroker!=null)?a.minuta.idTipoBroker:a.eTipoContraparte.Comitente.toString(),enabled:false});Core.Functions.Validations.toggleValidation(a.ddlTipoContraparte,false);new Core.Controls.DecimalPicker(a.txtComitente,{maxDecimalDigitCount:0,showThousandsSeparator:"",defaultValue:(a.minuta&&a.minuta.Broker!=null)?a.minuta.Broker:"",onKeyUp:function(){a.searchAccount()}});Core.Functions.Validations.toggleValidation(a.txtComitente,false);a.searchAccount();a.ddlCuenta.shieldDropDown({dataSource:{data:[{value:Core.Enums.eVehiculo.BCV,text:"BCV"}]},valueTemplate:"{value}",textTemplate:"{text}",value:(a.minuta&&a.minuta.idCuenta!=null)?a.opeminutaracion.idCuenta.toString():"",enabled:false});Core.Functions.Validations.toggleValidation(a.ddlCuenta,false);a.ddlTipoOperacion.shieldDropDown({dataSource:{data:[{value:Core.Enums.eMesaTipoOperacion.Compra,text:"Compra"},{value:Core.Enums.eMesaTipoOperacion.Venta,text:"Venta"}]},valueTemplate:"{value}",textTemplate:"{text}",value:(a.minuta&&a.minuta.idTipoOperacion!=null)?a.minuta.idTipoOperacion.toString():""});if(!a.minuta){a.ddlTipoOperacion.swidget().value("")}Core.Functions.Validations.toggleValidation(a.ddlTipoOperacion,false);a.ddlTicker.shieldComboBox({dataSource:{data:[]},valueTemplate:"{Ticker}",textTemplate:"{DisplayTicker} | {Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}}});var g=a.ddlTicker.swidget().initialOptions;g.dataSource.data=e.especies;a.ddlTicker.swidget().refresh(g);if(a.minuta&&a.minuta.ticker!=null){a.ddlTicker.swidget().value(a.minuta.ticker)}Core.Functions.Validations.toggleValidation(a.ddlTicker,false);a.ddlMoneda.shieldDropDown({dataSource:{data:[Core.Enums.Currency.Pesos,Core.Enums.Currency.Dolares,Core.Enums.Currency.DolaresCable]},valueTemplate:"{idMoneda}",textTemplate:"{Descripcion}",value:(a.minuta&&a.minuta.idMoneda!=null)?a.minuta.idMoneda.toString():Core.Enums.Currency.DolaresCable.idMoneda.toString()});if(!a.minuta){a.ddlMoneda.swidget().value("")}Core.Functions.Validations.toggleValidation(a.ddlMoneda,false);a.txtObservaciones.shieldTextBox({value:(a.minuta&&a.minuta.Observaciones!=null)?a.minuta.Observaciones:""});Core.Functions.Validations.toggleValidation(a.txtObservaciones,false);new Core.Controls.DecimalPicker(a.txtPrecio,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:(a.minuta&&a.minuta.Precio!=null)?a.minuta.Precio:"",onKeyUp:function(){a.setMonto()}});Core.Functions.Validations.toggleValidation(a.txtPrecio,false);new Core.Controls.DecimalPicker(a.txtMonto,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:(a.minuta&&a.minuta.Monto!=null)?a.minuta.Monto:"",onKeyUp:function(){a.setPrecio()}});Core.Functions.Validations.toggleValidation(a.txtMonto,false);new Core.Controls.DecimalPicker(a.txtCantidad,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:(a.minuta&&a.minuta.Cantidad!=null)?a.minuta.Cantidad:"",onKeyUp:function(){a.setMonto()}});Core.Functions.Validations.toggleValidation(a.txtCantidad,false);if(!a.chkInstrumentosAccion.swidget()){a.chkInstrumentosAccion.shieldRadioButton({label:"Acción",events:{click:function(l){a.setMonto()}}})}var h=a.chkInstrumentosAccion.swidget().initialOptions;h.checked=(a.minuta&&a.minuta.TipoInstrumentoMesa!=null)?a.minuta.TipoInstrumentoMesa==a.eTipoInstrumento.Accion:false;a.chkInstrumentosAccion.swidget().refresh(h);a.chkInstrumentosAccion.swidget().visible(true);if(!a.chkInstrumentosBono.swidget()){a.chkInstrumentosBono.shieldRadioButton({label:"Bono",events:{click:function(l){a.setMonto()}}})}var i=a.chkInstrumentosBono.swidget().initialOptions;i.checked=(a.minuta&&a.minuta.TipoInstrumentoMesa!=null)?a.minuta.TipoInstrumentoMesa==a.eTipoInstrumento.Bono:true;a.chkInstrumentosBono.swidget().refresh(i);a.chkInstrumentosBono.swidget().visible(true);a.ddlMercado.shieldDropDown({dataSource:{data:[{value:a.eMercado.Merval,text:"Merval"},{value:a.eMercado.Mae,text:"Mae"}]},valueTemplate:"{value}",textTemplate:"{text}",value:(a.minuta&&a.minuta.idMercado!=null)?a.minuta.idMercado.toString():""});if(!a.minuta){a.ddlMercado.swidget().value("")}Core.Functions.Validations.toggleValidation(a.ddlMercado,false);a.ddlPlazo.shieldDropDown({dataSource:{data:[{value:Core.Enums.ePlazo.CI,text:"CI"},{value:Core.Enums.ePlazo.D24,text:"24 hs."},{value:Core.Enums.ePlazo.D48,text:"48 hs."}]},valueTemplate:"{value}",textTemplate:"{text}",value:(a.minuta&&a.minuta.idPlazo!=null)?a.minuta.idPlazo.toString():""});if(!a.minuta){a.ddlPlazo.swidget().value("")}Core.Functions.Validations.toggleValidation(a.ddlPlazo,false);k.corredores.unshift({idCorredor:0,Descripcion:"Sin Corredor"});a.ddlCorredores.shieldDropDown({dataSource:{data:k.corredores},textTemplate:"{Descripcion}",valueTemplate:"{idCorredor}",value:(a.minuta&&a.minuta.idcorredor!=null)?a.minuta.idcorredor.toString():"",events:{select:function(l){a.setControlsByCorredor()}}});a.setControlsByCorredor();Core.Functions.Validations.toggleValidation(a.ddlCorredores,false);a.chkAplicaComisionesCorredor.shieldCheckBox({label:"Aplica Comisiones Corredor",checked:(a.minuta&&a.minuta.comision!=null)?(a.minuta.comision==1):true,});Core.Functions.Validations.toggleValidation(a.chkAplicaComisionesCorredor,false);a.btnBuscarCuentas.unbind("click");a.btnBuscarCuentas.click(function(){a.manager.swidget().visible(false);new Core.Controls.ManagerMinuta.SearchAccount({onSelected:function(l){a.btnConfirmar.show();a.selectedAccount=l;a.lblDescripcionComitente.text(a.selectedAccount.Descripcion);a.txtComitente.val(a.selectedAccount.NumComitente)},onHide:function(){a.manager.swidget().visible(true)}}).show()});a.btnConfirmar.unbind("click");a.btnConfirmar.click(function(){Core.Functions.Validations.toggleValidation(a.txtDateConcertacion,false);Core.Functions.Validations.toggleValidation(a.ddlTipoContraparte,false);Core.Functions.Validations.toggleValidation(a.txtComitente,false);Core.Functions.Validations.toggleValidation(a.ddlTicker,false);Core.Functions.Validations.toggleValidation(a.txtCantidad,false);Core.Functions.Validations.toggleValidation(a.txtPrecio,false);Core.Functions.Validations.toggleValidation(a.txtMonto,false);Core.Functions.Validations.toggleValidation(a.ddlCuenta,false);Core.Functions.Validations.toggleValidation(a.ddlMercado,false);Core.Functions.Validations.toggleValidation(a.ddlPlazo,false);Core.Functions.Validations.toggleValidation(a.ddlTipoOperacion,false);Core.Functions.Validations.toggleValidation(a.ddlMoneda,false);Core.Functions.Validations.toggleValidation(a.txtObservaciones,false);Core.Functions.Validations.toggleValidation(a.ddlCorredores,false);Core.Functions.Validations.toggleValidation(a.chkAplicaComisionesCorredor,false);a.divAlert.slideUp();var l=a.getRequestData();if(l==null){return}var m=new Core.Ajax.ServerRequest({overlayElement:a.btnConfirmar,showOverlay:true,requestUrl:"minutas/insertar",requestType:(a.minuta!=null&&a.minuta.idMinuta!=null)?"PUT":"POST",requestData:l});m.onSuccess=function(n){a.destroy();if(a.onSave){a.onSave()}};m.onError=function(o){var n=(o.responseJSON&&o.responseJSON.Descripcion)?o.responseJSON.Descripcion:"Algunos componentes de la página no se cargaron correctamente. Por favor intente mas tarde...";a.divAlert.text(n);a.divAlert.slideDown()};m.request()});if(a.minuta){a.setMonto()}a.divManagerMinuta.swidget().visible(true);a.txtDateConcertacion.swidget().focus()};f.request()};d.request()};a.searchAccount=function(){if(a.txtComitente.val()){var c=new Core.Ajax.ServerRequest({showOverlay:false,secureRequest:true,requestUrl:"cuentas/numdescripcion/"+Core.Enums.eVehiculo.BCV+"/"+a.txtComitente.val(),requestType:"GET"});c.onSuccess=function(d){if(d.cuentas.length==1){a.btnConfirmar.show();a.selectedAccount=d.cuentas[0];a.lblDescripcionComitente.text(a.selectedAccount.Descripcion)}else{a.btnConfirmar.hide();a.selectedAccount=null;a.lblDescripcionComitente.text("Comitente no encontrado")}};c.request()}else{a.btnConfirmar.hide();a.selectedAccount=null;a.lblDescripcionComitente.text("Comitente no encontrado")}};a.setControlsByCorredor=function(){if(a.ddlCorredores.swidget().selectedItem()&&a.ddlCorredores.swidget().selectedItem().idCorredor!=0){a.divAplicaComisionesCorredor.show()}else{a.divAplicaComisionesCorredor.hide()}};a.getRequestData=function(){var d={value:true};var c={data:{idCuenta:((a.selectedAccount)?a.selectedAccount.idCuenta:0),idCuentaMesa:Core.Functions.Validations.getValidatedDropDownValue(a.ddlCuenta),FechaConcertacion:Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtDateConcertacion,d)),idMercado:Core.Functions.Validations.getValidatedDropDownValue(a.ddlMercado,d),idTipoOperacion:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,d),ticker:Core.Functions.Validations.getValidatedSwidgetValue(a.ddlTicker,d),Plazo:Core.Functions.Validations.getValidatedDropDownValue(a.ddlPlazo,d),idMoneda:Core.Functions.Validations.getValidatedDropDownValue(a.ddlMoneda,d),Cantidad:Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidad,d)),Precio:Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecio,d)),PrecioReferencia:Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecio,d)),Monto:Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtMonto,d)),Observaciones:a.txtObservaciones.val(),Urgente:0,esCruce:0,CodMercadoExterno:"",TipoInstrumentoMesa:a.getSelectedInstrumento(d),idTipoBroker:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoContraparte),Broker:((a.selectedAccount)?a.selectedAccount.NumComitente:0),idBroker:((a.selectedAccount)?a.selectedAccount.CodComitente:0),corredor:((a.ddlCorredores.swidget().selectedItem())?a.ddlCorredores.swidget().selectedItem().Descripcion:""),idcorredor:((a.ddlCorredores.swidget().selectedItem())?a.ddlCorredores.swidget().selectedItem().idCorredor:0),comision:((a.ddlCorredores.swidget().selectedItem()&&a.ddlCorredores.swidget().selectedItem().idCorredor&&a.chkAplicaComisionesCorredor[0].checked)?1:0)}};if(d.value){return c}else{return null}};a.getSelectedInstrumento=function(c){if(a.chkInstrumentosAccion.swidget().checked()){return a.eTipoInstrumento.Accion}else{if(a.chkInstrumentosBono.swidget().checked()){return a.eTipoInstrumento.Bono}else{c.value=false;a.divAlert.text("Debe seleccionar un tipo de instrumento.");a.divAlert.slideDown()}}};a.setMonto=function(){var c=a.txtMonto.val();if(a.chkInstrumentosAccion.swidget().checked()){if(a.txtCantidad.val()&&a.txtPrecio.val()){c=(Core.Functions.Decimal.parseFloat(a.txtCantidad.val())*Core.Functions.Decimal.parseFloat(a.txtPrecio.val()))}}if(a.chkInstrumentosBono.swidget().checked()){if(a.txtCantidad.val()&&a.txtPrecio.val()){c=(Core.Functions.Decimal.parseFloat(a.txtCantidad.val())*Core.Functions.Decimal.parseFloat(a.txtPrecio.val()))/100}}a.txtMonto.val(c);a.txtMonto.blur()};a.setPrecio=function(){var c=a.txtPrecio.val();if(a.chkInstrumentosAccion.swidget().checked()){if(a.txtCantidad.val()&&a.txtMonto.val()){c=(Core.Functions.Decimal.parseFloat(a.txtMonto.val())/Core.Functions.Decimal.parseFloat(a.txtCantidad.val()))}}if(a.chkInstrumentosBono.swidget().checked()){if(a.txtCantidad.val()&&a.txtMonto.val()){c=(Core.Functions.Decimal.parseFloat(a.txtMonto.val())*100/Core.Functions.Decimal.parseFloat(a.txtCantidad.val()))}}a.txtPrecio.val(c);a.txtPrecio.blur()};a.destroy=function(){a.txtDateConcertacion.swidget().destroy();a.ddlTipoContraparte.swidget().destroy();a.ddlTicker.swidget().destroy();a.txtObservaciones.swidget().destroy();a.ddlMoneda.swidget().destroy();a.ddlMercado.swidget().destroy();a.ddlPlazo.swidget().destroy();a.ddlCuenta.swidget().destroy();a.ddlTipoOperacion.swidget().destroy();a.chkInstrumentosAccion.swidget().destroy();a.chkInstrumentosBono.swidget().destroy();a.ddlCorredores.swidget().destroy();a.chkAplicaComisionesCorredor.swidget().destroy();a.divManagerMinuta.swidget().destroy();Core.Objects.Context.Dialogs.remove(this);if(a.onDestroy!=null){a.onDestroy()}}};Core.Controls.ManagerMinuta.SearchAccount=function(b){var a=this;a.divModal=$(".modal-buscar-cuentas");a.divGridCuentas=null;a.onSelected=function(){};a.onHide=function(){};$.extend(true,a,b);a.show=function(){a.divGridCuentas=a.divModal.find(".div-cuentas");a.txtFilter=a.divModal.find(".textbox-filter-cuentas");a.initControls();a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.txtFilter.swidget().focus(true);a.divModal.modal({show:true})};a.initControls=function(){a.divGridCuentas.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:[{field:"NumComitente",width:"20%",title:"Comitente",headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"Descripcion",width:"70%",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{field:"",title:" ",width:"10%",headerAttributes:Core.Functions.grid.getCellEvenClass(),buttons:[{caption:"Seleccionar",cls:"",commandName:"Seleccionar",click:function(d){var c=a.divGridCuentas.swidget().dataItem(d);a.onSelected(c);a.divModal.modal("hide")}}]}]});a.txtFilter.shieldTextBox({value:"",events:{blur:function(){a.loadGrid()}}})};a.loadGrid=function(){if(a.txtFilter.val()){var c=new Core.Ajax.ServerRequest({showOverlay:false,secureRequest:true,requestUrl:"comitentes/numdescripcion/"+Core.Enums.eVehiculo.BCV+"/"+a.txtFilter.val(),requestType:"GET"});c.onSuccess=function(f){var d=f.cuentas==null?[]:f.cuentas;var e=a.divGridCuentas.swidget().initialOptions;e.dataSource.data=d;a.divGridCuentas.swidget().refresh(e)};c.request()}};a.destroy=function(){a.divGridCuentas.swidget().destroy();a.txtFilter.swidget().destroy();a.onHide()}};Core.Controls.ManagerOperacion=function(b){var a=this;a.windowHeight=750;a.windowWidth=525;a.preciosSubidaBajada=null;a.eTipoInstrumento={Bono:0,Accion:1};a.eTipoNegocio={Monedas:0,Instrumentos:1,Concepto:4};a.eMercado={NA:0,Mae:1,MervalSenebi:2,MervalPPT:3,Banco:4,Byma:5};a.eTipoContraparte={Agente:1,Comitente:2,Banco:3,Balanz:4};a.origen=Core.Enums.eMesaOperacionOrigen.Operacion;a.pantallaOrigen=Core.Enums.eManagerOperacionPantallaOrigen.OperacionesUSD;a.opcionesDefault=Core.Enums.eMesaOperacionOpcionesDefault.NA;a.divManagerOperacion=$(".div-manager-operacion");a.decimalCount=10;a.operacion=null;a.operacionPadre=null;a.idPuntaDetalle=null;a.divDateOperacion=null;a.txtDateOperacion=null;a.divDateLiquidacion=null;a.txtDateLiquidacion=null;a.divDateLiquidacionReal=null;a.txtDateLiquidacionReal=null;a.divContraparte=null;a.ddlContraparte=null;a.txtMonto=null;a.divMonto=null;a.lblMonto2=null;a.txtMonto2=null;a.divMonto2=null;a.lblCantidad2=null;a.txtCantidad2=null;a.divCantidad2=null;a.divVehiculo=null;a.ddlVehiculo=null;a.divComitenteOperatoria=null;a.ddlComitenteOperatoria=null;a.lblOperacionCuenta=null;a.divTipoOperacion=null;a.ddlTipoOperacion=null;a.divTicker=null;a.ddlTicker=null;a.divConcepto=null;a.ddlConcepto=null;a.divSaldosIgnorados=null;a.chkSaldosIgnorados=null;a.divCantidad=null;a.txtCantidad=null;a.divPrecioReferencia=null;a.txtPrecioReferencia=null;a.divPrecio=null;a.lblPrecio=null;a.txtPrecio=null;a.divPrecio2=null;a.lblPrecio2=null;a.txtPrecio2=null;a.divTipoInstrumento=null;a.chkInstrumentosAccion=null;a.chkInstrumentosBono=null;a.divMoneda=null;a.ddlMoneda=null;a.divObservaciones=null;a.txtObservaciones=null;a.divTipoNegocio=null;a.ddlTipoNegocio=null;a.divMercado=null;a.ddlMercado=null;a.divEstado=null;a.ddlEstado=null;a.divNominalesLiquidados=null;a.txtNominalesLiquidados=null;a.divMontoPendiente=null;a.txtMontoPendiente=null;a.divMontoLiquidado=null;a.txtMontoLiquidado=null;a.divTipoContraparte=null;a.ddlTipoContraparte=null;a.divUsd=null;a.chkUsd=null;a.divTipoCambio=null;a.txtTipoCambio=null;a.divIdUsd=null;a.txtIdUsd=null;a.divControlsComitente=null;a.txtComitente=null;a.btnBuscarCuentas=null;a.btnBuscarTicker=null;a.lblDescripcionComitente=null;a.selectedAccount=null;a.divAlert=null;a.onSave=null;a.onDestroy=null;a.overlayElement=null;a.especies=[];a.requestUrl="operaciones";$.extend(true,a,b);a.show=function(){var c={};c.panel=Core.Enums.ePanel.BonosFull;var d=new Core.Ajax.ServerRequest({allowCache:true,overlayElement:a.overlayElement,showOverlay:true,requestUrl:"especies",requestType:"GET",requestData:c});d.onSuccess=function(e){var f=new Core.Ajax.ServerRequest({allowCache:true,overlayElement:a.overlayElement,showOverlay:true,requestUrl:"conceptos",requestType:"GET"});f.onSuccess=function(o){a.divManagerOperacion.shieldWindow({title:a.getTitle(),visible:false,height:a.windowHeight,width:a.windowWidth,pinned:false,titleBarButtons:["maximize","close"],position:{left:$(window).width()-a.windowWidth-40,top:$(window).height()-a.windowHeight+$(window).scrollTop()},events:{close:function(s){a.destroy()}}});a.divDateOperacion=a.divManagerOperacion.find(".div-operacion-fecha-operacion");a.txtDateOperacion=a.divManagerOperacion.find(".date-picker-operacion-fecha-operacion");a.divDateLiquidacion=a.divManagerOperacion.find(".div-operacion-fecha-liquidacion");a.txtDateLiquidacion=a.divManagerOperacion.find(".date-picker-operacion-fecha-liquidacion");a.divDateLiquidacionReal=a.divManagerOperacion.find(".div-operacion-fecha-liquidacion-real");a.txtDateLiquidacionReal=a.divManagerOperacion.find(".date-picker-operacion-fecha-liquidacion-real");a.divContraparte=a.divManagerOperacion.find(".div-operacion-contraparte");a.ddlContraparte=a.divManagerOperacion.find(".dropdown-contraparte");a.divVehiculo=a.divManagerOperacion.find(".div-operacion-vehiculo");a.ddlVehiculo=a.divManagerOperacion.find(".dropdown-operacion-vehiculo");a.divComitenteOperatoria=a.divManagerOperacion.find(".div-operacion-comitente-operatoria");a.ddlComitenteOperatoria=a.divManagerOperacion.find(".dropdown-operacion-comitente-operatoria");a.lblOperacionCuenta=a.divManagerOperacion.find(".lbl-operacion-cuenta");a.divTipoOperacion=a.divManagerOperacion.find(".div-operacion-tipo-operacion");a.ddlTipoOperacion=a.divManagerOperacion.find(".dropdown-operacion-tipo-operacion");a.divTicker=a.divManagerOperacion.find(".div-operacion-especie");a.ddlTicker=a.divManagerOperacion.find(".dropdown-operacion-especie");a.btnBuscarTicker=a.divManagerOperacion.find(".button-buscar-especies");a.btnBuscarTicker.hide();if(a.pantallaOrigen==Core.Enums.eManagerOperacionPantallaOrigen.OperacionesParidad||(a.pantallaOrigen==Core.Enums.eManagerOperacionPantallaOrigen.Liquidacion&&a.origen!=Core.Enums.eMesaOperacionOrigen.Transferencia)){a.btnBuscarTicker.show()}a.divConcepto=a.divManagerOperacion.find(".div-operacion-concepto");a.ddlConcepto=a.divManagerOperacion.find(".dropdown-operacion-concepto");a.divCantidad=a.divManagerOperacion.find(".div-operacion-cantidad");a.txtCantidad=a.divManagerOperacion.find(".textbox-operacion-cantidad");a.divSaldosIgnorados=a.divManagerOperacion.find(".div-saldos-ignorados");a.chkSaldosIgnorados=a.divManagerOperacion.find(".checkbox-saldos-ignorados");a.divPrecioReferencia=a.divManagerOperacion.find(".div-operacion-precio-referencia");a.txtPrecioReferencia=a.divManagerOperacion.find(".textbox-operacion-precio-referencia");a.divPrecio=a.divManagerOperacion.find(".div-operacion-precio");a.lblPrecio=a.divManagerOperacion.find(".label-operacion-precio");a.txtPrecio=a.divManagerOperacion.find(".textbox-operacion-precio");a.divPrecio2=a.divManagerOperacion.find(".div-operacion-precio2");a.txtPrecio2=a.divManagerOperacion.find(".textbox-operacion-precio2");a.lblPrecio2=a.divManagerOperacion.find(".label-operacion-precio2");a.divTipoInstrumento=a.divManagerOperacion.find(".div-operacion-instrumento");a.chkInstrumentosBono=a.divManagerOperacion.find(".chk-operacion-instrumento-bono");a.chkInstrumentosAccion=a.divManagerOperacion.find(".chk-operacion-instrumento-accion");a.divMonto=a.divManagerOperacion.find(".div-operacion-monto");a.txtMonto=a.divManagerOperacion.find(".textbox-operacion-monto");a.divMonto2=a.divManagerOperacion.find(".div-operacion-monto2");a.txtMonto2=a.divManagerOperacion.find(".textbox-operacion-monto2");a.lblMonto2=a.divManagerOperacion.find(".label-operacion-monto2");a.divCantidad2=a.divManagerOperacion.find(".div-operacion-cantidad2");a.txtCantidad2=a.divManagerOperacion.find(".textbox-operacion-cantidad2");a.lblCantidad2=a.divManagerOperacion.find(".label-operacion-cantidad2");a.divMoneda=a.divManagerOperacion.find(".div-operacion-moneda");a.ddlMoneda=a.divManagerOperacion.find(".dropdown-operacion-moneda");a.divObservaciones=a.divManagerOperacion.find(".div-operacion-observaciones");a.txtObservaciones=a.divManagerOperacion.find(".textbox-operacion-observaciones");a.divEstado=a.divManagerOperacion.find(".div-operacion-estado");a.ddlEstado=a.divManagerOperacion.find(".dropdown-operacion-estado");a.divNominalesLiquidados=a.divManagerOperacion.find(".div-operacion-nominales-liquidados");a.txtNominalesLiquidados=a.divManagerOperacion.find(".textbox-operacion-nominales-liquidados");a.divMontoPendiente=a.divManagerOperacion.find(".div-operacion-monto-pendiente");a.txtMontoPendiente=a.divManagerOperacion.find(".textbox-operacion-monto-pendiente");a.divMontoLiquidado=a.divManagerOperacion.find(".div-operacion-monto-liquidado");a.txtMontoLiquidado=a.divManagerOperacion.find(".textbox-operacion-monto-liquidado");a.divAlert=a.divManagerOperacion.find(".div-operacion-alert");a.divTipoNegocio=a.divManagerOperacion.find(".div-operacion-tipo-negocio");a.ddlTipoNegocio=a.divManagerOperacion.find(".dropdown-operacion-tipo-negocio");a.divMercado=a.divManagerOperacion.find(".div-operacion-mercado");a.ddlMercado=a.divManagerOperacion.find(".dropdown-operacion-mercado");a.divTipoContraparte=a.divManagerOperacion.find(".div-operacion-tipo-contraparte");a.ddlTipoContraparte=a.divManagerOperacion.find(".dropdown-operacion-tipo-contraparte");a.divUsd=a.divManagerOperacion.find(".div-operacion-usd");a.chkUsd=a.divManagerOperacion.find(".checkbox-operacion-usd");a.divTipoCambio=a.divManagerOperacion.find(".div-operacion-tipo-cambio");a.txtTipoCambio=a.divManagerOperacion.find(".textbox-operacion-tipo-cambio");a.divIdUsd=a.divManagerOperacion.find(".div-operacion-id-usd");a.txtIdUsd=a.divManagerOperacion.find(".textbox-operacion-id-usd");a.divControlsComitente=a.divManagerOperacion.find(".div-controls-comitente");a.txtComitente=a.divManagerOperacion.find(".textbox-comitente");a.btnBuscarCuentas=a.divManagerOperacion.find(".button-buscar-cuentas");a.lblDescripcionComitente=a.divManagerOperacion.find(".lbl-descripcion-comitente");a.divControlsAsesor=a.divManagerOperacion.find(".div-operacion-asesor");a.divControlsAsesor.hide();a.divAlert.slideUp();var n={format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.operacion&&a.operacion.FechaOperacion!=null)?a.operacion.FechaOperacion:new Date(),events:{change:function(s){if(a.origen==Core.Enums.eMesaOperacionOrigen.Ajuste&&a.txtDateOperacion.swidget().value()){a.txtDateLiquidacion.swidget().value(a.txtDateOperacion.swidget().value())}}}};if(!(a.pantallaOrigen==Core.Enums.eManagerOperacionPantallaOrigen.OperacionesParidad&&(a.origen==Core.Enums.eMesaOperacionOrigen.Operacion||a.origen==Core.Enums.eMesaOperacionOrigen.Banco))){n.max=new Date()}a.txtDateOperacion.shieldDatePicker(n);Core.Functions.Validations.toggleValidation(a.txtDateOperacion,false);a.txtDateLiquidacion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.operacion&&a.operacion.FechaLiquidacion!=null)?a.operacion.FechaLiquidacion:new Date()});if(a.operacionPadre!=null||(!a.operacion&&a.pantallaOrigen==Core.Enums.eManagerOperacionPantallaOrigen.OperacionesParidad)){a.getFechaLiquidacionDefault()}Core.Functions.Validations.toggleValidation(a.txtDateLiquidacion,false);var h=new Date();h.setDate(h.getDate()+2);a.txtDateLiquidacionReal.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.operacion&&a.operacion.FechaLiquidacionOpReal!=null)?a.operacion.FechaLiquidacionOpReal:h});Core.Functions.Validations.toggleValidation(a.txtDateLiquidacionReal,false);a.ddlContraparte.shieldComboBox({dataSource:{data:[]},valueTemplate:"{Descripcion}",textTemplate:"{Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"Agente",filter:"contains",value:""},{path:"Sociedad",filter:"contains",value:""}]}},events:{select:function(s){a.setControlsByVehiculoAndEstado();a.setLabels()}}});var k=a.ddlContraparte.swidget().initialOptions;if(a.origen==Core.Enums.eMesaOperacionOrigen.Transferencia){var g=[{value:Core.Enums.eVehiculo.INT,text:"INT"},{value:Core.Enums.eVehiculo.BCI,text:"BCI"},{value:Core.Enums.eVehiculo.BCV,text:"BCV"}];k.valueTemplate="{value}";k.textTemplate="{text}";k.dataSource.data=g}a.ddlContraparte.swidget().refresh(k);if(a.operacion&&a.operacion.idContraparte!=null){a.ddlContraparte.swidget().value(a.operacion.idContraparte)}Core.Functions.Validations.toggleValidation(a.ddlContraparte,false);var i=[];if(a.origen!=Core.Enums.eMesaOperacionOrigen.Ajuste&&a.origen!=Core.Enums.eMesaOperacionOrigen.Transferencia){i.push({value:Core.Enums.eEstadoOperacion.Pendiente,text:"Pendiente"});i.push({value:Core.Enums.eEstadoOperacion.Verificada,text:"Verificada"})}if(a.pantallaOrigen==Core.Enums.eManagerOperacionPantallaOrigen.Liquidacion&&(a.origen==Core.Enums.eMesaOperacionOrigen.Operacion||a.origen==Core.Enums.eMesaOperacionOrigen.Banco)&&a.operacion){i.push({value:Core.Enums.eEstadoOperacion.ParcialmenteLiquidada,text:"Parcialmente Liquidada"})}if(a.operacion!=null||a.origen==Core.Enums.eMesaOperacionOrigen.Transferencia||a.origen==Core.Enums.eMesaOperacionOrigen.Ajuste){i.push({value:Core.Enums.eEstadoOperacion.Liquidada,text:"Liquidada"})}if(a.operacion){i.push({value:Core.Enums.eEstadoOperacion.Cancelada,text:"Cancelada"})}a.ddlEstado.shieldDropDown({dataSource:{data:i},valueTemplate:"{value}",textTemplate:"{text}",value:(a.operacion&&a.operacion.idEstadoOperacion!=null)?a.operacion.idEstadoOperacion.toString():"",events:{select:function(s){a.setControlsByVehiculoAndEstado()}}});Core.Functions.Validations.toggleValidation(a.ddlEstado,false);var r=[];r.push({value:Core.Enums.eVehiculo.INT,text:"INT"});r.push({value:Core.Enums.eVehiculo.BCI,text:"BCI"});if(!(a.origen==Core.Enums.eMesaOperacionOrigen.CompraVentaBono)){r.push({value:Core.Enums.eVehiculo.BCV,text:"BCV"})}if(a.origen!=Core.Enums.eMesaOperacionOrigen.CompraVentaBono&&a.origen!=Core.Enums.eMesaOperacionOrigen.Transferencia){r.push({value:Core.Enums.eVehiculo.UK,text:"UK"})}a.ddlVehiculo.shieldDropDown({dataSource:{data:r},valueTemplate:"{value}",textTemplate:"{text}",value:(a.operacion&&a.operacion.idCuenta!=null)?a.operacion.idCuenta.toString():a.getVehiculoDefault(),events:{select:function(s){a.setControlsByVehiculo();a.setOptionsContraparteTransferencia();a.setControlsByVehiculoAndEstado();a.setLabels()}}});Core.Functions.Validations.toggleValidation(a.ddlVehiculo,false);a.ddlComitenteOperatoria.shieldComboBox({dataSource:{data:[]},valueTemplate:"{CodComitente}",textTemplate:"{NumComitente} - {Descripcion}",value:(a.operacion&&a.operacion.CodComitente!=null)?a.operacion.CodComitente.toString():"",autoComplete:{enabled:true,filter:{or:[{path:"NumComitente",filter:"contains",value:""},{path:"Descripcion",filter:"contains",value:""}]}}});Core.Functions.Validations.toggleValidation(a.ddlComitenteOperatoria,false);var q=[];if(a.origen==Core.Enums.eMesaOperacionOrigen.Operacion||a.origen==Core.Enums.eMesaOperacionOrigen.Banco||a.origen==Core.Enums.eMesaOperacionOrigen.Taco){q.push({value:Core.Enums.eMesaTipoOperacion.Compra,text:"Compra"});q.push({value:Core.Enums.eMesaTipoOperacion.Venta,text:"Venta"})}else{if(a.origen==Core.Enums.eMesaOperacionOrigen.CompraVentaBono){q.push({value:Core.Enums.eMesaTipoOperacion.CompraBono,text:"Compra"});q.push({value:Core.Enums.eMesaTipoOperacion.VentaBono,text:"Venta"})}else{if(a.origen==Core.Enums.eMesaOperacionOrigen.Transferencia){q.push({value:Core.Enums.eMesaTipoOperacion.Transferencia,text:"Transferencia"})}else{q.push({value:Core.Enums.eMesaTipoOperacion.Ajuste,text:"Ajuste"})}}}a.ddlTipoOperacion.shieldDropDown({dataSource:{data:q},valueTemplate:"{value}",textTemplate:"{text}",value:(a.operacion&&a.operacion.idTipoOperacion!=null)?a.operacion.idTipoOperacion.toString():"",events:{select:function(s){a.setLabels();a.setColorsByTipoOperacion()}}});Core.Functions.Validations.toggleValidation(a.ddlTipoOperacion,false);a.ddlTicker.shieldComboBox({dataSource:{data:[]},valueTemplate:"{Ticker}",textTemplate:"{DisplayTicker} | {Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Ticker",filter:"contains",value:""},{path:"Descripcion",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}}});if(a.operacion&&a.operacion.Ticker!=null&&($.grep(e.especies,function(t,s){return t.Ticker==a.operacion.Ticker}).length==0)){e.especies.push({Ticker:a.operacion.Ticker,DisplayTicker:a.operacion.Ticker,Descripcion:"",Cantidad:""})}a.especies=e.especies;Core.Functions.Validations.toggleValidation(a.ddlTicker,false);a.btnBuscarTicker.unbind("click");a.btnBuscarTicker.click(function(){a.divManagerOperacion.swidget().visible(false);new Core.Controls.BuscarEspecie({onSelected:function(s){var t=a.ddlTicker.swidget().initialOptions;t.dataSource.data=[s];t.value=s.Ticker;a.ddlTicker.swidget().refresh(t)},onDestroy:function(){a.divManagerOperacion.swidget().visible(true)}}).show()});a.ddlConcepto.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idConcepto}",textTemplate:"{Concepto}",autoComplete:{enabled:true,filter:{or:[{path:"Concepto",filter:"contains",value:""}]}}});var k=a.ddlConcepto.swidget().initialOptions;k.dataSource.data=o.conceptos;a.ddlConcepto.swidget().refresh(k);if(a.operacion&&a.operacion.idInstrumento!=null){a.ddlConcepto.swidget().value(a.operacion.idInstrumento.toString())}Core.Functions.Validations.toggleValidation(a.ddlConcepto,false);var j=[Core.Enums.Currency.Euros,Core.Enums.Currency.Pesos];if(!(a.origen==Core.Enums.eMesaOperacionOrigen.CompraVentaBono)){j.push(Core.Enums.Currency.Dolares)}j.push(Core.Enums.Currency.DolaresCable);a.ddlMoneda.shieldDropDown({dataSource:{data:j},valueTemplate:"{idMoneda}",textTemplate:"{Descripcion}",value:(a.operacion&&a.operacion.idMoneda!=null)?a.operacion.idMoneda.toString():Core.Enums.Currency.DolaresCable.idMoneda.toString()});Core.Functions.Validations.toggleValidation(a.ddlMoneda,false);a.txtObservaciones.shieldTextBox({value:(a.operacion&&a.operacion.Observaciones!=null)?a.operacion.Observaciones:""});Core.Functions.Validations.toggleValidation(a.txtObservaciones,false);new Core.Controls.DecimalPicker(a.txtPrecio,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:(a.operacion&&a.operacion.Precio!=null)?a.operacion.Precio:"",onKeyUp:function(){a.setMonto()}});Core.Functions.Validations.toggleValidation(a.txtPrecio,false);new Core.Controls.DecimalPicker(a.txtPrecio2,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:"",onKeyUp:function(){a.setMonto()}});Core.Functions.Validations.toggleValidation(a.txtPrecio2,false);new Core.Controls.DecimalPicker(a.txtPrecioReferencia,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:(a.operacion&&a.operacion.Precio!=null)?a.operacion.Precio:"",onKeyUp:function(){a.setPreciosByReferencia()}});new Core.Controls.DecimalPicker(a.txtMonto,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:(a.operacion&&a.operacion.Monto!=null)?a.operacion.Monto:"",onKeyUp:function(){a.setPrecio()}});Core.Functions.Validations.toggleValidation(a.txtMonto,false);new Core.Controls.DecimalPicker(a.txtMonto2,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:"",onKeyUp:function(){a.setPrecio()}});Core.Functions.Validations.toggleValidation(a.txtMonto2,false);new Core.Controls.DecimalPicker(a.txtCantidad,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:(a.operacion&&a.operacion.Cantidad!=null)?a.operacion.Cantidad:"",onKeyUp:function(){a.setMonto()}});Core.Functions.Validations.toggleValidation(a.txtCantidad,false);new Core.Controls.DecimalPicker(a.txtCantidad2,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:(a.operacion&&a.operacion.Cantidad!=null)?a.operacion.Cantidad:"",onKeyUp:function(){a.setMonto()}});Core.Functions.Validations.toggleValidation(a.txtCantidad2,false);a.chkSaldosIgnorados.shieldCheckBox({label:"Impacto Saldos Ignorados",checked:(a.operacion&&a.operacion.ignorarMonto!=null)?(a.operacion.ignorarMonto==1):false});Core.Functions.Validations.toggleValidation(a.chkSaldosIgnorados,false);if(!a.chkInstrumentosAccion.swidget()){a.chkInstrumentosAccion.shieldRadioButton({label:"Acción",events:{click:function(s){a.setMonto()}}})}var l=a.chkInstrumentosAccion.swidget().initialOptions;l.checked=(a.operacion&&a.operacion.TipoInstrumento!=null)?a.operacion.TipoInstrumento==a.eTipoInstrumento.Accion:false;a.chkInstrumentosAccion.swidget().refresh(l);a.chkInstrumentosAccion.swidget().visible(true);if(!a.chkInstrumentosBono.swidget()){a.chkInstrumentosBono.shieldRadioButton({label:"Bono",events:{click:function(s){a.setMonto()}}})}var m=a.chkInstrumentosBono.swidget().initialOptions;m.checked=(a.operacion&&a.operacion.TipoInstrumento!=null)?a.operacion.TipoInstrumento==a.eTipoInstrumento.Bono:true;a.chkInstrumentosBono.swidget().refresh(m);a.chkInstrumentosBono.swidget().visible(true);var p=[{value:a.eTipoNegocio.Instrumentos,text:"Instrumentos"},{value:a.eTipoNegocio.Monedas,text:"Monedas"}];if(a.origen!=Core.Enums.eMesaOperacionOrigen.Taco){p.push({value:a.eTipoNegocio.Concepto,text:"Concepto"})}a.ddlTipoNegocio.shieldDropDown({dataSource:{data:p},valueTemplate:"{value}",textTemplate:"{text}",value:(a.operacion&&a.operacion.idNegocio!=null)?a.operacion.idNegocio.toString():"",events:{select:function(s){a.setControlsByTipoNegocio();if(a.origen==Core.Enums.eMesaOperacionOrigen.Taco){a.loadEspecies()}}}});Core.Functions.Validations.toggleValidation(a.ddlTipoNegocio,false);a.ddlMercado.shieldDropDown({dataSource:{data:[{value:a.eMercado.NA,text:"NA"},{value:a.eMercado.Mae,text:"MAE"},{value:a.eMercado.MervalSenebi,text:"Merval SENEBI"},{value:a.eMercado.MervalPPT,text:"Merval PPT"},{value:a.eMercado.Banco,text:"Banco"},{value:a.eMercado.Byma,text:"BYMA"}]},valueTemplate:"{value}",textTemplate:"{text}",value:(a.operacion&&a.operacion.idMercado!=null)?a.operacion.idMercado.toString():a.getMercadoDefault()});Core.Functions.Validations.toggleValidation(a.ddlMercado,false);new Core.Controls.DecimalPicker(a.txtNominalesLiquidados,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:(a.operacion&&a.operacion.nominalesLiquidados!=null)?a.operacion.nominalesLiquidados:"",onKeyUp:function(){a.setMontosPedienteLiquidado()}});Core.Functions.Validations.toggleValidation(a.txtNominalesLiquidados,false);new Core.Controls.DecimalPicker(a.txtMontoLiquidado,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:""});Core.Functions.Validations.toggleValidation(a.txtMontoLiquidado,false);a.txtMontoLiquidado.attr("disabled","disabled");new Core.Controls.DecimalPicker(a.txtMontoPendiente,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:""});Core.Functions.Validations.toggleValidation(a.txtMontoPendiente,false);a.txtMontoPendiente.attr("disabled","disabled");a.ddlTipoContraparte.shieldDropDown({dataSource:{data:[]},valueTemplate:"{idTipoContraparte}",textTemplate:"{TipoContraparte}",events:{select:function(s){a.setControlsByTipoContraparte()}}});Core.Functions.Validations.toggleValidation(a.ddlTipoContraparte,false);a.chkUsd.shieldCheckBox({label:"USD",checked:(a.operacion&&a.operacion.tipoCambio!=null&&a.operacion.tipoCambio!=""),enabled:(a.operacion==null),events:{click:function(s){a.setTipoCambio()}}});new Core.Controls.DecimalPicker(a.txtTipoCambio,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:(a.operacion&&a.operacion.tipoCambio!=null&&a.operacion.tipoCambio!="")?a.operacion.tipoCambio:""});Core.Functions.Validations.toggleValidation(a.txtTipoCambio,false);if(a.operacion){a.txtTipoCambio.attr("disabled","disabled")}new Core.Controls.DecimalPicker(a.txtIdUsd,{maxDecimalDigitCount:0,showThousandsSeparator:"",defaultValue:""});Core.Functions.Validations.toggleValidation(a.txtIdUsd,false);new Core.Controls.DecimalPicker(a.txtComitente,{maxDecimalDigitCount:0,showThousandsSeparator:"",onKeyUp:function(){a.searchAccount()}});Core.Functions.Validations.toggleValidation(a.txtComitente,false);a.btnBuscarCuentas.unbind("click");a.btnBuscarCuentas.click(function(){a.divManagerOperacion.swidget().visible(false);new Core.Controls.ManagerOperacion.SearchAccount({idVehiculo:a.ddlVehiculo.swidget().value(),onSelected:function(s){a.selectedAccount=s;a.lblDescripcionComitente.html(a.selectedAccount.Descripcion);a.txtComitente.val(a.selectedAccount.NumComitente)},onDestroy:function(){a.divManagerOperacion.swidget().visible(true)}}).show()});a.loadEspecies();a.setControlsByMode();a.setColorsByTipoOperacion();if(a.operacion){if(a.origen!=Core.Enums.eMesaOperacionOrigen.Taco&&a.ddlTipoContraparte.swidget().value()==a.eTipoContraparte.Banco){a.ddlTicker.swidget().value(a.operacion.idInstrumento.toString())}else{if(a.operacion.Ticker!=null){a.ddlTicker.swidget().value(a.operacion.Ticker)}}}a.divManagerOperacion.find(".btn-operacion-confirmar").unbind("click");a.divManagerOperacion.find(".btn-operacion-confirmar").click(function(){Core.Functions.Validations.toggleValidation(a.txtDateOperacion,false);Core.Functions.Validations.toggleValidation(a.txtDateLiquidacion,false);Core.Functions.Validations.toggleValidation(a.txtDateLiquidacionReal,false);Core.Functions.Validations.toggleValidation(a.ddlContraparte,false);Core.Functions.Validations.toggleValidation(a.ddlTicker,false);Core.Functions.Validations.toggleValidation(a.ddlConcepto,false);Core.Functions.Validations.toggleValidation(a.ddlEstado,false);Core.Functions.Validations.toggleValidation(a.chkSaldosIgnorados,false);Core.Functions.Validations.toggleValidation(a.txtCantidad,false);Core.Functions.Validations.toggleValidation(a.txtCantidad2,false);Core.Functions.Validations.toggleValidation(a.txtPrecio,false);Core.Functions.Validations.toggleValidation(a.txtPrecio2,false);Core.Functions.Validations.toggleValidation(a.txtMonto,false);Core.Functions.Validations.toggleValidation(a.txtMonto2,false);Core.Functions.Validations.toggleValidation(a.ddlVehiculo,false);Core.Functions.Validations.toggleValidation(a.ddlComitenteOperatoria,false);Core.Functions.Validations.toggleValidation(a.ddlTipoNegocio,false);Core.Functions.Validations.toggleValidation(a.ddlMercado,false);Core.Functions.Validations.toggleValidation(a.ddlMercado,false);Core.Functions.Validations.toggleValidation(a.ddlTipoOperacion,false);Core.Functions.Validations.toggleValidation(a.ddlMoneda,false);Core.Functions.Validations.toggleValidation(a.txtNominalesLiquidados,false);Core.Functions.Validations.toggleValidation(a.txtComitente,false);Core.Functions.Validations.toggleValidation(a.txtTipoCambio,false);Core.Functions.Validations.toggleValidation(a.txtIdUsd,false);a.divAlert.slideUp();var s=a.getRequestData();if(s==null){return}var t=new Core.Ajax.ServerRequest({overlayElement:a.divManagerOperacion.find(".btn-operacion-confirmar"),showOverlay:true,requestUrl:a.requestUrl,requestType:(a.operacion!=null&&a.operacion.idOperacion!=null)?"PUT":"POST",requestData:s});t.onSuccess=function(u){a.destroy();if(a.onSave){a.onSave()}};t.onError=function(v){var u=(v.responseJSON&&v.responseJSON.Descripcion)?v.responseJSON.Descripcion:"Algunos componentes de la página no se cargaron correctamente. Por favor intente mas tarde...";a.divAlert.text(u);a.divAlert.slideDown()};t.request()});if(a.operacion){a.setMonto()}a.divManagerOperacion.swidget().visible(true);a.txtDateOperacion.swidget().focus()};f.request()};d.request()};a.searchAccount=function(){Core.Functions.Validations.toggleValidation(a.txtComitente,false);if(a.txtComitente.val()&&a.ddlVehiculo.swidget().selectedItem()){var c=new Core.Ajax.ServerRequest({showOverlay:false,secureRequest:true,requestUrl:"comitentes/numdescripcion/"+a.ddlVehiculo.swidget().value()+"/"+a.txtComitente.val(),requestType:"GET"});c.onSuccess=function(d){if(d.cuentas.length==1){a.selectedAccount=d.cuentas[0];a.lblDescripcionComitente.html(a.selectedAccount.Descripcion)}else{a.selectedAccount=null;a.lblDescripcionComitente.html("Comitente no encontrado")}};c.request()}else{a.selectedAccount=null;a.lblDescripcionComitente.html("Comitente no encontrado")}};a.setControlsByVehiculo=function(c){if(a.divTipoContraparte.is(":visible")||c){var d=new Core.Ajax.ServerRequest({showOverlay:false,secureRequest:true,requestUrl:"tiposcontrapartes/"+a.ddlVehiculo.swidget().value(),requestType:"GET"});d.onSuccess=function(f){var e=a.ddlTipoContraparte.swidget().initialOptions;if(a.origen==Core.Enums.eMesaOperacionOrigen.Taco){f.tiposcontrapartes=$.grep(f.tiposcontrapartes,function(h,g){return h.idTipoContraparte!=a.eTipoContraparte.Banco})}e.dataSource.data=f.tiposcontrapartes;if(c){e.value=(a.operacion&&a.operacion.idTipoContraparte!=null)?a.operacion.idTipoContraparte.toString():""}a.ddlTipoContraparte.swidget().refresh(e);a.setControlsByTipoContraparte(c)};d.request()}};a.setControlsByTipoContraparte=function(c){a.divTipoInstrumento.show();var d=[Core.Enums.Currency.Euros,Core.Enums.Currency.Pesos];if(!(a.origen==Core.Enums.eMesaOperacionOrigen.CompraVentaBono)){d.push(Core.Enums.Currency.Dolares)}d.push(Core.Enums.Currency.DolaresCable);if(a.ddlTipoContraparte.swidget().value()==a.eTipoContraparte.Comitente){a.divControlsComitente.show();a.divContraparte.hide();a.txtComitente.val((c&&a.operacion&&a.operacion.Contraparte)?a.operacion.Contraparte:"");a.searchAccount()}else{var f;var i;var h;if(a.ddlTipoContraparte.swidget().value()==a.eTipoContraparte.Agente){f="agentes/"+a.ddlVehiculo.swidget().value();i="{idAgente}";h="{Agente}"}else{if(a.ddlTipoContraparte.swidget().value()==a.eTipoContraparte.Banco){f="bancos";i="{idBanco}";h="{Descripcion}";d=[Core.Enums.Currency.Pesos];a.chkInstrumentosAccion.swidget().checked(true);a.divTipoInstrumento.hide()}else{if(a.ddlTipoContraparte.swidget().value()==a.eTipoContraparte.Balanz){f="sociedades";i="{idSociedad}";h="{Sociedad}"}}}var e=a.ddlMoneda.swidget().initialOptions;e.dataSource.data=d;a.ddlMoneda.swidget().refresh(e);var g=new Core.Ajax.ServerRequest({allowCache:true,showOverlay:true,secureRequest:true,requestUrl:f,requestType:"GET"});g.onSuccess=function(m){var j=[];if(m.agentes){j=m.agentes}else{if(m.bancos){j=m.bancos}else{if(m.sociedades){j=m.sociedades}}}if(a.ddlTipoContraparte.swidget().value()==a.eTipoContraparte.Balanz){j=$.grep(j,function(p,o){return p.idSociedad!=a.ddlVehiculo.swidget().value()})}var l=a.ddlContraparte.swidget().initialOptions;l.valueTemplate=i;l.textTemplate=h;if(c&&a.operacion){if(a.operacion.idContraparte){l.value=a.operacion.idContraparte.toString()}else{if(a.operacion.Contraparte){var k={};k[h.replaceAll("{","").replaceAll("}","")]=a.operacion.Contraparte;k[i.replaceAll("{","").replaceAll("}","")]=0;j.unshift(k);l.value="0"}}}l.dataSource.data=j;a.ddlContraparte.swidget().refresh(l);a.divControlsComitente.hide();a.divContraparte.show();a.txtComitente.val("");a.searchAccount();if(a.origen!=Core.Enums.eMesaOperacionOrigen.Taco&&a.ddlTipoContraparte.swidget().value()==a.eTipoContraparte.Banco){var n=new Core.Ajax.ServerRequest({allowCache:true,showOverlay:true,secureRequest:true,requestUrl:"especiesmonedas/1",requestType:"GET"});n.onSuccess=function(p){var o=a.ddlTicker.swidget().initialOptions;o.dataSource.data=p.especies;o.valueTemplate="{idInstrumento}";o.textTemplate="{Ticker}";a.ddlTicker.swidget().refresh(o);a.setMonto()};n.request()}else{a.loadEspecies()}};g.request()}};a.loadEspecies=function(){var c=a.ddlTicker.swidget().initialOptions;if(a.origen==Core.Enums.eMesaOperacionOrigen.Taco&&a.ddlTipoNegocio.swidget().selectedItem().value==a.eTipoNegocio.Monedas){c.dataSource.data=[Core.Enums.Currency.Euros,Core.Enums.Currency.Pesos,Core.Enums.Currency.Dolares,Core.Enums.Currency.DolaresCable];c.valueTemplate="{idMoneda}";c.textTemplate="{Descripcion}"}else{c.dataSource.data=a.especies;c.valueTemplate="{Ticker}";c.textTemplate="{DisplayTicker} | {Descripcion}"}a.ddlTicker.swidget().refresh(c);a.setMonto()};a.destroy=function(){a.txtDateOperacion.swidget().destroy();a.txtDateLiquidacion.swidget().destroy();a.txtDateLiquidacionReal.swidget().destroy();a.ddlContraparte.swidget().destroy();a.ddlTicker.swidget().destroy();a.ddlConcepto.swidget().destroy();a.ddlEstado.swidget().destroy();a.txtObservaciones.swidget().destroy();a.ddlMoneda.swidget().destroy();a.ddlTipoNegocio.swidget().destroy();a.ddlMercado.swidget().destroy();a.ddlTipoContraparte.swidget().destroy();a.ddlVehiculo.swidget().destroy();a.ddlTipoOperacion.swidget().destroy();a.chkSaldosIgnorados.swidget().destroy();a.chkUsd.swidget().destroy();a.divManagerOperacion.swidget().destroy();Core.Objects.Context.Dialogs.remove(this);if(a.onDestroy!=null){a.onDestroy()}};a.getFechaByEstado=function(c,d){if(a.ddlEstado.swidget().selectedItem()){if(a.ddlEstado.swidget().selectedItem().value==Core.Enums.eEstadoOperacion.Cancelada){return Core.Functions.Date.getDateAsString(c.swidget().value())}else{return Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(c,d))}}else{d.value=false;return""}};a.getInputByEstado=function(c,d){if(a.ddlEstado.swidget().selectedItem()){if(a.ddlEstado.swidget().selectedItem().value==Core.Enums.eEstadoOperacion.Cancelada){return Core.Functions.Decimal.parseFloat(c.val())}else{return Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(c,d))}}else{d.value=false;return""}};a.getDropdownByEstado=function(c,d){if(a.ddlEstado.swidget().selectedItem()){if(a.ddlEstado.swidget().selectedItem().value==Core.Enums.eEstadoOperacion.Cancelada){return c.swidget().value()}else{return Core.Functions.Validations.getValidatedSwidgetValue(c,d)}}else{d.value=false;return""}};a.getContraparteTransferencia=function(c){if(a.ddlContraparte.swidget().selectedItem()){return a.ddlContraparte.swidget().selectedItem().text}else{c.value=false;return""}};a.getRequestData=function(){var d={value:true};var c={data:{FechaConcertacion:a.getFechaByEstado(a.txtDateOperacion,d),FechaLiquidacion:a.getFechaByEstado(a.txtDateLiquidacion,d),idCuenta:Core.Functions.Validations.getValidatedDropDownValue(a.ddlVehiculo,d),idTipoOperacion:Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,d),idEstadoOperacion:Core.Functions.Validations.getValidatedDropDownValue(a.ddlEstado,d),Observaciones:a.txtObservaciones.swidget().value(),Cantidad:a.getInputByEstado(a.txtCantidad,d),idOrigenOperacion:a.origen}};if(a.operacion&&a.operacion.idOperacion!=null){c.data.id=a.operacion.idOperacion}if(a.origen!=Core.Enums.eMesaOperacionOrigen.Transferencia){c.data.idNegocio=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoNegocio,d)}if(a.origen==Core.Enums.eMesaOperacionOrigen.Operacion||a.origen==Core.Enums.eMesaOperacionOrigen.Banco){c.data.ignorarMonto=(a.chkSaldosIgnorados.swidget().checked())?1:0;c.data.Precio1=a.getInputByEstado(a.txtPrecio,d);c.data.idMoneda=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMoneda,d);c.data.idTipoContraparte=a.getDropdownByEstado(a.ddlTipoContraparte,d);if(c.data.idTipoContraparte!=a.eTipoContraparte.Comitente){if(!a.ddlContraparte.swidget().text()||(c.data.idTipoContraparte==a.eTipoContraparte.Balanz&&!a.ddlContraparte.swidget().selectedItem())){d.value=false;Core.Functions.Validations.toggleValidation(a.ddlContraparte,true)}if(a.ddlContraparte.swidget().selectedItem()&&a.ddlContraparte.swidget().value()!=0){c.data.idContraparte=a.getDropdownByEstado(a.ddlContraparte,d)}c.data.Contraparte=a.ddlContraparte.swidget().text()}else{if(!a.selectedAccount){d.value=false;Core.Functions.Validations.toggleValidation(a.txtComitente,true)}else{c.data.idContraparte=a.selectedAccount.CodComitente;c.data.Contraparte=a.selectedAccount.NumComitente}}c.data.TipoInstrumento=a.getSelectedInstrumento(d);if(c.data.idTipoContraparte==a.eTipoContraparte.Banco){c.data.idNegocio=0;c.data.TipoInstrumento=a.eTipoInstrumento.Accion;c.data.idInstrumento=a.getDropdownByEstado(a.ddlTicker,d);c.data.Ticker=(a.ddlTicker.swidget().selectedItem())?a.ddlTicker.swidget().text():"";c.data.idOrigenOperacion=Core.Enums.eMesaOperacionOrigen.Banco}else{c.data.Ticker=a.getDropdownByEstado(a.ddlTicker,d)}}if(a.origen==Core.Enums.eMesaOperacionOrigen.Ajuste){if(a.ddlTipoNegocio.swidget().selectedItem().value==a.eTipoNegocio.Monedas){c.data.idMoneda=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMoneda,d)}else{if(a.ddlTipoNegocio.swidget().selectedItem().value==a.eTipoNegocio.Instrumentos){c.data.Ticker=Core.Functions.Validations.getValidatedSwidgetValue(a.ddlTicker,d);c.data.TipoInstrumento=a.getSelectedInstrumento(d)}else{if(a.ddlTipoNegocio.swidget().selectedItem().value==a.eTipoNegocio.Concepto){c.data.idMoneda=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMoneda,d);if(a.ddlConcepto.swidget().selectedItem()){c.data.Ticker=a.ddlConcepto.swidget().selectedItem().Concepto;c.data.idInstrumento=a.ddlConcepto.swidget().selectedItem().idConcepto}else{d.value=false;Core.Functions.Validations.toggleValidation(a.ddlConcepto,true)}}}}}if(a.origen==Core.Enums.eMesaOperacionOrigen.CompraVentaBono){c.data.Precio1=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecio,d));c.data.idMoneda=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMoneda,d);c.data.TipoInstrumento=a.getSelectedInstrumento(d);c.data.Ticker=Core.Functions.Validations.getValidatedSwidgetValue(a.ddlTicker,d);if(a.ddlVehiculo.swidget().selectedItem().value==Core.Enums.eVehiculo.INT){c.data.Precio2=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtPrecio2,d))}if(a.ddlVehiculo.swidget().selectedItem().value==Core.Enums.eVehiculo.INT){c.data.Cantidad2=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtCantidad2,d))}}if(a.origen==Core.Enums.eMesaOperacionOrigen.Transferencia){c.data.Contraparte=a.getContraparteTransferencia(d);c.data.idContraparte=Core.Functions.Validations.getValidatedDropDownValue(a.ddlContraparte,d);c.data.idTipoContraparte=a.eTipoContraparte.Balanz;c.data.idMoneda=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMoneda,d);if((a.ddlContraparte.swidget().selectedItem().value==Core.Enums.eVehiculo.INT&&a.ddlVehiculo.swidget().selectedItem().value==Core.Enums.eVehiculo.BCV)||(a.ddlContraparte.swidget().selectedItem().value==Core.Enums.eVehiculo.BCV&&a.ddlVehiculo.swidget().selectedItem().value==Core.Enums.eVehiculo.INT)){c.data.Cantidad2=a.getInputByEstado(a.txtCantidad2,d)}}if((a.pantallaOrigen==Core.Enums.eManagerOperacionPantallaOrigen.OperacionesParidad)&&(a.origen==Core.Enums.eMesaOperacionOrigen.Operacion||a.origen==Core.Enums.eMesaOperacionOrigen.Banco)&&(a.chkUsd.swidget().checked())){c.data.tipoCambioOpCruzada=Core.Functions.Decimal.parseFloat(Core.Functions.Validations.getValidatedNumericInputValue(a.txtTipoCambio,d))}if(a.ddlEstado.swidget().selectedItem().value==Core.Enums.eEstadoOperacion.ParcialmenteLiquidada){c.data.nominalesLiquidados=a.getInputByEstado(a.txtNominalesLiquidados,d)}if(a.origen==Core.Enums.eMesaOperacionOrigen.Taco){if(a.ddlTipoNegocio.swidget().selectedItem().value==a.eTipoNegocio.Instrumentos){c.data.TipoInstrumento=a.getSelectedInstrumento(d);c.data.idInstrumento=(a.ddlTicker.swidget().selectedItem())?a.ddlTicker.swidget().selectedItem().idInstrumento:"";c.data.Ticker=a.getDropdownByEstado(a.ddlTicker,d)}else{c.data.idInstrumento=a.getDropdownByEstado(a.ddlTicker,d);c.data.Ticker=(a.ddlTicker.swidget().selectedItem())?a.ddlTicker.swidget().text():""}c.data.FechaLiquidacionOpReal=a.getFechaByEstado(a.txtDateLiquidacionReal,d);c.data.nominalesLiquidados=a.getInputByEstado(a.txtCantidad,d);c.data.esTaco=1;c.data.Precio1=a.getInputByEstado(a.txtPrecio,d);c.data.idMoneda=Core.Functions.Validations.getValidatedDropDownValue(a.ddlMoneda,d);c.data.idTipoContraparte=a.getDropdownByEstado(a.ddlTipoContraparte,d);if(c.data.idTipoContraparte!=a.eTipoContraparte.Comitente){if(!a.ddlContraparte.swidget().text()||(c.data.idTipoContraparte==a.eTipoContraparte.Balanz&&!a.ddlContraparte.swidget().selectedItem())){d.value=false;Core.Functions.Validations.toggleValidation(a.ddlContraparte,true)}if(a.ddlContraparte.swidget().selectedItem()&&a.ddlContraparte.swidget().value()!=0){c.data.idContraparte=a.getDropdownByEstado(a.ddlContraparte,d)}c.data.Contraparte=a.ddlContraparte.swidget().text()}else{if(!a.selectedAccount){d.value=false;Core.Functions.Validations.toggleValidation(a.txtComitente,true)}else{c.data.idContraparte=a.selectedAccount.CodComitente;c.data.Contraparte=a.selectedAccount.NumComitente}}c.data.idMercado=a.getDropdownByEstado(a.ddlMercado,d)}if(a.divComitenteOperatoria.is(":visible")&&a.ddlComitenteOperatoria.swidget().selectedItem()){c.data.CodComitente=a.ddlComitenteOperatoria.swidget().selectedItem().CodComitente}if(a.operacionPadre){c.data.idOperacionPadre=a.operacionPadre.idOperacion}if(a.idPuntaDetalle||(a.operacion&&a.operacion.idPuntaDetalle)){c.data.idPuntaDetalle=(a.operacion)?a.operacion.idPuntaDetalle:a.idPuntaDetalle}if(d.value){if(c.data.nominalesLiquidados&&(c.data.nominalesLiquidados>c.data.Cantidad||c.data.nominalesLiquidados<0)){d.value=false;a.divAlert.text("Los nominales liquidados deben ser positivos y menores o iguales que la cantidad.");a.divAlert.slideDown();Core.Functions.Validations.toggleValidation(a.txtNominalesLiquidados,true)}if(a.origen==Core.Enums.eMesaOperacionOrigen.Transferencia&&c.data.Cantidad<0){d.value=false;a.divAlert.text("La cantidad deber ser mayor que 0.");a.divAlert.slideDown();Core.Functions.Validations.toggleValidation(a.txtCantidad,true)}}if(d.value){return c}else{return null}};a.setColorsByTipoOperacion=function(){a.txtCantidad.css("background-color","");a.txtCantidad2.css("background-color","");a.txtMonto.css("background-color","");a.txtMonto2.css("background-color","");if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eMesaTipoOperacion.CompraBono||a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eMesaTipoOperacion.Compra){a.txtCantidad.css("background-color","rgba(204, 255, 204, 0.9)");a.txtCantidad2.css("background-color","rgba(204, 255, 204, 0.9)");a.txtMonto.css("background-color","rgba(255, 204, 204,0.9)");a.txtMonto2.css("background-color","rgba(255, 204, 204,0.9)")}else{if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eMesaTipoOperacion.VentaBono||a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eMesaTipoOperacion.Venta){a.txtMonto.css("background-color","rgba(204, 255, 204, 0.9)");a.txtMonto2.css("background-color","rgba(204, 255, 204, 0.9)");a.txtCantidad.css("background-color","rgba(255, 204, 204,0.9)");a.txtCantidad2.css("background-color","rgba(255, 204, 204,0.9)")}}};a.getSelectedInstrumento=function(c){if(a.chkInstrumentosAccion.swidget().checked()){return a.eTipoInstrumento.Accion}else{if(a.chkInstrumentosBono.swidget().checked()){return a.eTipoInstrumento.Bono}else{c.value=false;a.divAlert.text("Debe seleccionar un tipo de instrumento.");a.divAlert.slideDown()}}};a.setMonto=function(){if(a.origen!=Core.Enums.eMesaOperacionOrigen.Transferencia){var c="";var d="";if(a.chkInstrumentosAccion.swidget().checked()){if(a.txtCantidad.val()&&a.txtPrecio.val()){c=(Core.Functions.Decimal.parseFloat(a.txtCantidad.val())*Core.Functions.Decimal.parseFloat(a.txtPrecio.val()))}if(a.txtCantidad2.val()&&a.txtPrecio2.val()){d=(Core.Functions.Decimal.parseFloat(a.txtCantidad2.val())*Core.Functions.Decimal.parseFloat(a.txtPrecio2.val()))}}if(a.chkInstrumentosBono.swidget().checked()){if(a.txtCantidad.val()&&a.txtPrecio.val()){c=(Core.Functions.Decimal.parseFloat(a.txtCantidad.val())*Core.Functions.Decimal.parseFloat(a.txtPrecio.val()))/100}if(a.txtCantidad2.val()&&a.txtPrecio2.val()){d=(Core.Functions.Decimal.parseFloat(a.txtCantidad2.val())*Core.Functions.Decimal.parseFloat(a.txtPrecio2.val()))/100}}a.txtMonto.val(c);a.txtMonto.blur();a.txtMonto2.val(d);a.txtMonto2.blur()}a.setMontosPedienteLiquidado()};a.setPrecio=function(){if(a.origen!=Core.Enums.eMesaOperacionOrigen.Transferencia){var c=a.txtPrecio.val();var d=a.txtPrecio2.val();if(a.chkInstrumentosAccion.swidget().checked()){if(a.txtCantidad.val()&&a.txtMonto.val()){c=(Core.Functions.Decimal.parseFloat(a.txtMonto.val())/Core.Functions.Decimal.parseFloat(a.txtCantidad.val()))}if(a.txtCantidad2.val()&&a.txtMonto2.val()){d=(Core.Functions.Decimal.parseFloat(a.txtMonto2.val())/Core.Functions.Decimal.parseFloat(a.txtCantidad2.val()))}}if(a.chkInstrumentosBono.swidget().checked()){if(a.txtCantidad.val()&&a.txtMonto.val()){c=(Core.Functions.Decimal.parseFloat(a.txtMonto.val())*100/Core.Functions.Decimal.parseFloat(a.txtCantidad.val()))}if(a.txtCantidad2.val()&&a.txtMonto2.val()){d=(Core.Functions.Decimal.parseFloat(a.txtMonto2.val())*100/Core.Functions.Decimal.parseFloat(a.txtCantidad2.val()))}}a.txtPrecio.val(c);a.txtPrecio.blur();a.txtPrecio2.val(d);a.txtPrecio2.blur()}a.setMontosPedienteLiquidado()};a.setMontosPedienteLiquidado=function(){if(a.ddlEstado.swidget().selectedItem()&&a.ddlEstado.swidget().selectedItem().value==Core.Enums.eEstadoOperacion.ParcialmenteLiquidada){var d="";var c="";if(a.txtNominalesLiquidados.val()&&a.txtCantidad.val()){a.divAlert.slideUp();Core.Functions.Validations.toggleValidation(a.txtNominalesLiquidados,false);if(Core.Functions.Decimal.parseFloat(a.txtNominalesLiquidados.val())>Core.Functions.Decimal.parseFloat(a.txtCantidad.val())){a.divAlert.text("Los nominales liquidados no pueden ser mayores que la cantidad.");a.divAlert.slideDown();Core.Functions.Validations.toggleValidation(a.txtNominalesLiquidados,true)}else{if(a.txtPrecio.val()){c=(Core.Functions.Decimal.parseFloat(a.txtNominalesLiquidados.val())*Core.Functions.Decimal.parseFloat(a.txtPrecio.val()));if(a.chkInstrumentosBono.swidget().checked()){c=c/100}if(a.txtMonto.val()){d=(Core.Functions.Decimal.parseFloat(a.txtMonto.val())-c)}}}}a.txtMontoPendiente.val(d);a.txtMontoPendiente.blur();a.txtMontoLiquidado.val(c);a.txtMontoLiquidado.blur()}};a.setControlsByTipoNegocio=function(){if(a.origen!=Core.Enums.eMesaOperacionOrigen.Taco){a.divTicker.hide();a.divTipoInstrumento.hide();a.divMoneda.hide();a.divConcepto.hide();if(a.ddlTipoNegocio.swidget().selectedItem().value==a.eTipoNegocio.Monedas){a.divMoneda.show()}if(a.ddlTipoNegocio.swidget().selectedItem().value==a.eTipoNegocio.Instrumentos){a.divTicker.show();a.divTipoInstrumento.show()}if(a.ddlTipoNegocio.swidget().selectedItem().value==a.eTipoNegocio.Concepto){a.divMoneda.show();a.divConcepto.show()}}else{a.divTipoInstrumento.hide();if(a.ddlTipoNegocio.swidget().selectedItem().value==a.eTipoNegocio.Instrumentos){a.divTipoInstrumento.show()}a.chkInstrumentosAccion.swidget().checked(true);a.setMonto()}};a.setControlsByVehiculoAndEstado=function(){a.divMonto2.hide();a.divPrecio2.hide();a.divCantidad2.hide();a.divPrecioReferencia.hide();a.divComitenteOperatoria.hide();if(a.origen==Core.Enums.eMesaOperacionOrigen.CompraVentaBono){a.divPrecioReferencia.show();a.setPreciosByReferencia();if(a.ddlVehiculo.swidget().selectedItem().value==Core.Enums.eVehiculo.INT){a.divMonto2.show();a.divPrecio2.show();a.divCantidad2.show()}}if(a.origen==Core.Enums.eMesaOperacionOrigen.Transferencia){if((a.ddlContraparte.swidget().selectedItem().value==Core.Enums.eVehiculo.INT&&a.ddlVehiculo.swidget().selectedItem().value==Core.Enums.eVehiculo.BCV)||(a.ddlContraparte.swidget().selectedItem().value==Core.Enums.eVehiculo.BCV&&a.ddlVehiculo.swidget().selectedItem().value==Core.Enums.eVehiculo.INT)){a.divCantidad2.show()}}a.divMercado.hide();a.divNominalesLiquidados.hide();a.divMontoLiquidado.hide();a.divMontoPendiente.hide();if(a.ddlEstado.swidget().selectedItem().value==Core.Enums.eEstadoOperacion.ParcialmenteLiquidada){a.divNominalesLiquidados.show();a.divMontoLiquidado.show();a.divMontoPendiente.show()}a.setMonto();if(a.origen==Core.Enums.eMesaOperacionOrigen.Operacion&&(a.pantallaOrigen==Core.Enums.eManagerOperacionPantallaOrigen.OperacionesParidad||a.pantallaOrigen==Core.Enums.eManagerOperacionPantallaOrigen.Liquidacion)&&a.ddlVehiculo.swidget().selectedItem().value==Core.Enums.eVehiculo.BCV){var c=new Core.Ajax.ServerRequest({overlayElement:a.divManagerOperacion,allowCache:true,requestUrl:"comitentesoperatoria",requestType:"GET"});c.onSuccess=function(d){var e=a.ddlComitenteOperatoria.swidget().initialOptions;e.dataSource.data=d.comitentes;e.value=(a.ddlComitenteOperatoria.swidget().value()?a.ddlComitenteOperatoria.swidget().value():e.value);a.ddlComitenteOperatoria.swidget().refresh(e);a.divComitenteOperatoria.show()};c.request()}};a.setControlsByMode=function(){a.divDateOperacion.hide();a.divDateLiquidacion.hide();a.divDateLiquidacionReal.hide();a.divContraparte.hide();a.divMonto.hide();a.divMonto2.hide();a.divCantidad2.hide();a.divVehiculo.hide();a.divComitenteOperatoria.hide();a.divTipoOperacion.hide();a.divTicker.hide();a.divConcepto.hide();a.divCantidad.hide();a.divSaldosIgnorados.hide();a.divPrecio.hide();a.divPrecio2.hide();a.divTipoInstrumento.hide();a.divMoneda.hide();a.divObservaciones.hide();a.divTipoNegocio.hide();a.divMercado.hide();a.divEstado.hide();a.divNominalesLiquidados.hide();a.divMontoLiquidado.hide();a.divMontoPendiente.hide();a.divPrecioReferencia.hide();a.divTipoContraparte.hide();a.divControlsComitente.hide();a.divIdUsd.hide();a.divTipoCambio.hide();a.divUsd.hide();if(a.origen==Core.Enums.eMesaOperacionOrigen.Operacion||a.origen==Core.Enums.eMesaOperacionOrigen.Banco){a.divMoneda.addClass("col-lg-6");a.divMoneda.addClass("col-md-6");a.divMoneda.removeClass("col-lg-12");a.divMoneda.removeClass("col-md-12");a.divDateOperacion.show();a.divDateLiquidacion.show();a.divTipoContraparte.show();a.divMonto.show();a.divVehiculo.show();a.divTipoOperacion.show();a.divTicker.show();a.divCantidad.show();a.divPrecio.show();a.divTipoInstrumento.show();a.divMoneda.show();a.divObservaciones.show();if(a.pantallaOrigen!=Core.Enums.eManagerOperacionPantallaOrigen.OperacionesParidad&&a.pantallaOrigen!=Core.Enums.eManagerOperacionPantallaOrigen.OperacionesUSD){a.divEstado.show()}if(a.pantallaOrigen==Core.Enums.eManagerOperacionPantallaOrigen.OperacionesParidad){a.divUsd.show();a.setTipoCambio()}a.setControlsByVehiculoAndEstado();a.setControlsByVehiculo(true)}else{if(a.origen==Core.Enums.eMesaOperacionOrigen.Ajuste){a.divMoneda.addClass("col-lg-12");a.divMoneda.addClass("col-md-12");a.divMoneda.removeClass("col-lg-6");a.divMoneda.removeClass("col-md-6");a.divDateLiquidacion.show();a.divDateOperacion.show();a.divVehiculo.show();a.divCantidad.show();a.divTipoNegocio.show();a.divEstado.show();a.divObservaciones.show();a.setControlsByTipoNegocio()}else{if(a.origen==Core.Enums.eMesaOperacionOrigen.CompraVentaBono){a.divMoneda.addClass("col-lg-6");a.divMoneda.addClass("col-md-6");a.divMoneda.removeClass("col-lg-12");a.divMoneda.removeClass("col-md-12");a.divDateOperacion.show();a.divDateLiquidacion.show();a.divMonto.show();a.divVehiculo.show();a.divTipoOperacion.show();a.divTicker.show();a.divCantidad.show();a.divPrecio.show();a.divTipoInstrumento.show();a.divMoneda.show();a.divObservaciones.show();a.divEstado.show();a.setControlsByVehiculoAndEstado()}else{if(a.origen==Core.Enums.eMesaOperacionOrigen.Taco){a.divDateOperacion.show();a.divDateLiquidacion.show();a.divDateLiquidacionReal.show();a.divTipoContraparte.show();a.divContraparte.show();a.divVehiculo.show();a.divTipoOperacion.show();a.divTipoNegocio.show();a.divMoneda.show();a.divTicker.show();a.divCantidad.show();a.divTipoInstrumento.show();a.divPrecio.show();a.divMonto.show();a.divObservaciones.show();a.setControlsByVehiculo(true)}else{a.divMoneda.addClass("col-lg-6");a.divMoneda.addClass("col-md-6");a.divMoneda.removeClass("col-lg-12");a.divMoneda.removeClass("col-md-12");a.divCantidad2.addClass("col-lg-6");a.divCantidad2.addClass("col-md-6");a.divCantidad2.removeClass("col-lg-12");a.divCantidad2.removeClass("col-md-12");a.divDateOperacion.show();a.divDateLiquidacion.show();a.divVehiculo.show();a.divContraparte.show();a.divMoneda.show();a.divCantidad.show();a.divEstado.show();a.divObservaciones.show();a.setOptionsContraparteTransferencia();a.setControlsByVehiculoAndEstado()}}}}};a.setPreciosByReferencia=function(){var c=new Core.Ajax.ServerRequest({allowCache:true,requestUrl:"subidasbajadas/default",requestType:"GET"});c.onSuccess=function(f){var d=a.txtPrecio.val();var e=a.txtPrecio2.val();if(a.txtPrecioReferencia.val()){if(a.ddlVehiculo.swidget().selectedItem().value==Core.Enums.eVehiculo.INT){if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eMesaTipoOperacion.CompraBono){d=(Core.Functions.Decimal.parseFloat(a.txtPrecioReferencia.val())+(Core.Functions.Decimal.parseFloat(a.txtPrecioReferencia.val())*f.parametros[0].pCompraPrecio/100)).toFixed(4);e=(Core.Functions.Decimal.parseFloat(a.txtPrecioReferencia.val())+(Core.Functions.Decimal.parseFloat(a.txtPrecioReferencia.val())*f.parametros[0].pCompraPrecio2/100)).toFixed(4);a.lblPrecio.text("Precio ("+f.parametros[0].pCompraPrecio+"%)");a.lblPrecio2.text("Precio BCI ("+f.parametros[0].pCompraPrecio2+"%)")}if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eMesaTipoOperacion.VentaBono){a.lblPrecio.text("Precio ("+f.parametros[0].pVentaPrecio+"%)");a.lblPrecio2.text("Precio INT ("+f.parametros[0].pVentaPrecio2+"%)");d=(Core.Functions.Decimal.parseFloat(a.txtPrecioReferencia.val())-(Core.Functions.Decimal.parseFloat(a.txtPrecioReferencia.val())*f.parametros[0].pVentaPrecio/100)).toFixed(4);e=(Core.Functions.Decimal.parseFloat(a.txtPrecioReferencia.val())-(Core.Functions.Decimal.parseFloat(a.txtPrecioReferencia.val())*f.parametros[0].pVentaPrecio2/100)).toFixed(4)}}else{if(a.ddlVehiculo.swidget().selectedItem().value==Core.Enums.eVehiculo.BCI){if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eMesaTipoOperacion.CompraBono){d=(Core.Functions.Decimal.parseFloat(a.txtPrecioReferencia.val())+(Core.Functions.Decimal.parseFloat(a.txtPrecioReferencia.val())*f.parametros[0].pCompraPrecioSimple/100)).toFixed(4);a.lblPrecio.text("Precio ("+f.parametros[0].pCompraPrecioSimple+"%)")}if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eMesaTipoOperacion.VentaBono){a.lblPrecio.text("Precio ("+f.parametros[0].pVentaPrecioSimple+"%)");d=(Core.Functions.Decimal.parseFloat(a.txtPrecioReferencia.val())-(Core.Functions.Decimal.parseFloat(a.txtPrecioReferencia.val())*f.parametros[0].pVentaPrecioSimple/100)).toFixed(4)}}}}a.txtPrecio.val(d);a.txtPrecio.blur();a.txtPrecio2.val(e);a.txtPrecio2.blur();a.setMonto()};c.request()};a.setLabels=function(){a.lblPrecio.text("Precio");a.lblMonto2.text("Monto 2");a.lblPrecio2.text("Precio 2");a.lblCantidad2.text("Cantidad 2");if(a.ddlVehiculo.swidget().selectedItem().value==Core.Enums.eVehiculo.BCI){a.setPreciosByReferencia()}else{if(a.ddlVehiculo.swidget().selectedItem().value==Core.Enums.eVehiculo.INT&&a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eMesaTipoOperacion.VentaBono){a.lblMonto2.text("Monto INT");a.lblPrecio2.text("Precio INT");a.lblCantidad2.text("Cantidad INT");a.setPreciosByReferencia()}else{if(a.ddlVehiculo.swidget().selectedItem().value==Core.Enums.eVehiculo.INT&&a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eMesaTipoOperacion.CompraBono){a.lblMonto2.text("Monto BCI");a.lblPrecio2.text("Precio BCI");a.lblCantidad2.text("Cantidad BCI");a.setPreciosByReferencia()}else{if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eMesaTipoOperacion.Transferencia&&a.ddlContraparte.swidget().selectedItem().value==Core.Enums.eVehiculo.BCV){a.lblCantidad2.text("Cantidad BCV")}else{if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eMesaTipoOperacion.Transferencia&&a.ddlContraparte.swidget().selectedItem().value==Core.Enums.eVehiculo.INT){a.lblCantidad2.text("Cantidad INT")}}}}}};a.getTitle=function(){if(a.origen==Core.Enums.eMesaOperacionOrigen.Operacion||a.origen==Core.Enums.eMesaOperacionOrigen.Banco){return"Nuevo Detalle"}else{if(a.origen==Core.Enums.eMesaOperacionOrigen.Ajuste){return"Ajuste"}else{if(a.origen==Core.Enums.eMesaOperacionOrigen.Transferencia){return"Transferencia"}else{if(a.origen==Core.Enums.eMesaOperacionOrigen.Taco){return"Taco"}else{return" Compra/Venta de Bonos"}}}}};a.setOptionsContraparteTransferencia=function(){if(a.origen==Core.Enums.eMesaOperacionOrigen.Transferencia){var d=[];if(!(a.ddlVehiculo.swidget().selectedItem().value==Core.Enums.eVehiculo.INT)){d.push({value:Core.Enums.eVehiculo.INT,text:"INT"})}if(!(a.ddlVehiculo.swidget().selectedItem().value==Core.Enums.eVehiculo.BCI)){d.push({value:Core.Enums.eVehiculo.BCI,text:"BCI"})}if(!(a.ddlVehiculo.swidget().selectedItem().value==Core.Enums.eVehiculo.BCV)){d.push({value:Core.Enums.eVehiculo.BCV,text:"BCV"})}var c=a.ddlContraparte.swidget().initialOptions;c.dataSource.data=d;c.value=(a.ddlContraparte.swidget().selectedItem()&&a.ddlVehiculo.swidget().selectedItem().value!=a.ddlContraparte.swidget().selectedItem().value)?a.ddlContraparte.swidget().selectedItem().value.toString():d[0].value.toString();a.ddlContraparte.swidget().refresh(c)}};a.getVehiculoDefault=function(){if(a.operacionPadre!=null){if(a.operacionPadre.idCuenta==Core.Enums.eVehiculo.NA){return Core.Enums.eVehiculo.BCV.toString()}else{return a.operacionPadre.idCuenta.toString()}}else{if(a.origen==Core.Enums.eMesaOperacionOrigen.Ajuste){return Core.Enums.eVehiculo.BCV.toString()}else{return Core.Enums.eVehiculo.BCI.toString()}}};a.getFechaLiquidacionDefault=function(){var c=new Core.Ajax.ServerRequest({allowCache:true,overlayElement:a.overlayElement,showOverlay:true,requestUrl:"fechasdefault",requestType:"GET"});c.onSuccess=function(d){var e=new Date(d.fechasDefault[0].fechaLiquidacion.replaceAll("-","/"));a.txtDateLiquidacion.swidget().value(e)};c.request()};a.getMercadoDefault=function(){return""};a.setTipoCambio=function(){a.divTipoCambio.hide();if(a.pantallaOrigen==Core.Enums.eManagerOperacionPantallaOrigen.OperacionesParidad&&(a.origen==Core.Enums.eMesaOperacionOrigen.Operacion||a.origen==Core.Enums.eMesaOperacionOrigen.Banco)&&(a.chkUsd.swidget().checked())){a.divTipoCambio.show()}}};Core.Controls.ManagerOperacion.SearchAccount=function(b){var a=this;a.divModal=$(".modal-buscar-cuentas-manager-operacion");a.divGridCuentas=null;a.idVehiculo=null;a.onSelected=function(){};a.onDestroy=function(){};$.extend(true,a,b);a.show=function(){a.divGridCuentas=a.divModal.find(".div-cuentas");a.txtFilter=a.divModal.find(".textbox-filter-cuentas");a.initControls();a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.txtFilter.swidget().focus(true);a.divModal.modal({show:true})};a.initControls=function(){a.divGridCuentas.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:[{field:"NumComitente",width:"20%",title:"Comitente",headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"Descripcion",width:"70%",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{field:"",title:" ",width:"10%",headerAttributes:Core.Functions.grid.getCellEvenClass(),buttons:[{caption:"Seleccionar",cls:"",commandName:"Seleccionar",click:function(d){var c=a.divGridCuentas.swidget().dataItem(d);a.onSelected(c);a.divModal.modal("hide")}}]}]});a.txtFilter.shieldTextBox({value:"",events:{blur:function(){a.loadGrid()}}})};a.loadGrid=function(){if(a.txtFilter.val()){var c=new Core.Ajax.ServerRequest({showOverlay:false,secureRequest:true,requestUrl:"comitentes/numdescripcion/"+a.idVehiculo+"/"+a.txtFilter.val(),requestType:"GET"});c.onSuccess=function(f){var d=f.cuentas==null?[]:f.cuentas;var e=a.divGridCuentas.swidget().initialOptions;e.dataSource.data=d;a.divGridCuentas.swidget().refresh(e)};c.request()}};a.destroy=function(){a.divGridCuentas.swidget().destroy();a.txtFilter.swidget().destroy();a.onDestroy()}};Core.Controls.ManagerOperacionCanje=function(b){var a=this;a.windowHeight=750;a.windowWidth=525;a.eParking={SinSeleccion:null,Si:1,No:0};a.ePlazo={T0:0,T1:1,T2:2,Otro:-1};a.divManagerOperacion=$(".div-manager-operacion-canje");a.decimalCount=10;a.operacion=null;a.operacionPadre=null;a.idPuntaDetalle=null;a.divDateOperacion=null;a.txtDateOperacion=null;a.divDateLiquidacion=null;a.txtDateLiquidacion=null;a.divParking=null;a.divPlazo=null;a.txtMep=null;a.divMep=null;a.divVehiculo=null;a.ddlVehiculo=null;a.lblOperacionCuenta=null;a.divTipoOperacion=null;a.ddlTipoOperacion=null;a.divCable=null;a.txtCable=null;a.divPrecio=null;a.txtPrecio=null;a.divObservaciones=null;a.txtObservaciones=null;a.divTipoNegocio=null;a.ddlTipoNegocio=null;a.divControlsAsesor=null;a.txtAsesor=null;a.btnBuscarAsesor=null;a.lblDescripcionAsesor=null;a.asesorSeleccionado=null;a.divAlert=null;a.onSave=null;a.onDestroy=null;a.overlayElement=null;a.fechasPlazos=null;a.requestUrl="operacionescanje";$.extend(true,a,b);a.show=function(){a.divManagerOperacion.shieldWindow({title:"Operación",visible:false,height:a.windowHeight,width:a.windowWidth,pinned:false,titleBarButtons:["maximize","close"],position:{left:$(window).width()-a.windowWidth-40,top:$(window).height()-a.windowHeight+$(window).scrollTop()},events:{close:function(l){a.destroy()}}});a.divManagerOperacionContainer=a.divManagerOperacion.find(".div-manager-operacion-container");a.divDateOperacion=a.divManagerOperacion.find(".div-operacion-fecha-operacion");a.txtDateOperacion=a.divManagerOperacion.find(".date-picker-operacion-fecha-operacion");a.divDateLiquidacion=a.divManagerOperacion.find(".div-operacion-fecha-liquidacion");a.txtDateLiquidacion=a.divManagerOperacion.find(".date-picker-operacion-fecha-liquidacion");a.divParking=a.divManagerOperacion.find(".div-operacion-parking");a.chkParkingSinSeleccion=a.divManagerOperacion.find(".chk-operacion-parking-sin-seleccion");a.chkParkingSi=a.divManagerOperacion.find(".chk-operacion-parking-si");a.chkParkingNo=a.divManagerOperacion.find(".chk-operacion-parking-no");a.divPlazo=a.divManagerOperacion.find(".div-operacion-plazo");a.chkPlazoT0=a.divManagerOperacion.find(".chk-operacion-plazo-t0");a.chkPlazoT1=a.divManagerOperacion.find(".chk-operacion-plazo-t1");a.chkPlazoT2=a.divManagerOperacion.find(".chk-operacion-plazo-t2");a.chkPlazoOtro=a.divManagerOperacion.find(".chk-operacion-plazo-otro");a.divVehiculo=a.divManagerOperacion.find(".div-operacion-vehiculo");a.ddlVehiculo=a.divManagerOperacion.find(".dropdown-operacion-vehiculo");a.lblOperacionCuenta=a.divManagerOperacion.find(".lbl-operacion-cuenta");a.divTipoOperacion=a.divManagerOperacion.find(".div-operacion-tipo-operacion");a.ddlTipoOperacion=a.divManagerOperacion.find(".dropdown-operacion-tipo-operacion");a.divCable=a.divManagerOperacion.find(".div-operacion-cable");a.txtCable=a.divManagerOperacion.find(".textbox-operacion-cable");a.divPrecio=a.divManagerOperacion.find(".div-operacion-precio");a.txtPrecio=a.divManagerOperacion.find(".textbox-operacion-precio");a.divMep=a.divManagerOperacion.find(".div-operacion-mep");a.txtMep=a.divManagerOperacion.find(".textbox-operacion-mep");a.divObservaciones=a.divManagerOperacion.find(".div-operacion-observaciones");a.txtObservaciones=a.divManagerOperacion.find(".textbox-operacion-observaciones");a.divAlert=a.divManagerOperacion.find(".div-operacion-alert");a.divControlsAsesor=a.divManagerOperacion.find(".div-operacion-asesor");a.txtAsesor=a.divManagerOperacion.find(".textbox-operacion-asesor");a.btnBuscarAsesor=a.divManagerOperacion.find(".btn-operacion-asesor");a.lblDescripcionAsesor=a.divManagerOperacion.find(".lbl-operacion-asesor");a.asesorSeleccionado=null;a.divAlert.slideUp();a.txtDateOperacion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.operacion&&a.operacion.FechaOperacion!=null)?a.operacion.FechaOperacion:new Date(),events:{change:function(l){a.getFechasPlazo(a.divManagerOperacionContainer)}}});Core.Functions.Validations.toggleValidation(a.txtDateOperacion,false);a.txtDateLiquidacion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.operacion&&a.operacion.FechaLiquidacion!=null)?a.operacion.FechaLiquidacion:null});Core.Functions.Validations.toggleValidation(a.txtDateLiquidacion,false);if(!a.chkParkingSinSeleccion.swidget()){a.chkParkingSinSeleccion.shieldRadioButton({label:"Sin selección"})}var e=a.chkParkingSinSeleccion.swidget().initialOptions;e.checked=(a.operacion)?a.operacion.Parking==-1:true;a.chkParkingSinSeleccion.swidget().refresh(e);if(!a.chkParkingSi.swidget()){a.chkParkingSi.shieldRadioButton({label:"Si"})}var d=a.chkParkingSi.swidget().initialOptions;d.checked=(a.operacion)?a.operacion.Parking==a.eParking.Si:false;a.chkParkingSi.swidget().refresh(d);if(!a.chkParkingNo.swidget()){a.chkParkingNo.shieldRadioButton({label:"No"})}var c=a.chkParkingNo.swidget().initialOptions;c.checked=(a.operacion)?a.operacion.Parking==a.eParking.No:false;a.chkParkingNo.swidget().refresh(c);if(!a.chkPlazoT0.swidget()){a.chkPlazoT0.shieldRadioButton({label:"T0",events:{click:function(l){a.setFechaLiquidacion()}}})}var g=a.chkPlazoT0.swidget().initialOptions;g.checked=(a.operacion)?a.operacion.idPlazo==a.ePlazo.T0:false;a.chkPlazoT0.swidget().refresh(g);if(!a.chkPlazoT1.swidget()){a.chkPlazoT1.shieldRadioButton({label:"T1",events:{click:function(l){a.setFechaLiquidacion()}}})}var h=a.chkPlazoT1.swidget().initialOptions;h.checked=(a.operacion)?a.operacion.idPlazo==a.ePlazo.T1:false;a.chkPlazoT1.swidget().refresh(h);if(!a.chkPlazoT2.swidget()){a.chkPlazoT2.shieldRadioButton({label:"T2",events:{click:function(l){a.setFechaLiquidacion()}}})}var i=a.chkPlazoT2.swidget().initialOptions;i.checked=(a.operacion)?a.operacion.idPlazo==a.ePlazo.T2:false;a.chkPlazoT2.swidget().refresh(i);if(!a.chkPlazoOtro.swidget()){a.chkPlazoOtro.shieldRadioButton({label:"Otro",events:{click:function(l){a.setFechaLiquidacion()}}})}var f=a.chkPlazoOtro.swidget().initialOptions;f.checked=(a.operacion)?a.operacion.idPlazo==a.ePlazo.Otro:true;a.chkPlazoOtro.swidget().refresh(f);var k=[];k.push({value:Core.Enums.eVehiculo.INT,text:"INT"});k.push({value:Core.Enums.eVehiculo.BCI,text:"BCI"});k.push({value:Core.Enums.eVehiculo.BCV,text:"BCV"});k.push({value:Core.Enums.eVehiculo.UK,text:"UK"});a.ddlVehiculo.shieldDropDown({dataSource:{data:k},valueTemplate:"{value}",textTemplate:"{text}",value:(a.operacion&&a.operacion.idCuenta!=null)?a.operacion.idCuenta.toString():Core.Enums.eVehiculo.BCV.toString()});Core.Functions.Validations.toggleValidation(a.ddlVehiculo,false);var j=[];j.push({value:Core.Enums.eMesaTipoOperacion.Compra,text:"Compra"});j.push({value:Core.Enums.eMesaTipoOperacion.Venta,text:"Venta"});a.ddlTipoOperacion.shieldDropDown({dataSource:{data:j},valueTemplate:"{value}",textTemplate:"{text}",value:(a.operacion&&a.operacion.idTipoOperacion!=null)?a.operacion.idTipoOperacion.toString():"",events:{select:function(l){a.setColorsByTipoOperacion()}}});Core.Functions.Validations.toggleValidation(a.ddlTipoOperacion,false);a.txtObservaciones.shieldTextBox({value:(a.operacion&&a.operacion.Observaciones!=null)?a.operacion.Observaciones:""});Core.Functions.Validations.toggleValidation(a.txtObservaciones,false);new Core.Controls.DecimalPicker(a.txtPrecio,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:(a.operacion&&a.operacion.Precio!=null)?a.operacion.Precio:"",onKeyUp:function(){a.setMep()}});Core.Functions.Validations.toggleValidation(a.txtPrecio,false);new Core.Controls.DecimalPicker(a.txtMep,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:(a.operacion&&a.operacion.Mep!=null)?a.operacion.Mep:"",onKeyUp:function(){a.setPrecio()}});Core.Functions.Validations.toggleValidation(a.txtMep,false);new Core.Controls.DecimalPicker(a.txtCable,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:(a.operacion&&a.operacion.Cable!=null)?a.operacion.Cable:"",onKeyUp:function(){a.setMep()}});Core.Functions.Validations.toggleValidation(a.txtCable,false);a.txtAsesor.val(((a.operacion&&a.operacion.UsernameAsesor)?a.operacion.UsernameAsesor:""));a.txtAsesor.unbind("keyup");a.txtAsesor.on("keyup",function(l){a.searchAsesor()});Core.Functions.Validations.toggleValidation(a.txtAsesor,false);a.btnBuscarAsesor.unbind("click");a.btnBuscarAsesor.on("click",function(){a.divManagerOperacion.swidget().minimized(true);new Core.Controls.MinutaBuscarAsesor({onSelected:function(l){a.asesorSeleccionado=l;a.lblDescripcionAsesor.text(a.asesorSeleccionado.NombreCompleto+" / "+a.asesorSeleccionado.Unidad);a.txtAsesor.val(a.asesorSeleccionado.Username)},onClosed:function(){a.divManagerOperacion.swidget().minimized(false)}}).show()});a.lblDescripcionAsesor.text("Asesor no encontrado");if(a.txtAsesor.val()){a.searchAsesor()}a.setColorsByTipoOperacion();a.divManagerOperacion.find(".btn-operacion-confirmar").unbind("click");a.divManagerOperacion.find(".btn-operacion-confirmar").click(function(){Core.Functions.Validations.toggleValidation(a.txtDateOperacion,false);Core.Functions.Validations.toggleValidation(a.txtCable,false);Core.Functions.Validations.toggleValidation(a.txtPrecio,false);Core.Functions.Validations.toggleValidation(a.txtMep,false);Core.Functions.Validations.toggleValidation(a.ddlVehiculo,false);Core.Functions.Validations.toggleValidation(a.ddlTipoOperacion,false);Core.Functions.Validations.toggleValidation(a.txtAsesor,false);a.divAlert.slideUp();var l=a.getRequestData();if(l==null){return}var m=new Core.Ajax.ServerRequest({overlayElement:a.divManagerOperacion.find(".btn-operacion-confirmar"),showOverlay:true,requestUrl:a.requestUrl,requestType:(a.operacion!=null&&a.operacion.idOperacionCanje!=null)?"PUT":"POST",requestData:l});m.onSuccess=function(n){a.destroy();if(a.onSave){a.onSave()}};m.onError=function(o){var n=(o.responseJSON&&o.responseJSON.Descripcion)?o.responseJSON.Descripcion:"Algunos componentes de la página no se cargaron correctamente. Por favor intente mas tarde...";a.divAlert.text(n);a.divAlert.slideDown()};m.request()});if(a.operacion){a.setMep()}a.getFechasPlazo(a.overlayElement,function(){a.divManagerOperacion.swidget().visible(true);a.txtDateOperacion.swidget().focus()})};a.destroy=function(){a.txtDateOperacion.swidget().destroy();a.txtDateLiquidacion.swidget().destroy();a.txtObservaciones.swidget().destroy();a.ddlVehiculo.swidget().destroy();a.ddlTipoOperacion.swidget().destroy();a.divManagerOperacion.swidget().destroy();Core.Objects.Context.Dialogs.remove(this);if(a.onDestroy!=null){a.onDestroy()}};a.getFechasPlazo=function(d,c){var e=new Core.Ajax.ServerRequest({overlayElement:d,secureRequest:true,requestUrl:"operacionesmonedas/plazos/fechas/"+Core.Functions.Date.getDateAsString(a.txtDateOperacion.swidget().value()),requestType:"GET"});e.onSuccess=function(f){a.fechasPlazos=f.fechas;a.setFechaLiquidacion();if(c){c()}};e.request()};a.setFechaLiquidacion=function(){var d=a.ePlazo.Otro;if(a.chkPlazoT0.swidget().checked()){d=a.ePlazo.T0}else{if(a.chkPlazoT1.swidget().checked()){d=a.ePlazo.T1}else{if(a.chkPlazoT2.swidget().checked()){d=a.ePlazo.T2}}}var c=$.grep(a.fechasPlazos,function(e,g){return e.idPlazo==d})[0];a.txtDateLiquidacion.swidget().enabled(c==null);if(c){a.txtDateLiquidacion.swidget().value(a.getDate(c.Fecha))}};a.getDate=function(c){var d=c.substr(8,2);var e=c.substr(5,2);var g=c.substr(0,4);var f=new Date();f.setDate(1);f.setYear(g);f.setMonth(e-1);f.setDate(d);return f};a.getRequestData=function(){var d={value:true};var c={data:{}};c.data.FechaConcertacion=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtDateOperacion,d));c.data.FechaLiquidacion=a.txtDateLiquidacion.swidget().value()?Core.Functions.Date.getDateAsString(a.txtDateLiquidacion.swidget().value()):null;c.data.idCuenta=Core.Functions.Validations.getValidatedDropDownValue(a.ddlVehiculo,d);c.data.idTipoOperacion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,d);c.data.Observaciones=a.txtObservaciones.swidget().value();c.data.Cable=Core.Functions.Decimal.parseFloat(a.txtCable.val());c.data.Precio1=Core.Functions.Decimal.parseFloat(a.txtPrecio.val());c.data.Mep=Core.Functions.Decimal.parseFloat(a.txtMep.val());c.data.idMoneda=Core.Enums.Currency.DolaresCable.idMoneda;c.data.Parking=a.getSelectedParking(d);c.data.idPlazo=a.getSelectedPlazo(d);if(a.operacion&&a.operacion.idOperacionCanje!=null){c.data.idOperacionCanje=a.operacion.idOperacionCanje}if(a.asesorSeleccionado){c.data.idPersonaAsesor=a.asesorSeleccionado.idPersonaAsesor}if(d.value){return c}else{return null}};a.setColorsByTipoOperacion=function(){a.txtCable.css("background-color","");a.txtMep.css("background-color","");if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eMesaTipoOperacion.Compra){a.txtCable.css("background-color","rgba(204, 255, 204, 0.9)");a.txtMep.css("background-color","rgba(255, 204, 204,0.9)")}else{if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eMesaTipoOperacion.Venta){a.txtMep.css("background-color","rgba(204, 255, 204, 0.9)");a.txtCable.css("background-color","rgba(255, 204, 204,0.9)")}}};a.setMep=function(){var c="";c=(Core.Functions.Decimal.parseFloat(a.txtCable.val())*Core.Functions.Decimal.parseFloat(a.txtPrecio.val()));a.txtMep.val(c);a.txtMep.blur()};a.setPrecio=function(){var c="";c=(Core.Functions.Decimal.parseFloat(a.txtMep.val())/Core.Functions.Decimal.parseFloat(a.txtCable.val()));a.txtPrecio.val(c);a.txtPrecio.blur()};a.getSelectedParking=function(c){if(a.chkParkingSinSeleccion.swidget().checked()){return a.eParking.SinSeleccion}else{if(a.chkParkingSi.swidget().checked()){return a.eParking.Si}else{if(a.chkParkingNo.swidget().checked()){return a.eParking.No}else{c.value=false;a.divAlert.text("Debe seleccionar el parking.");a.divAlert.slideDown()}}}};a.getSelectedPlazo=function(c){if(a.chkPlazoT0.swidget().checked()){return a.ePlazo.T0}else{if(a.chkPlazoT1.swidget().checked()){return a.ePlazo.T1}else{if(a.chkPlazoT2.swidget().checked()){return a.ePlazo.T2}else{if(a.chkPlazoOtro.swidget().checked()){return a.ePlazo.Otro}else{c.value=false;a.divAlert.text("Debe seleccionar el plazo.");a.divAlert.slideDown()}}}}};a.searchAsesor=function(){if(a.txtAsesor.val()&&a.txtAsesor.val().length>=4){var c=new Core.Ajax.ServerRequest({showOverlay:false,secureRequest:true,requestUrl:"minutas/version2/asesores/"+a.txtAsesor.val(),requestType:"GET"});c.onSuccess=function(e){var d=null;e.asesores.forEach(function(g,f){if(g.Username==a.txtAsesor.val()){d=g}});if(d){a.asesorSeleccionado=d;a.lblDescripcionAsesor.text(a.asesorSeleccionado.NombreCompleto+" / "+a.asesorSeleccionado.Unidad)}else{a.asesorSeleccionado=null;a.lblDescripcionAsesor.text("Asesor no encontrado")}};c.request()}else{a.asesorSeleccionado=null;a.lblDescripcionAsesor.text("Asesor no encontrado")}}};Core.Controls.ManagerOperacionUSD=function(b){var a=this;a.windowHeight=750;a.windowWidth=525;a.preciosSubidaBajada=null;a.eTipoInstrumento={Bono:0,Accion:1};a.eTipoNegocio={Monedas:0,Instrumentos:1,Concepto:4};a.eParking={SinSeleccion:null,Si:1,No:0};a.ePlazo={T0:0,T1:1,T2:2,Otro:-1};a.eMercado={NA:0,Mae:1,MervalSenebi:2,MervalPPT:3,Banco:4,Byma:5};a.eTipoContraparte={Agente:1,Comitente:2,Banco:3,Balanz:4};a.pantallaOrigen=Core.Enums.eManagerOperacionPantallaOrigen.OperacionesUSD;a.opcionesDefault=Core.Enums.eMesaOperacionOpcionesDefault.NA;a.divManagerOperacion=$(".div-manager-operacion-usd");a.decimalCount=10;a.operacion=null;a.operacionPadre=null;a.idPuntaDetalle=null;a.divDateOperacion=null;a.txtDateOperacion=null;a.divDateLiquidacion=null;a.txtDateLiquidacion=null;a.divParking=null;a.divPlazo=null;a.divDateLiquidacionReal=null;a.txtDateLiquidacionReal=null;a.divContraparte=null;a.txtMonto=null;a.divMonto=null;a.divMonto2=null;a.divCantidad2=null;a.divVehiculo=null;a.ddlVehiculo=null;a.divComitenteOperatoria=null;a.ddlComitenteOperatoria=null;a.lblOperacionCuenta=null;a.divTipoOperacion=null;a.ddlTipoOperacion=null;a.divTicker=null;a.divConcepto=null;a.divSaldosIgnorados=null;a.divCantidad=null;a.txtCantidad=null;a.divPrecioReferencia=null;a.divPrecio=null;a.lblPrecio=null;a.txtPrecio=null;a.divPrecio2=null;a.divTipoInstrumento=null;a.divMoneda=null;a.ddlMoneda=null;a.divObservaciones=null;a.txtObservaciones=null;a.divTipoNegocio=null;a.ddlTipoNegocio=null;a.divMercado=null;a.ddlMercado=null;a.divEstado=null;a.divNominalesLiquidados=null;a.divMontoPendiente=null;a.divMontoLiquidado=null;a.divTipoContraparte=null;a.divTipoCambio=null;a.txtTipoCambio=null;a.divControlsComitente=null;a.divIdUsd=null;a.txtIdUsd=null;a.divControlsAsesor=null;a.txtAsesor=null;a.btnBuscarAsesor=null;a.lblDescripcionAsesor=null;a.asesorSeleccionado=null;a.divAlert=null;a.onSave=null;a.onDestroy=null;a.overlayElement=null;a.fechasPlazos=null;a.requestUrl="operacionesmonedas";$.extend(true,a,b);a.show=function(){a.divManagerOperacion.shieldWindow({title:"Operación",visible:false,height:a.windowHeight,width:a.windowWidth,pinned:false,titleBarButtons:["maximize","close"],position:{left:$(window).width()-a.windowWidth-40,top:$(window).height()-a.windowHeight+$(window).scrollTop()},events:{close:function(l){a.destroy()}}});a.divManagerOperacionContainer=a.divManagerOperacion.find(".div-manager-operacion-container");a.divDateOperacion=a.divManagerOperacion.find(".div-operacion-fecha-operacion");a.txtDateOperacion=a.divManagerOperacion.find(".date-picker-operacion-fecha-operacion");a.divDateLiquidacion=a.divManagerOperacion.find(".div-operacion-fecha-liquidacion");a.txtDateLiquidacion=a.divManagerOperacion.find(".date-picker-operacion-fecha-liquidacion");a.divParking=a.divManagerOperacion.find(".div-operacion-parking");a.chkParkingSinSeleccion=a.divManagerOperacion.find(".chk-operacion-parking-sin-seleccion");a.chkParkingSi=a.divManagerOperacion.find(".chk-operacion-parking-si");a.chkParkingNo=a.divManagerOperacion.find(".chk-operacion-parking-no");a.divPlazo=a.divManagerOperacion.find(".div-operacion-plazo");a.chkPlazoT0=a.divManagerOperacion.find(".chk-operacion-plazo-t0");a.chkPlazoT1=a.divManagerOperacion.find(".chk-operacion-plazo-t1");a.chkPlazoT2=a.divManagerOperacion.find(".chk-operacion-plazo-t2");a.chkPlazoOtro=a.divManagerOperacion.find(".chk-operacion-plazo-otro");a.divContraparte=a.divManagerOperacion.find(".div-operacion-contraparte");a.divVehiculo=a.divManagerOperacion.find(".div-operacion-vehiculo");a.ddlVehiculo=a.divManagerOperacion.find(".dropdown-operacion-vehiculo");a.divComitenteOperatoria=a.divManagerOperacion.find(".div-operacion-comitente-operatoria");a.ddlComitenteOperatoria=a.divManagerOperacion.find(".dropdown-operacion-comitente-operatoria");a.lblOperacionCuenta=a.divManagerOperacion.find(".lbl-operacion-cuenta");a.divTipoOperacion=a.divManagerOperacion.find(".div-operacion-tipo-operacion");a.ddlTipoOperacion=a.divManagerOperacion.find(".dropdown-operacion-tipo-operacion");a.divTicker=a.divManagerOperacion.find(".div-operacion-especie");a.divConcepto=a.divManagerOperacion.find(".div-operacion-concepto");a.divCantidad=a.divManagerOperacion.find(".div-operacion-cantidad");a.txtCantidad=a.divManagerOperacion.find(".textbox-operacion-cantidad");a.divSaldosIgnorados=a.divManagerOperacion.find(".div-saldos-ignorados");a.divPrecioReferencia=a.divManagerOperacion.find(".div-operacion-precio-referencia");a.divPrecio=a.divManagerOperacion.find(".div-operacion-precio");a.lblPrecio=a.divManagerOperacion.find(".label-operacion-precio");a.lblPrecio.text("Precio");a.txtPrecio=a.divManagerOperacion.find(".textbox-operacion-precio");a.divPrecio2=a.divManagerOperacion.find(".div-operacion-precio2");a.divTipoInstrumento=a.divManagerOperacion.find(".div-operacion-instrumento");a.divMonto=a.divManagerOperacion.find(".div-operacion-monto");a.txtMonto=a.divManagerOperacion.find(".textbox-operacion-monto");a.divMonto2=a.divManagerOperacion.find(".div-operacion-monto2");a.divCantidad2=a.divManagerOperacion.find(".div-operacion-cantidad2");a.divMoneda=a.divManagerOperacion.find(".div-operacion-moneda");a.ddlMoneda=a.divManagerOperacion.find(".dropdown-operacion-moneda");a.divObservaciones=a.divManagerOperacion.find(".div-operacion-observaciones");a.txtObservaciones=a.divManagerOperacion.find(".textbox-operacion-observaciones");a.divEstado=a.divManagerOperacion.find(".div-operacion-estado");a.divNominalesLiquidados=a.divManagerOperacion.find(".div-operacion-nominales-liquidados");a.divMontoPendiente=a.divManagerOperacion.find(".div-operacion-monto-pendiente");a.divMontoLiquidado=a.divManagerOperacion.find(".div-operacion-monto-liquidado");a.divAlert=a.divManagerOperacion.find(".div-operacion-alert");a.divTipoNegocio=a.divManagerOperacion.find(".div-operacion-tipo-negocio");a.ddlTipoNegocio=a.divManagerOperacion.find(".dropdown-operacion-tipo-negocio");a.divMercado=a.divManagerOperacion.find(".div-operacion-mercado");a.ddlMercado=a.divManagerOperacion.find(".dropdown-operacion-mercado");a.divTipoContraparte=a.divManagerOperacion.find(".div-operacion-tipo-contraparte");a.divTipoCambio=a.divManagerOperacion.find(".div-operacion-tipo-cambio");a.txtTipoCambio=a.divManagerOperacion.find(".textbox-operacion-tipo-cambio");a.divControlsComitente=a.divManagerOperacion.find(".div-controls-comitente");a.divDateLiquidacionReal=a.divManagerOperacion.find(".div-operacion-fecha-liquidacion-real");a.txtDateLiquidacionReal=a.divManagerOperacion.find(".date-picker-operacion-fecha-liquidacion-real");a.divIdUsd=a.divManagerOperacion.find(".div-operacion-id-usd");a.txtIdUsd=a.divManagerOperacion.find(".textbox-operacion-id-usd");a.divUsd=a.divManagerOperacion.find(".div-operacion-usd");a.chkUsd=a.divManagerOperacion.find(".checkbox-operacion-usd");a.divControlsAsesor=a.divManagerOperacion.find(".div-operacion-asesor");a.divControlsAsesor.show();a.txtAsesor=a.divManagerOperacion.find(".textbox-operacion-asesor");a.btnBuscarAsesor=a.divManagerOperacion.find(".btn-operacion-asesor");a.lblDescripcionAsesor=a.divManagerOperacion.find(".lbl-operacion-asesor");a.asesorSeleccionado=null;a.divAlert.slideUp();a.txtDateOperacion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.operacion&&a.operacion.FechaOperacion!=null)?a.operacion.FechaOperacion:new Date(),events:{change:function(l){a.getFechasPlazo(a.divManagerOperacionContainer)}}});Core.Functions.Validations.toggleValidation(a.txtDateOperacion,false);a.txtDateLiquidacion.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.operacion&&a.operacion.FechaLiquidacion!=null)?a.operacion.FechaLiquidacion:null});Core.Functions.Validations.toggleValidation(a.txtDateLiquidacion,false);if(!a.chkParkingSinSeleccion.swidget()){a.chkParkingSinSeleccion.shieldRadioButton({label:"Sin selección"})}var e=a.chkParkingSinSeleccion.swidget().initialOptions;e.checked=(a.operacion)?a.operacion.Parking==-1:true;a.chkParkingSinSeleccion.swidget().refresh(e);if(!a.chkParkingSi.swidget()){a.chkParkingSi.shieldRadioButton({label:"Si"})}var d=a.chkParkingSi.swidget().initialOptions;d.checked=(a.operacion)?a.operacion.Parking==a.eParking.Si:false;a.chkParkingSi.swidget().refresh(d);if(!a.chkParkingNo.swidget()){a.chkParkingNo.shieldRadioButton({label:"No"})}var c=a.chkParkingNo.swidget().initialOptions;c.checked=(a.operacion)?a.operacion.Parking==a.eParking.No:false;a.chkParkingNo.swidget().refresh(c);if(!a.chkPlazoT0.swidget()){a.chkPlazoT0.shieldRadioButton({label:"T0",events:{click:function(l){a.setFechaLiquidacion()}}})}var g=a.chkPlazoT0.swidget().initialOptions;g.checked=(a.operacion)?a.operacion.idPlazo==a.ePlazo.T0:false;a.chkPlazoT0.swidget().refresh(g);if(!a.chkPlazoT1.swidget()){a.chkPlazoT1.shieldRadioButton({label:"T1",events:{click:function(l){a.setFechaLiquidacion()}}})}var h=a.chkPlazoT1.swidget().initialOptions;h.checked=(a.operacion)?a.operacion.idPlazo==a.ePlazo.T1:false;a.chkPlazoT1.swidget().refresh(h);if(!a.chkPlazoT2.swidget()){a.chkPlazoT2.shieldRadioButton({label:"T2",events:{click:function(l){a.setFechaLiquidacion()}}})}var i=a.chkPlazoT2.swidget().initialOptions;i.checked=(a.operacion)?a.operacion.idPlazo==a.ePlazo.T2:false;a.chkPlazoT2.swidget().refresh(i);if(!a.chkPlazoOtro.swidget()){a.chkPlazoOtro.shieldRadioButton({label:"Otro",events:{click:function(l){a.setFechaLiquidacion()}}})}var f=a.chkPlazoOtro.swidget().initialOptions;f.checked=(a.operacion)?a.operacion.idPlazo==a.ePlazo.Otro:true;a.chkPlazoOtro.swidget().refresh(f);var k=[];k.push({value:Core.Enums.eVehiculo.INT,text:"INT"});k.push({value:Core.Enums.eVehiculo.BCI,text:"BCI"});k.push({value:Core.Enums.eVehiculo.BCV,text:"BCV"});k.push({value:Core.Enums.eVehiculo.UK,text:"UK"});a.ddlVehiculo.shieldDropDown({dataSource:{data:k},valueTemplate:"{value}",textTemplate:"{text}",value:(a.operacion&&a.operacion.idCuenta!=null)?a.operacion.idCuenta.toString():a.getVehiculoDefault(),events:{select:function(l){a.setControlsByVehiculoAndEstado()}}});Core.Functions.Validations.toggleValidation(a.ddlVehiculo,false);var j=[];j.push({value:Core.Enums.eMesaTipoOperacion.Compra,text:"Compra"});j.push({value:Core.Enums.eMesaTipoOperacion.Venta,text:"Venta"});a.ddlTipoOperacion.shieldDropDown({dataSource:{data:j},valueTemplate:"{value}",textTemplate:"{text}",value:(a.operacion&&a.operacion.idTipoOperacion!=null)?a.operacion.idTipoOperacion.toString():"",events:{select:function(l){a.setColorsByTipoOperacion()}}});Core.Functions.Validations.toggleValidation(a.ddlTipoOperacion,false);a.ddlMoneda.shieldDropDown({dataSource:{data:[Core.Enums.Currency.Euros,Core.Enums.Currency.Pesos,Core.Enums.Currency.Dolares,Core.Enums.Currency.DolaresCable]},textTemplate:"{Descripcion}",valueTemplate:"{idMoneda}",value:(a.operacion&&a.operacion.idMoneda!=null)?a.operacion.idMoneda.toString():Core.Enums.Currency.DolaresCable.idMoneda.toString()});Core.Functions.Validations.toggleValidation(a.ddlMoneda,false);a.txtObservaciones.shieldTextBox({value:(a.operacion&&a.operacion.Observaciones!=null)?a.operacion.Observaciones:""});Core.Functions.Validations.toggleValidation(a.txtObservaciones,false);new Core.Controls.DecimalPicker(a.txtPrecio,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:(a.operacion&&a.operacion.Precio!=null)?a.operacion.Precio:"",onKeyUp:function(){a.setMonto()}});Core.Functions.Validations.toggleValidation(a.txtPrecio,false);new Core.Controls.DecimalPicker(a.txtMonto,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:(a.operacion&&a.operacion.Monto!=null)?a.operacion.Monto:"",onKeyUp:function(){a.setPrecio()}});Core.Functions.Validations.toggleValidation(a.txtMonto,false);new Core.Controls.DecimalPicker(a.txtCantidad,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:(a.operacion&&a.operacion.Cantidad!=null)?a.operacion.Cantidad:"",onKeyUp:function(){a.setMonto()}});Core.Functions.Validations.toggleValidation(a.txtCantidad,false);a.ddlTipoNegocio.shieldDropDown({dataSource:{data:[{value:a.eTipoNegocio.Instrumentos,text:"Instrumentos"},{value:a.eTipoNegocio.Monedas,text:"Monedas"},{value:a.eTipoNegocio.Concepto,text:"Concepto"}]},valueTemplate:"{value}",textTemplate:"{text}",value:(a.operacion&&a.operacion.idNegocio!=null)?a.operacion.idNegocio.toString():""});Core.Functions.Validations.toggleValidation(a.ddlTipoNegocio,false);a.ddlMercado.shieldDropDown({dataSource:{data:[{value:a.eMercado.NA,text:"NA"},{value:a.eMercado.Mae,text:"MAE"},{value:a.eMercado.MervalSenebi,text:"Merval SENEBI"},{value:a.eMercado.MervalPPT,text:"Merval PPT"},{value:a.eMercado.Banco,text:"Banco"},{value:a.eMercado.Byma,text:"BYMA"}]},valueTemplate:"{value}",textTemplate:"{text}",value:(a.operacion&&a.operacion.idMercado!=null)?a.operacion.idMercado.toString():a.getMercadoDefault()});Core.Functions.Validations.toggleValidation(a.ddlMercado,false);new Core.Controls.DecimalPicker(a.txtTipoCambio,{maxDecimalDigitCount:a.decimalCount,showThousandsSeparator:true,defaultValue:""});Core.Functions.Validations.toggleValidation(a.txtTipoCambio,false);a.txtAsesor.val(((a.operacion&&a.operacion.UsernameAsesor)?a.operacion.UsernameAsesor:""));a.txtAsesor.unbind("keyup");a.txtAsesor.on("keyup",function(l){a.searchAsesor()});Core.Functions.Validations.toggleValidation(a.txtAsesor,false);a.btnBuscarAsesor.unbind("click");a.btnBuscarAsesor.on("click",function(){a.divManagerOperacion.swidget().minimized(true);new Core.Controls.MinutaBuscarAsesor({onSelected:function(l){a.asesorSeleccionado=l;a.lblDescripcionAsesor.text(a.asesorSeleccionado.NombreCompleto+" / "+a.asesorSeleccionado.Unidad);a.txtAsesor.val(a.asesorSeleccionado.Username)},onClosed:function(){a.divManagerOperacion.swidget().minimized(false)}}).show()});a.lblDescripcionAsesor.text("Asesor no encontrado");if(a.txtAsesor.val()){a.searchAsesor()}a.setControlsByMode();a.setColorsByTipoOperacion();a.divManagerOperacion.find(".btn-operacion-confirmar").unbind("click");a.divManagerOperacion.find(".btn-operacion-confirmar").click(function(){Core.Functions.Validations.toggleValidation(a.txtDateOperacion,false);Core.Functions.Validations.toggleValidation(a.txtCantidad,false);Core.Functions.Validations.toggleValidation(a.txtPrecio,false);Core.Functions.Validations.toggleValidation(a.txtMonto,false);Core.Functions.Validations.toggleValidation(a.ddlVehiculo,false);Core.Functions.Validations.toggleValidation(a.ddlTipoNegocio,false);Core.Functions.Validations.toggleValidation(a.ddlMercado,false);Core.Functions.Validations.toggleValidation(a.ddlMercado,false);Core.Functions.Validations.toggleValidation(a.ddlTipoOperacion,false);Core.Functions.Validations.toggleValidation(a.ddlMoneda,false);Core.Functions.Validations.toggleValidation(a.txtTipoCambio,false);Core.Functions.Validations.toggleValidation(a.txtAsesor,false);a.divAlert.slideUp();var l=a.getRequestData();if(l==null){return}var m=new Core.Ajax.ServerRequest({overlayElement:a.divManagerOperacion.find(".btn-operacion-confirmar"),showOverlay:true,requestUrl:a.requestUrl,requestType:(a.operacion!=null&&a.operacion.idOperacion!=null)?"PUT":"POST",requestData:l});m.onSuccess=function(n){a.destroy();if(a.onSave){a.onSave()}};m.onError=function(o){var n=(o.responseJSON&&o.responseJSON.Descripcion)?o.responseJSON.Descripcion:"Algunos componentes de la página no se cargaron correctamente. Por favor intente mas tarde...";a.divAlert.text(n);a.divAlert.slideDown()};m.request()});if(a.operacion){a.setMonto()}a.getFechasPlazo(a.overlayElement,function(){a.divManagerOperacion.swidget().visible(true);a.txtDateOperacion.swidget().focus()})};a.destroy=function(){a.txtDateOperacion.swidget().destroy();a.txtDateLiquidacion.swidget().destroy();a.txtObservaciones.swidget().destroy();a.ddlMoneda.swidget().destroy();a.ddlTipoNegocio.swidget().destroy();a.ddlMercado.swidget().destroy();a.ddlVehiculo.swidget().destroy();a.ddlTipoOperacion.swidget().destroy();a.divManagerOperacion.swidget().destroy();Core.Objects.Context.Dialogs.remove(this);if(a.onDestroy!=null){a.onDestroy()}};a.getFechasPlazo=function(d,c){var e=new Core.Ajax.ServerRequest({overlayElement:d,secureRequest:true,requestUrl:"operacionesmonedas/plazos/fechas/"+Core.Functions.Date.getDateAsString(a.txtDateOperacion.swidget().value()),requestType:"GET"});e.onSuccess=function(f){a.fechasPlazos=f.fechas;a.setFechaLiquidacion();if(c){c()}};e.request()};a.setFechaLiquidacion=function(){var d=a.ePlazo.Otro;if(a.chkPlazoT0.swidget().checked()){d=a.ePlazo.T0}else{if(a.chkPlazoT1.swidget().checked()){d=a.ePlazo.T1}else{if(a.chkPlazoT2.swidget().checked()){d=a.ePlazo.T2}}}var c=$.grep(a.fechasPlazos,function(e,g){return e.idPlazo==d})[0];a.txtDateLiquidacion.swidget().enabled(c==null);if(c){a.txtDateLiquidacion.swidget().value(a.getDate(c.Fecha))}};a.getDate=function(c){var d=c.substr(8,2);var e=c.substr(5,2);var g=c.substr(0,4);var f=new Date();f.setDate(1);f.setYear(g);f.setMonth(e-1);f.setDate(d);return f};a.getRequestData=function(){var d={value:true};var c={data:{}};c.data.FechaConcertacion=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtDateOperacion,d));c.data.FechaLiquidacion=a.txtDateLiquidacion.swidget().value()?Core.Functions.Date.getDateAsString(a.txtDateLiquidacion.swidget().value()):null;c.data.idCuenta=Core.Functions.Validations.getValidatedDropDownValue(a.ddlVehiculo,d);c.data.idTipoOperacion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoOperacion,d);c.data.Observaciones=a.txtObservaciones.swidget().value();c.data.Cantidad=Core.Functions.Decimal.parseFloat(a.txtCantidad.val());c.data.idNegocio=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoNegocio,d);c.data.Precio1=Core.Functions.Decimal.parseFloat(a.txtPrecio.val());c.data.Monto=Core.Functions.Decimal.parseFloat(a.txtMonto.val());c.data.idMoneda=Core.Functions.Validations.getValidatedSwidgetValue(a.ddlMoneda,d);c.data.Parking=a.getSelectedParking(d);c.data.idPlazo=a.getSelectedPlazo(d);if(a.ddlVehiculo.swidget().selectedItem().value==Core.Enums.eVehiculo.BCV&&a.pantallaOrigen!=Core.Enums.eManagerOperacionPantallaOrigen.OperacionesUSD){c.data.idMercado=Core.Functions.Validations.getValidatedSwidgetValue(a.ddlMercado,d)}if(a.operacionPadre){c.data.idOperacionPadre=a.operacionPadre.idOperacion}if(a.idPuntaDetalle||(a.operacion&&a.operacion.idPuntaDetalle)){c.data.idPuntaDetalle=(a.operacion)?a.operacion.idPuntaDetalle:a.idPuntaDetalle}if(a.operacion&&a.operacion.idOperacion!=null){c.data.id=a.operacion.idOperacion}if(a.asesorSeleccionado){c.data.idPersonaAsesor=a.asesorSeleccionado.idPersonaAsesor}if(d.value){return c}else{return null}};a.setColorsByTipoOperacion=function(){a.txtCantidad.css("background-color","");a.txtMonto.css("background-color","");if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eMesaTipoOperacion.Compra){a.txtCantidad.css("background-color","rgba(204, 255, 204, 0.9)");a.txtMonto.css("background-color","rgba(255, 204, 204,0.9)")}else{if(a.ddlTipoOperacion.swidget().selectedItem().value==Core.Enums.eMesaTipoOperacion.Venta){a.txtMonto.css("background-color","rgba(204, 255, 204, 0.9)");a.txtCantidad.css("background-color","rgba(255, 204, 204,0.9)")}}};a.setMonto=function(){var c="";c=(Core.Functions.Decimal.parseFloat(a.txtCantidad.val())*Core.Functions.Decimal.parseFloat(a.txtPrecio.val()));a.txtMonto.val(c);a.txtMonto.blur()};a.setPrecio=function(){var c="";c=(Core.Functions.Decimal.parseFloat(a.txtMonto.val())/Core.Functions.Decimal.parseFloat(a.txtCantidad.val()));a.txtPrecio.val(c);a.txtPrecio.blur()};a.setControlsByVehiculoAndEstado=function(){a.divMercado.hide();if(a.pantallaOrigen!=Core.Enums.eManagerOperacionPantallaOrigen.OperacionesUSD){if(a.ddlVehiculo.swidget().selectedItem().value==Core.Enums.eVehiculo.BCV){a.divMercado.show()}}};a.setControlsByMode=function(){a.divContraparte.hide();a.divMonto2.hide();a.divCantidad2.hide();a.divTicker.hide();a.divConcepto.hide();a.divSaldosIgnorados.hide();a.divPrecio2.hide();a.divTipoInstrumento.hide();a.divTipoNegocio.hide();a.divEstado.hide();a.divNominalesLiquidados.hide();a.divMontoLiquidado.hide();a.divMontoPendiente.hide();a.divPrecioReferencia.hide();a.divTipoContraparte.hide();a.divControlsComitente.hide();a.divTipoCambio.hide();a.divDateLiquidacionReal.hide();a.divIdUsd.hide();a.divUsd.hide();a.divComitenteOperatoria.hide();a.divMoneda.addClass("col-lg-6");a.divMoneda.addClass("col-md-6");a.divMoneda.removeClass("col-lg-12");a.divMoneda.removeClass("col-md-12");a.setControlsByVehiculoAndEstado()};a.getVehiculoDefault=function(){if(a.opcionesDefault==Core.Enums.eMesaOperacionOpcionesDefault.NA||a.opcionesDefault==Core.Enums.eMesaOperacionOpcionesDefault.BYMA||a.opcionesDefault==Core.Enums.eMesaOperacionOpcionesDefault.MAE){return Core.Enums.eVehiculo.BCV.toString()}else{if(a.opcionesDefault==Core.Enums.eMesaOperacionOpcionesDefault.Exterior){return Core.Enums.eVehiculo.BCI.toString()}else{if(a.opcionesDefault==Core.Enums.eMesaOperacionOpcionesDefault.Nueva){return Core.Enums.eVehiculo.BCV.toString()}}}};a.getMercadoDefault=function(){if(a.opcionesDefault==Core.Enums.eMesaOperacionOpcionesDefault.BYMA){return a.eMercado.Byma.toString()}else{if(a.opcionesDefault==Core.Enums.eMesaOperacionOpcionesDefault.MAE){return a.eMercado.Mae.toString()}else{return""}}};a.getSelectedParking=function(c){if(a.chkParkingSinSeleccion.swidget().checked()){return a.eParking.SinSeleccion}else{if(a.chkParkingSi.swidget().checked()){return a.eParking.Si}else{if(a.chkParkingNo.swidget().checked()){return a.eParking.No}else{c.value=false;a.divAlert.text("Debe seleccionar el parking.");a.divAlert.slideDown()}}}};a.getSelectedPlazo=function(c){if(a.chkPlazoT0.swidget().checked()){return a.ePlazo.T0}else{if(a.chkPlazoT1.swidget().checked()){return a.ePlazo.T1}else{if(a.chkPlazoT2.swidget().checked()){return a.ePlazo.T2}else{if(a.chkPlazoOtro.swidget().checked()){return a.ePlazo.Otro}else{c.value=false;a.divAlert.text("Debe seleccionar el plazo.");a.divAlert.slideDown()}}}}};a.searchAsesor=function(){if(a.txtAsesor.val()&&a.txtAsesor.val().length>=4){var c=new Core.Ajax.ServerRequest({showOverlay:false,secureRequest:true,requestUrl:"minutas/version2/asesores/"+a.txtAsesor.val(),requestType:"GET"});c.onSuccess=function(e){var d=null;e.asesores.forEach(function(g,f){if(g.Username==a.txtAsesor.val()){d=g}});if(d){a.asesorSeleccionado=d;a.lblDescripcionAsesor.text(a.asesorSeleccionado.NombreCompleto+" / "+a.asesorSeleccionado.Unidad)}else{a.asesorSeleccionado=null;a.lblDescripcionAsesor.text("Asesor no encontrado")}};c.request()}else{a.asesorSeleccionado=null;a.lblDescripcionAsesor.text("Asesor no encontrado")}}};Core.Controls.ManagerPersona=function(b){var a=this;a.persona=null;a.dataParametros=null;a.dataParametrosUsuario=null;a.onSave=function(c){};a.onClose=function(){};a.container=null;a.idTipoValidacion=0;a.idAperturaCuenta=0;a.readOnly=false;a.optionsApertura=false;a.namespaceActivo="";a.divMatrizRiesgo=null;a.esCuentaJuridica=true;a.defaultPersonaExpuestaDenominacion="";a.defaultPersonaExpuestaCuit="";$.extend(true,a,b);a.phoneCodeAr=$.grep(Core.Objects.Contry,function(d,c){return d.iso_code=="AR"})[0].phone_code;a.idPais_Argentina=1;a.title=null;a.divInformes=null;a.divTipo=null;a.ddlTipo=null;a.divNombre=null;a.txtNombre=null;a.divApellido=null;a.txtApellido=null;a.divTipoDocumento=null;a.ddlTipoDocumento=null;a.divDocumento=null;a.txtDocumento=null;a.divPaisEmisionPasaporte=null;a.ddlPaisEmisionPasaporte=null;a.divFechaVencimientoPasaporte=null;a.txtFechaVencimientoPasaporte=null;a.divNacionalidad=null;a.ddlNacionalidad=null;a.divPaisIdentificacionFiscal=null;a.ddlPaisIdentificacionFiscal=null;a.divTipoIdentificacionFiscal=null;a.ddlTipoIdentificacionFiscal=null;a.divIdentificacionFiscal=null;a.txtIdentificacionFiscal=null;a.divCiudadaniaEeuu=null;a.chkCiudadaniaEeuuSi=null;a.chkCiudadaniaEeuuNo=null;a.divMatchCara=null;a.chkMatchCara=null;a.divFechaNacimiento=null;a.txtFechaNacimiento=null;a.divLugarNacimiento=null;a.txtLugarNacimiento=null;a.divDomicilioRealCalle=null;a.txtDomicilioRealCalle=null;a.divDomicilioRealNumero=null;a.txtDomicilioRealNumero=null;a.divDomicilioRealPiso=null;a.txtDomicilioRealPiso=null;a.divDomicilioRealDepartamento=null;a.txtDomicilioRealDepartamento=null;a.divDomicilioRealLocalidad=null;a.txtDomicilioRealLocalidad=null;a.divDomicilioRealPais=null;a.ddlDomicilioRealPais=null;a.divDomicilioRealProvincia=null;a.ddlDomicilioRealProvincia=null;a.divDomicilioRealCodigoPostal=null;a.txtDomicilioRealCodigoPostal=null;a.divDomicilioLaboral=null;a.divDomicilioLaboralCalle=null;a.txtDomicilioLaboralCalle=null;a.divDomicilioLaboralNumero=null;a.txtDomicilioLaboralNumero=null;a.divDomicilioLaboralPiso=null;a.txtDomicilioLaboralPiso=null;a.divDomicilioLaboralDepartamento=null;a.txtDomicilioLaboralDepartamento=null;a.divDomicilioLaboralLocalidad=null;a.txtDomicilioLaboralLocalidad=null;a.divDomicilioLaboralPais=null;a.ddlDomicilioLaboralPais=null;a.divDomicilioLaboralProvincia=null;a.ddlDomicilioLaboralProvincia=null;a.divDomicilioLaboralCodigoPostal=null;a.txtDomicilioLaboralCodigoPostal=null;a.divTelefonoParticularArea=null;a.txtTelefonoParticularArea=null;a.divTelefonoParticularNumero=null;a.txtTelefonoParticularNumero=null;a.divTelefonoCelularPais=null;a.ddlTelefonoCelularPais=null;a.divTelefonoCelularArea=null;a.txtTelefonoCelularArea=null;a.divTelefonoCelularNumero=null;a.txtTelefonoCelularNumero=null;a.divTelefonoLaboral=null;a.divTelefonoLaboralArea=null;a.txtTelefonoLaboralArea=null;a.divTelefonoLaboralNumero=null;a.txtTelefonoLaboralNumero=null;a.divOcupacionDescripcion=null;a.txtOcupacionDescripcion=null;a.divOcupacionDescripcionPersonaJuridica=null;a.txtOcupacionDescripcionPersonaJuridica=null;a.divEmpresaLaboral=null;a.txtEmpresaLaboral=null;a.divActividadEmpresa=null;a.txtActividadEmpresa=null;a.divCargoLaboral=null;a.txtCargoLaboral=null;a.divVencimientoCargoLaboral=null;a.txtVencimientoCargoLaboral=null;a.divEmail=null;a.txtEmail=null;a.divSexo=null;a.ddlSexo=null;a.divCondicionIva=null;a.ddlCondicionIva=null;a.divInscripcionGanancias=null;a.chkInscripcionGanancias=null;a.chkTributaEnOtroPaisSi=null;a.chkTributaEnOtroPaisNo=null;a.divPaisTributo=null;a.ddlPaisTributo=null;a.divMontoCompliance=null;a.controlMontoCompliance=null;a.txtMontoCompliance=null;a.ddlRiesgoCliente=null;a.divNitTipoIdentificacionFiscal=null;a.ddlNitTipoIdentificacionFiscal=null;a.divNit=null;a.txtNit=null;a.divEstadoCivil=null;a.ddlEstadoCivil=null;a.divOcupacionPersonaJuridica=null;a.ddlOcupacionPersonaJuridica=null;a.divOcupacion=null;a.ddlOcupacion=null;a.divPersonaExpuesta=null;a.chkPersonaExpuestaSi=null;a.chkPersonaExpuestaNo=null;a.divSujetoObligado=null;a.chkSujetoObligado=null;a.divDatosLaboral=null;a.divDatosConyuge=null;a.divDatosPersonaExpuesta=null;a.divConyugeNombre=null;a.txtConyugeNombre=null;a.divConyugeApellido=null;a.txtConyugeApellido=null;a.divConyugeTipoDocumento=null;a.ddlConyugeTipoDocumento=null;a.divConyugeDocumento=null;a.txtConyugeDocumento=null;a.chkPersonaExpuestaDirectamente=null;a.chkPersonaExpuestaIndirectamente=null;a.divPersonaExpuestaIndirectamente=null;a.txtPersonaExpuestaIndirectamente=null;a.divPersonaExpuestaCargo=null;a.txtPersonaExpuestaCargo=null;a.divPersonaExpuestaAutoridad=null;a.txtPersonaExpuestaAutoridad=null;a.divPersonaExpuestaCaracterInvocado=null;a.ddlPersonaExpuestaCaracterInvocado=null;a.divPersonaExpuestaDenominacion=null;a.lblPersonaExpuestaDenominacion=null;a.txtPersonaExpuestaDenominacion=null;a.divPersonaExpuestaCuit=null;a.lblPersonaExpuestaCuit=null;a.txtPersonaExpuestaCuit=null;a.divPersonaExpuestaObservaciones=null;a.txtPersonaExpuestaObservaciones=null;a.anchorFrenteDni=null;a.imgFrenteDni=null;a.anchorDorsoDni=null;a.imgDorsoDni=null;a.anchorFotoCliente=null;a.imgFotoCliente=null;a.divAlert=null;a.divCalcularMatrizRiesgo=null;a.btnCalcularMatrizRiesgo=null;a.btnConsultarMatrizRiesgo=null;a.btnVolver=null;a.btnConfirmarYCerrar=null;a.show=function(){$("html, body").animate({scrollTop:$(".cuenta").offset().top},1000);a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu("matrizDeRiesgo",Core.Objects.Context.Profiles[0]);a.container.html("");a.container.load("/Pages/manager-persona.html",function(s,t,z){if(t=="success"){a.container.show();a.divMatrizRiesgo.hide();a.title=a.container.find(".title-manager");a.title.text((a.persona)?"Alta Cuenta / Editar Persona":"Alta Cuenta / Nueva Persona");a.divInformes=a.container.find(".div-persona-informes");a.divDatosLaboral=a.container.find(".div-datos-laboral");a.divDatosConyuge=a.container.find(".div-datos-conyuge");a.divDatosPersonaExpuesta=a.container.find(".div-datos-persona-expuesta");a.divTipo=a.container.find(".div-tipo");a.ddlTipo=a.container.find(".dropdown-tipo");a.divNombre=a.container.find(".div-nombre");a.txtNombre=a.container.find(".textbox-nombre");a.divApellido=a.container.find(".div-apellido");a.txtApellido=a.container.find(".textbox-apellido");a.divTipoDocumento=a.container.find(".div-tipo-documento");a.ddlTipoDocumento=a.container.find(".dropdown-tipo-documento");a.divDocumento=a.container.find(".div-documento");a.txtDocumento=a.container.find(".textbox-documento");a.divPaisEmisionPasaporte=a.container.find(".div-pais-emision-pasaporte");a.ddlPaisEmisionPasaporte=a.container.find(".dropdown-pais-emision-pasaporte");a.divFechaVencimientoPasaporte=a.container.find(".div-fecha-vencimiento-pasaporte");a.txtFechaVencimientoPasaporte=a.container.find(".date-picker-fecha-vencimiento-pasaporte");a.divNacionalidad=a.container.find(".div-nacionalidad");a.ddlNacionalidad=a.container.find(".dropdown-nacionalidad");a.divPaisIdentificacionFiscal=a.container.find(".div-pais-identificacion-fiscal");a.ddlPaisIdentificacionFiscal=a.container.find(".dropdown-pais-identificacion-fiscal");a.divTipoIdentificacionFiscal=a.container.find(".div-tipo-identificacion-fiscal");a.ddlTipoIdentificacionFiscal=a.container.find(".dropdown-tipo-identificacion-fiscal");a.divIdentificacionFiscal=a.container.find(".div-identificacion-fiscal");a.txtIdentificacionFiscal=a.container.find(".textbox-identificacion-fiscal");a.divCiudadaniaEeuu=a.container.find(".div-ciudadania-eeuu");a.chkCiudadaniaEeuuSi=a.container.find(".chk-ciudadania-eeuu-si");a.chkCiudadaniaEeuuNo=a.container.find(".chk-ciudadania-eeuu-no");a.divMatchCara=a.container.find(".div-match-cara");a.chkMatchCara=a.container.find(".checkbox-match-cara");a.divFechaNacimiento=a.container.find(".div-fecha-nacimiento");a.txtFechaNacimiento=a.container.find(".date-picker-fecha-nacimiento");a.divLugarNacimiento=a.container.find(".div-lugar-nacimiento");a.txtLugarNacimiento=a.container.find(".textbox-lugar-nacimiento");a.divDomicilioRealCalle=a.container.find(".div-domicilio-real-calle");a.txtDomicilioRealCalle=a.container.find(".textbox-domicilio-real-calle");a.divDomicilioRealNumero=a.container.find(".div-domicilio-real-numero");a.txtDomicilioRealNumero=a.container.find(".textbox-domicilio-real-numero");a.divDomicilioRealPiso=a.container.find(".div-domicilio-real-piso");a.txtDomicilioRealPiso=a.container.find(".textbox-domicilio-real-piso");a.divDomicilioRealDepartamento=a.container.find(".div-domicilio-real-departamento");a.txtDomicilioRealDepartamento=a.container.find(".textbox-domicilio-real-departamento");a.divDomicilioRealLocalidad=a.container.find(".div-domicilio-real-localidad");a.txtDomicilioRealLocalidad=a.container.find(".textbox-domicilio-real-localidad");a.divDomicilioRealPais=a.container.find(".div-domicilio-real-pais");a.ddlDomicilioRealPais=a.container.find(".dropdown-domicilio-real-pais");a.divDomicilioRealProvincia=a.container.find(".div-domicilio-real-provincia");a.ddlDomicilioRealProvincia=a.container.find(".dropdown-domicilio-real-provincia");a.divDomicilioRealCodigoPostal=a.container.find(".div-domicilio-real-codigo-postal");a.txtDomicilioRealCodigoPostal=a.container.find(".textbox-domicilio-real-codigo-postal");a.divDomicilioLaboral=a.container.find(".div-domicilio-laboral");a.divDomicilioLaboralCalle=a.container.find(".div-domicilio-laboral-calle");a.txtDomicilioLaboralCalle=a.container.find(".textbox-domicilio-laboral-calle");a.divDomicilioLaboralNumero=a.container.find(".div-domicilio-laboral-numero");a.txtDomicilioLaboralNumero=a.container.find(".textbox-domicilio-laboral-numero");a.divDomicilioLaboralPiso=a.container.find(".div-domicilio-laboral-piso");a.txtDomicilioLaboralPiso=a.container.find(".textbox-domicilio-laboral-piso");a.divDomicilioLaboralDepartamento=a.container.find(".div-domicilio-laboral-departamento");a.txtDomicilioLaboralDepartamento=a.container.find(".textbox-domicilio-laboral-departamento");a.divDomicilioLaboralLocalidad=a.container.find(".div-domicilio-laboral-localidad");a.txtDomicilioLaboralLocalidad=a.container.find(".textbox-domicilio-laboral-localidad");a.divDomicilioLaboralPais=a.container.find(".div-domicilio-laboral-pais");a.ddlDomicilioLaboralPais=a.container.find(".dropdown-domicilio-laboral-pais");a.divDomicilioLaboralProvincia=a.container.find(".div-domicilio-laboral-provincia");a.ddlDomicilioLaboralProvincia=a.container.find(".dropdown-domicilio-laboral-provincia");a.divDomicilioLaboralCodigoPostal=a.container.find(".div-domicilio-laboral-codigo-postal");a.txtDomicilioLaboralCodigoPostal=a.container.find(".textbox-domicilio-laboral-codigo-postal");a.divTelefonoParticularArea=a.container.find(".div-telefono-particular-area");a.txtTelefonoParticularArea=a.container.find(".textbox-telefono-particular-area");a.divTelefonoParticularNumero=a.container.find(".div-telefono-particular-numero");a.txtTelefonoParticularNumero=a.container.find(".textbox-telefono-particular-numero");a.divTelefonoCelularPais=a.container.find(".div-telefono-celular-pais");a.ddlTelefonoCelularPais=a.container.find(".dropdown-telefono-celular-pais");a.divTelefonoCelularArea=a.container.find(".div-telefono-celular-area");a.txtTelefonoCelularArea=a.container.find(".textbox-telefono-celular-area");a.divTelefonoCelularNumero=a.container.find(".div-telefono-celular-numero");a.txtTelefonoCelularNumero=a.container.find(".textbox-telefono-celular-numero");a.divTelefonoLaboral=a.container.find(".div-telefono-laboral");a.divTelefonoLaboralArea=a.container.find(".div-telefono-laboral-area");a.txtTelefonoLaboralArea=a.container.find(".textbox-telefono-laboral-area");a.divTelefonoLaboralNumero=a.container.find(".div-telefono-laboral-numero");a.txtTelefonoLaboralNumero=a.container.find(".textbox-telefono-laboral-numero");a.divCargoLaboral=a.container.find(".div-cargo-laboral");a.txtCargoLaboral=a.container.find(".textbox-cargo-laboral");a.divVencimientoCargoLaboral=a.container.find(".div-vencimiento-cargo-laboral");a.txtVencimientoCargoLaboral=a.container.find(".date-picker-vencimiento-cargo-laboral");a.divEmpresaLaboral=a.container.find(".div-empresa-laboral");a.txtEmpresaLaboral=a.container.find(".textbox-empresa-laboral");a.divActividadEmpresa=a.container.find(".div-actividad-empresa");a.txtActividadEmpresa=a.container.find(".textbox-actividad-empresa");a.divOcupacionDescripcion=a.container.find(".div-ocupacion-descripcion");a.txtOcupacionDescripcion=a.container.find(".textbox-ocupacion-descripcion");a.divOcupacionDescripcionPersonaJuridica=a.container.find(".div-ocupacion-descripcion-persona-juridica");a.txtOcupacionDescripcionPersonaJuridica=a.container.find(".textbox-ocupacion-descripcion-persona-juridica");a.divEmail=a.container.find(".div-email");a.txtEmail=a.container.find(".textbox-email");a.divSexo=a.container.find(".div-sexo");a.ddlSexo=a.container.find(".dropdown-sexo");a.divCondicionIva=a.container.find(".div-condicion-iva");a.ddlCondicionIva=a.container.find(".dropdown-condicion-iva");a.divInscripcionGanancias=a.container.find(".div-inscripcion-ganancias");a.divTributaEnOtroPais=a.container.find(".div-tributas-otro-pais");a.chkTributaEnOtroPaisSi=a.container.find(".chk-tributas-otro-pais-si");a.chkTributaEnOtroPaisNo=a.container.find(".chk-tributas-otro-pais-no");a.divPaisTributo=a.container.find(".div-pais-tributo");a.ddlPaisTributo=a.container.find(".dropdown-pais-tributo");a.divNitTipoIdentificacionFiscal=a.container.find(".div-nit-tipo-identificacion-fiscal");a.ddlNitTipoIdentificacionFiscal=a.container.find(".dropdown-nit-tipo-identificacion-fiscal");a.divNit=a.container.find(".div-nit");a.txtNit=a.container.find(".textbox-nit");a.divMontoCompliance=a.container.find(".div-monto-compliance");a.txtMontoCompliance=a.container.find(".textbox-monto-compliance");a.controlMontoCompliance=null;a.ddlRiesgoCliente=a.container.find(".dropdown-riesgo-cliente");a.chkInscripcionGanancias=a.container.find(".checkbox-inscripcion-ganancias");a.divEstadoCivil=a.container.find(".div-estado-civil");a.ddlEstadoCivil=a.container.find(".dropdown-estado-civil");a.divOcupacion=a.container.find(".div-ocupacion");a.ddlOcupacion=a.container.find(".dropdown-ocupacion");a.divOcupacionPersonaJuridica=a.container.find(".div-ocupacion-persona-juridica");a.ddlOcupacionPersonaJuridica=a.container.find(".dropdown-ocupacion-persona-juridica");a.divPersonaExpuesta=a.container.find(".div-persona-expuesta");a.chkPersonaExpuestaSi=a.container.find(".chk-persona-expuesta-si");a.chkPersonaExpuestaNo=a.container.find(".chk-persona-expuesta-no");a.divSujetoObligado=a.container.find(".div-sujeto-obligado");a.chkSujetoObligado=a.container.find(".checkbox-sujeto-obligado");a.divConyugeNombre=a.container.find(".div-conyuge-nombre");a.txtConyugeNombre=a.container.find(".textbox-conyuge-nombre");a.divConyugeApellido=a.container.find(".div-conyuge-apellido");a.txtConyugeApellido=a.container.find(".textbox-conyuge-apellido");a.divConyugeTipoDocumento=a.container.find(".div-conyuge-tipo-documento");a.ddlConyugeTipoDocumento=a.container.find(".dropdown-conyuge-tipo-documento");a.divConyugeDocumento=a.container.find(".div-conyuge-documento");a.txtConyugeDocumento=a.container.find(".textbox-conyuge-documento");a.chkPersonaExpuestaDirectamente=a.container.find(".chk-persona-expuesta-directamente");a.chkPersonaExpuestaIndirectamente=a.container.find(".chk-persona-expuesta-indirectamente");a.divPersonaExpuestaIndirectamente=a.container.find(".div-persona-expuesta-indirectamente");a.txtPersonaExpuestaIndirectamente=a.container.find(".textbox-persona-expuesta-indirectamente");a.divPersonaExpuestaCargo=a.container.find(".div-persona-expuesta-cargo");a.txtPersonaExpuestaCargo=a.container.find(".textbox-persona-expuesta-cargo");a.divPersonaExpuestaAutoridad=a.container.find(".div-persona-expuesta-autoridad");a.txtPersonaExpuestaAutoridad=a.container.find(".textbox-persona-expuesta-autoridad");a.divPersonaExpuestaCaracterInvocado=a.container.find(".div-persona-expuesta-caracter-invocado");a.ddlPersonaExpuestaCaracterInvocado=a.container.find(".dropdown-persona-expuesta-caracter-invocado");a.divPersonaExpuestaDenominacion=a.container.find(".div-persona-expuesta-denominacion");a.lblPersonaExpuestaDenominacion=a.container.find(".lbl-persona-expuesta-denominacion");a.txtPersonaExpuestaDenominacion=a.container.find(".textbox-persona-expuesta-denominacion");a.divPersonaExpuestaCuit=a.container.find(".div-persona-expuesta-cuit");a.lblPersonaExpuestaCuit=a.container.find(".lbl-persona-expuesta-cuit");a.txtPersonaExpuestaCuit=a.container.find(".textbox-persona-expuesta-cuit");a.divPersonaExpuestaObservaciones=a.container.find(".div-persona-expuesta-observaciones");a.txtPersonaExpuestaObservaciones=a.container.find(".textbox-persona-expuesta-observaciones");a.divImagenes=a.container.find(".div-persona-imagenes");a.anchorFrenteDni=a.container.find(".anchor-frente-dni");a.imgFrenteDni=a.container.find(".img-frente-dni");a.anchorDorsoDni=a.container.find(".anchor-dorso-dni");a.imgDorsoDni=a.container.find(".img-dorso-dni");a.anchorFotoCliente=a.container.find(".anchor-foto-cliente");a.imgFotoCliente=a.container.find(".img-foto-cliente");a.divAlert=a.container.find(".div-alert");a.btnCalcularMatrizRiesgo=a.container.find(".btn-calcular-matriz-riesgo");a.btnConsultarMatrizRiesgo=a.container.find(".btn-consultar-matriz-riesgo");a.divCalcularMatrizRiesgo=a.container.find(".div-calcular-matriz-riesgo");a.btnVolver=a.container.find(".btn-volver-persona");a.btnConfirmarYCerrar=a.container.find(".btn-confirmar-cerrar");a.divAlert.slideUp();var y=$.grep(a.dataParametros.TiposCondoministas,function(B,A){return a.esCuentaJuridica?B.Juridica:B.Fisica});if(!a.esCuentaJuridica&&!a.persona&&a.namespaceActivo!="Legajos"){y=$.grep(y,function(B,A){return B.idTipoCondominista==Core.Business.eTipoPersonaCuenta.Titular})}a.ddlTipo.shieldDropDown({dataSource:{data:y},valueTemplate:"{idTipoCondominista}",textTemplate:"{Descripcion}",value:(a.persona&&a.persona.tipo!=null)?a.persona.tipo.toString():"",enabled:(a.esCuentaJuridica||!a.persona),events:{select:function(A){a.setControls()},blur:function(A){if(a.ddlTipo.swidget().selectedItem()==null){a.ddlTipo.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlTipo,false);a.txtNombre.shieldTextBox({value:(a.persona&&a.persona.nombre!=null)?a.persona.nombre:""});Core.Functions.Validations.toggleValidation(a.txtNombre,false);a.txtApellido.shieldTextBox({value:(a.persona&&a.persona.apellido!=null)?a.persona.apellido:""});Core.Functions.Validations.toggleValidation(a.txtApellido,false);a.ddlTipoDocumento.shieldDropDown({dataSource:{data:a.dataParametros.tiposDocumentos},valueTemplate:"{idTipoDocumento}",textTemplate:"{Descripcion}",value:(a.persona&&a.persona.idTipoDocumento!=null)?a.persona.idTipoDocumento.toString():"",events:{select:function(A){a.setControls()},blur:function(A){if(a.ddlTipoDocumento.swidget().selectedItem()==null){a.ddlTipoDocumento.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlTipoDocumento,false);a.txtDocumento.shieldTextBox({value:(a.persona&&a.persona.documento!=null)?a.persona.documento:""});Core.Functions.Validations.toggleValidation(a.txtDocumento,false);a.ddlPaisEmisionPasaporte.shieldComboBox({dataSource:{data:a.dataParametros.paises},valueTemplate:"{idPais}",textTemplate:"{Nombre}",value:(a.persona&&a.persona.idPaisEmisionPasaporte)?a.persona.idPaisEmisionPasaporte.toString():"",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{blur:function(A){if(a.ddlPaisEmisionPasaporte.swidget().selectedItem()==null){a.ddlPaisEmisionPasaporte.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlPaisEmisionPasaporte,false);a.txtFechaVencimientoPasaporte.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.persona&&a.persona.FechaVencimientoPasaporte!=null)?a.getDate(a.persona.FechaVencimientoPasaporte):new Date(),});Core.Functions.Validations.toggleValidation(a.txtFechaVencimientoPasaporte,false);a.ddlNacionalidad.shieldComboBox({dataSource:{data:a.dataParametros.paises},valueTemplate:"{idPais}",textTemplate:"{Nombre}",value:(a.persona&&a.persona.nacionalidad)?a.persona.nacionalidad.toString():"",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{blur:function(A){if(a.ddlNacionalidad.swidget().selectedItem()==null){a.ddlNacionalidad.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlNacionalidad,false);var x=(a.persona&&a.persona.nitidTipoIdentificadorFiscal!=null)?$.grep(a.dataParametros.tiposIdentificadoresFiscales,function(B,A){return B.idTipoIdentificadorFiscal==a.persona.nitidTipoIdentificadorFiscal})[0]:null;a.ddlPaisTributo.shieldComboBox({dataSource:{data:a.dataParametros.paises},valueTemplate:"{idPais}",textTemplate:"{Nombre}",value:(x)?x.idPais.toString():"",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{select:function(A){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.ddlPaisTributo,false);a.ddlNitTipoIdentificacionFiscal.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idTipoIdentificadorFiscal}",textTemplate:"{Descripcion}",value:(x)?x.idTipoIdentificadorFiscal.toString():"",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""}]}}});Core.Functions.Validations.toggleValidation(a.ddlNitTipoIdentificacionFiscal,false);a.txtNit.shieldTextBox({value:(a.persona&&a.persona.nit!=null)?a.persona.nit:""});Core.Functions.Validations.toggleValidation(a.txtNit,false);a.controlMontoCompliance=new Core.Controls.DecimalPicker(a.txtMontoCompliance,{maxDecimalDigitCount:2,showThousandsSeparator:false});Core.Functions.Validations.toggleValidation(a.txtMontoCompliance,false);a.controlMontoCompliance.setValue((a.persona&&a.persona.montoCompliance!=null)?a.persona.montoCompliance:"");a.ddlRiesgoCliente.shieldDropDown({dataSource:{data:a.dataParametrosUsuario.riesgo},valueTemplate:"{idRiesgo}",textTemplate:"{RiesgoDescripcion}"});a.ddlRiesgoCliente.swidget().value((a.persona&&a.persona.idRiesgo)?a.persona.idRiesgo.toString():"");Core.Functions.Validations.toggleValidation(a.ddlRiesgoCliente,false);if(!a.chkCiudadaniaEeuuSi.swidget()){a.chkCiudadaniaEeuuSi.shieldRadioButton({label:"Si"})}var q=a.chkCiudadaniaEeuuSi.swidget().initialOptions;q.checked=((a.persona&&a.persona.esCiudadanoEstadounidiense==1)?true:false);a.chkCiudadaniaEeuuSi.swidget().refresh(q);Core.Functions.Validations.toggleValidation(a.chkCiudadaniaEeuuSi,false);if(!a.chkCiudadaniaEeuuNo.swidget()){a.chkCiudadaniaEeuuNo.shieldRadioButton({label:"No"})}var p=a.chkCiudadaniaEeuuNo.swidget().initialOptions;p.checked=((a.persona&&a.persona.esCiudadanoEstadounidiense==0)?true:false);a.chkCiudadaniaEeuuNo.swidget().refresh(p);Core.Functions.Validations.toggleValidation(a.chkCiudadaniaEeuuNo,false);a.chkMatchCara.shieldCheckBox({label:"Aceptar Match de Cara",enabled:((a.optionsApertura&&a.optionsApertura.matchCaraManual)?true:false),events:{click:function(A){if(a.chkMatchCara.swidget().checked()){new Core.Controls.Confirmation("Confirmación","Al checkear esta opción se esta aceptando la responsabilidad que la foto de la persona coincide con la foto del Documento provisto. Esta seguro?",{onCanceled:function(){a.chkMatchCara.swidget().checked(false)}}).show()}}}});a.chkMatchCara.swidget().checked(((a.persona&&a.persona.matcheoCaraManual==1)?true:false));Core.Functions.Validations.toggleValidation(a.chkMatchCara,false);a.txtFechaNacimiento.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.persona&&a.persona.fechaNacimiento!=null)?a.getDate(a.persona.fechaNacimiento):new Date(),max:new Date()});Core.Functions.Validations.toggleValidation(a.txtFechaNacimiento,false);var c=new Date();var m=new Date(c.getFullYear()+100,11,31);a.txtVencimientoCargoLaboral.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],min:c,max:m,value:(a.persona&&a.persona.fechaVencimientoMandato!=null)?a.getDate(a.persona.fechaVencimientoMandato):new Date()});Core.Functions.Validations.toggleValidation(a.txtVencimientoCargoLaboral,false);a.txtLugarNacimiento.shieldTextBox({value:(a.persona&&a.persona.lugarNacimiento!=null)?a.persona.lugarNacimiento:""});Core.Functions.Validations.toggleValidation(a.txtLugarNacimiento,false);a.txtDomicilioRealCalle.shieldTextBox({value:(a.persona&&a.persona.domicilioParticularCalle!=null)?a.persona.domicilioParticularCalle:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioRealCalle,false);a.txtDomicilioRealNumero.shieldTextBox({value:(a.persona&&a.persona.domicilioParticularNumero!=null)?a.persona.domicilioParticularNumero:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioRealNumero,false);a.txtDomicilioRealPiso.shieldTextBox({value:(a.persona&&a.persona.domicilioParticularPiso!=null)?a.persona.domicilioParticularPiso:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioRealPiso,false);a.txtDomicilioRealDepartamento.shieldTextBox({value:(a.persona&&a.persona.domicilioParticularDepartamento!=null)?a.persona.domicilioParticularDepartamento:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioRealDepartamento,false);a.txtDomicilioRealLocalidad.shieldTextBox({value:(a.persona&&a.persona.domicilioParticularCiudad!=null)?a.persona.domicilioParticularCiudad:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioRealLocalidad,false);a.ddlDomicilioRealPais.shieldComboBox({dataSource:{data:a.dataParametros.paises},valueTemplate:"{idPais}",textTemplate:"{Nombre}",value:(a.persona&&a.persona.domicilioParticularidPais!=null)?a.persona.domicilioParticularidPais.toString():"1",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{select:function(A){a.setControls()},blur:function(A){if(a.ddlDomicilioRealPais.swidget().selectedItem()==null){a.ddlDomicilioRealPais.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlDomicilioRealPais,false);a.ddlDomicilioRealProvincia.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idProvincia}",textTemplate:"{Nombre}",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{blur:function(A){if(a.ddlDomicilioRealProvincia.swidget().selectedItem()==null){a.ddlDomicilioRealProvincia.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlDomicilioRealProvincia,false);a.txtDomicilioRealCodigoPostal.shieldTextBox({value:(a.persona&&a.persona.domicilioParticularCodigoPostal!=null)?a.persona.domicilioParticularCodigoPostal:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioRealCodigoPostal,false);var w=(a.persona&&a.persona.domicilioParticularTelefonoFijo!=null)?a.persona.domicilioParticularTelefonoFijo.split("-"):[];a.txtTelefonoParticularArea.shieldTextBox({value:(w.length>1)?w[0]:""});Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularArea,false);a.txtTelefonoParticularNumero.shieldTextBox({value:(w.length>1)?w[1]:((w.length==1)?w[0]:"")});Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularNumero,false);var r=[];Core.Objects.Contry.forEach(function(A){r.push({value:A.phone_code,text:"(+"+A.phone_code+") "+A.name})});var u=(a.persona&&a.persona.domicilioParticularTelefonoMovil)?a.persona.domicilioParticularTelefonoMovil.split("-"):[];a.ddlTelefonoCelularPais.shieldDropDown({dataSource:{data:r},valueTemplate:"{value}",textTemplate:"{text}",value:(u.length>0)?u[0].replaceAll("\\+",""):a.phoneCodeAr.toString(),events:{select:function(A){a.setTelefonoCelularControls()},blur:function(A){if(a.ddlTelefonoCelularPais.swidget().selectedItem()==null){a.ddlTelefonoCelularPais.swidget().value(null)}}}});a.setTelefonoCelularControls();a.txtTelefonoCelularArea.shieldTextBox({value:(u.length==3)?u[1]:""});Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularArea,false);a.txtTelefonoCelularNumero.shieldTextBox({value:(u.length==3)?u[2]:((u.length==2)?u[1]:"")});Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularNumero,false);a.txtEmail.shieldTextBox({value:(a.persona&&a.persona.email!=null)?a.persona.email:""});Core.Functions.Validations.toggleValidation(a.txtEmail,false);a.txtCargoLaboral.shieldTextBox({value:(a.persona&&a.persona.cargo!=null)?a.persona.cargo:""});Core.Functions.Validations.toggleValidation(a.txtCargoLaboral,false);a.txtEmpresaLaboral.shieldTextBox({value:(a.persona&&a.persona.empresa!=null)?a.persona.empresa:""});Core.Functions.Validations.toggleValidation(a.txtEmpresaLaboral,false);a.txtActividadEmpresa.shieldTextBox({value:(a.persona&&a.persona.EmpresaActividad!=null)?a.persona.EmpresaActividad:""});Core.Functions.Validations.toggleValidation(a.txtActividadEmpresa,false);a.txtOcupacionDescripcion.shieldTextBox({value:(a.persona&&a.persona.OcupacionDescripcion!=null)?a.persona.OcupacionDescripcion:""});Core.Functions.Validations.toggleValidation(a.txtOcupacionDescripcion,false);a.txtOcupacionDescripcionPersonaJuridica.shieldTextBox({value:(a.persona&&a.persona.OcupacionDescripcion!=null)?a.persona.OcupacionDescripcion:""});Core.Functions.Validations.toggleValidation(a.txtOcupacionDescripcionPersonaJuridica,false);a.ddlSexo.shieldDropDown({dataSource:{data:[{value:Core.Business.eGenero.Masculino,text:"Masculino"},{value:Core.Business.eGenero.Femenino,text:"Femenino"}]},valueTemplate:"{value}",textTemplate:"{text}",value:(a.persona&&a.persona.sexo!=null)?a.persona.sexo.toString():"",events:{blur:function(A){if(a.ddlSexo.swidget().selectedItem()==null){a.ddlSexo.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlSexo,false);var x=(a.persona&&a.persona.idTipoIdentificadorFiscal!=null)?$.grep(a.dataParametros.tiposIdentificadoresFiscales,function(B,A){return B.idTipoIdentificadorFiscal==a.persona.idTipoIdentificadorFiscal})[0]:null;a.ddlPaisIdentificacionFiscal.shieldComboBox({dataSource:{data:a.dataParametros.paises},valueTemplate:"{idPais}",textTemplate:"{Nombre}",enabled:a.esCuentaJuridica,value:(x)?x.idPais.toString():"1",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{select:function(A){a.setControls()},blur:function(A){if(a.ddlPaisIdentificacionFiscal.swidget().selectedItem()==null){a.ddlPaisIdentificacionFiscal.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlPaisIdentificacionFiscal,false);a.ddlTipoIdentificacionFiscal.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idTipoIdentificadorFiscal}",textTemplate:"{Descripcion}",value:(x)?x.idTipoIdentificadorFiscal.toString():"",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""}]}}});Core.Functions.Validations.toggleValidation(a.ddlTipoIdentificacionFiscal,false);a.txtIdentificacionFiscal.shieldTextBox({value:(a.persona&&a.persona.cuit_cuil!=null)?a.persona.cuit_cuil:""});Core.Functions.Validations.toggleValidation(a.txtIdentificacionFiscal,false);a.ddlCondicionIva.shieldDropDown({dataSource:{data:$.grep(a.dataParametros.tipoContribuyentes,function(B,A){return B.EsFisica})},valueTemplate:"{idTipoContribuyente}",textTemplate:"{Descripcion}",value:(a.persona&&a.persona.idTipoContribuyente!=null)?a.persona.idTipoContribuyente.toString():"",events:{blur:function(A){if(a.ddlCondicionIva.swidget().selectedItem()==null){a.ddlCondicionIva.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlCondicionIva,false);a.chkInscripcionGanancias.shieldCheckBox({label:"Inscripción Ganancias."});a.chkInscripcionGanancias.swidget().checked(((a.persona&&a.persona.inscripcionGanancias==1)?true:false));Core.Functions.Validations.toggleValidation(a.chkInscripcionGanancias,false);if(!a.chkTributaEnOtroPaisSi.swidget()){a.chkTributaEnOtroPaisSi.shieldRadioButton({label:"Si",events:{click:function(A){a.setControls()}}})}var q=a.chkTributaEnOtroPaisSi.swidget().initialOptions;q.checked=((a.persona&&a.persona.tributaEnOtroPais==1)?true:false);a.chkTributaEnOtroPaisSi.swidget().refresh(q);Core.Functions.Validations.toggleValidation(a.chkTributaEnOtroPaisSi,false);if(!a.chkTributaEnOtroPaisNo.swidget()){a.chkTributaEnOtroPaisNo.shieldRadioButton({label:"No",events:{click:function(A){a.setControls()}}})}var p=a.chkTributaEnOtroPaisNo.swidget().initialOptions;p.checked=((a.persona&&a.persona.tributaEnOtroPais==0)?true:false);a.chkTributaEnOtroPaisNo.swidget().refresh(p);Core.Functions.Validations.toggleValidation(a.chkTributaEnOtroPaisNo,false);a.ddlOcupacion.shieldDropDown({dataSource:{data:a.dataParametros.ocupaciones},valueTemplate:"{idOcupacion}",textTemplate:"{Descripcion}",value:(a.persona&&a.persona.idOcupacion!=null)?a.persona.idOcupacion.toString():"",events:{select:function(A){a.setControls()},blur:function(A){if(a.ddlOcupacion.swidget().selectedItem()==null){a.ddlOcupacion.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlOcupacion,false);a.ddlOcupacionPersonaJuridica.shieldDropDown({dataSource:{data:a.dataParametros.ocupaciones},valueTemplate:"{idOcupacion}",textTemplate:"{Descripcion}",value:(a.persona&&a.persona.idOcupacion!=null)?a.persona.idOcupacion.toString():"",events:{select:function(A){a.setControls()},blur:function(A){if(a.ddlOcupacion.swidget().selectedItem()==null){a.ddlOcupacion.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlOcupacionPersonaJuridica,false);a.ddlEstadoCivil.shieldDropDown({dataSource:{data:[{value:Core.Business.eEstadoCivil.Soltero,text:"Soltero"},{value:Core.Business.eEstadoCivil.Casado,text:"Casado"},{value:Core.Business.eEstadoCivil.Divorciado,text:"Divorciado"},{value:Core.Business.eEstadoCivil.Separado,text:"Separado"},{value:Core.Business.eEstadoCivil.Viudo,text:"Viudo"}]},valueTemplate:"{value}",textTemplate:"{text}",value:(a.persona&&a.persona.idEstadoCivil!=null)?a.persona.idEstadoCivil.toString():"",events:{select:function(A){a.setControls()},blur:function(A){if(a.ddlEstadoCivil.swidget().selectedItem()==null){a.ddlEstadoCivil.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlEstadoCivil,false);if(!a.chkPersonaExpuestaSi.swidget()){a.chkPersonaExpuestaSi.shieldRadioButton({label:"Si",events:{click:function(A){a.setControls()}}})}var q=a.chkPersonaExpuestaSi.swidget().initialOptions;q.checked=((a.persona&&a.persona.esPep==1)?true:false);a.chkPersonaExpuestaSi.swidget().refresh(q);Core.Functions.Validations.toggleValidation(a.chkPersonaExpuestaSi,false);if(!a.chkPersonaExpuestaNo.swidget()){a.chkPersonaExpuestaNo.shieldRadioButton({label:"No",events:{click:function(A){a.setControls()}}})}var p=a.chkPersonaExpuestaNo.swidget().initialOptions;p.checked=((a.persona&&a.persona.esPep==0)?true:false);a.chkPersonaExpuestaNo.swidget().refresh(p);Core.Functions.Validations.toggleValidation(a.chkPersonaExpuestaNo,false);a.chkSujetoObligado.shieldCheckBox({label:"Sujeto Obligado ante la UIF (Unidad de Información Financiera).",events:{click:function(A){if(a.chkSujetoObligado.swidget().checked()){new Core.Controls.Confirmation("¿Confirmas ser Sujeto Obligado?",'Si no estás seguro de estar alcanzado por esta ley, repasá el artículo 20 <a href="https://www.argentina.gob.ar/uif/normativa-uif/resoluciones-aplicables-cada-sujeto-obligado" target="_blank">(Ley N° 25.246).</a><br />Algunos ejemplos de profesiones alcanzadas en dicho artículo son: escribanos y contadores públicos,  despachantes de aduana, brokers de seguros, agentes inmobiliarios, etc.',{onCanceled:function(){a.chkSujetoObligado.swidget().checked(false)}}).show()}}}});a.chkSujetoObligado.swidget().checked(((a.persona&&a.persona.esSujetoObligado==1)?true:false));Core.Functions.Validations.toggleValidation(a.chkSujetoObligado,false);a.txtDomicilioLaboralCalle.shieldTextBox({value:(a.persona&&a.persona.domicilioLaboralCalle!=null)?a.persona.domicilioLaboralCalle:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioLaboralCalle,false);a.txtDomicilioLaboralNumero.shieldTextBox({value:(a.persona&&a.persona.domicilioLaboralNumero!=null)?a.persona.domicilioLaboralNumero:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioLaboralNumero,false);a.txtDomicilioLaboralPiso.shieldTextBox({value:(a.persona&&a.persona.domicilioLaboralPiso!=null)?a.persona.domicilioLaboralPiso:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioLaboralPiso,false);a.txtDomicilioLaboralDepartamento.shieldTextBox({value:(a.persona&&a.persona.domicilioLaboralDepartamento!=null)?a.persona.domicilioLaboralDepartamento:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioLaboralDepartamento,false);a.txtDomicilioLaboralLocalidad.shieldTextBox({value:(a.persona&&a.persona.domicilioLaboralCiudad!=null)?a.persona.domicilioLaboralCiudad:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioLaboralLocalidad,false);a.ddlDomicilioLaboralPais.shieldComboBox({dataSource:{data:a.dataParametros.paises},valueTemplate:"{idPais}",textTemplate:"{Nombre}",value:(a.persona&&a.persona.domicilioLaboralidPais!=null)?a.persona.domicilioLaboralidPais.toString():"1",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{select:function(A){a.setControls()},blur:function(A){if(a.ddlDomicilioLaboralPais.swidget().selectedItem()==null){a.ddlDomicilioLaboralPais.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlDomicilioLaboralPais,false);a.ddlDomicilioLaboralProvincia.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idProvincia}",textTemplate:"{Nombre}",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{blur:function(A){if(a.ddlDomicilioLaboralProvincia.swidget().selectedItem()==null){a.ddlDomicilioLaboralProvincia.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlDomicilioLaboralProvincia,false);a.txtDomicilioLaboralCodigoPostal.shieldTextBox({value:(a.persona&&a.persona.domicilioLaboralCodigoPostal!=null)?a.persona.domicilioLaboralCodigoPostal:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioLaboralCodigoPostal,false);var v=(a.persona&&a.persona.domicilioLaboralTelefono!=null)?a.persona.domicilioLaboralTelefono.split("-"):[];a.txtTelefonoLaboralArea.shieldTextBox({value:(v.length>1)?v[0]:""});Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralArea,false);a.txtTelefonoLaboralNumero.shieldTextBox({value:(v.length>1)?v[1]:((v.length==1)?v[0]:"")});Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralNumero,false);a.txtConyugeNombre.shieldTextBox({value:(a.persona&&a.persona.conyugeNombre!=null)?a.persona.conyugeNombre:""});Core.Functions.Validations.toggleValidation(a.txtConyugeNombre,false);a.txtConyugeApellido.shieldTextBox({value:(a.persona&&a.persona.conyugeApellido!=null)?a.persona.conyugeApellido:""});Core.Functions.Validations.toggleValidation(a.txtConyugeApellido,false);a.ddlConyugeTipoDocumento.shieldDropDown({dataSource:{data:a.dataParametros.tiposDocumentos},valueTemplate:"{idTipoDocumento}",textTemplate:"{Descripcion}",value:(a.persona&&a.persona.conyugeidTipoDocumento!=null)?a.persona.conyugeidTipoDocumento.toString():"",events:{blur:function(A){if(a.ddlConyugeTipoDocumento.swidget().selectedItem()==null){a.ddlConyugeTipoDocumento.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlConyugeTipoDocumento,false);a.txtConyugeDocumento.shieldTextBox({value:(a.persona&&a.persona.conyugeDocumento!=null)?a.persona.conyugeDocumento:""});Core.Functions.Validations.toggleValidation(a.txtConyugeDocumento,false);if(!a.chkPersonaExpuestaIndirectamente.swidget()){a.chkPersonaExpuestaIndirectamente.shieldRadioButton({label:"Indirectamente",events:{click:function(A){a.divPersonaExpuestaIndirectamente.hide();if(a.chkPersonaExpuestaIndirectamente.swidget().checked()){a.divPersonaExpuestaIndirectamente.show()}}}})}var o=a.chkPersonaExpuestaIndirectamente.swidget().initialOptions;o.checked=(a.persona&&!a.persona.PEPTipo)?true:false;a.chkPersonaExpuestaIndirectamente.swidget().refresh(o);Core.Functions.Validations.toggleValidation(a.chkPersonaExpuestaIndirectamente,false);if(!a.chkPersonaExpuestaDirectamente.swidget()){a.chkPersonaExpuestaDirectamente.shieldRadioButton({label:"Directamente",events:{click:function(A){a.divPersonaExpuestaIndirectamente.hide();if(a.chkPersonaExpuestaIndirectamente.swidget().checked()){a.divPersonaExpuestaIndirectamente.show()}}}})}var n=a.chkPersonaExpuestaDirectamente.swidget().initialOptions;n.checked=(!a.persona||a.persona.PEPTipo)?true:false;a.chkPersonaExpuestaDirectamente.swidget().refresh(n);Core.Functions.Validations.toggleValidation(a.chkPersonaExpuestaDirectamente,false);a.txtPersonaExpuestaIndirectamente.shieldTextBox({value:(a.persona&&a.persona.PEPNombreIndirecto!=null)?a.persona.PEPNombreIndirecto:""});Core.Functions.Validations.toggleValidation(a.txtPersonaExpuestaIndirectamente,false);a.txtPersonaExpuestaCargo.shieldTextBox({value:(a.persona&&a.persona.pepCargo!=null)?a.persona.pepCargo:""});Core.Functions.Validations.toggleValidation(a.txtPersonaExpuestaCargo,false);a.txtPersonaExpuestaAutoridad.shieldTextBox({value:(a.persona&&a.persona.pepAutoridadEmision!=null)?a.persona.pepAutoridadEmision:""});Core.Functions.Validations.toggleValidation(a.txtPersonaExpuestaAutoridad,false);a.txtPersonaExpuestaDenominacion.shieldTextBox({value:((a.persona&&a.persona.pepDenominacion!=null)?a.persona.pepDenominacion:a.defaultPersonaExpuestaDenominacion),enabled:(a.esCuentaJuridica?false:true)});Core.Functions.Validations.toggleValidation(a.txtPersonaExpuestaDenominacion,false);a.lblPersonaExpuestaDenominacion.text("Denominación de la Persona Jurídica"+(a.esCuentaJuridica?"":" - Opcional"));a.txtPersonaExpuestaCuit.shieldTextBox({value:((a.persona&&a.persona.pepCUIT!=null)?a.persona.pepCUIT:a.defaultPersonaExpuestaCuit),enabled:(a.esCuentaJuridica?false:true)});Core.Functions.Validations.toggleValidation(a.txtPersonaExpuestaCuit,false);a.lblPersonaExpuestaCuit.text("CUIT Persona Jurídica"+(a.esCuentaJuridica?"":" - Opcional"));a.txtPersonaExpuestaObservaciones.shieldTextBox({value:(a.persona&&a.persona.pepObservaciones!=null)?a.persona.pepObservaciones:""});Core.Functions.Validations.toggleValidation(a.txtPersonaExpuestaObservaciones,false);a.ddlPersonaExpuestaCaracterInvocado.shieldDropDown({dataSource:{data:$.grep(a.dataParametros.TiposCondoministas,function(B,A){return a.esCuentaJuridica?B.Juridica:B.Fisica})},valueTemplate:"{Descripcion}",textTemplate:"{Descripcion}",value:(a.persona&&a.persona.pepCaracterInvocado!=null)?a.persona.pepCaracterInvocado.toString():"",enabled:false});Core.Functions.Validations.toggleValidation(a.ddlPersonaExpuestaCaracterInvocado,false);if(a.persona){a.anchorFrenteDni.attr("href",a.persona.urlDNIFrente);a.imgFrenteDni.attr("src",a.persona.urlDNIFrente)}if(a.persona){a.anchorDorsoDni.attr("href",a.persona.urlDNIDorso);a.imgDorsoDni.attr("src",a.persona.urlDNIDorso)}if(a.persona){a.anchorFotoCliente.attr("href",a.persona.urlFoto);a.imgFotoCliente.attr("src",a.persona.urlFoto)}a.divInformes.html("");if(a.persona){var l=$("<label>Resumen de la Persona:  </label>").appendTo(a.divInformes);if(a.persona.tienePruebaDeVida){var h=$('<button disabled type="button" title="Prueba de Vida" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/prueba-de-vida.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);h.css("border-color",a.persona.tienePruebaDeVida)}if(a.persona.tieneMatchCara){var f=$('<button disabled type="button" title="Match de Cara" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/match-cara.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);f.css("border-color",a.persona.tieneMatchCara);if(a.optionsApertura&&a.optionsApertura.consultaICAR&&a.idAperturaCuenta){f.removeAttr("disabled");f.on("click",function(){Core.Functions.ExternalServices.Icar.showReport(f,a.idAperturaCuenta,a.persona.tipo,a.persona.numero)})}}if(a.persona.tieneDatosPrecargados){var d=$('<button disabled type="button" title="Datos Precargados" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/datos-precargados.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);d.css("border-color",a.persona.tieneDatosPrecargados);if(a.optionsApertura&&a.optionsApertura.consultaICAR&&a.idAperturaCuenta){d.removeAttr("disabled");d.on("click",function(){Core.Functions.ExternalServices.Icar.showReport(d,a.idAperturaCuenta,a.persona.tipo,a.persona.numero)})}}if(a.persona.tieneReuters){var j=$('<button disabled type="button" title="Reuters" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/reuters-logo.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);j.css("border-color",a.persona.tieneReuters);if(a.optionsApertura&&a.optionsApertura.consultaReuters){j.removeAttr("disabled");j.on("click",function(){Core.Functions.ExternalServices.Reuters.showReport(j,a.persona.documento,encodeURIComponent(a.persona.nombre.toLowerCase()+" "+a.persona.apellido.toLowerCase()),a.persona.sexo,a.persona.fechaNacimiento,a.persona.nacionalidad)})}}if(a.persona.tieneNOSIS){var g=$('<button disabled type="button" title="Nosis" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/nosis-logo.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);g.css("border-color",a.persona.tieneNOSIS);if(a.optionsApertura&&a.optionsApertura.consultaNosis){g.removeAttr("disabled");g.on("click",function(){Core.Functions.ExternalServices.Nosis.showReport(g,a.persona.cuit_cuil)})}}if(a.persona.tieneRenaper){var i=$('<button disabled type="button" title="Renaper" class="btn-sm balanz-button"style="border:3px solid; background-color:#fff;"><img src="/images/renaper-logo.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);i.css("border-color",a.persona.tieneRenaper);if(a.optionsApertura&&a.optionsApertura.consultaRenaper){i.removeAttr("disabled");i.on("click",function(){Core.Functions.ExternalServices.Renaper.showReport(i,a.persona.documento,a.persona.idTipoDocumento,a.persona.sexo)})}}if(a.persona.tieneUIF){var k=$('<button disabled type="button" title="UIF" class="btn-sm balanz-button"style="border:3px solid; background-color:#fff;"><img src="/images/uif-logo.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);k.css("border-color",a.persona.tieneUIF);if(a.optionsApertura&&a.optionsApertura.consultaUIF){k.removeAttr("disabled");k.on("click",function(){Core.Functions.ExternalServices.UIF.showReport(k,a.persona.cuit_cuil)})}}var e=$('<button disabled type="button" title="Google" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/google-logo.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);e.css("border-color","lightgreen");if(a.optionsApertura&&a.optionsApertura.consultaGoogle){e.removeAttr("disabled");e.on("click",function(){var A="http://www.google.com/search?q="+a.persona.nombre+"+"+a.persona.apellido;window.open(A,"_blank")})}}a.btnConfirmarYCerrar.unbind("click");a.btnConfirmarYCerrar.click(function(){a.confirmar(true)});a.btnConfirmarYCerrar.show();if(a.readOnly){a.btnConfirmarYCerrar.hide()}a.btnVolver.unbind("click");a.btnVolver.click(function(){a.container.modal("hide");a.destroy()});a.btnCalcularMatrizRiesgo.unbind("click");a.btnCalcularMatrizRiesgo.click(function(){a.container.hide();a.divMatrizRiesgo.show();var A=new Core.Controls.ManagerMatrizRiesgo({container:a.divMatrizRiesgo,dataParametrosUsuario:a.dataParametrosUsuario,calcularMatriz:true,consultarMatriz:false,cuilCuit:a.persona.cuit_cuil,idAperturaCuenta:a.idAperturaCuenta,numero:a.persona.numero,tipo:a.persona.tipo,readOnly:a.readOnly,optionsApertura:a.optionsApertura,onSave:function(D,B){a.controlMontoCompliance.setValue(D);if(B){var C=a.ddlRiesgoCliente.swidget().initialOptions;C.value=B.toString();a.ddlRiesgoCliente.swidget().refresh(C)}},onClose:function(){a.container.show();a.divMatrizRiesgo.hide()}}).show()});a.btnConsultarMatrizRiesgo.unbind("click");a.btnConsultarMatrizRiesgo.click(function(){a.container.hide();a.divMatrizRiesgo.show();var A=new Core.Controls.ManagerMatrizRiesgo({container:a.divMatrizRiesgo,dataParametrosUsuario:a.dataParametrosUsuario,calcularMatriz:false,consultarMatriz:true,cuilCuit:a.persona.cuit_cuil,idAperturaCuenta:a.idAperturaCuenta,numero:a.persona.numero,tipo:a.persona.tipo,readOnly:a.readOnly,optionsApertura:a.optionsApertura,onSave:function(D,B){a.controlMontoCompliance.setValue(D);if(B){var C=a.ddlRiesgoCliente.swidget().initialOptions;C.value=B.toString();a.ddlRiesgoCliente.swidget().refresh(C)}},onClose:function(){a.container.show();a.divMatrizRiesgo.hide()}}).show()});a.btnConsultarMatrizRiesgo.hide();a.divCalcularMatrizRiesgo.hide();if(a.pageOptions&&a.persona&&a.persona.cuit_cuil&&Core.Functions.Validations.isCuit(a.persona.cuit_cuil)){if(a.persona.VersionMatriz&&a.persona.VersionMatriz>0){a.btnConsultarMatrizRiesgo.show()}else{a.divCalcularMatrizRiesgo.show()}}a.divMontoCompliance.hide();if(!a.esCuentaJuridica&&Core.Objects.Context.Configuration.idAplicacion==3){a.divMontoCompliance.show()}a.divSujetoObligado.hide();a.divImagenes.hide();a.divOcupacion.hide();a.divOcupacionPersonaJuridica.hide();if(!a.esCuentaJuridica){a.divSujetoObligado.show();a.divImagenes.show();a.divOcupacion.show()}else{a.divOcupacionPersonaJuridica.show()}a.setControls(true)}})};a.confirmar=function(c){Core.Functions.Validations.toggleValidation(a.ddlTipo,false);Core.Functions.Validations.toggleValidation(a.txtNombre,false);Core.Functions.Validations.toggleValidation(a.txtApellido,false);Core.Functions.Validations.toggleValidation(a.ddlTipoDocumento,false);Core.Functions.Validations.toggleValidation(a.txtDocumento,false);Core.Functions.Validations.toggleValidation(a.ddlPaisEmisionPasaporte,false);Core.Functions.Validations.toggleValidation(a.txtFechaVencimientoPasaporte,false);Core.Functions.Validations.toggleValidation(a.ddlPaisIdentificacionFiscal,false);Core.Functions.Validations.toggleValidation(a.ddlTipoIdentificacionFiscal,false);Core.Functions.Validations.toggleValidation(a.txtIdentificacionFiscal,false);Core.Functions.Validations.toggleValidation(a.ddlNacionalidad,false);Core.Functions.Validations.toggleValidation(a.chkCiudadaniaEeuuSi,false);Core.Functions.Validations.toggleValidation(a.chkCiudadaniaEeuuNo,false);Core.Functions.Validations.toggleValidation(a.chkMatchCara,false);Core.Functions.Validations.toggleValidation(a.txtFechaNacimiento,false);Core.Functions.Validations.toggleValidation(a.txtLugarNacimiento,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioRealCalle,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioRealNumero,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioRealPiso,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioRealDepartamento,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioRealLocalidad,false);Core.Functions.Validations.toggleValidation(a.ddlDomicilioRealPais,false);Core.Functions.Validations.toggleValidation(a.ddlDomicilioRealProvincia,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioRealCodigoPostal,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioLaboralCalle,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioLaboralNumero,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioLaboralPiso,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioLaboralDepartamento,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioLaboralLocalidad,false);Core.Functions.Validations.toggleValidation(a.ddlDomicilioLaboralPais,false);Core.Functions.Validations.toggleValidation(a.ddlDomicilioLaboralProvincia,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioLaboralCodigoPostal,false);Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularArea,false);Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularNumero,false);Core.Functions.Validations.toggleValidation(a.ddlTelefonoCelularPais,false);Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularArea,false);Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularNumero,false);Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralArea,false);Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralNumero,false);Core.Functions.Validations.toggleValidation(a.txtCargoLaboral,false);Core.Functions.Validations.toggleValidation(a.txtVencimientoCargoLaboral,false);Core.Functions.Validations.toggleValidation(a.txtEmpresaLaboral,false);Core.Functions.Validations.toggleValidation(a.txtActividadEmpresa,false);Core.Functions.Validations.toggleValidation(a.txtOcupacionDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtOcupacionDescripcionPersonaJuridica,false);Core.Functions.Validations.toggleValidation(a.txtEmail,false);Core.Functions.Validations.toggleValidation(a.ddlSexo,false);Core.Functions.Validations.toggleValidation(a.ddlCondicionIva,false);Core.Functions.Validations.toggleValidation(a.chkInscripcionGanancias,false);Core.Functions.Validations.toggleValidation(a.ddlEstadoCivil,false);Core.Functions.Validations.toggleValidation(a.ddlOcupacion,false);Core.Functions.Validations.toggleValidation(a.ddlOcupacionPersonaJuridica,false);Core.Functions.Validations.toggleValidation(a.chkPersonaExpuestaSi,false);Core.Functions.Validations.toggleValidation(a.chkPersonaExpuestaNo,false);Core.Functions.Validations.toggleValidation(a.chkSujetoObligado,false);Core.Functions.Validations.toggleValidation(a.txtConyugeNombre,false);Core.Functions.Validations.toggleValidation(a.txtConyugeApellido,false);Core.Functions.Validations.toggleValidation(a.ddlConyugeTipoDocumento,false);Core.Functions.Validations.toggleValidation(a.txtConyugeDocumento,false);Core.Functions.Validations.toggleValidation(a.txtPersonaExpuestaCargo,false);Core.Functions.Validations.toggleValidation(a.txtPersonaExpuestaAutoridad,false);Core.Functions.Validations.toggleValidation(a.ddlPersonaExpuestaCaracterInvocado,false);Core.Functions.Validations.toggleValidation(a.txtPersonaExpuestaDenominacion,false);Core.Functions.Validations.toggleValidation(a.txtPersonaExpuestaCuit,false);Core.Functions.Validations.toggleValidation(a.txtPersonaExpuestaObservaciones,false);a.divAlert.slideUp();if(a.idTipoValidacion!=0){a.getPersonValidated(c)}else{a.getPersonNoValidated(c)}};a.getPersonValidated=function(c){var e={value:true};if(a.persona==null){a.persona=new Core.Objects.Persona()}a.persona.tipo=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipo,e);a.persona.nombre=Core.Functions.Validations.getValidatedSwidgetValue(a.txtNombre,e);a.persona.apellido=Core.Functions.Validations.getValidatedSwidgetValue(a.txtApellido,e);a.persona.idTipoDocumento=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoDocumento,e);a.persona.documento=Core.Functions.Validations.getValidatedSwidgetValue(a.txtDocumento,e);if(!a.validDocumento(a.ddlTipoDocumento.swidget().value(),a.txtDocumento.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtConyugeDocumento,true);e.value=false;a.divAlert.text("El DNI ingresado debe contener entre 6 y 8 caracteres númericos.");a.divAlert.slideDown()}if(a.ddlTipoDocumento.swidget().value()==Core.Business.eTipoDocumento.PAS){a.persona.idPaisEmisionPasaporte=Core.Functions.Validations.getValidatedDropDownValue(a.ddlPaisEmisionPasaporte,e);a.persona.FechaVencimientoPasaporte=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaVencimientoPasaporte,e))}a.persona.nacionalidad=Core.Functions.Validations.getValidatedDropDownValue(a.ddlNacionalidad,e);if(!a.esCuentaJuridica&&a.ddlTipo.swidget().selectedItem()!=null&&a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Titular){a.persona.esCiudadanoEstadounidiense=a.getSiNo(a.chkCiudadaniaEeuuSi,a.chkCiudadaniaEeuuNo,e,"Debe seleccionar si posee ciudadanía EE.UU.")}if(!a.esCuentaJuridica){a.persona.matcheoCaraManual=(a.chkMatchCara.swidget().checked())?1:0}a.persona.fechaNacimiento=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaNacimiento,e));if(!a.validFechaNacimiento(a.txtFechaNacimiento.swidget().value())){e.value=false;Core.Functions.Validations.toggleValidation(a.txtFechaNacimiento,true);a.divAlert.text("La fecha de nacimiento es inválida. La Persona debe ser mayor de 18 años");a.divAlert.slideDown()}a.persona.lugarNacimiento=Core.Functions.Validations.getValidatedSwidgetValue(a.txtLugarNacimiento,e);if(a.esCuentaJuridica&&a.ddlTipo.swidget().selectedItem()!=null&&(a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Accionista||a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.BeneficiarioFinal)){a.persona.domicilioParticularCalle=a.txtDomicilioRealCalle.swidget().value();a.persona.domicilioParticularNumero=(!a.txtDomicilioRealNumero.swidget().value())?0:a.txtDomicilioRealNumero.swidget().value();a.persona.domicilioParticularCiudad=a.txtDomicilioRealLocalidad.swidget().value();a.persona.domicilioParticularidPais=(!a.ddlDomicilioRealPais.swidget().selectedItem())?0:a.ddlDomicilioRealPais.swidget().value();a.persona.domicilioParticularidProvincia=(!a.ddlDomicilioRealProvincia.swidget().selectedItem())?0:a.ddlDomicilioRealProvincia.swidget().value();a.persona.domicilioParticularCodigoPostal=a.txtDomicilioRealCodigoPostal.swidget().value();a.persona.email=a.txtEmail.swidget().value()}else{a.persona.domicilioParticularidPais=Core.Functions.Validations.getValidatedDropDownValue(a.ddlDomicilioRealPais,e);a.persona.domicilioParticularidProvincia=Core.Functions.Validations.getValidatedDropDownValue(a.ddlDomicilioRealProvincia,e);a.persona.domicilioParticularCalle=Core.Functions.Validations.getValidatedSwidgetValue(a.txtDomicilioRealCalle,e);if(a.persona.domicilioParticularidPais==a.idPais_Argentina){a.persona.domicilioParticularNumero=Core.Functions.Validations.getValidatedSwidgetValue(a.txtDomicilioRealNumero,e)}else{a.persona.domicilioParticularNumero=(!a.txtDomicilioRealNumero.swidget().value())?0:a.txtDomicilioRealNumero.swidget().value()}a.persona.domicilioParticularCiudad=Core.Functions.Validations.getValidatedSwidgetValue(a.txtDomicilioRealLocalidad,e);a.persona.domicilioParticularCodigoPostal=Core.Functions.Validations.getValidatedSwidgetValue(a.txtDomicilioRealCodigoPostal,e);a.persona.email=Core.Functions.Validations.getValidatedSwidgetValue(a.txtEmail,e)}a.persona.domicilioParticularPiso=a.txtDomicilioRealPiso.val();a.persona.domicilioParticularDepartamento=a.txtDomicilioRealDepartamento.val();if(a.persona.email&&!a.isValidEmailAddress(a.persona.email)){e.value=false;Core.Functions.Validations.toggleValidation(a.txtEmail,true);a.divAlert.text("Debe ingresar un email valido");a.divAlert.slideDown()}a.persona.domicilioParticularTelefonoFijo=a.txtTelefonoParticularArea.swidget().value()+"-"+a.txtTelefonoParticularNumero.swidget().value();if((a.txtTelefonoParticularArea.swidget().value()||a.txtTelefonoParticularNumero.swidget().value())&&!a.isValidPhone(a.persona.domicilioParticularTelefonoFijo)){Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularArea,true);Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularNumero,true);e.value=false;a.divAlert.text("El teléfono ingresado no es válido.");a.divAlert.slideDown()}if(a.txtTelefonoParticularArea.swidget().value()&&!Core.Functions.Validations.isNumeric(a.txtTelefonoParticularArea.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularArea,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(a.txtTelefonoParticularNumero.swidget().value()&&!Core.Functions.Validations.isNumeric(a.txtTelefonoParticularNumero.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularNumero,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(a.ddlTelefonoCelularPais.swidget().selectedItem()!=null&&a.ddlTelefonoCelularPais.swidget().selectedItem().value==a.phoneCodeAr){a.persona.domicilioParticularTelefonoMovil="+"+a.ddlTelefonoCelularPais.swidget().selectedItem().value+"-"+a.txtTelefonoCelularArea.swidget().value()+"-"+a.txtTelefonoCelularNumero.swidget().value()}else{a.persona.domicilioParticularTelefonoMovil="+"+a.ddlTelefonoCelularPais.swidget().selectedItem().value+"-"+a.txtTelefonoCelularNumero.swidget().value()}if(a.esCuentaJuridica&&a.ddlTipo.swidget().selectedItem()!=null&&(a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Accionista||a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.BeneficiarioFinal)){if(((a.ddlTelefonoCelularPais.swidget().selectedItem().value==a.phoneCodeAr&&a.txtTelefonoCelularArea.swidget().value())||a.txtTelefonoCelularNumero.swidget().value())&&!a.isValidPhone(a.persona.domicilioParticularTelefonoMovil)){Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularArea,true);Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularNumero,true);e.value=false;a.divAlert.text("El teléfono ingresado no es válido.");a.divAlert.slideDown()}if(a.ddlTelefonoCelularPais.swidget().selectedItem().value==a.phoneCodeAr&&a.txtTelefonoCelularArea.swidget().value()&&!Core.Functions.Validations.isNumeric(a.txtTelefonoCelularArea.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularArea,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(a.txtTelefonoCelularNumero.swidget().value()&&!Core.Functions.Validations.isNumeric(a.txtTelefonoCelularNumero.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularNumero,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}}else{if(!a.isValidPhone(a.persona.domicilioParticularTelefonoMovil)){Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularArea,true);Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularNumero,true);e.value=false;a.divAlert.text("El teléfono ingresado no es válido.");a.divAlert.slideDown()}if(a.ddlTelefonoCelularPais.swidget().selectedItem().value==a.phoneCodeAr&&(!a.txtTelefonoCelularArea.swidget().value()||!Core.Functions.Validations.isNumeric(a.txtTelefonoCelularArea.swidget().value()))){Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularArea,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(!a.txtTelefonoCelularNumero.swidget().value()||!Core.Functions.Validations.isNumeric(a.txtTelefonoCelularNumero.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularNumero,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}}a.persona.sexo=Core.Functions.Validations.getValidatedDropDownValue(a.ddlSexo,e);a.persona.idTipoIdentificadorFiscal=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoIdentificacionFiscal,e);a.persona.cuit_cuil=(a.persona.idTipoDocumento==Core.Business.eTipoDocumento.DNI?Core.Functions.Validations.getValidatedSwidgetValue(a.txtIdentificacionFiscal,e):a.txtIdentificacionFiscal.val());if(a.ddlPaisIdentificacionFiscal.swidget().value()==a.idPais_Argentina){if(!Core.Functions.Validations.isNumeric(a.txtIdentificacionFiscal.val())){Core.Functions.Validations.toggleValidation(a.txtIdentificacionFiscal,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(a.txtIdentificacionFiscal.val()&&!Core.Functions.Validations.isCuit(a.txtIdentificacionFiscal.val())){e.value=false;Core.Functions.Validations.toggleValidation(a.txtIdentificacionFiscal,true);a.divAlert.text("Debe ingresar un Cuil o Cuit válido.");a.divAlert.slideDown()}if(a.persona.idTipoDocumento==Core.Business.eTipoDocumento.DNI){if(!a.validDniFiscalIdentifier(a.txtDocumento.val(),a.txtIdentificacionFiscal.val())){Core.Functions.Validations.toggleValidation(a.txtDocumento,true);Core.Functions.Validations.toggleValidation(a.txtIdentificacionFiscal,true);e.value=false;a.divAlert.text("El CUIL / CUIT ingresado debe contener al DNI.");a.divAlert.slideDown()}}}a.persona.idTipoContribuyente=Core.Functions.Validations.getValidatedDropDownValue(a.ddlCondicionIva,e);a.persona.inscripcionGanancias=(a.chkInscripcionGanancias.swidget().checked())?1:0;if(!a.esCuentaJuridica){a.persona.idOcupacion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlOcupacion,e)}else{if(a.ddlTipo.swidget().selectedItem()!=null&&(a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Accionista||a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.BeneficiarioFinal)){a.persona.idOcupacion=a.ddlOcupacionPersonaJuridica.swidget().value()}else{a.persona.idOcupacion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlOcupacionPersonaJuridica,e)}}a.persona.idEstadoCivil=Core.Functions.Validations.getValidatedDropDownValue(a.ddlEstadoCivil,e);if(!a.esCuentaJuridica){a.persona.esSujetoObligado=(a.chkSujetoObligado.swidget().checked())?1:0}if(a.esCuentaJuridica||(a.ddlTipo.swidget()!=null&&a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Titular)){a.persona.esPep=a.getSiNo(a.chkPersonaExpuestaSi,a.chkPersonaExpuestaNo,e,"Debe seleccionar si es persona expuesta políticamente.")}if(!a.esCuentaJuridica&&a.ddlTipo.swidget().selectedItem()!=null&&a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Titular&&a.ddlOcupacion.swidget().selectedItem()!=null){a.persona.cargo=((a.ddlOcupacion.swidget().selectedItem().TipoCampoAdicional==1)?Core.Functions.Validations.getValidatedSwidgetValue(a.txtCargoLaboral,e):"");a.persona.empresa=((a.ddlOcupacion.swidget().selectedItem().TipoCampoAdicional==1)?Core.Functions.Validations.getValidatedSwidgetValue(a.txtEmpresaLaboral,e):"");a.persona.EmpresaActividad=((a.ddlOcupacion.swidget().selectedItem().TipoCampoAdicional==1)?Core.Functions.Validations.getValidatedSwidgetValue(a.txtActividadEmpresa,e):"");a.persona.OcupacionDescripcion=((a.ddlOcupacion.swidget().selectedItem().TipoCampoAdicional==2)?Core.Functions.Validations.getValidatedSwidgetValue(a.txtOcupacionDescripcion,e):"");a.persona.domicilioLaboralCalle=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?a.txtDomicilioLaboralCalle.swidget().value():"");a.persona.domicilioLaboralNumero=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?a.txtDomicilioLaboralNumero.swidget().value():"");a.persona.domicilioLaboralPiso=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?a.txtDomicilioLaboralPiso.swidget().value():"");a.persona.domicilioLaboralDepartamento=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?a.txtDomicilioLaboralDepartamento.swidget().value():"");a.persona.domicilioLaboralCiudad=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?a.txtDomicilioLaboralLocalidad.swidget().value():"");a.persona.domicilioLaboralidPais=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?((!a.ddlDomicilioLaboralPais.swidget().selectedItem())?0:a.ddlDomicilioLaboralPais.swidget().value()):0);a.persona.domicilioLaboralidProvincia=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?((!a.ddlDomicilioLaboralProvincia.swidget().selectedItem())?0:a.ddlDomicilioLaboralProvincia.swidget().value()):0);a.persona.domicilioLaboralCodigoPostal=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?a.txtDomicilioLaboralCodigoPostal.swidget().value():"");a.persona.domicilioLaboralTelefono=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?(a.txtTelefonoLaboralArea.swidget().value()+"-"+a.txtTelefonoLaboralNumero.swidget().value()):"");if(a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1){if((a.txtTelefonoLaboralArea.swidget().value()||a.txtTelefonoLaboralNumero.swidget().value())&&!a.isValidPhone(a.persona.domicilioLaboralTelefono)){Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralArea,true);Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralNumero,true);e.value=false;a.divAlert.text("El teléfono ingresado no es válido.");a.divAlert.slideDown()}if(!Core.Functions.Validations.isNumeric(a.txtTelefonoLaboralArea.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralArea,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(!Core.Functions.Validations.isNumeric(a.txtTelefonoLaboralNumero.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralNumero,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}}}else{if(a.esCuentaJuridica){if(a.ddlTipo.swidget().selectedItem()!=null&&(a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Accionista||a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.BeneficiarioFinal)){a.persona.cargo=a.txtCargoLaboral.swidget().value();a.persona.EmpresaActividad=a.txtActividadEmpresa.swidget().value();a.persona.fechaVencimientoMandato=Core.Functions.Date.getDateAsString(a.txtVencimientoCargoLaboral.swidget().value());a.persona.OcupacionDescripcion=((a.ddlOcupacionPersonaJuridica.swidget().selectedItem().TipoCampoAdicional==2)?a.txtOcupacionDescripcionPersonaJuridica.swidget().value():"")}else{a.persona.cargo=Core.Functions.Validations.getValidatedSwidgetValue(a.txtCargoLaboral,e);a.persona.EmpresaActividad=Core.Functions.Validations.getValidatedSwidgetValue(a.txtActividadEmpresa,e);a.persona.fechaVencimientoMandato=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtVencimientoCargoLaboral,e));a.persona.OcupacionDescripcion=((a.ddlOcupacionPersonaJuridica.swidget().selectedItem().TipoCampoAdicional==2)?Core.Functions.Validations.getValidatedSwidgetValue(a.txtOcupacionDescripcionPersonaJuridica,e):"")}a.persona.domicilioLaboralTelefono=a.txtTelefonoLaboralArea.swidget().value()+"-"+a.txtTelefonoLaboralNumero.swidget().value();if((a.txtTelefonoLaboralArea.swidget().value()||a.txtTelefonoLaboralNumero.swidget().value())&&!a.isValidPhone(a.persona.domicilioLaboralTelefono)){Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralArea,true);Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralNumero,true);e.value=false;a.divAlert.text("El teléfono ingresado no es válido.");a.divAlert.slideDown()}if(!Core.Functions.Validations.isNumeric(a.txtTelefonoLaboralArea.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralArea,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(!Core.Functions.Validations.isNumeric(a.txtTelefonoLaboralNumero.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralNumero,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}}}if(!a.esCuentaJuridica&&a.ddlTipo.swidget().selectedItem()!=null&&a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Titular){a.persona.conyugeNombre=((a.ddlEstadoCivil.swidget().selectedItem().value==Core.Business.eEstadoCivil.Casado)?Core.Functions.Validations.getValidatedSwidgetValue(a.txtConyugeNombre,e):"");a.persona.conyugeApellido=((a.ddlEstadoCivil.swidget().selectedItem().value==Core.Business.eEstadoCivil.Casado)?Core.Functions.Validations.getValidatedSwidgetValue(a.txtConyugeApellido,e):"");a.persona.conyugeidTipoDocumento=((a.ddlEstadoCivil.swidget().selectedItem().value==Core.Business.eEstadoCivil.Casado)?a.ddlConyugeTipoDocumento.swidget().value():"0");a.persona.conyugeDocumento=((a.ddlEstadoCivil.swidget().selectedItem().value==Core.Business.eEstadoCivil.Casado)?a.txtConyugeDocumento.val():"");if(a.persona.conyugeDocumento){if(!a.validDocumento(a.ddlConyugeTipoDocumento.swidget().value(),a.txtConyugeDocumento.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtConyugeDocumento,true);e.value=false;a.divAlert.text("El DNI ingresado debe contener entre 6 y 8 caracteres númericos.");a.divAlert.slideDown()}}}if(!a.esCuentaJuridica&&Core.Objects.Context.Configuration.idAplicacion==3){if(a.idTipoValidacion>=10){a.persona.montoCompliance=Core.Functions.Validations.getValidatedNumericInputValue(a.txtMontoCompliance,e);a.persona.idRiesgo=Core.Functions.Validations.getValidatedDropDownValue(a.ddlRiesgoCliente,e)}else{a.persona.montoCompliance=a.txtMontoCompliance.val();a.persona.idRiesgo=a.ddlRiesgoCliente.swidget().value()}}else{if(!a.esCuentaJuridica){a.persona.montoCompliance=a.persona.montoCompliance;a.persona.idRiesgo=a.persona.idRiesgo}}a.persona.tributaEnOtroPais=a.getSiNo(a.chkTributaEnOtroPaisSi,a.chkTributaEnOtroPaisNo,e,"Debe seleccionar si tributa en otro país.");if(a.persona.tributaEnOtroPais){a.persona.nitidTipoIdentificadorFiscal=Core.Functions.Validations.getValidatedDropDownValue(a.ddlNitTipoIdentificacionFiscal,e);a.persona.nit=Core.Functions.Validations.getValidatedSwidgetValue(a.txtNit,e);if(a.ddlPaisTributo.swidget().value()==a.idPais_Argentina){if(!Core.Functions.Validations.isNumeric(a.txtNit.val())){Core.Functions.Validations.toggleValidation(a.txtNit,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(a.txtNit.val()&&!Core.Functions.Validations.isCuit(a.txtNit.val())){e.value=false;Core.Functions.Validations.toggleValidation(a.txtNit,true);a.divAlert.text("Debe ingresar un NIT válido.");a.divAlert.slideDown()}}}if((a.esCuentaJuridica||(a.ddlTipo.swidget().selectedItem()!=null&&a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Titular))){a.persona.PEPTipo=(a.chkPersonaExpuestaIndirectamente.swidget().checked())?0:1;if(a.esCuentaJuridica&&a.ddlTipo.swidget().selectedItem()!=null&&(a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Accionista||a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.BeneficiarioFinal)){a.persona.PEPNombreIndirecto=((a.persona.esPep&&!a.persona.PEPTipo)?a.txtPersonaExpuestaIndirectamente.val():"");a.persona.pepCargo=(a.persona.esPep?a.txtPersonaExpuestaCargo.swidget().value():"");a.persona.pepAutoridadEmision=(a.persona.esPep?a.txtPersonaExpuestaAutoridad.swidget().value():"");a.persona.pepDenominacion=(a.persona.esPep?a.txtPersonaExpuestaDenominacion.swidget().value():"");a.persona.pepCUIT=(a.persona.esPep?a.txtPersonaExpuestaCuit.swidget().value():"");a.persona.pepCaracterInvocado=(a.persona.esPep?a.ddlPersonaExpuestaCaracterInvocado.swidget().value():"0")}else{a.persona.PEPNombreIndirecto=((a.persona.esPep&&!a.persona.PEPTipo)?Core.Functions.Validations.getValidatedSwidgetValue(a.txtPersonaExpuestaIndirectamente,e):"");a.persona.pepCargo=(a.persona.esPep?Core.Functions.Validations.getValidatedSwidgetValue(a.txtPersonaExpuestaCargo,e):"");a.persona.pepAutoridadEmision=(a.persona.esPep?Core.Functions.Validations.getValidatedSwidgetValue(a.txtPersonaExpuestaAutoridad,e):"");a.persona.pepDenominacion=(a.persona.esPep?(a.esCuentaJuridica?Core.Functions.Validations.getValidatedSwidgetValue(a.txtPersonaExpuestaDenominacion,e):a.txtPersonaExpuestaDenominacion.swidget().value()):"");a.persona.pepCUIT=(a.persona.esPep?(a.esCuentaJuridica?Core.Functions.Validations.getValidatedSwidgetValue(a.txtPersonaExpuestaCuit,e):a.txtPersonaExpuestaCuit.swidget().value()):"");a.persona.pepCaracterInvocado=(a.persona.esPep?Core.Functions.Validations.getValidatedDropDownValue(a.ddlPersonaExpuestaCaracterInvocado,e):"0")}if(a.persona.pepCUIT&&!Core.Functions.Validations.isCuit(a.persona.pepCUIT)){e.value=false;Core.Functions.Validations.toggleValidation(a.txtPersonaExpuestaCuit,true);a.divAlert.text("Debe ingresar un Cuit válido (Persona Expuesta Políticamente).");a.divAlert.slideDown()}a.persona.pepObservaciones=(a.persona.esPep?a.txtPersonaExpuestaObservaciones.val():"")}if(e.value){if(a.onSave(a.persona)){if(c){a.container.modal("hide");a.destroy()}else{var d=new Core.Controls.Dialog("Aviso","Persona guardada correctamente",{displayButtons:{close:true,accept:false}});d.show()}}}else{$("html, body").animate({scrollTop:$(".cuenta").offset().top},1000)}};a.getPersonNoValidated=function(c){var e={value:true};if(a.persona==null){a.persona=new Core.Objects.Persona()}a.persona.tipo=a.ddlTipo.swidget().value();a.persona.nombre=a.txtNombre.swidget().value();a.persona.apellido=a.txtApellido.swidget().value();a.persona.idTipoDocumento=a.ddlTipoDocumento.swidget().value();a.persona.documento=a.txtDocumento.swidget().value();if(a.ddlTipoDocumento.swidget().value()==Core.Business.eTipoDocumento.PAS){a.persona.idPaisEmisionPasaporte=(!a.ddlPaisEmisionPasaporte.swidget().value())?0:a.ddlPaisEmisionPasaporte.swidget().value();a.persona.FechaVencimientoPasaporte=Core.Functions.Date.getDateAsString(a.txtFechaVencimientoPasaporte.swidget().value())}a.persona.nacionalidad=(!a.ddlNacionalidad.swidget().value())?0:a.ddlNacionalidad.swidget().value();if(!a.esCuentaJuridica&&a.ddlTipo.swidget().selectedItem()!=null&&a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Titular){a.persona.esCiudadanoEstadounidiense=a.getSiNo(a.chkCiudadaniaEeuuSi,a.chkCiudadaniaEeuuNo)}if(!a.esCuentaJuridica){a.persona.matcheoCaraManual=(a.chkMatchCara.swidget().checked())?1:0}a.persona.fechaNacimiento=Core.Functions.Date.getDateAsString(a.txtFechaNacimiento.swidget().value());a.persona.lugarNacimiento=a.txtLugarNacimiento.swidget().value();a.persona.domicilioParticularCalle=a.txtDomicilioRealCalle.swidget().value();a.persona.domicilioParticularNumero=(!a.txtDomicilioRealNumero.swidget().value())?0:a.txtDomicilioRealNumero.swidget().value();a.persona.domicilioParticularPiso=a.txtDomicilioRealPiso.val();a.persona.domicilioParticularDepartamento=a.txtDomicilioRealDepartamento.val();a.persona.domicilioParticularCiudad=a.txtDomicilioRealLocalidad.swidget().value();a.persona.domicilioParticularidPais=(!a.ddlDomicilioRealPais.swidget().selectedItem())?0:a.ddlDomicilioRealPais.swidget().value();a.persona.domicilioParticularidProvincia=(!a.ddlDomicilioRealProvincia.swidget().selectedItem())?0:a.ddlDomicilioRealProvincia.swidget().value();a.persona.domicilioParticularCodigoPostal=a.txtDomicilioRealCodigoPostal.swidget().value();a.persona.domicilioParticularTelefonoFijo=a.txtTelefonoParticularArea.swidget().value()+"-"+a.txtTelefonoParticularNumero.swidget().value();if((a.txtTelefonoParticularArea.swidget().value()||a.txtTelefonoParticularNumero.swidget().value())&&!a.isValidPhone(a.persona.domicilioParticularTelefonoFijo)){Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularArea,true);Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularNumero,true);e.value=false;a.divAlert.text("El teléfono ingresado no es válido.");a.divAlert.slideDown()}if(a.txtTelefonoParticularArea.swidget().value()&&!Core.Functions.Validations.isNumeric(a.txtTelefonoParticularArea.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularArea,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(a.txtTelefonoParticularNumero.swidget().value()&&!Core.Functions.Validations.isNumeric(a.txtTelefonoParticularNumero.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularNumero,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(a.ddlTelefonoCelularPais.swidget().selectedItem()!=null&&a.ddlTelefonoCelularPais.swidget().selectedItem().value==a.phoneCodeAr){a.persona.domicilioParticularTelefonoMovil="+"+a.ddlTelefonoCelularPais.swidget().selectedItem().value+"-"+a.txtTelefonoCelularArea.swidget().value()+"-"+a.txtTelefonoCelularNumero.swidget().value()}else{a.persona.domicilioParticularTelefonoMovil="+"+a.ddlTelefonoCelularPais.swidget().selectedItem().value+"-"+a.txtTelefonoCelularNumero.swidget().value()}if(((a.ddlTelefonoCelularPais.swidget().selectedItem().value==a.phoneCodeAr&&a.txtTelefonoCelularArea.swidget().value())||a.txtTelefonoCelularNumero.swidget().value())&&!a.isValidPhone(a.persona.domicilioParticularTelefonoMovil)){Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularArea,true);Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularNumero,true);e.value=false;a.divAlert.text("El teléfono ingresado no es válido.");a.divAlert.slideDown()}if(a.ddlTelefonoCelularPais.swidget().selectedItem().value==a.phoneCodeAr&&a.txtTelefonoCelularArea.swidget().value()&&!Core.Functions.Validations.isNumeric(a.txtTelefonoCelularArea.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularArea,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(a.txtTelefonoCelularNumero.swidget().value()&&!Core.Functions.Validations.isNumeric(a.txtTelefonoCelularNumero.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularNumero,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}a.persona.email=a.txtEmail.swidget().value();a.persona.sexo=a.ddlSexo.swidget().value();a.persona.idTipoIdentificadorFiscal=a.ddlTipoIdentificacionFiscal.swidget().value();a.persona.cuit_cuil=a.txtIdentificacionFiscal.val();a.persona.idTipoContribuyente=a.ddlCondicionIva.swidget().value();a.persona.inscripcionGanancias=(a.chkInscripcionGanancias.swidget().checked())?1:0;if(!a.esCuentaJuridica){a.persona.idOcupacion=a.ddlOcupacion.swidget().value()}else{a.persona.idOcupacion=a.ddlOcupacionPersonaJuridica.swidget().value()}a.persona.idEstadoCivil=a.ddlEstadoCivil.swidget().value();if(!a.esCuentaJuridica){a.persona.esSujetoObligado=(a.chkSujetoObligado.swidget().checked())?1:0}if(a.esCuentaJuridica||(a.ddlTipo.swidget()!=null&&a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Titular)){a.persona.esPep=a.getSiNo(a.chkPersonaExpuestaSi,a.chkPersonaExpuestaNo)}if(!a.esCuentaJuridica&&a.ddlTipo.swidget().selectedItem()!=null&&a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Titular&&a.ddlOcupacion.swidget().selectedItem()!=null){a.persona.cargo=((a.ddlOcupacion.swidget().selectedItem().TipoCampoAdicional==1)?a.txtCargoLaboral.swidget().value():"");a.persona.empresa=((a.ddlOcupacion.swidget().selectedItem().TipoCampoAdicional==1)?a.txtEmpresaLaboral.swidget().value():"");a.persona.EmpresaActividad=((a.ddlOcupacion.swidget().selectedItem().TipoCampoAdicional==1)?a.txtActividadEmpresa.swidget().value():"");a.persona.OcupacionDescripcion=((a.ddlOcupacion.swidget().selectedItem().TipoCampoAdicional==2)?a.txtOcupacionDescripcion.swidget().value():"");a.persona.domicilioLaboralCalle=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?a.txtDomicilioLaboralCalle.swidget().value():"");a.persona.domicilioLaboralNumero=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?((!a.txtDomicilioLaboralNumero.swidget().value())?0:a.txtDomicilioLaboralNumero.swidget().value()):"");a.persona.domicilioLaboralPiso=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?a.txtDomicilioLaboralPiso.val():"");a.persona.domicilioLaboralDepartamento=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?a.txtDomicilioLaboralDepartamento.val():"");a.persona.domicilioLaboralCiudad=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?a.txtDomicilioLaboralLocalidad.swidget().value():"");a.persona.domicilioLaboralidPais=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?((!a.ddlDomicilioLaboralPais.swidget().selectedItem())?0:a.ddlDomicilioLaboralPais.swidget().value()):0);a.persona.domicilioLaboralidProvincia=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?((!a.ddlDomicilioLaboralProvincia.swidget().selectedItem())?0:a.ddlDomicilioLaboralProvincia.swidget().value()):0);a.persona.domicilioLaboralCodigoPostal=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?a.txtDomicilioLaboralCodigoPostal.swidget().value():"");a.persona.domicilioLaboralTelefono=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?(a.txtTelefonoLaboralArea.val()+"-"+a.txtTelefonoLaboralNumero.val()):"");if(a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1){if((a.txtTelefonoLaboralArea.swidget().value()||a.txtTelefonoLaboralNumero.swidget().value())&&!a.isValidPhone(a.persona.domicilioLaboralTelefono)){Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralArea,true);Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralNumero,true);e.value=false;a.divAlert.text("El teléfono ingresado no es válido.");a.divAlert.slideDown()}if(!Core.Functions.Validations.isNumeric(a.txtTelefonoLaboralArea.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralArea,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(!Core.Functions.Validations.isNumeric(a.txtTelefonoLaboralNumero.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralNumero,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}}}else{if(a.esCuentaJuridica){a.persona.cargo=a.txtCargoLaboral.swidget().value();a.persona.EmpresaActividad=a.txtActividadEmpresa.swidget().value();a.persona.domicilioLaboralTelefono=a.txtTelefonoLaboralArea.val()+"-"+a.txtTelefonoLaboralNumero.val();if((a.txtTelefonoLaboralArea.swidget().value()||a.txtTelefonoLaboralNumero.swidget().value())&&!a.isValidPhone(a.persona.domicilioLaboralTelefono)){Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralArea,true);Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralNumero,true);e.value=false;a.divAlert.text("El teléfono ingresado no es válido.");a.divAlert.slideDown()}if(!Core.Functions.Validations.isNumeric(a.txtTelefonoLaboralArea.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralArea,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(!Core.Functions.Validations.isNumeric(a.txtTelefonoLaboralNumero.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralNumero,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}a.persona.fechaVencimientoMandato=Core.Functions.Date.getDateAsString(a.txtVencimientoCargoLaboral.swidget().value());a.persona.OcupacionDescripcion=((a.ddlOcupacionPersonaJuridica.swidget().selectedItem().TipoCampoAdicional==2)?a.txtOcupacionDescripcionPersonaJuridica.swidget().value():"")}}if(!a.esCuentaJuridica&&a.ddlTipo.swidget().selectedItem()!=null&&a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Titular){a.persona.conyugeNombre=((a.ddlEstadoCivil.swidget().selectedItem().value==Core.Business.eEstadoCivil.Casado)?a.txtConyugeNombre.swidget().value():"");a.persona.conyugeApellido=((a.ddlEstadoCivil.swidget().selectedItem().value==Core.Business.eEstadoCivil.Casado)?a.txtConyugeApellido.swidget().value():"");a.persona.conyugeidTipoDocumento=((a.ddlEstadoCivil.swidget().selectedItem().value==Core.Business.eEstadoCivil.Casado)?a.ddlConyugeTipoDocumento.swidget().value():"0");a.persona.conyugeDocumento=((a.ddlEstadoCivil.swidget().selectedItem().value==Core.Business.eEstadoCivil.Casado)?a.txtConyugeDocumento.val():"")}if(!a.esCuentaJuridica&&Core.Objects.Context.Configuration.idAplicacion==3){a.persona.montoCompliance=a.txtMontoCompliance.val();a.persona.idRiesgo=a.ddlRiesgoCliente.swidget().value()}else{if(!a.esCuentaJuridica){a.persona.montoCompliance=a.persona.montoCompliance;a.persona.idRiesgo=a.persona.idRiesgo}}a.persona.tributaEnOtroPais=a.getSiNo(a.chkTributaEnOtroPaisSi,a.chkTributaEnOtroPaisNo);if(a.persona.tributaEnOtroPais){a.persona.nitidTipoIdentificadorFiscal=a.ddlNitTipoIdentificacionFiscal.swidget().value();a.persona.nit=a.txtNit.val()}if((a.esCuentaJuridica||(a.ddlTipo.swidget().selectedItem()!=null&&a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Titular))){a.persona.PEPTipo=(a.chkPersonaExpuestaIndirectamente.swidget().checked())?0:1;a.persona.PEPNombreIndirecto=((a.persona.esPep&&!a.persona.PEPTipo)?a.txtPersonaExpuestaIndirectamente.val():"");a.persona.pepCargo=(a.persona.esPep?a.txtPersonaExpuestaCargo.swidget().value():"");a.persona.pepAutoridadEmision=(a.persona.esPep?a.txtPersonaExpuestaAutoridad.swidget().value():"");a.persona.pepDenominacion=(a.persona.esPep?a.txtPersonaExpuestaDenominacion.swidget().value():"");a.persona.pepCUIT=(a.persona.esPep?a.txtPersonaExpuestaCuit.swidget().value():"");a.persona.pepObservaciones=(a.persona.esPep?a.txtPersonaExpuestaObservaciones.val():"");a.persona.pepCaracterInvocado=(a.persona.esPep?a.ddlPersonaExpuestaCaracterInvocado.swidget().value():"0")}if(e.value){if(a.onSave(a.persona)){if(c){a.container.modal("hide");a.destroy()}else{var d=new Core.Controls.Dialog("Aviso","Persona guardada correctamente",{displayButtons:{close:true,accept:false}});d.show()}}}else{$("html, body").animate({scrollTop:$(".cuenta").offset().top},1000)}};a.destroy=function(){a.ddlTipo.swidget().destroy();a.txtNombre.swidget().destroy();a.txtApellido.swidget().destroy();a.ddlTipoDocumento.swidget().destroy();a.txtDocumento.swidget().destroy();a.ddlPaisEmisionPasaporte.swidget().destroy();a.txtFechaVencimientoPasaporte.swidget().destroy();a.ddlPaisIdentificacionFiscal.swidget().destroy();a.ddlTipoIdentificacionFiscal.swidget().destroy();a.txtIdentificacionFiscal.swidget().destroy();a.ddlNacionalidad.swidget().destroy();a.chkMatchCara.swidget().destroy();a.txtFechaNacimiento.swidget().destroy();a.txtLugarNacimiento.swidget().destroy();a.txtDomicilioRealCalle.swidget().destroy();a.txtDomicilioRealNumero.swidget().destroy();a.txtDomicilioRealPiso.swidget().destroy();a.txtDomicilioRealDepartamento.swidget().destroy();a.txtDomicilioRealLocalidad.swidget().destroy();a.ddlDomicilioRealPais.swidget().destroy();a.ddlDomicilioRealProvincia.swidget().destroy();a.txtDomicilioRealCodigoPostal.swidget().destroy();a.txtDomicilioLaboralCalle.swidget().destroy();a.txtDomicilioLaboralNumero.swidget().destroy();a.txtDomicilioLaboralPiso.swidget().destroy();a.txtDomicilioLaboralDepartamento.swidget().destroy();a.txtDomicilioLaboralLocalidad.swidget().destroy();a.ddlDomicilioLaboralPais.swidget().destroy();a.ddlDomicilioLaboralProvincia.swidget().destroy();a.txtDomicilioLaboralCodigoPostal.swidget().destroy();a.txtTelefonoParticularArea.swidget().destroy();a.txtTelefonoParticularNumero.swidget().destroy();a.ddlTelefonoCelularPais.swidget().destroy();a.txtTelefonoCelularArea.swidget().destroy();a.txtTelefonoCelularNumero.swidget().destroy();a.txtTelefonoLaboralArea.swidget().destroy();a.txtTelefonoLaboralNumero.swidget().destroy();a.txtCargoLaboral.swidget().destroy();a.txtVencimientoCargoLaboral.swidget().destroy();a.txtEmpresaLaboral.swidget().destroy();a.txtActividadEmpresa.swidget().destroy();a.txtOcupacionDescripcionPersonaJuridica.swidget().destroy();a.txtOcupacionDescripcion.swidget().destroy();a.txtEmail.swidget().destroy();a.ddlSexo.swidget().destroy();a.ddlCondicionIva.swidget().destroy();a.chkInscripcionGanancias.swidget().destroy();a.ddlEstadoCivil.swidget().destroy();a.ddlOcupacion.swidget().destroy();a.ddlOcupacionPersonaJuridica.swidget().destroy();a.chkSujetoObligado.swidget().destroy();a.txtConyugeNombre.swidget().destroy();a.txtConyugeApellido.swidget().destroy();a.ddlConyugeTipoDocumento.swidget().destroy();a.txtConyugeDocumento.swidget().destroy();a.txtPersonaExpuestaCargo.swidget().destroy();a.txtPersonaExpuestaAutoridad.swidget().destroy();a.ddlPersonaExpuestaCaracterInvocado.swidget().destroy();a.txtPersonaExpuestaDenominacion.swidget().destroy();a.txtPersonaExpuestaCuit.swidget().destroy();a.txtPersonaExpuestaObservaciones.swidget().destroy();a.txtPersonaExpuestaIndirectamente.swidget().destroy();a.ddlPaisTributo.swidget().destroy();a.ddlNitTipoIdentificacionFiscal.swidget().destroy();a.txtNit.swidget().destroy();a.ddlRiesgoCliente.swidget().destroy();a.container.html("");a.onClose()};a.setControls=function(c){a.divDatosConyuge.hide();a.divDatosLaboral.hide();a.divEmpresaLaboral.hide();a.divCargoLaboral.hide();a.divVencimientoCargoLaboral.hide();a.divActividadEmpresa.hide();a.divOcupacionDescripcion.hide();a.divOcupacionDescripcionPersonaJuridica.hide();a.divDomicilioLaboral.hide();a.divTelefonoLaboral.hide();a.divDatosPersonaExpuesta.hide();a.divPersonaExpuestaIndirectamente.hide();a.divNitTipoIdentificacionFiscal.hide();a.divNit.hide();a.divPaisTributo.hide();if(!a.esCuentaJuridica&&a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Titular&&a.ddlEstadoCivil.swidget().selectedItem().value==Core.Business.eEstadoCivil.Casado){a.divDatosConyuge.show()}if(!a.esCuentaJuridica&&a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Titular&&a.ddlOcupacion.swidget().selectedItem()!=null){if(a.ddlOcupacion.swidget().selectedItem().TipoCampoAdicional==1){a.divDatosLaboral.show();a.divEmpresaLaboral.show();a.divCargoLaboral.show();a.divActividadEmpresa.show()}if(a.ddlOcupacion.swidget().selectedItem().TipoCampoAdicional==2){a.divDatosLaboral.show();a.divOcupacionDescripcion.show()}if(a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1){a.divDatosLaboral.show();a.divDomicilioLaboral.show();a.divTelefonoLaboral.show()}}else{if(a.esCuentaJuridica){a.divDatosLaboral.show();a.divCargoLaboral.show();a.divVencimientoCargoLaboral.show();a.divActividadEmpresa.show();a.divTelefonoLaboral.show();if(a.ddlOcupacionPersonaJuridica.swidget().selectedItem()!=null&&a.ddlOcupacionPersonaJuridica.swidget().selectedItem().TipoCampoAdicional==2){a.divOcupacionDescripcionPersonaJuridica.show()}}}if(a.chkTributaEnOtroPaisSi.swidget().checked()){a.divPaisTributo.show();a.divNitTipoIdentificacionFiscal.show();a.divNit.show()}a.divCiudadaniaEeuu.hide();if(!a.esCuentaJuridica&&a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Titular){a.divCiudadaniaEeuu.show()}a.divPersonaExpuesta.hide();if(a.esCuentaJuridica||a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Titular){a.divPersonaExpuesta.show();if(a.chkPersonaExpuestaSi.swidget().checked()){a.divDatosPersonaExpuesta.show();if(a.chkPersonaExpuestaIndirectamente.swidget().checked()){a.divPersonaExpuestaIndirectamente.show()}}}a.setProvincias(a.ddlDomicilioRealPais.swidget().value(),a.ddlDomicilioRealProvincia,(c&&a.persona&&a.persona.domicilioParticularidProvincia!=null)?a.persona.domicilioParticularidProvincia.toString():null);a.setProvincias(a.ddlDomicilioLaboralPais.swidget().value(),a.ddlDomicilioLaboralProvincia,(c&&a.persona&&a.persona.domicilioLaboralidProvincia!=null)?a.persona.domicilioLaboralidProvincia.toString():null);a.setTiposIdentificadoresFiscales(a.ddlPaisIdentificacionFiscal.swidget().value(),a.ddlTipoIdentificacionFiscal,(c&&a.persona&&a.persona.idTipoIdentificadorFiscal!=null)?a.persona.idTipoIdentificadorFiscal.toString():null);a.setTiposIdentificadoresFiscales(a.ddlPaisTributo.swidget().value(),a.ddlNitTipoIdentificacionFiscal,(c&&a.persona&&a.persona.nitidTipoIdentificadorFiscal!=null)?a.persona.nitidTipoIdentificadorFiscal.toString():null);a.ddlPersonaExpuestaCaracterInvocado.swidget().value(a.ddlTipo.swidget().selectedItem().Descripcion);a.chkInscripcionGanancias.swidget().enabled(true);a.ddlCondicionIva.swidget().enabled(true);if(a.esCuentaJuridica&&(a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Accionista||a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.BeneficiarioFinal)){a.chkInscripcionGanancias.swidget().enabled(false);a.chkInscripcionGanancias.swidget().checked(false);a.ddlCondicionIva.swidget().enabled(false);a.ddlCondicionIva.swidget().value(Core.Business.eCondicionIVA.NoResponsable.toString())}a.divPaisEmisionPasaporte.hide();a.divFechaVencimientoPasaporte.hide();if(a.ddlTipoDocumento.swidget().value()==Core.Business.eTipoDocumento.PAS){a.divPaisEmisionPasaporte.show();a.divFechaVencimientoPasaporte.show()}};a.setProvincias=function(d,c,g){var f=$.grep(a.dataParametros.provincias,function(i,h){return i.idPais==d});var e=c.swidget().initialOptions;e.dataSource.data=f;if(g!=null){e.value=g}c.swidget().refresh(e)};a.setTiposIdentificadoresFiscales=function(d,c,g){var f=$.grep(a.dataParametros.tiposIdentificadoresFiscales,function(i,h){return i.idPais==d&&i.Fisica});var e=c.swidget().initialOptions;e.dataSource.data=f;if(g!=null){e.value=g}c.swidget().refresh(e)};a.validFechaNacimiento=function(d){if(!d){return false}else{if(d.getFullYear()<=1900){return false}else{d.setHours(0,0,0,0);var e=new Date();e.setHours(0,0,0,0);var c=(e.getTime()-d.getTime())/1000/60/60/24/365;if(c<18){return false}return true}}};a.isValidEmailAddress=function(c){if(!c){return false}else{var d=/^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i;if(!d.test(c)){return false}return true}};a.isValidPhone=function(c){var e=c.replaceAll("-","");var d=/^[0-9+]+$/;if(!d.test(e)||e.length<10||e.length>17){return false}return true};a.validDocumento=function(c,d,e){if(c==Core.Business.eTipoDocumento.DNI){if(d.length<6||d.length>8||!Core.Functions.Validations.isNumeric(d)){return false}return true}return true};a.validDniFiscalIdentifier=function(c,d,e){if(c&&d&&d.indexOf(c)==-1){return false}else{return true}};a.setTelefonoCelularControls=function(){a.divTelefonoCelularArea.hide();a.txtTelefonoCelularArea.val("");a.divTelefonoCelularNumero.removeClass("col-lg-3");a.divTelefonoCelularNumero.removeClass("col-md-3");a.divTelefonoCelularNumero.addClass("col-lg-4");a.divTelefonoCelularNumero.addClass("col-md-4");if(a.ddlTelefonoCelularPais.swidget().selectedItem().value==a.phoneCodeAr){a.divTelefonoCelularNumero.removeClass("col-lg-4");a.divTelefonoCelularNumero.removeClass("col-md-4");a.divTelefonoCelularNumero.addClass("col-lg-3");a.divTelefonoCelularNumero.addClass("col-md-3");a.divTelefonoCelularArea.show()}};a.getDate=function(c){var d=c.substr(6,2);var e=c.substr(4,2);var g=c.substr(0,4);var f=new Date();f.setDate(1);f.setYear(g);f.setMonth(e-1);f.setDate(d);return f};a.getSiNo=function(d,c,f,e){if(d.swidget().checked()){return 1}else{if(c.swidget().checked()){return 0}else{if(!f){return -1}else{f.value=false;a.divAlert.text(e);a.divAlert.slideDown();return -1}}}};a.isValidPerson=function(h,c){if(c!=0){var i=$.grep(a.dataParametros.tiposIdentificadoresFiscales,function(k,j){return k.idTipoIdentificadorFiscal==h.idTipoIdentificadorFiscal})[0];if(!h.tipo||!h.nombre||!h.apellido||!h.idTipoDocumento||!h.documento||!a.validDocumento(h.idTipoDocumento,h.documento)||!h.nacionalidad||!h.fechaNacimiento||!h.lugarNacimiento||!h.idTipoIdentificadorFiscal||(h.cuit_cuil&&i&&i.idPais==a.idPais_Argentina&&(!Core.Functions.Validations.isCuit(h.cuit_cuil)||!Core.Functions.Validations.isNumeric(h.cuit_cuil)))||(h.idTipoDocumento==Core.Business.eTipoDocumento.DNI&&i.idPais==a.idPais_Argentina&&(!h.cuit_cuil||!a.validDniFiscalIdentifier(h.documento,h.cuit_cuil)))||!h.idTipoContribuyente||!h.idEstadoCivil||!h.idOcupacion||(h.idTipoDocumento==Core.Business.eTipoDocumento.PAS&&(!h.idPaisEmisionPasaporte||!h.FechaVencimientoPasaporte))){return false}if(!a.esCuentaJuridica||(h.tipo!=Core.Business.eTipoPersonaCuenta.Accionista&&h.tipo!=Core.Business.eTipoPersonaCuenta.BeneficiarioFinal)){if(!h.domicilioParticularCalle||(h.domicilioParticularidPais==a.idPais_Argentina&&!h.domicilioParticularNumero)||!h.domicilioParticularCiudad||!h.domicilioParticularidPais||!h.domicilioParticularidProvincia||!h.domicilioParticularCodigoPostal||!h.email||!a.isValidEmailAddress(h.email)){return false}}else{if(h.email&&!a.isValidEmailAddress(h.email)){return false}}var d=new Date();d.setFullYear(h.fechaNacimiento.substr(0,4));d.setMonth(h.fechaNacimiento.substr(4,2)-1);d.setDate(h.fechaNacimiento.substr(6,2));if(!a.validFechaNacimiento(d)){return false}var f=h.domicilioParticularTelefonoFijo.split("-");if(!Core.Functions.Validations.isNumeric(f[0])||!Core.Functions.Validations.isNumeric(f[1])){return false}if((f[0]||f[1])&&!a.isValidPhone(h.domicilioParticularTelefonoFijo)){return false}var g=h.domicilioParticularTelefonoMovil.split("-");if(g.length==2&&(!Core.Functions.Validations.isNumeric(g[0].replaceAll("\\+",""))||!Core.Functions.Validations.isNumeric(g[1]))){return false}if(g.length==3&&(!Core.Functions.Validations.isNumeric(g[1])||!Core.Functions.Validations.isNumeric(g[2]))){return false}if(!a.esCuentaJuridica||(h.tipo!=Core.Business.eTipoPersonaCuenta.Accionista&&h.tipo!=Core.Business.eTipoPersonaCuenta.BeneficiarioFinal)){if(g.length==2&&(g[0]==""||g[1]=="")){return false}if(g.length==3&&(g[1]==""||g[2]=="")){return false}if(!a.isValidPhone(h.domicilioParticularTelefonoMovil)){return false}}else{if((g.length==2&&(g[0]!=""||g[1]!=""))||(g.length==3&&(g[1]!=""||g[2]!=""))){if(!a.isValidPhone(h.domicilioParticularTelefonoMovil)){return false}}}if(!a.esCuentaJuridica&&h.tipo==Core.Business.eTipoPersonaCuenta.Titular&&(h.idOcupacion==2||h.idOcupacion==3||h.idOcupacion==6||h.idOcupacion==7||h.idOcupacion==8)){if((h.idOcupacion==2||h.idOcupacion==3)&&(!h.cargo||!h.empresa||!h.EmpresaActividad)){return false}if((h.idOcupacion==6||h.idOcupacion==7||h.idOcupacion==8)&&(!h.OcupacionDescripcion)){return false}if(h.domicilioLaboralTelefono){var e=h.domicilioLaboralTelefono.split("-");if(!Core.Functions.Validations.isNumeric(e[0])||!Core.Functions.Validations.isNumeric(e[1])){return false}if((e[0]||e[1])&&!a.isValidPhone(h.domicilioLaboralTelefono)){return false}}}if(a.esCuentaJuridica&&h.tipo!=Core.Business.eTipoPersonaCuenta.Accionista&&h.tipo!=Core.Business.eTipoPersonaCuenta.BeneficiarioFinal){if((h.idOcupacion==6||h.idOcupacion==7||h.idOcupacion==8)&&(!h.OcupacionDescripcion)){return false}if(!h.cargo||!h.EmpresaActividad||!h.fechaVencimientoMandato){return false}}if(!a.esCuentaJuridica&&h.tipo==Core.Business.eTipoPersonaCuenta.Titular&&h.idEstadoCivil==Core.Business.eEstadoCivil.Casado){if(!h.conyugeNombre||!h.conyugeApellido||!h.conyugeidTipoDocumento||(h.conyugeDocumento&&!a.validDocumento(h.conyugeDocumento,h.conyugeidTipoDocumento))){return false}}if((a.esCuentaJuridica&&h.tipo!=Core.Business.eTipoPersonaCuenta.Accionista&&h.tipo!=Core.Business.eTipoPersonaCuenta.BeneficiarioFinal)||h.tipo==Core.Business.eTipoPersonaCuenta.Titular){if(h.esPep<0){return false}if(h.esPep){if(!h.pepCargo||!h.pepAutoridadEmision||!h.pepCaracterInvocado){return false}if(a.esCuentaJuridica&&(!h.pepCUIT||!Core.Functions.Validations.isCuit(h.pepCUIT)||!h.pepDenominacion)){return false}if(h.tipo==Core.Business.eTipoPersonaCuenta.Titular&&h.pepCUIT&&!Core.Functions.Validations.isCuit(h.pepCUIT)){return false}if(!h.PEPTipo&&!h.PEPNombreIndirecto){return false}}}if(a.esCuentaJuridica&&(h.tipo==Core.Business.eTipoPersonaCuenta.Accionista||h.tipo==Core.Business.eTipoPersonaCuenta.BeneficiarioFinal)){if(h.esPep<0){return false}if(h.esPep){if(h.pepCUIT&&!Core.Functions.Validations.isCuit(h.pepCUIT)){return false}}}if(!a.esCuentaJuridica&&h.tipo==Core.Business.eTipoPersonaCuenta.Titular&&h.esCiudadanoEstadounidiense<0){return false}if(h.tributaEnOtroPais<0){return false}if(h.tributaEnOtroPais){var i=$.grep(a.dataParametros.tiposIdentificadoresFiscales,function(k,j){return k.idTipoIdentificadorFiscal==h.nitidTipoIdentificadorFiscal})[0];if(!h.nitidTipoIdentificadorFiscal||!h.nit||(i&&i.idPais==a.idPais_Argentina&&Core.Functions.Validations.isCuit(h.nit))){return false}}if(!a.esCuentaJuridica&&Core.Objects.Context.Configuration.idAplicacion==3&&c>=10&&(!h.montoCompliance||h.montoCompliance==0||!h.idRiesgo)){return false}}return true}};Core.Controls.ManagerPersonaBCI=function(b){var a=this;a.persona=null;a.dataParametros=null;a.dataParametrosUsuario=null;a.onSave=function(c){};a.onClose=function(){};a.container=null;a.idTipoValidacion=0;a.idAperturaCuenta=0;a.readOnly=false;a.optionsApertura=false;a.namespaceActivo="";a.divMatrizRiesgo=null;a.esCuentaJuridica=true;a.defaultPersonaExpuestaDenominacion="";a.defaultPersonaExpuestaCuit="";$.extend(true,a,b);a.phoneCodeAr=$.grep(Core.Objects.Contry,function(d,c){return d.iso_code=="AR"})[0].phone_code;a.idPais_Argentina=1;a.title=null;a.divInformes=null;a.divTipo=null;a.ddlTipo=null;a.divNombre=null;a.txtNombre=null;a.divApellido=null;a.txtApellido=null;a.divTipoDocumento=null;a.ddlTipoDocumento=null;a.divDocumento=null;a.txtDocumento=null;a.divPaisEmisionPasaporte=null;a.ddlPaisEmisionPasaporte=null;a.divFechaVencimientoPasaporte=null;a.txtFechaVencimientoPasaporte=null;a.divNacionalidad=null;a.ddlNacionalidad=null;a.divPaisIdentificacionFiscal=null;a.ddlPaisIdentificacionFiscal=null;a.divTipoIdentificacionFiscal=null;a.ddlTipoIdentificacionFiscal=null;a.divIdentificacionFiscal=null;a.txtIdentificacionFiscal=null;a.divCiudadaniaEeuu=null;a.chkCiudadaniaEeuuSi=null;a.chkCiudadaniaEeuuNo=null;a.divFechaNacimiento=null;a.txtFechaNacimiento=null;a.divLugarNacimiento=null;a.txtLugarNacimiento=null;a.divDomicilioRealCalle=null;a.txtDomicilioRealCalle=null;a.divDomicilioRealNumero=null;a.txtDomicilioRealNumero=null;a.divDomicilioRealPiso=null;a.txtDomicilioRealPiso=null;a.divDomicilioRealDepartamento=null;a.txtDomicilioRealDepartamento=null;a.divDomicilioRealLocalidad=null;a.txtDomicilioRealLocalidad=null;a.divDomicilioRealPais=null;a.ddlDomicilioRealPais=null;a.divDomicilioRealProvincia=null;a.ddlDomicilioRealProvincia=null;a.divDomicilioRealCodigoPostal=null;a.txtDomicilioRealCodigoPostal=null;a.divDomicilioLaboral=null;a.divDomicilioLaboralCalle=null;a.txtDomicilioLaboralCalle=null;a.divDomicilioLaboralNumero=null;a.txtDomicilioLaboralNumero=null;a.divDomicilioLaboralPiso=null;a.txtDomicilioLaboralPiso=null;a.divDomicilioLaboralDepartamento=null;a.txtDomicilioLaboralDepartamento=null;a.divDomicilioLaboralLocalidad=null;a.txtDomicilioLaboralLocalidad=null;a.divDomicilioLaboralPais=null;a.ddlDomicilioLaboralPais=null;a.divDomicilioLaboralProvincia=null;a.ddlDomicilioLaboralProvincia=null;a.divDomicilioLaboralCodigoPostal=null;a.txtDomicilioLaboralCodigoPostal=null;a.divTelefonoParticularArea=null;a.txtTelefonoParticularArea=null;a.divTelefonoParticularNumero=null;a.txtTelefonoParticularNumero=null;a.divTelefonoCelularPais=null;a.ddlTelefonoCelularPais=null;a.divTelefonoCelularArea=null;a.txtTelefonoCelularArea=null;a.divTelefonoCelularNumero=null;a.txtTelefonoCelularNumero=null;a.divTelefonoLaboral=null;a.divTelefonoLaboralArea=null;a.txtTelefonoLaboralArea=null;a.divTelefonoLaboralNumero=null;a.txtTelefonoLaboralNumero=null;a.divEmailLaboral=null;a.txtEmailLaboral=null;a.divOcupacionDescripcion=null;a.txtOcupacionDescripcion=null;a.divOcupacionDescripcionPersonaJuridica=null;a.txtOcupacionDescripcionPersonaJuridica=null;a.divEmpresaLaboral=null;a.txtEmpresaLaboral=null;a.divActividadEmpresa=null;a.txtActividadEmpresa=null;a.divCargoLaboral=null;a.txtCargoLaboral=null;a.divCargoLaboralAntiguedad=null;a.txtCargoLaboralAntiguedad=null;a.divVencimientoCargoLaboral=null;a.txtVencimientoCargoLaboral=null;a.divEmail=null;a.txtEmail=null;a.divSexo=null;a.ddlSexo=null;a.chkTributaEnOtroPaisSi=null;a.chkTributaEnOtroPaisNo=null;a.divPaisTributo=null;a.ddlPaisTributo=null;a.divMontoCompliance=null;a.controlMontoCompliance=null;a.txtMontoCompliance=null;a.ddlRiesgoCliente=null;a.divNitTipoIdentificacionFiscal=null;a.ddlNitTipoIdentificacionFiscal=null;a.divNit=null;a.txtNit=null;a.divEstadoCivil=null;a.ddlEstadoCivil=null;a.divOcupacionPersonaJuridica=null;a.ddlOcupacionPersonaJuridica=null;a.divOcupacion=null;a.ddlOcupacion=null;a.divPersonaExpuesta=null;a.chkPersonaExpuestaSi=null;a.chkPersonaExpuestaNo=null;a.divDatosLaboral=null;a.divDatosConyuge=null;a.divDatosPersonaExpuesta=null;a.divConyugeNombre=null;a.txtConyugeNombre=null;a.divConyugeApellido=null;a.txtConyugeApellido=null;a.divConyugeTipoDocumento=null;a.ddlConyugeTipoDocumento=null;a.divConyugeDocumento=null;a.txtConyugeDocumento=null;a.chkPersonaExpuestaDirectamente=null;a.chkPersonaExpuestaIndirectamente=null;a.divPersonaExpuestaIndirectamente=null;a.txtPersonaExpuestaIndirectamente=null;a.txtPersonaExpuestaIndirectamenteRelacion=null;a.divPersonaExpuestaCargo=null;a.txtPersonaExpuestaCargo=null;a.divPersonaExpuestaAutoridad=null;a.txtPersonaExpuestaAutoridad=null;a.divPersonaExpuestaCaracterInvocado=null;a.ddlPersonaExpuestaCaracterInvocado=null;a.divPersonaExpuestaDenominacion=null;a.lblPersonaExpuestaDenominacion=null;a.txtPersonaExpuestaDenominacion=null;a.divPersonaExpuestaCuit=null;a.lblPersonaExpuestaCuit=null;a.txtPersonaExpuestaCuit=null;a.divPersonaExpuestaObservaciones=null;a.txtPersonaExpuestaObservaciones=null;a.divImagenes=null;a.anchorFrenteDocumento=null;a.imgFrenteDocumento=null;a.anchorFotoCliente=null;a.imgFotoCliente=null;a.divMatchCara=null;a.chkMatchCara=null;a.divAlert=null;a.divCalcularMatrizRiesgo=null;a.btnCalcularMatrizRiesgo=null;a.btnConsultarMatrizRiesgo=null;a.btnVolver=null;a.btnConfirmarYCerrar=null;a.show=function(){$("html, body").animate({scrollTop:$(".cuenta").offset().top},1000);a.pageOptions=Core.Functions.Context.Profiles.getPageOptionsByMenu("matrizDeRiesgo",Core.Objects.Context.Profiles[0]);a.container.html("");a.container.load("/Pages/manager-persona-bci.html",function(s,t,z){if(t=="success"){a.container.show();a.divMatrizRiesgo.hide();a.title=a.container.find(".title-manager");a.title.text((a.persona)?"Alta Cuenta BCI/ Editar Persona":"Alta Cuenta BCI/ Nueva Persona");a.divInformes=a.container.find(".div-persona-informes");a.divDatosLaboral=a.container.find(".div-datos-laboral");a.divDatosConyuge=a.container.find(".div-datos-conyuge");a.divDatosPersonaExpuesta=a.container.find(".div-datos-persona-expuesta");a.divTipo=a.container.find(".div-tipo");a.ddlTipo=a.container.find(".dropdown-tipo");a.divNombre=a.container.find(".div-nombre");a.txtNombre=a.container.find(".textbox-nombre");a.divApellido=a.container.find(".div-apellido");a.txtApellido=a.container.find(".textbox-apellido");a.divTipoDocumento=a.container.find(".div-tipo-documento");a.ddlTipoDocumento=a.container.find(".dropdown-tipo-documento");a.divDocumento=a.container.find(".div-documento");a.txtDocumento=a.container.find(".textbox-documento");a.divPaisEmisionPasaporte=a.container.find(".div-pais-emision-pasaporte");a.ddlPaisEmisionPasaporte=a.container.find(".dropdown-pais-emision-pasaporte");a.divFechaVencimientoPasaporte=a.container.find(".div-fecha-vencimiento-pasaporte");a.txtFechaVencimientoPasaporte=a.container.find(".date-picker-fecha-vencimiento-pasaporte");a.divNacionalidad=a.container.find(".div-nacionalidad");a.ddlNacionalidad=a.container.find(".dropdown-nacionalidad");a.divPaisIdentificacionFiscal=a.container.find(".div-pais-identificacion-fiscal");a.ddlPaisIdentificacionFiscal=a.container.find(".dropdown-pais-identificacion-fiscal");a.divTipoIdentificacionFiscal=a.container.find(".div-tipo-identificacion-fiscal");a.ddlTipoIdentificacionFiscal=a.container.find(".dropdown-tipo-identificacion-fiscal");a.divIdentificacionFiscal=a.container.find(".div-identificacion-fiscal");a.txtIdentificacionFiscal=a.container.find(".textbox-identificacion-fiscal");a.divCiudadaniaEeuu=a.container.find(".div-ciudadania-eeuu");a.chkCiudadaniaEeuuSi=a.container.find(".chk-ciudadania-eeuu-si");a.chkCiudadaniaEeuuNo=a.container.find(".chk-ciudadania-eeuu-no");a.divFechaNacimiento=a.container.find(".div-fecha-nacimiento");a.txtFechaNacimiento=a.container.find(".date-picker-fecha-nacimiento");a.divLugarNacimiento=a.container.find(".div-lugar-nacimiento");a.txtLugarNacimiento=a.container.find(".textbox-lugar-nacimiento");a.divDomicilioRealCalle=a.container.find(".div-domicilio-real-calle");a.txtDomicilioRealCalle=a.container.find(".textbox-domicilio-real-calle");a.divDomicilioRealNumero=a.container.find(".div-domicilio-real-numero");a.txtDomicilioRealNumero=a.container.find(".textbox-domicilio-real-numero");a.divDomicilioRealPiso=a.container.find(".div-domicilio-real-piso");a.txtDomicilioRealPiso=a.container.find(".textbox-domicilio-real-piso");a.divDomicilioRealDepartamento=a.container.find(".div-domicilio-real-departamento");a.txtDomicilioRealDepartamento=a.container.find(".textbox-domicilio-real-departamento");a.divDomicilioRealLocalidad=a.container.find(".div-domicilio-real-localidad");a.txtDomicilioRealLocalidad=a.container.find(".textbox-domicilio-real-localidad");a.divDomicilioRealPais=a.container.find(".div-domicilio-real-pais");a.ddlDomicilioRealPais=a.container.find(".dropdown-domicilio-real-pais");a.divDomicilioRealProvincia=a.container.find(".div-domicilio-real-provincia");a.ddlDomicilioRealProvincia=a.container.find(".dropdown-domicilio-real-provincia");a.divDomicilioRealCodigoPostal=a.container.find(".div-domicilio-real-codigo-postal");a.txtDomicilioRealCodigoPostal=a.container.find(".textbox-domicilio-real-codigo-postal");a.divDomicilioLaboral=a.container.find(".div-domicilio-laboral");a.divDomicilioLaboralCalle=a.container.find(".div-domicilio-laboral-calle");a.txtDomicilioLaboralCalle=a.container.find(".textbox-domicilio-laboral-calle");a.divDomicilioLaboralNumero=a.container.find(".div-domicilio-laboral-numero");a.txtDomicilioLaboralNumero=a.container.find(".textbox-domicilio-laboral-numero");a.divDomicilioLaboralPiso=a.container.find(".div-domicilio-laboral-piso");a.txtDomicilioLaboralPiso=a.container.find(".textbox-domicilio-laboral-piso");a.divDomicilioLaboralDepartamento=a.container.find(".div-domicilio-laboral-departamento");a.txtDomicilioLaboralDepartamento=a.container.find(".textbox-domicilio-laboral-departamento");a.divDomicilioLaboralLocalidad=a.container.find(".div-domicilio-laboral-localidad");a.txtDomicilioLaboralLocalidad=a.container.find(".textbox-domicilio-laboral-localidad");a.divDomicilioLaboralPais=a.container.find(".div-domicilio-laboral-pais");a.ddlDomicilioLaboralPais=a.container.find(".dropdown-domicilio-laboral-pais");a.divDomicilioLaboralProvincia=a.container.find(".div-domicilio-laboral-provincia");a.ddlDomicilioLaboralProvincia=a.container.find(".dropdown-domicilio-laboral-provincia");a.divDomicilioLaboralCodigoPostal=a.container.find(".div-domicilio-laboral-codigo-postal");a.txtDomicilioLaboralCodigoPostal=a.container.find(".textbox-domicilio-laboral-codigo-postal");a.divTelefonoParticularArea=a.container.find(".div-telefono-particular-area");a.txtTelefonoParticularArea=a.container.find(".textbox-telefono-particular-area");a.divTelefonoParticularNumero=a.container.find(".div-telefono-particular-numero");a.txtTelefonoParticularNumero=a.container.find(".textbox-telefono-particular-numero");a.divTelefonoCelularPais=a.container.find(".div-telefono-celular-pais");a.ddlTelefonoCelularPais=a.container.find(".dropdown-telefono-celular-pais");a.divTelefonoCelularArea=a.container.find(".div-telefono-celular-area");a.txtTelefonoCelularArea=a.container.find(".textbox-telefono-celular-area");a.divTelefonoCelularNumero=a.container.find(".div-telefono-celular-numero");a.txtTelefonoCelularNumero=a.container.find(".textbox-telefono-celular-numero");a.divTelefonoLaboral=a.container.find(".div-telefono-laboral");a.divTelefonoLaboralArea=a.container.find(".div-telefono-laboral-area");a.txtTelefonoLaboralArea=a.container.find(".textbox-telefono-laboral-area");a.divTelefonoLaboralNumero=a.container.find(".div-telefono-laboral-numero");a.txtTelefonoLaboralNumero=a.container.find(".textbox-telefono-laboral-numero");a.divEmailLaboral=a.container.find(".div-email-laboral");a.txtEmailLaboral=a.container.find(".textbox-email-laboral");a.divCargoLaboral=a.container.find(".div-cargo-laboral");a.txtCargoLaboral=a.container.find(".textbox-cargo-laboral");a.divCargoLaboralAntiguedad=a.container.find(".div-cargo-laboral-antiguedad");a.txtCargoLaboralAntiguedad=a.container.find(".textbox-cargo-laboral-antiguedad");a.divVencimientoCargoLaboral=a.container.find(".div-vencimiento-cargo-laboral");a.txtVencimientoCargoLaboral=a.container.find(".date-picker-vencimiento-cargo-laboral");a.divEmpresaLaboral=a.container.find(".div-empresa-laboral");a.txtEmpresaLaboral=a.container.find(".textbox-empresa-laboral");a.divActividadEmpresa=a.container.find(".div-actividad-empresa");a.txtActividadEmpresa=a.container.find(".textbox-actividad-empresa");a.divOcupacionDescripcion=a.container.find(".div-ocupacion-descripcion");a.txtOcupacionDescripcion=a.container.find(".textbox-ocupacion-descripcion");a.divOcupacionDescripcionPersonaJuridica=a.container.find(".div-ocupacion-descripcion-persona-juridica");a.txtOcupacionDescripcionPersonaJuridica=a.container.find(".textbox-ocupacion-descripcion-persona-juridica");a.divEmail=a.container.find(".div-email");a.txtEmail=a.container.find(".textbox-email");a.divSexo=a.container.find(".div-sexo");a.ddlSexo=a.container.find(".dropdown-sexo");a.divTributaEnOtroPais=a.container.find(".div-tributas-otro-pais");a.chkTributaEnOtroPaisSi=a.container.find(".chk-tributas-otro-pais-si");a.chkTributaEnOtroPaisNo=a.container.find(".chk-tributas-otro-pais-no");a.divPaisTributo=a.container.find(".div-pais-tributo");a.ddlPaisTributo=a.container.find(".dropdown-pais-tributo");a.divNitTipoIdentificacionFiscal=a.container.find(".div-nit-tipo-identificacion-fiscal");a.ddlNitTipoIdentificacionFiscal=a.container.find(".dropdown-nit-tipo-identificacion-fiscal");a.divNit=a.container.find(".div-nit");a.txtNit=a.container.find(".textbox-nit");a.divMontoCompliance=a.container.find(".div-monto-compliance");a.txtMontoCompliance=a.container.find(".textbox-monto-compliance");a.controlMontoCompliance=null;a.ddlRiesgoCliente=a.container.find(".dropdown-riesgo-cliente");a.divEstadoCivil=a.container.find(".div-estado-civil");a.ddlEstadoCivil=a.container.find(".dropdown-estado-civil");a.divOcupacion=a.container.find(".div-ocupacion");a.ddlOcupacion=a.container.find(".dropdown-ocupacion");a.divOcupacionPersonaJuridica=a.container.find(".div-ocupacion-persona-juridica");a.ddlOcupacionPersonaJuridica=a.container.find(".dropdown-ocupacion-persona-juridica");a.divPersonaExpuesta=a.container.find(".div-persona-expuesta");a.chkPersonaExpuestaSi=a.container.find(".chk-persona-expuesta-si");a.chkPersonaExpuestaNo=a.container.find(".chk-persona-expuesta-no");a.divConyugeNombre=a.container.find(".div-conyuge-nombre");a.txtConyugeNombre=a.container.find(".textbox-conyuge-nombre");a.divConyugeApellido=a.container.find(".div-conyuge-apellido");a.txtConyugeApellido=a.container.find(".textbox-conyuge-apellido");a.divConyugeTipoDocumento=a.container.find(".div-conyuge-tipo-documento");a.ddlConyugeTipoDocumento=a.container.find(".dropdown-conyuge-tipo-documento");a.divConyugeDocumento=a.container.find(".div-conyuge-documento");a.txtConyugeDocumento=a.container.find(".textbox-conyuge-documento");a.chkPersonaExpuestaDirectamente=a.container.find(".chk-persona-expuesta-directamente");a.chkPersonaExpuestaIndirectamente=a.container.find(".chk-persona-expuesta-indirectamente");a.divPersonaExpuestaIndirectamente=a.container.find(".div-persona-expuesta-indirectamente");a.txtPersonaExpuestaIndirectamente=a.container.find(".textbox-persona-expuesta-indirectamente");a.txtPersonaExpuestaIndirectamenteRelacion=a.container.find(".textbox-persona-expuesta-indirectamente-relacion");a.divPersonaExpuestaCargo=a.container.find(".div-persona-expuesta-cargo");a.txtPersonaExpuestaCargo=a.container.find(".textbox-persona-expuesta-cargo");a.divPersonaExpuestaAutoridad=a.container.find(".div-persona-expuesta-autoridad");a.txtPersonaExpuestaAutoridad=a.container.find(".textbox-persona-expuesta-autoridad");a.divPersonaExpuestaCaracterInvocado=a.container.find(".div-persona-expuesta-caracter-invocado");a.ddlPersonaExpuestaCaracterInvocado=a.container.find(".dropdown-persona-expuesta-caracter-invocado");a.divPersonaExpuestaDenominacion=a.container.find(".div-persona-expuesta-denominacion");a.lblPersonaExpuestaDenominacion=a.container.find(".lbl-persona-expuesta-denominacion");a.txtPersonaExpuestaDenominacion=a.container.find(".textbox-persona-expuesta-denominacion");a.divPersonaExpuestaCuit=a.container.find(".div-persona-expuesta-cuit");a.lblPersonaExpuestaCuit=a.container.find(".lbl-persona-expuesta-cuit");a.txtPersonaExpuestaCuit=a.container.find(".textbox-persona-expuesta-cuit");a.divPersonaExpuestaObservaciones=a.container.find(".div-persona-expuesta-observaciones");a.txtPersonaExpuestaObservaciones=a.container.find(".textbox-persona-expuesta-observaciones");a.chkEsParteRelacionadaBalanz=a.container.find(".checkbox-es-parte-relacionada-balanz");a.divEsParteRelacionadaBalanz=a.container.find(".div-es-parte-relacionada-balanz");a.txtEsParteRelacionadaBalanzNombre=a.container.find(".textbox-es-parte-relacionada-balanz-nombre");a.txtEsParteRelacionadaBalanzApellido=a.container.find(".textbox-es-parte-relacionada-balanz-apellido");a.ddlEsParteRelacionadaBalanzRelacion=a.container.find(".dropdown-es-parte-relacionada-balanz-relacion");a.ddlEsParteRelacionadaBalanzCompaniaGrupo=a.container.find(".dropdown-es-parte-relacionada-balanz-compania-grupo");a.divEsBeneficiarioFinal=a.container.find(".div-es-beneficiario-final");a.chkEsBeneficiarioFinal=a.container.find(".checkbox-es-beneficiario-final");a.divEsBeneficiarioFinalObservaciones=a.container.find(".div-es-beneficiario-final-observaciones");a.txtEsBeneficiarioFinalObservaciones=a.container.find(".textbox-es-beneficiario-final-observaciones");a.divImagenes=a.container.find(".div-persona-imagenes");a.anchorFrenteDocumento=a.container.find(".anchor-frente-documento");a.imgFrenteDocumento=a.container.find(".img-frente-documento");a.anchorFotoCliente=a.container.find(".anchor-foto-cliente");a.imgFotoCliente=a.container.find(".img-foto-cliente");a.divMatchCara=a.container.find(".div-match-cara");a.chkMatchCara=a.container.find(".checkbox-match-cara");a.divAlert=a.container.find(".div-alert");a.btnCalcularMatrizRiesgo=a.container.find(".btn-calcular-matriz-riesgo");a.btnConsultarMatrizRiesgo=a.container.find(".btn-consultar-matriz-riesgo");a.divCalcularMatrizRiesgo=a.container.find(".div-calcular-matriz-riesgo");a.btnVolver=a.container.find(".btn-volver-persona");a.btnConfirmarYCerrar=a.container.find(".btn-confirmar-cerrar");a.divAlert.slideUp();var y=$.grep(a.dataParametros.TiposCondoministas,function(B,A){return a.esCuentaJuridica?B.Juridica:B.Fisica});if(!a.esCuentaJuridica&&!a.persona&&a.namespaceActivo!="Legajos"){y=$.grep(y,function(B,A){return B.idTipoCondominista==Core.Business.eTipoPersonaCuenta.Titular})}a.ddlTipo.shieldDropDown({dataSource:{data:y},valueTemplate:"{idTipoCondominista}",textTemplate:"{Descripcion}",value:(a.persona&&a.persona.tipo!=null)?a.persona.tipo.toString():"",enabled:(a.esCuentaJuridica||!a.persona),events:{select:function(A){a.setControls()},blur:function(A){if(a.ddlTipo.swidget().selectedItem()==null){a.ddlTipo.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlTipo,false);a.txtNombre.shieldTextBox({value:(a.persona&&a.persona.nombre!=null)?a.persona.nombre:""});Core.Functions.Validations.toggleValidation(a.txtNombre,false);a.txtApellido.shieldTextBox({value:(a.persona&&a.persona.apellido!=null)?a.persona.apellido:""});Core.Functions.Validations.toggleValidation(a.txtApellido,false);a.ddlTipoDocumento.shieldDropDown({dataSource:{data:a.dataParametros.tiposDocumentos},valueTemplate:"{idTipoDocumento}",textTemplate:"{Descripcion}",value:(a.persona&&a.persona.idTipoDocumento!=null)?a.persona.idTipoDocumento.toString():"",events:{blur:function(A){if(a.ddlTipoDocumento.swidget().selectedItem()==null){a.ddlTipoDocumento.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlTipoDocumento,false);a.txtDocumento.shieldTextBox({value:(a.persona&&a.persona.documento!=null)?a.persona.documento:""});Core.Functions.Validations.toggleValidation(a.txtDocumento,false);a.ddlPaisEmisionPasaporte.shieldComboBox({dataSource:{data:a.dataParametros.paises},valueTemplate:"{idPais}",textTemplate:"{Nombre}",value:(a.persona&&a.persona.idPaisEmisionPasaporte)?a.persona.idPaisEmisionPasaporte.toString():"",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{blur:function(A){if(a.ddlPaisEmisionPasaporte.swidget().selectedItem()==null){a.ddlPaisEmisionPasaporte.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlPaisEmisionPasaporte,false);a.txtFechaVencimientoPasaporte.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.persona&&a.persona.FechaVencimientoPasaporte!=null)?a.getDate(a.persona.FechaVencimientoPasaporte):new Date(),});Core.Functions.Validations.toggleValidation(a.txtFechaVencimientoPasaporte,false);a.ddlNacionalidad.shieldComboBox({dataSource:{data:a.dataParametros.paises},valueTemplate:"{idPais}",textTemplate:"{Nombre}",value:(a.persona&&a.persona.nacionalidad)?a.persona.nacionalidad.toString():"",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{blur:function(A){if(a.ddlNacionalidad.swidget().selectedItem()==null){a.ddlNacionalidad.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlNacionalidad,false);var x=(a.persona&&a.persona.nitidTipoIdentificadorFiscal!=null)?$.grep(a.dataParametros.tiposIdentificadoresFiscales,function(B,A){return B.idTipoIdentificadorFiscal==a.persona.nitidTipoIdentificadorFiscal})[0]:null;a.ddlPaisTributo.shieldComboBox({dataSource:{data:a.dataParametros.paises},valueTemplate:"{idPais}",textTemplate:"{Nombre}",value:(x)?x.idPais.toString():"",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{select:function(A){a.setControls()}}});Core.Functions.Validations.toggleValidation(a.ddlPaisTributo,false);a.ddlNitTipoIdentificacionFiscal.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idTipoIdentificadorFiscal}",textTemplate:"{Descripcion}",value:(x)?x.idTipoIdentificadorFiscal.toString():"",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""}]}}});Core.Functions.Validations.toggleValidation(a.ddlNitTipoIdentificacionFiscal,false);a.txtNit.shieldTextBox({value:(a.persona&&a.persona.nit!=null)?a.persona.nit:""});Core.Functions.Validations.toggleValidation(a.txtNit,false);a.controlMontoCompliance=new Core.Controls.DecimalPicker(a.txtMontoCompliance,{maxDecimalDigitCount:2,showThousandsSeparator:false});Core.Functions.Validations.toggleValidation(a.txtMontoCompliance,false);a.controlMontoCompliance.setValue((a.persona&&a.persona.montoCompliance!=null)?a.persona.montoCompliance:"");a.ddlRiesgoCliente.shieldDropDown({dataSource:{data:a.dataParametrosUsuario.riesgo},valueTemplate:"{idRiesgo}",textTemplate:"{RiesgoDescripcion}"});a.ddlRiesgoCliente.swidget().value((a.persona&&a.persona.idRiesgo)?a.persona.idRiesgo.toString():"");Core.Functions.Validations.toggleValidation(a.ddlRiesgoCliente,false);if(!a.chkCiudadaniaEeuuSi.swidget()){a.chkCiudadaniaEeuuSi.shieldRadioButton({label:"Si"})}var q=a.chkCiudadaniaEeuuSi.swidget().initialOptions;q.checked=((a.persona&&a.persona.esCiudadanoEstadounidiense==1)?true:false);a.chkCiudadaniaEeuuSi.swidget().refresh(q);Core.Functions.Validations.toggleValidation(a.chkCiudadaniaEeuuSi,false);if(!a.chkCiudadaniaEeuuNo.swidget()){a.chkCiudadaniaEeuuNo.shieldRadioButton({label:"No"})}var p=a.chkCiudadaniaEeuuNo.swidget().initialOptions;p.checked=((a.persona&&a.persona.esCiudadanoEstadounidiense==0)?true:false);a.chkCiudadaniaEeuuNo.swidget().refresh(p);Core.Functions.Validations.toggleValidation(a.chkCiudadaniaEeuuNo,false);a.txtFechaNacimiento.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:(a.persona&&a.persona.fechaNacimiento!=null)?a.getDate(a.persona.fechaNacimiento):new Date(),max:new Date()});Core.Functions.Validations.toggleValidation(a.txtFechaNacimiento,false);var c=new Date();var m=new Date(c.getFullYear()+100,11,31);a.txtVencimientoCargoLaboral.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],min:c,max:m,value:(a.persona&&a.persona.fechaVencimientoMandato!=null)?a.getDate(a.persona.fechaVencimientoMandato):new Date()});Core.Functions.Validations.toggleValidation(a.txtVencimientoCargoLaboral,false);a.txtLugarNacimiento.shieldTextBox({value:(a.persona&&a.persona.lugarNacimiento!=null)?a.persona.lugarNacimiento:""});Core.Functions.Validations.toggleValidation(a.txtLugarNacimiento,false);a.txtDomicilioRealCalle.shieldTextBox({value:(a.persona&&a.persona.domicilioParticularCalle!=null)?a.persona.domicilioParticularCalle:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioRealCalle,false);a.txtDomicilioRealNumero.shieldTextBox({value:(a.persona&&a.persona.domicilioParticularNumero!=null)?a.persona.domicilioParticularNumero:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioRealNumero,false);a.txtDomicilioRealPiso.shieldTextBox({value:(a.persona&&a.persona.domicilioParticularPiso!=null)?a.persona.domicilioParticularPiso:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioRealPiso,false);a.txtDomicilioRealDepartamento.shieldTextBox({value:(a.persona&&a.persona.domicilioParticularDepartamento!=null)?a.persona.domicilioParticularDepartamento:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioRealDepartamento,false);a.txtDomicilioRealLocalidad.shieldTextBox({value:(a.persona&&a.persona.domicilioParticularCiudad!=null)?a.persona.domicilioParticularCiudad:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioRealLocalidad,false);a.ddlDomicilioRealPais.shieldComboBox({dataSource:{data:a.dataParametros.paises},valueTemplate:"{idPais}",textTemplate:"{Nombre}",value:(a.persona&&a.persona.domicilioParticularidPais!=null)?a.persona.domicilioParticularidPais.toString():"1",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{select:function(A){a.setControls()},blur:function(A){if(a.ddlDomicilioRealPais.swidget().selectedItem()==null){a.ddlDomicilioRealPais.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlDomicilioRealPais,false);a.ddlDomicilioRealProvincia.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idProvincia}",textTemplate:"{Nombre}",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{blur:function(A){if(a.ddlDomicilioRealProvincia.swidget().selectedItem()==null){a.ddlDomicilioRealProvincia.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlDomicilioRealProvincia,false);a.txtDomicilioRealCodigoPostal.shieldTextBox({value:(a.persona&&a.persona.domicilioParticularCodigoPostal!=null)?a.persona.domicilioParticularCodigoPostal:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioRealCodigoPostal,false);var w=(a.persona&&a.persona.domicilioParticularTelefonoFijo!=null)?a.persona.domicilioParticularTelefonoFijo.split("-"):[];a.txtTelefonoParticularArea.shieldTextBox({value:(w.length>1)?w[0]:""});Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularArea,false);a.txtTelefonoParticularNumero.shieldTextBox({value:(w.length>1)?w[1]:((w.length==1)?w[0]:"")});Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularNumero,false);var r=[];Core.Objects.Contry.forEach(function(A){r.push({value:A.phone_code,text:"(+"+A.phone_code+") "+A.name})});var u=(a.persona&&a.persona.domicilioParticularTelefonoMovil)?a.persona.domicilioParticularTelefonoMovil.split("-"):[];a.ddlTelefonoCelularPais.shieldDropDown({dataSource:{data:r},valueTemplate:"{value}",textTemplate:"{text}",value:(u.length>0)?u[0].replaceAll("\\+",""):a.phoneCodeAr.toString(),events:{select:function(A){a.setTelefonoCelularControls()},blur:function(A){if(a.ddlTelefonoCelularPais.swidget().selectedItem()==null){a.ddlTelefonoCelularPais.swidget().value(null)}}}});a.setTelefonoCelularControls();a.txtTelefonoCelularArea.shieldTextBox({value:(u.length==3)?u[1]:""});Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularArea,false);a.txtTelefonoCelularNumero.shieldTextBox({value:(u.length==3)?u[2]:((u.length==2)?u[1]:"")});Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularNumero,false);a.txtEmail.shieldTextBox({value:(a.persona&&a.persona.email!=null)?a.persona.email:""});Core.Functions.Validations.toggleValidation(a.txtEmail,false);a.txtCargoLaboral.shieldTextBox({value:(a.persona&&a.persona.cargo!=null)?a.persona.cargo:""});Core.Functions.Validations.toggleValidation(a.txtCargoLaboral,false);a.controlCargoLaboralAntiguedad=new Core.Controls.DecimalPicker(a.txtCargoLaboralAntiguedad,{maxDecimalDigitCount:0,showThousandsSeparator:false});Core.Functions.Validations.toggleValidation(a.txtCargoLaboralAntiguedad,false);a.controlCargoLaboralAntiguedad.setValue((a.persona&&a.persona.AntiguedadLaboral!=null)?a.persona.AntiguedadLaboral:"");a.txtEmpresaLaboral.shieldTextBox({value:(a.persona&&a.persona.empresa!=null)?a.persona.empresa:""});Core.Functions.Validations.toggleValidation(a.txtEmpresaLaboral,false);a.txtActividadEmpresa.shieldTextBox({value:(a.persona&&a.persona.EmpresaActividad!=null)?a.persona.EmpresaActividad:""});Core.Functions.Validations.toggleValidation(a.txtActividadEmpresa,false);a.txtOcupacionDescripcion.shieldTextBox({value:(a.persona&&a.persona.OcupacionDescripcion!=null)?a.persona.OcupacionDescripcion:""});Core.Functions.Validations.toggleValidation(a.txtOcupacionDescripcion,false);a.txtOcupacionDescripcionPersonaJuridica.shieldTextBox({value:(a.persona&&a.persona.OcupacionDescripcion!=null)?a.persona.OcupacionDescripcion:""});Core.Functions.Validations.toggleValidation(a.txtOcupacionDescripcionPersonaJuridica,false);a.ddlSexo.shieldDropDown({dataSource:{data:[{value:Core.Business.eGenero.Masculino,text:"Masculino"},{value:Core.Business.eGenero.Femenino,text:"Femenino"}]},valueTemplate:"{value}",textTemplate:"{text}",value:(a.persona&&a.persona.sexo!=null)?a.persona.sexo.toString():"",events:{blur:function(A){if(a.ddlSexo.swidget().selectedItem()==null){a.ddlSexo.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlSexo,false);var x=(a.persona&&a.persona.idTipoIdentificadorFiscal!=null)?$.grep(a.dataParametros.tiposIdentificadoresFiscales,function(B,A){return B.idTipoIdentificadorFiscal==a.persona.idTipoIdentificadorFiscal})[0]:null;a.ddlPaisIdentificacionFiscal.shieldComboBox({dataSource:{data:a.dataParametros.paises},valueTemplate:"{idPais}",textTemplate:"{Nombre}",value:(x)?x.idPais.toString():"",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{select:function(A){a.setControls()},blur:function(A){if(a.ddlPaisIdentificacionFiscal.swidget().selectedItem()==null){a.ddlPaisIdentificacionFiscal.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlPaisIdentificacionFiscal,false);a.ddlTipoIdentificacionFiscal.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idTipoIdentificadorFiscal}",textTemplate:"{Descripcion}",value:(x)?x.idTipoIdentificadorFiscal.toString():"",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""}]}}});Core.Functions.Validations.toggleValidation(a.ddlTipoIdentificacionFiscal,false);a.txtIdentificacionFiscal.shieldTextBox({value:(a.persona&&a.persona.cuit_cuil!=null)?a.persona.cuit_cuil:""});Core.Functions.Validations.toggleValidation(a.txtIdentificacionFiscal,false);if(!a.chkTributaEnOtroPaisSi.swidget()){a.chkTributaEnOtroPaisSi.shieldRadioButton({label:"Si",events:{click:function(A){a.setControls()}}})}var q=a.chkTributaEnOtroPaisSi.swidget().initialOptions;q.checked=((a.persona&&a.persona.tributaEnOtroPais==1)?true:false);a.chkTributaEnOtroPaisSi.swidget().refresh(q);Core.Functions.Validations.toggleValidation(a.chkTributaEnOtroPaisSi,false);if(!a.chkTributaEnOtroPaisNo.swidget()){a.chkTributaEnOtroPaisNo.shieldRadioButton({label:"No",events:{click:function(A){a.setControls()}}})}var p=a.chkTributaEnOtroPaisNo.swidget().initialOptions;p.checked=((a.persona&&a.persona.tributaEnOtroPais==0)?true:false);a.chkTributaEnOtroPaisNo.swidget().refresh(p);Core.Functions.Validations.toggleValidation(a.chkTributaEnOtroPaisNo,false);a.ddlOcupacion.shieldDropDown({dataSource:{data:a.dataParametros.ocupaciones},valueTemplate:"{idOcupacion}",textTemplate:"{Descripcion}",value:(a.persona&&a.persona.idOcupacion!=null)?a.persona.idOcupacion.toString():"",events:{select:function(A){a.setControls()},blur:function(A){if(a.ddlOcupacion.swidget().selectedItem()==null){a.ddlOcupacion.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlOcupacion,false);a.ddlOcupacionPersonaJuridica.shieldDropDown({dataSource:{data:a.dataParametros.ocupaciones},valueTemplate:"{idOcupacion}",textTemplate:"{Descripcion}",value:(a.persona&&a.persona.idOcupacion!=null)?a.persona.idOcupacion.toString():"",events:{select:function(A){a.setControls()},blur:function(A){if(a.ddlOcupacion.swidget().selectedItem()==null){a.ddlOcupacion.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlOcupacionPersonaJuridica,false);a.ddlEstadoCivil.shieldDropDown({dataSource:{data:[{value:Core.Business.eEstadoCivil.Soltero,text:"Soltero"},{value:Core.Business.eEstadoCivil.Casado,text:"Casado"},{value:Core.Business.eEstadoCivil.Divorciado,text:"Divorciado"},{value:Core.Business.eEstadoCivil.Separado,text:"Separado"},{value:Core.Business.eEstadoCivil.Viudo,text:"Viudo"}]},valueTemplate:"{value}",textTemplate:"{text}",value:(a.persona&&a.persona.idEstadoCivil!=null)?a.persona.idEstadoCivil.toString():"",events:{select:function(A){a.setControls()},blur:function(A){if(a.ddlEstadoCivil.swidget().selectedItem()==null){a.ddlEstadoCivil.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlEstadoCivil,false);if(!a.chkPersonaExpuestaSi.swidget()){a.chkPersonaExpuestaSi.shieldRadioButton({label:"Si",events:{click:function(A){a.setControls()}}})}var q=a.chkPersonaExpuestaSi.swidget().initialOptions;q.checked=((a.persona&&a.persona.esPep==1)?true:false);a.chkPersonaExpuestaSi.swidget().refresh(q);Core.Functions.Validations.toggleValidation(a.chkPersonaExpuestaSi,false);if(!a.chkPersonaExpuestaNo.swidget()){a.chkPersonaExpuestaNo.shieldRadioButton({label:"No",events:{click:function(A){a.setControls()}}})}var p=a.chkPersonaExpuestaNo.swidget().initialOptions;p.checked=((a.persona&&a.persona.esPep==0)?true:false);a.chkPersonaExpuestaNo.swidget().refresh(p);Core.Functions.Validations.toggleValidation(a.chkPersonaExpuestaNo,false);a.txtDomicilioLaboralCalle.shieldTextBox({value:(a.persona&&a.persona.domicilioLaboralCalle!=null)?a.persona.domicilioLaboralCalle:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioLaboralCalle,false);a.txtDomicilioLaboralNumero.shieldTextBox({value:(a.persona&&a.persona.domicilioLaboralNumero!=null)?a.persona.domicilioLaboralNumero:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioLaboralNumero,false);a.txtDomicilioLaboralPiso.shieldTextBox({value:(a.persona&&a.persona.domicilioLaboralPiso!=null)?a.persona.domicilioLaboralPiso:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioLaboralPiso,false);a.txtDomicilioLaboralDepartamento.shieldTextBox({value:(a.persona&&a.persona.domicilioLaboralDepartamento!=null)?a.persona.domicilioLaboralDepartamento:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioLaboralDepartamento,false);a.txtDomicilioLaboralLocalidad.shieldTextBox({value:(a.persona&&a.persona.domicilioLaboralCiudad!=null)?a.persona.domicilioLaboralCiudad:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioLaboralLocalidad,false);a.ddlDomicilioLaboralPais.shieldComboBox({dataSource:{data:a.dataParametros.paises},valueTemplate:"{idPais}",textTemplate:"{Nombre}",value:(a.persona&&a.persona.domicilioLaboralidPais!=null)?a.persona.domicilioLaboralidPais.toString():"1",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{select:function(A){a.setControls()},blur:function(A){if(a.ddlDomicilioLaboralPais.swidget().selectedItem()==null){a.ddlDomicilioLaboralPais.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlDomicilioLaboralPais,false);a.ddlDomicilioLaboralProvincia.shieldComboBox({dataSource:{data:[]},valueTemplate:"{idProvincia}",textTemplate:"{Nombre}",autoComplete:{enabled:true,filter:{or:[{path:"Nombre",filter:"contains",value:""}]}},events:{blur:function(A){if(a.ddlDomicilioLaboralProvincia.swidget().selectedItem()==null){a.ddlDomicilioLaboralProvincia.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlDomicilioLaboralProvincia,false);a.txtDomicilioLaboralCodigoPostal.shieldTextBox({value:(a.persona&&a.persona.domicilioLaboralCodigoPostal!=null)?a.persona.domicilioLaboralCodigoPostal:""});Core.Functions.Validations.toggleValidation(a.txtDomicilioLaboralCodigoPostal,false);var v=(a.persona&&a.persona.domicilioLaboralTelefono!=null)?a.persona.domicilioLaboralTelefono.split("-"):[];a.txtTelefonoLaboralArea.shieldTextBox({value:(v.length>1)?v[0]:""});Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralArea,false);a.txtTelefonoLaboralNumero.shieldTextBox({value:(v.length>1)?v[1]:((v.length==1)?v[0]:"")});Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralNumero,false);a.txtEmailLaboral.shieldTextBox({value:(a.persona&&a.persona.emailLaboral!=null)?a.persona.emailLaboral:""});Core.Functions.Validations.toggleValidation(a.txtEmailLaboral,false);a.txtConyugeNombre.shieldTextBox({value:(a.persona&&a.persona.conyugeNombre!=null)?a.persona.conyugeNombre:""});Core.Functions.Validations.toggleValidation(a.txtConyugeNombre,false);a.txtConyugeApellido.shieldTextBox({value:(a.persona&&a.persona.conyugeApellido!=null)?a.persona.conyugeApellido:""});Core.Functions.Validations.toggleValidation(a.txtConyugeApellido,false);a.ddlConyugeTipoDocumento.shieldDropDown({dataSource:{data:a.dataParametros.tiposDocumentos},valueTemplate:"{idTipoDocumento}",textTemplate:"{Descripcion}",value:(a.persona&&a.persona.conyugeidTipoDocumento!=null)?a.persona.conyugeidTipoDocumento.toString():"",events:{blur:function(A){if(a.ddlConyugeTipoDocumento.swidget().selectedItem()==null){a.ddlConyugeTipoDocumento.swidget().value(null)}}}});Core.Functions.Validations.toggleValidation(a.ddlConyugeTipoDocumento,false);a.txtConyugeDocumento.shieldTextBox({value:(a.persona&&a.persona.conyugeDocumento!=null)?a.persona.conyugeDocumento:""});Core.Functions.Validations.toggleValidation(a.txtConyugeDocumento,false);if(!a.chkPersonaExpuestaIndirectamente.swidget()){a.chkPersonaExpuestaIndirectamente.shieldRadioButton({label:"Indirectamente",events:{click:function(A){a.divPersonaExpuestaIndirectamente.hide();if(a.chkPersonaExpuestaIndirectamente.swidget().checked()){a.divPersonaExpuestaIndirectamente.show()}}}})}var o=a.chkPersonaExpuestaIndirectamente.swidget().initialOptions;o.checked=(a.persona&&!a.persona.PEPTipo)?true:false;a.chkPersonaExpuestaIndirectamente.swidget().refresh(o);Core.Functions.Validations.toggleValidation(a.chkPersonaExpuestaIndirectamente,false);if(!a.chkPersonaExpuestaDirectamente.swidget()){a.chkPersonaExpuestaDirectamente.shieldRadioButton({label:"Directamente",events:{click:function(A){a.divPersonaExpuestaIndirectamente.hide();if(a.chkPersonaExpuestaIndirectamente.swidget().checked()){a.divPersonaExpuestaIndirectamente.show()}}}})}var n=a.chkPersonaExpuestaDirectamente.swidget().initialOptions;n.checked=(!a.persona||a.persona.PEPTipo)?true:false;a.chkPersonaExpuestaDirectamente.swidget().refresh(n);Core.Functions.Validations.toggleValidation(a.chkPersonaExpuestaDirectamente,false);a.txtPersonaExpuestaIndirectamente.shieldTextBox({value:(a.persona&&a.persona.PEPNombreIndirecto!=null)?a.persona.PEPNombreIndirecto:""});Core.Functions.Validations.toggleValidation(a.txtPersonaExpuestaIndirectamente,false);a.txtPersonaExpuestaIndirectamenteRelacion.shieldTextBox({value:(a.persona&&a.persona.PEPRelacion!=null)?a.persona.PEPRelacion:""});Core.Functions.Validations.toggleValidation(a.txtPersonaExpuestaIndirectamenteRelacion,false);a.txtPersonaExpuestaCargo.shieldTextBox({value:(a.persona&&a.persona.pepCargo!=null)?a.persona.pepCargo:""});Core.Functions.Validations.toggleValidation(a.txtPersonaExpuestaCargo,false);a.txtPersonaExpuestaAutoridad.shieldTextBox({value:(a.persona&&a.persona.pepAutoridadEmision!=null)?a.persona.pepAutoridadEmision:""});Core.Functions.Validations.toggleValidation(a.txtPersonaExpuestaAutoridad,false);a.txtPersonaExpuestaDenominacion.shieldTextBox({value:((a.persona&&a.persona.pepDenominacion!=null)?a.persona.pepDenominacion:a.defaultPersonaExpuestaDenominacion),enabled:(a.esCuentaJuridica?false:true)});Core.Functions.Validations.toggleValidation(a.txtPersonaExpuestaDenominacion,false);a.lblPersonaExpuestaDenominacion.text("Denominación de la Persona Jurídica"+(a.esCuentaJuridica?"":" - Opcional"));a.txtPersonaExpuestaCuit.shieldTextBox({value:((a.persona&&a.persona.pepCUIT!=null)?a.persona.pepCUIT:a.defaultPersonaExpuestaCuit),enabled:(a.esCuentaJuridica?false:true)});Core.Functions.Validations.toggleValidation(a.txtPersonaExpuestaCuit,false);a.lblPersonaExpuestaCuit.text("CUIT Persona Jurídica"+(a.esCuentaJuridica?"":" - Opcional"));a.txtPersonaExpuestaObservaciones.shieldTextBox({value:(a.persona&&a.persona.pepObservaciones!=null)?a.persona.pepObservaciones:""});Core.Functions.Validations.toggleValidation(a.txtPersonaExpuestaObservaciones,false);a.ddlPersonaExpuestaCaracterInvocado.shieldDropDown({dataSource:{data:$.grep(a.dataParametros.TiposCondoministas,function(B,A){return a.esCuentaJuridica?B.Juridica:B.Fisica})},valueTemplate:"{Descripcion}",textTemplate:"{Descripcion}",value:(a.persona&&a.persona.pepCaracterInvocado!=null)?a.persona.pepCaracterInvocado.toString():"",enabled:false});Core.Functions.Validations.toggleValidation(a.ddlPersonaExpuestaCaracterInvocado,false);a.chkEsParteRelacionadaBalanz.shieldCheckBox({label:"Es parte relacionada** a BALANZ CAPITAL INTERNACIONAL INC",events:{click:function(A){a.setControls()}}});a.chkEsParteRelacionadaBalanz.swidget().checked(((a.persona&&a.persona.EsParteRelacionadaABalanz==1)?true:false));Core.Functions.Validations.toggleValidation(a.chkEsParteRelacionadaBalanz,false);a.txtEsParteRelacionadaBalanzNombre.shieldTextBox({value:(a.persona&&a.persona.EsParteRelacionadaABalanzNombre!=null)?a.persona.EsParteRelacionadaABalanzNombre:""});Core.Functions.Validations.toggleValidation(a.txtEsParteRelacionadaBalanzNombre,false);a.txtEsParteRelacionadaBalanzApellido.shieldTextBox({value:(a.persona&&a.persona.EsParteRelacionadaABalanzApellido!=null)?a.persona.EsParteRelacionadaABalanzApellido:""});Core.Functions.Validations.toggleValidation(a.txtEsParteRelacionadaBalanzApellido,false);a.ddlEsParteRelacionadaBalanzRelacion.shieldDropDown({dataSource:{data:[{Descripcion:"Familiar directo"},{Descripcion:"Familiar indirecto"}]},valueTemplate:"{Descripcion}",textTemplate:"{Descripcion}",value:(a.persona&&a.persona.EsParteRelacionadaABalanzRelacion!=null)?a.persona.EsParteRelacionadaABalanzRelacion.toString():""});Core.Functions.Validations.toggleValidation(a.ddlEsParteRelacionadaBalanzRelacion,false);a.ddlEsParteRelacionadaBalanzCompaniaGrupo.shieldDropDown({dataSource:{data:$.grep(a.dataParametros.CompaniasGrupo,function(B,A){return B.PA})},valueTemplate:"{idCompaniaGrupo}",textTemplate:"{Descripcion}",value:(a.persona&&a.persona.EsParteRelacionadaABalanzidCompaniaGrupo!=null)?a.persona.EsParteRelacionadaABalanzidCompaniaGrupo.toString():""});Core.Functions.Validations.toggleValidation(a.ddlEsParteRelacionadaBalanzCompaniaGrupo,false);a.chkEsBeneficiarioFinal.shieldCheckBox({label:"BENEFICIARIO FINAL (Actúa como intermediario del beneficiario final de la cuenta)",events:{click:function(A){a.setControls()}}});a.chkEsBeneficiarioFinal.swidget().checked(((a.persona&&a.persona.EsBeneficiarioFinal==1)?true:false));Core.Functions.Validations.toggleValidation(a.chkEsBeneficiarioFinal,false);a.txtEsBeneficiarioFinalObservaciones.shieldTextBox({value:(a.persona&&a.persona.BeneficiarioFinalObservaciones!=null)?a.persona.BeneficiarioFinalObservaciones:""});Core.Functions.Validations.toggleValidation(a.txtEsBeneficiarioFinalObservaciones,false);a.chkMatchCara.shieldCheckBox({label:"Aceptar Match de Cara",enabled:((a.optionsApertura&&a.optionsApertura.matchCaraManual)?true:false),events:{click:function(A){if(a.chkMatchCara.swidget().checked()){new Core.Controls.Confirmation("Confirmación","Al checkear esta opción se esta aceptando la responsabilidad que la foto de la persona coincide con la foto del Documento provisto. Esta seguro?",{onCanceled:function(){a.chkMatchCara.swidget().checked(false)}}).show()}}}});a.chkMatchCara.swidget().checked(((a.persona&&a.persona.matcheoCaraManual==1)?true:false));Core.Functions.Validations.toggleValidation(a.chkMatchCara,false);a.divInformes.html("");if(a.persona){var l=$("<label>Resumen de la Persona:  </label>").appendTo(a.divInformes);a.anchorFrenteDocumento.attr("href",a.persona.urlDNIFrente);a.imgFrenteDocumento.attr("src",a.persona.urlDNIFrente);a.anchorFotoCliente.attr("href",a.persona.urlFoto);a.imgFotoCliente.attr("src",a.persona.urlFoto);if(a.persona.tienePruebaDeVida){var h=$('<button disabled type="button" title="Prueba de Vida" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/prueba-de-vida.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);h.css("border-color",a.persona.tienePruebaDeVida)}if(a.persona.tieneMatchCara){var f=$('<button disabled type="button" title="Match de Cara" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/match-cara.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);f.css("border-color",a.persona.tieneMatchCara);if(a.optionsApertura&&a.optionsApertura.consultaICAR&&a.idAperturaCuenta){f.removeAttr("disabled");f.on("click",function(){Core.Functions.ExternalServices.Icar.showReport(f,a.idAperturaCuenta,a.persona.tipo,a.persona.numero)})}}if(a.persona.tieneDatosPrecargados){var d=$('<button disabled type="button" title="Datos Precargados" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/datos-precargados.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);d.css("border-color",a.persona.tieneDatosPrecargados);if(a.optionsApertura&&a.optionsApertura.consultaICAR&&a.idAperturaCuenta){d.removeAttr("disabled");d.on("click",function(){Core.Functions.ExternalServices.Icar.showReport(d,a.idAperturaCuenta,a.persona.tipo,a.persona.numero)})}}if(a.persona.tieneReuters){var j=$('<button disabled type="button" title="Reuters" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/reuters-logo.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);j.css("border-color",a.persona.tieneReuters);if(a.optionsApertura&&a.optionsApertura.consultaReuters){j.removeAttr("disabled");j.on("click",function(){Core.Functions.ExternalServices.Reuters.showReport(j,a.persona.documento,encodeURIComponent(a.persona.nombre.toLowerCase()+" "+a.persona.apellido.toLowerCase()),a.persona.sexo,a.persona.fechaNacimiento,a.persona.nacionalidad)})}}if(a.persona.tieneNOSIS){var g=$('<button disabled type="button" title="Nosis" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/nosis-logo.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);g.css("border-color",a.persona.tieneNOSIS);if(a.optionsApertura&&a.optionsApertura.consultaNosis){g.removeAttr("disabled");g.on("click",function(){Core.Functions.ExternalServices.Nosis.showReport(g,a.persona.cuit_cuil)})}}if(a.persona.tieneRenaper){var i=$('<button disabled type="button" title="Renaper" class="btn-sm balanz-button"style="border:3px solid; background-color:#fff;"><img src="/images/renaper-logo.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);i.css("border-color",a.persona.tieneRenaper);if(a.optionsApertura&&a.optionsApertura.consultaRenaper){i.removeAttr("disabled");i.on("click",function(){Core.Functions.ExternalServices.Renaper.showReport(i,a.persona.documento,a.persona.idTipoDocumento,a.persona.sexo)})}}if(a.persona.tieneUIF){var k=$('<button disabled type="button" title="UIF" class="btn-sm balanz-button"style="border:3px solid; background-color:#fff;"><img src="/images/uif-logo.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);k.css("border-color",a.persona.tieneUIF);if(a.optionsApertura&&a.optionsApertura.consultaUIF){k.removeAttr("disabled");k.on("click",function(){Core.Functions.ExternalServices.UIF.showReport(k,a.persona.cuit_cuil)})}}var e=$('<button disabled type="button" title="Google" class="btn-sm balanz-button" style="border:3px solid; background-color:#fff;"><img src="/images/google-logo.png" style="width:20px; height:20px;" /></button>').appendTo(a.divInformes);e.css("border-color","lightgreen");if(a.optionsApertura&&a.optionsApertura.consultaGoogle){e.removeAttr("disabled");e.on("click",function(){var A="http://www.google.com/search?q="+a.persona.nombre+"+"+a.persona.apellido;window.open(A,"_blank")})}}a.btnConfirmarYCerrar.unbind("click");a.btnConfirmarYCerrar.click(function(){a.confirmar(true)});a.btnConfirmarYCerrar.show();if(a.readOnly){a.btnConfirmarYCerrar.hide()}a.btnVolver.unbind("click");a.btnVolver.click(function(){a.container.modal("hide");a.destroy()});a.btnCalcularMatrizRiesgo.unbind("click");a.btnCalcularMatrizRiesgo.click(function(){a.container.hide();a.divMatrizRiesgo.show();var A=new Core.Controls.ManagerMatrizRiesgoBCI({container:a.divMatrizRiesgo,dataParametrosUsuario:a.dataParametrosUsuario,calcularMatriz:true,consultarMatriz:false,cuilCuit:a.persona.cuit_cuil,idAperturaCuenta:a.idAperturaCuenta,numero:a.persona.numero,tipo:a.persona.tipo,readOnly:a.readOnly,optionsApertura:a.optionsApertura,onSave:function(D,B){a.controlMontoCompliance.setValue(D);if(B){var C=a.ddlRiesgoCliente.swidget().initialOptions;C.value=B.toString();a.ddlRiesgoCliente.swidget().refresh(C)}},onClose:function(){a.container.show();a.divMatrizRiesgo.hide()}}).show()});a.btnConsultarMatrizRiesgo.unbind("click");a.btnConsultarMatrizRiesgo.click(function(){a.container.hide();a.divMatrizRiesgo.show();var A=new Core.Controls.ManagerMatrizRiesgoBCI({container:a.divMatrizRiesgo,dataParametrosUsuario:a.dataParametrosUsuario,calcularMatriz:false,consultarMatriz:true,cuilCuit:a.persona.cuit_cuil,idAperturaCuenta:a.idAperturaCuenta,numero:a.persona.numero,tipo:a.persona.tipo,readOnly:a.readOnly,optionsApertura:a.optionsApertura,onSave:function(D,B){a.controlMontoCompliance.setValue(D);if(B){var C=a.ddlRiesgoCliente.swidget().initialOptions;C.value=B.toString();a.ddlRiesgoCliente.swidget().refresh(C)}},onClose:function(){a.container.show();a.divMatrizRiesgo.hide()}}).show()});a.btnConsultarMatrizRiesgo.hide();a.divCalcularMatrizRiesgo.hide();if(a.pageOptions&&a.persona&&a.persona.cuit_cuil&&Core.Functions.Validations.isCuit(a.persona.cuit_cuil)){if(a.persona.VersionMatriz&&a.persona.VersionMatriz>0){a.btnConsultarMatrizRiesgo.show()}else{a.divCalcularMatrizRiesgo.show()}}a.divMontoCompliance.hide();if(!a.esCuentaJuridica&&Core.Objects.Context.Configuration.idAplicacion==3){a.divMontoCompliance.show()}a.divOcupacion.hide();a.divOcupacionPersonaJuridica.hide();a.divImagenes.hide();if(!a.esCuentaJuridica){a.divOcupacion.show();a.divImagenes.show()}else{a.divOcupacionPersonaJuridica.show()}a.setControls(true)}})};a.confirmar=function(c){Core.Functions.Validations.toggleValidation(a.ddlTipo,false);Core.Functions.Validations.toggleValidation(a.txtNombre,false);Core.Functions.Validations.toggleValidation(a.txtApellido,false);Core.Functions.Validations.toggleValidation(a.ddlTipoDocumento,false);Core.Functions.Validations.toggleValidation(a.txtDocumento,false);Core.Functions.Validations.toggleValidation(a.ddlPaisEmisionPasaporte,false);Core.Functions.Validations.toggleValidation(a.txtFechaVencimientoPasaporte,false);Core.Functions.Validations.toggleValidation(a.ddlPaisIdentificacionFiscal,false);Core.Functions.Validations.toggleValidation(a.ddlTipoIdentificacionFiscal,false);Core.Functions.Validations.toggleValidation(a.txtIdentificacionFiscal,false);Core.Functions.Validations.toggleValidation(a.ddlNacionalidad,false);Core.Functions.Validations.toggleValidation(a.chkCiudadaniaEeuuSi,false);Core.Functions.Validations.toggleValidation(a.chkCiudadaniaEeuuNo,false);Core.Functions.Validations.toggleValidation(a.txtFechaNacimiento,false);Core.Functions.Validations.toggleValidation(a.txtLugarNacimiento,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioRealCalle,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioRealNumero,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioRealPiso,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioRealDepartamento,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioRealLocalidad,false);Core.Functions.Validations.toggleValidation(a.ddlDomicilioRealPais,false);Core.Functions.Validations.toggleValidation(a.ddlDomicilioRealProvincia,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioRealCodigoPostal,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioLaboralCalle,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioLaboralNumero,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioLaboralPiso,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioLaboralDepartamento,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioLaboralLocalidad,false);Core.Functions.Validations.toggleValidation(a.ddlDomicilioLaboralPais,false);Core.Functions.Validations.toggleValidation(a.ddlDomicilioLaboralProvincia,false);Core.Functions.Validations.toggleValidation(a.txtDomicilioLaboralCodigoPostal,false);Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularArea,false);Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularNumero,false);Core.Functions.Validations.toggleValidation(a.ddlTelefonoCelularPais,false);Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularArea,false);Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularNumero,false);Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralArea,false);Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralNumero,false);Core.Functions.Validations.toggleValidation(a.txtEmailLaboral,false);Core.Functions.Validations.toggleValidation(a.txtCargoLaboral,false);Core.Functions.Validations.toggleValidation(a.txtCargoLaboralAntiguedad,false);Core.Functions.Validations.toggleValidation(a.txtVencimientoCargoLaboral,false);Core.Functions.Validations.toggleValidation(a.txtEmpresaLaboral,false);Core.Functions.Validations.toggleValidation(a.txtActividadEmpresa,false);Core.Functions.Validations.toggleValidation(a.txtOcupacionDescripcion,false);Core.Functions.Validations.toggleValidation(a.txtOcupacionDescripcionPersonaJuridica,false);Core.Functions.Validations.toggleValidation(a.txtEmail,false);Core.Functions.Validations.toggleValidation(a.ddlSexo,false);Core.Functions.Validations.toggleValidation(a.ddlEstadoCivil,false);Core.Functions.Validations.toggleValidation(a.ddlOcupacion,false);Core.Functions.Validations.toggleValidation(a.ddlOcupacionPersonaJuridica,false);Core.Functions.Validations.toggleValidation(a.chkPersonaExpuestaSi,false);Core.Functions.Validations.toggleValidation(a.chkPersonaExpuestaNo,false);Core.Functions.Validations.toggleValidation(a.txtPersonaExpuestaCargo,false);Core.Functions.Validations.toggleValidation(a.txtPersonaExpuestaAutoridad,false);Core.Functions.Validations.toggleValidation(a.ddlPersonaExpuestaCaracterInvocado,false);Core.Functions.Validations.toggleValidation(a.txtPersonaExpuestaDenominacion,false);Core.Functions.Validations.toggleValidation(a.txtPersonaExpuestaCuit,false);Core.Functions.Validations.toggleValidation(a.txtPersonaExpuestaObservaciones,false);Core.Functions.Validations.toggleValidation(a.txtEsParteRelacionadaBalanzNombre,false);Core.Functions.Validations.toggleValidation(a.txtEsParteRelacionadaBalanzApellido,false);Core.Functions.Validations.toggleValidation(a.ddlEsParteRelacionadaBalanzRelacion,false);Core.Functions.Validations.toggleValidation(a.ddlEsParteRelacionadaBalanzCompaniaGrupo,false);Core.Functions.Validations.toggleValidation(a.txtEsBeneficiarioFinalObservaciones,false);Core.Functions.Validations.toggleValidation(a.chkMatchCara,false);a.divAlert.slideUp();if(a.idTipoValidacion!=0){a.getPersonValidated(c)}else{a.getPersonNoValidated(c)}};a.getPersonValidated=function(c){var e={value:true};if(a.persona==null){a.persona=new Core.Objects.Persona()}a.persona.tipo=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipo,e);a.persona.nombre=Core.Functions.Validations.getValidatedSwidgetValue(a.txtNombre,e);a.persona.apellido=Core.Functions.Validations.getValidatedSwidgetValue(a.txtApellido,e);a.persona.idTipoDocumento=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoDocumento,e);a.persona.documento=Core.Functions.Validations.getValidatedSwidgetValue(a.txtDocumento,e);if(!a.validDocumento(a.ddlTipoDocumento.swidget().value(),a.txtDocumento.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtDocumento,true);e.value=false;a.divAlert.text("El DNI ingresado debe contener entre 6 y 8 caracteres númericos.");a.divAlert.slideDown()}a.persona.idPaisEmisionPasaporte=Core.Functions.Validations.getValidatedDropDownValue(a.ddlPaisEmisionPasaporte,e);a.persona.FechaVencimientoPasaporte=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaVencimientoPasaporte,e));a.persona.nacionalidad=Core.Functions.Validations.getValidatedDropDownValue(a.ddlNacionalidad,e);if(!a.esCuentaJuridica&&a.ddlTipo.swidget().selectedItem()!=null&&a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Titular){a.persona.esCiudadanoEstadounidiense=a.getSiNo(a.chkCiudadaniaEeuuSi,a.chkCiudadaniaEeuuNo,e,"Debe seleccionar si posee ciudadanía EE.UU.")}if(!a.esCuentaJuridica){a.persona.matcheoCaraManual=(a.chkMatchCara.swidget().checked())?1:0}a.persona.fechaNacimiento=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtFechaNacimiento,e));if(!a.validFechaNacimiento(a.txtFechaNacimiento.swidget().value())){e.value=false;Core.Functions.Validations.toggleValidation(a.txtFechaNacimiento,true);a.divAlert.text("La fecha de nacimiento es inválida. La Persona debe ser mayor de 18 años");a.divAlert.slideDown()}a.persona.lugarNacimiento=Core.Functions.Validations.getValidatedSwidgetValue(a.txtLugarNacimiento,e);if(a.esCuentaJuridica&&a.ddlTipo.swidget().selectedItem()!=null&&(a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Accionista||a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.BeneficiarioFinal)){a.persona.domicilioParticularCalle=a.txtDomicilioRealCalle.swidget().value();a.persona.domicilioParticularNumero=(!a.txtDomicilioRealNumero.swidget().value())?0:a.txtDomicilioRealNumero.swidget().value();a.persona.domicilioParticularCiudad=a.txtDomicilioRealLocalidad.swidget().value();a.persona.domicilioParticularidPais=(!a.ddlDomicilioRealPais.swidget().selectedItem())?0:a.ddlDomicilioRealPais.swidget().value();a.persona.domicilioParticularidProvincia=(!a.ddlDomicilioRealProvincia.swidget().selectedItem())?0:a.ddlDomicilioRealProvincia.swidget().value();a.persona.domicilioParticularCodigoPostal=a.txtDomicilioRealCodigoPostal.swidget().value();a.persona.email=a.txtEmail.swidget().value()}else{a.persona.domicilioParticularidPais=Core.Functions.Validations.getValidatedDropDownValue(a.ddlDomicilioRealPais,e);a.persona.domicilioParticularidProvincia=Core.Functions.Validations.getValidatedDropDownValue(a.ddlDomicilioRealProvincia,e);a.persona.domicilioParticularCalle=Core.Functions.Validations.getValidatedSwidgetValue(a.txtDomicilioRealCalle,e);if(a.persona.domicilioParticularidPais==a.idPais_Argentina){a.persona.domicilioParticularNumero=Core.Functions.Validations.getValidatedSwidgetValue(a.txtDomicilioRealNumero,e)}else{a.persona.domicilioParticularNumero=(!a.txtDomicilioRealNumero.swidget().value())?0:a.txtDomicilioRealNumero.swidget().value()}a.persona.domicilioParticularCiudad=Core.Functions.Validations.getValidatedSwidgetValue(a.txtDomicilioRealLocalidad,e);a.persona.domicilioParticularCodigoPostal=Core.Functions.Validations.getValidatedSwidgetValue(a.txtDomicilioRealCodigoPostal,e);a.persona.email=Core.Functions.Validations.getValidatedSwidgetValue(a.txtEmail,e)}a.persona.domicilioParticularPiso=a.txtDomicilioRealPiso.val();a.persona.domicilioParticularDepartamento=a.txtDomicilioRealDepartamento.val();if(a.persona.email&&!a.isValidEmailAddress(a.persona.email)){e.value=false;Core.Functions.Validations.toggleValidation(a.txtEmail,true);a.divAlert.text("Debe ingresar un email valido");a.divAlert.slideDown()}a.persona.domicilioParticularTelefonoFijo=a.txtTelefonoParticularArea.swidget().value()+"-"+a.txtTelefonoParticularNumero.swidget().value();if((a.txtTelefonoParticularArea.swidget().value()||a.txtTelefonoParticularNumero.swidget().value())&&!a.isValidPhone(a.persona.domicilioParticularTelefonoFijo)){Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularArea,true);Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularNumero,true);e.value=false;a.divAlert.text("El teléfono ingresado no es válido.");a.divAlert.slideDown()}if(a.txtTelefonoParticularArea.swidget().value()&&!Core.Functions.Validations.isNumeric(a.txtTelefonoParticularArea.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularArea,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(a.txtTelefonoParticularNumero.swidget().value()&&!Core.Functions.Validations.isNumeric(a.txtTelefonoParticularNumero.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularNumero,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(a.ddlTelefonoCelularPais.swidget().selectedItem()!=null&&a.ddlTelefonoCelularPais.swidget().selectedItem().value==a.phoneCodeAr){a.persona.domicilioParticularTelefonoMovil="+"+a.ddlTelefonoCelularPais.swidget().selectedItem().value+"-"+a.txtTelefonoCelularArea.swidget().value()+"-"+a.txtTelefonoCelularNumero.swidget().value()}else{a.persona.domicilioParticularTelefonoMovil="+"+a.ddlTelefonoCelularPais.swidget().selectedItem().value+"-"+a.txtTelefonoCelularNumero.swidget().value()}if(a.esCuentaJuridica&&a.ddlTipo.swidget().selectedItem()!=null&&(a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Accionista||a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.BeneficiarioFinal)){if(((a.ddlTelefonoCelularPais.swidget().selectedItem().value==a.phoneCodeAr&&a.txtTelefonoCelularArea.swidget().value())||a.txtTelefonoCelularNumero.swidget().value())&&!a.isValidPhone(a.persona.domicilioParticularTelefonoMovil)){Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularArea,true);Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularNumero,true);e.value=false;a.divAlert.text("El teléfono ingresado no es válido.");a.divAlert.slideDown()}if(a.ddlTelefonoCelularPais.swidget().selectedItem().value==a.phoneCodeAr&&a.txtTelefonoCelularArea.swidget().value()&&!Core.Functions.Validations.isNumeric(a.txtTelefonoCelularArea.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularArea,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(a.txtTelefonoCelularNumero.swidget().value()&&!Core.Functions.Validations.isNumeric(a.txtTelefonoCelularNumero.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularNumero,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}}else{if(!a.isValidPhone(a.persona.domicilioParticularTelefonoMovil)){Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularArea,true);Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularNumero,true);e.value=false;a.divAlert.text("El teléfono ingresado no es válido.");a.divAlert.slideDown()}if(a.ddlTelefonoCelularPais.swidget().selectedItem().value==a.phoneCodeAr&&(!a.txtTelefonoCelularArea.swidget().value()||!Core.Functions.Validations.isNumeric(a.txtTelefonoCelularArea.swidget().value()))){Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularArea,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(!a.txtTelefonoCelularNumero.swidget().value()||!Core.Functions.Validations.isNumeric(a.txtTelefonoCelularNumero.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularNumero,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}}a.persona.sexo=Core.Functions.Validations.getValidatedDropDownValue(a.ddlSexo,e);a.persona.idTipoIdentificadorFiscal=Core.Functions.Validations.getValidatedDropDownValue(a.ddlTipoIdentificacionFiscal,e);a.persona.cuit_cuil=(a.persona.idTipoDocumento==Core.Business.eTipoDocumento.DNI?Core.Functions.Validations.getValidatedSwidgetValue(a.txtIdentificacionFiscal,e):a.txtIdentificacionFiscal.val());if(a.ddlPaisIdentificacionFiscal.swidget().value()==a.idPais_Argentina){if(!Core.Functions.Validations.isNumeric(a.txtIdentificacionFiscal.val())){Core.Functions.Validations.toggleValidation(a.txtIdentificacionFiscal,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(a.txtIdentificacionFiscal.val()&&!Core.Functions.Validations.isCuit(a.txtIdentificacionFiscal.val())){e.value=false;Core.Functions.Validations.toggleValidation(a.txtIdentificacionFiscal,true);a.divAlert.text("Debe ingresar un Cuil o Cuit válido.");a.divAlert.slideDown()}if(a.persona.idTipoDocumento==Core.Business.eTipoDocumento.DNI){if(!a.validDniFiscalIdentifier(a.txtDocumento.val(),a.txtIdentificacionFiscal.val())){Core.Functions.Validations.toggleValidation(a.txtDocumento,true);Core.Functions.Validations.toggleValidation(a.txtIdentificacionFiscal,true);e.value=false;a.divAlert.text("El CUIL / CUIT ingresado debe contener al DNI.");a.divAlert.slideDown()}}}if(!a.esCuentaJuridica){a.persona.idOcupacion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlOcupacion,e)}else{if(a.ddlTipo.swidget().selectedItem()!=null&&(a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Accionista||a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.BeneficiarioFinal)){a.persona.idOcupacion=a.ddlOcupacionPersonaJuridica.swidget().value()}else{a.persona.idOcupacion=Core.Functions.Validations.getValidatedDropDownValue(a.ddlOcupacionPersonaJuridica,e)}}a.persona.idEstadoCivil=Core.Functions.Validations.getValidatedDropDownValue(a.ddlEstadoCivil,e);if(a.esCuentaJuridica||(a.ddlTipo.swidget()!=null&&a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Titular)){a.persona.esPep=a.getSiNo(a.chkPersonaExpuestaSi,a.chkPersonaExpuestaNo,e,"Debe seleccionar si es persona expuesta políticamente.")}if(!a.esCuentaJuridica&&a.ddlTipo.swidget().selectedItem()!=null&&a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Titular&&a.ddlOcupacion.swidget().selectedItem()!=null){a.persona.cargo=((a.ddlOcupacion.swidget().selectedItem().TipoCampoAdicional==1)?Core.Functions.Validations.getValidatedSwidgetValue(a.txtCargoLaboral,e):"");a.persona.AntiguedadLaboral=((a.ddlOcupacion.swidget().selectedItem().TipoCampoAdicional==1)?Core.Functions.Decimal.parseFloat(a.txtCargoLaboralAntiguedad.val()):0);a.persona.empresa=((a.ddlOcupacion.swidget().selectedItem().TipoCampoAdicional==1)?Core.Functions.Validations.getValidatedSwidgetValue(a.txtEmpresaLaboral,e):"");a.persona.EmpresaActividad=((a.ddlOcupacion.swidget().selectedItem().TipoCampoAdicional==1)?Core.Functions.Validations.getValidatedSwidgetValue(a.txtActividadEmpresa,e):"");a.persona.OcupacionDescripcion=((a.ddlOcupacion.swidget().selectedItem().TipoCampoAdicional==2)?Core.Functions.Validations.getValidatedSwidgetValue(a.txtOcupacionDescripcion,e):"");a.persona.domicilioLaboralCalle=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?Core.Functions.Validations.getValidatedSwidgetValue(a.txtDomicilioLaboralCalle,e):"");a.persona.domicilioLaboralNumero=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?Core.Functions.Validations.getValidatedSwidgetValue(a.txtDomicilioLaboralNumero,e):"");a.persona.domicilioLaboralCiudad=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?Core.Functions.Validations.getValidatedSwidgetValue(a.txtDomicilioLaboralLocalidad,e):"");a.persona.domicilioLaboralidPais=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?Core.Functions.Validations.getValidatedDropDownValue(a.ddlDomicilioLaboralPais,e):0);a.persona.domicilioLaboralidProvincia=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?Core.Functions.Validations.getValidatedDropDownValue(a.ddlDomicilioLaboralProvincia,e):0);a.persona.domicilioLaboralCodigoPostal=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?Core.Functions.Validations.getValidatedSwidgetValue(a.txtDomicilioLaboralCodigoPostal,e):"");a.persona.domicilioLaboralPiso=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?a.txtDomicilioLaboralPiso.swidget().value():"");a.persona.domicilioLaboralDepartamento=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?a.txtDomicilioLaboralDepartamento.swidget().value():"");a.persona.domicilioLaboralTelefono=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?(a.txtTelefonoLaboralArea.swidget().value()+"-"+a.txtTelefonoLaboralNumero.swidget().value()):"");a.persona.emailLaboral=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?a.txtEmailLaboral.swidget().value():"");if(a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1){if((a.txtTelefonoLaboralArea.swidget().value()||a.txtTelefonoLaboralNumero.swidget().value())&&!a.isValidPhone(a.persona.domicilioLaboralTelefono)){Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralArea,true);Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralNumero,true);e.value=false;a.divAlert.text("El teléfono ingresado no es válido.");a.divAlert.slideDown()}if(!Core.Functions.Validations.isNumeric(a.txtTelefonoLaboralArea.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralArea,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(!Core.Functions.Validations.isNumeric(a.txtTelefonoLaboralNumero.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralNumero,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(a.persona.emailLaboral&&!a.isValidEmailAddress(a.persona.emailLaboral)){e.value=false;Core.Functions.Validations.toggleValidation(a.txtEmailLaboral,true);a.divAlert.text("Debe ingresar un email laboral válido");a.divAlert.slideDown()}}}else{if(a.esCuentaJuridica){if(a.ddlTipo.swidget().selectedItem()!=null&&(a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Accionista||a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.BeneficiarioFinal)){a.persona.cargo=a.txtCargoLaboral.swidget().value();a.persona.AntiguedadLaboral=Core.Functions.Decimal.parseFloat(a.txtCargoLaboralAntiguedad.val());a.persona.EmpresaActividad=a.txtActividadEmpresa.swidget().value();a.persona.fechaVencimientoMandato=Core.Functions.Date.getDateAsString(a.txtVencimientoCargoLaboral.swidget().value());a.persona.OcupacionDescripcion=((a.ddlOcupacionPersonaJuridica.swidget().selectedItem().TipoCampoAdicional==2)?a.txtOcupacionDescripcionPersonaJuridica.swidget().value():"")}else{a.persona.cargo=Core.Functions.Validations.getValidatedSwidgetValue(a.txtCargoLaboral,e);a.persona.AntiguedadLaboral=Core.Functions.Decimal.parseFloat(a.txtCargoLaboralAntiguedad.val());a.persona.EmpresaActividad=Core.Functions.Validations.getValidatedSwidgetValue(a.txtActividadEmpresa,e);a.persona.fechaVencimientoMandato=Core.Functions.Date.getDateAsString(Core.Functions.Validations.getValidatedSwidgetValue(a.txtVencimientoCargoLaboral,e));a.persona.OcupacionDescripcion=((a.ddlOcupacionPersonaJuridica.swidget().selectedItem().TipoCampoAdicional==2)?Core.Functions.Validations.getValidatedSwidgetValue(a.txtOcupacionDescripcionPersonaJuridica,e):"")}a.persona.domicilioLaboralTelefono=a.txtTelefonoLaboralArea.swidget().value()+"-"+a.txtTelefonoLaboralNumero.swidget().value();if((a.txtTelefonoLaboralArea.swidget().value()||a.txtTelefonoLaboralNumero.swidget().value())&&!a.isValidPhone(a.persona.domicilioLaboralTelefono)){Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralArea,true);Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralNumero,true);e.value=false;a.divAlert.text("El teléfono ingresado no es válido.");a.divAlert.slideDown()}if(!Core.Functions.Validations.isNumeric(a.txtTelefonoLaboralArea.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralArea,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(!Core.Functions.Validations.isNumeric(a.txtTelefonoLaboralNumero.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralNumero,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}a.persona.emailLaboral=a.txtEmailLaboral.swidget().value();if(a.persona.emailLaboral&&!a.isValidEmailAddress(a.persona.emailLaboral)){e.value=false;Core.Functions.Validations.toggleValidation(a.txtEmailLaboral,true);a.divAlert.text("Debe ingresar un email laboral válido");a.divAlert.slideDown()}}}a.persona.conyugeNombre=((a.ddlEstadoCivil.swidget().selectedItem().value==Core.Business.eEstadoCivil.Casado)?a.txtConyugeNombre.swidget().value():"");a.persona.conyugeApellido=((a.ddlEstadoCivil.swidget().selectedItem().value==Core.Business.eEstadoCivil.Casado)?a.txtConyugeApellido.swidget().value():"");a.persona.conyugeidTipoDocumento=((a.ddlEstadoCivil.swidget().selectedItem().value==Core.Business.eEstadoCivil.Casado)?a.ddlConyugeTipoDocumento.swidget().value():0);a.persona.conyugeDocumento=((a.ddlEstadoCivil.swidget().selectedItem().value==Core.Business.eEstadoCivil.Casado)?a.txtConyugeDocumento.val():"");if(a.persona.conyugeDocumento){if(!a.validDocumento(a.ddlConyugeTipoDocumento.swidget().value(),a.txtConyugeDocumento.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtConyugeDocumento,true);e.value=false;a.divAlert.text("El DNI ingresado debe contener entre 6 y 8 caracteres númericos.");a.divAlert.slideDown()}}if(!a.esCuentaJuridica&&Core.Objects.Context.Configuration.idAplicacion==3){if(a.idTipoValidacion>=10){a.persona.montoCompliance=Core.Functions.Validations.getValidatedNumericInputValue(a.txtMontoCompliance,e);a.persona.idRiesgo=Core.Functions.Validations.getValidatedDropDownValue(a.ddlRiesgoCliente,e)}else{a.persona.montoCompliance=a.txtMontoCompliance.val();a.persona.idRiesgo=a.ddlRiesgoCliente.swidget().value()}}else{if(!a.esCuentaJuridica){a.persona.montoCompliance=a.persona.montoCompliance;a.persona.idRiesgo=a.persona.idRiesgo}}a.persona.tributaEnOtroPais=a.getSiNo(a.chkTributaEnOtroPaisSi,a.chkTributaEnOtroPaisNo,e,"Debe seleccionar si tributa en otro país.");if(a.persona.tributaEnOtroPais){a.persona.nitidTipoIdentificadorFiscal=Core.Functions.Validations.getValidatedDropDownValue(a.ddlNitTipoIdentificacionFiscal,e);a.persona.nit=Core.Functions.Validations.getValidatedSwidgetValue(a.txtNit,e);if(a.ddlPaisTributo.swidget().value()==a.idPais_Argentina){if(!Core.Functions.Validations.isNumeric(a.txtNit.val())){Core.Functions.Validations.toggleValidation(a.txtNit,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(a.txtNit.val()&&!Core.Functions.Validations.isCuit(a.txtNit.val())){e.value=false;Core.Functions.Validations.toggleValidation(a.txtNit,true);a.divAlert.text("Debe ingresar un NIT válido.");a.divAlert.slideDown()}}}if((a.esCuentaJuridica||(a.ddlTipo.swidget().selectedItem()!=null&&a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Titular))){a.persona.PEPTipo=(a.chkPersonaExpuestaIndirectamente.swidget().checked())?0:1;if(a.esCuentaJuridica&&a.ddlTipo.swidget().selectedItem()!=null&&(a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Accionista||a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.BeneficiarioFinal)){a.persona.PEPNombreIndirecto=((a.persona.esPep&&!a.persona.PEPTipo)?a.txtPersonaExpuestaIndirectamente.val():"");a.persona.PEPRelacion=((a.persona.esPep&&!a.persona.PEPTipo)?a.txtPersonaExpuestaIndirectamenteRelacion.val():"");a.persona.pepCargo=(a.persona.esPep?a.txtPersonaExpuestaCargo.swidget().value():"");a.persona.pepAutoridadEmision=(a.persona.esPep?a.txtPersonaExpuestaAutoridad.swidget().value():"");a.persona.pepDenominacion=(a.persona.esPep?a.txtPersonaExpuestaDenominacion.swidget().value():"");a.persona.pepCUIT=(a.persona.esPep?a.txtPersonaExpuestaCuit.swidget().value():"");a.persona.pepCaracterInvocado=(a.persona.esPep?a.ddlPersonaExpuestaCaracterInvocado.swidget().value():"0")}else{a.persona.PEPNombreIndirecto=((a.persona.esPep&&!a.persona.PEPTipo)?Core.Functions.Validations.getValidatedSwidgetValue(a.txtPersonaExpuestaIndirectamente,e):"");a.persona.PEPRelacion=((a.persona.esPep&&!a.persona.PEPTipo)?Core.Functions.Validations.getValidatedSwidgetValue(a.txtPersonaExpuestaIndirectamenteRelacion,e):"");a.persona.pepCargo=(a.persona.esPep?Core.Functions.Validations.getValidatedSwidgetValue(a.txtPersonaExpuestaCargo,e):"");a.persona.pepAutoridadEmision=(a.persona.esPep?Core.Functions.Validations.getValidatedSwidgetValue(a.txtPersonaExpuestaAutoridad,e):"");a.persona.pepDenominacion=(a.persona.esPep?(a.esCuentaJuridica?Core.Functions.Validations.getValidatedSwidgetValue(a.txtPersonaExpuestaDenominacion,e):a.txtPersonaExpuestaDenominacion.swidget().value()):"");a.persona.pepCUIT=(a.persona.esPep?(a.esCuentaJuridica?Core.Functions.Validations.getValidatedSwidgetValue(a.txtPersonaExpuestaCuit,e):a.txtPersonaExpuestaCuit.swidget().value()):"");a.persona.pepCaracterInvocado=(a.persona.esPep?Core.Functions.Validations.getValidatedDropDownValue(a.ddlPersonaExpuestaCaracterInvocado,e):"0")}if(a.persona.pepCUIT&&!Core.Functions.Validations.isCuit(a.persona.pepCUIT)){e.value=false;Core.Functions.Validations.toggleValidation(a.txtPersonaExpuestaCuit,true);a.divAlert.text("Debe ingresar un Cuit válido (Persona Expuesta Políticamente).");a.divAlert.slideDown()}a.persona.pepObservaciones=(a.persona.esPep?a.txtPersonaExpuestaObservaciones.val():"")}a.persona.EsParteRelacionadaABalanz=(a.chkEsParteRelacionadaBalanz.swidget().checked())?1:0;a.persona.EsParteRelacionadaABalanzNombre=((a.persona.EsParteRelacionadaABalanz)?Core.Functions.Validations.getValidatedSwidgetValue(a.txtEsParteRelacionadaBalanzNombre,e):"");a.persona.EsParteRelacionadaABalanzApellido=((a.persona.EsParteRelacionadaABalanz)?Core.Functions.Validations.getValidatedSwidgetValue(a.txtEsParteRelacionadaBalanzApellido,e):"");a.persona.EsParteRelacionadaABalanzRelacion=((a.persona.EsParteRelacionadaABalanz)?Core.Functions.Validations.getValidatedDropDownValue(a.ddlEsParteRelacionadaBalanzRelacion,e):"");a.persona.EsParteRelacionadaABalanzidCompaniaGrupo=((a.persona.EsParteRelacionadaABalanz)?Core.Functions.Validations.getValidatedDropDownValue(a.ddlEsParteRelacionadaBalanzCompaniaGrupo,e):"0");a.persona.EsBeneficiarioFinal=(a.chkEsBeneficiarioFinal.swidget().checked())?1:0;a.persona.BeneficiarioFinalObservaciones=((a.persona.EsBeneficiarioFinal)?Core.Functions.Validations.getValidatedSwidgetValue(a.txtEsBeneficiarioFinalObservaciones,e):"");if(e.value){if(a.onSave(a.persona)){if(c){a.container.modal("hide");a.destroy()}else{var d=new Core.Controls.Dialog("Aviso","Persona guardada correctamente",{displayButtons:{close:true,accept:false}});d.show()}}}else{$("html, body").animate({scrollTop:$(".cuenta").offset().top},1000)}};a.getPersonNoValidated=function(c){var e={value:true};if(a.persona==null){a.persona=new Core.Objects.Persona()}a.persona.tipo=a.ddlTipo.swidget().value();a.persona.nombre=a.txtNombre.swidget().value();a.persona.apellido=a.txtApellido.swidget().value();a.persona.idTipoDocumento=a.ddlTipoDocumento.swidget().value();a.persona.documento=a.txtDocumento.swidget().value();a.persona.idPaisEmisionPasaporte=(!a.ddlPaisEmisionPasaporte.swidget().value())?0:a.ddlPaisEmisionPasaporte.swidget().value();a.persona.FechaVencimientoPasaporte=Core.Functions.Date.getDateAsString(a.txtFechaVencimientoPasaporte.swidget().value());a.persona.nacionalidad=(!a.ddlNacionalidad.swidget().value())?0:a.ddlNacionalidad.swidget().value();if(!a.esCuentaJuridica&&a.ddlTipo.swidget().selectedItem()!=null&&a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Titular){a.persona.esCiudadanoEstadounidiense=a.getSiNo(a.chkCiudadaniaEeuuSi,a.chkCiudadaniaEeuuNo)}if(!a.esCuentaJuridica){a.persona.matcheoCaraManual=(a.chkMatchCara.swidget().checked())?1:0}a.persona.fechaNacimiento=Core.Functions.Date.getDateAsString(a.txtFechaNacimiento.swidget().value());a.persona.lugarNacimiento=a.txtLugarNacimiento.swidget().value();a.persona.domicilioParticularCalle=a.txtDomicilioRealCalle.swidget().value();a.persona.domicilioParticularNumero=(!a.txtDomicilioRealNumero.swidget().value())?0:a.txtDomicilioRealNumero.swidget().value();a.persona.domicilioParticularPiso=a.txtDomicilioRealPiso.val();a.persona.domicilioParticularDepartamento=a.txtDomicilioRealDepartamento.val();a.persona.domicilioParticularCiudad=a.txtDomicilioRealLocalidad.swidget().value();a.persona.domicilioParticularidPais=(!a.ddlDomicilioRealPais.swidget().selectedItem())?0:a.ddlDomicilioRealPais.swidget().value();a.persona.domicilioParticularidProvincia=(!a.ddlDomicilioRealProvincia.swidget().selectedItem())?0:a.ddlDomicilioRealProvincia.swidget().value();a.persona.domicilioParticularCodigoPostal=a.txtDomicilioRealCodigoPostal.swidget().value();a.persona.domicilioParticularTelefonoFijo=a.txtTelefonoParticularArea.swidget().value()+"-"+a.txtTelefonoParticularNumero.swidget().value();if((a.txtTelefonoParticularArea.swidget().value()||a.txtTelefonoParticularNumero.swidget().value())&&!a.isValidPhone(a.persona.domicilioParticularTelefonoFijo)){Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularArea,true);Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularNumero,true);e.value=false;a.divAlert.text("El teléfono ingresado no es válido.");a.divAlert.slideDown()}if(a.txtTelefonoParticularArea.swidget().value()&&!Core.Functions.Validations.isNumeric(a.txtTelefonoParticularArea.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularArea,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(a.txtTelefonoParticularNumero.swidget().value()&&!Core.Functions.Validations.isNumeric(a.txtTelefonoParticularNumero.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoParticularNumero,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(a.ddlTelefonoCelularPais.swidget().selectedItem()!=null&&a.ddlTelefonoCelularPais.swidget().selectedItem().value==a.phoneCodeAr){a.persona.domicilioParticularTelefonoMovil="+"+a.ddlTelefonoCelularPais.swidget().selectedItem().value+"-"+a.txtTelefonoCelularArea.swidget().value()+"-"+a.txtTelefonoCelularNumero.swidget().value()}else{a.persona.domicilioParticularTelefonoMovil="+"+a.ddlTelefonoCelularPais.swidget().selectedItem().value+"-"+a.txtTelefonoCelularNumero.swidget().value()}if(((a.ddlTelefonoCelularPais.swidget().selectedItem().value==a.phoneCodeAr&&a.txtTelefonoCelularArea.swidget().value())||a.txtTelefonoCelularNumero.swidget().value())&&!a.isValidPhone(a.persona.domicilioParticularTelefonoMovil)){Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularArea,true);Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularNumero,true);e.value=false;a.divAlert.text("El teléfono ingresado no es válido.");a.divAlert.slideDown()}if(a.ddlTelefonoCelularPais.swidget().selectedItem().value==a.phoneCodeAr&&a.txtTelefonoCelularArea.swidget().value()&&!Core.Functions.Validations.isNumeric(a.txtTelefonoCelularArea.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularArea,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(a.txtTelefonoCelularNumero.swidget().value()&&!Core.Functions.Validations.isNumeric(a.txtTelefonoCelularNumero.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoCelularNumero,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}a.persona.email=a.txtEmail.swidget().value();a.persona.sexo=a.ddlSexo.swidget().value();a.persona.idTipoIdentificadorFiscal=a.ddlTipoIdentificacionFiscal.swidget().value();a.persona.cuit_cuil=a.txtIdentificacionFiscal.val();if(!a.esCuentaJuridica){a.persona.idOcupacion=a.ddlOcupacion.swidget().value()}else{a.persona.idOcupacion=a.ddlOcupacionPersonaJuridica.swidget().value()}a.persona.idEstadoCivil=a.ddlEstadoCivil.swidget().value();if(a.esCuentaJuridica||(a.ddlTipo.swidget()!=null&&a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Titular)){a.persona.esPep=a.getSiNo(a.chkPersonaExpuestaSi,a.chkPersonaExpuestaNo)}if(!a.esCuentaJuridica&&a.ddlTipo.swidget().selectedItem()!=null&&a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Titular&&a.ddlOcupacion.swidget().selectedItem()!=null){a.persona.cargo=((a.ddlOcupacion.swidget().selectedItem().TipoCampoAdicional==1)?a.txtCargoLaboral.swidget().value():"");a.persona.AntiguedadLaboral=((a.ddlOcupacion.swidget().selectedItem().TipoCampoAdicional==1)?Core.Functions.Decimal.parseFloat(a.txtCargoLaboralAntiguedad.val()):0);a.persona.empresa=((a.ddlOcupacion.swidget().selectedItem().TipoCampoAdicional==1)?a.txtEmpresaLaboral.swidget().value():"");a.persona.EmpresaActividad=((a.ddlOcupacion.swidget().selectedItem().TipoCampoAdicional==1)?a.txtActividadEmpresa.swidget().value():"");a.persona.OcupacionDescripcion=((a.ddlOcupacion.swidget().selectedItem().TipoCampoAdicional==2)?a.txtOcupacionDescripcion.swidget().value():"");a.persona.domicilioLaboralCalle=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?a.txtDomicilioLaboralCalle.swidget().value():"");a.persona.domicilioLaboralNumero=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?((!a.txtDomicilioLaboralNumero.swidget().value())?0:a.txtDomicilioLaboralNumero.swidget().value()):0);a.persona.domicilioLaboralPiso=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?a.txtDomicilioLaboralPiso.val():"");a.persona.domicilioLaboralDepartamento=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?a.txtDomicilioLaboralDepartamento.val():"");a.persona.domicilioLaboralCiudad=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?a.txtDomicilioLaboralLocalidad.swidget().value():"");a.persona.domicilioLaboralidPais=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?((!a.ddlDomicilioLaboralPais.swidget().selectedItem())?0:a.ddlDomicilioLaboralPais.swidget().value()):0);a.persona.domicilioLaboralidProvincia=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?((!a.ddlDomicilioLaboralProvincia.swidget().selectedItem())?0:a.ddlDomicilioLaboralProvincia.swidget().value()):0);a.persona.domicilioLaboralCodigoPostal=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?a.txtDomicilioLaboralCodigoPostal.swidget().value():"");a.persona.domicilioLaboralTelefono=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?(a.txtTelefonoLaboralArea.val()+"-"+a.txtTelefonoLaboralNumero.val()):"");a.persona.emailLaboral=((a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1)?a.txtEmailLaboral.swidget().value():"");if(a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1){if((a.txtTelefonoLaboralArea.swidget().value()||a.txtTelefonoLaboralNumero.swidget().value())&&!a.isValidPhone(a.persona.domicilioLaboralTelefono)){Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralArea,true);Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralNumero,true);e.value=false;a.divAlert.text("El teléfono ingresado no es válido.");a.divAlert.slideDown()}if(!Core.Functions.Validations.isNumeric(a.txtTelefonoLaboralArea.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralArea,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(!Core.Functions.Validations.isNumeric(a.txtTelefonoLaboralNumero.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralNumero,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}}}else{if(a.esCuentaJuridica){a.persona.cargo=a.txtCargoLaboral.swidget().value();a.persona.AntiguedadLaboral=Core.Functions.Decimal.parseFloat(a.txtCargoLaboralAntiguedad.val());a.persona.EmpresaActividad=a.txtActividadEmpresa.swidget().value();a.persona.domicilioLaboralTelefono=a.txtTelefonoLaboralArea.val()+"-"+a.txtTelefonoLaboralNumero.val();if((a.txtTelefonoLaboralArea.swidget().value()||a.txtTelefonoLaboralNumero.swidget().value())&&!a.isValidPhone(a.persona.domicilioLaboralTelefono)){Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralArea,true);Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralNumero,true);e.value=false;a.divAlert.text("El teléfono ingresado no es válido.");a.divAlert.slideDown()}if(!Core.Functions.Validations.isNumeric(a.txtTelefonoLaboralArea.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralArea,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}if(!Core.Functions.Validations.isNumeric(a.txtTelefonoLaboralNumero.swidget().value())){Core.Functions.Validations.toggleValidation(a.txtTelefonoLaboralNumero,true);e.value=false;a.divAlert.text("Debe ingresar un valor numérico.");a.divAlert.slideDown()}a.persona.emailLaboral=a.txtEmailLaboral.swidget().value();a.persona.fechaVencimientoMandato=Core.Functions.Date.getDateAsString(a.txtVencimientoCargoLaboral.swidget().value());a.persona.OcupacionDescripcion=((a.ddlOcupacionPersonaJuridica.swidget().selectedItem().TipoCampoAdicional==2)?a.txtOcupacionDescripcionPersonaJuridica.swidget().value():"")}}a.persona.conyugeNombre=((a.ddlEstadoCivil.swidget().selectedItem().value==Core.Business.eEstadoCivil.Casado)?a.txtConyugeNombre.swidget().value():"");a.persona.conyugeApellido=((a.ddlEstadoCivil.swidget().selectedItem().value==Core.Business.eEstadoCivil.Casado)?a.txtConyugeApellido.swidget().value():"");a.persona.conyugeidTipoDocumento=((a.ddlEstadoCivil.swidget().selectedItem().value==Core.Business.eEstadoCivil.Casado)?a.ddlConyugeTipoDocumento.swidget().value():0);a.persona.conyugeDocumento=((a.ddlEstadoCivil.swidget().selectedItem().value==Core.Business.eEstadoCivil.Casado)?a.txtConyugeDocumento.val():"");if(!a.esCuentaJuridica&&Core.Objects.Context.Configuration.idAplicacion==3){a.persona.montoCompliance=a.txtMontoCompliance.val();a.persona.idRiesgo=a.ddlRiesgoCliente.swidget().value()}else{if(!a.esCuentaJuridica){a.persona.montoCompliance=a.persona.montoCompliance;a.persona.idRiesgo=a.persona.idRiesgo}}a.persona.tributaEnOtroPais=a.getSiNo(a.chkTributaEnOtroPaisSi,a.chkTributaEnOtroPaisNo);if(a.persona.tributaEnOtroPais){a.persona.nitidTipoIdentificadorFiscal=a.ddlNitTipoIdentificacionFiscal.swidget().value();a.persona.nit=a.txtNit.val()}if((a.esCuentaJuridica||(a.ddlTipo.swidget().selectedItem()!=null&&a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Titular))){a.persona.PEPTipo=(a.chkPersonaExpuestaIndirectamente.swidget().checked())?0:1;a.persona.PEPNombreIndirecto=((a.persona.esPep&&!a.persona.PEPTipo)?a.txtPersonaExpuestaIndirectamente.val():"");a.persona.PEPRelacion=((a.persona.esPep&&!a.persona.PEPTipo)?a.txtPersonaExpuestaIndirectamenteRelacion.val():"");a.persona.pepCargo=(a.persona.esPep?a.txtPersonaExpuestaCargo.swidget().value():"");a.persona.pepAutoridadEmision=(a.persona.esPep?a.txtPersonaExpuestaAutoridad.swidget().value():"");a.persona.pepDenominacion=(a.persona.esPep?a.txtPersonaExpuestaDenominacion.swidget().value():"");a.persona.pepCUIT=(a.persona.esPep?a.txtPersonaExpuestaCuit.swidget().value():"");a.persona.pepObservaciones=(a.persona.esPep?a.txtPersonaExpuestaObservaciones.val():"");a.persona.pepCaracterInvocado=(a.persona.esPep?a.ddlPersonaExpuestaCaracterInvocado.swidget().value():"0")}a.persona.EsParteRelacionadaABalanz=(a.chkEsParteRelacionadaBalanz.swidget().checked())?1:0;a.persona.EsParteRelacionadaABalanzNombre=((a.persona.EsParteRelacionadaABalanz)?a.txtEsParteRelacionadaBalanzNombre.val():"");a.persona.EsParteRelacionadaABalanzApellido=((a.persona.EsParteRelacionadaABalanz)?a.txtEsParteRelacionadaBalanzApellido.val():"");a.persona.EsParteRelacionadaABalanzRelacion=((a.persona.EsParteRelacionadaABalanz)?a.ddlEsParteRelacionadaBalanzRelacion.swidget().value():"");a.persona.EsParteRelacionadaABalanzidCompaniaGrupo=((a.persona.EsParteRelacionadaABalanz)?a.ddlEsParteRelacionadaBalanzCompaniaGrupo.swidget().value():"0");a.persona.EsBeneficiarioFinal=(a.chkEsBeneficiarioFinal.swidget().checked())?1:0;a.persona.BeneficiarioFinalObservaciones=((a.persona.EsBeneficiarioFinal)?a.txtEsBeneficiarioFinalObservaciones.swidget().value():"");if(e.value){if(a.onSave(a.persona)){if(c){a.container.modal("hide");a.destroy()}else{var d=new Core.Controls.Dialog("Aviso","Persona guardada correctamente",{displayButtons:{close:true,accept:false}});d.show()}}}else{$("html, body").animate({scrollTop:$(".cuenta").offset().top},1000)}};a.destroy=function(){a.ddlTipo.swidget().destroy();a.txtNombre.swidget().destroy();a.txtApellido.swidget().destroy();a.ddlTipoDocumento.swidget().destroy();a.txtDocumento.swidget().destroy();a.ddlPaisEmisionPasaporte.swidget().destroy();a.txtFechaVencimientoPasaporte.swidget().destroy();a.ddlPaisIdentificacionFiscal.swidget().destroy();a.ddlTipoIdentificacionFiscal.swidget().destroy();a.txtIdentificacionFiscal.swidget().destroy();a.ddlNacionalidad.swidget().destroy();a.chkMatchCara.swidget().destroy();a.txtFechaNacimiento.swidget().destroy();a.txtLugarNacimiento.swidget().destroy();a.txtDomicilioRealCalle.swidget().destroy();a.txtDomicilioRealNumero.swidget().destroy();a.txtDomicilioRealPiso.swidget().destroy();a.txtDomicilioRealDepartamento.swidget().destroy();a.txtDomicilioRealLocalidad.swidget().destroy();a.ddlDomicilioRealPais.swidget().destroy();a.ddlDomicilioRealProvincia.swidget().destroy();a.txtDomicilioRealCodigoPostal.swidget().destroy();a.txtDomicilioLaboralCalle.swidget().destroy();a.txtDomicilioLaboralNumero.swidget().destroy();a.txtDomicilioLaboralPiso.swidget().destroy();a.txtDomicilioLaboralDepartamento.swidget().destroy();a.txtDomicilioLaboralLocalidad.swidget().destroy();a.ddlDomicilioLaboralPais.swidget().destroy();a.ddlDomicilioLaboralProvincia.swidget().destroy();a.txtDomicilioLaboralCodigoPostal.swidget().destroy();a.txtTelefonoParticularArea.swidget().destroy();a.txtTelefonoParticularNumero.swidget().destroy();a.ddlTelefonoCelularPais.swidget().destroy();a.txtTelefonoCelularArea.swidget().destroy();a.txtTelefonoCelularNumero.swidget().destroy();a.txtEmailLaboral.swidget().destroy();a.txtTelefonoLaboralArea.swidget().destroy();a.txtTelefonoLaboralNumero.swidget().destroy();a.txtCargoLaboral.swidget().destroy();a.txtVencimientoCargoLaboral.swidget().destroy();a.txtEmpresaLaboral.swidget().destroy();a.txtActividadEmpresa.swidget().destroy();a.txtOcupacionDescripcionPersonaJuridica.swidget().destroy();a.txtOcupacionDescripcion.swidget().destroy();a.txtEmail.swidget().destroy();a.ddlSexo.swidget().destroy();a.ddlEstadoCivil.swidget().destroy();a.ddlOcupacion.swidget().destroy();a.ddlOcupacionPersonaJuridica.swidget().destroy();a.txtConyugeNombre.swidget().destroy();a.txtConyugeApellido.swidget().destroy();a.ddlConyugeTipoDocumento.swidget().destroy();a.txtConyugeDocumento.swidget().destroy();a.txtPersonaExpuestaCargo.swidget().destroy();a.txtPersonaExpuestaAutoridad.swidget().destroy();a.ddlPersonaExpuestaCaracterInvocado.swidget().destroy();a.txtPersonaExpuestaDenominacion.swidget().destroy();a.txtPersonaExpuestaCuit.swidget().destroy();a.txtPersonaExpuestaObservaciones.swidget().destroy();a.txtPersonaExpuestaIndirectamente.swidget().destroy();a.txtPersonaExpuestaIndirectamenteRelacion.swidget().destroy();a.chkEsParteRelacionadaBalanz.swidget().destroy();a.txtEsParteRelacionadaBalanzNombre.swidget().destroy();a.txtEsParteRelacionadaBalanzApellido.swidget().destroy();a.ddlEsParteRelacionadaBalanzRelacion.swidget().destroy();a.ddlEsParteRelacionadaBalanzCompaniaGrupo.swidget().destroy();a.chkEsBeneficiarioFinal.swidget().destroy();a.txtEsBeneficiarioFinalObservaciones.swidget().destroy();a.ddlPaisTributo.swidget().destroy();a.ddlNitTipoIdentificacionFiscal.swidget().destroy();a.txtNit.swidget().destroy();a.ddlRiesgoCliente.swidget().destroy();a.container.html("");a.onClose()};a.setControls=function(c){a.divDatosConyuge.hide();a.divDatosLaboral.hide();a.divEmpresaLaboral.hide();a.divCargoLaboral.hide();a.divCargoLaboralAntiguedad.hide();a.divVencimientoCargoLaboral.hide();a.divActividadEmpresa.hide();a.divOcupacionDescripcion.hide();a.divOcupacionDescripcionPersonaJuridica.hide();a.divDomicilioLaboral.hide();a.divTelefonoLaboral.hide();a.divEmailLaboral.hide();a.divDatosPersonaExpuesta.hide();a.divPersonaExpuestaIndirectamente.hide();a.divNitTipoIdentificacionFiscal.hide();a.divNit.hide();a.divPaisTributo.hide();if(a.ddlEstadoCivil.swidget().selectedItem().value==Core.Business.eEstadoCivil.Casado){a.divDatosConyuge.show()}if(!a.esCuentaJuridica&&a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Titular&&a.ddlOcupacion.swidget().selectedItem()!=null){if(a.ddlOcupacion.swidget().selectedItem().TipoCampoAdicional==1){a.divDatosLaboral.show();a.divEmpresaLaboral.show();a.divCargoLaboral.show();a.divCargoLaboralAntiguedad.show();a.divActividadEmpresa.show()}if(a.ddlOcupacion.swidget().selectedItem().TipoCampoAdicional==2){a.divDatosLaboral.show();a.divOcupacionDescripcion.show()}if(a.ddlOcupacion.swidget().selectedItem().DomicilioLaboral==1){a.divDatosLaboral.show();a.divDomicilioLaboral.show();a.divTelefonoLaboral.show();a.divEmailLaboral.show()}}else{if(a.esCuentaJuridica){a.divDatosLaboral.show();a.divCargoLaboral.show();a.divCargoLaboralAntiguedad.show();a.divVencimientoCargoLaboral.show();a.divActividadEmpresa.show();a.divTelefonoLaboral.show();a.divEmailLaboral.show();if(a.ddlOcupacionPersonaJuridica.swidget().selectedItem()!=null&&a.ddlOcupacionPersonaJuridica.swidget().selectedItem().TipoCampoAdicional==2){a.divOcupacionDescripcionPersonaJuridica.show()}}}if(a.chkTributaEnOtroPaisSi.swidget().checked()){a.divPaisTributo.show();a.divNitTipoIdentificacionFiscal.show();a.divNit.show()}a.divCiudadaniaEeuu.hide();if(!a.esCuentaJuridica&&a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Titular){a.divCiudadaniaEeuu.show()}a.divPersonaExpuesta.hide();if(a.esCuentaJuridica||a.ddlTipo.swidget().selectedItem().idTipoCondominista==Core.Business.eTipoPersonaCuenta.Titular){a.divPersonaExpuesta.show();if(a.chkPersonaExpuestaSi.swidget().checked()){a.divDatosPersonaExpuesta.show();if(a.chkPersonaExpuestaIndirectamente.swidget().checked()){a.divPersonaExpuestaIndirectamente.show()}}}a.setProvincias(a.ddlDomicilioRealPais.swidget().value(),a.ddlDomicilioRealProvincia,(c&&a.persona&&a.persona.domicilioParticularidProvincia!=null)?a.persona.domicilioParticularidProvincia.toString():null);a.setProvincias(a.ddlDomicilioLaboralPais.swidget().value(),a.ddlDomicilioLaboralProvincia,(c&&a.persona&&a.persona.domicilioLaboralidProvincia!=null)?a.persona.domicilioLaboralidProvincia.toString():null);a.setTiposIdentificadoresFiscales(a.ddlPaisIdentificacionFiscal.swidget().value(),a.ddlTipoIdentificacionFiscal,(c&&a.persona&&a.persona.idTipoIdentificadorFiscal!=null)?a.persona.idTipoIdentificadorFiscal.toString():null);a.setTiposIdentificadoresFiscales(a.ddlPaisTributo.swidget().value(),a.ddlNitTipoIdentificacionFiscal,(c&&a.persona&&a.persona.nitidTipoIdentificadorFiscal!=null)?a.persona.nitidTipoIdentificadorFiscal.toString():null);a.ddlPersonaExpuestaCaracterInvocado.swidget().value(a.ddlTipo.swidget().selectedItem().Descripcion);a.divEsParteRelacionadaBalanz.hide();if(a.chkEsParteRelacionadaBalanz.swidget().checked()){a.divEsParteRelacionadaBalanz.show()}a.divEsBeneficiarioFinalObservaciones.hide();if(a.chkEsBeneficiarioFinal.swidget().checked()){a.divEsBeneficiarioFinalObservaciones.show()}};a.setProvincias=function(d,c,g){var f=$.grep(a.dataParametros.provincias,function(i,h){return i.idPais==d});var e=c.swidget().initialOptions;e.dataSource.data=f;if(g!=null){e.value=g}c.swidget().refresh(e)};a.setTiposIdentificadoresFiscales=function(d,c,g){var f=$.grep(a.dataParametros.tiposIdentificadoresFiscales,function(i,h){return i.idPais==d&&i.Fisica});var e=c.swidget().initialOptions;e.dataSource.data=f;if(g!=null){e.value=g}c.swidget().refresh(e)};a.validFechaNacimiento=function(d){if(!d){return false}else{if(d.getFullYear()<=1900){return false}else{d.setHours(0,0,0,0);var e=new Date();e.setHours(0,0,0,0);var c=(e.getTime()-d.getTime())/1000/60/60/24/365;if(c<18){return false}return true}}};a.isValidEmailAddress=function(c){if(!c){return false}else{var d=/^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i;if(!d.test(c)){return false}return true}};a.isValidPhone=function(c){var e=c.replaceAll("-","");var d=/^[0-9+]+$/;if(!d.test(e)||e.length<10||e.length>17){return false}return true};a.validDocumento=function(c,d,e){if(c==Core.Business.eTipoDocumento.DNI){if(d.length<6||d.length>8||!Core.Functions.Validations.isNumeric(d)){return false}return true}return true};a.validDniFiscalIdentifier=function(c,d,e){if(c&&d&&d.indexOf(c)==-1){return false}else{return true}};a.setTelefonoCelularControls=function(){a.divTelefonoCelularArea.hide();a.txtTelefonoCelularArea.val("");a.divTelefonoCelularNumero.removeClass("col-lg-3");a.divTelefonoCelularNumero.removeClass("col-md-3");a.divTelefonoCelularNumero.addClass("col-lg-4");a.divTelefonoCelularNumero.addClass("col-md-4");if(a.ddlTelefonoCelularPais.swidget().selectedItem().value==a.phoneCodeAr){a.divTelefonoCelularNumero.removeClass("col-lg-4");a.divTelefonoCelularNumero.removeClass("col-md-4");a.divTelefonoCelularNumero.addClass("col-lg-3");a.divTelefonoCelularNumero.addClass("col-md-3");a.divTelefonoCelularArea.show()}};a.getDate=function(c){var d=c.substr(6,2);var e=c.substr(4,2);var g=c.substr(0,4);var f=new Date();f.setDate(1);f.setYear(g);f.setMonth(e-1);f.setDate(d);return f};a.getSiNo=function(d,c,f,e){if(d.swidget().checked()){return 1}else{if(c.swidget().checked()){return 0}else{if(!f){return -1}else{f.value=false;a.divAlert.text(e);a.divAlert.slideDown();return -1}}}};a.isValidPerson=function(i,c){if(c!=0){var j=$.grep(a.dataParametros.tiposIdentificadoresFiscales,function(l,k){return l.idTipoIdentificadorFiscal==i.idTipoIdentificadorFiscal})[0];if(!i.tipo||!i.nombre||!i.apellido||!i.idTipoDocumento||!i.documento||!a.validDocumento(i.idTipoDocumento,i.documento)||!i.nacionalidad||!i.fechaNacimiento||!i.lugarNacimiento||!i.idTipoIdentificadorFiscal||(i.cuit_cuil&&j&&j.idPais==a.idPais_Argentina&&(!Core.Functions.Validations.isCuit(i.cuit_cuil)||!Core.Functions.Validations.isNumeric(i.cuit_cuil)))||(i.idTipoDocumento==Core.Business.eTipoDocumento.DNI&&j.idPais==a.idPais_Argentina&&(!i.cuit_cuil||!a.validDniFiscalIdentifier(i.documento,i.cuit_cuil)))||!i.idEstadoCivil||!i.idOcupacion||!i.idPaisEmisionPasaporte||!i.FechaVencimientoPasaporte){return false}if(!a.esCuentaJuridica||(i.tipo!=Core.Business.eTipoPersonaCuenta.Accionista&&i.tipo!=Core.Business.eTipoPersonaCuenta.BeneficiarioFinal)){if(!i.domicilioParticularCalle||(i.domicilioParticularidPais==a.idPais_Argentina&&!i.domicilioParticularNumero)||!i.domicilioParticularCiudad||!i.domicilioParticularidPais||!i.domicilioParticularidProvincia||!i.domicilioParticularCodigoPostal||!i.email||!a.isValidEmailAddress(i.email)){return false}}else{if(i.email&&!a.isValidEmailAddress(i.email)){return false}}var d=new Date();d.setFullYear(i.fechaNacimiento.substr(0,4));d.setMonth(i.fechaNacimiento.substr(4,2)-1);d.setDate(i.fechaNacimiento.substr(6,2));if(!a.validFechaNacimiento(d)){return false}var g=i.domicilioParticularTelefonoFijo.split("-");if(!Core.Functions.Validations.isNumeric(g[0])||!Core.Functions.Validations.isNumeric(g[1])){return false}if((g[0]||g[1])&&!a.isValidPhone(i.domicilioParticularTelefonoFijo)){return false}var h=i.domicilioParticularTelefonoMovil.split("-");if(h.length==2&&(!Core.Functions.Validations.isNumeric(h[0].replaceAll("\\+",""))||!Core.Functions.Validations.isNumeric(h[1]))){return false}if(h.length==3&&(!Core.Functions.Validations.isNumeric(h[1])||!Core.Functions.Validations.isNumeric(h[2]))){return false}if(!a.esCuentaJuridica||(i.tipo!=Core.Business.eTipoPersonaCuenta.Accionista&&i.tipo!=Core.Business.eTipoPersonaCuenta.BeneficiarioFinal)){if(h.length==2&&(h[0]==""||h[1]=="")){return false}if(h.length==3&&(h[1]==""||h[2]=="")){return false}if(!a.isValidPhone(i.domicilioParticularTelefonoMovil)){return false}}else{if((h.length==2&&(h[0]!=""||h[1]!=""))||(h.length==3&&(h[1]!=""||h[2]!=""))){if(!a.isValidPhone(i.domicilioParticularTelefonoMovil)){return false}}}if(!a.esCuentaJuridica&&i.tipo==Core.Business.eTipoPersonaCuenta.Titular){var e=$.grep(a.dataParametros.ocupaciones,function(l,k){return l.idOcupacion==i.idOcupacion})[0];if(e){if(e.TipoCampoAdicional==1&&(!i.cargo||!i.empresa||!i.EmpresaActividad)){return false}if(e.TipoCampoAdicional==2&&(!i.OcupacionDescripcion)){return false}if(e.DomicilioLaboral==1){if(!i.domicilioLaboralCalle||!i.domicilioLaboralNumero||!i.domicilioLaboralCiudad||!i.domicilioLaboralCodigoPostal||!i.domicilioLaboralidPais||!i.domicilioLaboralidProvincia){return false}if(i.domicilioLaboralTelefono){var f=i.domicilioLaboralTelefono.split("-");if(!Core.Functions.Validations.isNumeric(f[0])||!Core.Functions.Validations.isNumeric(f[1])){return false}if((f[0]||f[1])&&!a.isValidPhone(i.domicilioLaboralTelefono)){return false}}}}}if(a.esCuentaJuridica&&i.tipo!=Core.Business.eTipoPersonaCuenta.Accionista&&i.tipo!=Core.Business.eTipoPersonaCuenta.BeneficiarioFinal){if((i.idOcupacion==6||i.idOcupacion==7||i.idOcupacion==8)&&(!i.OcupacionDescripcion)){return false}if(!i.cargo||!i.EmpresaActividad||!i.fechaVencimientoMandato){return false}}if((a.esCuentaJuridica&&i.tipo!=Core.Business.eTipoPersonaCuenta.Accionista&&i.tipo!=Core.Business.eTipoPersonaCuenta.BeneficiarioFinal)||i.tipo==Core.Business.eTipoPersonaCuenta.Titular){if(i.esPep<0){return false}if(i.esPep){if(!i.pepCargo||!i.pepAutoridadEmision||!i.pepCaracterInvocado){return false}if(a.esCuentaJuridica&&(!i.pepCUIT||!Core.Functions.Validations.isCuit(i.pepCUIT)||!i.pepDenominacion)){return false}if(i.tipo==Core.Business.eTipoPersonaCuenta.Titular&&i.pepCUIT&&!Core.Functions.Validations.isCuit(i.pepCUIT)){return false}if(!i.PEPTipo&&(!i.PEPNombreIndirecto||!i.PEPRelacion)){return false}}}if(a.esCuentaJuridica&&(i.tipo==Core.Business.eTipoPersonaCuenta.Accionista||i.tipo==Core.Business.eTipoPersonaCuenta.BeneficiarioFinal)){if(i.esPep<0){return false}if(i.esPep){if(i.pepCUIT&&!Core.Functions.Validations.isCuit(i.pepCUIT)){return false}}}if(!a.esCuentaJuridica&&i.tipo==Core.Business.eTipoPersonaCuenta.Titular&&i.esCiudadanoEstadounidiense<0){return false}if(i.tributaEnOtroPais<0){return false}if(i.tributaEnOtroPais){var j=$.grep(a.dataParametros.tiposIdentificadoresFiscales,function(l,k){return l.idTipoIdentificadorFiscal==i.nitidTipoIdentificadorFiscal})[0];if(!i.nitidTipoIdentificadorFiscal||!i.nit||(j&&j.idPais==a.idPais_Argentina&&Core.Functions.Validations.isCuit(i.nit))){return false}}if(i.EsParteRelacionadaABalanz){if(!i.EsParteRelacionadaABalanzNombre||!i.EsParteRelacionadaABalanzApellido||!i.EsParteRelacionadaABalanzRelacion||!i.EsParteRelacionadaABalanzidCompaniaGrupo){return false}}if(i.EsBeneficiarioFinal&&!i.BeneficiarioFinalObservaciones){return false}if(!a.esCuentaJuridica&&Core.Objects.Context.Configuration.idAplicacion==3&&c>=10&&(!i.montoCompliance||i.montoCompliance==0||!i.idRiesgo)){return false}}return true}};Core.Controls.MapMarker=function(b){var a=this;a.divModal=$(".modal-map-marker");a.latitude="0";a.longitude="0";$.extend(true,a,b);a.show=function(){a.divMap=a.divModal.find(".div-map");a.mapMain=new google.maps.Map(a.divMap.get(0),{zoom:14,mapTypeId:"roadmap",styles:[]});a.mrkMain=new google.maps.Marker({map:a.mapMain});a.mapMain.setCenter(new google.maps.LatLng(a.latitude,a.longitude));a.mrkMain.setPosition(new google.maps.LatLng(a.latitude,a.longitude));a.divModal.on("hidden.bs.modal",function(){a.destroy()});a.divModal.modal({show:true})};a.destroy=function(){a.divMap.html("")}};Core.Controls.eMenuTriggerButton={MouseLeft:1,MouseRight:3};Core.Controls.eMenuItemType={Button:1,Separator:2};Core.Controls.MenuItem=function(a){this.Name="(Undefined)";this.Tooltip="";this.Icon=null;this.Type=Core.Controls.eMenuItemType.Button;this.onClick=null;$.extend(true,this,a)};Core.Controls.Menu=function(a,b,e,c,d){if(c==Core.Controls.eMenuTriggerButton.MouseLeft){$(a).off("click.cf.controls.menu");$(a).on("click.cf.controls.menu",function(h){g(h)})}else{if(c==Core.Controls.eMenuTriggerButton.MouseRight){$(a).off("contextmenu.cf.controls.menu");$(a).on("contextmenu.cf.controls.menu",function(h){g(h)})}}function g(h){b=d(b);Core.Controls.Menu.menuElement.empty();for(var j=0;j<b.length;j++){var k=$.extend(true,new Core.Controls.MenuItem(),b[j]);f(k)}Core.Controls.Menu.menuElement.show();if(e==undefined||e==null){Core.Controls.Menu.menuElement.offset({top:h.pageY,left:h.pageX})}else{Core.Controls.Menu.menuElement.position(e)}Core.Controls.Menu.menuElement.show();h.preventDefault();h.stopPropagation()}function f(i){if(i.Type==Core.Controls.eMenuItemType.Button){var h=$('<div class="menu-button" />').appendTo(Core.Controls.Menu.menuElement);h.html(i.Name);h.attr("title",i.Tooltip);h.on("click",function(j){if(i.onClick!=null){i.onClick(i,j)}});if(i.Icon!=null){h.css({"background-image":'url("'+i.Icon+'")',"padding-left":"24px"})}}else{if(i.Type==Core.Controls.eMenuItemType.Separator){var h=$('<hr class="menu-separator" />').appendTo(Core.Controls.Menu.menuElement)}}}};Core.Controls.menuElement=null;$(document).ready(function(){Core.Controls.Menu.menuElement=$('<div class="core-controls-menu" />').hide().appendTo(document.body);$(document).on("click.cf.controls.menu",function(a){Core.Controls.Menu.menuElement.hide()})});Core.Controls.MesaDetalleMontoAcumulado=function(b){var a=this;a.divDetalleMontoAcumulado=$(".div-modal-detalles-monto-acumulado");a.requestData={};$.extend(true,a,b);a.txtFechaInicio=null;a.divDetalles=null;a.btnEjecutar=null;a.show=function(){a.txtFechaInicio=a.divDetalleMontoAcumulado.find(".date-picker-detalles-monto-acumulado-inicio");a.divDetalles=a.divDetalleMontoAcumulado.find(".div-detalles-monto-acumulado-conceptos");a.btnEjecutar=a.divDetalleMontoAcumulado.find(".btn-ejecutar-detalles");var c=new Date();c.setDate(c.getDate()-7);if(!a.txtFechaInicio.swidget()){a.txtFechaInicio.shieldDatePicker({format:"{0:dd/MM/yyyy}",textTemplate:"{0:dd/MM/yyyy}",parseFormats:["dd/MM/yyyy"],value:c,max:new Date,})}a.txtFechaInicio.swidget().value(c);if(!a.divDetalles.swidget()){a.initGrid()}a.refreshGrid([]);a.btnEjecutar.unbind("click");a.btnEjecutar.on("click",function(){a.loadGrid()});a.divDetalleMontoAcumulado.modal({show:true})};a.initGrid=function(){a.divDetalles.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:[{width:"5%",field:"MontoAcumulado",title:"Acumulado",headerAttributes:Core.Functions.grid.getCellEvenClass(),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatNumberWithColor},{width:"5%",field:"MontoAplicar",title:"Monto",headerAttributes:Core.Functions.grid.getCellOddClass(),attributes:Core.Functions.grid.getRightAlignedColumnClass(),format:Core.Functions.grid.formatNumberWithColor},{width:"4%",field:"FechaConcertacion",title:"Concertación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"4%",field:"FechaLiquidacion",title:"Liquidación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"3%",field:"idOperacion",title:"Operación",headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"5%",field:"DescTipoOperacion",title:"Tipo Operación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"5%",field:"Concepto",title:"Concepto",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"4%",field:"UsernameModificacion",title:"Usuario Modificación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"7%",field:"FechaModificacion",title:"Modificación",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{width:"5%",field:"UsernameAlta",title:"Usuario Alta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{width:"7%",field:"FechaAlta",title:"Alta",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()}],toolbar:[{buttons:[{commandName:"excel",caption:"Exportar a Excel"}]}],exportOptions:{excel:{dataSource:{data:[]},author:"Balanz Capital Valores S.A.",fileName:"Detalles",columnFields:["MontoAcumulado","MontoAplicar","FechaConcertacion","FechaLiquidacion","idOperacion","DescTipoOperacion","Concepto","UsernameModificacion","FechaModificacion","UsernameAlta","FechaAlta"],header:{enabled:true,style:{bold:true,italic:true}},worksheet:{name:"Detalles"}}}})};a.loadGrid=function(){a.requestData.FechaInicio=Core.Functions.Date.getDateAsString(a.txtFechaInicio.swidget().value());var c=new Core.Ajax.ServerRequest({overlayElement:a.divDetalles,showOverlay:true,secureRequest:true,requestUrl:"reporte/montoacumuladoconceptos",requestType:"GET",requestData:a.requestData});c.onSuccess=function(e){var d=e.detalle==null?[]:e.detalle;a.refreshGrid(d)};c.request()};a.refreshGrid=function(c){var d=a.divDetalles.swidget().initialOptions;d.dataSource.data=c;d.exportOptions.excel.dataSource.data=c;d.exportOptions.excel.readDataSource=true;a.divDetalles.swidget().refresh(d)};a.destroy=function(){a.txtFechaInicio.swidget().destroy();a.divDetalles.swidget().destroy()}};Core.Controls.MinutaBuscarAsesor=function(c){var b=this;var a=13;b.divModal=$(".modal-buscar-asesores");b.divGridAsesores=null;b.onSelected=function(){};b.onClosed=function(){};$.extend(true,b,c);b.show=function(){b.divGridAsesores=b.divModal.find(".div-asesores");b.txtFilter=b.divModal.find(".textbox-filter-asesores");b.txtFilter.val("");b.btnBuscar=b.divModal.find(".button-buscar");b.initControls();b.divModal.unbind("hidden.bs.modal");b.divModal.on("hidden.bs.modal",function(){b.destroy()});b.divModal.modal({show:true})};b.initControls=function(){b.divGridAsesores.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:[{field:"NombreCompleto",width:"30%",title:"Nombre",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"Username",width:"30%",title:"Usuario",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass()},{field:"Unidad",width:"30%",title:"Unidad",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass()},{field:"",title:" ",width:"10%",headerAttributes:Core.Functions.grid.getCellOddClass(),buttons:[{caption:"Seleccionar",cls:"",commandName:"Seleccionar",click:function(e){var d=b.divGridAsesores.swidget().dataItem(e);b.onSelected(d);b.divModal.modal("hide")}}]}]});b.txtFilter.unbind("keyup");b.txtFilter.on("keyup",function(d){if(d.keyCode==a){b.loadGrid()}});b.btnBuscar.unbind("click");b.btnBuscar.on("click",function(){b.loadGrid()})};b.loadGrid=function(){var d=b.divGridAsesores.swidget().initialOptions;d.dataSource.data=[];b.divGridAsesores.swidget().refresh(d);if(b.txtFilter.val()&&b.txtFilter.val().length>=4){var e=new Core.Ajax.ServerRequest({overlayElement:b.divModal.find(".modal-body"),showOverlay:true,secureRequest:true,requestUrl:"minutas/version2/asesores/"+b.txtFilter.val(),requestType:"GET"});e.onSuccess=function(h){var f=h.asesores==null?[]:h.asesores;var g=b.divGridAsesores.swidget().initialOptions;g.dataSource.data=f;b.divGridAsesores.swidget().refresh(g)};e.request()}};b.destroy=function(){b.onClosed();b.divGridAsesores.swidget().destroy()}};Core.Controls.MinutaBuscarCuenta=function(c){var b=this;var a=13;b.divModal=$(".modal-buscar-cuentas");b.divGridCuentas=null;b.onSelected=function(){};b.requestUrl=("cuentas/"+encodeURIComponent(Core.Objects.Context.IdPersona)+"?search={filter}");$.extend(true,b,c);b.show=function(){b.divGridCuentas=b.divModal.find(".div-cuentas");b.txtFilter=b.divModal.find(".textbox-filter-cuentas");b.txtFilter.val("");b.btnBuscar=b.divModal.find(".button-buscar");b.initControls();b.divModal.unbind("hidden.bs.modal");b.divModal.on("hidden.bs.modal",function(){b.destroy()});b.divModal.modal({show:true})};b.initControls=function(){var d=[];d.push({field:"idCuenta",title:"Id Cuenta",width:"15%",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),columnTemplate:function(e,f,g){if(f.Color){e.parent().css("background-color","rgba("+Core.Functions.grid.hexToRgb(f.Color)+((g%2==0)?", 0.6":", 1 ")+")")}e.html(f.idCuenta)}});d.push({field:"NumComitente",width:"15%",title:"Comitente",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedString});d.push({field:"NumCuotapartista",width:"15%",title:"Cuotapartista",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedString});d.push({field:"Descripcion",width:"45%",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),format:Core.Functions.grid.formatUndefinedString});d.push({field:"",title:" ",width:"10%",headerAttributes:Core.Functions.grid.getHeaderAttribute(d.length),buttons:[{caption:"Seleccionar",cls:"",commandName:"Seleccionar",click:function(f){var e=b.divGridCuentas.swidget().dataItem(f);b.onSelected(e);b.divModal.modal("hide")}}]});b.divGridCuentas.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,columns:d});b.txtFilter.unbind("keyup");b.txtFilter.on("keyup",function(f){if(f.keyCode==a){b.loadGrid()}});b.btnBuscar.unbind("click");b.btnBuscar.on("click",function(){b.loadGrid()})};b.loadGrid=function(){var d=b.divGridCuentas.swidget().initialOptions;d.dataSource.data=[];b.divGridCuentas.swidget().refresh(d);if(b.txtFilter.val()&&b.txtFilter.val().length>=3){var e=b.requestUrl.replaceAll("{filter}",b.txtFilter.val());var f=new Core.Ajax.ServerRequest({overlayElement:b.divModal.find(".modal-body"),showOverlay:true,secureRequest:true,requestUrl:e,requestType:"GET"});f.onSuccess=function(i){var g=i.cuentas==null?[]:i.cuentas;Core.Objects.Accounts=g;var h=b.divGridCuentas.swidget().initialOptions;h.dataSource.data=g;b.divGridCuentas.swidget().refresh(h)};f.request()}};b.destroy=function(){b.divGridCuentas.swidget().destroy()}};Core.Controls.MinutaConfirmacion=function(b){var a=this;a.divModalConfirmacion=$(".div-minuta-confirmacion");a.divDescripcionSolicitud=null;a.data=null;a.onConfirm=null;a.labels={Cuenta:"Cuenta: ",FechaConcertacion:"Fecha Concertación: ",FechaLiquidacion:"Fecha Liquidación: ",Mercado:"Mercado: ",TipoOperacion:"Tipo Operación: ",Ticker:"Ticker: ",Moneda:"Moneda: ",Cantidad:"Cantidad: ",Precio:"Precio: ",PrecioReferencia:"Precio Referencia: ",Monto:"Monto: ",PrecioProductor:"Precio Productor: ",Broker:"Broker: ",PersonaAsesor:"Persona Asesor: ",CantidadDiasPrestamo:"Cantidad Días Préstamo: ",TasaPrestamo:"Tasa Préstamo: "};$.extend(true,a,b);a.show=function(){a.divDescripcionSolicitud=a.divModalConfirmacion.find(".div-descripcion-solicitud");var c="";if(a.data.Mensajes&&a.data.Mensajes.length){c+='<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"><h4>Advertencias</h4></div>';c+='<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="width: auto; background-color: rgba('+(a.data.Color?a.hexToRgb(a.data.Color):"")+',1);">';a.data.Mensajes.forEach(function(e,d){c+="<p><strong>"+e.Mensaje+"</strong></p>"});c+="</div>"}c+='<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"><h4>Minuta</h4></div>';$.each(a.data,function(d,e){if(a.labels[d]&&e){c+='<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"><p>'+a.labels[d]+"<strong>"+e+"</strong></p></div>"}});a.divDescripcionSolicitud.html(c);a.btnConfirm=a.divModalConfirmacion.find(".btn-confirm");a.btnConfirm.unbind("click");a.btnConfirm.click(function(){a.onAccepted()});a.btnConfirm.hide();if(a.data.PermitirAvanzar==1){a.btnConfirm.show()}a.divModalConfirmacion.modal({show:true})};a.onAccepted=function(){var c=new Core.Ajax.ServerRequest({overlayElement:a.btnConfirm,showOverlay:true,secureRequest:true,requestUrl:"minutas/version2/insertarconfirmacion",requestType:"POST",requestData:{idMinuta:a.data.idMinuta}});c.onSuccess=function(d){a.divModalConfirmacion.modal("hide");new Core.Controls.Dialog("Aviso","Minuta ingresada correctamente. Número: "+d.idMinuta,{displayButtons:{close:true,accept:false}}).show();a.onConfirm()};c.request()};a.hexToRgb=function(d){d=d.replace("#","");var f=parseInt(d.substring(0,2),16);var e=parseInt(d.substring(2,4),16);var c=parseInt(d.substring(4,6),16);var h=f+","+e+","+c;return h}};Core.Controls.OperarConfirmation=function(c){var b=this;var a=13;b.idDefaultProfile=null;b.divModalConfirmacion=$(".div-confirmacion");b.divDescriptionOperation=null;b.divTerminosYCondiciones=null;b.lblCodigo4D=null;b.txtCodigo4D=null;b.chkRecordarCodigo4D=null;b.data=null;b.idAccount=null;b.idAccountToContinue=null;b.backgroundColorTitle=null;b.generalTitle=null;b.title=null;b.accountDescription=null;b.codigo4DDescription=null;b.footerHtml=null;b.urlMethod=null;b.terminosYCondicionesDescripcion="Declaro que he leído los términos y condiciones";b.incluirDescripcionTerminoYCondicion=true;b.terminosYCondiciones=[];b.chksTerminosYCondiciones=[];b.onConfirm=null;b.urlImage=null;b.labels={Fecha:"Fecha: ",Instrumento:"Instrumento: ",Especie:"Especie: ",Moneda:"Moneda: ",Plazo:"Plazo: ",Precio:"Precio: ",Cantidad:"Cantidad: ",Gastos:"Gastos: ",ImporteBruto:"Importe Bruto: ",ImporteNeto:"Importe Neto: ",TipoOperacion:"Tipo de Operación: ",FondoDestino:"Fondo destino: ",ImporteCredito:"Estimado a acreditar: ",PlazoCredito:"Plazo de crédito: ",ImporteDebito:"Estimado a debitar: ",PlazoDebito:"Plazo de débito: ",CotizacionNeta:"Cotización final estimada: ",Aporte:"Aporte: ",AporteAproximado:"Aporte aproximado: ",Ticker:"Ticker: ",PrecioActual:"Precio Unitario: ",InstrumentoNuevo:"Instrumento Nuevo: ",CantidadNueva:"Cantidad Nueva: ",EspecieNueva:"Especie Nueva: ",EmiRec:"Emisor/Receptor: ",InmDif:"Plazo: ",FechaDiferida:"Fecha Diferida: ",PaisContraparte:"Pais de la Contraparte: ",AgenteContraparte:"Agente de la Contraparte: ",NumComitenteContraparte:"Número Comitente Contraparte: ",DescripcionCuentaContraparte:"Descripción Cuenta Contraparte: ",FechaLiquidacion:"Fecha Liquidación: ",VencimientoOrden:"Vencimiento Orden: "};b.labelStyles={ImporteCredito:"style='font-size:17px; font-weight: bold;'",ImporteDebito:"style='font-size:17px; font-weight: bold;'",CotizacionNeta:"style='font-size:17px; font-weight: bold;'"};b.labelsDolarBolsaCompra={TickerCompra:"Especie de Compra: ",PrecioCompra:"Precio de Compra: ",NominalesCompra:"Cantidad de Compra: ",GastosCompra:"Gastos de Compra: "};b.labelsDolarBolsaVenta={TickerVenta:"Especie de Venta: ",PrecioVenta:"Precio de Venta: ",NominalesVenta:"Cantidad de Venta: ",GastosVenta:"Gastos de Venta: "};b.stayInPage=false;$.extend(true,b,c);b.show=function(){b.divModalConfirmacion.find(".modal-header").css("background-color",b.backgroundColorTitle);b.divModalConfirmacion.find(".modal-title").html(b.generalTitle);b.divModalConfirmacion.find(".label-title").html(b.title);b.divModalConfirmacion.find(".label-account-description").html(b.accountDescription);b.divModalConfirmacion.find(".label-aclaracion-footer").html(b.footerHtml);b.divDescriptionOperation=b.divModalConfirmacion.find(".div-description-operation");b.divTerminosYCondiciones=b.divModalConfirmacion.find(".div-terminos-y-condiciones");b.chkRecordarCodigo4D=b.divModalConfirmacion.find(".checkbox-recordar-codigo-4d");if(b.chkRecordarCodigo4D[0]){b.chkRecordarCodigo4D[0].checked=false}b.txtCodigo4D=b.divModalConfirmacion.find(".textbox-codigo4d");b.lblCodigo4D=b.divModalConfirmacion.find(".label-codigo4d");b.lblCodigo4D.html(b.codigo4DDescription);b.txtCodigo4D.val("");b.divModalConfirmacion.find(".div-images").hide();if(b.urlImage){b.divModalConfirmacion.find(".div-images").show();b.divModalConfirmacion.find(".img-balanz").attr("src",b.urlImage)}b.divModalConfirmacion.find(".btn-confirm").unbind("click");b.divModalConfirmacion.find(".btn-confirm").click(function(){var q={value:true};Core.Functions.Validations.getValidatedInputValue(b.txtCodigo4D,q);if(!q.value){return}var p=[];for(var m=0;m<b.chksTerminosYCondiciones.length;m++){if(!b.chksTerminosYCondiciones[m][0].checked){q.value=false;var o=$.grep(b.terminosYCondiciones,function(r,i){return r.idTerminoYCondicion==b.chksTerminosYCondiciones[m][0].id})[0];if(o){p.push(o)}}}if(!q.value){var l="Debe aceptar "+((p.length==1)?"el reglamento ":"los reglamentos: ");for(var m=0;m<p.length;m++){if(m==0){l+=p[m].Descripcion}else{l+=", "+p[m].Descripcion}}l+=".";var n=new Core.Controls.Dialog("Aviso",l,{displayButtons:{close:true,accept:false}});n.show();return}if(b.chksTerminosYCondiciones.length>0){b.acceptTerminosYCondiciones(b.terminosYCondiciones,0)}else{b.onAccepted()}});var g="";$.each(b.data,function(i,l){if(b.labels[i]&&l){g+='<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"><p '+(b.labelStyles[i]?b.labelStyles[i]:"")+">"+b.labels[i]+"<strong>"+l+"</strong></p></div>"}});if(b.data.TickerCompra){var e={PrecioCompra:b.data.PrecioCompra,NominalesCompra:b.data.NominalesCompra,GastosCompra:b.data.GastosCompra};g+='<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"><hr><p><strong>Operación de compra</strong></p></div>';g+='<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"><p>'+b.labelsDolarBolsaCompra.TickerCompra+"<strong>"+b.data.TickerCompra+"</strong></p></div>";$.each(e,function(i,l){if(b.labelsDolarBolsaCompra[i]&&l){g+='<div class="col-lg-4 col-md-4 col-sm-4 col-xs-4"><p>'+b.labelsDolarBolsaCompra[i]+"<strong>"+l+"</strong></p></div>"}})}if(b.data.TickerVenta){var f={PrecioVenta:b.data.PrecioVenta,NominalesVenta:b.data.NominalesVenta,GastosVenta:b.data.GastosVenta};g+='<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"><hr><p><strong>Operación de venta</strong></p></div>';g+='<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"><p>'+b.labelsDolarBolsaVenta.TickerVenta+"<strong>"+b.data.TickerVenta+"</strong></p></div>";$.each(f,function(i,l){if(b.labelsDolarBolsaVenta[i]&&l){g+='<div class="col-lg-4 col-md-4 col-sm-4 col-xs-4"><p>'+b.labelsDolarBolsaVenta[i]+"<strong>"+l+"</strong></p></div>"}})}if(b.data.ordenes&&b.data.ordenes.length>0){b.data.ordenes.forEach(function(m,l){g+='<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"><hr><p><strong>'+m.Ticker+"</strong></p></div>";var i={Cantidad:m.Cantidad,PrecioActual:m.PrecioActual,Gastos:m.Gastos,ImporteNeto:m.ImporteNeto};$.each(i,function(n,o){if(b.labels[n]&&o){g+='<div class="col-lg-4 col-md-4 col-sm-4 col-xs-4"><p>'+b.labels[n]+"<strong>"+o+"</strong></p></div>"}})})}if(b.data.MensajePrecarga&&b.data.MensajePrecarga!=""){g+='<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"><div class="alert alert-info" style="margin: 15px 0;"><p style="margin: 0; font-size: 13px; line-height: 20px;">'+b.data.MensajePrecarga+"</p></div></div>"}if(b.data.AlertaOperacion&&b.data.AlertaOperacion!=""){g+='<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"><div class="alert alert-warning" style="margin: 15px 0;"><p style="margin: 0; font-size: 13px; line-height: 20px;"><span class="glyphicon glyphicon-warning-sign" style="padding: 0 8px 0 0;"></span>'+b.data.AlertaOperacion+"</p></div></div>"}b.divDescriptionOperation.html(g);b.terminosYCondiciones=$.grep(b.terminosYCondiciones,function(l,i){return l.idTYCAprobado==-1});for(var h=0;h<b.terminosYCondiciones.length;h++){var k=b.terminosYCondiciones[h];var d=$('<input type="checkbox" id="'+k.idTerminoYCondicion+'" class="checkbox-accept" style="vertical-align:top;"/>').appendTo(b.divTerminosYCondiciones);b.chksTerminosYCondiciones.push(d);var j=$('<label style="font-size:12px;" for="'+k.idTerminoYCondicion+'"/>').html(b.terminosYCondicionesDescripcion+(b.incluirDescripcionTerminoYCondicion?(" "+k.Descripcion):"")+". <br/> Para descargarlo haga ").appendTo(b.divTerminosYCondiciones);$('<a target="_blank"/>').text("Click aquí.").attr("href",k.urlTyC).appendTo(j);$("<br />").appendTo(b.divTerminosYCondiciones)}b.divModalConfirmacion.unbind("shown.bs.modal");b.divModalConfirmacion.on("shown.bs.modal",function(){b.txtCodigo4D.focus()});b.divModalConfirmacion.unbind("hidden.bs.modal");b.divModalConfirmacion.on("hidden.bs.modal",function(){for(var l=0;l<b.chksTerminosYCondiciones.length;l++){b.chksTerminosYCondiciones[l].remove()}b.chksTerminosYCondiciones=[];b.divTerminosYCondiciones.empty()});b.divModalConfirmacion.modal({show:true})};b.acceptTerminosYCondiciones=function(f,d){var e=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"terminos/aceptartyc",requestType:"POST",requestData:{idPersona:Core.Objects.Context.IdPersona,idTerminoYCondicion:f[d].idTerminoYCondicion}});e.onSuccess=function(g){d++;if(f.length>d){b.acceptTerminosYCondiciones(f,d)}else{b.onAccepted()}};e.request()};b.onAccepted=function(){var g={value:true};var d={idCuenta:b.idAccount,Operation:b.data.Operation,Codigo4D:Core.Functions.Validations.getValidatedInputValue(b.txtCodigo4D,g)};var e=null;if(b.data.idOrdenPrecargada){e=b.data.idOrdenPrecargada;d.idOrdenPrecargada=e}else{e=b.data.idOrden;d.idOrden=e}b.divModalConfirmacion.modal("hide");var f=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:b.urlMethod,requestType:"POST",requestData:d});f.onSuccess=function(h){new Core.Controls.Dialog("Aviso","Orden ingresada correctamente. Número: "+e,{displayButtons:{close:true,accept:false},onClosed:function(){if(!b.stayInPage){Core.Business.PosicionConsolidada.init((b.idAccountToContinue?b.idAccountToContinue:b.idAccount),b.idDefaultProfile)}}}).show();if(b.chkRecordarCodigo4D[0]&&b.chkRecordarCodigo4D[0].checked){Core.Objects.Context.OperationCode=b.txtCodigo4D.val();if(!Core.Functions.Validations.isBlockedStorage()&&Core.Functions.Persistence.getStorage()){Core.Functions.Persistence.getStorage().setItem("CoreContext",LZString.compressToUTF16(JSON.stringify(Core.Objects.Context)))}}if(b.onConfirm){b.onConfirm()}};f.request()}};Core.Controls.ActiveOverlayList=[];Core.Controls.tmrRefreshOverlayList=window.setInterval(function(){for(var a=0;a<Core.Controls.ActiveOverlayList.length;a++){var b=Core.Controls.ActiveOverlayList[a];b.refresh()}},50);Core.Controls.Overlay=function(b){var a=this;a.targetControl=$(b);a.tmrMain=null;a.divOverlay=$('<div class="core-controls-overlay" />');a.init=function(){a.divOverlay.appendTo(a.getContainer());a.refresh();Core.Controls.ActiveOverlayList.push(a)};a.getContainer=function(){var c=a.targetControl.parent();while(c.is("tr")||c.is("tbody")||c.is("thead")||c.is("table")){c=c.parent()}return c};a.refresh=function(){if(a.targetControl.is(":visible")){a.divOverlay.show();a.divOverlay.width(a.targetControl.outerWidth());a.divOverlay.height(a.targetControl.outerHeight());a.divOverlay.position({my:"left top",at:"left top",of:a.targetControl})}else{a.divOverlay.hide()}};a.destroy=function(){Core.Controls.ActiveOverlayList.remove(a);a.divOverlay.remove()};a.init()};Core.Controls.ProcessProgress=function(b){var a=this;a.divModal=$(".div-modal-process-progress");a.lblMessage=null;a.progressBar=null;a.timerIdMessage=null;a.estadoActual=null;a.idProcess=null;a.overlayElement=null;a.onFinish=function(){};$.extend(true,a,b);a.show=function(){a.lblMessage=$(".label-message");a.progressBar=$(".bar-process-progress");a.progressBar.value=0;a.progressBar.textContent=0;a.divModal.unbind("hidden.bs.modal");a.divModal.on("hidden.bs.modal",function(){a.destroy()});if(a.idProcess){a.loadMessage(function(){a.divModal.modal({show:true});a.timerIdMessage=window.setInterval(function(){a.loadMessage()},1000)})}else{if(a.onFinish){a.onFinish()}}};a.loadMessage=function(c){var d=new Core.Ajax.ServerRequest({showOverlay:c!=null,overlayElement:a.overlayElement,secureRequest:true,requestUrl:"ejecucionDeProcesos/obtenerEstado/"+a.idProcess,requestType:"GET"});d.onSuccess=function(e){a.estadoActual=e&&e.estado&&e.estado[0]?e.estado[0]:null;if(a.estadoActual){a.lblMessage.text((a.estadoActual.Texto?a.estadoActual.Texto:"Procesando")+" "+(a.estadoActual.CantEjecutada+"/"+a.estadoActual.CantTotal));a.progressBar.attr("value",a.estadoActual.CantTotal?((a.estadoActual.CantEjecutada/a.estadoActual.CantTotal)*100):0)}if(c){c()}if(!a.estadoActual||a.estadoActual.Finalizado){a.divModal.modal("hide")}};d.request()};a.destroy=function(){if(a.timerIdMessage){window.clearInterval(a.timerIdMessage);Core.Objects.Context.Timers.remove(a.timerIdMessage)}if(a.estadoActual&&a.estadoActual.Finalizado){if(a.estadoActual.DescripcionResultado){new Core.Controls.Dialog("Aviso",a.estadoActual.DescripcionResultado,{displayButtons:{close:true,accept:false}}).show()}if(a.onFinish){a.onFinish()}}}};Core.Controls.Prompt=function(e,a,d){var b=13;var c=this;c.displayButtons={cancel:true,accept:true};c.divModal=$(".default-prompt");c.txtInput=null;c.allowEmptyText=false;c.onAccepted=function(){};c.placeholder="";c.defaultValue="";$.extend(true,c,d);c.show=function(){var f=function(g,h){if(h){c.divModal.find("."+g).show()}else{c.divModal.find("."+g).hide()}};c.txtInput=$(".textbox-prompt-input");c.txtInput.val(c.defaultValue);c.txtInput.attr("placeholder",c.placeholder);c.txtInput.unbind("keyup");c.txtInput.on("keyup",function(g){if(g.keyCode==b){c.divModal.find(".button-prompt-accept").click()}});c.divModal.find(".prompt-title").html(e);c.divModal.find(".label-prompt-input").text(a+":");c.divModal.find(".button-prompt-accept").unbind("click");c.divModal.find(".button-prompt-accept").click(function(){if(c.txtInput.val()!=""||c.allowEmptyText){c.onAccepted(c.txtInput.val());c.divModal.modal("hide")}});f("button-prompt-cancel",c.displayButtons.cancel);f("button-prompt-accept",c.displayButtons.accept);c.divModal.unbind("shown.bs.modal");c.divModal.on("shown.bs.modal",function(){c.txtInput.focus()});c.divModal.modal({show:true})};c.destroy=function(){}};Core.Enums=new Object();Core.Enums.Currency={Pesos:{idMoneda:1,Simbolo:"$",Descripcion:"Pesos"},Dolares:{idMoneda:2,Simbolo:"u$s",Descripcion:"Dólares"},Euros:{idMoneda:3,Simbolo:"€",Descripcion:"Euros"},DolaresCable:{idMoneda:4,Simbolo:"usd",Descripcion:"US Dollar (Cable)"}};Core.Enums.eCurrency={Pesos:1,Dolares:2,Euros:3,DolaresCable:4};Core.Enums.eEspeciesTipoOperacion={Compra:1,Venta:2,Licitacion:13,Renovacion:14,CompraMonedas:16,VentaMonedas:17,CaucionColocadora:20,CaucionTomadora:21,CompraDolarBolsa:22,VentaDolarBolsa:23,SuscripcionAProyectoDesdeComitente:25,SuscripcionAProyectoDesdeBanco:26,RescateDesdeProyectoAComitente:27,RescateDesdeProyectoABanco:28,ConversionEspecies:31};Core.Enums.eEspeciesTipoPrecio={Limite:1};Core.Enums.eEspeciesUnidadMedida={Pesos:1,Nominales:2};Core.Enums.eEstadoOperacion={Pendiente:1,Verificada:2,Liquidada:4,Cancelada:5,PreOperada:6,ParcialmenteLiquidada:7};Core.Enums.eFondosTipoOperacion={Suscripcion:1,Rescate:2,CambioFondo:3};Core.Enums.eFondosUnidadMedida={Moneda:1,Cuotapartes:2};Core.Enums.eManagerOperacionPantallaOrigen={OperacionesUSD:1,OperacionesParidad:2,Liquidacion:3,ManagerOperacionPreOperada:4};Core.Enums.eMesaIntencionalidad={USD:1,Paridad:2,USDParidad:3};Core.Enums.eMesaOperacionOpcionesDefault={NA:0,BYMA:1,MAE:2,Exterior:3,Nueva:4};Core.Enums.eMesaOperacionOrigen={Operacion:1,CompraVentaBono:2,Ajuste:3,Transferencia:4,Taco:5,Banco:6,Mercado:7};Core.Enums.eMesaTipoOperacion={Compra:1,Venta:2,VentaBono:3,CompraBono:4,Ajuste:5,Transferencia:6,PreOperada:7};Core.Enums.eMinutaMercado={Merval:1,Mae:2,Rofex:3,NYSE:4,NASDAQ:5,Cambio:6,Internacional:7,PrestamoEfectivo:8,Privado:9,Facturas:11,MinutasEspeciales:12};Core.Enums.eMinutaTipoOperacion={Compra:1,Venta:2};Core.Enums.eNegocio={BCV:1,FCI:2,BCI:5,BalanzCambio:7};Core.Enums.ePanel={AccionesMerval:1,AccionesBurcap:2,AccionesMercadoArgentino:3,Acciones:4,AccionesMerval25:5,Bonos:6,Cedears:7,Opciones:8,Futuros:9,Fondos:10,Lebacs:14,Letes:15,ONs:16,BonosFull:17,Cambio:18,NYSE:19,Monedas:20,NASDAQ:21,ETF:22,BonosSoberanos:23,BonosSubsoberanos:24,LetrasLetes:25,LetrasLecaps:26,CorporativosObligacionesNegociables:27,CorporativosValoresCortoPlazo:28,LetrasLecers:29,Internacional:30,FuturosByma:31,LetrasLelinks:32,FuturosMatba:33,Cauciones:34,DolarBolsa:35,MAE:36,OferentesExternos:37,Packs:38,ConversionEspecies:45,TransferenciasTitulosArgentina:46,ACDI:51,TransferenciasTitulosInternacional:52,TransferenciasTitulosInternacionalBCI:56,BCINYSE:60,BCINASDAQ:61,BCIETF:62,AllBCI:97,All:99};Core.Enums.ePlazo={CI:0,D24:1,D48:2,D72:3,CICI:1000,CI24:1001,CI48:1002,D2424:1011,D2448:1012,D4848:1022};Core.Enums.eTestInversorPerfil={Conservador:1,Moderado:2,Agresivo:3,Error:4,MuyAgresivo:5,Calificado:6};Core.Enums.eTipoAutenticacion={Password:0,Microsoft:3};Core.Enums.eTipoCuentaBancaria={Argentina:1,Exterior:2};Core.Enums.eTipoOrden={Orden:1,Precarga:2};Core.Business.eTipoPersonaCuenta={None:0,Titular:1,Autorizado:2,Firmante:3,Apoderado:4,Accionista:5,BeneficiarioFinal:6};Core.Enums.eVehiculo={NA:0,BCV:1,BCI:2,INT:3,UK:14};Core.Functions=new Object();Array.prototype.remove=function(b){var c,a;if((c=this.indexOf(b))>-1){return([].splice.apply(this,[c,c-c+1].concat(a=[])),a)}};Core.Functions.BetaVersion={load:function(){var a={close:true,accept:false};var b=new Core.Ajax.ServerRequest({secureRequest:true,requestUrl:"auth/sso",requestType:"POST",requestData:{}});b.onSuccess=function(c){if(c&&c.RedirectURI){window.open(c.RedirectURI,"_blank")}};b.request()}};Core.Functions.ChangeEmail={confirmChange:function(c){var a={close:true,accept:false};var b=new Core.Ajax.ServerRequest({secureRequest:false,requestUrl:"datos/confirmar",requestType:"POST",requestData:{nonce:c}});b.onSuccess=function(e){var d=new Core.Controls.Dialog("Cambio de email","<p>El cambio se ha realizado correctamente, ya puede ingresar al sistema.</p>",{displayButtons:a,onClosed:function(){Core.Business.Logout.clearSession();window.location.href=window.location.origin+Core.Functions.Context.getPathname()}});d.show()};b.onError=function(e){var d=new Core.Controls.Dialog("Cambio de email","<p>Link inválido.</p>",{displayButtons:a});d.divModal.on("hidden.bs.modal",function(){Core.Business.Logout.clearSession();window.location.href=window.location.origin+Core.Functions.Context.getPathname()});d.show()};b.request()}};Core.Functions.changePassword={setPasswordsControl:function(a,b){a.on("keyup",function(c){if(a.val()==b.val()){b.closest(".input-group, .form-group").addClass("has-success");b.closest(".input-group, .form-group").removeClass("has-error")}else{b.closest(".input-group, .form-group").removeClass("has-success")}});b.on("keyup",function(c){if(a.val()==b.val()){b.closest(".input-group, .form-group").addClass("has-success");b.closest(".input-group, .form-group").removeClass("has-error")}else{b.closest(".input-group, .form-group").removeClass("has-success")}})},isValidPasswords:function(l,m,d){var f=l.val();var g=m.val();if(!f||!f.length){Core.Functions.Validations.toggleValidation(l,true);return false}if(!g||!g.length){Core.Functions.Validations.toggleValidation(m,true);return false}if(f!=g){Core.Functions.Validations.toggleValidation(l,true);Core.Functions.Validations.toggleValidation(m,true);return false}else{var k=/[A-Z]/;var h=/[a-z]/;var j=/[0-9]/;var c=false;var a=false;var b=false;for(var e=0;e<f.length;e++){if(k.test(f[e])){c=true}if(h.test(f[e])){a=true}if(j.test(f[e])){b=true}}if(f.length<8||!b||!c||!a){Core.Functions.Validations.toggleValidation(l,true);Core.Functions.Validations.toggleValidation(m,true);d.text("La clave debe contener al menos 8 caracteres, 1 letra mayúscula, 1 letra minúscula y 1 número.");d.slideDown();return false}}return true}};Core.Functions.Clipboard={copy:function(b){var a=document.createElement("textarea");a.value=b;a.setAttribute("readonly","");a.style={position:"absolute",left:"-9999px"};document.body.appendChild(a);a.select();document.execCommand("copy");document.body.removeChild(a)}};Core.Functions.Context={Profiles:{getPageOptionsByMenu:function(b,c){if(c.id==b){if(c.opciones){return c.opciones}else{return[]}}else{if(c.menu){for(var a=0;a<c.menu.length;a++){var d=Core.Functions.Context.Profiles.getPageOptionsByMenu(b,c.menu[a]);if(d!=null){return d}}}else{return null}}},existPageInMenu:function(b,c){if(c.id==b){return true}else{if(c.menu){for(var a=0;a<c.menu.length;a++){if(Core.Functions.Context.Profiles.existPageInMenu(b,c.menu[a])){return true}}}}return false},extendParametersByUserLevel:function(a){a.forEach(function(b){Core.Functions.Context.Profiles.setParametersTransaccional(b)});return a},setParametersTransaccional:function(c){var b=Core.Functions.Context.Profiles.searchPage("posicionConsolidada",c);if(b){if(!b.opciones){b.opciones={}}b.opciones.showTenenciaGarantias=(c.opciones.nivelUsuario>=3);b.opciones.showTenenciaCantidad=(c.opciones.nivelUsuario>=3);b.opciones.showTenenciaValorInicial=(c.opciones.nivelUsuario>=3);b.opciones.showTenenciaNoRealizado=(c.opciones.nivelUsuario>=3);b.opciones.showTenenciaPPP=(c.opciones.nivelUsuario>=3);b.opciones.showTenenciaDiasPromedioTenencia=(c.opciones.nivelUsuario>=3);b.opciones.showTenenciaTea=(c.opciones.nivelUsuario>=3);b.opciones.showTenenciaTna=(c.opciones.nivelUsuario>=3);b.opciones.showTenenciaActions=(c.opciones.nivelUsuario>=3);b.opciones.showTenenciaPorcentaje=(c.opciones.nivelUsuario>=3)}var a=Core.Functions.Context.Profiles.searchPage("evolucionDeCartera",c);if(a){if(!a.opciones){a.opciones={}}a.opciones.showEvolucionCartera=(c.opciones.nivelUsuario>=3)}},searchPage:function(b,d){if(d.id==b){return d}else{if(d.menu){for(var a=0;a<d.menu.length;a++){var c=Core.Functions.Context.Profiles.searchPage(b,d.menu[a]);if(c!=null){return c}}}else{return null}}},getPagePathByNamespace:function(c,b){if("Core.Business.AccountSettings"==c){return"/configuracioncuenta"}if("Core.Business.Notificaciones"==c){return"/notificaciones"}if("Core.Business.TestInversorSeleccion"==c){return"/perfilinversor/seleccion"}if("Core.Business.TestInversorResultado"==c){return"/perfilinversor/resultado"}if("Core.Business.TestInversorCuestionario"==c){return"/perfilinversor/cuestionario"}if("Core.Business.Link"==c){return"/link"}if("Core.Business.LinkExterno"==c){return"/linkExterno"}if("Core.Business.Faqs"==c){return"/faqs"}if("Core.Business.EjecutarOrdenPrecargada"==c){return"/ejecutarOrdenPrecargada"}if(b.namespace&&b.namespace==c){return b.path}else{if(b.menu){for(var a=0;a<b.menu.length;a++){var d=Core.Functions.Context.Profiles.getPagePathByNamespace(c,b.menu[a]);if(d!=null){return d}}}else{return null}}},searchPageByPath:function(d,c){if("/configuracioncuenta"==d){return{namespace:"Core.Business.AccountSettings"}}if("/notificaciones"==d){return{namespace:"Core.Business.Notificaciones"}}if("/perfilinversor/seleccion"==d){return{namespace:"Core.Business.TestInversorSeleccion"}}if("/perfilinversor/resultado"==d){return{namespace:"Core.Business.TestInversorResultado"}}if("/perfilinversor/cuestionario"==d){return{namespace:"Core.Business.TestInversorCuestionario"}}if("/link"==d){return{namespace:"Core.Business.Link"}}if("/linkExterno"==d){return{namespace:"Core.Business.LinkExterno"}}if("/faqs"==d){return{namespace:"Core.Business.Faqs"}}if("/ejecutarOrdenPrecargada"==d){return{namespace:"Core.Business.EjecutarOrdenPrecargada"}}if(c.path==d){return c}else{if(c.menu){for(var a=0;a<c.menu.length;a++){var b=Core.Functions.Context.Profiles.searchPageByPath(d,c.menu[a]);if(b!=null){return b}}}else{return null}}}},whiteList:["asesores","tesoreria","backoffice","portfolio","mesa","internacional"],getPathname:function(){if(Core.Objects.Context.Configuration){if(Core.Objects.Context.Configuration.idAplicacion==0){return"/asesores/"}else{if(Core.Objects.Context.Configuration.idAplicacion==1){return"/"}else{if(Core.Objects.Context.Configuration.idAplicacion==2){return"/tesoreria/"}else{if(Core.Objects.Context.Configuration.idAplicacion==3){return"/backoffice/"}else{if(Core.Objects.Context.Configuration.idAplicacion==4){return"/portfolio/"}else{if(Core.Objects.Context.Configuration.idAplicacion==6){return"/mesa/"}else{if(Core.Objects.Context.Configuration.idAplicacion==8){return"/"}else{if(Core.Objects.Context.Configuration.idAplicacion==11){return"/internacional/"}else{if(Core.Objects.Context.Configuration.idAplicacion==12){return"/"}else{if(Core.Objects.Context.Configuration.idAplicacion==14){return"/"}else{return((Core.Functions.Context.whiteList.indexOf(window.location.pathname.replaceAll("/",""))<0)?"/":(window.location.pathname+"/").replaceAll("//","/"))}}}}}}}}}}}else{return((Core.Functions.Context.whiteList.indexOf(window.location.pathname.replaceAll("/",""))<0)?"/":(window.location.pathname+"/").replaceAll("//","/"))}}};Core.Functions.Date={getTwoCharsNumber:function(a){return a.toString().length==1?("0"+a.toString()):a.toString()},getDateAsString:function(a){if(!a){return""}return a.getFullYear().toString()+Core.Functions.Date.getTwoCharsNumber(a.getMonth()+1)+Core.Functions.Date.getTwoCharsNumber(a.getDate())},getDisplayDate:function(a){if(!a){return""}return Core.Functions.Date.getTwoCharsNumber(a.getDate())+"/"+Core.Functions.Date.getTwoCharsNumber(a.getMonth()+1)+"/"+a.getFullYear().toString()},getYearAsString:function(a){if(!a){return""}return a.getFullYear().toString()},getTimeAsString:function(a){if(!a){return""}return a.getHours().toString()+":"+a.getMinutes()+":00"},getElapsedTime:function(c){var a=(new Date()).getTime()-c.getTime();var b={recently:120000,minutes:3600000,hours:86400000,yesterday:172800000,days:604800000,year:31536000000};if(a>0){if(a<b.recently){return"Recién"}else{if(a<b.minutes){return("Hace {value} minutos").replace("{value}",Math.floor((a/1000)/60))}else{if(a<b.hours){return("Hace {value} horas").replace("{value}",Math.floor(((a/1000)/60)/60))}else{if(a<b.yesterday){return"Ayer"}else{if(a<b.days){return("Hace {value} días").replace("{value}",Math.floor((((a/1000)/60)/60)/24))}else{if(a<b.year){return("El {value}").replace("{value}",$.format.date(c,"dd/MM"))}else{return("El {value}").replace("{value}",$.format.date(c,"dd/MM/yyyy"))}}}}}}}else{a=Math.abs(a);if(a<b.recently){return"Recién"}else{if(a<b.minutes){return("Faltan {value} minutos").replace("{value}",Math.floor((a/1000)/60))}else{if(a<b.hours){return("Faltan {value} horas").replace("{value}",Math.floor(((a/1000)/60)/60))}else{if(a<b.yesterday){return"Mañana"}else{if(a<b.days){return("Faltan {value} días").replace("{value}",Math.floor((((a/1000)/60)/60)/24))}else{if(a<b.year){return("El {value}").replace("{value}",$.format.date(c,"dd/MM"))}else{return("El {value}").replace("{value}",$.format.date(c,"dd/MM/yyyy"))}}}}}}}},getDisplayDateWithSeparator:function(a,b){if(!a){return""}return a.getFullYear().toString()+b+Core.Functions.Date.getTwoCharsNumber(a.getMonth()+1)+b+Core.Functions.Date.getTwoCharsNumber(a.getDate())},getDateByString:function(a){if(!a){return new Date()}return Core.Functions.Date.getDate(a.substr(0,4),a.substr(5,2),a.substr(8,2))},getDateByStringWithoutSeparator:function(a){if(!a){return new Date()}return Core.Functions.Date.getDate(a.substr(0,4),a.substr(4,2),a.substr(6,2))},getDateByStringDisplayDate:function(a){if(!a){return new Date()}return Core.Functions.Date.getDate(a.substr(6,4),a.substr(3,2),a.substr(0,2))},getDate:function(d,b,a){var c=new Date();c.setDate(1);c.setYear(d);c.setMonth(b-1);c.setDate(a);return c}};Core.Functions.Decimal={parseFloat:function(d){if(d==null){return 0}else{if(typeof(d)=="undefined"){throw"Can't parse undefined as float number."}else{if(typeof(d)=="function"){throw"Can't parse a function as float number."}else{if(typeof(d)=="object"){throw"Can't parse an object as float number."}else{if(typeof(d)=="number"){return d}else{var b=".";var a=",";d=d.toString();if(d.startsWith("-")){var c=1;d=[d.slice(0,c),"0",d.slice(c)].join("")}else{d="0"+d}d=d.toString().trim();d=d.replaceAll(/[^0-9\.,-]+/g,"");d=d.split("").reverse().join("");if(d.indexOf(b)>-1&&d.indexOf(a)>-1){if(d.indexOf(b)<d.indexOf(a)){d=d.replace(b,"[decimal-separator]")}else{d=d.replace(a,"[decimal-separator]")}}else{if(d.indexOf(b)>-1){d=d.replace(b,"[decimal-separator]")}else{if(d.indexOf(a)>-1){d=d.replace(a,"[decimal-separator]")}}}d=d.replaceAll(/\./,"");d=d.replaceAll(/\,/,"");d=d.replace("[decimal-separator]",Core.Functions.Decimal.getSystemDecimalSeparator());d=d.split("").reverse().join("");d=parseFloat(d);return d}}}}}},localizeFloat:function(e,c,d){if(typeof(e)!="number"){throw"Value isn't a number."}else{e=e.toString();e=e.replace(Core.Functions.Decimal.getSystemDecimalSeparator(),".");var f=e.split(".");var b=f.length>0?f[0]:"";var a=f.length>1?f[1]:"00";if(a.length==1){a+="0"}if(a.length>c){a=a.substring(0,c)}if(d){b=b.replace(/\B(?=(\d{3})+(?!\d))/g,",")}e=b+(a!=""?"."+a:"");return e}},getSystemDecimalSeparator:function(){var a=1.1;a=a.toString().substring(1,2);return a},isDecimalSeparatorValid:function(a){return(a==Core.eKeyCode.Dot||a==Core.eKeyCode.Keypad_Dot)}};Core.Functions.DynamicFilter={setFilter:function(d,a,b,c){if(d.attr("activo")=="true"){d.css("background-color",b);d.attr("activo","false");c[d.attr("valor")]=false}else{d.css("background-color",a);d.attr("activo","true");c[d.attr("valor")]=true}},getActiveFilters:function(b){var a=[];$.each(b,function(d,c){if(c){a.push(d)}});return a}};Core.eKeyCode=new function(){this.Backspace=8;this.Tab=9;this.Enter=13;this.Shift=16;this.Ctrl=17;this.Alt=18;this.Break=19;this.CapsLock=20;this.Scape=27;this.PageUp=33;this.PageDown=34;this.End=35;this.Home=36;this.Left=37;this.Up=38;this.Right=39;this.Down=40;this.Insert=45;this.Delete=46;this.Key_0=48;this.Key_1=49;this.Key_2=50;this.Key_3=51;this.Key_4=52;this.Key_5=53;this.Key_6=54;this.Key_7=55;this.Key_8=56;this.Key_9=57;this.Key_A=65;this.Key_B=66;this.Key_C=67;this.Key_D=68;this.Key_E=69;this.Key_F=70;this.Key_G=71;this.Key_H=72;this.Key_I=73;this.Key_J=74;this.Key_K=75;this.Key_L=76;this.Key_M=77;this.Key_N=78;this.Key_O=79;this.Key_P=80;this.Key_Q=81;this.Key_R=82;this.Key_S=83;this.Key_T=84;this.Key_U=85;this.Key_V=86;this.Key_W=87;this.Key_X=88;this.Key_Y=89;this.Key_Z=90;this.Keypad_0=96;this.Keypad_1=97;this.Keypad_2=98;this.Keypad_3=99;this.Keypad_4=100;this.Keypad_5=101;this.Keypad_6=102;this.Keypad_7=103;this.Keypad_8=104;this.Keypad_9=105;this.Keypad_Multiply=106;this.Keypad_Add=107;this.Keypad_Subtract=109;this.Keypad_Dot=110;this.Keypad_Divide=111;this.Key_F1=112;this.Key_F2=113;this.Key_F3=114;this.Key_F4=115;this.Key_F5=116;this.Key_F6=117;this.Key_F7=118;this.Key_F8=119;this.Key_F9=120;this.Key_F10=121;this.Key_F11=122;this.Key_F12=123;this.NumLock=144;this.ScrollLock=145;this.SemiColon=186;this.Equal=187;this.Comma=188;this.Dash=189;this.Dot=190;this.ForwardSlash=191;this.OpenBracket=219;this.BackSlash=220;this.CloseBracket=221;this.SingleQuote=222};Core.Functions.ExternalServices={Icar:{showReport:function(c,a,e,b){var d=new Core.Ajax.ServerRequest({overlayElement:c,secureRequest:true,requestUrl:"reporte/icar",requestType:"GET",requestData:{idAperturaCuenta:a,tipo:e,numero:b}});d.onSuccess=function(g){var h="No se han encontrado datos.";if(g.datos.length==1||g.imagenes.length==1){var h="<table class='table table-striped'>";h+="<thead><tr><th>Dato</th><th>Valor</th></tr></thead>";h+="<tbody>";if(g.datos.length==1){for(var f in g.datos[0]){h+="<tr>";h+="<td>"+f+"</td>";h+="<td>"+(g.datos[0][f]).toString().replaceAll("<","&lt;").replaceAll(">","&gt;")+"</td>";h+="</tr>"}}if(g.imagenes.length==1){for(var f in g.imagenes[0]){h+="<tr>";h+="<td>"+f+"</td>";h+="<td><a target= '_blank' href='"+g.imagenes[0][f]+"'><img style='width:50px; height:50px;' src='"+g.imagenes[0][f]+"'</img></a></td>";h+="</tr>"}}h+="</tbody></table>"}var i=new Core.Controls.Dialog("ICAR",h,{displayButtons:{close:true,accept:false}});i.divModal.find(".modal-content").css("width","1100");i.show()};d.request()}},Reuters:{showReport:function(e,a,d,f,b,c){var g=new Core.Ajax.ServerRequest({overlayElement:e,secureRequest:true,requestUrl:"reporte/historico/reuters?documento="+a+" &nombreCompleto="+d+"&sexo="+f+"&fechaNacimiento="+b+"&nacionalidad="+c,requestType:"GET"});g.onSuccess=function(h){Core.Functions.ExternalServices.VerHistorico("Reuters",h,{documento:a,nombreCompleto:d,sexo:f,fechaNacimiento:b,nacionalidad:c},true,function(i){Core.Functions.ExternalServices.Reuters.showReportByKey(e,i)})};g.request()},showReportByKey:function(a,b){var d="";$.each(b,function(e,f){d+=((d?"&":"")+(e+"="+f))});var c=new Core.Ajax.ServerRequest({overlayElement:a,secureRequest:true,requestUrl:"reporte/reuters?"+d,requestType:"GET"});c.onSuccess=function(e){var j="Thomson Reuters";var f="";if(e.consulta&&e.consulta.length>0){j+="<span class='right' style='margin-right: 10px;'>Fecha de Solicitud: <strong>"+e.consulta[0].FechaSolicitud+"</strong></span>";f+="<div style='border-bottom: 1px solid lightgray; margin-bottom: 10px;'>Nombre: <strong>"+e.consulta[0].Nombre+"</strong>, Género: <strong>"+e.consulta[0].Sexo+"</strong>, Fecha de Nacimiento: <strong>"+e.consulta[0].FechaNacimiento+"</strong>, Nacionalidad: <strong>"+e.consulta[0].Nacionalidad+"</strong></div>"}if(e.datos.length>0){f+="<table class='table table-striped'>";f+="<thead><tr><th>Nombre</th><th>Alias Coincidente</th><th>Género</th><th>Fecha de Nacimiento</th><th>Nacionalidad</th><th>Residencia</th><th>Tipo</th><th>Categoría</th><th>Solidez de la Coincidencia</th></tr></thead>";f+="<tbody>";for(var h=0;h<e.datos.length;h++){f+="<tr>";f+="<td>"+e.datos[h].NombreConcidencia+"</td>";f+="<td>"+e.datos[h].AliasConcidencia+"</td>";f+="<td>"+e.datos[h].Genero+"</td>";f+="<td>"+e.datos[h].FechaNacimiento+"</td>";f+="<td>"+e.datos[h].Nacionalidad+"</td>";f+="<td>"+e.datos[h].Residencia+"</td>";f+="<td>"+e.datos[h].Tipo+"</td>";f+="<td>"+e.datos[h].Categoria+"</td>";f+="<td>"+e.datos[h].SolidezConcidencia+"</td>";f+="</tr>"}f+="</tbody></table>"}else{f+="No se encontraron coincidencias."}f+="<br /><label>Powered by Thomson Reuters World-Check One</label>";var g=new Core.Controls.Dialog(j,f,{displayButtons:{close:true,accept:false}});g.divModal.find(".modal-content").css("width","1100");g.show()};c.request()}},Nosis:{showReport:function(b,a){var c=new Core.Ajax.ServerRequest({overlayElement:b,secureRequest:true,requestUrl:"reporte/historico/nosis",requestType:"GET",requestData:{cuitcuil:a}});c.onSuccess=function(d){Core.Functions.ExternalServices.VerHistorico("Nosis",d,{cuitcuil:a},true,function(e){Core.Functions.ExternalServices.Nosis.showReportByKey(b,e)})};c.request()},showReportByKey:function(a,b){var c=new Core.Ajax.ServerRequest({overlayElement:a,contentType:"text/plain",secureRequest:true,requestUrl:"reporte/nosis",requestType:"GET",requestData:b});c.onSuccess=function(d){var e=new Core.Controls.Dialog("Nosis",Core.Functions.HTML.htmlDecode(d),{displayButtons:{close:true,accept:false}});e.divModal.find(".modal-content").css("width","1100");e.show()};c.request()}},Renaper:{showReport:function(c,a,b,d){var e=new Core.Ajax.ServerRequest({overlayElement:c,secureRequest:true,requestUrl:"reporte/historico/renaper",requestType:"GET",requestData:{documento:a,idTipoDocumento:b,sexo:d}});e.onSuccess=function(f){Core.Functions.ExternalServices.VerHistorico("Renaper",f,{documento:a,idTipoDocumento:b,sexo:d},true,function(g){Core.Functions.ExternalServices.Renaper.showReportByKey(c,g)})};e.request()},showReportByKey:function(a,b){var c=new Core.Ajax.ServerRequest({overlayElement:a,secureRequest:true,requestUrl:"reporte/renaper",requestType:"GET",requestData:b});c.onSuccess=function(e){var f="No se han encontrado datos.";if(e.datos.length==1){var f="<table class='table table-striped'>";f+="<thead><tr><th>Dato</th><th>Valor</th></tr></thead>";f+="<tbody>";for(var d in e.datos[0]){f+="<tr>";f+="<td>"+d+"</td>";f+="<td>"+e.datos[0][d]+"</td>";f+="</tr>"}f+="</tbody></table>"}var g=new Core.Controls.Dialog("Renaper",f,{displayButtons:{close:true,accept:false}});g.show()};c.request()}},MotorDecision:{showReport:function(b,a){var c=new Core.Ajax.ServerRequest({overlayElement:b,secureRequest:true,requestUrl:"apertura/cuenta/resultadomotor/"+a,requestType:"GET"});c.onSuccess=function(d){var e="";if(d.datos.length>0){e+="<table class='table table-striped'>";e+="<thead><tr><th style='width: 15px;'></th><th>Concepto evaluado</th><th>Acción</th></tr></thead>";e+="<tbody>";for(var g=0;g<d.datos.length;g++){e+="<tr style='background-color:"+((g%2==0)?"#e8f7ff":"")+"'>";e+="<td style='background-color:"+d.datos[g].Color+"'>";e+="<td>"+d.datos[g].Item+"</td>";e+="<td>"+d.datos[g].Accion+"</td>";e+="</tr>"}e+="</tbody></table>"}else{e+="No se encontraron datos."}var f=new Core.Controls.Dialog("Motor decisión - Apertura: "+a,e,{displayButtons:{close:true,accept:false}});f.show()};c.request()}},UIF:{showReport:function(b,a){var c=new Core.Ajax.ServerRequest({overlayElement:b,secureRequest:true,requestUrl:"reporte/historico/uif",requestType:"GET",requestData:{cuitcuil:a}});c.onSuccess=function(d){Core.Functions.ExternalServices.VerHistorico("UIF",d,{cuitcuil:a},true,function(e){Core.Functions.ExternalServices.UIF.showReportByKey(b,e)})};c.request()},showReportByKey:function(a,b){var c=new Core.Ajax.ServerRequest({overlayElement:a,secureRequest:true,requestUrl:"reporte/uif",requestType:"GET",requestData:b});c.onSuccess=function(e){var f="No se han encontrado datos.";if(e.datos.length==1){var f="<table class='table table-striped'>";f+="<thead><tr><th>Dato</th><th>Valor</th></tr></thead>";f+="<tbody>";for(var d in e.datos[0]){f+="<tr>";f+="<td>"+d+"</td>";f+="<td>"+e.datos[0][d]+"</td>";f+="</tr>"}f+="</tbody></table>"}var g=new Core.Controls.Dialog("UIF",f,{displayButtons:{close:true,accept:false}});g.show()};c.request()}},DocuSign:{showReport:function(b,a){var c=new Core.Ajax.ServerRequest({overlayElement:b,secureRequest:true,requestUrl:"reporte/historico/docusign",requestType:"GET",requestData:{idAperturaCuenta:a}});c.onSuccess=function(d){Core.Functions.ExternalServices.VerHistorico("DocuSign",d,{},false,function(e){Core.Functions.ExternalServices.DocuSign.showReportByKey(b,e)})};c.request()},showReportByKey:function(a,b){var c=new Core.Ajax.ServerRequest({overlayElement:a,secureRequest:true,requestUrl:"reporte/docusign",requestType:"GET",requestData:b});c.onSuccess=function(e){var f="";if(e.envelope.length==1){f+="<table class='table table-striped'>";f+="<thead><tr><th>Dato</th><th>Valor</th></tr></thead>";f+="<tbody>";for(var d in e.envelope[0]){f+="<tr>";f+="<td>"+d+"</td>";f+="<td>"+e.envelope[0][d]+"</td>";f+="</tr>"}f+="</tbody></table>"}else{f+="No se han encontrado datos."}if(e.firmantes.length>0){f+="<table class='table table-striped'>";f+="<thead><tr><th>Email</th><th>Estado</th><th>Fecha</th></tr></thead>";f+="<tbody>";e.firmantes.forEach(function(h,g){f+="<tr>";f+="<td>"+h.Email+"</td>";f+="<td>"+h.Estado+"</td>";f+="<td>"+h.Fecha+"</td>";f+="</tr>"});f+="</tbody></table>"}else{f+="No se han encontrado firmantes."}if(e.archivos.length>0){f+="<table class='table table-striped'>";f+="<thead><tr><th>Fecha</th><th>Tipo</th><th>Comentario</th></tr></thead>";f+="<tbody>";e.archivos.forEach(function(h,g){f+="<tr>";f+="<td>"+h.Fecha+"</td>";f+="<td>"+h.Tipo+"</td>";f+="<td><a target= '_blank' href='"+h.urlArchivo+"'>"+h.Comentario+"</a></td>";f+="</tr>"});f+="</tbody></table>"}else{f+="No se han encontrado archivos."}new Core.Controls.Dialog("DocuSign",f,{displayButtons:{close:true,accept:false}}).show()};c.request()}},VerHistorico:function(f,a,d,e,c){var b=$('<div class="modal fade" tabindex="-1" role="dialog"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="title-external-service-historico"></h4></div><a style="margin-bottom:10px;" data-toggle="modal" class="btn btn-primary btn-nueva-consulta">Nueva consulta</a><div class="div-external-service-historico"></div></div></div></div>').appendTo(document.body);b.on("hidden.bs.modal",function(){b.remove();if(d.ejecutar||d.clave){c(d)}});b.find(".title-external-service-historico").html(f);b.find(".div-external-service-historico").shieldGrid({dataSource:{data:a.datos},selection:false,rowHover:false,paging:{pageSize:10,pageLinksCount:10},columns:[{field:"Version",title:"Versión",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString},{width:100,field:"",title:" ",headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(h,i,j){var g=$('<button type="button" title="Ver" class="btn-sm balanz-button"><span class="glyphicon glyphicon-list-alt"></span></button>').appendTo(h);g.on("click",function(){d.clave=i.clave;b.modal("hide")})}}]});b.find(".btn-nueva-consulta").hide();if(e){b.find(".btn-nueva-consulta").show();b.find(".btn-nueva-consulta").on("click",function(){d.ejecutar=1;b.modal("hide")})}b.modal({show:true})}};Core.Functions.File={download:function(c,e,a){var b=new Core.Controls.Overlay(c,{});var d=new XMLHttpRequest();d.open("GET",e,true);d.responseType="blob";d.setRequestHeader("Authorization",Core.Objects.Context.Token);d.onload=function(f){if(d.status==200){Core.Functions.File.showFile(d)}else{var g=new FileReader();g.onloadend=function(i){var h=((i&&i.srcElement&&i.srcElement.result)?JSON.parse(i.srcElement.result):{});var j=new Core.Controls.Dialog("Mensaje",((h&&h.Descripcion)?h.Descripcion:"No se ha podido realizar la descarga del archivo."),{displayButtons:{close:true,accept:false}});j.show()};g.readAsText(d.response)}b.destroy();if(a){a()}};d.send()},downloadWithData:function(c,g,f,e,a){var b=new Core.Controls.Overlay(c,{});var d=new XMLHttpRequest();d.open("POST",g,true);d.responseType="blob";d.setRequestHeader("Authorization",Core.Objects.Context.Token);$.each(f,function(h,i){d.setRequestHeader(h,i)});d.onload=function(h){if(d.status==200){Core.Functions.File.showFile(d)}else{var i=new FileReader();i.onloadend=function(k){var j=((k&&k.srcElement&&k.srcElement.result)?JSON.parse(k.srcElement.result):{});var l=new Core.Controls.Dialog("Mensaje",((j&&j.Descripcion)?j.Descripcion:"No se ha podido realizar la descarga del archivo."),{displayButtons:{close:true,accept:false}});l.show()};i.readAsText(d.response)}b.destroy();if(a){a()}};d.send(JSON.stringify(e))},showFile:function(g){var f=new Blob([g.response],{type:g.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(f);return}var a=window.URL.createObjectURL(f);var e=document.createElement("a");e.href=a;var c=g.getResponseHeader("Content-Disposition").split("; ");var b="filename=file.txt";for(var d=0;d<c.length;d++){if(c[d].indexOf("filename")>=0){b=c[d]}}e.download=b.split("=")[1];e.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(a)}};Core.Functions.ePlazo={CI:0,D24:1,D72:3};Core.Functions.eMoneda={Pesos:1,Dolares:2};Core.Functions.grid={formatIntegerNumber:function(a){return Core.Functions.grid.formatNumber(parseInt(a)).split(".")[0]},formatIntegerNumberWithColor:function(c){var b=Core.Functions.grid.formatNumber(parseInt(c)).split(".")[0];var a=b.substr(0,1);if(a=="-"){return"<span class='red'>"+b+"</span>"}return"<span>"+b+"</span>"},formatNumber:function(b){b+="";var c=b.split(".");var d=c[0];var e=(c.length>1?c[1]:"")+"00";var a=/(\d+)(\d{3})/;while(a.test(d)){d=d.replace(a,"$1,$2")}return d+"."+e.substr(0,2)},formatDecimal:function(b){if(!b){b=0}b+="";var c=b.split(".");var d=c[0];var e=(c.length>1?c[1]:"");if(e){e+=(e.length>1?"":((e.length==0)?"00":"0"))}var a=/(\d+)(\d{3})/;while(a.test(d)){d=d.replace(a,"$1,$2")}return d+(e?("."+e.substr(0,(e.length>2?e.length:2))):"")},formatUndefinedNumberWithColor:function(a){return(a==null)?" ":Core.Functions.grid.formatNumberWithColor(a)},formatNumberWithColor:function(c){c+="";var d=c.split(".");var e=d[0];var f=(d.length>1?d[1]:"")+"00";var a=/(\d+)(\d{3})/;while(a.test(e)){e=e.replace(a,"$1,$2")}var c=e+"."+f.substr(0,2);var b=c.substr(0,1);if(b=="-"){return"<span class='red'>"+c+"</span>"}return"<span>"+c+"</span>"},formatNumberTotalWithColor:function(c){c+="";var d=c.split(".");var e=d[0];var f=(d.length>1?d[1]:"")+"00";var a=/(\d+)(\d{3})/;while(a.test(e)){e=e.replace(a,"$1,$2")}var c=e+"."+f.substr(0,2);var b=c.substr(0,1);if(b=="-"){return"<span style='font-size:14px;' class='red'>"+c+"</span>"}return"<span style='font-size:14px;'>"+c+"</span>"},formatNumberWithColorRed:function(c){c+="";var d=c.split(".");var e=d[0];var f=(d.length>1?d[1]:"")+"00";var a=/(\d+)(\d{3})/;while(a.test(e)){e=e.replace(a,"$1,$2")}var c=e+"."+f.substr(0,2);var b=c.substr(0,1);return"<span class='red'>"+c+"</span>"},formatNuleableNumber:function(a){return a=="-1"?"-":Core.Functions.grid.formatNumber(a)},formatBoolean:function(a){if(a==1){return"Si"}else{return"No"}},formatStringBoolean:function(a){if(a==""){return""}else{if(a==1){return"Si"}else{return"No"}}},formatUndefinedNumber:function(a){return !a?" ":Core.Functions.grid.formatNumber(a)},formatNullNumber:function(a){return(a==null)?" ":Core.Functions.grid.formatNumber(a)},formatUndefinedIntegerNumber:function(a){return !a?" ":Core.Functions.grid.formatIntegerNumber(a)},formatNuleableIntegerNumber:function(a){return(!a||a=="-1")?"-":Core.Functions.grid.formatIntegerNumber(a)},formatPrice:function(b){if(!b||b==-1){return""}b+="";var c=b.split(".");var d=c[0];var e=(c.length>1?c[1]:"");e+=(e.length>1?"":((e.length==0)?"00":"0"));var a=/(\d+)(\d{3})/;while(a.test(d)){d=d.replace(a,"$1,$2")}return d+"."+e.substr(0,(e.length>2?e.length:2))},formatNumberWithDecimals:function(b){if(!b){b=0}b+="";var c=b.split(".");var d=c[0];var e=(c.length>1?c[1]:"");e+=(e.length>1?"":((e.length==0)?"00":"0"));var a=/(\d+)(\d{3})/;while(a.test(d)){d=d.replace(a,"$1,$2")}return d+"."+e.substr(0,(e.length>2?e.length:2))},formatPriceWithColor:function(c){var b=Core.Functions.grid.formatPrice(c);var a=b.substr(0,1);if(a=="-"){return"<span class='red'>"+b+"</span>"}return"<span>"+b+"</span>"},formatNuleablePrice:function(a){if(a==null){return""}if(a==""){return""}return Core.Functions.grid.formatPrice(a)},formatColorByFirstDigit:function(b){var a=b.substr(0,1);if(a=="+"){return"<span class='green'>"+b+"</span>"}if(a=="-"){return"<span class='red'>"+b+"</span>"}return b},formatColorBySign:function(a){if(a>0){return"<span class='green'>"+a+"</span>"}if(a<0){return"<span class='red'>"+a+"</span>"}return a},formatPercentage:function(a){if(a==-1){return"-"}if(a>0){return"<span class='green'>"+a+"%</span>"}if(a<0){return"<span class='red'>"+a+"%</span>"}return a},formatColorBySignTwoDecimal:function(a){if(a>0){return"<span class='green'>"+a.toFixed(2)+"</span>"}if(a<0){return"<span class='red'>"+a.toFixed(2)+"</span>"}return a.toFixed(2)},formatPercentageTwoDecimal:function(a){if(a>0){return"<span class='green'>"+a.toFixed(2)+"%</span>"}if(a<0){return"<span class='red'>"+a.toFixed(2)+"%</span>"}return a.toFixed(2)},getCellEvenClass:function(){return{"class":"blzGrid-column-header-even"}},getCellOddClass:function(){return{"class":"blzGrid-column-header-odd"}},getDolarCellEvenClass:function(){return{"class":"blzGridDolar-column-header-even"}},getDolarCellOddClass:function(){return{"class":"blzGridDolar-column-header-odd"}},getLeftAlignedColumnClass:function(){return{style:"text-align: left; padding-left: 5px;"}},getRightAlignedColumnClass:function(){return{style:"text-align: right; padding-right: 5px;"}},getGreyOpacityAlignedColumnClass:function(a){return{style:"background-color: rgba(213,223,236, "+a+");"}},getHeaderAttribute:function(a,b){if((a%2)==0){if(b&&b==Core.Functions.eMoneda.Dolares){return Core.Functions.grid.getDolarCellEvenClass()}else{return Core.Functions.grid.getCellEvenClass()}}else{if(b&&b==Core.Functions.eMoneda.Dolares){return Core.Functions.grid.getDolarCellOddClass()}else{return Core.Functions.grid.getCellOddClass()}}},formatUndefinedString:function(a){if(!a){return""}return a},formatDate:function(a){if(!a){return""}return Core.Functions.Date.getTwoCharsNumber(a.getDate())+"/"+Core.Functions.Date.getTwoCharsNumber(a.getMonth()+1)+"/"+a.getFullYear().toString()},formatStringDate:function(a){if(!a){return""}return a.substr(8,2)+"/"+a.substr(5,2)+"/"+a.substr(0,4)},formatStringDateWithTime:function(a){if(!a){return""}return a.substr(8,2)+"/"+a.substr(5,2)+"/"+a.substr(0,4)+" "+a.substr(11,5)},formatStringDateTime:function(a){if(!a){return""}return a.substr(11,5)},hexToRgb:function(c){c=c.replace("#","");var e=parseInt(c.substring(0,2),16);var d=parseInt(c.substring(2,4),16);var a=parseInt(c.substring(4,6),16);var f=e+","+d+","+a;return f},grepOne:function(a,b){for(var c=0;c<a.length;c++){if(b(a[c])){return a[c]}}return null},Cotizaciones:{REFRESH_TIME:5000,details:[],initGrid:function(d,b,a,c,i,h,l,m,g,e,f){var k=(m&&!Core.Functions.isMobile&&!Core.Functions.isTablet)?1:0;if(!Core.Objects.Context.Watchlists){var n=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"watchlists",requestType:"GET"});n.onSuccess=function(o){Core.Objects.Context.Watchlists=o.watchlists;if(!Core.Functions.Validations.isBlockedStorage()&&Core.Functions.Persistence.getStorage()){Core.Functions.Persistence.getStorage().setItem("CoreContext",LZString.compressToUTF16(JSON.stringify(Core.Objects.Context)))}};n.request()}var j=window.setInterval(function(){if(Core.Objects.Context.Watchlists){window.clearInterval(j);var p=[];p.push({field:"ticker",title:"Ticker",width:"10%",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(p.length),columnTemplate:function(t,v,u){t.text(v.ticker);var w=(g!=null)?g:v.panel;if(w==Core.Enums.ePanel.AccionesMerval||w==Core.Enums.ePanel.AccionesBurcap||w==Core.Enums.ePanel.AccionesMercadoArgentino||w==Core.Enums.ePanel.Acciones||w==Core.Enums.ePanel.AccionesMerval25||w==Core.Enums.ePanel.Bonos||w==Core.Enums.ePanel.Cedears||w==Core.Enums.ePanel.Cauciones||w==Core.Enums.ePanel.Opciones||w==Core.Enums.ePanel.Lebacs||w==Core.Enums.ePanel.Letes||w==Core.Enums.ePanel.ONs||w==Core.Enums.ePanel.Futuros||w==Core.Enums.ePanel.FuturosByma||w==Core.Enums.ePanel.FuturosMatba||w==Core.Enums.ePanel.BonosSoberanos||w==Core.Enums.ePanel.BonosSubsoberanos||w==Core.Enums.ePanel.LetrasLetes||w==Core.Enums.ePanel.LetrasLecaps||w==Core.Enums.ePanel.LetrasLecers||w==Core.Enums.ePanel.LetrasLelinks||w==Core.Enums.ePanel.CorporativosObligacionesNegociables||w==Core.Enums.ePanel.ETF||w==Core.Enums.ePanel.NYSE||w==Core.Enums.ePanel.NASDAQ||w==Core.Enums.ePanel.BCIETF||w==Core.Enums.ePanel.BCINYSE||w==Core.Enums.ePanel.BCINASDAQ||w==Core.Enums.ePanel.CorporativosValoresCortoPlazo||w==Core.Enums.ePanel.DolarBolsa){t.html("<a>"+v.ticker+"</a>");t.addClass("link-cell");t.on("click",function(){Core.Business.DetalleInstrumento.init(e,f,{ticker:v.ticker,idPlazo:Core.Functions.Plazo.getIDByDescription(v.plazo)})})}if(v.descripcion!=null){t[0].title=v.descripcion}}});if(g!=Core.Enums.ePanel.Monedas){p.push({field:"plazo",title:"Plazo",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(p.length)})}else{p.push({field:"descripcion",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),width:"25%",headerAttributes:Core.Functions.grid.getHeaderAttribute(p.length)})}if(!Core.Functions.isMobile&&!Core.Functions.isTablet){if(g!=Core.Enums.ePanel.Monedas){p.push({field:"cc",title:"Cant. Compra",width:"10%",attributes:Core.Functions.grid.getGreyOpacityAlignedColumnClass(0.5),headerAttributes:Core.Functions.grid.getHeaderAttribute(p.length),format:Core.Functions.grid.formatNuleableIntegerNumber,columnTemplate:function(t,u,v){t.addClass("link-cell");t.text(Core.Functions.grid.formatNuleableIntegerNumber(u.cc));t.on("click",function(){var w=$.grep(d.swidget().dataSource.data,function(B,A){return B.ticker==u.ticker&&B.plazo==u.plazo})[0];var y=(g!=null)?g:w.panel;var x={};var z=Core.Enums.eEspeciesTipoOperacion.Venta;if(g==Core.Enums.ePanel.DolarBolsa){z=Core.Enums.eEspeciesTipoOperacion.VentaDolarBolsa;x.defaultPrecioCompra=w.pc;x.defaultPrecioVenta=w.pv}else{if(g==Core.Enums.ePanel.Cauciones){z=Core.Enums.eEspeciesTipoOperacion.CaucionColocadora}}x.defaultTipoOperacion=z;x.defaultEspecie=(y==Core.Enums.ePanel.Cauciones)?w.SecurityID:w.ticker;x.defaultValorLimite=w.pc;x.defaultValorCantidad=w.cc;x.defaultPlazo=Core.Functions.Plazo.getIDByDescription(w.plazo);o(y,x,e,f)})}})}p.push({field:"pc",title:"Compra",width:"5%",attributes:Core.Functions.grid.getGreyOpacityAlignedColumnClass(0.9),headerAttributes:Core.Functions.grid.getHeaderAttribute(p.length),format:Core.Functions.grid.formatPrice,columnTemplate:function(t,u,v){t.addClass("link-cell");t.text(Core.Functions.grid.formatPrice(u.pc));t.on("click",function(){var w=$.grep(d.swidget().dataSource.data,function(B,A){return B.ticker==u.ticker&&B.plazo==u.plazo})[0];var y=(g!=null)?g:w.panel;var x={};var z=Core.Enums.eEspeciesTipoOperacion.Venta;if(g==Core.Enums.ePanel.DolarBolsa){z=Core.Enums.eEspeciesTipoOperacion.VentaDolarBolsa;x.defaultPrecioCompra=w.pc;x.defaultPrecioVenta=w.pv}else{if(g==Core.Enums.ePanel.Cauciones){z=Core.Enums.eEspeciesTipoOperacion.CaucionColocadora}}x.defaultTipoOperacion=z;x.defaultEspecie=(y==Core.Enums.ePanel.Cauciones)?w.SecurityID:w.ticker;x.defaultValorLimite=w.pc;x.defaultPlazo=Core.Functions.Plazo.getIDByDescription(w.plazo);o(y,x,e,f)})}});p.push({field:"pv",title:"Venta",width:"5%",attributes:Core.Functions.grid.getGreyOpacityAlignedColumnClass(0.9),headerAttributes:Core.Functions.grid.getHeaderAttribute(p.length),format:Core.Functions.grid.formatPrice,columnTemplate:function(t,u,v){t.addClass("link-cell");t.text(Core.Functions.grid.formatPrice(u.pv));t.on("click",function(){var w=$.grep(d.swidget().dataSource.data,function(B,A){return B.ticker==u.ticker&&B.plazo==u.plazo})[0];var y=(g!=null)?g:w.panel;var x={};var z=Core.Enums.eEspeciesTipoOperacion.Compra;if(g==Core.Enums.ePanel.DolarBolsa){z=Core.Enums.eEspeciesTipoOperacion.CompraDolarBolsa;x.defaultPrecioCompra=w.pc;x.defaultPrecioVenta=w.pv}else{if(g==Core.Enums.ePanel.Cauciones){z=Core.Enums.eEspeciesTipoOperacion.CaucionTomadora}}x.defaultTipoOperacion=z;x.defaultEspecie=(y==Core.Enums.ePanel.Cauciones)?w.SecurityID:w.ticker;x.defaultValorLimite=w.pv;x.defaultPlazo=Core.Functions.Plazo.getIDByDescription(w.plazo);o(y,x,e,f)})}});if(g!=Core.Enums.ePanel.Monedas){p.push({field:"cv",title:"Cant. Venta",width:"10%",attributes:Core.Functions.grid.getGreyOpacityAlignedColumnClass(0.5),headerAttributes:Core.Functions.grid.getHeaderAttribute(p.length),format:Core.Functions.grid.formatNuleableIntegerNumber,columnTemplate:function(t,u,v){t.addClass("link-cell");t.text(Core.Functions.grid.formatNuleableIntegerNumber(u.cv));t.on("click",function(){var w=$.grep(d.swidget().dataSource.data,function(B,A){return B.ticker==u.ticker&&B.plazo==u.plazo})[0];var y=(g!=null)?g:w.panel;var x={};var z=Core.Enums.eEspeciesTipoOperacion.Compra;if(g==Core.Enums.ePanel.DolarBolsa){z=Core.Enums.eEspeciesTipoOperacion.CompraDolarBolsa;x.defaultPrecioCompra=w.pc;x.defaultPrecioVenta=w.pv}else{if(g==Core.Enums.ePanel.Cauciones){z=Core.Enums.eEspeciesTipoOperacion.CaucionTomadora}}x.defaultTipoOperacion=z;x.defaultEspecie=(y==Core.Enums.ePanel.Cauciones)?w.SecurityID:w.ticker;x.defaultValorLimite=w.pv;x.defaultValorCantidad=w.cv;x.defaultPlazo=Core.Functions.Plazo.getIDByDescription(w.plazo);o(y,x,e,f)})}})}}function o(w,x,u,v){var t=$.grep(Core.Objects.Accounts?Core.Objects.Accounts:[],function(z,y){return z.idCuenta==u})[0];if(!t||t.NumComitente==""){return}if(w==Core.Enums.ePanel.Acciones&&Core.Functions.Context.Profiles.existPageInMenu("acciones",Core.Objects.Context.Profiles[v])){Core.Business.Operar.Acciones.init(u,v,x)}else{if(w==Core.Enums.ePanel.Opciones&&Core.Functions.Context.Profiles.existPageInMenu("opciones",Core.Objects.Context.Profiles[v])){Core.Business.Operar.Opciones.init(u,v,x)}else{if((w==Core.Enums.ePanel.Bonos||w==Core.Enums.ePanel.BonosSoberanos||w==Core.Enums.ePanel.BonosSubsoberanos)&&Core.Functions.Context.Profiles.existPageInMenu("bonos",Core.Objects.Context.Profiles[v])){Core.Business.Operar.Bonos.init(u,v,x)}else{if(w==Core.Enums.ePanel.Cedears&&Core.Functions.Context.Profiles.existPageInMenu("cedears",Core.Objects.Context.Profiles[v])){Core.Business.Operar.Cedears.init(u,v,x)}else{if(w==Core.Enums.ePanel.Lebacs&&Core.Functions.Context.Profiles.existPageInMenu("lebacs",Core.Objects.Context.Profiles[v])){Core.Business.Operar.Lebacs.init(u,v,x)}else{if((w==Core.Enums.ePanel.Letes||w==Core.Enums.ePanel.LetrasLetes||w==Core.Enums.ePanel.LetrasLecaps||w==Core.Enums.ePanel.LetrasLecers||w==Core.Enums.ePanel.LetrasLelinks)&&Core.Functions.Context.Profiles.existPageInMenu("letes",Core.Objects.Context.Profiles[v])){Core.Business.Operar.Letes.init(u,v,x)}else{if((w==Core.Enums.ePanel.ONs||w==Core.Enums.ePanel.CorporativosValoresCortoPlazo||w==Core.Enums.ePanel.CorporativosObligacionesNegociables)&&Core.Functions.Context.Profiles.existPageInMenu("obligacionesnegociables",Core.Objects.Context.Profiles[v])){Core.Business.Operar.ObligacionesNegociables.init(u,v,x)}else{if((w==Core.Enums.ePanel.Futuros||w==Core.Enums.ePanel.FuturosByma||w==Core.Enums.ePanel.FuturosMatba)&&Core.Functions.Context.Profiles.existPageInMenu("futuros",Core.Objects.Context.Profiles[v])){Core.Business.Operar.Futuros.init(u,v,x)}else{if(w==Core.Enums.ePanel.DolarBolsa&&Core.Functions.Context.Profiles.existPageInMenu("dolarBolsa",Core.Objects.Context.Profiles[v])){Core.Business.Operar.DolarBolsa.init(u,v,x)}else{if(w==Core.Enums.ePanel.Cauciones&&Core.Functions.Context.Profiles.existPageInMenu("cauciones",Core.Objects.Context.Profiles[v])){Core.Business.Operar.Cauciones.init(u,v,x)}else{if((w==Core.Enums.ePanel.NYSE||w==Core.Enums.ePanel.ETF||w==Core.Enums.ePanel.NASDAQ)&&Core.Functions.Context.Profiles.existPageInMenu("internacional",Core.Objects.Context.Profiles[v])){Core.Business.Operar.Internacional.init(u,v,x)}else{if((w==Core.Enums.ePanel.BCINYSE||w==Core.Enums.ePanel.BCIETF||w==Core.Enums.ePanel.BCINASDAQ)&&Core.Functions.Context.Profiles.existPageInMenu("bci_internacional",Core.Objects.Context.Profiles[v])){Core.Business.Operar.BCIAcciones.init(u,v,x)}}}}}}}}}}}}}p.push({field:"u",title:"Ult.",width:"5%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(p.length),format:Core.Functions.grid.formatPrice});p.push({field:"varValorAbsoluto",title:"Var",width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(p.length),format:Core.Functions.grid.formatColorBySignTwoDecimal});p.push({field:"varValorPorcentaje",title:"Var (%)",width:"6%",headerAttributes:Core.Functions.grid.getHeaderAttribute(p.length),format:Core.Functions.grid.formatPercentageTwoDecimal});p.push({field:"v",title:"Vol.",width:"10%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(p.length),format:Core.Functions.grid.formatNuleableIntegerNumber});if(!Core.Functions.isMobile&&!Core.Functions.isTablet){p.push({field:"ant",title:"Ant.",width:"5%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(p.length),format:Core.Functions.grid.formatPrice});p.push({field:"ap",title:"Ape",width:"5%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(p.length),format:Core.Functions.grid.formatPrice})}if(!Core.Functions.isMobile){p.push({field:"min",title:"Min",width:"5%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(p.length),format:Core.Functions.grid.formatPrice});p.push({field:"max",title:"Max",width:"5%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(p.length),format:Core.Functions.grid.formatPrice})}if(!Core.Functions.isMobile&&!Core.Functions.isTablet&&(g==Core.Enums.ePanel.Letes||g==Core.Enums.ePanel.Lebacs||g==Core.Enums.ePanel.LetrasLetes||g==Core.Enums.ePanel.LetrasLecaps||g==Core.Enums.ePanel.LetrasLecers||g==Core.Enums.ePanel.LetrasLelinks)){p.push({field:"d",title:"Días",width:"5%",attributes:Core.Functions.grid.getRightAlignedColumnClass(),headerAttributes:Core.Functions.grid.getHeaderAttribute(p.length),format:Core.Functions.grid.formatNuleableIntegerNumber})}p.push({field:"f",title:"Fecha",width:"5%",headerAttributes:Core.Functions.grid.getHeaderAttribute(p.length)});var s=Core.Functions.grid.getHeaderAttribute(p.length);if(b&&Core.Functions.Context.Profiles.existPageInMenu("alertasPrecios",Core.Objects.Context.Profiles[f])){p.push({width:"3%",title:" ",attributes:{style:"font-weight: bold; font-size: x-large;"},headerAttributes:s,columnTemplate:function(u,v,w){var t=$('<img width="25"'+(!v.Demora?' src="/images/ico-alerta-precio.svg" class="link-cell" title="Configurar alerta"':'src="/images/ico-alerta-precio-deshabilitada.svg"')+"></img>").appendTo(u);if(!v.Demora){t.on("click",function(){var x=$.grep(d.swidget().dataSource.data,function(z,y){return z.ticker==v.ticker&&z.plazo==v.plazo})[0];new Core.Controls.ManagerAlertaPrecio({overlayElement:d.parent(),cotizacion:{securityId:x.SecurityID,ticker:x.ticker,descripcion:x.descripcion,plazo:{id:Core.Functions.Plazo.getIDByDescription(x.plazo),description:x.plazo},precio:x.u,variacion:x.varValorPorcentaje},}).show()})}}})}if(a){p.push({width:"3%",title:" ",attributes:{style:"font-weight: bold; font-size: x-large;"},headerAttributes:s,columnTemplate:function(u,v,w){var x=' src="/images/ico-watchlist-inactiva.svg"';if(v.Demora){x=' src="/images/ico-watchlist-deshabilitada.svg"'}else{if(v.idWatchlist){x=' src="/images/ico-watchlist-activa.svg"'}}var t=$('<img width="25" '+x+(!v.Demora?' class="link-cell"  title="Click para mas opciones"':"")+"></img>").appendTo(u);if(!v.Demora){Core.Functions.Watchlists.initMenu(t,v,i,d.parent())}}})}if(c){p.push({width:"3%",title:" ",attributes:{style:"font-weight: bold; font-size: x-large;"},headerAttributes:s,columnTemplate:function(u,v,w){var t=$('<img src="/images/ico-watchlist-eliminar.svg" width="25" class="link-cell" title="Eliminar"></img>').appendTo(u);t.on("click",function(){new Core.Controls.Confirmation("Confirmación","¿Está seguro que desea eliminar el item del ticker: "+v.ticker+" y plazo: "+v.plazo+" de la watchlist?",{onAccepted:function(){var x=new Core.Ajax.ServerRequest({overlayElement:d.parent(),requestUrl:"watchlists/"+h+"?ticker="+encodeURIComponent(v.ticker)+"&plazo="+v.plazo,requestType:"DELETE"});x.onSuccess=function(){if(d.swidget().contentTable[0].rows.length==1){var z=new Core.Ajax.ServerRequest({overlayElement:d.parent(),requestUrl:"watchlists/"+h,requestType:"DELETE"});z.onSuccess=function(){l(h)};z.request()}data=$.grep(d.swidget().dataSource.data,function(B,A){return B.ticker!=v.ticker||B.plazo!=v.plazo});var y=d.swidget().initialOptions;y.dataSource.data=data;d.swidget().refresh(y)};x.request()}}).show()})}})}function q(u){var t=$("<div class='grid-details'/>").appendTo(u.detailCell).shieldGrid({dataSource:{data:[]},sorting:{multiple:true},selection:false,rowHover:false,columns:[{field:" ",title:" ",width:((g==Core.Enums.ePanel.Letes||g==Core.Enums.ePanel.Lebacs)?"16.7%":"14.5%"),format:Core.Functions.grid.formatUndefinedString,headerTemplate:""},{field:"CantCompra",title:" ",width:((g==Core.Enums.ePanel.Letes||g==Core.Enums.ePanel.Lebacs)?"8.3%":"9.71%"),attributes:Core.Functions.grid.getGreyOpacityAlignedColumnClass(0.5),format:Core.Functions.grid.formatNuleableIntegerNumber,headerTemplate:""},{field:"PrecioCompra",title:" ",width:((g==Core.Enums.ePanel.Letes||g==Core.Enums.ePanel.Lebacs)?"4.2%":"4.85%"),attributes:Core.Functions.grid.getGreyOpacityAlignedColumnClass(0.9),format:Core.Functions.grid.formatPrice,headerTemplate:""},{field:"PrecioVenta",title:" ",width:((g==Core.Enums.ePanel.Letes||g==Core.Enums.ePanel.Lebacs)?"4.2%":"4.85%"),attributes:Core.Functions.grid.getGreyOpacityAlignedColumnClass(0.9),format:Core.Functions.grid.formatPrice,headerTemplate:""},{field:"CantVenta",title:" ",width:((g==Core.Enums.ePanel.Letes||g==Core.Enums.ePanel.Lebacs)?"8.3%":"9.71%"),attributes:Core.Functions.grid.getGreyOpacityAlignedColumnClass(0.5),format:Core.Functions.grid.formatNuleableIntegerNumber,headerTemplate:""},{field:" ",title:" ",width:((g==Core.Enums.ePanel.Letes||g==Core.Enums.ePanel.Lebacs)?"57.8%":"56.38%"),format:Core.Functions.grid.formatUndefinedString,headerTemplate:""}]});Core.Functions.grid.Cotizaciones.details.push({grid:t,SecurityID:u.item.SecurityID});Core.Functions.grid.Cotizaciones.refreshGridDetail(t,u.item)}var r={};if(m&&!Core.Functions.isMobile&&!Core.Functions.isTablet){r.detailCreated=q}d.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},columns:p,events:r})}},50)},loadGrid:function(a,b,k,c,e,d,f,h,g,i){var j=new Core.Ajax.ServerRequest({showOverlay:c==null,secureRequest:true,requestUrl:"cotizaciones/"+k+"?token="+e+((f!=null)?("&tokenindice="+f):""),requestType:"GET"});j.onSuccess=function(l){Core.Functions.grid.Cotizaciones.refreshGrid(l,a,b,c,e,d,f,h,g,i)};j.request()},refreshGrid:function(c,e,f,m,p,o,q,x,w,B){var t=(B&&!Core.Functions.isMobile&&!Core.Functions.isTablet)?1:0;c.cotizaciones=$.grep(c.cotizaciones,x);var g=m?$.grep(m,x):[];for(var h=0;h<c.cotizaciones.length;h++){Core.Functions.grid.Cotizaciones.setVariation(c.cotizaciones[h]);c.cotizaciones[h].Demora=c.params?c.params.Demora:0}if(c.indice){for(var h=0;h<c.indice.length;h++){if(!c.indice[h].Anterior||c.indice[h].Anterior==0||c.indice[h].Anterior==-1||!c.indice[h].Ultimo||c.indice[h].Ultimo==0||c.indice[h].Ultimo==-1||c.indice[h].Fecha.length==10){c.indice[h].Va="=0.00 (0.00%)"}else{var d=c.indice[h].Ultimo-c.indice[h].Anterior;if(d>0){c.indice[h].Va="+"+d.toFixed(2)+" ("+(d/c.indice[h].Anterior*100).toFixed(2)+"%)"}else{if(d==0){c.indice[h].Va="="+d.toFixed(2)+" ("+(d/c.indice[h].Anterior*100).toFixed(2)+"%)"}else{if(d<0){c.indice[h].Va=d.toFixed(2)+" ("+(d/c.indice[h].Anterior*100).toFixed(2)+"%)"}}}}}}if(m!=null){var l=0;for(var z=0;z<g.length&&l<c.cotizaciones.length;z++){var u=g[z];var r=Core.Functions.grid.grepOne(c.cotizaciones,function(i){return i.SecurityID==u.SecurityID});if(r!=null){l++;r.ticker=u.ticker;r.descripcion=u.descripcion;r.plazo=u.plazo;r.cf=u.cf;r.base=u.base;r.panel=u.panel;r.Demora=u.Demora;r.d=u.d;if(r.t>u.t){for(var b=0;b<e.swidget().columns.length;b++){var v=u[e.swidget().columns[b].field];var s=r[e.swidget().columns[b].field];if(v!=s){var y=Core.Functions.grid.grepOne(e.swidget().contentTable[0].rows,function(i){return i.cells[0+t].innerText.trim()==u.ticker&&i.cells[1+t].innerText.trim()==u.plazo});if(y){var a=$(y.cells[b+t]);if(s>v){Core.Functions.Highlight(a,{cssClass:"animation-green-pulse"})}else{if(s<v){Core.Functions.Highlight(a,{cssClass:"animation-red-pulse"})}else{Core.Functions.Highlight(a,{cssClass:"animation-blue-pulse"})}}if(e.swidget().columns[b].format!=null){a.html(e.swidget().columns[b].format(s))}else{a.html(s)}}}}var k=Core.Functions.grid.grepOne(Core.Functions.grid.Cotizaciones.details,function(i){return i.SecurityID==r.SecurityID});if(k){Core.Functions.grid.Cotizaciones.refreshGridDetail(k.grid,r)}var n=null;for(var h=0;h<m.length;h++){if(m[h].SecurityID==g[z].SecurityID){n=h;break}}if(n!=null){m[n]=r}e.swidget().dataSource.data[z]=r}}}}else{m=c.cotizaciones;var j=e.swidget().initialOptions;j.dataSource.data=c.cotizaciones;e.swidget().refresh(j)}if(c.indice!=null&&c.indice.length>0&&f!=null){function A(E,F,C,D,i){E.text(i(F+C));if(D!=null){if(C>D){Core.Functions.Highlight(E,{cssClass:"animation-green-pulse"})}else{if(C<D){Core.Functions.Highlight(E,{cssClass:"animation-red-pulse"})}}}}q=c.indice[0].Token;f.find(".label-cotizacion-fecha").text(c.indice[0].Fecha);A(f.find(".label-cotizacion-ultimo"),"",c.indice[0].Ultimo,(o)?o.Ultimo:null,Core.Functions.grid.formatPrice);f.find(".label-cotizacion-variacion").html(Core.Functions.grid.formatColorByFirstDigit(c.indice[0].Va));A(f.find(".label-cotizacion-anterior"),"Ant: ",c.indice[0].Anterior,(o)?o.Anterior:null,Core.Functions.grid.formatPrice);A(f.find(".label-cotizacion-apertura"),"Ape: ",c.indice[0].Apertura,(o)?o.Apertura:null,Core.Functions.grid.formatPrice);A(f.find(".label-cotizacion-maximo"),"Máx: ",c.indice[0].Maximo,(o)?o.Maximo:null,Core.Functions.grid.formatPrice);A(f.find(".label-cotizacion-minimo"),"Mín: ",c.indice[0].Minimo,(o)?o.Minimo:null,Core.Functions.grid.formatPrice);o=c.indice[0]}p=Core.Functions.grid.Cotizaciones.getMaxToken(c.cotizaciones,p);w(m,p,o,q,c.params)},refreshGridDetail:function(c,e){var k=[];if(e.cc2||e.pc2||e.pv2||e.cv2){k.push({CantCompra:e.cc2,PrecioCompra:e.pc2,PrecioVenta:e.pv2,CantVenta:e.cv2})}if(e.cc3||e.pc3||e.pv3||e.cv3){k.push({CantCompra:e.cc3,PrecioCompra:e.pc3,PrecioVenta:e.pv3,CantVenta:e.cv3})}if(e.cc4||e.pc4||e.pv4||e.cv4){k.push({CantCompra:e.cc4,PrecioCompra:e.pc4,PrecioVenta:e.pv4,CantVenta:e.cv4})}if(e.cc5||e.pc5||e.pv5||e.cv5){k.push({CantCompra:e.cc5,PrecioCompra:e.pc5,PrecioVenta:e.pv5,CantVenta:e.cv5})}var f=c.swidget().dataSource.data;if(f.length>0){for(var m=0;m<f.length;m++){var i=f[m];var g=k[m];if(g!=null){for(var b=0;b<c.swidget().columns.length;b++){var j=i[c.swidget().columns[b].field];var h=g[c.swidget().columns[b].field];if(j!=null&&h!=null&&j!=h){var l=c.swidget().contentTable[0].rows[m];if(l){var a=$(l.cells[b]);if(h>j){Core.Functions.Highlight(a,{cssClass:"animation-green-pulse"})}else{if(h<j){Core.Functions.Highlight(a,{cssClass:"animation-red-pulse"})}else{Core.Functions.Highlight(a,{cssClass:"animation-blue-pulse"})}}if(c.swidget().columns[b].format!=null){a.html(c.swidget().columns[b].format(h))}else{a.html(h)}}}}}}c.swidget().dataSource.data=k}if(f.length==0||f.length!=k.length){var d=c.swidget().initialOptions;d.dataSource.data=k;c.swidget().refresh(d)}},initFilter:function(a,c,b,d){c.shieldTextBox({events:{change:function(f){clearTimeout(b);b=setTimeout(function(){value=f.value;var g=d.scrollTop();var e=a.swidget().initialOptions;if(value){e.dataSource.filter={or:[{path:"ticker",filter:"contains",value:value},{path:"descripcion",filter:"contains",value:value}]}}else{e.dataSource.filter=null}a.swidget().refresh(e);d.scrollTop(g)},50)}}})},getMaxToken:function(a,c){var d=c;for(var b=0;b<a.length;b++){if(a[b].t>d){d=a[b].t}}return d},setVariation:function(a){if(!a.ant||a.ant==0||a.ant==-1||!a.u||a.u==0||a.u==-1||a.f.length==10){a.varValorAbsoluto=0;a.varValorPorcentaje=0}else{var b=a.u-a.ant;if(b>0){a.varValorAbsoluto=parseFloat(b.toFixed(2));a.varValorPorcentaje=parseFloat((b/a.ant*100).toFixed(2))}else{if(b==0){a.varValorAbsoluto=parseFloat(b.toFixed(2));a.varValorPorcentaje=parseFloat((b/a.ant*100).toFixed(2))}else{if(b<0){a.varValorAbsoluto=parseFloat(b.toFixed(2));a.varValorPorcentaje=parseFloat((b/a.ant*100).toFixed(2))}}}}},setAlertPriceType:function(b,c,f,d,e){b.removeClass("alert-info alert-warning");b.addClass(f==1?"alert-warning":"alert-info");if(c){b.html(c);var a=b.find(".link");a.on("click",function(){Core.Business.FormularioPreciosInternacional.init(d,e)});b.show()}else{b.hide()}},initInstrumentSearch:function(a,b,c){a.shieldComboBox({dataSource:{data:[],sort:function(d,f){if(!a.swidget().term){return 0}var e=d.DisplayTicker.toLowerCase().indexOf(a.swidget().term.toLowerCase());var g=f.DisplayTicker.toLowerCase().indexOf(a.swidget().term.toLowerCase());if(e>=0&&g>=0){if(e==0&&g>0){return -1}else{if(e>0&&g==0){return 1}else{if((d.DisplayTicker.length-a.swidget().term.length)<(f.DisplayTicker.length-a.swidget().term.length)){return -1}else{if((d.DisplayTicker.length-a.swidget().term.length)>(f.DisplayTicker.length-a.swidget().term.length)){return 1}else{return 0}}}}}else{if(e>=0){return -1}else{if(g>=0){return 1}else{return 0}}}}},valueTemplate:"{DisplayTicker}",textTemplate:"{DisplayTicker} | {Descripcion}",autoComplete:{enabled:true,filter:{or:[{path:"Descripcion",filter:"contains",value:""},{path:"DisplayTicker",filter:"contains",value:""}]}},events:{select:function(d){if(d.index>=0&&a.swidget().selectedItem()){var f={};if(a.swidget().selectedItem().panel==Core.Enums.ePanel.Fondos){f.fondo=a.swidget().selectedItem().DisplayTicker}else{f.ticker=a.swidget().selectedItem().DisplayTicker}Core.Business.DetalleInstrumento.init(b,c,f)}}}})},loadInstrumentSearch:function(b,a,c){var e=$.grep(Core.Objects.Accounts?Core.Objects.Accounts:[],function(h,g){return h.idCuenta==b})[0];var d={};d.panel=((e&&e.idNegocio==Core.Enums.eNegocio.BCI)?Core.Enums.ePanel.AllBCI:Core.Enums.ePanel.All);var f=new Core.Ajax.ServerRequest({allowCache:true,showOverlay:true,requestUrl:"especies",requestType:"GET",requestData:d});f.onSuccess=function(g){var h=a.swidget().initialOptions;h.dataSource.data=g.especies;a.swidget().refresh(h);c()};f.request()}},AccountDetails:{showDetailsByIdAccount:function(a,c,b){var e=new Core.Ajax.ServerRequest({requestUrl:"detallecuenta/"+a.idCuenta,requestType:"GET"});e.onSuccess=function(l){var m='<table class="table table-striped" style="word-break:break-word">';m+="<thead><tr><th>Nombre</th><th>Valor fondos</th><th>Valor bolsa</th></tr></thead>";m+="<tbody>";for(var h=0;h<l.detalle.length;h++){m+="<tr>";m+="<td>"+l.detalle[h].Nombre.replaceAll(";"," ")+"</td>";m+="<td>"+l.detalle[h].ValorFondos.replaceAll(";"," ")+"</td>";if(l.detalle[h].Nombre=="Legajo"){var k={idAperturaCuenta:l.detalle[h].ValorBolsa.replaceAll(";"," ")};m+="<td><a onclick='Core.Business.OpenManagerAltaCuenta.init("+a.idCuenta+", "+0+", "+JSON.stringify(k)+");'>"+l.detalle[h].ValorBolsa.replaceAll(";"," ")+"</a>"}else{m+="<td>"+l.detalle[h].ValorBolsa.replaceAll(";"," ")+"</td>"}m+="</tr>"}if(Core.Objects.Context.Configuration.idAplicacion!=1&&l.datos[0].urlFicha){m+="<tr>";m+="<td>Ficha Societaria</td>";m+="<td colspan='2'><a target='_blank' href='"+Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+l.datos[0].urlFicha+"'>Ver</td>";m+="</tr>"}if(Core.Objects.Context.Configuration.idAplicacion!=1){m+="<tr>";m+="<td>Perfil del Inversor</td>";m+="<td colspan='2'>"+l.datos[0].DescripcionPerfil+"</td>";m+="</tr>"}m+="</tbody>";m+="</table>";if(a.Juridica){m+='<button style="margin-left: 15px; margin-bottom: 5px; margin-top: 5px;" type="button" class="btn btn-primary" onclick="Core.Functions.grid.AccountDetails.managerCBUs('+a.idCuenta+', null, null);">Administrar Cbu</button>';var j=null;for(var h=0;h<Core.Objects.Context.Profiles.length;h++){if(Core.Objects.Context.Profiles[h].id=="transaccional"){j=h}}if(j!=null){var k={idCuenta:a.idCuenta};if(l.datos[0].idPerfil&&l.datos[0].idPerfil!=Core.Enums.eTestInversorPerfil.Error){m+="<button style='margin-left: 15px; margin-bottom: 5px; margin-top: 5px;' type='button' class='btn btn-primary' onclick='Core.Business.TestInversorResultado.init("+a.idCuenta+", "+j+", "+JSON.stringify(k)+");'>Realizar Test</button>"}else{m+="<button style='margin-left: 15px; margin-bottom: 5px; margin-top: 5px;' type='button' class='btn btn-primary' onclick='Core.Business.TestInversorCuestionario.init("+a.idCuenta+", "+j+", "+JSON.stringify(k)+");'>Realizar Test</button>"}}}var g=$("<div />");for(var h=0;h<l.personas.length;h++){d(g,l.personas[h],a)}var f=new Core.Controls.Dialog("Detalles de "+a.Descripcion,m+g.html(),{displayButtons:{close:true,accept:false}});f.show()};e.request();function d(n,v,f){var p=$('<div style="border-style: solid; margin-top: 15px;"/>').appendTo(n);$('<div style="display: none" id="divAlert-'+v.id+'" class="alert alert-danger col-sm-12"></div>').appendTo(p);var w=$("<table class='table table-striped'>");var C=$("<tr />").appendTo(w);$("<td style='width:25%;'>Apellido:</td>").appendTo(C);$("<td style='width:25%;'>"+v.Apellido+"</td>").appendTo(C);var y=$('<td style="text-align:center;" rowspan="4"></td>').appendTo(C);var r=$('<img style="max-width:200px; max-height:200px;" src="'+v.Avatar+'"/>').appendTo(y);var J=$("<tr>").appendTo(w);$("<td>Nombre:</td>").appendTo(J);$("<td>"+v.Nombre+"</td>").appendTo(J);var G=$("<tr>").appendTo(w);$("<td>Fecha de Nacimiento:</td>").appendTo(G);$("<td>"+v.FechaNacimiento+"</td>").appendTo(G);var E=$("<tr>").appendTo(w);$("<td>"+v.TipoDocumento+":</td>").appendTo(E);$("<td>"+v.Documento+"</td>").appendTo(E);var D=$("<tr>").appendTo(w);$("<td>CUIL:</td>").appendTo(D);$("<td>"+v.CUIL+"</td>").appendTo(D);$("<td></td>").appendTo(D);if(Core.Objects.Context.Configuration.idAplicacion!=1){var L=$("<tr>").appendTo(w);$("<td>Rol:</td>").appendTo(L);$("<td>"+v.Rol+"</td>").appendTo(L);$("<td></td>").appendTo(L)}var M=$("<tr>").appendTo(w);$("<td>Teléfono Móvil:</td>").appendTo(M);$("<td>"+v.TelefonoMovil+"</td>").appendTo(M);$("<td></td>").appendTo(M);var F=$("<tr>").appendTo(w);$("<td>Email:</td>").appendTo(F);var x=$("<td/>").appendTo(F);var P=$('<input id="txt-'+v.id+'" type="text" placeholder="Ingrese su email" style="width:250px;" value="'+v.email+'">').appendTo(x);$("<td></td>").appendTo(F);P.prop("disabled",true);if(Core.Objects.Context.Configuration.idAplicacion!=1&&v.TieneUsuario){var I=$("<tr>").appendTo(w);$("<td>Nivel:</td>").appendTo(I);var z=$("<td/>").appendTo(I);var t=$('<span id="lbl-'+v.id+'" style="margin-right: 5px;">'+v.Nivel+"</span>").appendTo(z);var o=$('<select id="ddl-'+v.id+'" style="width:150px; margin-right: 5px;"/>').appendTo(z);o.append($('<option value="0">Cambiar por</option>'));o.append($('<option value="2">2</option>'));o.append($('<option value="4">4</option>'));o.append($('<option value="5">5</option>'));var g=$('<button "style="margin-left: 15px;" type="button" onclick="Core.Functions.grid.AccountDetails.changeLevel('+v.id+');">Confirmar cambio</button>').appendTo(z);if(!b){o.hide();g.hide()}$("<td/>").appendTo(I)}if(Core.Objects.Context.Configuration.idAplicacion!=1){var H=$("<tr>").appendTo(w);$("<td>Fichas:</td>").appendTo(H);if(v.Ficha1){$("<td><a onclick=\"Core.Functions.grid.AccountDetails.loadFicha('"+v.Ficha1.toString()+"');\">Ficha 1</a>").appendTo(H)}else{$("<td></td>").appendTo(H)}if(v.Ficha2){$("<td><a onclick=\"Core.Functions.grid.AccountDetails.loadFicha('"+v.Ficha2.toString()+"');\">Ficha 2</a>").appendTo(H)}else{$("<td></td>").appendTo(H)}}if(Core.Objects.Context.Configuration.idAplicacion!=1){var K=$("<tr/>").appendTo(w);$("<td>Perfil del Inversor:</td>").appendTo(K);$("<td>"+v.DescripcionPerfil+"</td>").appendTo(K);$("<td></td>").appendTo(K);var N=$("<tr/>").appendTo(w);var A=$("<td colspan='3'></td>").appendTo(N);if(v.TyCFechaAprobacion){$("<a target='_blank' href='"+v.TyCURL+"'><i class='glyphicon glyphicon-file'></i>Términos y Condiciones Aceptados: SI (Fecha: "+v.TyCFechaAprobacion+")</a>").appendTo(A)}else{$("<i class='glyphicon glyphicon-file'></i><span>Términos y Condiciones  Aceptados: NO</span>").appendTo(A)}var O=$("<tr/>").appendTo(w);var B=$("<td colspan='3'></td>").appendTo(O);if(v.MDRTFechaAprobacion){$("<a target='_blank' href='"+v.MDRTURL+"'><i class='glyphicon glyphicon-file'></i>Servicio de Precios Internacionales en Tiempo Real: SI (Fecha: "+v.MDRTFechaAprobacion+")</a>").appendTo(B)}else{$("<i class='glyphicon glyphicon-file'></i><span>Servicio de Precios Internacionales en Tiempo Real: NO</span>").appendTo(B)}}w.appendTo(p);if(c){if(v.TieneUsuario){var m=$('<button style="margin-left: 15px; margin-bottom: 5px; margin-top: 5px;" type="button" class="btn btn-primary" onclick="Core.Functions.grid.AccountDetails.resetPassword('+v.id+","+f.idCuenta+');">Resetear Clave</button>').appendTo(p)}else{if(Core.Objects.Context.Configuration.idAplicacion==3){P.prop("disabled",false);var h=$('<button style="margin-left: 15px; margin-bottom: 5px; margin-top: 5px;" type="button" class="btn btn-primary" onclick="Core.Functions.grid.AccountDetails.changeEmail('+v.id+","+f.idCuenta+');">Cambiar Email</button>').appendTo(p)}var j=$('<button style="margin-left: 15px; margin-bottom: 5px; margin-top: 5px;" type="button" class="btn btn-primary" onclick="Core.Functions.grid.AccountDetails.sendMail('+v.id+","+f.idCuenta+');">Enviar mail de Ayuda</button>').appendTo(p)}if(v.TelefonoMovil!=""){var m=$('<button style="margin-left: 15px; margin-bottom: 5px; margin-top: 5px;" type="button" class="btn btn-primary" onclick="Core.Functions.grid.AccountDetails.resetMobilePhone('+v.id+","+f.idCuenta+');">BLANQUEAR CELULAR</button>').appendTo(p)}var k=$('<button style="margin-left: 15px; margin-bottom: 5px; margin-top: 5px;" type="button" class="btn btn-primary" onclick="Core.Functions.grid.AccountDetails.managerCBUs(null, '+v.id+",'"+v.CUIL+"');\">Administrar CBU</button>").appendTo(p);var s=null;for(var q=0;q<Core.Objects.Context.Profiles.length;q++){if(Core.Objects.Context.Profiles[q].id=="transaccional"){s=q}}if(s!=null){var u={idPersona:v.id};if(v.idPerfil&&v.idPerfil!=Core.Enums.eTestInversorPerfil.Error){var l=$("<button style='margin-left: 15px; margin-bottom: 5px; margin-top: 5px;' type='button' class='btn btn-primary' onclick='Core.Business.TestInversorResultado.init("+f.idCuenta+", "+s+", "+JSON.stringify(u)+");'>Realizar Test</button>").appendTo(p)}else{var l=$("<button style='margin-left: 15px; margin-bottom: 5px; margin-top: 5px;' type='button' class='btn btn-primary' onclick='Core.Business.TestInversorCuestionario.init("+f.idCuenta+", "+s+", "+JSON.stringify(u)+");'>Realizar Test</button>").appendTo(p)}}}}},changeLevel:function(a){var b=$("#ddl-"+a).val();if(b>0){var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"usuario/nivel",requestType:"PUT",requestData:{data:{idPersonaCuenta:a,nivel:b}}});c.onSuccess=function(d){$("#lbl-"+a).text(b);$("#ddl-"+a).val("0")};c.request()}},changeEmail:function(d,c){var b=$("#txt-"+d).val().trim();var a=$("#divAlert-"+d);a.slideUp();if(!b||!Core.Functions.Validations.isEmail(b)){a.text("Debe ingresar un email válido.");a.slideDown();return}$(".default-modal").on("hidden.bs.modal",function(){new Core.Controls.Confirmation("Confirmación","Se enviará un mail al cliente, al correo anterior y al nuevo informando esta modificación. ¿Deseas continuar?",{onAccepted:function(){var e=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"usuario/cambiomail",requestType:"POST",requestData:{idPersona:d,idCuenta:c,Email:b}});e.onSuccess=function(g){var f=new Core.Controls.Dialog("Mensaje","El cambio de email se ha realizado con éxito.",{displayButtons:{close:true,accept:false}});f.show()};e.request()}}).show()});$(".default-modal").modal("hide")},sendMail:function(b,a){$(".default-modal").on("hidden.bs.modal",function(){new Core.Controls.Confirmation("Confirmación","Se enviará un mail al cliente para que genere sus credenciales de ingreso. ¿Deseas continuar?",{onAccepted:function(){var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"usuario/enviomail",requestType:"POST",requestData:{idPersona:b,idCuenta:a}});c.onSuccess=function(e){var d=new Core.Controls.Dialog("Mensaje","Se ha enviado un mail de ayuda al usuario.",{displayButtons:{close:true,accept:false}});d.show()};c.request()}}).show()});$(".default-modal").modal("hide")},resetPassword:function(b,a){$(".default-modal").on("hidden.bs.modal",function(){new Core.Controls.Confirmation("Confirmación","Se enviará un mail al cliente para que genere su nueva contraseña. ¿Deseas continuar?",{onAccepted:function(){var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"usuario/resetpassword",requestType:"POST",requestData:{idPersona:b,idCuenta:a}});c.onSuccess=function(e){var d=new Core.Controls.Dialog("Mensaje","Se ha reseteado la clave.",{displayButtons:{close:true,accept:false}});d.show()};c.request()}}).show()});$(".default-modal").modal("hide")},loadFicha:function(b){var a=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:b,requestType:"GET"});a.onSuccess=function(d){var c=new Image();c.src="data:image/jpg;base64,"+d.imagen;var e=window.open("");e.document.write(c.outerHTML)};a.request()},resetMobilePhone:function(b,a){$(".default-modal").on("hidden.bs.modal",function(){new Core.Controls.Confirmation("Confirmación","Se enviará un mail al cliente informando que se ha borrado el celular registrado en su usuario. ¿Deseas continuar? ",{onAccepted:function(){var c=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"datos/eliminar",requestType:"POST",requestData:{idPersona:b,idCuenta:a,campo:"sms"}});c.onSuccess=function(e){var d=new Core.Controls.Dialog("Mensaje","Se ha blanqueado el teléfono móvil.",{displayButtons:{close:true,accept:false}});d.show()};c.request()}}).show()});$(".default-modal").modal("hide")},managerCBUs:function(b,c,a){$(".default-modal").on("hidden.bs.modal",function(){var d=$(".div-cbus");if(b){d.find(".modal-title").html("Cuentas vinculadas para la cuenta "+b)}else{d.find(".modal-title").html("Cuentas vinculadas para la persona "+c)}Core.Functions.grid.Cbus.initGridCuentasBancariasVinculadas(d,b,c,a);d.modal({show:true})});$(".default-modal").modal("hide")}},Cbus:{initGridCuentasBancariasVinculadas:function(e,i,j,h,l){var f=e.find(".div-grid-cuentas-bancarias-vinculadas");var g=e.find(".div-grid-cuentas-bancarias-exterior-vinculadas");g.show();if(Core.Objects.Context.Configuration.idAplicacion==1){g.hide()}var c=[];var d=[];var b={width:100,title:" ",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(o,p,q){var n=$('<button type="button" title="Modificar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-edit"></span></button>').appendTo(o);n.on("click",function(){if(Core.Objects.Context.Mobile){var r=new Core.Business.AccountSettings.ManagerCuentaBancaria({cuentaBancaria:p,fiscalIdentifier:h,onSave:function(){Core.Functions.grid.Cbus.loadGridCuentasBancariasVinculadas(e,i,j)}}).show()}else{var s="Debe ingresar su teléfono celular para poder modificar su cuenta bancaria. Para ingresarlo haga <a onclick=\"$('.close-btn').click(); $('.btn-cambio-phone').click();\">Click Aquí.</a></p>";new Core.Controls.Dialog("Aviso",s,{displayButtons:{close:true,accept:false}}).show()}});var m=$('<button type="button" title="Eliminar" class="btn-sm balanz-button"><span class="glyphicon glyphicon-remove"></span></button>').appendTo(o);m.on("click",function(){var r="¿Está seguro que desea eliminar la cuenta";r+=(p.Banco?("del banco: "+p.Banco):"");r+=(p.CBU?(" con CBU: "+p.CBU):"");r+=(p.IBAN?(" con IBAN: "+p.IBAN):"");r+=(p.AccountNumber?(" con Account Number: "+p.AccountNumber):"");r+="?";new Core.Controls.Confirmation("Confirmación",r,{onAccepted:function(){var s=new Core.Ajax.ServerRequest({overlayElement:m,requestUrl:"cbu/"+encodeURIComponent(p.idCuentaBancaria),requestType:"DELETE"});s.onSuccess=function(u){var t=new Core.Controls.Dialog("Mensaje","La cuenta ha sido eliminada correctamente.",{displayButtons:{close:true,accept:false}});t.show();Core.Functions.grid.Cbus.loadGridCuentasBancariasVinculadas(e,i,j)};s.request()}}).show()})}};c.push({width:"30%",field:"Banco",title:"Banco",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString});c.push({width:"25%",field:"CBU",title:"CBU",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString});c.push({width:"10%",field:"Moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString});c.push({width:"19%",field:"Alias",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString});c.push(b);d.push({width:"30%",field:"SWIFT",title:"SWIFT / ABA",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),columnTemplate:function(m,n,o){m.text(Core.Functions.grid.formatUndefinedString(n.SWIFT?n.SWIFT:n.ABA))}});d.push({width:"25%",field:"",title:"Account Number / IBAN",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),columnTemplate:function(m,n,o){m.text(Core.Functions.grid.formatUndefinedString(n.AccountNumber?n.AccountNumber:n.IBAN))}});d.push({width:"10%",field:"Moneda",title:"Moneda",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellOddClass(),format:Core.Functions.grid.formatUndefinedString});d.push({width:"19%",field:"Alias",title:"Descripción",attributes:Core.Functions.grid.getLeftAlignedColumnClass(),headerAttributes:Core.Functions.grid.getCellEvenClass(),format:Core.Functions.grid.formatUndefinedString});d.push(b);var a=e.find(".btn-nueva-cuenta-bancaria");a.unbind("click");a.click(function(){if(Core.Objects.Context.Mobile){var o={};o.fiscalIdentifier=h;o.onSave=function(){Core.Functions.grid.Cbus.loadGridCuentasBancariasVinculadas(e,i,j)};if(i){o.idCuenta=i}if(j){o.idPersona=j}var m=new Core.Business.AccountSettings.ManagerCuentaBancaria(o).show()}else{var n="Debe ingresar su teléfono celular para poder ingresar su cuenta bancaria. Para ingresarlo haga <a onclick=\"$('.close-btn').click(); $('.btn-cambio-phone').click();\">Click Aquí.</a></p>";new Core.Controls.Dialog("Aviso",n,{displayButtons:{close:true,accept:false}}).show()}});if(!f.swidget()){f.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},noRecordsText:"No existen cuentas vinculadas ingresadas...",paging:{pageSize:30,pageLinksCount:10},columns:[]})}var k=f.swidget().initialOptions;k.dataSource.data=[];k.columns=c;f.swidget().refresh(k);if(!g.swidget()){g.shieldGrid({dataSource:{data:[]},selection:false,rowHover:false,sorting:{multiple:true},noRecordsText:"No existen cuentas vinculadas ingresadas...",paging:{pageSize:30,pageLinksCount:10},columns:[]})}var k=g.swidget().initialOptions;k.dataSource.data=[];k.columns=d;g.swidget().refresh(k);Core.Functions.grid.Cbus.loadGridCuentasBancariasVinculadas(e,i,j,l)},loadGridCuentasBancariasVinculadas:function(a,d,e,f){var b=a.find(".div-grid-cuentas-bancarias-vinculadas");var c=a.find(".div-grid-cuentas-bancarias-exterior-vinculadas");var g=((d==null)?("usuario/"+encodeURIComponent(e)):("cuentas/"+encodeURIComponent(d)))+"/detalle";var h=new Core.Ajax.ServerRequest({overlayElement:a,showOverlay:true,requestUrl:g,requestType:"GET"});h.onSuccess=function(k){var j=b.swidget().initialOptions;j.dataSource.data=$.grep(k.cuentasbancarias,function(m,l){return m.TipoCuentaBancaria==Core.Enums.eTipoCuentaBancaria.Argentina});b.swidget().refresh(j);var i=$.grep(k.cuentasbancarias,function(m,l){return m.TipoCuentaBancaria==Core.Enums.eTipoCuentaBancaria.Exterior});var j=c.swidget().initialOptions;j.dataSource.data=i;c.swidget().refresh(j);c.show();if((Core.Objects.Context.Configuration.idAplicacion==1&&!Core.Objects.Context.Profiles[0].opciones.habilitarCBExt)||!i.length){c.hide()}if(f!=null){f(k)}};h.request()}},OrdenDetails:{showDetails:function(a,b,c){var d=new Core.Ajax.ServerRequest({requestUrl:"ordenes/detalle/"+a+"/"+b,requestType:"GET"});d.onSuccess=function(h){var j="";if(h.Ordenes){j+="<table class='table table-striped'>";j+="<thead><tr><th>Nombre</th><th>Valor</th></tr></thead>";j+="<tbody>";for(var g=0;g<h.Ordenes.length;g++){if(h.Ordenes[g].Nombre&&h.Ordenes[g].Valor&&!h.Ordenes[g].Oculto){j+="<tr>";j+="<td>"+h.Ordenes[g].Nombre.replaceAll(";"," ")+"</td>";j+="<td>"+h.Ordenes[g].Valor.replaceAll(";"," ")+"</td>";j+="</tr>"}}j+="</tbody>";j+="</table>"}if(h.Transiciones){j+="<label>Transiciones</label>";if(h.Transiciones.length>0){j+="<table class='table table-striped'>";j+="<thead><tr><th>Fecha</th><th>Estado Desde</th><th>Estado Hasta</th><th>Tiempo</th></tr></thead>";j+="<tbody>";for(var g=0;g<h.Transiciones.length;g++){if(h.Transiciones[g].Fecha&&h.Transiciones[g].EstadoDesde&&h.Transiciones[g].EstadoHasta&&h.Transiciones[g].Tiempo!=null){j+="<tr>";j+="<td>"+h.Transiciones[g].Fecha.replaceAll(";"," ")+"</td>";j+="<td>"+h.Transiciones[g].EstadoDesde.replaceAll(";"," ")+"</td>";j+="<td>"+h.Transiciones[g].EstadoHasta.replaceAll(";"," ")+"</td>";j+="<td class='text-right'>"+Core.Functions.grid.formatIntegerNumber(h.Transiciones[g].Tiempo)+"</td>";j+="</tr>"}}j+="</tbody>";j+="</table>"}else{j+="<p>Sin registros.</p><br/>"}}if(h.Operaciones){j+="<label>Operaciones</label>";if(h.Operaciones.length>0){j+="<table class='table table-striped'>";j+="<thead><tr><th>Nro Operación</th><th>Cantidad Operada</th><th>Precio</th><th>Contraparte</th><th>Fecha Operación</th><th>Estado</th></tr></thead>";j+="<tbody>";for(var g=0;g<h.Operaciones.length;g++){if(h.Operaciones[g].NroOperacion&&h.Operaciones[g].CantidadOperada!=null&&h.Operaciones[g].Precio!=null&&h.Operaciones[g].Contraparte!=null&&h.Operaciones[g].FechaOperacion&&h.Operaciones[g].Estado){j+="<tr>";j+="<td class='text-right'>"+h.Operaciones[g].NroOperacion+"</td>";j+="<td class='text-right'>"+h.Operaciones[g].CantidadOperada+"</td>";j+="<td class='text-right'>"+h.Operaciones[g].Precio+"</td>";j+="<td class='text-right'>"+h.Operaciones[g].Contraparte+"</td>";j+="<td>"+h.Operaciones[g].FechaOperacion.replaceAll(";"," ")+"</td>";j+="<td>"+h.Operaciones[g].Estado.replaceAll(";"," ")+"</td>";j+="</tr>"}}j+="</tbody>";j+="</table>"}else{j+="<p>Sin registros.</p><br/>"}}var f=null;if(h.idArchivoComprobante&&h.idTipoArchivo&&h.idArchivoComprobante!=0&&h.idTipoArchivo!=0){f=$("<div />");$('<button title="Descargar" class="btn btn-primary" type="button" onclick="Core.Functions.grid.OrdenDetails.downloadFile('+h.idTipoArchivo+","+h.idArchivoComprobante+');">Descargar comprobante</button>').appendTo(f)}if(Core.Objects.Context.Configuration.idAplicacion!=1&&c&&c.puedeConsultarEstado&&h.puedeConsultarEstadoOrden==1){if(f==null){f=$("<div />")}$('<button title="Consultar Estado" class="btn btn-primary" type="button" onclick="Core.Functions.grid.OrdenDetails.verifyState('+a+","+b+');">Consultar Estado</button>').appendTo(f)}if(f!=null){j+=f.html()}var e=new Core.Controls.Dialog("Detalles de Orden: "+b,j,{displayButtons:{close:true,accept:false}});e.show()};d.request()},downloadFile:function(b,a){function d(l){var k=new Blob([l.response],{type:l.response.type});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(k);return}var e=window.URL.createObjectURL(k);var j=document.createElement("a");j.href=e;var g=l.getResponseHeader("Content-Disposition").split("; ");var f="filename=reporte.xlsx";for(var h=0;h<g.length;h++){if(g[h].indexOf("filename")>=0){f=g[h]}}j.download=f.split("=")[1];j.dispatchEvent(new MouseEvent("click"));window.URL.revokeObjectURL(e)}var c=new XMLHttpRequest();c.open("GET",Core.Origin+Core.Functions.Context.getPathname()+Core.PrefixUrl+"comprobantes/"+b+"/"+a,true);c.responseType="blob";c.setRequestHeader("Authorization",Core.Objects.Context.Token);c.onload=function(e){if(c.status==200){d(c)}else{var f=new Core.Controls.Dialog("Mensaje","<p>No se ha podido realizar la descarga del reporte.</p>",{displayButtons:{close:true,accept:false}});f.show()}};c.send()},verifyState:function(a,b){var c=new Core.Ajax.ServerRequest({requestUrl:"ordenes/verificar/"+a+"/"+b,requestType:"GET"});c.onSuccess=function(e){var d=new Core.Controls.Dialog("Aviso",e.Descripcion,{displayButtons:{close:true,accept:false},onClosed:function(){Core.Functions.grid.OrdenDetails.showDetails(a,b,{puedeConsultarEstado:1})}});d.show()};c.request()},showDetailsPrecarga:function(a,b){var c=new Core.Ajax.ServerRequest({requestUrl:"precargar/detalle/"+a+"/"+b,requestType:"GET"});c.onSuccess=function(f){var g="";if(f.detalle){g+="<table class='table table-striped'>";g+="<thead><tr><th>Nombre</th><th>Valor</th></tr></thead>";g+="<tbody>";for(var e=0;e<f.detalle.length;e++){if(f.detalle[e].Nombre&&f.detalle[e].Valor&&!f.detalle[e].Oculto){g+="<tr>";g+="<td>"+f.detalle[e].Nombre.replaceAll(";"," ")+"</td>";g+="<td>"+f.detalle[e].Valor.replaceAll(";"," ")+"</td>";g+="</tr>"}}g+="</tbody>";g+="</table>"}var d=new Core.Controls.Dialog("Detalles de la Precarga: "+b,g,{displayButtons:{close:true,accept:false}});d.show()};c.request()}}};Core.Functions.Highlight=function(b,c){c=c||new Object();c.cssClass=c.cssClass||"animation-blue-pulse";c.duration=c.duration||1000;c.onComplete=c.onComplete||function(){};b.removeClass("animation-blue-pulse animation-red-pulse animation-green-pulse animation-lightgreen-pulse");var a=parseInt(b.attr("data-timeout-id"));if(a){window.clearInterval(a);b.removeAttr("data-timeout-id")}b.addClass(c.cssClass);var d=window.setTimeout(function(){b.removeClass(c.cssClass);b.removeAttr("data-timeout-id");c.onComplete()},c.duration);b.attr("data-timeout-id",d)};Core.Functions.setHighlight=function(a,b,c){if(b!=null&&c!=null){if(b>c){Core.Functions.Highlight(a,{cssClass:"animation-green-pulse"})}else{if(b<c){Core.Functions.Highlight(a,{cssClass:"animation-red-pulse"})}}}};Core.Functions.HTML={htmlDecode:function(d){var a=document.createElement("div");a.innerHTML=d;var b="";for(var c=0;c<a.childNodes.length;c++){b+=a.childNodes[c].nodeValue}return b}};Core.Functions.isMobile=false;Core.Functions.isTablet=false;Core.Functions.isDesktop=false;Core.Functions.isLarge=false;$(document).ready(function(){try{Core.Functions.isMobile=window.matchMedia("only screen and (max-width: 768px)").matches;Core.Functions.isTablet=window.matchMedia("only screen and (min-width: 769px) and (max-width: 992px)").matches;Core.Functions.isDesktop=window.matchMedia("only screen and (min-width: 993px) and (max-width: 1280px)").matches;Core.Functions.isLarge=window.matchMedia("only screen and (min-width: 1281px)").matches}catch(a){Core.Functions.isMobile=false;Core.Functions.isTablet=false;Core.Functions.isDesktop=false;Core.Functions.isLarge=false}});Core.Functions.Notification={execute:function(notification,idDefaultAccount,idDefaultProfile,onExecuted){if(notification.tipoaccion==1){eval(notification.accion+".init("+idDefaultAccount+","+idDefaultProfile+","+notification.parameters+");")}else{if(notification.tipoaccion==2){window.open(notification.accion,"_blank");onExecuted()}else{if(notification.tipoaccion==3){Core.Business.ExternalUrl.init(idDefaultAccount,idDefaultProfile,{url:notification.accion})}else{if(notification.tipoaccion==4){var modalNotification=$(notification.accion).appendTo($("body"));modalNotification.unbind("shown.bs.modal");modalNotification.on("shown.bs.modal",function(){$(window).off("beforeunload")});modalNotification.unbind("hidden.bs.modal");modalNotification.on("hidden.bs.modal",function(){$(window).on("beforeunload",function(e){return""});modalNotification.remove()});modalNotification.modal({show:true})}else{if(notification.tipoaccion==5){var accion=JSON.parse(notification.accionjson);if(accion.data&&accion.data.namespace){var namespace=accion.data.namespace;delete accion.data.namespace;eval(namespace+".init("+idDefaultAccount+","+idDefaultProfile+","+JSON.stringify(accion.data)+");")}}else{onExecuted()}}}}}}};Number.prototype.padLeft=function(a,b){return Array(a-String(this).length+1).join(b||"0")+this};Number.prototype.padRight=function(a,b){return this+Array(a-String(this).length+1).join(b||"0")};Core.Functions.Operar={setEspecieByTipoOperacion:function(j,a,d,e,c,f,g,b){var h={};if(j==Core.Enums.eEspeciesTipoOperacion.Venta||j==Core.Enums.eEspeciesTipoOperacion.ConversionEspecies){h.idCuenta=c;h.plazo=(e!=null)?e:3}else{if(d==Core.Enums.ePanel.Futuros){h.idCuenta=c}}h.panel=d;var i=new Core.Ajax.ServerRequest({showOverlay:!f,allowCache:(j==Core.Enums.eEspeciesTipoOperacion.Compra||j==Core.Enums.eEspeciesTipoOperacion.CaucionColocadora||j==Core.Enums.eEspeciesTipoOperacion.CaucionTomadora),secureRequest:true,requestUrl:"especies",requestType:"GET",requestData:h});i.onSuccess=function(k){Core.Functions.Operar.loadEspecies(a,d,j,k.especies==null?[]:k.especies,g,b)};i.request()},loadEspecies:function(b,d,g,a,e,c){var f=b.swidget().initialOptions;f.dataSource.data=$.grep(a,function(i,h){return !c||c(i)});if(d==Core.Enums.ePanel.Futuros||g==Core.Enums.eEspeciesTipoOperacion.Venta||g==Core.Enums.eEspeciesTipoOperacion.ConversionEspecies){f.textTemplate="{DisplayTicker} ({Cantidad}) | {Descripcion}"}else{f.textTemplate="{DisplayTicker} | {Descripcion}"}b.swidget().refresh(f);if(e){e()}},setLabelsByEspecie:function(a,b,e,f,c,d,g,h){if(!a.swidget().selectedItem()||b==null){return}var j=function(m,o){var l="field-var";if(o!=null&&o.length>1){var n=o.substr(0,1);if(n=="+"){l="field-varpositiva"}if(n=="-"){l="field-varnegativa"}}m.removeClass("field-var field-varpositiva field-varnegativa").addClass(l)};var i={};i.ticker=a.swidget().selectedItem().DisplayTicker;if(b!=null){i.plazo=b}var k=new Core.Ajax.ServerRequest({showOverlay:!g,secureRequest:true,requestUrl:"cotizacioninstrumento",requestType:"GET",requestData:i});k.onSuccess=function(l){e.text(l.Cotizacion.UltimoPrecio!=null?Core.Functions.grid.formatPrice(l.Cotizacion.UltimoPrecio):"No disponible");f.text(l.Cotizacion.Variacion!=null?l.Cotizacion.Variacion:"No disponible");j(f,l.Cotizacion.Variacion);c.text(l.Cotizacion.MejorOfertaCompra!=null?l.Cotizacion.MejorOfertaCompra:"No disponible");d.text(l.Cotizacion.MejorOfertaVenta!=null?l.Cotizacion.MejorOfertaVenta:"No disponible");if(h){h(l)}};k.request()},srOperarEspecies:function(a,e,b,c,d,g){var f=new Core.Ajax.ServerRequest({showOverlay:!d,secureRequest:true,requestUrl:((a.EsPrecarga?"precargar/":"operar/")+"especies/solicitud"),requestType:"POST",requestData:a});f.onSuccess=function(l){var i="Comitente N°"+l.NumComitente+" - "+l.DescripcionCuenta;var j="S.E:U.O. (Salvo error u omisión) <br>Los valores son estimados; los valores finales de la operación surgiran de la ejecución misma y reflejados en el boleto.";var k={data:l,idDefaultProfile:c,idAccount:b,generalTitle:("CONFIRMACION DE "+(a.EsPrecarga?"PRECARGA DE ":"")+"ORDEN"),backgroundColorTitle:(a.EsPrecarga?"#d9edf7":""),accountDescription:i,footerHtml:j,urlMethod:((a.EsPrecarga?"precargar/":"operar/")+"especies/confirmar"),codigo4DDescription:"Ingrese su código de operación de cuatro dígitos:",onConfirm:e,stayInPage:g};var h=new Core.Controls.OperarConfirmation(k).show()};f.request()},srOperarLicitacion:function(a,d,b,c){var e=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:((a.EsPrecarga?"precargar/":"operar/")+"licitacion/solicitud"),requestType:"POST",requestData:a});e.onSuccess=function(j){var g="Comitente N°"+j.NumComitente+" - "+j.DescripcionCuenta;var h="S.E:U.O. (Salvo error u omisión) <br>Los valores son estimados; los valores finales de la operación surgiran de la ejecución misma y reflejados en el boleto.";var i={data:j,idDefaultProfile:c,idAccount:b,generalTitle:("CONFIRMACION DE "+(a.EsPrecarga?"PRECARGA DE ":"")+"ORDEN"),backgroundColorTitle:(a.EsPrecarga?"#d9edf7":""),accountDescription:g,footerHtml:h,urlMethod:((a.EsPrecarga?"precargar/":"operar/")+"licitacion/confirmar"),codigo4DDescription:"Ingrese su código de operación de cuatro dígitos:",onConfirm:d};var f=new Core.Controls.OperarConfirmation(i).show()};e.request()},setCuotapartista:function(b,a,c){var d=new Core.Ajax.ServerRequest({showOverlay:!c,secureRequest:true,requestUrl:"datoscuenta/"+encodeURIComponent(a),requestType:"GET"});d.onSuccess=function(e){b.text("Cuotapartista Nº "+e.DatosCuenta.NumCuotapartista+" | "+e.DatosCuenta.DescripcionFondos)};d.request()},setComitente:function(b,a,c){var d=new Core.Ajax.ServerRequest({showOverlay:!c,secureRequest:true,requestUrl:"datoscuenta/"+encodeURIComponent(a),requestType:"GET"});d.onSuccess=function(e){b.text("Comitente Nº "+e.DatosCuenta.NumComitente+" | "+e.DatosCuenta.DescripcionBolsa)};d.request()},setDisponible:function(b,e,f,h,d){var c=$.grep(b,function(k,j){return k.idMoneda==e})[0];var a="0";if(c){if(f==Core.Enums.ePlazo.CI){a=c.DisponibleOperableCI}else{if(f==Core.Enums.ePlazo.D24){a=c.DisponibleOperable24}else{if(f==Core.Enums.ePlazo.D48){a=c.DisponibleOperable48}else{if(f==Core.Enums.ePlazo.D72){a=c.DisponibleOperable72}else{a=c.DisponibleOperableFuturo}}}}}var i=null;for(var g in Core.Enums.Currency){if(Core.Enums.Currency[g].idMoneda==e){i=Core.Enums.Currency[g]}}h.text("Disponible: "+a+" "+(i?i.Descripcion:""));d.show();return a},refreshDisponible:function(a,d,b,c){var e=new Core.Ajax.ServerRequest({showOverlay:!c,requestUrl:"detalledisponible/"+encodeURIComponent(b),requestType:"GET",requestData:{Fecha:Core.Functions.Date.getDateAsString(new Date())}});e.onSuccess=function(f){a=f;if(d){d()}};e.request()},setColorByTipoOperacion:function(d,c,b){var a="";if(d==Core.Enums.eEspeciesTipoOperacion.Compra||d==Core.Enums.eFondosTipoOperacion.Suscripcion||d==Core.Enums.eEspeciesTipoOperacion.CompraMonedas||d==Core.Enums.eEspeciesTipoOperacion.CompraDolarBolsa||d==Core.Enums.eEspeciesTipoOperacion.CaucionTomadora||d=="R"){a="#99ffcc"}else{if(d==Core.Enums.eEspeciesTipoOperacion.Venta||d==Core.Enums.eFondosTipoOperacion.Rescate||d==Core.Enums.eEspeciesTipoOperacion.VentaMonedas||d==Core.Enums.eEspeciesTipoOperacion.VentaDolarBolsa||d==Core.Enums.eEspeciesTipoOperacion.CaucionColocadora||d==Core.Enums.eEspeciesTipoOperacion.ConversionEspecies||d=="E"){a="#ffb3b3"}else{a="#ffffcc"}}c.css("border-color",a);b.css("background-color",a)},setTotalOperacion:function(a,d,c,b){c.removeClass("field-varnegativa");if((!a||a==0)||(!d||d==0)){c.text("")}else{var e=a*d;c.text(e.toFixed(2));if(b&&e>b){c.addClass("field-varnegativa")}}},srOperarEspeciesValidaciones:function(c,d){var b="";if(c.val()<0){b="La cantidad ingresada de nominales debe ser mayor que 0.";d.value=false}if(b!=""){var a=new Core.Controls.Dialog("Aviso",b,{displayButtons:{close:true,accept:false}}).show()}},setPlazos:function(b,e){var f={"0":"CI","1":"24 hs","2":"48 hs","3":"72 hs"};var g={"0":Core.Enums.ePlazo.CI,"1":Core.Enums.ePlazo.D24,"2":Core.Enums.ePlazo.D48,"3":Core.Enums.ePlazo.D72};var d=e.split(",");var a=[];d.forEach(function(i,h){if(i!=""){a.push({value:g[i],text:f[i]})}});var c=b.swidget().initialOptions;c.dataSource.data=a;b.swidget().refresh(c)},setControlsOperarFix:function(s,b,c,f,e,d,h,l){var a=s?s.Cotizacion:null;var r=[];var q=null;var u=[];var t=null;var o=a&&a.OrderType?a.OrderType.split(","):[];var p=a&&a.TimeInForce?a.TimeInForce.split(","):[];if(Core.Objects.Context.CommonParameters){for(var j=0;j<o.length;j++){var k=$.grep(Core.Objects.Context.CommonParameters.orderType,function(v,i){return v.Valor==o[j]})[0];if(k){r.push(k);if(k.EsValorPorDefecto){q=k}}}for(var j=0;j<p.length;j++){var k=$.grep(Core.Objects.Context.CommonParameters.timeInForce,function(v,i){return v.Valor==p[j]})[0];if(k){u.push(k);if(k.EsValorPorDefecto){t=k}}}}f.show();if(r.length==0||u.length==0){f.hide()}var m=b.swidget().initialOptions;m.dataSource.data=r;m.value=(h&&m.value?m.value:(q?q.Valor:""));b.swidget().refresh(m);var n=c.swidget().initialOptions;n.dataSource.data=u;n.value=(h&&n.value?n.value:(t?t.Valor:""));c.swidget().refresh(n);if(e){e.hide();if(Core.Objects.Context.CommonParameters.execInst&&$.grep(Core.Objects.Context.CommonParameters.execInst,function(w,v){return w.Valor=="x"}).length>0){var g=a&&a.ExecInst?a.ExecInst.split(", "):[];if($.grep(g,function(v,i){return v=="x"}).length>0){e.show()}}}if(d){d.hide();if(Core.Objects.Context.CommonParameters.execInst&&$.grep(Core.Objects.Context.CommonParameters.execInst,function(w,v){return w.Valor=="o"}).length>0){var g=a&&a.ExecInst?a.ExecInst.split(", "):[];if($.grep(g,function(v,i){return v=="o"}).length>0){d.show()}}}if(l){l((a)?a.MarketID:null)}},setControlsByMinutosEjecucion:function(a,b){b.hide();if(a.swidget().value()<0){b.show()}},setControlsByMinutosExpiracion:function(a,b){b.hide();if(a.swidget().value()<0){b.show()}},showAyudaEjecutarValidaciones:function(){new Core.Controls.Dialog("Ayuda","Permite ingresar una precarga fuera de los horarios del mercado, incluyendo días no hábiles.",{displayButtons:{close:true,accept:false}}).show()},enabledOperar:function(d,b,c){var a=$.grep(Core.Objects.Accounts,function(f,e){return f.idCuenta==b})[0];if(a.NumComitente!=""){if((d==Core.Enums.ePanel.Acciones&&Core.Functions.Context.Profiles.existPageInMenu("acciones",Core.Objects.Context.Profiles[c]))||(d==Core.Enums.ePanel.Opciones&&Core.Functions.Context.Profiles.existPageInMenu("opciones",Core.Objects.Context.Profiles[c]))||(d==Core.Enums.ePanel.Bonos&&Core.Functions.Context.Profiles.existPageInMenu("bonos",Core.Objects.Context.Profiles[c]))||(d==Core.Enums.ePanel.Cedears&&Core.Functions.Context.Profiles.existPageInMenu("cedears",Core.Objects.Context.Profiles[c]))||(d==Core.Enums.ePanel.Lebacs&&Core.Functions.Context.Profiles.existPageInMenu("lebacs",Core.Objects.Context.Profiles[c]))||(d==Core.Enums.ePanel.Letes&&Core.Functions.Context.Profiles.existPageInMenu("letes",Core.Objects.Context.Profiles[c]))||(d==Core.Enums.ePanel.Fondos&&Core.Functions.Context.Profiles.existPageInMenu("FCI",Core.Objects.Context.Profiles[c]))||(d==Core.Enums.ePanel.ONs&&Core.Functions.Context.Profiles.existPageInMenu("obligacionesnegociables",Core.Objects.Context.Profiles[c]))||(d==Core.Enums.ePanel.Futuros&&Core.Functions.Context.Profiles.existPageInMenu("futuros",Core.Objects.Context.Profiles[c]))||(d==Core.Enums.ePanel.NYSE&&Core.Functions.Context.Profiles.existPageInMenu("internacional",Core.Objects.Context.Profiles[c]))||(d==Core.Enums.ePanel.BCINYSE&&Core.Functions.Context.Profiles.existPageInMenu("bci_internacional",Core.Objects.Context.Profiles[c]))){return true}else{return false}}else{return false}},callOperar:function(d,c,a,b,e){if(c==Core.Enums.eEspeciesTipoOperacion.Licitacion||c==Core.Enums.eEspeciesTipoOperacion.Renovacion){Core.Business.Operar.Licitaciones.init(a,b,e)}else{if(d==Core.Enums.ePanel.Acciones){Core.Business.Operar.Acciones.init(a,b,e)}else{if(d==Core.Enums.ePanel.Opciones){Core.Business.Operar.Opciones.init(a,b,e)}else{if(d==Core.Enums.ePanel.Cedears){Core.Business.Operar.Cedears.init(a,b,e)}else{if(d==Core.Enums.ePanel.Fondos){Core.Business.Operar.FCI.init(a,b,e)}else{if(d==Core.Enums.ePanel.Bonos){Core.Business.Operar.Bonos.init(a,b,e)}else{if(d==Core.Enums.ePanel.Lebacs){Core.Business.Operar.Lebacs.init(a,b,e)}else{if(d==Core.Enums.ePanel.Letes){Core.Business.Operar.Letes.init(a,b,e)}else{if(d==Core.Enums.ePanel.ONs){Core.Business.Operar.ObligacionesNegociables.init(a,b,e)}else{if(d==Core.Enums.ePanel.NYSE){Core.Business.Operar.Internacional.init(a,b,e)}else{if(d==Core.Enums.ePanel.BCINYSE){Core.Business.Operar.BCIAcciones.init(a,b,e)}else{if(d==Core.Enums.ePanel.Futuros){Core.Business.Operar.Futuros.init(a,b,e)}}}}}}}}}}}}}};Core.Functions.Persistence={setTextBox:function(a,b){if(Core.Functions.Validations.isBlockedStorage()||!Core.Functions.Persistence.getStorage()){return}a.on("change",function(){Core.Functions.Persistence.getStorage().setItem(b,a.val())});if(Core.Functions.Persistence.getStorage().getItem(b)){a.val(Core.Functions.Persistence.getStorage().getItem(b))}},getStorage:function(){if(!Core.Objects.Context.Configuration){if(localStorage.getItem("CoreContext")){return localStorage}return sessionStorage}else{if(Core.Objects.Context.Configuration.idAplicacion==1){return sessionStorage}else{return localStorage}}}};Core.Functions.Plazo={getPlazos:function(c){var b=c.split(",");var a=[];b.forEach(function(e,d){if(e!=""&&!isNaN(parseInt(e))){a.push({value:parseInt(e),text:Core.Functions.Plazo.getDescriptionByID(e)})}});return a},getIDByDescription:function(a){var c={"72hs":Core.Enums.ePlazo.D72,"48hs":Core.Enums.ePlazo.D48,"24hs":Core.Enums.ePlazo.D24,CI:Core.Enums.ePlazo.CI,"CI-CI":Core.Enums.ePlazo.CICI,"CI-24hs":Core.Enums.ePlazo.CI24,"CI-48hs":Core.Enums.ePlazo.CI48,"24hs-24hs":Core.Enums.ePlazo.D2424,"24hs-48hs":Core.Enums.ePlazo.D2448,"48hs-48hs":Core.Enums.ePlazo.D4848};var b=c[a];if(b==null&&a.indexOf(" días")>=0){b=a.replaceAll(" días","")}return b},getDescriptionByID:function(b){var c={};c[Core.Enums.ePlazo.D72]="72hs";c[Core.Enums.ePlazo.D48]="48hs";c[Core.Enums.ePlazo.D24]="24hs";c[Core.Enums.ePlazo.CI]="CI";c[Core.Enums.ePlazo.CICI]="CI-CI";c[Core.Enums.ePlazo.CI24]="CI-24hs";c[Core.Enums.ePlazo.CI48]="CI-48hs";c[Core.Enums.ePlazo.D2424]="24hs-24hs";c[Core.Enums.ePlazo.D2448]="24hs-48hs";c[Core.Enums.ePlazo.D4848]="48hs-48hs";var a=c[b];if(a==null){a=(b+" días")}return a}};Core.Functions.ProtegerCuenta={confirm:function(b){var a={close:true,accept:false};var c=new Core.Ajax.ServerRequest({secureRequest:false,requestUrl:"datos/protegercuenta",requestType:"POST",requestData:{nonce:b}});c.onSuccess=function(f){var d=((f&&f.Descripcion)?f.Descripcion:"La operación se ha realizado con éxito, ya puede ingresar al sistema.");var e=new Core.Controls.Dialog("Protección de cuenta",d,{displayButtons:a,onClosed:function(){Core.Business.Logout.clearSession();window.location.href=window.location.origin+Core.Functions.Context.getPathname()}});e.show()};c.onError=function(f){var d=((f&&f.responseJSON&&f.responseJSON.Descripcion)?f.responseJSON.Descripcion:"Link inválido.");var g=new Core.Controls.Dialog("Protección de cuenta",d,{displayButtons:a});g.divModal.on("hidden.bs.modal",function(){Core.Business.Logout.clearSession();window.location.href=window.location.origin+Core.Functions.Context.getPathname()});g.show()};c.request()}};Core.Functions.QueryString={getParameterByName:function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)");var c=b.exec(location.search);return c===null?"":decodeURIComponent(c[1].replace(/\+/g," "))}};Core.Functions.SignIn={activateUserByToken:function(c){var a={close:true,accept:false};var b=new Core.Ajax.ServerRequest({secureRequest:false,requestUrl:"migracion/habilitarusuario",requestType:"POST",requestData:{nonce:c}});b.onSuccess=function(e){var d=new Core.Controls.Dialog("Registración","<p>El proceso de registración hay finalizado correctamente, ya puede ingresar al sistema.</p>",{displayButtons:a});d.show()};b.onError=function(e){var d=new Core.Controls.Dialog("Registración","<p>Link inválido.</p>",{displayButtons:a});d.show()};b.request()}};String.prototype.splice=function(a,b,c){return(this.slice(0,a)+c+this.slice(a+Math.abs(b)))};String.prototype.endsWith=function(a){return this.indexOf(a,this.length-a.length)!==-1};String.prototype.replaceAll=function(b,a){var c=this;return c.replace(new RegExp(b,"g"),a)};String.prototype.padLeft=function(a,b){return Array(a-this.length+1).join(b)+this};String.prototype.padRight=function(a,b){return this+Array(a-this.length+1).join(b)};String.prototype.includes=function(a,b){if(typeof b!=="number"){b=0}if(b+a.length>this.length){return false}else{return this.indexOf(a,b)!==-1}};Core.Functions.Timers={clear:function(){for(var a=0;a<Core.Objects.Context.Timers.length;a++){window.clearInterval(Core.Objects.Context.Timers[a])}}};Core.Functions.Validations={isEmail:function(b){var a=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return a.test(b)},isCuit:function(f){f=f.replace(/[-_]/g,"");if(f.length!=11){return false}else{var d=[5,4,3,2,7,6,5,4,3,2];var e=0;for(var b=0;b<d.length;b++){e+=parseInt(f[b])*d[b]}var c=e%11;var a=c==0?0:c==1?9:11-c}return a==parseInt(f[10])},toggleValidation:function(b,a){if(a){b.closest(".input-group, .form-group").addClass("has-error")}else{b.closest(".input-group, .form-group").removeClass("has-error")}},getValidatedInputValue:function(a,b){if(!a.val()||!a.val().trim()){b.value=false;Core.Functions.Validations.toggleValidation(a,true)}else{Core.Functions.Validations.toggleValidation(a,false)}return a.val()},getValidatedSwidgetValue:function(a,b){if(!a.swidget().value()){b.value=false;Core.Functions.Validations.toggleValidation(a,true)}else{Core.Functions.Validations.toggleValidation(a,false)}return a.swidget().value()},getValidatedNumericInputValue:function(a,b){if(!a.val()||a.val()==0||a.val()==""){b.value=false;Core.Functions.Validations.toggleValidation(a,true)}else{Core.Functions.Validations.toggleValidation(a,false)}return a.val()},getValidatedPositiveNumericInputValue:function(a,b){if(!a.val()||a.val()==0||a.val()==""||a.val()<0){b.value=false;Core.Functions.Validations.toggleValidation(a,true)}else{Core.Functions.Validations.toggleValidation(a,false)}return a.val()},getValidatedNoEmptyNumericInputValue:function(a,b){if(a.val()==""){b.value=false;Core.Functions.Validations.toggleValidation(a,true)}else{Core.Functions.Validations.toggleValidation(a,false)}return a.val()},getValidatedNumericSwidgetValue:function(a,b){if(!a.swidget().value()||a.swidget().value()==0){b.value=false;Core.Functions.Validations.toggleValidation(a,true)}else{Core.Functions.Validations.toggleValidation(a,false)}return a.swidget().value()},getValidatedDropDownValue:function(a,b){if(!a.swidget().value()||!a.swidget().selectedItem()){b.value=false;Core.Functions.Validations.toggleValidation(a,true)}else{Core.Functions.Validations.toggleValidation(a,false)}return a.swidget().value()},isValidCBU:function(b,a){var c=/^[0-9]+$/;if(!b||!a){return false}if(b.length!=22||b.substr(0,3)!=a||!c.test(b)){return false}function f(g){if(g.length!=22){return false}return true}function d(h){if(h.length!=8){return false}var g=h.substr(0,3);var j=h[3];var l=h.substr(4,3);var k=h[7];var m=g[0]*7+g[1]*1+g[2]*3+j*9+l[0]*7+l[1]*1+l[2]*3;var i=(10-(m%10))%10;return i==k}function e(g){if(g.length!=14){return false}var i=g[13];var j=g[0]*3+g[1]*9+g[2]*7+g[3]*1+g[4]*3+g[5]*9+g[6]*7+g[7]*1+g[8]*3+g[9]*9+g[10]*7+g[11]*1+g[12]*3;var h=(10-(j%10))%10;return h==i}return f(b)&&d(b.substr(0,8))&&e(b.substr(8,14))},isValidAlias:function(a){var b=/^[0-9a-zA-Z.-]+$/;if(!a||a.length<6||a.length>20||!b.test(a)){return false}return true},isNumeric:function(a){var b=/^[0-9]+$/;if(a&&!b.test(a)){return false}return true},isBlockedStorage:function(){try{var b=Core.Functions.Persistence.getStorage();b.setItem("testKey","1");b.removeItem("testKey");return false}catch(a){return true}}};Core.Functions.Watchlists={initMenu:function(b,c,d,e){var a=$.grep(b,function(g,f){return $(g).is(":visible")})[0];Core.Controls.Menu(b,[],{my:"left top",at:"left bottom",of:(a?$(a):null)},Core.Controls.eMenuTriggerButton.MouseLeft,function(){var g=[];for(var f=0;f<Core.Objects.Context.Watchlists.length;f++){if(Core.Objects.Context.Watchlists[f].propia==1){g.push({Name:Core.Objects.Context.Watchlists[f].nombre,onClick:function(j,i){var h={ticker:c.ticker,plazo:c.plazo,Nombre:j.Name,publica:0};var k=new Core.Ajax.ServerRequest({overlayElement:e,requestUrl:"watchlists",requestType:"POST",requestData:h});k.onSuccess=function(){b.attr("src","/images/ico-watchlist-activa.svg")};k.request()}})}}g.push({Name:"Nueva watchlist",onClick:function(i,h){if($.grep(Core.Objects.Context.Watchlists,function(k,j){return k.propia==1}).length<d){new Core.Controls.Prompt("Nueva Watchlist","Ingrese el nombre de la nueva watchlist",{onAccepted:function(k){if($.grep(Core.Objects.Context.Watchlists,function(n,m){return n.nombre==k}).length>0){new Core.Controls.Dialog("Aviso","Ya existe una watchlist con ese nombre, por favor ingrese otro nombre.",{displayButtons:{close:true,accept:false}}).show();return}if(k!=null&&k!="Nueva watchlist"&&k!="Agregar a watchlists"){var j={ticker:c.ticker,plazo:c.plazo,Nombre:k,publica:0};var l=new Core.Ajax.ServerRequest({overlayElement:e,requestUrl:"watchlists",requestType:"POST",requestData:j});l.onSuccess=function(){var m=new Core.Ajax.ServerRequest({showOverlay:true,secureRequest:true,requestUrl:"watchlists",requestType:"GET"});m.onSuccess=function(n){b.attr("src","/images/ico-watchlist-activa.svg");Core.Objects.Context.Watchlists=n.watchlists;if(Core.Functions.Validations.isBlockedStorage()||!Core.Functions.Persistence.getStorage()){return}Core.Functions.Persistence.getStorage().setItem("CoreContext",LZString.compressToUTF16(JSON.stringify(Core.Objects.Context)))};m.request()};l.request()}}}).show()}else{new Core.Controls.Dialog("Aviso","Se ha alcanzado la cantidad máxima de watchlists.",{displayButtons:{close:true,accept:false}}).show()}}});return g})}};Core.Objects=new Object();Core.Objects.Accounts=[];Core.Objects.Configuration={idAplicacion:0,idProductor:0,location:{},lastIdAccount:0};Core.Objects.Context={Token:"",User:"",TokenSecret:"",IdSession:0,IdPersona:0,Asesor:null,Nombre:"",LastLogin:"",FiscalIdentifier:"",DocumentType:"",DocumentNumber:"",Email:"",Phone:"",Mobile:"",Avatar:"",TieneC4D:0,Parameters:[],Profiles:[],Timers:[],Watchlists:[],Dialogs:[],Configuration:null,TestInversor:null,WebSocket:null,Notifications:[],Banners:[]};Core.Objects.Contry=[{name:"Antigua y Barbuda",iso_code:"AG",phone_code:1268,url:"/images/flags/24x24/ag.png"},{name:"Alemania",iso_code:"DE",phone_code:49,url:"/images/flags/24x24/de.png"},{name:"Argentina",iso_code:"AR",phone_code:549,url:"/images/flags/24x24/ar.png"},{name:"Barbados",iso_code:"BB",phone_code:1246,url:"/images/flags/24x24/bb.png"},{name:"Bélgica",iso_code:"BE",phone_code:32,url:"/images/flags/24x24/be.png"},{name:"Bolivia",iso_code:"BO",phone_code:591,url:"/images/flags/24x24/bo.png"},{name:"Brasil",iso_code:"BR",phone_code:55,url:"/images/flags/24x24/br.png"},{name:"Bahamas",iso_code:"BS",phone_code:1242,url:"/images/flags/24x24/bs.png"},{name:"Canadá",iso_code:"CA",phone_code:1,url:"/images/flags/24x24/ca.png"},{name:"Chile",iso_code:"CL",phone_code:56,url:"/images/flags/24x24/cl.png"},{name:"China",iso_code:"CN",phone_code:86,url:"/images/flags/24x24/cn.png"},{name:"Colombia",iso_code:"CO",phone_code:57,url:"/images/flags/24x24/co.png"},{name:"Costa Rica",iso_code:"CR",phone_code:506,url:"/images/flags/24x24/cr.png"},{name:"Cuba",iso_code:"CU",phone_code:53,url:"/images/flags/24x24/cu.png"},{name:"Dominica",iso_code:"DM",phone_code:1767,url:"/images/flags/24x24/dm.png"},{name:"Ecuador",iso_code:"EC",phone_code:593,url:"/images/flags/24x24/ec.png"},{name:"El Salvador",iso_code:"SV",phone_code:503,url:"/images/flags/24x24/sv.png"},{name:"España",iso_code:"ES",phone_code:34,url:"/images/flags/24x24/es.png"},{name:"Estados Unidos",iso_code:"US",phone_code:1,url:"/images/flags/24x24/us.png"},{name:"Francia",iso_code:"FR",phone_code:33,url:"/images/flags/24x24/fr.png"},{name:"Granada",iso_code:"GD",phone_code:1473,url:"/images/flags/24x24/gd.png"},{name:"Guatemala",iso_code:"GT",phone_code:502,url:"/images/flags/24x24/gt.png"},{name:"Guyana",iso_code:"GY",phone_code:2,url:"/images/flags/24x24/gy.png"},{name:"Honduras",iso_code:"HN",phone_code:504,url:"/images/flags/24x24/hn.png"},{name:"Holanda",iso_code:"NLD",phone_code:31,url:"/images/flags/24x24/nld.png"},{name:"Israel",iso_code:"IL",phone_code:972,url:"/images/flags/24x24/il.png"},{name:"India",iso_code:"IN",phone_code:91,url:"/images/flags/24x24/in.png"},{name:"Italia",iso_code:"IT",phone_code:39,url:"/images/flags/24x24/it.png"},{name:"Jamaica",iso_code:"JM",phone_code:1876,url:"/images/flags/24x24/jm.png"},{name:"Japón",iso_code:"JP",phone_code:81,url:"/images/flags/24x24/jp.png"},{name:"Santa Lucía",iso_code:"LC",phone_code:1758,url:"/images/flags/24x24/lc.png"},{name:"México",iso_code:"MX",phone_code:52,url:"/images/flags/24x24/mx.png"},{name:"Nicaragua",iso_code:"NI",phone_code:505,url:"/images/flags/24x24/ni.png"},{name:"Panamá",iso_code:"PA",phone_code:507,url:"/images/flags/24x24/pa.png"},{name:"Paraguay",iso_code:"PY",phone_code:595,url:"/images/flags/24x24/py.png"},{name:"Perú",iso_code:"PE",phone_code:51,url:"/images/flags/24x24/pe.png"},{name:"Puerto Rico",iso_code:"PR",phone_code:1,url:"/images/flags/24x24/pr.png"},{name:"Portugal",iso_code:"PT",phone_code:351,url:"/images/flags/24x24/pt.png"},{name:"Reino Unido",iso_code:"GB",phone_code:44,url:"/images/flags/24x24/gb.png"},{name:"Rusia",iso_code:"RU",phone_code:7,url:"/images/flags/24x24/ru.png"},{name:"Sudáfrica",iso_code:"ZA",phone_code:27,url:"/images/flags/24x24/za.png"},{name:"Suecia",iso_code:"SWE",phone_code:46,url:"/images/flags/24x24/swe.png"},{name:"Surinam",iso_code:"SR",phone_code:597,url:"/images/flags/24x24/sr.png"},{name:"Tailandia",iso_code:"TH",phone_code:66,url:"/images/flags/24x24/th.png"},{name:"Trinidad y Tobago",iso_code:"TT",phone_code:1868,url:"/images/flags/24x24/tt.png"},{name:"Turquía",iso_code:"TR",phone_code:90,url:"/images/flags/24x24/tr.png"},{name:"Uruguay",iso_code:"UY",phone_code:598,url:"/images/flags/24x24/uy.png"},{name:"Venezuela",iso_code:"VE",phone_code:58,url:"/images/flags/24x24/ve.png"}];Core.Objects.Persona=function(){this.tipo=0;this.numero=0;this.nombre="";this.apellido="";this.idTipoDocumento=0;this.documento="";this.nacionalidad=0;this.esCiudadanoEstadounidiense=0;this.matcheoCaraManual=0;this.fechaNacimiento="";this.lugarNacimiento="";this.domicilioParticularCalle="";this.domicilioParticularNumero="";this.domicilioParticularPiso="";this.domicilioParticularDepartamento="";this.domicilioParticularCiudad="";this.domicilioParticularidPais=1;this.domicilioParticularidProvincia="";this.domicilioParticularCodigoPostal="";this.domicilioParticularTelefonoFijo="";this.domicilioParticularTelefonoMovil="";this.email="";this.sexo=0;this.idTipoIdentificadorFiscal=0;this.cuit_cuil="";this.idTipoContribuyente=0;this.inscripcionGanancias=0;this.idOcupacion=0;this.idEstadoCivil=0;this.esPep=0;this.esSujetoObligado=0;this.cargo=0;this.OcupacionDescripcion="";this.empresa="";this.EmpresaActividad="";this.domicilioLaboralCalle="";this.domicilioLaboralNumero="";this.domicilioLaboralPiso="";this.domicilioLaboralDepartamento="";this.domicilioLaboralCiudad="";this.domicilioLaboralidProvincia=0;this.domicilioLaboralidPais=1;this.domicilioLaboralCodigoPostal="";this.domicilioLaboralTelefono="";this.conyugeNombre="";this.conyugeApellido="";this.conyugeidTipoDocumento=0;this.conyugeDocumento="";this.conyugeidTipoIdentificadorFiscal=0;this.conyugeCUIT_CUIL="";this.pepCargo="";this.pepAutoridadEmision="";this.pepDenominacion="";this.pepCUIT="";this.pepObservaciones="";this.pepCaracterInvocado="";this.PEPTipo=0;this.PEPNombreIndirecto="";this.tributaEnOtroPais=0;this.idOtroPaisTributo=0;this.nit="";this.nitidTipoIdentificadorFiscal=0;this.montoCompliance=""};Core.restrictions={};Core.restrictions.texts={};Core.restrictions.apply=function(a){if(a==undefined){a=document.body}a=$(a);for(var c in Core.restrictions.types){var b=Core.restrictions.types[c];if(b instanceof (Core.restrictions.restrictionType)){a.find("."+b.cssClass).each(function(d){Core.restrictions.applyRestriction($(this),b)})}}};Core.restrictions.applyRestriction=function(b,a){b=$(b);if(a.initializeFunction!=null){a.initializeFunction(b)}if(a.keyDownFunction!=null){b.off("keydown.Core.restrictions");b.on("keydown.Core.restrictions",function(c){return a.keyDownFunction(b,c)})}if(a.keyPressFunction!=null){b.off("keypress.Core.restrictions");b.on("keypress.Core.restrictions",function(c){return a.keyPressFunction(b,c)})}if(a.keyUpFunction!=null){b.off("keyup.Core.restrictions");b.on("keyup.Core.restrictions",function(c){return a.keyUpFunction(b,c)})}if(a.blurFunction!=null){b.off("blur.Core.restrictions");b.on("blur.Core.restrictions",function(c){return a.blurFunction(b,c)})}};Core.restrictions.remove=function(a){if(a==undefined){a=document.body}a=$(a);for(var c in Core.restrictions.types){var b=Core.restrictions.types[c];if(b instanceof (Core.restrictions.restrictionType)){a.find("."+b.cssClass).each(function(e){d($(this),b)})}}function d(e){e.off("keydown.Core.restrictions");e.off("keypress.Core.restrictions");e.off("keyup.Core.restrictions");e.off("blur.Core.restrictions")}};Core.restrictions.restrictionType=function(a){this.cssClass=null;this.initializeFunction=null;this.keyDownFunction=null;this.keyUpFunction=null;this.blurFunction=null;$.extend(true,this,a)};Core.restrictions.allowCommonKeys=function(a){return $.inArray(a.keyCode,[Core.eKeyCode.Delete,Core.eKeyCode.Backspace,Core.eKeyCode.Tab,Core.eKeyCode.Scape,Core.eKeyCode.Enter])>-1};Core.restrictions.allowNumbers=function(a){return(!a.shiftKey&&!a.altKey)&&((a.keyCode>=Core.eKeyCode.Key_0&&a.keyCode<=Core.eKeyCode.Key_9)||(a.keyCode>=Core.eKeyCode.Keypad_0&&a.keyCode<=Core.eKeyCode.Keypad_9))};Core.restrictions.allowMovementKeys=function(a){return(a.keyCode>=Core.eKeyCode.End&&a.keyCode<=Core.eKeyCode.Right)};Core.restrictions.allowSelectAll=function(a){return(a.ctrlKey&&a.keyCode==Core.eKeyCode.Key_A)};Core.restrictions.allowClipboardActions=function(d){var b=(d.ctrlKey&&d.keyCode==Core.eKeyCode.Key_X);var a=(d.ctrlKey&&d.keyCode==Core.eKeyCode.Key_C);var c=(d.ctrlKey&&d.keyCode==Core.eKeyCode.Key_V);return b||a||c};Core.restrictions.allowDecimalSeparator=function(c,a){var b=a.indexOf(".")==-1;return b&&Core.Functions.Decimal.isDecimalSeparatorValid(c)};Core.restrictions.allowNegative=function(c,a){var d=(a.indexOf("-")==-1);var b=(c==Core.eKeyCode.Dash||c==Core.eKeyCode.Keypad_Subtract);return d&&b};Core.restrictions.types={};Core.restrictions.types.texts={};Core.restrictions.types.decimal=new Core.restrictions.restrictionType({cssClass:"restrict-decimal",initializeFunction:function(b){var a=2;if(b.attr("max-decimal-digit-count")!=undefined){a=parseInt(b.attr("max-decimal-digit-count"))}if(b.val()==""){var c="0.";c=c.padRight(c.length+a,"0");b.val(c)}new Core.Controls.DecimalSeparatorWarning(b)},keyDownFunction:function(b,a){if(Core.restrictions.allowCommonKeys(a)||Core.restrictions.allowNumbers(a)||Core.restrictions.allowMovementKeys(a)||Core.restrictions.allowSelectAll(a)||Core.restrictions.allowClipboardActions(a)||Core.restrictions.allowNegative(a.keyCode,b.val())||Core.restrictions.allowDecimalSeparator(a.keyCode,b.val())){}else{a.preventDefault()}},keyPressFunction:function(b,a){},keyUpFunction:function(b,a){},blurFunction:function(d,a){var b=2;if(d.attr("max-decimal-digit-count")!=undefined){b=parseInt(d.attr("max-decimal-digit-count"))}var c=true;if(d.attr("show-thousands-separator")!=undefined){c=d.attr("show-thousands-separator")=="true"}var e=Core.Functions.Decimal.parseFloat(d.val());e=Core.Functions.Decimal.localizeFloat(e,b,c);d.val(e)}});Core.restrictions.types.integer=new Core.restrictions.restrictionType({cssClass:"restrict-integer",initializeFunction:function(a){},keyDownFunction:function(b,a){if(Core.restrictions.allowCommonKeys(a)||Core.restrictions.allowNumbers(a)||Core.restrictions.allowMovementKeys(a)||Core.restrictions.allowSelectAll(a)||Core.restrictions.allowClipboardActions(a)||Core.restrictions.allowNegative(a.keyCode,b.val())){}else{a.preventDefault()}},keyPressFunction:function(b,a){},keyUpFunction:function(b,a){},blurFunction:function(b,a){b.val(b.val().replace(/[^0-9\.-]+/g,""))}});